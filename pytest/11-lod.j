//===========================================================================
// 
// |c01c432d8어둠의전설 RPG|rNew1.30F
// 
//   Warcraft III map script
//   Generated by the Warcraft III World Editor
//   Date: Sun Feb 04 22:00:49 2024
//   Map Author: 푸잎(fooiff_)
// 
//===========================================================================

//***************************************************************************
//*
//*  Global Variables
//*
//***************************************************************************

globals
    // User-defined
    force                   udg_temp_pg                = null
    unit array              udg_Unit
    string array            udg_SysB_Name
    string array            udg_SavedString
    integer array           udg_SysB_Level
    integer array           udg_Save_HP
    integer array           udg_Save_MP
    integer array           udg_SysE_WIS1
    integer array           udg_SysE_STR1
    integer array           udg_SysE_CON1
    integer array           udg_SysE_DEX1
    integer array           udg_SysE_INT1
    integer                 udg_MT_TimerHou            = 0
    integer                 udg_MT_TimerMin            = 0
    string array            udg_Save_Code
    integer array           udg_PartyNumber_ThisP
    trackable               udg_temp_tr                = null
    integer array           udg_SysC_Armor_B
    integer array           udg_SysC_Armor
    integer array           udg_SysE_CON3
    integer array           udg_SysE_CON2
    integer array           udg_SysE_DEX3
    integer array           udg_SysE_DEX2
    integer array           udg_SysE_INT3
    integer array           udg_SysE_INT2
    integer array           udg_SysE_STR3
    integer array           udg_SysE_STR2
    integer array           udg_SysE_WIS3
    integer array           udg_SysE_WIS2
    integer array           udg_SysC_DmgAttack
    integer array           udg_FSE_it
    real array              udg_SysC_Hits
    real array              udg_SysC_CriP
    real array              udg_SysC_CriX
    integer array           udg_SysC_Dam
    integer                 udg_temp_i                 = 0
    unit                    udg_temp_u                 = null
    integer array           udg_SysC_Regen
    unit                    udg_temp_u2                = null
    location                udg_temp_l                 = null
    gamecache array         udg_Cash
    string array            udg_Save_Code2
    integer array           udg_Save_Count
    boolean                 udg_temp_b                 = false
    player                  udg_temp_p                 = null
    item                    udg_temp_t                 = null
    integer array           udg_FSE_Skill
    string array            udg_FSE_SkillData
    location array          udg_SysA_Revive
    integer array           udg_Quest_00_Note
    string                  udg_temp_s
    string array            udg_Save_CodeOri
    string array            udg_Save_CodeOri2
    string array            udg_Save_CodeOri3
    group                   udg_temp_g                 = null
    real                    udg_temp_r                 = 0
    integer array           udg_PartyNumber_pP
    group                   udg_PartyGoldGroup         = null
    integer array           udg_OnesPositionN
    integer                 udg_SysJ_Count             = 0
    real array              udg_SysC_MissMagic
    string array            udg_SysC_DmgNow
    real array              udg_SysC_AC_R
    region                  udg_temp_rg                = null
    rect                    udg_temp_rc                = null
    item                    udg_MS_item                = null
    location                udg_temp_l2                = null
    location                udg_temp_l3                = null
    integer                 udg_temp_i2                = 0
    integer array           udg_Quest_00_NumberAt
    boolean array           udg_Quest_Boolean_B
    string array            udg_PartyTitle
    integer array           udg_SysK_ExpAdd
    integer array           udg_SysK_DropAdd
    integer array           udg_SysK_Drop
    integer array           udg_SysK_Exp
    integer array           udg_Party_Invite
    integer array           udg_Party_InviteTake
    real array              udg_Quest_WaitTime
    integer array           udg_Quest_07_Num_Hohen
    integer array           udg_Quest_08_Num_Lama
    integer array           udg_Quest_10_Num_Honey
    integer array           udg_Quest_11_Num_Propose
    integer array           udg_Quest_15_Num_Farmer
    integer array           udg_Quest_17_Num_Bear
    integer array           udg_Quest_ClearInt_17
    integer array           udg_Quest_20_Num_Soldier
    integer array           udg_Quest_ClearInt_20
    integer array           udg_Quest_21_Num_Mount
    integer                 udg_Quest_26_Num_Mgcion    = 0
    integer array           udg_Quest_23_Num_Horror
    integer                 udg_Quest_24_Num_Oren      = 0
    integer                 udg_Quest_27_Num_Master    = 0
    integer                 udg_temp_ab                = 0
    integer array           udg_SysL_Level
    integer array           udg_SysL_Exp
    integer array           udg_SysL_STR
    integer array           udg_SysL_INT
    integer array           udg_SysL_WIS
    integer array           udg_SysL_CON
    integer array           udg_SysL_Wood
    integer array           udg_SysL_DEX
    dialog                  udg_temp_d                 = null
    boolean                 udg_SysA_Item              = false
    integer                 udg_MT_TimerSec            = 0
    button array            udg_SysM_Button2
    integer                 udg_SysD_drop_i            = 0
    integer array           udg_SysD_dropMonsterType
    integer array           udg_SysD_dropMonN
    integer array           udg_SysD_dropItems
    integer array           udg_SysD_dropItemN
    real array              udg_SysD_dropPb
    integer array           udg_SysC_HealAdd
    integer array           udg_SysK_GoldAdd
    integer array           udg_SysC_PotAdd
    real array              udg_Quest_SkipWait
    integer array           udg_SysC_DmgAttackAdd
    integer array           udg_SysC_AtkSpdDEX
    string array            udg_Quest_Save
    trigger                 udg_temp_trg               = null
    force                   udg_Quest_Force_05         = null
    integer array           udg_Quest_ClearInt_07
    integer array           udg_Quest_ClearInt_08
    integer array           udg_Quest_ClearInt_09
    boolean                 udg_SysK_TEST              = false
    integer array           udg_SysK_Gold
    integer array           udg_SysC_AtkSpdAdd
    integer array           udg_SysI_Xtical
    real array              udg_SysO_CamDis
    boolean array           udg_SysO_CamUnit
    boolean array           udg_SysI_Exct
    integer array           udg_SysK_SellAdd
    integer array           udg_SysK_BuffAdd
    string array            udg_SysB_Title
    integer array           udg_SysB_TitleNow
    string array            udg_SysB_NameChange
    integer                 udg_SysA_COUNT             = 0
    integer array           udg_Quest_ClearInt_00_47
    integer array           udg_SysC_ArmorM
    unit                    udg_temp_AI_u              = null
    location                udg_temp_l4_TERRAIN        = null
    real                    udg_temp_r2                = 0
    integer                 udg_SYSTEM_MineFloor       = 0
    integer array           udg_Quest_ClearInt_12
    boolean                 udg_SysA_ReloadEnd         = false
    integer array           udg_Quest_ClearInt_13
    string array            udg_SysB_Setting
    integer array           udg_SysI_WoriorPeculiarity
    button array            udg_SysM_Button
    boolean                 udg_SysA_EffectSimple      = false
    integer array           udg_SysI_NowJob
    integer                 udg_SysA_MapLevel          = 0
    player                  udg_SysA_Host              = null
    string array            udg_SysB_SkinOX
    real                    udg_SysA_AddValue          = 0
    integer                 udg_Quest_ClearInt_14      = 0
    integer                 udg_Quest_ClearInt_14_2    = 0
    integer                 udg_Quest_ClearInt_15      = 0
    boolean                 udg_Quest_ClearInt_15_Wait2X = false
    timer                   udg_Quest_ClearInt_15_Timer = null
    timerdialog             udg_Quest_ClearInt_15_TimerWindow = null
    integer                 udg_Quest_ClearInt_15_count = 0
    integer                 udg_Quest_ClearInt_15_mob  = 0
    texttag                 udg_Quest_ClearInt_15_mobWindow = null
    boolean                 udg_Quest_ClearInt_15_Hard = false
    real                    udg_Quest_ClearInt_15_Explosion = 0
    button array            udg_SysM_Button3
    integer array           udg_SysI_MinusRegen
    boolean array           udg_SysI_Dragon
    integer                 udg_Quest_ClearInt_16      = 0
    hashtable               udg_hash                   = null
    integer array           udg_SysI_PreJob
    boolean                 udg_SYSTEM_isCri           = false
    string                  udg_SYSTEM_DamgeColor
    boolean                 udg_SYSTEM_isPot           = false

    // Generated
    rect                    gg_rct_Boss_Rect_01        = null
    rect                    gg_rct_Chang_Job           = null
    rect                    gg_rct_Effect_01           = null
    rect                    gg_rct_Effect_03           = null
    rect                    gg_rct_Effect_04           = null
    rect                    gg_rct_Effect_05           = null
    rect                    gg_rct_Effect_06           = null
    rect                    gg_rct_Effect_07           = null
    rect                    gg_rct_Effect_08_Nanpa     = null
    rect                    gg_rct_Effect_09           = null
    rect                    gg_rct_Etc_Rect_01         = null
    rect                    gg_rct_Etc_Rect_02         = null
    rect                    gg_rct_Etc_Rect_03         = null
    rect                    gg_rct_Hunting_01          = null
    rect                    gg_rct_Hunting_02          = null
    rect                    gg_rct_Hunting_03          = null
    rect                    gg_rct_Hunting_04          = null
    rect                    gg_rct_Hunting_05          = null
    rect                    gg_rct_Hunting_06          = null
    rect                    gg_rct_Hunting_07          = null
    rect                    gg_rct_Hunting_08          = null
    rect                    gg_rct_Hunting_09          = null
    rect                    gg_rct_Hunting_10          = null
    rect                    gg_rct_Hunting_11          = null
    rect                    gg_rct_Hunting_12          = null
    rect                    gg_rct_Hunting_13          = null
    rect                    gg_rct_Hunting_15          = null
    rect                    gg_rct_Hunting_16          = null
    rect                    gg_rct_Hunting_17          = null
    rect                    gg_rct_Hunting_18          = null
    rect                    gg_rct_Hunting_19          = null
    rect                    gg_rct_Hunting_20          = null
    rect                    gg_rct_Hunting_21          = null
    rect                    gg_rct_Hunting_22          = null
    rect                    gg_rct_Hunting_23          = null
    rect                    gg_rct_Hunting_24          = null
    rect                    gg_rct_Hunting_25          = null
    rect                    gg_rct_Hunting_26          = null
    rect                    gg_rct_Hunting_27          = null
    rect                    gg_rct_Hunting_28          = null
    rect                    gg_rct_Hunting_29          = null
    rect                    gg_rct_Hunting_30          = null
    rect                    gg_rct_Hunting_31          = null
    rect                    gg_rct_Hunting_32          = null
    rect                    gg_rct_Hunting_33          = null
    rect                    gg_rct_Hunting_34          = null
    rect                    gg_rct_Hunting_35          = null
    rect                    gg_rct_Hunting_36          = null
    rect                    gg_rct_Hunting_37          = null
    rect                    gg_rct_Hunting_38          = null
    rect                    gg_rct_Hunting_39          = null
    rect                    gg_rct_Hunting_40          = null
    rect                    gg_rct_Hunting_41          = null
    rect                    gg_rct_Hunting_42          = null
    rect                    gg_rct_Hunting_43          = null
    rect                    gg_rct_Hunting_44          = null
    rect                    gg_rct_Hunting_45          = null
    rect                    gg_rct_Hunting_46          = null
    rect                    gg_rct_Hunting_47          = null
    rect                    gg_rct_Hunting_48          = null
    rect                    gg_rct_Hunting_49          = null
    rect                    gg_rct_Hunting_50          = null
    rect                    gg_rct_Hunting_51          = null
    rect                    gg_rct_Moving_00           = null
    rect                    gg_rct_Moving_01           = null
    rect                    gg_rct_Moving_02           = null
    rect                    gg_rct_Moving_03           = null
    rect                    gg_rct_Moving_04           = null
    rect                    gg_rct_Moving_05           = null
    rect                    gg_rct_Moving_06           = null
    rect                    gg_rct_Moving_07           = null
    rect                    gg_rct_Moving_08           = null
    rect                    gg_rct_Moving_09           = null
    rect                    gg_rct_Moving_10           = null
    rect                    gg_rct_Moving_11           = null
    rect                    gg_rct_Moving_12           = null
    rect                    gg_rct_Moving_13           = null
    rect                    gg_rct_Moving_14           = null
    rect                    gg_rct_Moving_15           = null
    rect                    gg_rct_Moving_16           = null
    rect                    gg_rct_Moving_17           = null
    rect                    gg_rct_Moving_18           = null
    rect                    gg_rct_Moving_19           = null
    rect                    gg_rct_Moving_Harmony      = null
    rect                    gg_rct_Moving_Harmony_Before = null
    rect                    gg_rct_Quest03_Enter       = null
    rect                    gg_rct_Quest05_Mantice     = null
    rect                    gg_rct_Quest05_Mantice_2   = null
    rect                    gg_rct_Quest05_Mantice_3   = null
    rect                    gg_rct_Quest05_Mantice_4   = null
    rect                    gg_rct_Quest05_Pantent     = null
    rect                    gg_rct_Quest05_Tresure     = null
    rect                    gg_rct_Rect_168_Mine       = null
    rect                    gg_rct_Rect_168_Mine_Out   = null
    rect                    gg_rct_Rect_168_Mine_Up    = null
    rect                    gg_rct_Setting_Start       = null
    rect                    gg_rct_TMi_Rect_00         = null
    rect                    gg_rct_TMi_Rect_01         = null
    rect                    gg_rct_TMi_Rect_02         = null
    rect                    gg_rct_TMi_Rect_03         = null
    rect                    gg_rct_TMi_Rect_04         = null
    rect                    gg_rct_TMi_Rect_05         = null
    rect                    gg_rct_TMi_Rect_06         = null
    rect                    gg_rct_TMi_Rect_07         = null
    rect                    gg_rct_TMi_Rect_08         = null
    rect                    gg_rct_TMi_Rect_09         = null
    rect                    gg_rct_TMi_Rect_10         = null
    rect                    gg_rct_TMi_Rect_11         = null
    rect                    gg_rct_TMi_Rect_12         = null
    rect                    gg_rct_Villeage_01         = null
    rect                    gg_rct_Villeage_02         = null
    rect                    gg_rct_Villeage_06         = null
    rect                    gg_rct_Villeage_07         = null
    rect                    gg_rct_Villeage_08         = null
    rect                    gg_rct_Villeage_09         = null
    rect                    gg_rct_Villeage_10         = null
    rect                    gg_rct_Villeage_11         = null
    rect                    gg_rct_Villeage_12         = null
    rect                    gg_rct_Villeage_13         = null
    rect                    gg_rct_Villeage_14         = null
    rect                    gg_rct_Villeage_15         = null
    rect                    gg_rct_Villeage_16         = null
    rect                    gg_rct_Villeage_17         = null
    rect                    gg_rct_Hunting_61          = null
    rect                    gg_rct_Hunting_62          = null
    rect                    gg_rct_Hunting_63          = null
    rect                    gg_rct_Hunting_64          = null
    rect                    gg_rct_Hunting_65          = null
    rect                    gg_rct_Hunting_66          = null
    rect                    gg_rct_Hunting_67          = null
    rect                    gg_rct_Boss_Rect_02        = null
    rect                    gg_rct________131          = null
    camerasetup             gg_cam_Camera_001          = null
    sound                   gg_snd_GoodJob             = null
    sound                   gg_snd_MapPing             = null
    sound                   gg_snd_point               = null
    sound                   gg_snd_QuestNew            = null
    sound                   gg_snd_TheHornOfCenarius   = null
    string                  gg_snd_15
    sound                   gg_snd_StoneBridgeRise     = null
    sound                   gg_snd_FacelessOneYes1     = null
    string                  gg_snd_45
    string                  gg_snd_24
    string                  gg_snd_40
    string                  gg_snd_67
    string                  gg_snd_48
    sound                   gg_snd_ItemDrop            = null
    sound                   gg_snd_ItemSale            = null
    sound                   gg_snd_ItemDrop01          = null
    sound                   gg_snd_GemDrop             = null
    sound                   gg_snd_ExcuDrop            = null
    sound                   gg_snd_HeartBeat           = null
    string                  gg_snd_3
    string                  gg_snd_4
    trigger                 gg_trg_Set_Start           = null
    trigger                 gg_trg_Set_Instruction     = null
    trigger                 gg_trg_Set_Skill_Data      = null
    trigger                 gg_trg_Set_SaveItem        = null
    trigger                 gg_trg_Set_Items           = null
    trigger                 gg_trg_Set_FMi_Base        = null
    trigger                 gg_trg_Set_NPC             = null
    trigger                 gg_trg_Set_Drops           = null
    trigger                 gg_trg_Set_Etc             = null
    trigger                 gg_trg_Set_FAL             = null
    trigger                 gg_trg_Set_Monster         = null
    trigger                 gg_trg_Set_Party           = null
    trigger                 gg_trg_Setting_O_CreateMopAll = null
    trigger                 gg_trg_Set_GlobalChat      = null
    trigger                 gg_trg_Set_SignBar         = null
    trigger                 gg_trg_Set_Skin            = null
    trigger                 gg_trg_Quest_Set           = null
    trigger                 gg_trg_Custom_Script       = null
    trigger                 gg_trg_Config_Set          = null
    trigger                 gg_trg_ModifiedEvents      = null
    trigger                 gg_trg_Localtable          = null
    trigger                 gg_trg_JN_Object_Api       = null
    trigger                 gg_trg_JN_Load             = null
    trigger                 gg_trg_JN_NOTICE           = null
    trigger                 gg_trg_JN_OpLimit          = null
    trigger                 gg_trg_CustomStun          = null
    trigger                 gg_trg_RankEx              = null
    trigger                 gg_trg_DmgText             = null
    trigger                 gg_trg_Party_Intr_all      = null
    trigger                 gg_trg_FSE_Save            = null
    trigger                 gg_trg_FSE_Load            = null
    trigger                 gg_trg_FSE_Load2           = null
    trigger                 gg_trg_FSE_Save1           = null
    trigger                 gg_trg_FAL_Load1           = null
    trigger                 gg_trg_Instruction_All     = null
    trigger                 gg_trg_Use_Item            = null
    trigger                 gg_trg_Use_Item2           = null
    trigger                 gg_trg_Sys_Dmg_Add         = null
    trigger                 gg_trg_Sys_MT_Set          = null
    trigger                 gg_trg_Sys_Exp_Get         = null
    trigger                 gg_trg_Sys_Item_Drop       = null
    trigger                 gg_trg_Sys_Death_ALL       = null
    trigger                 gg_trg_Sys_Dmg_Manager_v6  = null
    trigger                 gg_trg_Sys_Create_Monster  = null
    trigger                 gg_trg_JN_Load_Complete2   = null
    trigger                 gg_trg_Intr_Stats          = null
    trigger                 gg_trg_Import              = null
    trigger                 gg_trg_EndGameHook         = null
    trigger                 gg_trg_MemoryLib           = null
    trigger                 gg_trg_Typecast            = null
    trigger                 gg_trg_FrameGrid           = null
    trigger                 gg_trg_Update_Callback     = null
    trigger                 gg_trg_FMi_Scope           = null
    trigger                 gg_trg_FMi_Hit_______u     = null
    trigger                 gg_trg_Quest_00_Note       = null
    trigger                 gg_trg_Inventory           = null
    trigger                 gg_trg_EquipSlot           = null
    trigger                 gg_trg_Mouse_In_Common     = null
    trigger                 gg_trg_Level_UP            = null
    trigger                 gg_trg_Select_Novice       = null
    trigger                 gg_trg_Selcet_N_TD         = null
    trigger                 gg_trg_Select_Skin         = null
    trigger                 gg_trg_Auto_Setting_1      = null
    trigger                 gg_trg_Sys_Gold_Drop       = null
    trigger                 gg_trg_Sys_Gold_Get        = null
    trigger                 gg_trg_Item_Drop_3         = null
    trigger                 gg_trg_Item_Drop_4         = null
    trigger                 gg_trg_Item_Drop_5         = null
    trigger                 gg_trg_Sys_NPC_No_Attack   = null
    trigger                 gg_trg_Item_Drop_2         = null
    trigger                 gg_trg_Sys_F9_Setup        = null
    trigger                 gg_trg_Sys_F9_Set          = null
    trigger                 gg_trg_Sys_Tip_Loop        = null
    trigger                 gg_trg_Sys_Player_Left     = null
    trigger                 gg_trg_Sys_NoPatroll       = null
    trigger                 gg_trg_Sys_NoShareUnit     = null
    trigger                 gg_trg_Sys_NoTeamKill      = null
    trigger                 gg_trg_Sys_Clear_Items     = null
    trigger                 gg_trg_Sys_Clear_Units     = null
    trigger                 gg_trg_Sys_Enter_Villeage  = null
    trigger                 gg_trg_Sys_Exit_Villeage   = null
    trigger                 gg_trg_Sys_Moving          = null
    trigger                 gg_trg_Sys_Dummy_Attacked  = null
    trigger                 gg_trg_Sys_Dummy_Rev       = null
    trigger                 gg_trg_Sys_Elk             = null
    trigger                 gg_trg_Sys_Elk_2           = null
    trigger                 gg_trg_Sys_Novis_Cow       = null
    trigger                 gg_trg_Sys_After_10m       = null
    trigger                 gg_trg_Sys_Boss1_Phase2    = null
    trigger                 gg_trg_Sys_Boss1_Phase3    = null
    trigger                 gg_trg_Sys_Boss1_Phase4    = null
    trigger                 gg_trg_Sys_Boss1_Phase4n2  = null
    trigger                 gg_trg_Sys_Boss1_Dead      = null
    trigger                 gg_trg_Sys_Bead_Dead       = null
    trigger                 gg_trg_Sys_Zombie_Boom     = null
    trigger                 gg_trg_Sys_Zombie_Revive   = null
    trigger                 gg_trg_Ct_6_Load_Error     = null
    trigger                 gg_trg_FMi_Click           = null
    trigger                 gg_trg_FMi_ESC             = null
    trigger                 gg_trg_FMi_Drag            = null
    trigger                 gg_trg_FCS_Start_Cst       = null
    trigger                 gg_trg_FCS_Stop_Cst        = null
    trigger                 gg_trg_FCS_End_Cst         = null
    trigger                 gg_trg_Exp_Exception       = null
    trigger                 gg_trg_SignBar_Drag        = null
    trigger                 gg_trg_SignBar_Drag2       = null
    trigger                 gg_trg_SignBar_Hit         = null
    trigger                 gg_trg_Solo_Add_skrt       = null
    trigger                 gg_trg_Solo_Exit_sorf      = null
    trigger                 gg_trg_Event_Buff          = null
    trigger                 gg_trg_Event_Buff2         = null
    trigger                 gg_trg_Event_Buff22        = null
    trigger                 gg_trg_Event_DailyCheck_bzbe = null
    trigger                 gg_trg_Event_DailyCheck2   = null
    trigger                 gg_trg_Event_DailyCheckState_mlst = null
    trigger                 gg_trg_Event_DailyCheckState2 = null
    trigger                 gg_trg_Item_Buy_Orens      = null
    trigger                 gg_trg_Move_Mine_Elevator  = null
    trigger                 gg_trg_Mine_Trade_Items_crdt_wneu_wneg = null
    trigger                 gg_trg_ReviveHero          = null
    trigger                 gg_trg_Give_Level_Up_rre2  = null
    trigger                 gg_trg_Give_Wood_engs      = null
    trigger                 gg_trg_Give_SkillMax_sbch  = null
    trigger                 gg_trg_BossBar             = null
    trigger                 gg_trg_Sys_ChangJob_A_ALL  = null
    trigger                 gg_trg_Sys_ChangJob_B_ALL  = null
    trigger                 gg_trg_Dialog_Miles_Temple = null
    trigger                 gg_trg_Dialog_Miles_Temple_2 = null
    trigger                 gg_trg_Buy_Skills_All      = null
    trigger                 gg_trg_AutoReaction_iii    = null
    trigger                 gg_trg_SQResqueDA007       = null
    trigger                 gg_trg_SWShortBlacdeA02F   = null
    trigger                 gg_trg_SW2WindBladeA00A    = null
    trigger                 gg_trg_SEMegaBladeA02P     = null
    trigger                 gg_trg_SQ2BatuDA02N        = null
    trigger                 gg_trg_SRHitarmsDA03R      = null
    trigger                 gg_trg_STRushA02A          = null
    trigger                 gg_trg_SQ3PyohoA09X        = null
    trigger                 gg_trg_SW3RuneBladeA09Y    = null
    trigger                 gg_trg_SE2StomeBladeA09Z   = null
    trigger                 gg_trg_SQSPierceDA02H      = null
    trigger                 gg_trg_SQPierceDA009       = null
    trigger                 gg_trg_SRAmunejiaDA00C     = null
    trigger                 gg_trg_SWDartThrowDA01J    = null
    trigger                 gg_trg_SEPierce2DA00F      = null
    trigger                 gg_trg_STAssaultDA03O      = null
    trigger                 gg_trg_SWAssassinateDA04J  = null
    trigger                 gg_trg_SR2RaidDA02U        = null
    trigger                 gg_trg_MQ1MTAPA008A020A021A022 = null
    trigger                 gg_trg_MW1RentoA01O        = null
    trigger                 gg_trg_ME1SuperaA025A026A027A028 = null
    trigger                 gg_trg_MF1VenomiA029       = null
    trigger                 gg_trg_MW2BardoA01V        = null
    trigger                 gg_trg_MQ2MTAPA02QA02WA02XA02Y = null
    trigger                 gg_trg_MRNarcolyA02T       = null
    trigger                 gg_trg_ME2XTAPA043A044A045A046 = null
    trigger                 gg_trg_MW3DeprecoA00J      = null
    trigger                 gg_trg_MQ3MTAPA03JA03LA03MA03N = null
    trigger                 gg_trg_MF2WISorumaDA07M    = null
    trigger                 gg_trg_MT1TAPA063A066A067A068 = null
    trigger                 gg_trg_MW4PraboA00ZA098    = null
    trigger                 gg_trg_MF3DeathA07Q        = null
    trigger                 gg_trg_MQ4QWERA07AA08IA08JA08K = null
    trigger                 gg_trg_MQ4ASemeliaA079     = null
    trigger                 gg_trg_ME3QWERA08BA08CA08DA08E = null
    trigger                 gg_trg_ME3AIAmagetdonA08F  = null
    trigger                 gg_trg_ME3AAmagetdonA08H   = null
    trigger                 gg_trg_ME4SSoommastellaA08G = null
    trigger                 gg_trg_MT2QWERA086A087A088A089 = null
    trigger                 gg_trg_MT2AIRagnarokA08A_A09E_A03I = null
    trigger                 gg_trg_MT2ARagnarokA03I    = null
    trigger                 gg_trg_MT3SIMeteorA05T     = null
    trigger                 gg_trg_MQCuroA00V          = null
    trigger                 gg_trg_MWDeRentoA024       = null
    trigger                 gg_trg_MEBellaA01N         = null
    trigger                 gg_trg_MW2DeBardoA02D      = null
    trigger                 gg_trg_MQ2CuranoA01Y       = null
    trigger                 gg_trg_MFCureceA01X        = null
    trigger                 gg_trg_MREnarmaA02Z        = null
    trigger                 gg_trg_MQ3CuranosoA030     = null
    trigger                 gg_trg_MW3DeDeprecaA04G    = null
    trigger                 gg_trg_MF2CuranuceA031     = null
    trigger                 gg_trg_MT1HolyShotA05V     = null
    trigger                 gg_trg_MT2HolyBoltA032     = null
    trigger                 gg_trg_MW4DePrabaA04H      = null
    trigger                 gg_trg_ME2SuBellaA059      = null
    trigger                 gg_trg_MZESmallBuffA09K    = null
    trigger                 gg_trg_MQ4SuCuranoA05D     = null
    trigger                 gg_trg_MF3CuraneraA05H     = null
    trigger                 gg_trg_MQ5XCuranoA074      = null
    trigger                 gg_trg_MF4XCuraneraA075    = null
    trigger                 gg_trg_MQ6HCuranoA002      = null
    trigger                 gg_trg_MT2HdragonA01U      = null
    trigger                 gg_trg_SQDangakDA00X       = null
    trigger                 gg_trg_SWJumpA00Y          = null
    trigger                 gg_trg_SEBunggakDA01L      = null
    trigger                 gg_trg_SRSeonpoongA035     = null
    trigger                 gg_trg_STbaekboDA02M       = null
    trigger                 gg_trg_SFQTongbaeA01KA07Y  = null
    trigger                 gg_trg_SFEBalGyengDA081A082 = null
    trigger                 gg_trg_SFRSosuA04UA04X     = null
    trigger                 gg_trg_SFADalmaA037A04V    = null
    trigger                 gg_trg_SFSGuyangA07V       = null
    trigger                 gg_trg_SW2Jump2A05U        = null
    trigger                 gg_trg_CurotoA010          = null
    trigger                 gg_trg_SDQlTwohandAttackA03PA04N = null
    trigger                 gg_trg_SDWlDragonModeA03SA06D = null
    trigger                 gg_trg_SDElDefallA06CA06J  = null
    trigger                 gg_trg_SDRIMadA06KA03C     = null
    trigger                 gg_trg_SDAICratherA03EA06X = null
    trigger                 gg_trg_SDWIPhoenixModeA0A2A0A3 = null
    trigger                 gg_trg_MDRlConcentrationA0A5 = null
    trigger                 gg_trg_SDRIMad2A0A8A0A9    = null
    trigger                 gg_trg_SDAIDevilCratherA0AB = null
    trigger                 gg_trg_MDQlLightningMoveA038 = null
    trigger                 gg_trg_MDWlHideA04I        = null
    trigger                 gg_trg_MDWlCensusA04R      = null
    trigger                 gg_trg_MDQlCuraltumA033    = null
    trigger                 gg_trg_MDWlColamaA03T      = null
    trigger                 gg_trg_MDElLocameaA05B     = null
    trigger                 gg_trg_MDRlLichmanaA05G    = null
    trigger                 gg_trg_MDAlHorramaA05N     = null
    trigger                 gg_trg_MDSlImmortalA05Q    = null
    trigger                 gg_trg_MDFIReflectoA07G    = null
    trigger                 gg_trg_MDZIReberatoA08Y    = null
    trigger                 gg_trg_MDXIComadiaA090     = null
    trigger                 gg_trg_MDWlMisngA03B       = null
    trigger                 gg_trg_MDElMovingUpA03A    = null
    trigger                 gg_trg_MDRlIronSkinA04C    = null
    trigger                 gg_trg_MDAlHameA051        = null
    trigger                 gg_trg_MDSlAdamantineA053  = null
    trigger                 gg_trg_MDDlCuranotoA055    = null
    trigger                 gg_trg_MDFlReflectionA06B  = null
    trigger                 gg_trg_MDZlDaraA07D        = null
    trigger                 gg_trg_MDDCurotoA03G       = null
    trigger                 gg_trg_SDQTwohandAttackA04N = null
    trigger                 gg_trg_SDWDragonModeA06D   = null
    trigger                 gg_trg_SDEDefallA06J       = null
    trigger                 gg_trg_SDRMadA03C          = null
    trigger                 gg_trg_MDQLightningMoveA04M = null
    trigger                 gg_trg_MDWHideA04Q         = null
    trigger                 gg_trg_MDWColamaA05A       = null
    trigger                 gg_trg_MDAHorramaA05O      = null
    trigger                 gg_trg_MDWMisngA03K        = null
    trigger                 gg_trg_MDEMovingUpA03Y     = null
    trigger                 gg_trg_MDRIronSkinA04W     = null
    trigger                 gg_trg_MDAHameA052         = null
    trigger                 gg_trg_MDSAdamantineA054   = null
    trigger                 gg_trg_MDDCuranotoA06A     = null
    trigger                 gg_trg_MDFReflectionA07C   = null
    trigger                 gg_trg_Intr_Infomation     = null
    trigger                 gg_trg_Intr_AddInven       = null
    trigger                 gg_trg_Intr_Field_of_View  = null
    trigger                 gg_trg_Intr_Newbie         = null
    trigger                 gg_trg_Intr_Tip_off        = null
    trigger                 gg_trg_Intr_Dice           = null
    trigger                 gg_trg_Intr_Inventory      = null
    trigger                 gg_trg_Intr_Version        = null
    trigger                 gg_trg_Intr_Jobs           = null
    trigger                 gg_trg_Intr_Replay         = null
    trigger                 gg_trg_Intr_HPMP           = null
    trigger                 gg_trg_Intr_Circle         = null
    trigger                 gg_trg_Intr_Recall         = null
    trigger                 gg_trg_Intr_Quust          = null
    trigger                 gg_trg_Intr_Stat           = null
    trigger                 gg_trg_Intr_Field          = null
    trigger                 gg_trg_Intr_Exp            = null
    trigger                 gg_trg_Intr_Q_Skip         = null
    trigger                 gg_trg_Intr_Q_Speed        = null
    trigger                 gg_trg_Intr_Skill          = null
    trigger                 gg_trg_Intr_FixCam         = null
    trigger                 gg_trg_Intr_Love_fooiff    = null
    trigger                 gg_trg_Intr_Link           = null
    trigger                 gg_trg_Intr_Reset          = null
    trigger                 gg_trg_Intr_Type_HPMP      = null
    trigger                 gg_trg_Intr_Title          = null
    trigger                 gg_trg_Intr_AutoStat       = null
    trigger                 gg_trg_Intr_Cafe           = null
    trigger                 gg_trg_Intr_MTSmall        = null
    trigger                 gg_trg_Intr_Effect_Off     = null
    trigger                 gg_trg_Intr_MapLevelUp     = null
    trigger                 gg_trg_Intr_Skin           = null
    trigger                 gg_trg_Intr_Camera         = null
    trigger                 gg_trg_Intr_ReTitle        = null
    trigger                 gg_trg_Intr_Debug          = null
    trigger                 gg_trg_Intr_Test           = null
    trigger                 gg_trg_Sys_DebugDmg        = null
    trigger                 gg_trg_Sys_DebugSelect     = null
    trigger                 gg_trg_Intr_ResetQuest     = null
    trigger                 gg_trg_Intr_Suicide        = null
    trigger                 gg_trg_Quest_Type_All      = null
    trigger                 gg_trg_Quest_Attack        = null
    trigger                 gg_trg_Quest_00_47_B       = null
    trigger                 gg_trg_Quest_01            = null
    trigger                 gg_trg_Quest_02            = null
    trigger                 gg_trg_Quest_02_B          = null
    trigger                 gg_trg_Quest_03            = null
    trigger                 gg_trg_Quest_03_B          = null
    trigger                 gg_trg_Quest_03_D          = null
    trigger                 gg_trg_Quest_04            = null
    trigger                 gg_trg_Quest_04_B          = null
    trigger                 gg_trg_Quest_05            = null
    trigger                 gg_trg_Quest_05_D1         = null
    trigger                 gg_trg_Quest_05_D2         = null
    trigger                 gg_trg_Quest_05_D3_Check   = null
    trigger                 gg_trg_Quest_05_D4_Makes   = null
    trigger                 gg_trg_Quest_05_D5_Wait    = null
    trigger                 gg_trg_Quest_05_D6_Make    = null
    trigger                 gg_trg_Quest_05_E2_Kill    = null
    trigger                 gg_trg_Quest_05_E3_DmgSave = null
    trigger                 gg_trg_Quest_05_E4_Cinema  = null
    trigger                 gg_trg_Quest_05_F_Attacked = null
    trigger                 gg_trg_Quest_06            = null
    trigger                 gg_trg_Quest_06_B          = null
    trigger                 gg_trg_Quest_07            = null
    trigger                 gg_trg_Quest_07_B          = null
    trigger                 gg_trg_Quest_08            = null
    trigger                 gg_trg_Quest_08_B          = null
    trigger                 gg_trg_Quest_09            = null
    trigger                 gg_trg_Quest_09_B          = null
    trigger                 gg_trg_Quest_10            = null
    trigger                 gg_trg_Quest_11            = null
    trigger                 gg_trg_Quest_12            = null
    trigger                 gg_trg_Quest_12_B          = null
    trigger                 gg_trg_Quest_13            = null
    trigger                 gg_trg_Quest_13_B          = null
    trigger                 gg_trg_Quest_14            = null
    trigger                 gg_trg_Quest_14_B          = null
    trigger                 gg_trg_Quest_15            = null
    trigger                 gg_trg_Quest_15_D_BuyItems = null
    trigger                 gg_trg_Quest_15_Loop       = null
    trigger                 gg_trg_Quest_15_Enter_Mob  = null
    trigger                 gg_trg_Quest_15_Dead_Mob   = null
    trigger                 gg_trg_Quest_16_Mine       = null
    trigger                 gg_trg_Quest_16_B          = null
    trigger                 gg_trg_Boss_Mildun         = null
    trigger                 gg_trg_FMi_Internal        = null
    trigger                 gg_trg_Intr_Quest_Helper   = null
    trigger                 gg_trg_Item87AIlu          = null
    trigger                 gg_trg_Item81A015          = null
    trigger                 gg_trg_Item45A014          = null
    trigger                 gg_trg_Item_fooiffs_Buff   = null
    trigger                 gg_trg_Item_RecallAll      = null
    trigger                 gg_trg_Item_Comax10dtsbdrph = null
    trigger                 gg_trg_Item_Hornshea       = null
    trigger                 gg_trg_Item_Boss1lmbr      = null
    trigger                 gg_trg_Item_Move1Wood1shwd = null
    trigger                 gg_trg_Item_Move1Wood2rma2 = null
    trigger                 gg_trg_Item_Move1Wood3rej1 = null
    trigger                 gg_trg_Item_Move_Graves1tels = null
    trigger                 gg_trg_Item_Move_Graves2gobm = null
    trigger                 gg_trg_Item_Move_fote_nflg = null
    trigger                 gg_trg_Item_Move_bitch_shdt = null
    trigger                 gg_trg_Item_Move_harmony_ram3 = null
    trigger                 gg_trg_Item_Move_Horr_pnvu = null
    trigger                 gg_trg_Item_Move_Mine_mgtk = null
    trigger                 gg_trg_Item_Move_DeadVilleage_dthb = null
    trigger                 gg_trg_Rect_Floor_Up       = null
    trigger                 gg_trg_Rect_Mine_Exit      = null
    trigger                 gg_trg_Skill_SkillCheckA01D = null
    trigger                 gg_trg_Skill_SkillLearnA01E = null
    trigger                 gg_trg_Skill_StateAddALL   = null
    trigger                 gg_trg_Skill_Reset         = null
    trigger                 gg_trg_Skill_EatItemsA039  = null
    trigger                 gg_trg_Skill_AutoSaveA05J  = null
    trigger                 gg_trg_Skill_FooiffBuffA05L = null
    trigger                 gg_trg_Skill_ComadiumI08V  = null
    trigger                 gg_trg_Moving_Harmonious_1 = null
    trigger                 gg_trg_Moving_Harmonious_2 = null
    trigger                 gg_trg_UTextSet            = null
    trigger                 gg_trg_Set_Test            = null
    trigger                 gg_trg_Intr_cheat_2        = null
    trigger                 gg_trg_Intr_Cheat          = null
    trigger                 gg_trg_Intr_Gotcha         = null
    trigger                 gg_trg_Intr_nick           = null
    trigger                 gg_trg_Intr_Newbie_Quest   = null
    trigger                 gg_trg_Type_2_Title        = null
    trigger                 gg_trg_Type_3_value        = null
    trigger                 gg_trg_Type_4              = null
    trigger                 gg_trg_Type_6_hp           = null
    trigger                 gg_trg_Type_7_mp           = null
    trigger                 gg_trg_Type_8              = null
    trigger                 gg_trg_Type_11             = null
    trigger                 gg_trg_Type_14             = null
    trigger                 gg_trg_Type_20             = null
    trigger                 gg_trg_Type_Skill2         = null
    trigger                 gg_trg_Type_Lv             = null
    unit                    gg_unit_nbsw_0187          = null
    unit                    gg_unit_e019_0374          = null
    unit                    gg_unit_H017_0002          = null
    unit                    gg_unit_hmtm_0369          = null
    unit                    gg_unit_nhef_0373          = null
    unit                    gg_unit_H01A_0107          = null
    unit                    gg_unit_H01B_0111          = null
    unit                    gg_unit_Harf_0372          = null
    unit                    gg_unit_nbsw_0186          = null
    unit                    gg_unit_H002_0322          = null
    unit                    gg_unit_H003_0323          = null
    unit                    gg_unit_n02T_0204          = null
    unit                    gg_unit_hhes_0203          = null
    unit                    gg_unit_hfoo_0202          = null
    unit                    gg_unit_n02S_0195          = null
    unit                    gg_unit_h00I_0201          = null
    unit                    gg_unit_n02P_0193          = null
    unit                    gg_unit_u002_0192          = null
    unit                    gg_unit_u001_0191          = null
    unit                    gg_unit_H006_0326          = null
    unit                    gg_unit_H005_0325          = null
    unit                    gg_unit_u000_0190          = null
    unit                    gg_unit_H004_0324          = null
    unit                    gg_unit_n000_0018          = null
    unit                    gg_unit_nvlk_0188          = null
    unit                    gg_unit_e011_0236          = null
    unit                    gg_unit_e011_0228          = null
    unit                    gg_unit_e011_0224          = null
    unit                    gg_unit_e011_0223          = null
    unit                    gg_unit_e011_0222          = null
    unit                    gg_unit_e011_0221          = null
    unit                    gg_unit_e011_0220          = null
    unit                    gg_unit_e011_0219          = null
    unit                    gg_unit_e011_0211          = null
    unit                    gg_unit_e011_0210          = null
    unit                    gg_unit_e011_0209          = null
    unit                    gg_unit_e011_0229          = null
    unit                    gg_unit_e011_0231          = null
    unit                    gg_unit_e011_0232          = null
    unit                    gg_unit_e011_0233          = null
    unit                    gg_unit_e011_0235          = null
    unit                    gg_unit_H01D_0110          = null
    unit                    gg_unit_H019_0113          = null
    unit                    gg_unit_nvil_0117          = null
    unit                    gg_unit_e00A_0041          = null
    unit                    gg_unit_H01C_0109          = null
    unit                    gg_unit_Hkal_0069          = null
    unit                    gg_unit_Hpal_0121          = null
    unit                    gg_unit_nbse_0176          = null
    unit                    gg_unit_nbsw_0184          = null
    unit                    gg_unit_nbse_0180          = null
    unit                    gg_unit_nbse_0181          = null
    unit                    gg_unit_nbsw_0179          = null
    unit                    gg_unit_nbsw_0185          = null
    unit                    gg_unit_nbse_0182          = null
    unit                    gg_unit_nbse_0183          = null
    unit                    gg_unit_efdr_0197          = null
    unit                    gg_unit_Hmkg_0135          = null
    unit                    gg_unit_o00I_0214          = null
    unit                    gg_unit_Hmbr_0207          = null
    unit                    gg_unit_Hgam_0174          = null
    destructable            gg_dest_B006_2390          = null
    destructable            gg_dest_B006_0001          = null
    destructable            gg_dest_B006_2404          = null
    destructable            gg_dest_B006_2405          = null
    destructable            gg_dest_B006_2409          = null
endglobals

function InitGlobals takes nothing returns nothing
    local integer i = 0
    set udg_temp_pg = CreateForce()
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Unit[i] = null
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysB_Name[i] = ""
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SavedString[i] = ""
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysB_Level[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Save_HP[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Save_MP[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysE_WIS1[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysE_STR1[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysE_CON1[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysE_DEX1[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysE_INT1[i] = 0
        set i = i + 1
    endloop

    set udg_MT_TimerHou = 0
    set udg_MT_TimerMin = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Save_Code[i] = ""
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_PartyNumber_ThisP[i] = 0
        set i = i + 1
    endloop

    set udg_temp_tr = null
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysC_Armor_B[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysC_Armor[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysE_CON3[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysE_CON2[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysE_DEX3[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysE_DEX2[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysE_INT3[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysE_INT2[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysE_STR3[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysE_STR2[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysE_WIS3[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysE_WIS2[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysC_DmgAttack[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_FSE_it[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysC_Hits[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysC_CriP[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysC_CriX[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysC_Dam[i] = 0
        set i = i + 1
    endloop

    set udg_temp_i = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysC_Regen[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Save_Code2[i] = ""
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Save_Count[i] = 0
        set i = i + 1
    endloop

    set udg_temp_b = false
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_FSE_Skill[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_FSE_SkillData[i] = ""
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_00_Note[i] = 0
        set i = i + 1
    endloop

    set udg_temp_s = ""
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Save_CodeOri[i] = ""
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Save_CodeOri2[i] = ""
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Save_CodeOri3[i] = ""
        set i = i + 1
    endloop

    set udg_temp_g = CreateGroup()
    set udg_temp_r = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_PartyNumber_pP[i] = 0
        set i = i + 1
    endloop

    set udg_PartyGoldGroup = CreateGroup()
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_OnesPositionN[i] = 0
        set i = i + 1
    endloop

    set udg_SysJ_Count = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysC_MissMagic[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysC_DmgNow[i] = ""
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysC_AC_R[i] = 0
        set i = i + 1
    endloop

    set udg_temp_rg = CreateRegion()
    set udg_temp_i2 = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_00_NumberAt[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_Boolean_B[i] = false
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_PartyTitle[i] = ""
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysK_ExpAdd[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysK_DropAdd[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysK_Drop[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysK_Exp[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Party_Invite[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Party_InviteTake[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_WaitTime[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_07_Num_Hohen[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_08_Num_Lama[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_10_Num_Honey[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_11_Num_Propose[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_15_Num_Farmer[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_17_Num_Bear[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_ClearInt_17[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_20_Num_Soldier[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_ClearInt_20[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_21_Num_Mount[i] = 0
        set i = i + 1
    endloop

    set udg_Quest_26_Num_Mgcion = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_23_Num_Horror[i] = 0
        set i = i + 1
    endloop

    set udg_Quest_24_Num_Oren = 0
    set udg_Quest_27_Num_Master = 0
    set udg_temp_ab = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysL_Level[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysL_Exp[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysL_STR[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysL_INT[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysL_WIS[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysL_CON[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysL_Wood[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysL_DEX[i] = 0
        set i = i + 1
    endloop

    set udg_temp_d = DialogCreate()
    set udg_SysA_Item = false
    set udg_MT_TimerSec = 0
    set udg_SysD_drop_i = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysD_dropMonsterType[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysD_dropMonN[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysD_dropItems[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysD_dropItemN[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysD_dropPb[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysC_HealAdd[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysK_GoldAdd[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysC_PotAdd[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_SkipWait[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysC_DmgAttackAdd[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysC_AtkSpdDEX[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_Save[i] = ""
        set i = i + 1
    endloop

    set udg_temp_trg = CreateTrigger()
    set udg_Quest_Force_05 = CreateForce()
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_ClearInt_07[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_ClearInt_08[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_ClearInt_09[i] = 0
        set i = i + 1
    endloop

    set udg_SysK_TEST = false
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysK_Gold[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysC_AtkSpdAdd[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysI_Xtical[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysO_CamDis[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysO_CamUnit[i] = false
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysI_Exct[i] = false
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysK_SellAdd[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysK_BuffAdd[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysB_Title[i] = ""
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysB_TitleNow[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysB_NameChange[i] = ""
        set i = i + 1
    endloop

    set udg_SysA_COUNT = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_ClearInt_00_47[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysC_ArmorM[i] = 0
        set i = i + 1
    endloop

    set udg_temp_r2 = 0
    set udg_SYSTEM_MineFloor = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_ClearInt_12[i] = 0
        set i = i + 1
    endloop

    set udg_SysA_ReloadEnd = false
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Quest_ClearInt_13[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysB_Setting[i] = ""
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysI_WoriorPeculiarity[i] = 0
        set i = i + 1
    endloop

    set udg_SysA_EffectSimple = false
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysI_NowJob[i] = 0
        set i = i + 1
    endloop

    set udg_SysA_MapLevel = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysB_SkinOX[i] = ""
        set i = i + 1
    endloop

    set udg_SysA_AddValue = 0
    set udg_Quest_ClearInt_14 = 0
    set udg_Quest_ClearInt_14_2 = 0
    set udg_Quest_ClearInt_15 = 0
    set udg_Quest_ClearInt_15_Wait2X = false
    set udg_Quest_ClearInt_15_Timer = CreateTimer()
    set udg_Quest_ClearInt_15_count = 0
    set udg_Quest_ClearInt_15_mob = 0
    set udg_Quest_ClearInt_15_Hard = false
    set udg_Quest_ClearInt_15_Explosion = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysI_MinusRegen[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysI_Dragon[i] = false
        set i = i + 1
    endloop

    set udg_Quest_ClearInt_16 = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_SysI_PreJob[i] = 0
        set i = i + 1
    endloop

    set udg_SYSTEM_isCri = false
    set udg_SYSTEM_DamgeColor = ""
    set udg_SYSTEM_isPot = false
endfunction

//***************************************************************************
//*
//*  Sounds
//*
//***************************************************************************

function InitSounds takes nothing returns nothing
    set gg_snd_GoodJob = CreateSound( "Sound\\Interface\\GoodJob.wav", false, false, false, 10, 10, "" )
    call SetSoundParamsFromLabel( gg_snd_GoodJob, "GoodJob" )
    call SetSoundDuration( gg_snd_GoodJob, 2548 )
    set gg_snd_MapPing = CreateSound( "Sound\\Interface\\MapPing.wav", false, false, false, 10, 10, "" )
    call SetSoundParamsFromLabel( gg_snd_MapPing, "MapPing" )
    call SetSoundDuration( gg_snd_MapPing, 1637 )
    set gg_snd_point = CreateSound( "Abilities\\Spells\\Human\\ManaFlare\\ManaFlareLoop.wav", false, true, true, 10, 10, "SpellsEAX" )
    call SetSoundParamsFromLabel( gg_snd_point, "ManaFlareLoop" )
    call SetSoundDuration( gg_snd_point, 2771 )
    set gg_snd_QuestNew = CreateSound( "Sound\\Interface\\QuestNew.wav", false, false, false, 10, 10, "" )
    call SetSoundParamsFromLabel( gg_snd_QuestNew, "QuestNew" )
    call SetSoundDuration( gg_snd_QuestNew, 3750 )
    set gg_snd_TheHornOfCenarius = CreateSound( "Sound\\Ambient\\DoodadEffects\\TheHornOfCenarius.wav", false, false, false, 10, 10, "DefaultEAXON" )
    call SetSoundParamsFromLabel( gg_snd_TheHornOfCenarius, "HornOfCenariusSound" )
    call SetSoundDuration( gg_snd_TheHornOfCenarius, 12121 )
    set gg_snd_15 = "war3mapImported\\15.mp3"
    set gg_snd_StoneBridgeRise = CreateSound( "Sound\\Ambient\\DoodadEffects\\StoneBridgeRise.wav", false, true, true, 10, 10, "DefaultEAXON" )
    call SetSoundParamsFromLabel( gg_snd_StoneBridgeRise, "RisingStoneBridge" )
    call SetSoundDuration( gg_snd_StoneBridgeRise, 4000 )
    set gg_snd_FacelessOneYes1 = CreateSound( "Units\\Creeps\\FacelessOne\\FacelessOneYes1.wav", false, false, true, 10, 10, "DefaultEAXON" )
    call SetSoundChannel( gg_snd_FacelessOneYes1, 0 )
    call SetSoundVolume( gg_snd_FacelessOneYes1, 127 )
    call SetSoundPitch( gg_snd_FacelessOneYes1, 1.0 )
    set gg_snd_45 = "war3mapImported\\45.mp3"
    set gg_snd_24 = "war3mapImported\\24.mp3"
    set gg_snd_40 = "war3mapImported\\40.mp3"
    set gg_snd_67 = "war3mapImported\\67.mp3"
    set gg_snd_48 = "war3mapImported\\48.mp3"
    set gg_snd_ItemDrop = CreateSound( "Sound\\Interface\\HeroDropItem1.wav", false, false, true, 10, 10, "DefaultEAXON" )
    call SetSoundParamsFromLabel( gg_snd_ItemDrop, "ItemDrop" )
    call SetSoundDuration( gg_snd_ItemDrop, 486 )
    set gg_snd_ItemSale = CreateSound( "Sound\\Interface\\ItemReceived.wav", false, false, false, 10, 10, "DefaultEAXON" )
    call SetSoundParamsFromLabel( gg_snd_ItemSale, "ItemReward" )
    call SetSoundDuration( gg_snd_ItemSale, 1483 )
    set gg_snd_ItemDrop01 = CreateSound( "war3mapImported\\ItemDrop.mp3", false, false, false, 10, 10, "" )
    call SetSoundDuration( gg_snd_ItemDrop01, 1384 )
    call SetSoundChannel( gg_snd_ItemDrop01, 0 )
    call SetSoundVolume( gg_snd_ItemDrop01, 127 )
    call SetSoundPitch( gg_snd_ItemDrop01, 1.0 )
    set gg_snd_GemDrop = CreateSound( "war3mapImported\\GemDrop.mp3", false, false, false, 10, 10, "" )
    call SetSoundDuration( gg_snd_GemDrop, 1541 )
    call SetSoundChannel( gg_snd_GemDrop, 0 )
    call SetSoundVolume( gg_snd_GemDrop, 127 )
    call SetSoundPitch( gg_snd_GemDrop, 1.0 )
    set gg_snd_ExcuDrop = CreateSound( "war3mapImported\\ExcuDrop.wav", false, false, false, 10, 10, "" )
    call SetSoundDuration( gg_snd_ExcuDrop, 886 )
    call SetSoundChannel( gg_snd_ExcuDrop, 0 )
    call SetSoundVolume( gg_snd_ExcuDrop, 127 )
    call SetSoundPitch( gg_snd_ExcuDrop, 1.0 )
    set gg_snd_HeartBeat = CreateSound( "war3mapImported\\HeartBeat.MP3", false, false, false, 10, 10, "" )
    call SetSoundDuration( gg_snd_HeartBeat, 10608 )
    call SetSoundChannel( gg_snd_HeartBeat, 0 )
    call SetSoundVolume( gg_snd_HeartBeat, 127 )
    call SetSoundPitch( gg_snd_HeartBeat, 1.0 )
    set gg_snd_3 = "war3mapImported\\3.mp3"
    set gg_snd_4 = "war3mapImported\\4.mp3"
endfunction

//***************************************************************************
//*
//*  Destructable Objects
//*
//***************************************************************************

function CreateAllDestructables takes nothing returns nothing
    local destructable d
    local trigger t
    local real life
    set gg_dest_B006_0001 = CreateDestructable( 'B006', 8512.0, -19392.0, 298.000, 2.856, 0 )
    set gg_dest_B006_2404 = CreateDestructable( 'B006', 7552.0, -19712.0, 18.000, 2.593, 2 )
    set gg_dest_B006_2405 = CreateDestructable( 'B006', 6848.0, -19008.0, 13.967, 3.280, 1 )
    set gg_dest_B006_2409 = CreateDestructable( 'B006', 7232.0, -18112.0, 299.000, 2.978, 0 )
    set gg_dest_B006_2390 = CreateDestructable( 'B006', 8384.0, -18304.0, 274.000, 2.400, 2 )
endfunction

//***************************************************************************
//*
//*  Unit Creation
//*
//***************************************************************************

//===========================================================================
function CreateNeutralHostile takes nothing returns nothing
    local player p = Player(PLAYER_NEUTRAL_AGGRESSIVE)
    local unit u
    local integer unitID
    local trigger t
    local real life

    set u = CreateUnit( p, 'o001', 2579.3, -7904.5, 245.656 )
    set u = CreateUnit( p, 'o001', 2330.7, -7908.0, 321.219 )
    set u = CreateUnit( p, 'o001', 17755.1, -19277.3, 293.992 )
    set u = CreateUnit( p, 'n04U', 29659.1, -16463.9, 180.423 )
    set u = CreateUnit( p, 'o001', -349.8, -11849.9, 12.610 )
    set u = CreateUnit( p, 'o001', -366.7, -11318.7, 245.656 )
    set u = CreateUnit( p, 'n04V', 28682.9, -18977.1, 54.749 )
    set u = CreateUnit( p, 'n04W', 28835.4, -18935.4, 158.301 )
    set u = CreateUnit( p, 'n04X', 28737.5, -18793.3, 271.041 )
    set u = CreateUnit( p, 'n04V', 29292.0, -18495.9, 54.749 )
    set u = CreateUnit( p, 'n04W', 29444.5, -18454.2, 158.301 )
    set u = CreateUnit( p, 'n04X', 29346.6, -18312.1, 271.041 )
    set u = CreateUnit( p, 'o001', -358.6, -11554.8, 321.595 )
    set u = CreateUnit( p, 'n04V', 28827.1, -17702.0, 54.749 )
    set u = CreateUnit( p, 'n04W', 28979.6, -17660.3, 158.301 )
    set u = CreateUnit( p, 'n04X', 28881.7, -17518.2, 271.041 )
    set u = CreateUnit( p, 'n04V', 28173.0, -17246.4, 54.749 )
    set u = CreateUnit( p, 'n04W', 28325.5, -17204.7, 158.301 )
    set u = CreateUnit( p, 'n04X', 28227.6, -17062.6, 271.041 )
    set u = CreateUnit( p, 'n04V', 28602.3, -16666.1, 54.749 )
    set u = CreateUnit( p, 'n04W', 28754.8, -16624.4, 158.301 )
    set u = CreateUnit( p, 'n04X', 28656.9, -16482.3, 271.041 )
    set u = CreateUnit( p, 'o001', 27809.1, -29721.7, 46.985 )
    set u = CreateUnit( p, 'o001', 28090.7, -29721.7, 90.790 )
    set u = CreateUnit( p, 'o001', 28372.3, -29721.7, 133.849 )
    set u = CreateUnit( p, 'o001', 28372.9, -29443.2, 176.217 )
    set u = CreateUnit( p, 'o001', 28372.8, -29161.5, 222.546 )
    set u = CreateUnit( p, 'o001', 28091.3, -29161.5, 268.988 )
    set u = CreateUnit( p, 'o001', 27809.7, -29161.5, 316.513 )
    set u = CreateUnit( p, 'o001', 27809.7, -29443.2, 3.910 )
    set u = CreateUnit( p, 'o001', 28091.3, -29443.2, 103.854 )
endfunction

//===========================================================================
function CreateNeutralPassiveBuildings takes nothing returns nothing
    local player p = Player(PLAYER_NEUTRAL_PASSIVE)
    local unit u
    local integer unitID
    local trigger t
    local real life

    set gg_unit_o00I_0214 = CreateUnit( p, 'o00I', 21760.0, -12608.0, 270.000 )
endfunction

//===========================================================================
function CreateNeutralPassive takes nothing returns nothing
    local player p = Player(PLAYER_NEUTRAL_PASSIVE)
    local unit u
    local integer unitID
    local trigger t
    local real life

    set u = CreateUnit( p, 'e01A', 28874.8, -22346.5, 144.793 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set gg_unit_H017_0002 = CreateUnit( p, 'H017', 28879.8, -22352.6, 238.709 )
    call SetUnitState( gg_unit_H017_0002, UNIT_STATE_MANA, 0 )
    call SetUnitColor( gg_unit_H017_0002, ConvertPlayerColor(0) )
    set u = CreateUnit( p, 'n00L', -1898.8, -9001.5, 212.025 )
    set u = CreateUnit( p, 'h00L', -2435.4, -11565.7, 322.383 )
    set u = CreateUnit( p, 'n04Z', 400.1, -19983.4, 322.576 )
    set u = CreateUnit( p, 'n050', 507.7, -19994.3, 158.362 )
    set gg_unit_n000_0018 = CreateUnit( p, 'n000', 5121.7, -17169.7, 65.181 )
    set u = CreateUnit( p, 'n04Y', 25.3, -20319.7, 338.812 )
    set u = CreateUnit( p, 'n04Z', -103.4, -19521.7, 226.412 )
    set u = CreateUnit( p, 'n050', 498.7, -20075.9, 158.362 )
    set u = CreateUnit( p, 'n04Y', -280.4, -20199.1, 209.203 )
    set u = CreateUnit( p, 'ndog', -756.4, -19571.2, 252.069 )
    set u = CreateUnit( p, 'n051', -791.1, -19607.6, 309.781 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'n052', 3587.3, -15268.8, 269.272 )
    set u = CreateUnit( p, 'nvlw', -646.7, -17378.3, 334.416 )
    set u = CreateUnit( p, 'nvlw', -591.3, -17315.9, 272.613 )
    set u = CreateUnit( p, 'n053', 802.9, -16950.6, 239.480 )
    set u = CreateUnit( p, 'n052', 3621.1, -15327.8, 85.246 )
    set u = CreateUnit( p, 'n052', 917.1, -19654.6, 159.120 )
    set u = CreateUnit( p, 'n052', 842.5, -19620.8, 243.904 )
    set u = CreateUnit( p, 'nchp', 2060.1, -13722.2, 312.626 )
    set u = CreateUnit( p, 'nchp', 3116.6, -11992.6, 51.696 )
    set u = CreateUnit( p, 'nchp', 2849.6, -11095.8, 35.990 )
    set u = CreateUnit( p, 'n052', -503.2, -16983.4, 269.272 )
    set u = CreateUnit( p, 'n052', -469.4, -17042.4, 85.246 )
    set u = CreateUnit( p, 'ndog', 132.5, -17083.9, 252.069 )
    set u = CreateUnit( p, 'h00B', 915.6, -8105.2, 270.859 )
    set u = CreateUnit( p, 'nchp', -541.0, -11142.0, 123.026 )
    set u = CreateUnit( p, 'nwat', 25695.3, -28618.7, 245.630 )
    set gg_unit_e00A_0041 = CreateUnit( p, 'e00A', 28846.6, -22802.9, 270.000 )
    set u = CreateUnit( p, 'n052', 3657.6, -15023.4, 162.734 )
    set u = CreateUnit( p, 'n052', 3656.2, -15272.0, 162.734 )
    set u = CreateUnit( p, 'n052', 3598.7, -15370.6, 162.734 )
    set u = CreateUnit( p, 'npig', 13210.1, -6014.5, 250.254 )
    set u = CreateUnit( p, 'npig', 13239.8, -6130.6, 32.081 )
    set u = CreateUnit( p, 'h00E', 393.5, -8141.2, 273.739 )
    set u = CreateUnit( p, 'negz', -2573.1, -7687.5, 272.310 )
    set u = CreateUnit( p, 'n052', 4635.7, -17578.3, 162.734 )
    set u = CreateUnit( p, 'n052', 4599.7, -17641.1, 162.734 )
    set u = CreateUnit( p, 'ndog', 4163.3, -17473.7, 252.069 )
    set u = CreateUnit( p, 'ndog', 2161.0, -8688.6, 282.063 )
    set u = CreateUnit( p, 'npig', 13233.4, -6181.2, 243.750 )
    set u = CreateUnit( p, 'nvl2', 857.3, -17007.5, 121.558 )
    set u = CreateUnit( p, 'nvlk', -943.4, -17236.3, 350.767 )
    set u = CreateUnit( p, 'nvk2', -866.8, -17249.7, 163.804 )
    set u = CreateUnit( p, 'nvlk', -628.5, -19992.2, 170.353 )
    set u = CreateUnit( p, 'nvk2', -552.3, -20028.5, 163.208 )
    set u = CreateUnit( p, 'nvl2', 3374.5, -16191.4, 9.083 )
    set u = CreateUnit( p, 'n02U', 4263.9, -16684.4, 195.212 )
    set u = CreateUnit( p, 'nvlk', 4466.4, -16703.2, 14.458 )
    set u = CreateUnit( p, 'nvl2', 4665.0, -17016.4, 186.164 )
    set u = CreateUnit( p, 'nvk2', 4140.2, -17533.4, 63.635 )
    set u = CreateUnit( p, 'n02U', 4535.5, -17582.6, 218.914 )
    set u = CreateUnit( p, 'nvl2', 3730.6, -16631.0, 142.927 )
    set u = CreateUnit( p, 'e01B', -868.4, -19414.3, 163.536 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'ndog', 849.0, -9506.0, 282.063 )
    set u = CreateUnit( p, 'ndog', 554.6, -8385.0, 282.063 )
    set gg_unit_Hkal_0069 = CreateUnit( p, 'Hkal', 15863.1, -18912.3, 284.324 )
    set u = CreateUnit( p, 'e01B', 4073.0, -14876.8, 11.712 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'e01B', 2718.8, -16149.3, 29.082 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'e01B', 2365.8, -16468.7, 157.384 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'e01B', -869.7, -16984.2, 127.654 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'e01B', -591.6, -16798.2, 250.913 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'e01B', 973.3, -16927.9, 200.100 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'e01C', 1266.8, -17117.2, 79.796 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'npig', 13213.4, -6211.2, 166.140 )
    set u = CreateUnit( p, 'e01C', 395.8, -16724.3, 79.796 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'e01C', 3225.6, -16889.0, 79.796 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'e01D', 3031.0, -16580.0, 192.827 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'npig', 13173.9, -6242.9, 209.933 )
    set u = CreateUnit( p, 'npig', 13122.3, -6250.8, 255.495 )
    set u = CreateUnit( p, 'e01C', 2939.6, -16784.4, 73.325 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'e01F', 4573.6, -17369.5, 178.995 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'e01F', -61.2, -16872.4, 178.995 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'e01F', 33.3, -16766.7, 178.995 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'e01F', 1077.9, -18185.1, 178.995 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'e01D', 1037.2, -18575.4, 356.616 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'npig', 13071.5, -6081.3, 277.787 )
    set u = CreateUnit( p, 'e01G', -825.8, -17127.3, 26.676 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'npig', 13082.9, -5993.4, 299.441 )
    set u = CreateUnit( p, 'e01G', -437.2, -19311.5, 188.586 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'h00S', 15647.6, -18283.0, 354.669 )
    set u = CreateUnit( p, 'hbew', 17211.6, -19916.3, 303.583 )
    set u = CreateUnit( p, 'hbew', 17051.8, -19905.9, 49.286 )
    set u = CreateUnit( p, 'h00Q', 17197.0, -19748.7, 175.628 )
    set u = CreateUnit( p, 'nvlk', 2588.3, -8961.5, 162.163 )
    set u = CreateUnit( p, 'n04Z', 449.0, -20164.3, 91.851 )
    set u = CreateUnit( p, 'n050', -46.3, -19576.1, 158.362 )
    set u = CreateUnit( p, 'n00K', -318.0, 62.0, 322.840 )
    set u = CreateUnit( p, 'nvk2', 2597.5, -9068.7, 333.863 )
    set u = CreateUnit( p, 'h00B', 94.9, 75.7, 230.774 )
    set u = CreateUnit( p, 'h00B', -6880.3, 4509.0, 211.865 )
    set u = CreateUnit( p, 'h00B', -23119.6, 2174.4, 275.510 )
    set gg_unit_H01A_0107 = CreateUnit( p, 'H01A', 28452.7, -22540.9, 19.046 )
    set u = CreateUnit( p, 'e01G', 2917.6, -14818.5, 256.154 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set gg_unit_H01C_0109 = CreateUnit( p, 'H01C', 29159.0, -22689.4, 128.902 )
    set gg_unit_H01D_0110 = CreateUnit( p, 'H01D', 28508.7, -22297.0, 330.608 )
    set gg_unit_H01B_0111 = CreateUnit( p, 'H01B', 29219.0, -22391.8, 201.563 )
    set u = CreateUnit( p, 'e01G', 731.7, -18520.2, 37.992 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set gg_unit_H019_0113 = CreateUnit( p, 'H019', 28567.4, -22748.7, 44.467 )
    set u = CreateUnit( p, 'hbew', 17367.3, -19902.2, 93.815 )
    set u = CreateUnit( p, 'e01J', 1197.1, -17338.8, 329.259 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'e01J', 1999.7, -17321.6, 90.497 )
    call SetUnitState( u, UNIT_STATE_MANA, 0 )
    set gg_unit_nvil_0117 = CreateUnit( p, 'nvil', 791.3, -18755.8, 222.497 )
    set u = CreateUnit( p, 'njks', -367.6, -13120.5, 310.654 )
    set u = CreateUnit( p, 'h00M', -2560.4, -11885.6, 350.487 )
    set u = CreateUnit( p, 'e003', 3492.9, -16766.7, 296.876 )
    set gg_unit_Hpal_0121 = CreateUnit( p, 'Hpal', 17403.0, -17999.5, 270.000 )
    set u = CreateUnit( p, 'e003', 25442.1, -26440.3, 35.244 )
    set u = CreateUnit( p, 'hrdh', 4586.9, -14319.0, 199.670 )
    set u = CreateUnit( p, 'nmed', 4803.6, -14276.0, 263.220 )
    set u = CreateUnit( p, 'eilw', 5007.9, -14193.7, 181.881 )
    set u = CreateUnit( p, 'h001', 5301.0, -14714.1, 286.182 )
    set u = CreateUnit( p, 'h008', 4999.1, -14802.7, 351.679 )
    set u = CreateUnit( p, 'n02A', 3511.3, -16971.5, 50.006 )
    set u = CreateUnit( p, 'h00B', 4190.4, -15069.7, 295.565 )
    set u = CreateUnit( p, 'n00J', 4542.7, -14897.9, 279.071 )
    set u = CreateUnit( p, 'Hjai', 5969.7, -14551.6, 230.034 )
    call SelectHeroSkill( u, 'AHab' )
    set u = CreateUnit( p, 'e019', 29668.0, -28223.5, 77.372 )
    call SetUnitColor( u, ConvertPlayerColor(6) )
    set u = CreateUnit( p, 'nvlw', 1963.4, -11551.7, 257.836 )
    set gg_unit_Hmkg_0135 = CreateUnit( p, 'Hmkg', 18712.6, -11679.7, 166.576 )
    set u = CreateUnit( p, 'hrdh', 4579.7, -14403.4, 186.170 )
    set u = CreateUnit( p, 'e004', 25270.4, -25882.2, 335.930 )
    set u = CreateUnit( p, 'e007', 25500.7, -25421.7, 296.378 )
    set u = CreateUnit( p, 'e00E', 26129.3, -25349.5, 251.280 )
    set u = CreateUnit( p, 'e00V', 26460.3, -26056.6, 192.468 )
    set u = CreateUnit( p, 'h00K', -2567.3, -12068.2, 333.701 )
    set u = CreateUnit( p, 'n02A', 25316.9, -26255.4, 11.470 )
    set u = CreateUnit( p, 'n01K', 25295.8, -25710.1, 322.335 )
    set u = CreateUnit( p, 'n036', 25339.7, -25558.3, 311.528 )
    set u = CreateUnit( p, 'n02C', 25613.6, -25358.2, 287.351 )
    set u = CreateUnit( p, 'n033', 25744.6, -25307.1, 277.811 )
    set u = CreateUnit( p, 'n034', 25892.5, -25305.4, 267.756 )
    set u = CreateUnit( p, 'n02R', 26229.4, -25460.4, 241.636 )
    set u = CreateUnit( p, 'n032', 26337.1, -25580.5, 229.785 )
    set u = CreateUnit( p, 'nvlw', 1203.4, -13485.2, 166.807 )
    set u = CreateUnit( p, 'e013', 25422.8, -22196.5, 267.236 )
    set u = CreateUnit( p, 'n03B', 26398.9, -25736.2, 217.186 )
    set u = CreateUnit( p, 'n036', 14.6, -11367.5, 318.775 )
    set u = CreateUnit( p, 'zmar', 1080.2, -13467.1, 12.914 )
    set u = CreateUnit( p, 'n02S', 1601.4, -11671.0, 269.379 )
    set u = CreateUnit( p, 'nchp', 3107.3, -13709.8, 182.826 )
    set u = CreateUnit( p, 'hmtt', 2806.5, -13142.8, 276.420 )
    set u = CreateUnit( p, 'n03C', 26394.7, -26217.9, 170.511 )
    set u = CreateUnit( p, 'n04T', 25270.9, -22243.0, 326.087 )
    set u = CreateUnit( p, 'nvlk', 1358.4, -12772.4, 51.181 )
    set u = CreateUnit( p, 'h00C', 520.5, -11501.2, 287.998 )
    set u = CreateUnit( p, 'h00A', 1051.2, -11470.2, 252.860 )
    set u = CreateUnit( p, 'h00B', 2324.9, -11715.4, 276.910 )
    set u = CreateUnit( p, 'n00K', 1133.5, -13053.9, 246.671 )
    set u = CreateUnit( p, 'n01K', 146.5, -11327.0, 276.756 )
    set u = CreateUnit( p, 'e004', 307.5, -11318.8, 228.512 )
    set u = CreateUnit( p, 'h009', 874.1, -11453.3, 271.883 )
    set u = CreateUnit( p, 'h007', 682.3, -11449.1, 285.110 )
    set u = CreateUnit( p, 'hfoo', 2731.8, -13814.0, 237.737 )
    set gg_unit_Hgam_0174 = CreateUnit( p, 'Hgam', 17924.0, -11218.4, 331.800 )
    set gg_unit_nbse_0176 = CreateUnit( p, 'nbse', 25369.5, -22485.2, 30.000 )
    set gg_unit_nbsw_0179 = CreateUnit( p, 'nbsw', 26090.7, -22930.3, 210.000 )
    set gg_unit_nbse_0180 = CreateUnit( p, 'nbse', 25369.5, -22709.2, 30.000 )
    set gg_unit_nbse_0181 = CreateUnit( p, 'nbse', 25369.5, -22933.2, 30.000 )
    set gg_unit_nbse_0182 = CreateUnit( p, 'nbse', 26075.9, -22477.0, 210.000 )
    set gg_unit_nbse_0183 = CreateUnit( p, 'nbse', 26075.9, -22701.0, 210.000 )
    set gg_unit_nbsw_0184 = CreateUnit( p, 'nbsw', 26090.7, -23154.3, 210.000 )
    set gg_unit_nbsw_0185 = CreateUnit( p, 'nbsw', 26090.7, -23378.3, 210.000 )
    set gg_unit_nbsw_0186 = CreateUnit( p, 'nbsw', 25384.3, -23162.5, 30.000 )
    set gg_unit_nbsw_0187 = CreateUnit( p, 'nbsw', 25384.3, -23386.5, 30.000 )
    set gg_unit_nvlk_0188 = CreateUnit( p, 'nvlk', 2178.5, -17203.4, 322.052 )
    set u = CreateUnit( p, 'h00B', 1960.2, -17959.5, 311.121 )
    set gg_unit_u000_0190 = CreateUnit( p, 'u000', 6136.2, -15913.1, 230.046 )
    set gg_unit_u001_0191 = CreateUnit( p, 'u001', 6927.3, -7095.4, 278.775 )
    set gg_unit_u002_0192 = CreateUnit( p, 'u002', 2514.3, -12450.0, 204.859 )
    set gg_unit_n02P_0193 = CreateUnit( p, 'n02P', 12578.9, -6187.8, 297.510 )
    set u = CreateUnit( p, 'n01J', 27641.0, -28148.4, 356.821 )
    set gg_unit_n02S_0195 = CreateUnit( p, 'n02S', 3360.6, -16389.8, 359.481 )
    set u = CreateUnit( p, 'nemi', 28970.9, -27866.2, 234.543 )
    set gg_unit_efdr_0197 = CreateUnit( p, 'efdr', 29639.6, -28079.2, 215.884 )
    set u = CreateUnit( p, 'h00Z', 18316.3, -16569.6, 94.115 )
    set u = CreateUnit( p, 'n043', 29648.0, -28895.2, 163.943 )
    set u = CreateUnit( p, 'n041', 29645.0, -28666.2, 218.287 )
    set gg_unit_h00I_0201 = CreateUnit( p, 'h00I', 13438.3, -9554.9, 1.126 )
    set gg_unit_hfoo_0202 = CreateUnit( p, 'hfoo', -2463.6, -12987.3, 302.001 )
    set gg_unit_hhes_0203 = CreateUnit( p, 'hhes', -2123.0, -13060.8, 224.516 )
    set gg_unit_n02T_0204 = CreateUnit( p, 'n02T', -1558.8, -12415.3, 134.200 )
    call SetUnitState( gg_unit_n02T_0204, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'h00N', -2505.3, -11756.7, 359.462 )
    set gg_unit_Hmbr_0207 = CreateUnit( p, 'Hmbr', 21740.5, -11986.7, 300.653 )
    set u = CreateUnit( p, 'h018', -269.2, -13324.7, 0.853 )
    set gg_unit_e011_0209 = CreateUnit( p, 'e011', 23792.5, -22461.9, 270.000 )
    set gg_unit_e011_0210 = CreateUnit( p, 'e011', 23490.7, -22461.9, 270.000 )
    set gg_unit_e011_0211 = CreateUnit( p, 'e011', 23188.9, -22461.9, 270.000 )
    set u = CreateUnit( p, 'h018', -12.1, -13185.2, 279.695 )
    set u = CreateUnit( p, 'h018', 174.0, -13187.0, 271.330 )
    set u = CreateUnit( p, 'hhes', 2416.0, -13823.0, 234.960 )
    set gg_unit_e011_0219 = CreateUnit( p, 'e011', 22887.1, -22461.9, 270.000 )
    set gg_unit_e011_0220 = CreateUnit( p, 'e011', 22585.3, -22461.9, 270.000 )
    set gg_unit_e011_0221 = CreateUnit( p, 'e011', 23799.1, -22065.6, 270.000 )
    set gg_unit_e011_0222 = CreateUnit( p, 'e011', 23497.3, -22065.6, 270.000 )
    set gg_unit_e011_0223 = CreateUnit( p, 'e011', 23195.5, -22065.6, 270.000 )
    set gg_unit_e011_0224 = CreateUnit( p, 'e011', 22893.7, -22065.6, 270.000 )
    set u = CreateUnit( p, 'nvlk', 123.0, -12147.7, 51.019 )
    set u = CreateUnit( p, 'nvk2', 192.7, -12134.2, 129.841 )
    set u = CreateUnit( p, 'nvlk', 147.3, -12071.0, 299.608 )
    set gg_unit_e011_0228 = CreateUnit( p, 'e011', 22591.9, -22065.6, 270.000 )
    set gg_unit_e011_0229 = CreateUnit( p, 'e011', 22594.8, -22844.2, 270.000 )
    set u = CreateUnit( p, 'nvlk', 553.4, -13411.6, 13.502 )
    set gg_unit_e011_0231 = CreateUnit( p, 'e011', 22896.6, -22844.2, 270.000 )
    set gg_unit_e011_0232 = CreateUnit( p, 'e011', 23198.4, -22844.2, 270.000 )
    set gg_unit_e011_0233 = CreateUnit( p, 'e011', 23500.2, -22844.2, 270.000 )
    set u = CreateUnit( p, 'nvlw', 743.6, -11801.6, 318.520 )
    set gg_unit_e011_0235 = CreateUnit( p, 'e011', 23802.0, -22844.2, 270.000 )
    set gg_unit_e011_0236 = CreateUnit( p, 'e011', 22588.4, -21715.3, 270.000 )
    set u = CreateUnit( p, 'n054', -496.4, -18271.8, 128.753 )
    set u = CreateUnit( p, 'n054', 68.7, -17462.8, 5.966 )
    set u = CreateUnit( p, 'nbee', 11793.5, -6934.5, 237.022 )
    set u = CreateUnit( p, 'h00B', 6974.6, -8096.3, 105.062 )
    set u = CreateUnit( p, 'h00B', 10768.5, -6663.6, 347.844 )
    set u = CreateUnit( p, 'n02Q', 10863.5, -6586.0, 255.645 )
    set u = CreateUnit( p, 'h00D', 11269.7, -6715.2, 318.048 )
    set u = CreateUnit( p, 'h00F', 11470.7, -6806.6, 263.067 )
    set u = CreateUnit( p, 'enec', 2282.5, -9361.3, 201.895 )
    set u = CreateUnit( p, 'nvk2', 993.7, -8253.1, 303.093 )
    set u = CreateUnit( p, 'nvl2', -305.5, -8330.9, 295.227 )
    set u = CreateUnit( p, 'nvil', 250.9, -8914.9, 187.703 )
    set u = CreateUnit( p, 'nvlw', -325.3, -8432.0, 18.977 )
    set u = CreateUnit( p, 'h00G', 105.4, -8123.9, 290.810 )
    set u = CreateUnit( p, 'h00H', -224.9, -8215.8, 302.982 )
    set u = CreateUnit( p, 'n00N', -319.1, -8827.8, 343.203 )
    set u = CreateUnit( p, 'n02C', 2024.2, -8053.3, 233.076 )
    set u = CreateUnit( p, 'e007', 1266.1, -8071.2, 291.488 )
    set u = CreateUnit( p, 'zmar', 145.9, -8787.1, 87.953 )
    set u = CreateUnit( p, 'nvil', 1074.5, -8211.3, 142.353 )
    set u = CreateUnit( p, 'n034', 1467.6, -8066.8, 240.498 )
    set u = CreateUnit( p, 'n033', 1844.5, -8054.8, 293.860 )
    set u = CreateUnit( p, 'ndog', -207.9, -8544.0, 282.063 )
    set u = CreateUnit( p, 'ndwm', 2899.3, -7914.2, 336.290 )
    set u = CreateUnit( p, 'ndwm', 2958.9, -7908.8, 208.198 )
    set u = CreateUnit( p, 'ndog', -317.5, -8212.7, 135.050 )
    set u = CreateUnit( p, 'nvlw', 2421.8, -8271.3, 287.973 )
    set u = CreateUnit( p, 'nvlw', 2412.5, -8376.1, 65.359 )
    set u = CreateUnit( p, 'nvlw', 2479.4, -8311.1, 193.179 )
    set u = CreateUnit( p, 'nvlk', 166.5, -9775.2, 162.163 )
    set u = CreateUnit( p, 'nvlk', 72.4, -9842.6, 333.687 )
    set u = CreateUnit( p, 'nvk2', 175.8, -9882.4, 333.863 )
    set u = CreateUnit( p, 'nvl2', 12794.9, -6657.9, 125.628 )
    set gg_unit_H002_0322 = CreateUnit( p, 'H002', 27968.0, -25711.6, 3.667 )
    call SetUnitState( gg_unit_H002_0322, UNIT_STATE_MANA, 0 )
    set gg_unit_H003_0323 = CreateUnit( p, 'H003', 28091.7, -25423.2, 324.833 )
    call SetUnitState( gg_unit_H003_0323, UNIT_STATE_MANA, 0 )
    set gg_unit_H004_0324 = CreateUnit( p, 'H004', 28511.5, -25247.8, 269.021 )
    call SetUnitState( gg_unit_H004_0324, UNIT_STATE_MANA, 0 )
    set gg_unit_H005_0325 = CreateUnit( p, 'H005', 28908.0, -25426.0, 213.713 )
    call SetUnitState( gg_unit_H005_0325, UNIT_STATE_MANA, 0 )
    set gg_unit_H006_0326 = CreateUnit( p, 'H006', 29035.3, -25702.5, 176.191 )
    call SetUnitState( gg_unit_H006_0326, UNIT_STATE_MANA, 0 )
    set u = CreateUnit( p, 'nbee', 13185.4, -6470.1, 86.664 )
    set u = CreateUnit( p, 'odkt', 12825.6, -6104.8, 272.066 )
    set u = CreateUnit( p, 'nvlw', 28759.5, -28627.0, 328.490 )
    set u = CreateUnit( p, 'npig', 13144.5, -6122.0, 87.729 )
    set u = CreateUnit( p, 'n01L', 27687.0, -28564.6, 3.923 )
    set u = CreateUnit( p, 'n02W', 29639.4, -29505.5, 183.001 )
    set u = CreateUnit( p, 'n02W', 29443.8, -29809.0, 90.147 )
    set u = CreateUnit( p, 'hhdl', 29661.9, -27820.5, 88.056 )
    set u = CreateUnit( p, 'n04Z', 11425.8, -6403.3, 322.576 )
    set gg_unit_hmtm_0369 = CreateUnit( p, 'hmtm', 18111.5, -11977.7, 75.018 )
    set u = CreateUnit( p, 'Hvwd', 27696.0, -27763.6, 304.960 )
    set u = CreateUnit( p, 'nvk2', 28801.3, -28676.7, 251.748 )
    set gg_unit_Harf_0372 = CreateUnit( p, 'Harf', 29228.5, -27994.4, 317.432 )
    set gg_unit_nhef_0373 = CreateUnit( p, 'nhef', 5383.5, -15793.4, 339.001 )
    set gg_unit_e019_0374 = CreateUnit( p, 'e019', 5377.4, -16245.6, 283.005 )
    call SetUnitColor( gg_unit_e019_0374, ConvertPlayerColor(6) )
    set u = CreateUnit( p, 'e00E', -1497.5, -11783.0, 273.106 )
    set u = CreateUnit( p, 'n02R', -1404.1, -11826.5, 247.168 )
    set u = CreateUnit( p, 'n032', -1350.1, -11969.7, 201.049 )
    set u = CreateUnit( p, 'n03B', -1381.8, -12152.3, 145.241 )
    set u = CreateUnit( p, 'h00B', -1643.8, -12619.1, 112.952 )
    set u = CreateUnit( p, 'nvlk', -2272.1, -11852.9, 13.502 )
    set u = CreateUnit( p, 'nvlk', -2214.5, -11801.6, 241.222 )
    set u = CreateUnit( p, 'nvlk', -2209.3, -11888.5, 123.394 )
    set u = CreateUnit( p, 'nvil', -2102.5, -12368.8, 317.004 )
    set u = CreateUnit( p, 'nvlw', -2012.7, -12417.5, 197.605 )
    set u = CreateUnit( p, 'nvil', -1622.0, -11624.9, 142.978 )
    set u = CreateUnit( p, 'nvlw', -1702.7, -11524.2, 263.249 )
    set u = CreateUnit( p, 'n04Y', 11713.0, -6584.3, 176.597 )
    set u = CreateUnit( p, 'n04Y', 11592.5, -6454.0, 258.897 )
    set u = CreateUnit( p, 'n050', 11656.1, -6706.0, 158.362 )
    set u = CreateUnit( p, 'n00M', -2548.4, -12254.0, 25.428 )
    set u = CreateUnit( p, 'nvlw', -2241.2, -11944.3, 81.696 )
    set u = CreateUnit( p, 'h00R', -4793.3, 16910.3, 288.321 )
    set u = CreateUnit( p, 'n03C', -3047.2, 16274.4, 242.553 )
    set u = CreateUnit( p, 'e00V', -3130.1, 16310.0, 256.066 )
    set u = CreateUnit( p, 'Hmkg', -4200.3, 16341.0, 270.392 )
    set u = CreateUnit( p, 'hrif', -3676.8, 15270.4, 286.040 )
    set u = CreateUnit( p, 'hrif', -3727.6, 17578.2, 267.338 )
    set u = CreateUnit( p, 'hrif', -4088.3, 17595.5, 273.805 )
    set u = CreateUnit( p, 'hrif', -4248.2, 15098.4, 286.040 )
    set u = CreateUnit( p, 'hrif', -5914.1, 16159.9, 227.820 )
    set u = CreateUnit( p, 'hrif', -5506.4, 15715.3, 221.797 )
    set u = CreateUnit( p, 'h00J', -2921.6, -8528.6, 316.815 )
    set u = CreateUnit( p, 'h00B', -2282.2, -8020.3, 218.265 )
    set u = CreateUnit( p, 'n02U', 7318.5, -6892.4, 323.456 )
    set u = CreateUnit( p, 'nvlk', 7218.9, -7190.7, 316.844 )
    set u = CreateUnit( p, 'nvlk', 7248.2, -7358.0, 333.401 )
    set u = CreateUnit( p, 'nvk2', 7204.8, -7270.9, 146.496 )
    set u = CreateUnit( p, 'nvk2', 7308.7, -7323.3, 119.579 )
    set u = CreateUnit( p, 'nvlw', 7425.8, -6881.2, 216.449 )
endfunction

//===========================================================================
function CreatePlayerBuildings takes nothing returns nothing
endfunction

//===========================================================================
function CreatePlayerUnits takes nothing returns nothing
endfunction

//===========================================================================
function CreateAllUnits takes nothing returns nothing
    call CreateNeutralPassiveBuildings(  )
    call CreatePlayerBuildings(  )
    call CreateNeutralHostile(  )
    call CreateNeutralPassive(  )
    call CreatePlayerUnits(  )
endfunction

//***************************************************************************
//*
//*  Regions
//*
//***************************************************************************

function CreateRegions takes nothing returns nothing
    local weathereffect we

    set gg_rct_Boss_Rect_01 = Rect( 25088.0, -19328.0, 27136.0, -15872.0 )
    set gg_rct_Chang_Job = Rect( 27392.0, -26656.0, 29600.0, -24544.0 )
    set gg_rct_Effect_01 = Rect( 64.0, -13376.0, 2784.0, -11520.0 )
    set we = AddWeatherEffect( gg_rct_Effect_01, 'LRaa' )
    call EnableWeatherEffect( we, true )
    set gg_rct_Effect_03 = Rect( 6400.0, -20096.0, 15040.0, -12896.0 )
    set we = AddWeatherEffect( gg_rct_Effect_03, 'FDgl' )
    call EnableWeatherEffect( we, true )
    set gg_rct_Effect_04 = Rect( -7456.0, -8864.0, -3776.0, -5888.0 )
    set we = AddWeatherEffect( gg_rct_Effect_04, 'WNcw' )
    call EnableWeatherEffect( we, true )
    set gg_rct_Effect_05 = Rect( -25856.0, -1408.0, -20256.0, 4512.0 )
    set we = AddWeatherEffect( gg_rct_Effect_05, 'LRma' )
    call EnableWeatherEffect( we, true )
    set gg_rct_Effect_06 = Rect( -9760.0, 15296.0, -6720.0, 17568.0 )
    set we = AddWeatherEffect( gg_rct_Effect_06, 'WOlw' )
    call EnableWeatherEffect( we, true )
    set gg_rct_Effect_07 = Rect( 5696.0, -14784.0, 6464.0, -14048.0 )
    set we = AddWeatherEffect( gg_rct_Effect_07, 'LRaa' )
    call EnableWeatherEffect( we, true )
    set gg_rct_Effect_08_Nanpa = Rect( -14272.0, -20032.0, -9792.0, -15296.0 )
    set we = AddWeatherEffect( gg_rct_Effect_08_Nanpa, 'FDbh' )
    call EnableWeatherEffect( we, true )
    set gg_rct_Effect_09 = Rect( -8288.0, -4864.0, -4032.0, 3008.0 )
    set we = AddWeatherEffect( gg_rct_Effect_09, 'LRma' )
    call EnableWeatherEffect( we, true )
    set gg_rct_Etc_Rect_01 = Rect( 24960.0, -26752.0, 26752.0, -24960.0 )
    set gg_rct_Etc_Rect_02 = Rect( 25600.0, -22656.0, 25856.0, -22464.0 )
    set gg_rct_Etc_Rect_03 = Rect( 25344.0, -23680.0, 26112.0, -22144.0 )
    set gg_rct_Hunting_01 = Rect( -672.0, -18624.0, 832.0, -17344.0 )
    set gg_rct_Hunting_02 = Rect( 1760.0, -20192.0, 5280.0, -19072.0 )
    set gg_rct_Hunting_03 = Rect( 1856.0, -19072.0, 5216.0, -17856.0 )
    set gg_rct_Hunting_04 = Rect( 3392.0, -13216.0, 5632.0, -10688.0 )
    set gg_rct_Hunting_05 = Rect( 3392.0, -10688.0, 6016.0, -7840.0 )
    set gg_rct_Hunting_06 = Rect( -1408.0, -15456.0, 1280.0, -14656.0 )
    set gg_rct_Hunting_07 = Rect( 7968.0, -7680.0, 10336.0, -6112.0 )
    set gg_rct_Hunting_08 = Rect( 8032.0, -9056.0, 10240.0, -7680.0 )
    set gg_rct_Hunting_09 = Rect( 6144.0, -11648.0, 8992.0, -9056.0 )
    set gg_rct_Hunting_10 = Rect( 10400.0, -9536.0, 13216.0, -7584.0 )
    set gg_rct_Hunting_11 = Rect( 9120.0, -11712.0, 12224.0, -9600.0 )
    set gg_rct_Hunting_12 = Rect( -1824.0, -10912.0, 2528.0, -10240.0 )
    set we = AddWeatherEffect( gg_rct_Hunting_12, 'WOlw' )
    call EnableWeatherEffect( we, true )
    set gg_rct_Hunting_13 = Rect( -5024.0, -11232.0, -1824.0, -9440.0 )
    set we = AddWeatherEffect( gg_rct_Hunting_13, 'WOlw' )
    call EnableWeatherEffect( we, true )
    set gg_rct_Hunting_15 = Rect( 13696.0, -7424.0, 16320.0, -4992.0 )
    set gg_rct_Hunting_16 = Rect( 8576.0, -15104.0, 14080.0, -13184.0 )
    set gg_rct_Hunting_17 = Rect( 10880.0, -16544.0, 13504.0, -15104.0 )
    set gg_rct_Hunting_18 = Rect( 8288.0, -16544.0, 10880.0, -15104.0 )
    set gg_rct_Hunting_19 = Rect( 7296.0, -17984.0, 10016.0, -16288.0 )
    set gg_rct_Hunting_20 = Rect( 10016.0, -18048.0, 12768.0, -16800.0 )
    set gg_rct_Hunting_21 = Rect( 12768.0, -19776.0, 14336.0, -16768.0 )
    set gg_rct_Hunting_22 = Rect( 9952.0, -19712.0, 12768.0, -18176.0 )
    set gg_rct_Hunting_23 = Rect( 6816.0, -19776.0, 9952.0, -18176.0 )
    set gg_rct_Hunting_24 = Rect( -5120.0, -7392.0, -3488.0, -5344.0 )
    set gg_rct_Hunting_25 = Rect( -7872.0, -9184.0, -3360.0, -7392.0 )
    set gg_rct_Hunting_26 = Rect( -7840.0, -7392.0, -5120.0, -5856.0 )
    set gg_rct_Hunting_27 = Rect( -11520.0, 1792.0, -8960.0, 5248.0 )
    set gg_rct_Hunting_28 = Rect( -13888.0, 2304.0, -11520.0, 5440.0 )
    set gg_rct_Hunting_29 = Rect( -15616.0, 3712.0, -13888.0, 6784.0 )
    set gg_rct_Hunting_30 = Rect( -17920.0, 6784.0, -13888.0, 8704.0 )
    set gg_rct_Hunting_31 = Rect( -13888.0, 5440.0, -10464.0, 8000.0 )
    set gg_rct_Hunting_32 = Rect( -10464.0, 5792.0, -6944.0, 9280.0 )
    set gg_rct_Hunting_33 = Rect( -13888.0, 8064.0, -9152.0, 11232.0 )
    set gg_rct_Hunting_34 = Rect( -17440.0, 9088.0, -13888.0, 13376.0 )
    set gg_rct_Hunting_35 = Rect( -13888.0, 10560.0, -11968.0, 13568.0 )
    set gg_rct_Hunting_36 = Rect( -11968.0, 11232.0, -9984.0, 12864.0 )
    set gg_rct_Hunting_37 = Rect( -13120.0, -13280.0, -11072.0, -11840.0 )
    set gg_rct_Hunting_38 = Rect( -12992.0, -14592.0, -11200.0, -13280.0 )
    set gg_rct_Hunting_39 = Rect( -12864.0, -15968.0, -11200.0, -14592.0 )
    set gg_rct_Hunting_40 = Rect( -13280.0, -17344.0, -10656.0, -15968.0 )
    set gg_rct_Hunting_41 = Rect( -14144.0, -18624.0, -10176.0, -17344.0 )
    set gg_rct_Hunting_42 = Rect( -14144.0, -20096.0, -10176.0, -18624.0 )
    set gg_rct_Hunting_43 = Rect( -7680.0, -4480.0, -4640.0, -2816.0 )
    set gg_rct_Hunting_44 = Rect( -8448.0, -2816.0, -3872.0, -1440.0 )
    set gg_rct_Hunting_45 = Rect( -8448.0, -1440.0, -3872.0, 768.0 )
    set gg_rct_Hunting_46 = Rect( -7232.0, 768.0, -5056.0, 2816.0 )
    set gg_rct_Hunting_47 = Rect( 24320.0, -29952.0, 26496.0, -27648.0 )
    set gg_rct_Hunting_48 = Rect( 19264.0, -19712.0, 21888.0, -18560.0 )
    set gg_rct_Hunting_49 = Rect( 19840.0, -16768.0, 21888.0, -14976.0 )
    set gg_rct_Hunting_50 = Rect( 22400.0, -19840.0, 23936.0, -17280.0 )
    set gg_rct_Hunting_51 = Rect( 17088.0, -16832.0, 18624.0, -13216.0 )
    set gg_rct_Moving_00 = Rect( 27904.0, -27680.0, 28192.0, -27520.0 )
    set gg_rct_Moving_01 = Rect( 5504.0, -17024.0, 6048.0, -16512.0 )
    set gg_rct_Moving_02 = Rect( 9248.0, -13344.0, 9600.0, -13088.0 )
    set gg_rct_Moving_03 = Rect( 1920.0, -15008.0, 2176.0, -14688.0 )
    set gg_rct_Moving_04 = Rect( 1280.0, -15392.0, 1504.0, -15040.0 )
    set gg_rct_Moving_05 = Rect( -3552.0, -14656.0, -1984.0, -13888.0 )
    set gg_rct_Moving_06 = Rect( -12352.0, -11968.0, -11840.0, -11712.0 )
    set gg_rct_Moving_07 = Rect( -7680.0, -4576.0, -6144.0, -4352.0 )
    set gg_rct_Moving_08 = Rect( 29216.0, -27904.0, 29632.0, -27520.0 )
    set gg_rct_Moving_09 = Rect( -1376.0, -9536.0, -896.0, -9024.0 )
    set gg_rct_Moving_10 = Rect( -7264.0, 3968.0, -6784.0, 4160.0 )
    set gg_rct_Moving_11 = Rect( 15584.0, -17920.0, 15776.0, -17760.0 )
    set gg_rct_Moving_12 = Rect( 20256.0, -19840.0, 20576.0, -19616.0 )
    set gg_rct_Moving_13 = Rect( 16128.0, -20064.0, 16512.0, -19808.0 )
    set gg_rct_Moving_14 = Rect( 15968.0, -17920.0, 16160.0, -17760.0 )
    set gg_rct_Moving_15 = Rect( 20768.0, -15104.0, 21056.0, -14912.0 )
    set gg_rct_Moving_16 = Rect( 25856.0, -26912.0, 26112.0, -26752.0 )
    set gg_rct_Moving_17 = Rect( 22944.0, -19872.0, 23200.0, -19712.0 )
    set gg_rct_Moving_18 = Rect( 16352.0, -17920.0, 16544.0, -17760.0 )
    set gg_rct_Moving_19 = Rect( 25440.0, -24064.0, 25984.0, -23680.0 )
    set gg_rct_Moving_Harmony = Rect( -4352.0, -6208.0, -3968.0, -5920.0 )
    set gg_rct_Moving_Harmony_Before = Rect( -4576.0, -6400.0, -4032.0, -6016.0 )
    set gg_rct_Quest03_Enter = Rect( 5024.0, -20032.0, 5312.0, -19744.0 )
    set gg_rct_Quest05_Mantice = Rect( 12032.0, -11424.0, 12352.0, -11040.0 )
    set gg_rct_Quest05_Mantice_2 = Rect( 12192.0, -11264.0, 12576.0, -10880.0 )
    set we = AddWeatherEffect( gg_rct_Quest05_Mantice_2, 'MEds' )
    call EnableWeatherEffect( we, true )
    set gg_rct_Quest05_Mantice_3 = Rect( 15744.0, -11136.0, 16256.0, -10880.0 )
    set gg_rct_Quest05_Mantice_4 = Rect( 14976.0, -9984.0, 16512.0, -8320.0 )
    set gg_rct_Quest05_Pantent = Rect( 6624.0, -10560.0, 8864.0, -10432.0 )
    set gg_rct_Quest05_Tresure = Rect( 9120.0, -10688.0, 12224.0, -10592.0 )
    set gg_rct_Rect_168_Mine = Rect( 16256.0, -16672.0, 18624.0, -13120.0 )
    set we = AddWeatherEffect( gg_rct_Rect_168_Mine, 'FDwl' )
    call EnableWeatherEffect( we, true )
    set gg_rct_Rect_168_Mine_Out = Rect( 18432.0, -16864.0, 18624.0, -16672.0 )
    set we = AddWeatherEffect( gg_rct_Rect_168_Mine_Out, 'MEds' )
    call EnableWeatherEffect( we, true )
    set gg_rct_Rect_168_Mine_Up = Rect( 17600.0, -13376.0, 18240.0, -13216.0 )
    set we = AddWeatherEffect( gg_rct_Rect_168_Mine_Up, 'MEds' )
    call EnableWeatherEffect( we, true )
    set gg_rct_Setting_Start = Rect( -1600.0, -20224.0, -1248.0, -19840.0 )
    set we = AddWeatherEffect( gg_rct_Setting_Start, 'LRma' )
    call EnableWeatherEffect( we, true )
    set gg_rct_TMi_Rect_00 = Rect( -30208.0, -20224.0, 29696.0, 30720.0 )
    set gg_rct_TMi_Rect_01 = Rect( -29952.0, -23552.0, -27904.0, -21504.0 )
    set gg_rct_TMi_Rect_02 = Rect( -29952.0, -26880.0, -27904.0, -24832.0 )
    set gg_rct_TMi_Rect_03 = Rect( -29952.0, -30208.0, -27904.0, -28160.0 )
    set gg_rct_TMi_Rect_04 = Rect( -26368.0, -23552.0, -24320.0, -21504.0 )
    set gg_rct_TMi_Rect_05 = Rect( -26368.0, -26880.0, -24320.0, -24832.0 )
    set gg_rct_TMi_Rect_06 = Rect( -26368.0, -30208.0, -24320.0, -28160.0 )
    set gg_rct_TMi_Rect_07 = Rect( -22784.0, -23552.0, -20736.0, -21504.0 )
    set gg_rct_TMi_Rect_08 = Rect( -22784.0, -26880.0, -20736.0, -24832.0 )
    set gg_rct_TMi_Rect_09 = Rect( -22784.0, -30208.0, -20736.0, -28160.0 )
    set gg_rct_TMi_Rect_10 = Rect( -19200.0, -23552.0, -17152.0, -21504.0 )
    set gg_rct_TMi_Rect_11 = Rect( -19200.0, -26880.0, -17152.0, -24832.0 )
    set gg_rct_TMi_Rect_12 = Rect( -19200.0, -30208.0, -17152.0, -28160.0 )
    set gg_rct_Villeage_01 = Rect( -832.0, -20864.0, 1024.0, -18784.0 )
    set gg_rct_Villeage_02 = Rect( 15616.0, -19936.0, 17792.0, -17920.0 )
    set gg_rct_Villeage_06 = Rect( 2240.0, -17568.0, 6496.0, -13792.0 )
    set gg_rct_Villeage_07 = Rect( -544.0, -13760.0, 3168.0, -11136.0 )
    set gg_rct_Villeage_08 = Rect( 7136.0, -448.0, 10368.0, 3040.0 )
    set gg_rct_Villeage_09 = Rect( 6304.0, -8224.0, 7968.0, -6592.0 )
    set gg_rct_Villeage_10 = Rect( 10400.0, -7520.0, 12064.0, -6144.0 )
    set gg_rct_Villeage_11 = Rect( -480.0, -9984.0, 3168.0, -7744.0 )
    set gg_rct_Villeage_12 = Rect( 12352.0, -6976.0, 13440.0, -5856.0 )
    set we = AddWeatherEffect( gg_rct_Villeage_12, 'LRaa' )
    call EnableWeatherEffect( we, true )
    set gg_rct_Villeage_13 = Rect( -3232.0, -9312.0, -1472.0, -7584.0 )
    set gg_rct_Villeage_14 = Rect( -3072.0, -13184.0, -1088.0, -11232.0 )
    set gg_rct_Villeage_15 = Rect( 27520.0, -29952.0, 29696.0, -27520.0 )
    set gg_rct_Villeage_16 = Rect( -6304.0, 15200.0, -2272.0, 17664.0 )
    set gg_rct_Villeage_17 = Rect( -25248.0, -320.0, -21504.0, 4160.0 )
    set gg_rct_Hunting_61 = Rect( 17696.0, -9600.0, 20992.0, -7808.0 )
    set gg_rct_Hunting_62 = Rect( 20992.0, -9600.0, 24320.0, -7808.0 )
    set gg_rct_Hunting_63 = Rect( 20992.0, -7552.0, 24320.0, -5504.0 )
    set gg_rct_Hunting_64 = Rect( 17664.0, -7520.0, 20992.0, -5632.0 )
    set gg_rct_Hunting_65 = Rect( 17664.0, -5504.0, 20992.0, -3712.0 )
    set gg_rct_Hunting_66 = Rect( 20992.0, -5504.0, 24320.0, -3712.0 )
    set gg_rct_Hunting_67 = Rect( 19328.0, -14208.0, 24320.0, -10240.0 )
    set gg_rct_Boss_Rect_02 = Rect( 27776.0, -19424.0, 29920.0, -15872.0 )
    set gg_rct________131 = Rect( 7776.0, -19712.0, 8704.0, -18816.0 )
endfunction

//***************************************************************************
//*
//*  Cameras
//*
//***************************************************************************

function CreateCameras takes nothing returns nothing

    set gg_cam_Camera_001 = CreateCameraSetup(  )
    call CameraSetupSetField( gg_cam_Camera_001, CAMERA_FIELD_ZOFFSET, 0.0, 0.0 )
    call CameraSetupSetField( gg_cam_Camera_001, CAMERA_FIELD_ROTATION, 178.7, 0.0 )
    call CameraSetupSetField( gg_cam_Camera_001, CAMERA_FIELD_ANGLE_OF_ATTACK, 335.0, 0.0 )
    call CameraSetupSetField( gg_cam_Camera_001, CAMERA_FIELD_TARGET_DISTANCE, 1200.0, 0.0 )
    call CameraSetupSetField( gg_cam_Camera_001, CAMERA_FIELD_ROLL, 0.0, 0.0 )
    call CameraSetupSetField( gg_cam_Camera_001, CAMERA_FIELD_FIELD_OF_VIEW, 70.0, 0.0 )
    call CameraSetupSetField( gg_cam_Camera_001, CAMERA_FIELD_FARZ, 5000.0, 0.0 )
    call CameraSetupSetDestPosition( gg_cam_Camera_001, 13486.8, -9523.9, 0.0 )

endfunction

//***************************************************************************
//*
//*  Custom Script Code
//*
//***************************************************************************
constant function BaseStr takes integer i returns string
  if ( i == 1 ) then
    //58진수 ^4 --- without i, I, l, j
    return "194K0NuWCgMckS2DJEpOsALxvZbyYanTP8ehmVBQHzf5FrwRXto7dGq6U3"
  elseif ( i == 3 ) then
  //영어, 초록
    return "|cff21cd3a"
  elseif ( i == 4 ) then
  //숫자, 파랑
    return "|cff218def"
  elseif ( i == 5 ) then
  //코드체커 틀림 부분 표시 - 빨강SysC_DmgAttackAdd
    return "|cffff3315"
  elseif ( i == 6 ) then
    return "|cffffdc3c----------------------------------------|r"
  elseif ( i == 7 ) then
    return "|cffff8000홈페이지 주소: |cffff0033http://cafe.naver.com/w3Lod|r"
  elseif ( i == 8 ) then
    return "    |cffC1FFC1푸잎 |r& |cffC1FFC1\"cafe: w3Lod\" |rPresent:
       |cffCCCCFFLegend of Darkness|r RPG
          * |c00f0ff7cT|c00e1ff78h|c00d2ff75e|c00c3ff71 |c00b4ff6dF|c00a5ff69i|c0096ff66f|c0087ff62t|c0078ff5eh|c0069ff5a |c005aff57S|c004bff53e|c003cff4fa|c002dff4bs|c001eff48o|c000fff44n|c0000ff40! |r* |cfff1ff79다섯번째 이야기
|cffFEE5AC======================|r
버전: |cffDFFFA5N1.30F|r          |r(|cffEEEEEE초기화/예정 모두 없음|r)
업데이트: |cff76EEC62023.10.28|r
홈페이지:  |cffFF0033http://cafe.naver.com/w3lod|r
공식채널&클랜 |cffffdc3c Clan FLoD|r"
  elseif ( i == 9 ) then
    return "New 1.30F"
  elseif ( i == 10 ) then
    return "|cffffdc3c궁금한점이 있거나 소통하고 싶으실 땐 카페와 오픈채팅을 찾아주세요.\n   오픈채팅 링크는 \"|r-오픈채팅\"|cffffdc3c을 타이핑하세요. (인터넷 열림)|r"
  elseif ( i == 11 ) then
    return "|cffffdc3c"
  elseif ( i == 12 ) then
    return "\n	"
  elseif ( i == 13 ) then
    return "|cff99ffff호스트에게:|r 딜레이 리듀서. 즉 딜듀를 써서 다른 플레이어들이 게임을 즐길수 있도록 하십시오.\n|cff99ffff새 플레이어들에게:|r 도움말을 참조하여, 게임에 대한 기초 지식을 쌓으세요. [|cffFCD116F9|r].\n"
  elseif ( i == 14 ) then
    return "|cffc3dbff"
  elseif ( i == 15 ) then
  //퀘스트 기본 컬러  
    return "|c00ffff00"
  else
    return "|cffffdc3c설정 에러! 카페에 신고 해 주세요 [|r B.S |cffffdc3c/|r 10+ |cffffdc3c]"
  endif
endfunction
constant function BaseValue takes integer i returns real
  if ( i == 1 ) then
  //민첩 1당 명중률 상승량
    return .33
  elseif ( i == 2 ) then
  //HIT 1당 Hits 상승량
    return 1.
  elseif ( i == 3 ) then
  //전체마법 데미지 감소율
    return .97
  elseif ( i == 4 ) then
  //추가범위, 범위마법 (e스킬) 데미지 감소율
    return .985
  elseif ( i == 5 ) then
  //사람  수에 비례한 몹 생성 속도
    return .4
  elseif ( i == 6 ) then
  //INT 1당 마방 감소
    return .15
  elseif ( i == 7 ) then
  //HIT~ 1당 마방감소 
    return .25
  elseif ( i == 8 ) then
  //도적 보너스 회피율
    return 5.
  elseif ( i == 9 ) then
  //Dex 1당 회피 상승률
    return 0.
  elseif ( i == 10 ) then
  //파티 - 킬러 보너스 (5)  
    return 1.05
  elseif ( i == 11 ) then
  //솔던 - 경험치 비율 (70)
    return 0.7
  elseif ( i == 12 ) then
  //캐스팅 취소시 소모되는 마나량 1.0 = 100
    return 0.
  elseif ( i == 13 ) then
  //DEX 1당 크리 확률 증가
    return .2
  elseif ( i == 14 ) then
  //DEX 1당 크리 배율 증가 -> STR, INT당 배율 증가
    return .005
  elseif ( i == 15 ) then
  //크리 확률 - 기본값, DEX 3 추가 전.
    return 9.4
  elseif ( i == 16 ) then
  //크리 배율 - 기본값, STR, INT 3 추가 전.
    return 1.37
  //elseif ( i == 17 ) then
  //직자 보너스 경험치 -> SysInt(0,26)
    //return 0.05
  elseif ( i == 18 ) then
  //기본 명중률  
    return -.99
  elseif ( i == 19 ) then
  //선스텟 Con당 체력 상승량. Con * 해당수치
    return 0.
  elseif ( i == 20 ) then
  //선스텟 Wis당 마력 상승량. Wis * 해당수치
    return 0.
  elseif ( i == 21 ) then
  //도적 CriX 보정
    return 0.4
  elseif ( i == 22 ) then
  //법사 ㅌ 마나회복 비율
    return .3
  elseif ( i == 23 ) then
  //직자 단일힐 마나소모(서클당. 5서클 = 3)
    //return .006
    return 0.
  elseif ( i == 24 ) then
  //직자 파티힐 마나소모(서클당. 5서클 = 2, 명당 소모 2서클부터 시작)
    //return .005
    return 0.
  elseif ( i == 25 ) then
  //마법사 전체마법 추가마나소모
    return .05
  elseif ( i == 26 ) then
  //보스 CC 지속시간 감소(.2 = 80감소)
    return .2
  elseif ( i == 27 ) then
  //마법사 전체마법 추가범위 마나소모
    return .35
  elseif ( i == 28 ) then
  //범위마법 추가범위 뎀지 감소율 = 1
    return .99
  else
    return 0.
  endif
endfunction
//call BaseValue(1)

constant function SysStr takes integer i1, integer i2 returns string
  if ( i1 == 1 ) then
  //유닛타입_직업 구분. 전직 단계와 직업을 반환.
    if ( i2 == 'H000' ) then
      return "01"
    elseif ( i2 == 'H002' ) then
      return "12"
    elseif ( i2 == 'H003' ) then
      return "13"
    elseif ( i2 == 'H004' ) then
      return "14"
    elseif ( i2 == 'H005' ) then
      return "15"
    elseif ( i2 == 'H006' ) then
      return "16"
    elseif ( i2 == 'H010' ) then
      return "22"
    elseif ( i2 == 'H011' ) then
      return "23"
    elseif ( i2 == 'H012' ) then
      return "24"
    elseif ( i2 == 'H013' ) then
      return "25"
    elseif ( i2 == 'H00Y' ) then
      return "26"
    elseif ( i2 == 'H014' ) then
      return "22"
    elseif ( i2 == 'H015' ) then
      return "22"
    elseif ( i2 == 'H016' ) then
      return "22"
    elseif ( i2 == 'H01E' ) then
      return "23"
    elseif ( i2 == 'H01F' ) then
      return "23"
    elseif ( i2 == 'H01G' ) then
      return "23"
    elseif ( i2 == 'H01H' ) then
      return "24"
    elseif ( i2 == 'H01I' ) then
      return "24"
    elseif ( i2 == 'H01J' ) then
      return "24"
    elseif ( i2 == 'H01K' ) then
      return "25"
    elseif ( i2 == 'H01L' ) then
      return "25"
    elseif ( i2 == 'H01M' ) then
      return "25"
    
    //이하 승급
    elseif ( i2 == 'H00U' ) then
      return "32"
    elseif ( i2 == 'H01N' ) then
      return "32"
    elseif ( i2 == 'H01O' ) then
      return "32"
    elseif ( i2 == 'H01P' ) then
      return "32"

    elseif ( i2 == 'H00V' ) then
      return "33"
    elseif ( i2 == 'H01Q' ) then
      return "33"
    elseif ( i2 == 'H01R' ) then
      return "33"
    elseif ( i2 == 'H01S' ) then
      return "33"

    elseif ( i2 == 'H00W' ) then
      return "34"
    elseif ( i2 == 'H01T' ) then
      return "34"
    elseif ( i2 == 'H01U' ) then
      return "34"
    elseif ( i2 == 'H01V' ) then
      return "34"

    elseif ( i2 == 'H00T' ) then
      return "35"
    elseif ( i2 == 'H01W' ) then
      return "35"
    elseif ( i2 == 'H01X' ) then
      return "35"
    elseif ( i2 == 'H01Y' ) then
      return "35"
    
    elseif ( i2 == 'H00X' ) then
      return "36"
    endif
  elseif ( i1 == 2 ) then
  //플레이어 컬러
    if ( i2 == 1 ) then
      return "|cffff0202"
    elseif ( i2 == 2 ) then
      return "|cff0041ff"
    elseif ( i2 == 3 ) then
      return "|cff1be5b8"
    elseif ( i2 == 4 ) then
      return "|cff530080"
    elseif ( i2 == 5 ) then
      return "|cfffffc00"
    elseif ( i2 == 6 ) then
      return "|cfffe890d"
    elseif ( i2 == 7 ) then
      return "|cff1fbf00"
    elseif ( i2 == 8 ) then
      return "|cffe45aaf"
    elseif ( i2 == 9 ) then
      return "|cff949596"
    elseif ( i2 == 10 ) then
      return "|cff7dbef0"
    elseif ( i2 == 11 ) then
      return "|cff0f6145"
    elseif ( i2 == 12 ) then
      return "|cff4d2903"
    endif
  elseif ( i1 == 4 ) then
  //아이템 종류
    if ( i2 == 1 ) then
      return "|c0000ffff[한손검]|r"
    elseif ( i2 == 2 ) then
      return "|c0000ffff[수리검]|r"
    elseif ( i2 == 3 ) then
      return "|c0000ffff[ 표 창 ]|r"
    elseif ( i2 == 4 ) then
      return "|c0000ffff[ 채 찍 ]|r"
    elseif ( i2 == 5 ) then
      return "|c0000ffff[ 클 로 ]|r"
    elseif ( i2 == 6 ) then
      return "|c0000ffff[ 도 끼 ]|r"
    elseif ( i2 == 7 ) then
      return "|c0000ffff[양손검]|r"
    elseif ( i2 == 8 ) then
      return "|c0000ffff[스태프]|r"
    elseif ( i2 == 10 ) then
      return "|c0000ffff[ 방 패 ]|r"
    elseif ( i2 == 11 ) then
      return "|c0000ffff[ 갑 옷 ]|r"
    elseif ( i2 == 12 ) then
      return "|c0000ffff[ 투 구 ]|r"
    elseif ( i2 == 13 ) then
      return "|c0000ffff[목걸이]|r"
    elseif ( i2 == 14 ) then
      return "|c0000ffff[귀걸이]|r"
    elseif ( i2 == 15 ) then
      return "|c0000ffff[ 장 갑 ]|r"
    elseif ( i2 == 16 ) then
      return "|c0000ffff[ 팔 찌 ]|r"
    elseif ( i2 == 17 ) then
      return "|c0000ffff[ 벨 트 ]|r"
    elseif ( i2 == 18 ) then
      return "|c0000ffff[ 각 반 ]|r"
    elseif ( i2 == 19 ) then
      return "|c0000ffff[ 신 발 ]|r"
    elseif ( i2 == 20 ) then
      return "|c0000ffff[ 반 지 ]|r"
    elseif ( i2 == 9 ) then
      return "|c0000ffff[ 특 수 ]|r"
    else
      return "|c0000ffff[ 기 타 ]|r"
	endif
  elseif ( i1 == 5 ) then
    if ( i2 == 1 ) then
      return "１．"
	elseif ( i2 == 2 ) then
      return "２．"
	elseif ( i2 == 3 ) then
      return "３．"
	elseif ( i2 == 4 ) then
      return "４．"
	elseif ( i2 == 5 ) then
      return "５．"
	elseif ( i2 == 6 ) then
      return "６．"
	elseif ( i2 == 7 ) then
      return "７．"
	elseif ( i2 == 8 ) then
      return "８．"
	elseif ( i2 == 9 ) then
      return "９．"
	elseif ( i2 == 10 ) then
      return "１０．"
	elseif ( i2 == 11 ) then
      return "１１．"
	elseif ( i2 == 12 ) then
      return "１２．"
	else
	  return "０．"
	endif
  elseif ( i1 == 6 ) then
    if ( i2 == 1 ) then
      return "|c00d962b5＊|cffffdc3c파티 목록 ---------- ----------|r"
    elseif( i2 == 2 ) then
      return "|c00d962b5＊|cffffdc3c( |c00d962b5"
    elseif ( i2 == 3 ) then
    //1, 2+3 = 파티 목록 쳤을때.  
      return "|cffffdc3c／3 파티 ) -------- ----------|r"
    elseif ( i2 == 4 ) then
      return "|c00d962b5＊|cffffdc3c파티 초대 명단 -------- ----------|r"
    elseif ( i2 == 5 ) then
	  return "|c00d962b5＊|cffffdc3c10초 이내에 원하는 파티 앞의 숫자를 입력해주세요.|r"
    elseif ( i2 == 6 ) then
	  return "|c00d962b5＊|cffffdc3c10초 이내에 원하는 사람 앞의 숫자를 입력해주세요.|r"
	elseif ( i2 == 7 ) then
	  return "|c00ffff00----------------------------------------|r\n|cff46ffff-파티승낙|r\n|cff46ffff-파티거절|r\n\n|c00d962b5＊|cffffdc3c20초 이내에 |cffc3dbff-파티승낙 |cffffdc3c혹은 |cffc3dbff-파티거절|cffffdc3c을 입력해주세요.|r\n|c00ffff00---------------------------------------"
    elseif ( i2 == 8 ) then
	  return "|c00fd8505--- 파티 성향을 정해주세요. ---|r\n\n|c00d962b51.|r |c00ffff00기본성향(노멀팟 :: 경험치 １００％드랍률 １００％)\n|c00d962b52.|r |c00ffff00토벌성향(사냥팟 :: 경험치 １５０％드랍률 　５０％)\n|c00d962b53.|r |c00ffff00수집성향(아템팟 :: 경험치 　７０％드랍률 １５０％)"
    endif
  elseif ( i1 == 7 ) then
    if ( i2 == 1 ) then
      return "("+"싱"+"글"+")"
    elseif ( i2 == 2 ) then
      return "("+"구"+"버"+"전 or"+"서"+"버"+"닫"+"힘"+")"
    elseif ( i2 == 4 ) then
      return "(불러오기)"
    elseif ( i2 == 6 ) then
      return "(금지버전 코드)"
    elseif ( i2 == 7 ) then
      return "(포인트 >25)"
    elseif ( i2 == 10 ) then
      return "(혼"+"자, 9"+"8이상)"
    elseif ( i2 == 12 ) then
      return "(체크)"
    elseif ( i2 == 13 ) then
      return "(아이템)"
    endif
  endif
  return "__"
endfunction
//SysStr(6,7)
constant function SysInt takes integer i1, integer i2 returns integer
  if ( i1 == 0 ) then
    if ( i2 == 1 ) then
    //Code
      return 58
    elseif ( i2 == 2 ) then
    //Send HardDisk
      return 0
    elseif ( i2 == 4 ) then
    //DropMonLayer
      return 12
    elseif ( i2 == 5 ) then
    //DropLayer
      return 9
    elseif ( i2 == 6 ) then
    //SysC - ClassMax
      return 20
    elseif ( i2 == 7 ) then
    //SysC ItemTypeMAX
      return 50
    elseif ( i2 == 8 ) then
    //MaxState
      return 215
    elseif ( i2 == 9 ) then
    //HP&MP
      return 400
    elseif ( i2 == 10 ) then
      return 200
  //이하 스텟 11~17
    elseif ( i2 == 11 ) then
    //기본데미지
      return -40
    elseif ( i2 == 12 ) then
    //힘 1당 기본 데미지 증가
      return 0
    elseif ( i2 == 13 ) then
    //민 1당 기본 데미지 증가
      return 10
    elseif ( i2 == 14 ) then
    //콘 1당 기본 데미지 증가
      return 5
    elseif ( i2 == 15 ) then
    //FMi 최대 개수
      return 28
    elseif ( i2 == 16 ) then
    //레벨업당 데미지 증가
      return 7
    elseif ( i2 == 17 ) then
    //레벨업당 상승하는 체력
      return 40
    elseif ( i2 == 18 ) then
    //레벨업당 상승하는 마력
      return 40
    elseif ( i2 == 19 ) then
    //힘/덱/콘 1당 추가데미지 증가
      return 20
    elseif ( i2 == 20 ) then
      return 0
    elseif ( i2 == 21 ) then
      return 5
    elseif ( i2 == 22 ) then
    //기본데미지(추가)
      return -70
    elseif ( i2 == 23 ) then
    //파티 5직업 보너스, 경험치 상승
      return 20
    elseif ( i2 == 24 ) then
    //파티 5직업 보너스, 드랍률 상승
      return 25
    elseif ( i2 == 25 ) then
    //파티 5직업 보너스, 골드 드랍 상승
      return 33
    elseif ( i2 == 26 ) then
    //직자 경험치 보너스
      return 10
    elseif ( i2 == 27 ) then
    //체력 구매당 증가
      return 400
    elseif ( i2 == 28 ) then
    //마력 구매당 증가
      return 200
    elseif ( i2 == 29 ) then
    //네임드 아이템 개수
      return 17
    elseif ( i2 == 30 ) then
    //최초 인원수 경험치 보너스 (명당)
      return 2
    elseif ( i2 == 31 ) then
    //최초 인원수 드랍률 보너스 (명당)
      return 3
    elseif ( i2 == 32 ) then
    //최초 인원수 골드 보너스 (명당)
      return 5
    elseif ( i2 == 33 ) then
    //CON 스텟당 체력 증가
      return 40
    elseif ( i2 == 34 ) then
    //WIS 스텟당 마력 증가
      return 40
    elseif ( i2 == 35 ) then
    //기본 체력
      return 100-120
    elseif ( i2 == 36 ) then
    //기본 마력
      return 50-120
    endif
  elseif ( i1 == 1 ) then
  //I2Ut, 유닛 타입 반환
    if ( i2 == 0 ) then
      return 40
    elseif ( i2 == 1 ) then
      return 'H000'
    elseif ( i2 == 2 ) then
      return 'H002'
    elseif ( i2 == 3 ) then
      return 'H003'
    elseif ( i2 == 4 ) then
      return 'H004'
    elseif ( i2 == 5 ) then
      return 'H005'
    elseif ( i2 == 6 ) then
      return 'H006'
    elseif ( i2 == 7 ) then
      return 'H00U'
    elseif ( i2 == 8 ) then
      return 'H00V'
    elseif ( i2 == 9 ) then
      return 'H00W'
    elseif ( i2 == 10 ) then
      return 'H00T'
    elseif ( i2 == 11 ) then
      return 'H00X'
    elseif ( i2 == 12 ) then
      return 'H00Y'
    elseif ( i2 == 13 ) then
      return 'H010'
    elseif ( i2 == 14 ) then
      return 'H011'
    elseif ( i2 == 15 ) then
      return 'H012'
    elseif ( i2 == 16 ) then
      return 'H013'
    elseif ( i2 == 17 ) then
      return 'H014'
    elseif ( i2 == 18 ) then
      return 'H015'
    elseif ( i2 == 19 ) then
      return 'H016'
    elseif ( i2 == 20 ) then
      return 'H01E'
    elseif ( i2 == 21 ) then
      return 'H01F'
    elseif ( i2 == 22 ) then
      return 'H01G'
    elseif ( i2 == 23 ) then
      return 'H01H'
    elseif ( i2 == 24 ) then
      return 'H01I'
    elseif ( i2 == 25 ) then
      return 'H01J'
    elseif ( i2 == 26 ) then
      return 'H01K'
    elseif ( i2 == 27 ) then
      return 'H01L'
    elseif ( i2 == 28 ) then
      return 'H01M'
      
    elseif ( i2 == 29 ) then
      return 'H01N'
    elseif ( i2 == 30 ) then
      return 'H01O'
    elseif ( i2 == 31 ) then
      return 'H01P'

    elseif ( i2 == 32 ) then
      return 'H01Q'
    elseif ( i2 == 33 ) then
      return 'H01R'
    elseif ( i2 == 34 ) then
      return 'H01S'

    elseif ( i2 == 35 ) then
      return 'H01T'
    elseif ( i2 == 36 ) then
      return 'H01U'
    elseif ( i2 == 37 ) then
      return 'H01V'

    elseif ( i2 == 38 ) then
      return 'H01W'
    elseif ( i2 == 39 ) then
      return 'H01X'
    elseif ( i2 == 40 ) then
      return 'H01Y'

    endif
  elseif ( i1 == 3 ) then
  //U2I. 유닛 타입을 정수로 반환. 위에부터 순서대로
    if ( i2 == 'H000' ) then
      return 1
    elseif ( i2 == 'H002' ) then
      return 2
    elseif ( i2 == 'H003' ) then
      return 3
    elseif ( i2 == 'H004' ) then
      return 4
    elseif ( i2 == 'H005' ) then
      return 5
    elseif ( i2 == 'H006' ) then
      return 6
    elseif ( i2 == 'H00U' ) then
      return 7
    elseif ( i2 == 'H00V' ) then
      return 8
    elseif ( i2 == 'H00W' ) then
      return 9
    elseif ( i2 == 'H00T' ) then
      return 10
    elseif ( i2 == 'H00X' ) then
      return 11
    elseif ( i2 == 'H00Y' ) then
      return 12
    elseif ( i2 == 'H010' ) then
      return 13
    elseif ( i2 == 'H011' ) then
      return 14
    elseif ( i2 == 'H012' ) then
      return 15
    elseif ( i2 == 'H013' ) then
      return 16
    elseif ( i2 == 'H014' ) then
      return 17
    elseif ( i2 == 'H015' ) then
      return 18
    elseif ( i2 == 'H016' ) then
      return 19
    elseif ( i2 == 'H01E' ) then
      return 20
    elseif ( i2 == 'H01F' ) then
      return 21
    elseif ( i2 == 'H01G' ) then
      return 22
    elseif ( i2 == 'H01H' ) then
      return 23
    elseif ( i2 == 'H01I' ) then
      return 24
    elseif ( i2 == 'H01J' ) then
      return 25
    elseif ( i2 == 'H01K' ) then
      return 26
    elseif ( i2 == 'H01L' ) then
      return 27
    elseif ( i2 == 'H01M' ) then
      return 28
      
    elseif ( i2 == 'H01N' ) then
      return 29
    elseif ( i2 == 'H01O' ) then
      return 30
    elseif ( i2 == 'H01P' ) then
      return 31
    elseif ( i2 == 'H01Q' ) then
      return 32
    elseif ( i2 == 'H01R' ) then
      return 33
    elseif ( i2 == 'H01S' ) then
      return 34
    elseif ( i2 == 'H01T' ) then
      return 35
    elseif ( i2 == 'H01U' ) then
      return 36
    elseif ( i2 == 'H01V' ) then
      return 37
    elseif ( i2 == 'H01W' ) then
      return 38
    elseif ( i2 == 'H01X' ) then
      return 39
    elseif ( i2 == 'H01Y' ) then
      return 40
    
    endif
  elseif ( i1 == 4 ) then
  //U2I. 유닛 타입을 정수로 반환2 (직업 체크, FMi_CheckClass와 연동, 2전사 3도적 4법사 5직자 6도가
    if ( i2 == 'H000' ) then
      return 1
    elseif ( i2 == 'H002' ) then
      return 2
    elseif ( i2 == 'H003' ) then
      return 3
    elseif ( i2 == 'H004' ) then
      return 4
    elseif ( i2 == 'H005' ) then
      return 5
    elseif ( i2 == 'H006' ) then
      return 6
      
    elseif ( i2 == 'H00U' ) then
      return 2
    elseif ( i2 == 'H00V' ) then
      return 3
    elseif ( i2 == 'H00W' ) then
      return 4
    elseif ( i2 == 'H00T' ) then
      return 5
    elseif ( i2 == 'H00X' ) then
    //승급도가
      return 6
    elseif ( i2 == 'H00Y' ) then
    //환탈도가
      return 6
    elseif ( i2 == 'H010' ) then
    //순수전사
      return 2
    elseif ( i2 == 'H011' ) then
      return 3
    elseif ( i2 == 'H012' ) then
      return 4
    elseif ( i2 == 'H013' ) then
      return 5
    elseif ( i2 == 'H014' ) then
    //도-전
      return 2
    elseif ( i2 == 'H015' ) then
    //법-전
      return 2
    elseif ( i2 == 'H016' ) then
    //직-전
      return 2
    elseif ( i2 == 'H01E' ) then
      return 3
    elseif ( i2 == 'H01F' ) then
      return 3
    elseif ( i2 == 'H01G' ) then
      return 3
    elseif ( i2 == 'H01H' ) then
      return 4
    elseif ( i2 == 'H01I' ) then
      return 4
    elseif ( i2 == 'H01J' ) then
      return 4
    elseif ( i2 == 'H01K' ) then
      return 5
    elseif ( i2 == 'H01L' ) then
      return 5
    elseif ( i2 == 'H01M' ) then
      return 5
      
    elseif ( i2 == 'H01N' ) then
      return 2
    elseif ( i2 == 'H01O' ) then
      return 2
    elseif ( i2 == 'H01P' ) then
      return 2
    elseif ( i2 == 'H01Q' ) then
      return 3
    elseif ( i2 == 'H01R' ) then
      return 3
    elseif ( i2 == 'H01S' ) then
      return 3
    elseif ( i2 == 'H01T' ) then
      return 4
    elseif ( i2 == 'H01U' ) then
      return 4
    elseif ( i2 == 'H01V' ) then
      return 4
    elseif ( i2 == 'H01W' ) then
      return 5
    elseif ( i2 == 'H01X' ) then
      return 5
    elseif ( i2 == 'H01Y' ) then
      return 5
    
    endif
  elseif ( i1 == 5 ) then
  //SysInt(5,GetUnitTypeId())
  //U2I. 유닛 타입을 정수로 반환3 (전직 전 직업 체크, 무기 추가착용 가능, FMi_CheckClass와 연동, 2전사 3도적 4법사 5직자 6도가
    if ( i2 == 'H014' ) then
    //전사 (도적, 법사, 직자)
      return 3
    elseif ( i2 == 'H015' ) then
      return 4
    elseif ( i2 == 'H016' ) then
      return 5
    elseif ( i2 == 'H01E' ) then
    //도적 (전사, 법사, 직자)
      return 2
    elseif ( i2 == 'H01F' ) then
      return 4
    elseif ( i2 == 'H01G' ) then
      return 5
    elseif ( i2 == 'H01H' ) then
    //법사 (전사, 도적, 직자)
      return 2
    elseif ( i2 == 'H01I' ) then
      return 3
    elseif ( i2 == 'H01J' ) then
      return 5
    elseif ( i2 == 'H01K' ) then
    //직자 (전사, 도적, 법사)
      return 2
    elseif ( i2 == 'H01L' ) then
      return 3
    elseif ( i2 == 'H01M' ) then
      return 4
    
    elseif ( i2 == 'H01N' ) then
      return 3
    elseif ( i2 == 'H01O' ) then
      return 4
    elseif ( i2 == 'H01P' ) then
      return 5

    elseif ( i2 == 'H01Q' ) then
      return 2
    elseif ( i2 == 'H01R' ) then
      return 4
    elseif ( i2 == 'H01S' ) then
      return 5

    elseif ( i2 == 'H01T' ) then
      return 2
    elseif ( i2 == 'H01U' ) then
      return 3
    elseif ( i2 == 'H01V' ) then
      return 5

    elseif ( i2 == 'H01W' ) then
      return 2
    elseif ( i2 == 'H01X' ) then
      return 3
    elseif ( i2 == 'H01Y' ) then
      return 4
    
    endif
  endif
 return -1
endfunction
function MSG takes player p, integer i, real r, string s returns nothing
  if ( i == -1 ) then
    call DisplayTimedTextToPlayer(p, .5+udg_SysA_AddValue, 0, 10, "|cffffdc3c버그입니다. 신고 해 주세요. [CODE: MSG-1 / " + s + " ]|r\n홈페이지 |cffFF0033http://cafe.naver.com/w3Lod")
  elseif ( i == 1 ) then
    call DisplayTimedTextToPlayer(p, .5+udg_SysA_AddValue, 0, r, "|cffffdc3c" + s + "|r" )
  elseif ( i == 2 ) then
    call DisplayTimedTextToPlayer(p, .5+udg_SysA_AddValue, 0, r, s + "|r" )
  elseif ( i == 3 ) then
    call DisplayTimedTextToPlayer(p, .5+udg_SysA_AddValue, 0, r, "|cffd1d1d1" + s + "|r" )
  elseif ( i == 4 ) then
    call DisplayTimedTextToPlayer(p, .5+udg_SysA_AddValue, 0, r, "|cffff3315" + s + "|r" )
  elseif ( i == 5 ) then
    if ( GetLocalPlayer() == p ) then
      call ClearTextMessages()
    endif
    call DisplayTimedTextToPlayer(p, 1., 1.1, r, "|cffffdc3c" + s + "|r" )
  elseif ( i == 6 ) then
  //퀘스트
    call DisplayTimedTextToPlayer(p, .5+udg_SysA_AddValue, 0, r, "|cffff8000" + s + "|r")
  elseif ( i == 7 ) then
    call DisplayTimedTextToPlayer(p, .5+udg_SysA_AddValue, 0, r, "|cfffd8505퀘스트 발동!!\n\n|cffffdc3c" + s + "|r")
  elseif ( i == 8 ) then
    call DisplayTimedTextToPlayer(p, .5+udg_SysA_AddValue, 0, r, "|cffffff00" + s + "|r" )
  elseif ( i == 9 ) then
    call DisplayTimedTextToPlayer(p, .5+udg_SysA_AddValue, 0, r, "|cff87F264＊초보자 팁#" + s + "\"|r" )
  elseif ( i == 10 ) then
    call DisplayTimedTextToPlayer(p, .5+udg_SysA_AddValue, 0, r, "\n|cff55ff55＊초보자 지침서! - |c00ff8040" + s + "|cff55ff55/35|r" )
  elseif ( i == 11 ) then
    call DisplayTimedTextToPlayer(p, .5+udg_SysA_AddValue, 0, r, "|cffc3dbff　└목표 : |cff9f9f9f" + s + "|r\n" )
  elseif ( i == 12 ) then
    call DisplayTimedTextToPlayer(p, .5+udg_SysA_AddValue, 0, r, SysStr(2,bj_forLoopAIndex)+GetPlayerName(Player(bj_forLoopAIndex-1))+"|cffffff00님은 사기 의심 유저입니다. 이 스샷을 찍어서 홈페이지에 올려주세요. ["+s+"]."+"|c0080C8FF["+StringCase(udg_SysB_Name[bj_forLoopAIndex],true)+"|cff80C8FF]\n"+BaseStr(7)+"|r")
  elseif ( i == 13 ) then
  //파티 관련 메시지
    call DisplayTimedTextToPlayer(p, .5+udg_SysA_AddValue, 0, r, "|c00d962b5＊|cffffdc3c" + s + "|r" )  
  elseif ( i == 14 ) then
    call DisplayTimedTextToPlayer(p, .5+udg_SysA_AddValue, 0, r, "|cfffd8505퀘스트 완료!!\n\n|cffffdc3c" + s + "|r")
  elseif ( i == 15 ) then
  //선택지
    call DisplayTimedTextToPlayer(p, .5+udg_SysA_AddValue, 0, r-2, BaseStr(6) + "\n" + s + "\n\n|r(선택지 앞 숫자를 입력하세요. 제한시간: "+I2S(R2I(r))+"초)")
  else
    call MSG(p, -1, 0, I2S(i) + " / " + s)
  endif
  set p = null
endfunction
//call MSG(GetTriggerPlayer(), 1, 8, BaseStr(10))
function MSGAll takes integer P, boolean all, integer lv, integer i, real r, string s returns nothing
  local integer A = 0
  if ( P < 0 ) then
    set A = bj_MAX_PLAYERS
    if ( i == 12 ) then
      loop
        exitwhen A <= 0
        if ( A != -P ) and ( udg_SysB_Level[A] >= lv ) then
          call DisplayTimedTextToPlayer(Player(A-1), .5, 0, r, SysStr(2,-P)+udg_SysB_Name[-P]+"|cffffff00님은 사기 의심 유저입니다. 이 스샷을 찍어서 홈페이지에 올려주세요. ["+s+"]."+"|c0080C8FF["+StringCase(udg_SysB_Name[-P],true)+"|cff80C8FF]\n"+BaseStr(7)+"|r")
        endif
        set A = A - 1
      endloop
    else
      loop
        exitwhen A <= 0
        if ( A != -P ) and ( udg_SysB_Level[A] >= lv ) then
          call MSG(Player(A-1), i, r, s)
        endif
        set A = A - 1
      endloop
    endif
  elseif ( all ) or ( udg_PartyNumber_ThisP[P] != 0 ) then
    set A = bj_MAX_PLAYERS
    loop
      exitwhen A == 0
      if ( all ) or (( udg_PartyNumber_ThisP[A] == udg_PartyNumber_ThisP[P] ) and ( udg_SysB_Level[A] >= lv )) then
          call MSG(Player(A-1), i, r, s)
      endif
      set A = A - 1
    endloop
  elseif ( P > 0 ) then
    call MSG(Player(P-1), i, r, s)
  endif
endfunction
//동맹인+99레벨에게. call MSGAll(P, false, 99, 1, 4, "")
//모든 플레이어에게. call MSGAll(0, true, 1, 2, 15., "")
//이 사람 빼고. call MSGAll(-1, true, 1, 2, 8., "")
//call MSGAll(-P, true, 1, 12, 20., udg_temp_s)

function FormatI2S takes integer value, integer len returns string
 local string str = ""
 local integer i = 0
  loop
    set i = i + 1
    set str = str + "0"
    exitwhen i >= len
  endloop
  set str = str + I2S(value)
  set str = SubString(str ,StringLength(str)-len , StringLength(str) )
 return str
endfunction
function FSE_Rest takes integer input returns string
 local string s = ""
  if ( input < 0 ) then
    return "-" + FSE_Rest(-input)
  endif
  loop
    if ( input > 999 ) then
      set s = FormatI2S(ModuloInteger(input,1000),3) + s
    else
      return I2S(input)+s
    endif
    set input = input / 1000
    exitwhen input <= 0
    set s = "," + s
  endloop
  return s
endfunction
function FSE_I2S takes integer input, integer max returns string
 local string s = ""
  if ( input > max ) then
    set input = max
  elseif ( input < 0 ) then
    set input = 0
  endif
  set s = I2S(input)
  if ( StringLength(s) < StringLength(I2S(max)) ) then
    loop
      exitwhen StringLength(s) == StringLength(I2S(max))
      set s = "0" + s
    endloop
  endif
  return s
endfunction
function FSE_I2SW takes integer input, integer Length returns string
 local string s = ""
 local integer i = 0
  loop
    set i = ModuloInteger(input,SysInt(0,1))
    set s = SubString(BaseStr(1),i,i+1) + s
    set input = input/SysInt(0,1)
    exitwhen input == 0
  endloop
  loop
    exitwhen StringLength(s) == Length
    set s = SubString(BaseStr(1),0,1) + s
  endloop
  return s
endfunction
constant function FSE_S2Iing takes string s returns integer
  if ( s == "1" ) then
    return 0
  elseif ( s == "9" ) then
    return 1
  elseif ( s == "4" ) then
    return 2
  elseif ( s == "K" ) then
    return 3
  elseif ( s == "0" ) then
    return 4
  elseif ( s == "N" ) then
    return 5
  elseif ( s == "u" ) then
    return 6
  elseif ( s == "W" ) then
    return 7
  elseif ( s == "C" ) then
    return 8
  elseif ( s == "g" ) then
    return 9
  elseif ( s == "M" ) then
    return 10
  elseif ( s == "c" ) then
    return 11
  elseif ( s == "k" ) then
    return 12
  elseif ( s == "S" ) then
    return 13
  elseif ( s == "2" ) then
    return 14
  elseif ( s == "D" ) then
    return 15
  elseif ( s == "J" ) then
    return 16
  elseif ( s == "E" ) then
    return 17
  elseif ( s == "p" ) then
    return 18
  elseif ( s == "O" ) then
    return 19
  elseif ( s == "s" ) then
    return 20
  elseif ( s == "A" ) then
    return 21
  elseif ( s == "L" ) then
    return 22
  elseif ( s == "x" ) then
    return 23
  elseif ( s == "v" ) then
    return 24
  elseif ( s == "Z" ) then
    return 25
  elseif ( s == "b" ) then
    return 26
  elseif ( s == "y" ) then
    return 27
  elseif ( s == "Y" ) then
    return 28
  elseif ( s == "a" ) then
    return 29
  elseif ( s == "n" ) then
    return 30
  elseif ( s == "T" ) then
    return 31
  elseif ( s == "P" ) then
    return 32
  elseif ( s == "8" ) then
    return 33
  elseif ( s == "e" ) then
    return 34
  elseif ( s == "h" ) then
    return 35
  elseif ( s == "m" ) then
    return 36
  elseif ( s == "V" ) then
    return 37
  elseif ( s == "B" ) then
    return 38
  elseif ( s == "Q" ) then
    return 39
  elseif ( s == "H" ) then
    return 40
  elseif ( s == "z" ) then
    return 41
  elseif ( s == "f" ) then
    return 42
  elseif ( s == "5" ) then
    return 43
  elseif ( s == "F" ) then
    return 44
  elseif ( s == "r" ) then
    return 45
  elseif ( s == "w" ) then
    return 46
  elseif ( s == "R" ) then
    return 47
  elseif ( s == "X" ) then
    return 48
  elseif ( s == "t" ) then
    return 49
  elseif ( s == "o" ) then
    return 50
  elseif ( s == "7" ) then
    return 51
  elseif ( s == "d" ) then
    return 52
  elseif ( s == "G" ) then
    return 53
  elseif ( s == "q" ) then
    return 54
  elseif ( s == "6" ) then
    return 55
  elseif ( s == "U" ) then
    return 56
  elseif ( s == "3" ) then
    return 57
  else
    return 0
  endif
endfunction
function FSE_S2I takes string input returns integer
 local integer ri = 0
 local integer i = 0
  loop
    set ri = ri * SysInt(0,1)
    set ri = ri + FSE_S2Iing(SubString(input,i,i+1))
    set i = i + 1
    exitwhen i == StringLength(input)
  endloop
  return ri
endfunction
function FSE_I2E takes unit u, integer per returns integer
 local unit t = CreateUnit(Player(12),GetUnitTypeId(u),0,0,bj_UNIT_FACING)
 local integer Exp = 0
  if ( GetHeroLevel(u) > 1 ) then
    call SetHeroLevel(t, GetHeroLevel(u), false)
    set Exp = GetHeroXP(t)
  endif
  call SetHeroLevel(t, GetHeroLevel(u)+1, false)
  set Exp = GetHeroXP(t)-Exp
  call RemoveUnit(t)
  set t = null
  set u = null
 //return Exp*per/1000
 return R2I(I2R(Exp)/1000.)*per
endfunction
function FSE_E2I takes unit u returns integer
 local unit t = CreateUnit(Player(12),GetUnitTypeId(u),0,0,bj_UNIT_FACING)
 local real Exp = 0.
  if ( GetHeroLevel(u) > 1 ) then
    call SetHeroLevel(t,GetHeroLevel(u),false)
    set Exp = I2R(GetHeroXP(t))
  endif
  call SetHeroLevel(t,GetHeroLevel(u)+1,false)
  set Exp = (I2R(GetHeroXP(u))-Exp)/(I2R(GetHeroXP(t))-Exp)*1000.
  call RemoveUnit(t)
  set t = null
  set u = null
 return R2I(RMaxBJ(RMinBJ(Exp,999.),0))
endfunction
function P2I takes string ID returns integer
 return ModuloInteger(IAbsBJ(StringHash(ID))+5,1000)
endfunction
constant function FSE_Convert takes integer input, boolean o returns integer
//문자 순서를 무작위로 섞음. 1~76(메인코드), 73~84(서브코드) 안섞이게 따로.
  if ( o ) then
    if ( input == 0 ) then
      return 76
    elseif ( input == 1 ) then
      return 35
    elseif ( input == 2 ) then
      return 10
    elseif ( input == 3 ) then
      return 60
    elseif ( input == 4 ) then
      return 43
    elseif ( input == 5 ) then
      return 64
    elseif ( input == 6 ) then
      return 42
    elseif ( input == 7 ) then
      return 32
    elseif ( input == 8 ) then
      return 53
    elseif ( input == 9 ) then
      return 18
    elseif ( input == 10 ) then
      return 8
    elseif ( input == 11 ) then
      return 59
    elseif ( input == 12 ) then
      return 15
    elseif ( input == 13 ) then
      return 17
    elseif ( input == 14 ) then
      return 23
    elseif ( input == 15 ) then
      return 30
    elseif ( input == 16 ) then
      return 11
    elseif ( input == 17 ) then
      return 75
    elseif ( input == 18 ) then
      return 56
    elseif ( input == 19 ) then
      return 7
    elseif ( input == 20 ) then
      return 41
    elseif ( input == 21 ) then
      return 31
    elseif ( input == 22 ) then
      return 47
    elseif ( input == 23 ) then
      return 1
    elseif ( input == 24 ) then
      return 12
    elseif ( input == 25 ) then
      return 33
    elseif ( input == 26 ) then
      return 55
    elseif ( input == 27 ) then
      return 67
    elseif ( input == 28 ) then
      return 57
    elseif ( input == 29 ) then
      return 52
    elseif ( input == 30 ) then
      return 13
    elseif ( input == 31 ) then
      return 39
    elseif ( input == 32 ) then
      return 68
    elseif ( input == 33 ) then
      return 72
    elseif ( input == 34 ) then
      return 9
    elseif ( input == 35 ) then
      return 27
    elseif ( input == 36 ) then
      return 22
    elseif ( input == 37 ) then
      return 4
    elseif ( input == 38 ) then
      return 50
    elseif ( input == 39 ) then
      return 46
    elseif ( input == 40 ) then
      return 37
    elseif ( input == 41 ) then
      return 70
    elseif ( input == 42 ) then
      return 58
    elseif ( input == 43 ) then
      return 63
    elseif ( input == 44 ) then
      return 65
    elseif ( input == 45 ) then
      return 14
    elseif ( input == 46 ) then
      return 25
    elseif ( input == 47 ) then
      return 2
    elseif ( input == 48 ) then
      return 34
    elseif ( input == 49 ) then
      return 24
    elseif ( input == 50 ) then
      return 74
    elseif ( input == 51 ) then
      return 5
    elseif ( input == 52 ) then
      return 45
    elseif ( input == 53 ) then
      return 71
    elseif ( input == 54 ) then
      return 62
    elseif ( input == 55 ) then
      return 20
    elseif ( input == 56 ) then
      return 48
    elseif ( input == 57 ) then
      return 16
    elseif ( input == 58 ) then
      return 61
    elseif ( input == 59 ) then
      return 66
    elseif ( input == 60 ) then
      return 38
    elseif ( input == 61 ) then
      return 19
    elseif ( input == 62 ) then
      return 49
    elseif ( input == 63 ) then
      return 29
    elseif ( input == 64 ) then
      return 3
    elseif ( input == 65 ) then
      return 26
    elseif ( input == 66 ) then
      return 69
    elseif ( input == 67 ) then
      return 73
    elseif ( input == 68 ) then
      return 40
    elseif ( input == 69 ) then
      return 44
    elseif ( input == 70 ) then
      return 21
    elseif ( input == 71 ) then
      return 6
    elseif ( input == 72 ) then
      return 36
    elseif ( input == 73 ) then
      return 51
    elseif ( input == 74 ) then
      return 54
    elseif ( input == 75 ) then
      return 76
    elseif ( input == 76 ) then
      return 28
    elseif ( input == 77 ) then
      return 83
    elseif ( input == 78 ) then
      return 80
    elseif ( input == 79 ) then
      return 84
    elseif ( input == 80 ) then
      return 81
    elseif ( input == 81 ) then
      return 78
    elseif ( input == 82 ) then
      return 79
    elseif ( input == 83 ) then
      return 82
    elseif ( input == 84 ) then
      return 77
    endif
  else
    //역반환
    if ( input == 0 ) then
      return 84
        elseif ( input == 35 ) then
      return 1
    elseif ( input == 10 ) then
      return 2
    elseif ( input == 60 ) then
      return 3
    elseif ( input == 43 ) then
      return 4
    elseif ( input == 64 ) then
      return 5
    elseif ( input == 42 ) then
      return 6
    elseif ( input == 32 ) then
      return 7
    elseif ( input == 53 ) then
      return 8
    elseif ( input == 18 ) then
      return 9
    elseif ( input == 8 ) then
      return 10
    elseif ( input == 59 ) then
      return 11
    elseif ( input == 15 ) then
      return 12
    elseif ( input == 17 ) then
      return 13
    elseif ( input == 23 ) then
      return 14
    elseif ( input == 30 ) then
      return 15
    elseif ( input == 11 ) then
      return 16
    elseif ( input == 75 ) then
      return 17
    elseif ( input == 56 ) then
      return 18
    elseif ( input == 7 ) then
      return 19
    elseif ( input == 41 ) then
      return 20
    elseif ( input == 31 ) then
      return 21
    elseif ( input == 47 ) then
      return 22
    elseif ( input == 1 ) then
      return 23
    elseif ( input == 12 ) then
      return 24
    elseif ( input == 33 ) then
      return 25
    elseif ( input == 55 ) then
      return 26
    elseif ( input == 67 ) then
      return 27
    elseif ( input == 57 ) then
      return 28
    elseif ( input == 52 ) then
      return 29
    elseif ( input == 13 ) then
      return 30
    elseif ( input == 39 ) then
      return 31
    elseif ( input == 68 ) then
      return 32
    elseif ( input == 72 ) then
      return 33
    elseif ( input == 9 ) then
      return 34
    elseif ( input == 27 ) then
      return 35
    elseif ( input == 22 ) then
      return 36
    elseif ( input == 4 ) then
      return 37
    elseif ( input == 50 ) then
      return 38
    elseif ( input == 46 ) then
      return 39
    elseif ( input == 37 ) then
      return 40
    elseif ( input == 70 ) then
      return 41
    elseif ( input == 58 ) then
      return 42
    elseif ( input == 63 ) then
      return 43
    elseif ( input == 65 ) then
      return 44
    elseif ( input == 14 ) then
      return 45
    elseif ( input == 25 ) then
      return 46
    elseif ( input == 2 ) then
      return 47
    elseif ( input == 34 ) then
      return 48
    elseif ( input == 24 ) then
      return 49
    elseif ( input == 74 ) then
      return 50
    elseif ( input == 5 ) then
      return 51
    elseif ( input == 45 ) then
      return 52
    elseif ( input == 71 ) then
      return 53
    elseif ( input == 62 ) then
      return 54
    elseif ( input == 20 ) then
      return 55
    elseif ( input == 48 ) then
      return 56
    elseif ( input == 16 ) then
      return 57
    elseif ( input == 61 ) then
      return 58
    elseif ( input == 66 ) then
      return 59
    elseif ( input == 38 ) then
      return 60
    elseif ( input == 19 ) then
      return 61
    elseif ( input == 49 ) then
      return 62
    elseif ( input == 29 ) then
      return 63
    elseif ( input == 3 ) then
      return 64
    elseif ( input == 26 ) then
      return 65
    elseif ( input == 69 ) then
      return 66
    elseif ( input == 73 ) then
      return 67
    elseif ( input == 40 ) then
      return 68
    elseif ( input == 44 ) then
      return 69
    elseif ( input == 21 ) then
      return 70
    elseif ( input == 6 ) then
      return 71
    elseif ( input == 36 ) then
      return 72
    elseif ( input == 51 ) then
      return 73
    elseif ( input == 54 ) then
      return 74
    elseif ( input == 76 ) then
      return 75
    elseif ( input == 28 ) then
      return 76
    elseif ( input == 83 ) then
      return 77
    elseif ( input == 80 ) then
      return 78
    elseif ( input == 84 ) then
      return 79
    elseif ( input == 81 ) then
      return 80
    elseif ( input == 78 ) then
      return 81
    elseif ( input == 79 ) then
      return 82
    elseif ( input == 82 ) then
      return 83
    elseif ( input == 77 ) then
      return 84
    endif
  endif
 return -1
endfunction
function UnitAlive takes unit u returns boolean
  return u!=null and not IsUnitType(u, UNIT_TYPE_DEAD)
endfunction
constant function FSE_Coloring takes string input returns string
  if ( input == "A" ) then
    return "|cff21cd3a"
  elseif ( input == "B" ) then
    return "|cff21cd3a"
  elseif ( input == "C" ) then
    return "|cff21cd3a"
  elseif ( input == "D" ) then
    return "|cff21cd3a"
  elseif ( input == "E" ) then
    return "|cff21cd3a"
  elseif ( input == "F" ) then
    return "|cff21cd3a"
  elseif ( input == "G" ) then
    return "|cff21cd3a"
  elseif ( input == "H" ) then
    return "|cff21cd3a"
  elseif ( input == "J" ) then
    return "|cff21cd3a"
  elseif ( input == "K" ) then
    return "|cff21cd3a"
  elseif ( input == "L" ) then
    return "|cff21cd3a"
  elseif ( input == "M" ) then
    return "|cff21cd3a"
  elseif ( input == "N" ) then
    return "|cff21cd3a"
  elseif ( input == "O" ) then
    return "|cff21cd3a"
  elseif ( input == "P" ) then
    return "|cff21cd3a"
  elseif ( input == "Q" ) then
    return "|cff21cd3a"
  elseif ( input == "R" ) then
    return "|cff21cd3a"
  elseif ( input == "S" ) then
    return "|cff21cd3a"
  elseif ( input == "T" ) then
    return "|cff21cd3a"
  elseif ( input == "U" ) then
    return "|cff21cd3a"
  elseif ( input == "V" ) then
    return "|cff21cd3a"
  elseif ( input == "W" ) then
    return "|cff21cd3a"
  elseif ( input == "X" ) then
    return "|cff21cd3a"
  elseif ( input == "Y" ) then
    return "|cff21cd3a"
  elseif ( input == "Z" ) then
    return "|cff21cd3a"
  elseif ( input == "0" ) then
    return "|cff218def"
  elseif ( input == "1" ) then
    return "|cff218def"
  elseif ( input == "2" ) then
    return "|cff218def"
  elseif ( input == "3" ) then
    return "|cff218def"
  elseif ( input == "4" ) then
    return "|cff218def"
  elseif ( input == "5" ) then
    return "|cff218def"
  elseif ( input == "6" ) then
    return "|cff218def"
  elseif ( input == "7" ) then
    return "|cff218def"
  elseif ( input == "8" ) then
    return "|cff218def"
  elseif ( input == "9" ) then
    return "|cff218def"
  elseif ( input == "a" ) then
    return "|cffdddd21"
  elseif ( input == "b" ) then
    return "|cffdddd21"
  elseif ( input == "c" ) then
    return "|cffdddd21"
  elseif ( input == "d" ) then
    return "|cffdddd21"
  elseif ( input == "e" ) then
    return "|cffdddd21"
  elseif ( input == "f" ) then
    return "|cffdddd21"
  elseif ( input == "g" ) then
    return "|cffdddd21"
  elseif ( input == "h" ) then
    return "|cffdddd21"
  elseif ( input == "k" ) then
    return "|cffdddd21"
  elseif ( input == "m" ) then
    return "|cffdddd21"
  elseif ( input == "n" ) then
    return "|cffdddd21"
  elseif ( input == "o" ) then
    return "|cffdddd21"
  elseif ( input == "p" ) then
    return "|cffdddd21"
  elseif ( input == "q" ) then
    return "|cffdddd21"
  elseif ( input == "r" ) then
    return "|cffdddd21"
  elseif ( input == "s" ) then
    return "|cffdddd21"
  elseif ( input == "t" ) then
    return "|cffdddd21"
  elseif ( input == "u" ) then
    return "|cffdddd21"
  elseif ( input == "v" ) then
    return "|cffdddd21"
  elseif ( input == "w" ) then
    return "|cffdddd21"
  elseif ( input == "x" ) then
    return "|cffdddd21"
  elseif ( input == "y" ) then
    return "|cffdddd21"
  elseif ( input == "z" ) then
    return "|cffdddd21"
  else
    return ""
  endif
endfunction
function FSE_Coding takes string input, boolean save returns string
//코드를 섞음. "ABC",true == "BCA",false
 local integer i = StringLength(input)
 local string s = ""
  if ( i == FSE_Convert(0,true) ) then
    set i = 1
    if ( save ) then
      loop
        exitwhen i > FSE_Convert(0,true)
        set s = s + SubString(input,FSE_Convert(i,true)-1,FSE_Convert(i,true))
        set i = i + 1
      endloop
    else
      loop
        exitwhen i > FSE_Convert(0,true)
        set s = s + SubString(input,FSE_Convert(i,false)-1,FSE_Convert(i,false))
        set i = i + 1
      endloop
    endif
  elseif ( i == FSE_Convert(0,false) ) then
    set i = 1
    if ( save ) then
      loop
        exitwhen i > FSE_Convert(0,false)
        set s = s + SubString(input,FSE_Convert(i,true)-1,FSE_Convert(i,true))
        set i = i + 1
      endloop
    else
      loop
        exitwhen i > FSE_Convert(0,false)
        set s = s + SubString(input,FSE_Convert(i,false)-1,FSE_Convert(i,false))
        set i = i + 1
      endloop
    endif
  else
    return "ERROR-Coding!=[0]"
  endif
 return s
endfunction
function FSE_CC takes string input, string t, integer m returns string
 local integer i = 0
 local string s = ""
 local string temp = ""
  loop
    exitwhen i > StringLength(input)
    if ( m*i != 0 and i != StringLength(input) and ModuloInteger(i,m) == 0 ) then
      set temp = ""
      set s = s + "|r-"
    endif
    if ( SubString(input,i,i+1) == SubString(t,i,i+1) ) then
      if ( temp == FSE_Coloring(SubString(input,i,i+1)) ) then
        set s = s + SubString(input,i,i+1)
      else
        set temp = FSE_Coloring(SubString(input,i,i+1))
        set s = s + temp + SubString(input,i,i+1)
      endif
    elseif ( SubString(input,i,i+1) != SubString(t,i,i+1) ) then
      if ( temp == BaseStr(5) ) then
        set s = s + SubString(input,i,i+1)
      else
        set temp = BaseStr(5)
        set s = s + temp + SubString(input,i,i+1)
      endif
    endif
    set i = i + 1
  endloop

  return s + "|r"
endfunction
function FSE_ColorX takes string input returns string
 local integer i = 0
 local string s = ""
  set input = JNStringTrim(input)
  if ( StringCase(SubString(input,0,5),true) == "-LOAD" ) then
    set input = SubString(input,6,StringLength(input))
  endif
  loop
    exitwhen i > StringLength(input)
    set s = SubString(input,i,i+1)
    if ( s == "|" ) then
      if ( StringCase(SubString(input,i,i+2),false) == "|r" ) then
        set input = SubString(input,0,i) + SubString(input,i+2,StringLength(input))
        set i = i - 1
      elseif ( StringCase(SubString(input,i,i+2),false) == "|c" ) then
        set input = SubString(input,0,i) + SubString(input,i+10,StringLength(input))
        set i = i - 1
      else
        return "ERROR-ColorX"
      endif
    elseif ( s == "-" ) then 
      set input = SubString(input,0,i) + SubString(input,i+1,StringLength(input))
      set i = i - 1
    elseif ( s == " " ) then
      set input = SubString(input,0,i) + SubString(input,i+1,StringLength(input))
      set i = i - 1
    endif
    set i = i + 1
  endloop
 return input
endfunction
function FSE_Color takes string input, integer m returns string
 local integer i = 0
 local string s = ""
 local string temp = ""
  loop
    exitwhen i > StringLength(input)
    if ( m*i != 0 and i != StringLength(input) and ModuloInteger(i,m) == 0 ) then
      set temp = ""
      set s = s + "|r-"
    endif
    if ( temp == FSE_Coloring(SubString(input,i,i+1)) ) then
      set s = s + SubString(input,i,i+1)
    else
      set temp = FSE_Coloring(SubString(input,i,i+1))
      set s = s + temp + SubString(input,i,i+1)
    endif
    set i = i + 1
  endloop

 return s + "|r"
endfunction
function GetHPMP takes integer P, boolean hp returns integer
  if ( hp ) then
    return (udg_SysB_Level[P]-1)*SysInt(0,17) + SysInt(0,35) + (udg_SysE_CON1[P]*SysInt(0,33)) + udg_Save_HP[P]
  else
    return (udg_SysB_Level[P]-1)*SysInt(0,18) + SysInt(0,36) + (udg_SysE_WIS1[P]*SysInt(0,34)) + udg_Save_MP[P]
  endif
endfunction

function CountItem takes integer P, integer keyitem returns integer
 local integer i = StringHash("FMi_Item"+I2S(P))
 local integer j = 1
  loop
    exitwhen j >= FMI_MAXMAX_INVENTORY
	if ( GetItemTypeId(LoadItemHandle(udg_hash, i, j)) == keyitem ) then
      return GetItemCharges(LoadItemHandle(udg_hash, i, j))
    endif
    set j = j + 1
  endloop
  return -1
endfunction
//i = CountItem(P, 'I000')인벤토리의 해당 아이템 개수 반환, 없으면 0
constant function isNamed takes integer i, boolean class returns integer
  if ( i > 0 and i <= 90 ) then
  //이후 조절
    if ( class ) then
	  return (i-1)/5+1
	else
	  set i = i-(i/5)*5
	  if ( i == 0 ) then
	    return 5
	  else
	    return i
	  endif
	endif
  else
    return 0
  endif
endfunction
function Save takes integer P, boolean b returns boolean
 local integer i = 0
 local integer j = 0
 local item tempItem = null
 local string Code = ""
 local string tempCode = ""
  if ( ExctTest[P] ) then
    call MSG(Player(P-1), 2, 8, "세이브 |cffff0000실패! |r - |cffffdc3c'-테스트' 명령어로 인해 저장이 되지 않습니다.")
    return false
  endif
  //자원
  set tempCode = FSE_I2S((GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD)+500)/1000, 999)
  set tempCode = tempCode + FSE_I2S(GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER), 999)
  //영웅 관련
  if ( UnitAlive(udg_Unit[P]) ) then
    set i = SysInt(3,GetUnitTypeId(udg_Unit[P]))
    if ( i == 0 ) or ( i > SysInt(1,0) ) then
      call MSG(Player(P-1), 2, 8, "세이브 |cffff0000실패! |r - |cffffdc3c영웅의 타입이 올바르지 않습니다.|r " + I2S(i))
      return false
    else
      set tempCode = tempCode + FSE_I2S(i, 99)
    endif
  else
    call MSG(Player(P-1), 2, 8, "세이브 |cffff0000실패! |r - |cffffdc3c세이브 대상이 영웅이 아니거나 사망하여 있습니다." + I2S(i))
    return false
  endif
  set tempCode = tempCode + FSE_I2S(GetHeroLevel(udg_Unit[P]), 99)
  set i = FSE_E2I(udg_Unit[P])
  set tempCode = tempCode + FSE_I2S(i, 999)
 
  set udg_SavedString[P] = "아이디: " + udg_SysB_Name[P] + "|직업: " + GetUnitName(udg_Unit[P]) + " - Lv" + I2S(udg_SysB_Level[P]) + "|체마: " + FSE_Rest(GetHPMP(P,true)) + "/" + FSE_Rest(GetHPMP(P,false)) + "|경험치: " + R2SW(I2R(i)/10.,2,1) + "％" + "|소유금: " + I2S(GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD)/1000) + ",000 Gold" + "|포인트: " + I2S(GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)) + " Point|시간: " + I2S(udg_MT_TimerHou) + "시간 " + I2S(udg_MT_TimerMin) + "분|버전: " + BaseStr(9) + "|※내용은 지워도 상관없습니다. 코드만 남기세요."
 
  set tempCode = tempCode + FSE_I2S(udg_SysE_STR1[P], SysInt(0,8))
  set tempCode = tempCode + FSE_I2S(udg_SysE_DEX1[P], SysInt(0,8))
  set tempCode = tempCode + FSE_I2S(udg_SysE_INT1[P], SysInt(0,8))
  set tempCode = tempCode + FSE_I2S(udg_SysE_WIS1[P], SysInt(0,8))
  set tempCode = tempCode + FSE_I2S(udg_SysE_CON1[P], SysInt(0,8))
//Status
  set tempCode = tempCode + FSE_I2S(ModuloInteger(udg_Save_HP[P],100000), 99999)
  set tempCode = tempCode + FSE_I2S(ModuloInteger(udg_Save_MP[P],100000), 99999)
  set i = 1
  loop
    if ( GetUnitAbilityLevel(udg_Unit[P], LoadInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(i)))) > 0 ) then
      set tempCode = tempCode + FSE_I2S(LoadInteger(udg_hash, StringHash("Skill"), LoadInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(i)))),800)
      if ( GetUnitAbilityLevel(udg_Unit[P], LoadInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(i)))) > 1 ) then
        set tempCode = tempCode + FSE_I2S(GetUnitAbilityLevel(udg_Unit[P], LoadInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(i))))-1,9)
      else
        set tempCode = tempCode + "0"
      endif
    else
      set tempCode = tempCode + I2S(GetRandomInt(8010,9999))
    endif
    exitwhen i == 7
    set i = i + 1
  endloop
//아이템, 장착된

  set i = FMI_MAXMAX_INVENTORY+1
  set j = 0
  loop
    set tempItem = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), i)
    if ( tempItem != null ) and HaveSavedInteger(udg_hash,GetItemTypeId(tempItem),StringHash("FSE_T2I")) then
//debug call BJDebugMsg("Saving..4 "+I2S(i)+"번째 Item: +"+GetItemName(tempItem))
      set Code = Code + FSE_I2S(LoadInteger(udg_hash,GetItemTypeId(tempItem),StringHash("FSE_T2I")),800)
      set Code = Code + FSE_I2S(GetItemCharges(tempItem),99)
      set j = j + isNamed(GetItemCharges(tempItem),false)
      call SetItemUserData(tempItem, P)
    else
      set Code = Code + FSE_I2S(GetRandomInt(80100,99999),99999)
    endif
    exitwhen i >= FMI_MAXMAX_INVENTORY+12
    set i = i + 1
  endloop
  set tempCode = tempCode + Code
  call RankEx_HighSave(P, 6, j, GetUnitName(udg_Unit[P]))
  
  //더미값 4칸 -> 체력, 마력
  //set tempCode = tempCode + "0000"
  set tempCode = tempCode + FSE_I2S(udg_Save_HP[P]/100000, 99)
  set tempCode = tempCode + FSE_I2S(udg_Save_MP[P]/100000, 99)
  
  
//1~28 인벤토리 아이템은 별도 저장
/* Check 제거 -> 서버저장 하니까
//Check
  set i = 0
  set Code = ""
  loop
    exitwhen i >= StringLength(tempCode)
    set Code = I2S(S2I(Code) + S2I(SubString(tempCode,i,i+5)))
    set i = i + 5
  endloop
//debug call BJDebugMsg("Saving..5 "+I2S(i)+"번째 Code +"+SubString(tempCode,i,i+5)+"="+Code)
  set Code = FSE_I2S(ModuloInteger(S2I(Code)+P2I(udg_SysB_Name[P]),1000),999)
//debug call BJDebugMsg("Saving..6, +"+I2S(P2I(udg_SysB_Name[P]))+"=: "+Code)
  set udg_Save_Code2[P] = Code
//debug call BJDebugMsg("Save..7, 코드 연동 값: ("+I2S(StringLength(udg_Save_Code2[P]))+"): "+udg_Save_Code2[P])
  //Code2
  set tempCode = Code + tempCode
*/
  set tempCode = "000" + tempCode
  
  set udg_Save_CodeOri[P] = tempCode
  //코드가 제일 앞에 옴
//Incoding
  set i = 0
  set Code = ""
  loop
    exitwhen i+7 > StringLength(tempCode)
    set Code = Code + FSE_I2SW(S2I(SubString(tempCode,i,i+7)),4)
    set i=i+7
  endloop
//set tempCode = Code
//debug call BJDebugMsg("Save..8, 변환 전 코드("+I2S(StringLength(tempCode))+"): "+tempCode)
  set udg_Save_Code[P] = FSE_Coding(Code,true)
//debug call BJDebugMsg("Save..9, SaveCode("+I2S(StringLength(udg_Save_Code[P]))+"): "+udg_Save_Code[P])
//Removing
  if ( b ) then
    call RemoveUnit(udg_Unit[P])
  endif
  return true
endfunction
function Save2 takes integer P returns nothing
 local integer i = 1
 local string Code = ""
 local item tempItem = null
  loop
    set tempItem = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), i)
    if ( tempItem != null ) and HaveSavedInteger(udg_hash,GetItemTypeId(tempItem),StringHash("FSE_T2I")) then
//debug call BJDebugMsg("Save2 - 1.. "+I2S(i)+"번째 item: +"+GetItemName(tempItem))
      set Code = Code + FSE_I2S(LoadInteger(udg_hash,GetItemTypeId(tempItem),StringHash("FSE_T2I")),800)
      if ( GetItemTypeId(tempItem) == 'I084' ) then
        if ( GetItemCharges(tempItem) > 999 ) then
          set Code = Code + "99"
        else
          set Code = Code + FSE_I2S(ModuloInteger(GetItemCharges(tempItem),100),99)
        endif
      else
        set Code = Code + FSE_I2S(GetItemCharges(tempItem),99)
      endif
      call SetItemUserData(tempItem, P)
    else
      set Code = Code + FSE_I2S(GetRandomInt(80100,99999),99999)
    endif
    exitwhen i >= FMI_MAX_INVENTORY
    set i = i + 1
  endloop
  
  //(역순)더미값[1] + 체크값[3] + 메인세이브코드[3] + 아이템값[140]
  /* 체크 제거 : 서버저장 하니까 */
  //set udg_Save_Code2[P] = udg_Save_Code2[P] + "000000"
  /*
    //Main
  set udg_Save_Code2[P] = udg_Save_Code2[P] + Code
    //체크 계산
  set i = 3
  set Code = ""
  loop
    exitwhen i >= StringLength(udg_Save_Code2[P])
    set Code = I2S(S2I(Code) + S2I(SubString(udg_Save_Code2[P],i,i+5)))
//debug call BJDebugMsg("Save2..3 "+I2S(i)+"번째 Code +"+SubString(udg_Save_Code2[P],i,i+5)+"="+Code)
    set i = i + 5
  endloop
//debug call BJDebugMsg("2_Saving..1 "+I2S(i)+"번째 Code +"+SubString(udg_Save_Code2[P],i,i+5)+"="+Code)
//debug call BJDebugMsg("2_Saving..2, Code("+I2S(StringLength(Code))+"): "+Code+" + P2I("+I2S(StringLength(I2S(P2I(udg_SysB_Name[P]))))+")_"+I2S(P2I(udg_SysB_Name[P])))
  set Code = FSE_I2S(ModuloInteger(S2I(Code)+P2I(udg_SysB_Name[P]),1000),999)
//debug call BJDebugMsg("2_Saving..3, +"+I2S(P2I(udg_SysB_Name[P]))+"=: "+Code)
*/
  
  //엑쿠+체크+메인+기존
  set udg_Save_CodeOri2[P] = FSE_I2S(CountItem(P,'I084')/100,9) + "000000" + Code
//debug call BJDebugMsg("2_Saving..4, Ori Code("+I2S(StringLength(udg_Save_CodeOri2[P]))+"): "+udg_Save_CodeOri2[P])

//Incoding
  set i = 0
  set Code = ""
  loop
    exitwhen i+7 > StringLength(udg_Save_CodeOri2[P])
    set Code = Code + FSE_I2SW(S2I(SubString(udg_Save_CodeOri2[P],i,i+7)),4)
    set i=i+7
  endloop
//debug call BJDebugMsg("2_Saving..4, "+I2S(i)+"까지 진행하여 Code("+I2S(StringLength(Code))+"): "+Code)
  set udg_Save_Code2[P] = FSE_Coding(Code,true)
//debug call BJDebugMsg("2_Saving..5, 셔플("+I2S(StringLength(udg_Save_Code2[P]))+"): "+udg_Save_Code2[P])
//debug call BJDebugMsg("2_Saving..7-2, Nope("+I2S(StringLength(FSE_Coding(udg_Save_Code2[P],false)))+"): "+FSE_Coding(udg_Save_Code2[P],false)) 
  call RankEx_HighSave(P, 1, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER), GetUnitName(udg_Unit[P]))
  call RankEx_HighSave(P, 2, udg_Save_HP[P], GetUnitName(udg_Unit[P]))
  call RankEx_HighSave(P, 3, udg_Save_MP[P], GetUnitName(udg_Unit[P]))
  call RankEx_HighSave(P, 5, udg_SysE_STR1[P]+udg_SysE_DEX1[P]+udg_SysE_INT1[P]+udg_SysE_WIS1[P]+udg_SysE_CON1[P], GetUnitName(udg_Unit[P]))
endfunction

function SetUS2 takes string s, unit u, real val returns nothing
  local integer P = GetPlayerId(GetOwningPlayer(u))+1
  local integer h = GetHandleId(u)
  local boolean b = u == udg_Unit[P]
  set s = StringCase(s,true)

  if ( b ) and ( val == 0 ) then
    call MSG(Player(P-1), 1, 8., "아무런 효과가 없습니다. / " + s)
  endif
  if ( s == "HITS" ) then
    if ( b ) then
      set udg_SysC_Hits[P] = udg_SysC_Hits[P] + val
    else
      call SaveReal(udg_hash,h,StringHash("Hits"),LoadReal(udg_hash,h,StringHash("Hits"))+val)
    endif
  elseif ( s == "MISS" ) then
    call SaveReal(udg_hash, h, StringHash("Miss"), LoadReal(udg_hash, h, StringHash("Miss"))+val)
  elseif ( s == "MDF" ) then
    if ( b ) then
      set udg_SysC_MissMagic[P] = udg_SysC_MissMagic[P]+val
    else
      call SaveReal(udg_hash,h,StringHash("Mdf"),LoadReal(udg_hash,h,StringHash("Mdf"))+val)
    endif
  elseif ( s == "MDMG" ) then
    call SaveReal(udg_hash,h,StringHash("MDmg"),LoadReal(udg_hash,h,StringHash("MDmg"))+val)
  elseif ( s == "CRIP" ) then
    if ( b ) then
      set udg_SysC_CriP[P] = udg_SysC_CriP[P] + val
    else
      call SaveReal(udg_hash,h,StringHash("CriP"),LoadReal(udg_hash,h,StringHash("CriP"))+val)
    endif
  elseif ( s == "CRIX" ) then
    if ( b ) then
      set udg_SysC_CriX[P] = udg_SysC_CriX[P] + val
    else
      call SaveReal(udg_hash,h,StringHash("CriX"),LoadReal(udg_hash,h,StringHash("CriX"))+val)
    endif
  elseif ( s == "BASH" ) then
    call SaveReal(udg_hash,h,StringHash("Bash"),LoadReal(udg_hash,h,StringHash("Bash"))+val)
  elseif ( s == "MRD2" ) then
    call SaveReal(udg_hash,h,StringHash("MRD2"),LoadReal(udg_hash,h,StringHash("MRD2"))+val)
  else
    call MSG(Player(P-1), -1, 8., "S.US2 / " + s + R2SW(val,3,1))
  endif
endfunction
//call SetUS2("Miss", GetTriggerUnit(), 30.5)

function GetDmg takes integer P returns real
 return 1.+(udg_SysC_Dam[P]/100.)
endfunction
function SetDmg takes unit u returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(u))+1
  if ( u == udg_Unit[P] ) then
    call SetUnitState(u, ConvertUnitState(0x12), IMaxBJ(1, udg_SysC_DmgAttack[P])-1)
  else
    call SetUnitState(u, ConvertUnitState(0x12), IMaxBJ(1, LoadInteger(udg_hash,GetHandleId(u),StringHash("ATK"))-1))
  endif
endfunction
//call SetDmg(GetTriggerUnit())
//call GetDmg(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1,0.3)

function isHero takes unit u returns boolean
 return ( u != null ) and ( u == udg_Unit[GetPlayerId(GetOwningPlayer(u))+1] )
endfunction
function SetUS takes string s, unit u, integer val, boolean r returns nothing
  local integer v = val
  local integer P = GetPlayerId(GetOwningPlayer(u))+1
  local integer h = GetHandleId(u)
  local boolean b = ( u == udg_Unit[P] )
  set s = StringCase(s,true)
  if ( b ) and ( val == 0 ) then
    call MSG(Player(P-1), 1, 8., "아무런 효과가 없습니다. / " + s)
  endif
  if ( s == "HP" ) then
    set val = R2I(GetWidgetLife(u))
    if ( LoadInteger(udg_hash, h, StringHash("HP")) != 0 ) then
      call SaveInteger(udg_hash, h, StringHash("HP"), LoadInteger(udg_hash, h, StringHash("HP"))+v)
    elseif ( isHero(u) ) then
      call SaveInteger(udg_hash, h, StringHash("HP"), LoadInteger(udg_hash, h, StringHash("HP"))+v)
    else
    //최초 체력치 저장
      call SaveInteger(udg_hash, h, StringHash("HP"), IMaxBJ(0,R2I(GetUnitState(u, UNIT_STATE_MAX_LIFE))+LoadInteger(udg_hash, h, StringHash("HP"))+v))
    endif
    call SetUnitState(u, UNIT_STATE_MAX_LIFE, IMaxBJ(0,LoadInteger(udg_hash, h, StringHash("HP"))))
    if ( r ) then
    //몬스터 등
      call SetWidgetLife(u, GetUnitState(u, UNIT_STATE_MAX_LIFE))
    else
    //체력아이템, 꼈다뺐다 편법 방지
      call SetWidgetLife(u, val)
    endif
  elseif ( s == "MP" ) then
    set val = R2I(GetUnitState(u,UNIT_STATE_MANA))
    if ( HaveSavedInteger(udg_hash, h, StringHash("MP")) ) then
      call SaveInteger(udg_hash, h, StringHash("MP"), LoadInteger(udg_hash, h, StringHash("MP"))+v)
    elseif ( isHero(u) ) then
      call SaveInteger(udg_hash, h, StringHash("MP"), LoadInteger(udg_hash, h, StringHash("MP"))+v)
    else
      call SaveInteger(udg_hash, h, StringHash("MP"), R2I(GetUnitState(u, UNIT_STATE_MAX_MANA))+LoadInteger(udg_hash, h, StringHash("MP"))+v)
    endif
    call SetUnitState(u, UNIT_STATE_MAX_MANA, LoadInteger(udg_hash, h, StringHash("MP")))
    if ( r != true ) then
      call SetUnitState(u,UNIT_STATE_MANA,val)
    else
      call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MAX_MANA))
    endif
  elseif ( s == "ARMOR" ) then
    if ( b ) then
      set udg_SysC_Armor[P] = udg_SysC_Armor[P] + v
      set v = udg_SysC_Armor[P] + udg_SysC_ArmorM[P]
    else
      call SaveInteger(udg_hash,h,StringHash("AC"),LoadInteger(udg_hash,h,StringHash("AC"))+v)
      set v = LoadInteger(udg_hash,h,StringHash("AC")) + LoadInteger(udg_hash,h,StringHash("MAC"))
    endif
    call SetUnitState(u, ConvertUnitState(0x20), v)
  elseif ( s == "MAC" ) then
    if ( b ) then
      set udg_SysC_ArmorM[P] = udg_SysC_ArmorM[P] + v
      set v = udg_SysC_ArmorM[P]
    else
      call SaveInteger(udg_hash,h,StringHash("MAC"),LoadInteger(udg_hash,h,StringHash("MAC"))+v)
      set v = LoadInteger(udg_hash,h,StringHash("MAC"))
    endif
    if ( v < 0 ) then
      if ( GetUnitAbilityLevel(u, 'AId4')*GetUnitAbilityLevel(u, 'AId5')*GetUnitAbilityLevel(u, 'AId7')*GetUnitAbilityLevel(u, 'AId8') == 0 ) then
        call UnitRemoveAbility(u, 'AId4')
        call UnitRemoveAbility(u, 'AId5')
        call UnitRemoveAbility(u, 'AId7')
        call UnitRemoveAbility(u, 'AId8')
      
        call UnitAddAbility(u, 'AId4')
        call UnitAddAbility(u, 'AId5')
        call UnitAddAbility(u, 'AId7')
        call UnitAddAbility(u, 'AId8')
      endif
      set v = v + 1000
    else
      call UnitRemoveAbility(u, 'AId4')
      if ( GetUnitAbilityLevel(u, 'AId5')*GetUnitAbilityLevel(u, 'AId7')*GetUnitAbilityLevel(u, 'AId8') == 0 ) then
        call UnitRemoveAbility(u, 'AId5')
        call UnitRemoveAbility(u, 'AId7')
        call UnitRemoveAbility(u, 'AId8')
      
        call UnitAddAbility(u, 'AId5')
        call UnitAddAbility(u, 'AId7')
        call UnitAddAbility(u, 'AId8')
      endif
    endif
    call SetUnitAbilityLevel(u, 'AId8', v/100+1)
    call SetUnitAbilityLevel(u, 'AId7', ModuloInteger(v,100)/10+1)
    call SetUnitAbilityLevel(u, 'AId5', ModuloInteger(v,10)+1)
  elseif ( s == "DMG" ) then
    if ( b ) then
      set udg_SysC_DmgAttack[P] = udg_SysC_DmgAttack[P] + v
      set v = IMaxBJ(0, udg_SysC_DmgAttack[P])
    elseif ( HaveSavedInteger(udg_hash, h, StringHash("ATK")) ) then
      call SaveInteger(udg_hash, h, StringHash("ATK"), LoadInteger(udg_hash, h, StringHash("ATK"))+v)
    else
      call SaveInteger(udg_hash, h, StringHash("ATK"), R2I(GetUnitState(u, ConvertUnitState(0x12)))+LoadInteger(udg_hash, h, StringHash("ATK"))+v)
    endif
    call SetDmg(u)
  else
    call MSG(Player(P-1), -1, 8., "S.US / " + GetUnitName(u) + "/" + s + "/" + I2S(val))
  endif
  set v = 0
endfunction
//call SetUS("Hp", GetTriggerUnit(), 200, true)
function KP takes player p returns nothing
  if ( GetLocalPlayer()==p ) then
    call SetCineFilterTexture("ReplaceableTextures\\CameraMasks\\Custom4.blp")
    call DisplayCineFilter(true)
  endif
  call RemovePlayer(p, PLAYER_GAME_RESULT_DEFEAT)
endfunction
//로드
function OnlineGame1 takes nothing returns nothing
  call PauseGame( false )
  if ( GetLocalPlayer() == GetTriggerPlayer() ) then
    call EndGame(false)
  endif
endfunction
function OnlineGame2 takes nothing returns nothing
  call PauseGame( false )
  call KP(GetTriggerPlayer())
endfunction
function OnlineGame3 takes nothing returns nothing
  call PauseGame( false )
  if ( GetLocalPlayer() == GetTriggerPlayer() ) then
    call EndGame( true )
  endif
endfunction
function isPlaying takes player p returns boolean
 return ( GetPlayerController(p) == MAP_CONTROL_USER ) and ( GetPlayerSlotState(p) == PLAYER_SLOT_STATE_PLAYING )
endfunction
function PlayerNames takes integer P returns string
 local integer i = 1
 local string s = ""
 local integer i2 = 0
  loop
    if ( isPlaying(Player(i-1)) ) then
      set s = s + "
 / " + udg_SysB_Name[i] + "_" + GetUnitName(udg_Unit[i])+"_"+I2S(GetUnitLevel(udg_Unit[i])) + "_" + I2S(GetPlayerState(Player(i-1), PLAYER_STATE_RESOURCE_LUMBER))+"P"
      set i2 = i2 + 1
    endif
    exitwhen i >= bj_MAX_PLAYERS
    set i = i + 1
  endloop
  return BaseStr(9) + " / " + I2S(udg_MT_TimerHou*60+udg_MT_TimerMin) + "m / ["+I2S(udg_SysA_COUNT+1)+">>"+I2S(i2)+"] " + s
endfunction
native JNMapServerLog takes string MapId, string SecretKey, string Version, string Loging returns string
function OnlineGame takes player p, integer i, string msg returns nothing
 local trigger t = CreateTrigger()
 local dialog d = DialogCreate()
 local string s = ""
  call TriggerRegisterDialogButtonEvent(t, DialogAddButton(d, "대"+"기"+"실"+"로(|cffffffffQ|r)", 81))
  call TriggerAddAction(t, function OnlineGame1)
  set t = CreateTrigger()
  call TriggerRegisterDialogButtonEvent(t, DialogAddButton(d, "바"+"탕"+"화"+"면(|cffffffffW|r)", 87))
  call TriggerAddAction(t, function OnlineGame2)

  if ( i == 1 ) then
    call DialogSetMessage(d, "|cffffdc3cL"+"A"+"N "+"싱"+"글"+"플"+"레"+"이"+" 불"+"가|r")
    call PauseGame(true)
    call EnableUserUI(false)
    call VolumeGroupSetVolume(SOUND_VOLUMEGROUP_UI, 1.)
    call StartSound(bj_defeatDialogSound)
    call DialogAddButton(d, "구"+"경"+"하"+"기(|cffffffffE|r)",69)
  elseif ( i == 12 ) then
    set s = PlayerNames(GetPlayerId(p)+1)
    if ( GetLocalPlayer() == p ) then
      //call JNSetSaveCode(JN_MAPID, "Log", JN_SECRETKEY, "Error/"+udg_SysB_Name[GetPlayerId(p)+1]+"/"+msg+"_"+I2S(GetRandomInt(10,99)), s)
      call JNMapServerLog(JN_MAPID, JN_SECRETKEY, BaseStr(9), udg_SysB_Name[GetPlayerId(p)+1]+"/"+msg+"\n"+s)
    endif
    call DialogSetMessage(d, "|cffffdc3cE"+"r"+"r"+"o"+"r "+"C"+"o"+"d"+"e"+": "+SysStr(7,i)+"/"+udg_temp_s+"|r")
  else
    set s = PlayerNames(GetPlayerId(p)+1)
    if ( GetLocalPlayer() == p ) then
      //call JNSetSaveCode(JN_MAPID, "Log", JN_SECRETKEY, "Error/"+udg_SysB_Name[GetPlayerId(p)+1]+"/"+SysStr(7,i)+"_"+I2S(GetRandomInt(10,99)), s)
      call JNMapServerLog(JN_MAPID, JN_SECRETKEY, BaseStr(9), udg_SysB_Name[GetPlayerId(p)+1]+"/"+SysStr(7,i)+"\n"+s)
    endif
    call MSGAll(-(GetPlayerId(p)+1), true, 1, 12, 20.,"Error of "+SysStr(7,i))
  endif
debug return
  call DialogDisplay(p, d, true)
  set t = null
  set d = null
endfunction

function FCut takes string s, integer c returns string
  if ( s == null ) then
    return ""
  else
    set s = JNStringSplit(s,"|",c-1)
    if ( SubString(s,0,3) == "cff" ) then
      return "|" + s
    else
      return s
    endif
  endif
endfunction

function FAdd takes integer i returns string
  local string s = ""
  loop
    exitwhen i <= 0
    set s = s + " "
    set i = i - 1
  endloop
  if ( StringLength(s) > 6 ) then
    return "      "
  else
    return s
  endif
endfunction
constant function ATTACKSPEED takes integer lv returns real
  if ( lv <= -1 ) then
    return 2.
  elseif ( lv == 1 ) then
    return 1.116
  elseif ( lv == 2 ) then
    return 1.038
  elseif ( lv == 3 ) then
    return .965
  elseif ( lv == 4 ) then
    return .898
  elseif ( lv == 5 ) then
    return .835
  elseif ( lv == 6 ) then
    return .776
  elseif ( lv == 7 ) then
    return .722
  elseif ( lv == 8 ) then
    return .671
  elseif ( lv == 9 ) then
    return .624
  elseif ( lv == 10 ) then
    return .58
  elseif ( lv == 11 ) then
    return .54
  elseif ( lv == 12 ) then
    return .502
  elseif ( lv == 13 ) then
    return .467
  elseif ( lv == 14 ) then
    return .434
  elseif ( lv == 15 ) then
    return .404
  elseif ( lv == 16 ) then
    return .375
  elseif ( lv == 17 ) then
    return .349
  elseif ( lv == 18 ) then
    return .325
  elseif ( lv == 19 ) then
    return .302
  elseif ( lv >= 20 ) then
    return .281
  else
    return 1.2
  endif
endfunction
function SetAtkSpd takes integer P returns nothing
  if ( isPlaying(Player(P-1)) ) then
    if ( UnitAlive(udg_Unit[P]) ) then
      call SetUnitState(udg_Unit[P], ConvertUnitState(0x25), ATTACKSPEED(udg_SysC_AtkSpdDEX[P]+udg_SysC_AtkSpdAdd[P]))
      if ( udg_SysC_AtkSpdDEX[P]+udg_SysC_AtkSpdAdd[P] > 0 ) then
        call SetUnitTimeScale(udg_Unit[P], ATTACKSPEED(0)/ATTACKSPEED(udg_SysC_AtkSpdDEX[P]+udg_SysC_AtkSpdAdd[P]))
      endif
    else
      call MSG(Player(P-1), -1, 8., "S.AtkSpd")
    endif
  endif
endfunction
function AddState takes integer P, string c, integer v, boolean o returns nothing
  if ( v != 0 ) then
    set c = StringCase(c, true)
    if ( c == "DEX" ) then
	  set udg_SysC_Hits[P] = udg_SysC_Hits[P] + (v * BaseValue(1))
      set udg_SysC_CriP[P] = udg_SysC_CriP[P] + (v * BaseValue(13))
	  set udg_SysC_DmgAttack[P] = udg_SysC_DmgAttack[P] + (v * SysInt(0,13))
      set udg_SysC_DmgAttackAdd[P] = udg_SysC_DmgAttackAdd[P] + (v * SysInt(0,20))
      if ( o ) then
        set udg_SysE_DEX1[P] = udg_SysE_DEX1[P] + v
      else
        set udg_SysE_DEX2[P] = udg_SysE_DEX2[P] + v
      endif
	  set udg_SysE_DEX3[P] = udg_SysE_DEX1[P] + udg_SysE_DEX2[P]
      call SetHeroAgi(udg_Unit[P], udg_SysE_DEX3[P], true)
      call SetDmg(udg_Unit[P])
      if ( udg_SysE_DEX3[P]/20 != udg_SysC_AtkSpdDEX[P] ) then
        set udg_SysC_AtkSpdDEX[P] = udg_SysE_DEX3[P]/20
        call SetAtkSpd(P)
      endif
    elseif ( c == "INT" ) then
      set udg_SysC_CriX[P] = udg_SysC_CriX[P] + (v * BaseValue(14))
      set udg_SysC_MissMagic[P] = udg_SysC_MissMagic[P] + (v * BaseValue(6))
      if ( o ) then
        set udg_SysE_INT1[P] = udg_SysE_INT1[P] + v
      else
        set udg_SysE_INT2[P] = udg_SysE_INT2[P] + v
      endif
      set udg_SysE_INT3[P] = udg_SysE_INT1[P] + udg_SysE_INT2[P]
    elseif ( c == "STR" ) then
      set udg_SysC_CriX[P] = udg_SysC_CriX[P] + (v * BaseValue(14))
	  set udg_SysC_DmgAttack[P] = udg_SysC_DmgAttack[P] + (v * SysInt(0,12))
      set udg_SysC_DmgAttackAdd[P] = udg_SysC_DmgAttackAdd[P] + (v * SysInt(0,19))
      if ( o ) then
        set udg_SysE_STR1[P] = udg_SysE_STR1[P] + v
      else
        set udg_SysE_STR2[P] = udg_SysE_STR2[P] + v
      endif
      set udg_SysE_STR3[P] = udg_SysE_STR1[P] + udg_SysE_STR2[P]
      call SetDmg(udg_Unit[P])
    elseif ( c == "WIS" ) then
      if ( o ) then
        set udg_SysE_WIS1[P] = udg_SysE_WIS1[P] + v
      else
        set udg_SysE_WIS2[P] = udg_SysE_WIS2[P] + v
      endif
      set udg_SysE_WIS3[P] = udg_SysE_WIS1[P] + udg_SysE_WIS2[P]
      call SetHeroInt(udg_Unit[P], udg_SysE_WIS3[P], true)
    elseif ( c == "CON" ) then
	  set udg_SysC_DmgAttack[P] = udg_SysC_DmgAttack[P] + (v * SysInt(0,14))
      set udg_SysC_DmgAttackAdd[P] = udg_SysC_DmgAttackAdd[P] + (v * SysInt(0,21))
      if ( o ) then
        set udg_SysE_CON1[P] = udg_SysE_CON1[P] + v
      else
        set udg_SysE_CON2[P] = udg_SysE_CON2[P] + v
      endif
      set udg_SysE_CON3[P] = udg_SysE_CON1[P] + udg_SysE_CON2[P]
      call SetHeroStr(udg_Unit[P], udg_SysE_CON3[P], true)
      call SetDmg(udg_Unit[P])
    else
      call MSG(Player(P-1), -1, 20, "AddS / " + c)
    endif
  endif
 set c = null
 set o = false
endfunction

constant function FMi_ILv takes integer i returns integer
//아이템 데이터
  if ( i == 1 ) then
    return 1
  elseif ( i == 2 ) then
    return 11
  elseif ( i == 3 ) then
    return 26
  elseif ( i == 4 ) then
    return 41
  elseif ( i == 5 ) then
    return 56
  elseif ( i == 6 ) then
    return 71
  elseif ( i == 7 ) then
    return 86
  elseif ( i == 8 ) then
    return 99
  else
    return 999
  endif
endfunction
constant function IData takes string s returns string
  if ( s == "0" ) then
    return "|r공격력"
  elseif ( s == "3" ) then
    return "|cff46ffff방어력"
  elseif ( s == "4" ) then
    return "|cff9932cc마방"
  elseif ( s == "5" ) then
    return "|c00ff8040Dam"
  elseif ( s == "6" ) then
    return "|c00ff8040Hit"
  elseif ( s == "7" ) then
    return "|cff9932cc재생력"
  elseif ( s == "8" ) then
    return "|cffff00ff치명확률"
  elseif ( s == "9" ) then
    return "|cffff00ff치명배율"
  elseif ( s == "a" ) then
    return "|cffd962b5STR"
  elseif ( s == "b" ) then
    return "|cffd962b5DEX"
  elseif ( s == "c" ) then
    return "|cffd962b5INT"
  elseif ( s == "d" ) then
    return "|cffd962b5WIS"
  elseif ( s == "e" ) then
    return "|cffd962b5CON"
  elseif ( s == "f" ) then
    return "|cff0078ffHP"
  elseif ( s == "g" ) then
    return "|cff0078ffMP"
  elseif ( s == "h" ) then
    return "|cffd962b5모든 능력치"
  elseif ( s == "i" ) then
    return "|cff22b14c힐량"
  elseif ( s == "j" ) then
    return "|cfffff200추가 골드"
  elseif ( s == "k" ) then
    return "|cff8000ff팟 뎀"
  elseif ( s == "l" ) then
    return "|cff80ff80드랍률"
  elseif ( s == "m" ) then
    return "|cff008080공속 등급"
  elseif ( s == "p" ) then
    return "|cffaaffaa회피율"
  elseif ( s == "q" ) then
    return "|cfff5f9b7판매율"
  elseif ( s == "s" ) then
    return "|cffacacff버프지속"
  elseif ( s == "t" ) then
    return "|c0000ff80이동속도"
  else
    return ""
  endif
endfunction
constant function FMi_BaseDoo takes integer i returns integer
  if ( i == 31 ) then
    return 'B001'
  elseif ( i == 32 ) then
    return 'B00J'
  elseif ( i == 33 ) then
    return 'B00K'
  elseif ( i == 34 ) then
    return 'B00L'
  elseif ( i == 35 ) then
    return 'B00M'
  elseif ( i == 36 ) then
    return 'B00N'
  elseif ( i == 37 ) then
    return 'B00O'
  elseif ( i == 38 ) then
    return 'B00P'
  elseif ( i == 39 ) then
    return 'B00Q'
  elseif ( i == 40 ) then
    return 'B00R'
  elseif ( i == 41 ) then
    return 'B00T'
  elseif ( i == 42 ) then
    return 'B00S'
  else
    return 'B00U'
  endif
endfunction
constant function ViewFull takes string S returns boolean
  // 붙은것 등, 전체값 불러올지, 잘라올지
 return ( S == "0" or S == "7" or S == "8" or S == "9" or S == "m" or S == "4" or S == "k" or S == "i" or S == "j" or S == "l" or S == "p" or S == "q" or S == "s" )
  //공격력, 재생력, 치확, 치배, 공속, 마방, 팟뎀, 힐, 골드, 드랍, 회피, 판매, 버프지속
endfunction
function LocalEffect takes player p, string e, real x, real y returns effect
 local string s = ""
  if ( GetLocalPlayer() == p ) then
    set s = e
  endif
 set bj_lastCreatedEffect = AddSpecialEffect(s,x,y)
 return bj_lastCreatedEffect
endfunction
    
function StatAdd takes string s, integer P, real v returns string
  if ( s == "1" ) then
    //기본뎀
    set udg_SysC_DmgAttack[P] = udg_SysC_DmgAttack[P] + R2I(v)
    call SetDmg(udg_Unit[P])
  elseif ( s == "2" ) then
    //추뎀
    set udg_SysC_DmgAttackAdd[P] = udg_SysC_DmgAttackAdd[P] + R2I(v)
  elseif ( s == "3" ) then
  //방어력
    call SetUS("Armor", udg_Unit[P], R2I(v), true)
    return "|cffffdc3c (현재 방어력: |cff46ffff"+I2S(udg_SysC_Armor[P])+"|cffffdc3c)"
  elseif ( s == "4" ) then
    set udg_SysC_MissMagic[P] = udg_SysC_MissMagic[P] + v
    return "|cffffdc3c (현재 마법방어력: |cff9932cc"+R2SW(udg_SysC_MissMagic[P],3,1)+"％|cffffdc3c)"
  elseif ( s == "5" ) then
    set udg_SysC_Dam[P] = udg_SysC_Dam[P] + R2I(v)
    return "|cffffdc3c (현재 Dam: |c00ff8040"+I2S(udg_SysC_Dam[P])+"％|cffffdc3c)"
  elseif ( s == "6" ) then
    set udg_SysC_Hits[P] = udg_SysC_Hits[P] + v
    return "|cffffdc3c (현재 Hit: |c00ff8040"+R2SW(udg_SysC_Hits[P],3,1)+"％|cffffdc3c)"
  elseif ( s == "7" ) then
    set udg_SysC_Regen[P] = udg_SysC_Regen[P] + R2I(v)
    if ( udg_SysI_MinusRegen[P] > 0 ) then
      return "|cffffdc3c (현재 재생력: |cff9932cc"+I2S(udg_SysC_Regen[P])+"％ |cffff3315 (고갈 -"+I2S(udg_SysI_MinusRegen[P])+") |cffffdc3c)"
    else
      return "|cffffdc3c (현재 재생력: |cff9932cc"+I2S(udg_SysC_Regen[P])+"％|cffffdc3c)"
    endif
  elseif ( s == "8" ) then
    set udg_SysC_CriP[P] = udg_SysC_CriP[P] + v
    return "|cffffdc3c (현재 치명타 확률: |cffff0080"+R2SW(udg_SysC_CriP[P],3,1)+"％|cffffdc3c, |cffff00ffx" + R2SW(udg_SysC_CriX[P], 2, 2) + "|cffffdc3c)"
  elseif ( s == "9" ) then
    set udg_SysC_CriX[P] = udg_SysC_CriX[P] + v
    return "|cffffdc3c (현재 치명타 배율: |cffff0080"+R2SW(udg_SysC_CriP[P],3,1)+"％|cffffdc3c, |cffff00ffx" + R2SW(udg_SysC_CriX[P], 2, 2) + "|cffffdc3c)"
  elseif ( s == "a" ) then
    call AddState(P, "STR", R2I(v), false)
    return "|cffffdc3c (현재 힘: |cffd962b5"+I2S(udg_SysE_STR3[P])+"|cffffdc3c ＝ |cff0078ff" + I2S(udg_SysE_STR1[P]) + "|cffffdc3c＋|cff46ffff"+I2S(udg_SysE_STR2[P])+"|cffffdc3c)"
  elseif ( s == "b" ) then
    call AddState(P, "DEX", R2I(v), false)
    return "|cffffdc3c (현재 민첩: |cffd962b5"+I2S(udg_SysE_DEX3[P])+"|cffffdc3c ＝ |cff0078ff" + I2S(udg_SysE_DEX1[P]) + "|cffffdc3c＋|cff46ffff"+I2S(udg_SysE_DEX2[P])+"|cffffdc3c)"
  elseif ( s == "c" ) then
    call AddState(P, "INT", R2I(v), false)
    return "|cffffdc3c (현재 지식: |cffd962b5"+I2S(udg_SysE_INT3[P])+"|cffffdc3c ＝ |cff0078ff" + I2S(udg_SysE_INT1[P]) + "|cffffdc3c＋|cff46ffff"+I2S(udg_SysE_INT2[P])+"|cffffdc3c)"
  elseif ( s == "d" ) then
    call AddState(P, "WIS", R2I(v), false)
    return "|cffffdc3c (현재 지혜: |cffd962b5"+I2S(udg_SysE_WIS3[P])+"|cffffdc3c ＝ |cff0078ff" + I2S(udg_SysE_WIS1[P]) + "|cffffdc3c＋|cff46ffff"+I2S(udg_SysE_WIS2[P])+"|cffffdc3c)"
  elseif ( s == "e" ) then
    call AddState(P, "CON", R2I(v), false)
    return "|cffffdc3c (현재 지구력: |cffd962b5"+I2S(udg_SysE_CON3[P])+"|cffffdc3c ＝ |cff0078ff" + I2S(udg_SysE_CON1[P]) + "|cffffdc3c＋|cff46ffff"+I2S(udg_SysE_CON2[P])+"|cffffdc3c)"
  elseif ( s == "f" ) then
    call SetUS("Hp", udg_Unit[P], R2I(v), false)
    return "|cffffdc3c (현재 체력: |cff0078ff"+I2S(R2I(GetUnitState(udg_Unit[P], UNIT_STATE_MAX_LIFE)))+"|cffffdc3c)"
  elseif ( s == "g" ) then
    call SetUS("Mp", udg_Unit[P], R2I(v), false)
    return "|cffffdc3c (현재 마력: |cff0078ff"+I2S(R2I(GetUnitState(udg_Unit[P], UNIT_STATE_MAX_MANA)))+"|cffffdc3c)"
  elseif ( s == "h" ) then
    call AddState(P, "STR", R2I(v), false)
    call AddState(P, "DEX", R2I(v), false)
    call AddState(P, "INT", R2I(v), false)
    call AddState(P, "WIS", R2I(v), false)
    call AddState(P, "CON", R2I(v), false)
    return "|cffffdc3c (현재 능력치: |cffd962b5"+I2S(udg_SysE_STR3[P])+"|cffffdc3c / |cffd962b5"+I2S(udg_SysE_DEX3[P])+"|cffffdc3c / |cffd962b5"+I2S(udg_SysE_INT3[P])+"|cffffdc3c / |cffd962b5"+I2S(udg_SysE_WIS3[P])+"|cffffdc3c / |cffd962b5"+I2S(udg_SysE_CON3[P])+"|cffffdc3c)"
  elseif ( s == "i" ) then
    set udg_SysC_HealAdd[P] = udg_SysC_HealAdd[P] + R2I(v)
    return "|cffffdc3c (현재 추가 힐량: |cff22b14c"+I2S(udg_SysC_HealAdd[P])+"％|cffffdc3c)"
  elseif ( s == "j" ) then
    set udg_SysK_GoldAdd[P] = udg_SysK_GoldAdd[P] + R2I(v)
    return "|cffffdc3c (현재 추가 골드: |cfffff200"+I2S(udg_SysK_GoldAdd[P])+"％|cffffdc3c)"
  elseif ( s == "k" ) then
    set udg_SysC_PotAdd[P] = udg_SysC_PotAdd[P] + R2I(v)
    return "|cffffdc3c (현재 필살기 추뎀: |cff8000ff"+I2S(udg_SysC_PotAdd[P])+"％|cffffdc3c)"
  elseif ( s == "l" ) then
    set udg_SysK_DropAdd[P] = udg_SysK_DropAdd[P] + R2I(v)
    return "|cffffdc3c (현재 추가 드랍률: |cff80ff80"+I2S(udg_SysK_DropAdd[P])+"％|cffffdc3c)"
  elseif ( s == "m" ) then
    set udg_SysC_AtkSpdAdd[P] = udg_SysC_AtkSpdAdd[P] + R2I(v)
    call SetAtkSpd(P)
    return "|cffffdc3c (현재 공속: |cff008080+"+I2S(udg_SysC_AtkSpdDEX[P]+udg_SysC_AtkSpdAdd[P])+"단계|cffffdc3c)"
  elseif ( s == "p" ) then
    call SetUS2("Miss", udg_Unit[P], v)
    return "|cffffdc3c (현재 회피: |cffaaffaa+"+I2S(R2I(LoadReal(udg_hash, GetHandleId(udg_Unit[P]), StringHash("Miss"))))+"|cffffdc3c)"
  elseif ( s == "q" ) then
    set udg_SysK_SellAdd[P] = udg_SysK_SellAdd[P] + R2I(v)
    return "|cffffdc3c (현재 판매율: |cfff5f9b7+"+I2S(100+udg_SysK_SellAdd[P])+"|cffffdc3c)"
//elseif ( s == "r" ) then
//    return ""
  elseif ( s == "s" ) then
    set udg_SysK_BuffAdd[P] = udg_SysK_BuffAdd[P] + R2I(v)
    return "|cffffdc3c (현재 버프 효율: |cffacacff+"+I2S(100+udg_SysK_BuffAdd[P])+"|cffffdc3c)"
  elseif ( s == "t" ) then
    call SaveInteger(udg_hash, P, 7, LoadInteger(udg_hash, P, 7) + R2I(v))
    if ( GetUnitAbilityLevel(udg_Unit[P], 'A02V') == 0 ) then
      call UnitAddAbility(udg_Unit[P], 'A02V')
    endif
    call SetUnitAbilityLevel(udg_Unit[P], 'A02V', LoadInteger(udg_hash, P, 7))
    return "|cffffdc3c (현재 이동속도: |cff00ff80+" + I2S(LoadInteger(udg_hash, P, 7)) + "단계|cffffdc3c, |cff9932cc"+I2S(R2I(GetUnitMoveSpeed(udg_Unit[P])))+" |r/|cffffdc3c 522)"
  else
    call MSG(Player(P-1),-1,8,"Error - StatAdd s: " + s)
  endif
  return "ERROR - StatAdd s: " + s
endfunction
function StringWithoutInput takes string s, string input returns string
 local integer i= 0
 local integer lengthO = StringLength(s)
 local integer length = StringLength(input)
  loop
    exitwhen i > lengthO - length
    if ( SubString(s, i, i + length) == input ) then
      return SubString(s, 0, i) + SubString(s, i + length, lengthO)
    endif
    set i=i + 1
  endloop
 return s
endfunction
//특수 아이템 관련
constant function GetNamed4 takes integer i, integer lv returns string
  if ( i > 0 and i <= 20 ) then
    if ( i == 1 ) then  
      if ( lv == 5 ) then
        return "|a5|e2|510％|90.10x"
      elseif ( lv == 4 ) then
        return "|a4|e1"
      elseif ( lv == 3 ) then
        return "|a3"
      elseif ( lv == 2 ) then
        return "|a2"
      else
        return "|a1"
      endif
    elseif ( i == 2 ) then
      if ( lv == 5 ) then
        return "|b5|k15％|813％|p14％"
      elseif ( lv == 4 ) then
        return "|b4|k7％"
      elseif ( lv == 3 ) then
        return "|b3"
      elseif ( lv == 2 ) then
        return "|b2"
      else
        return "|b1"
      endif
    elseif ( i == 3 ) then
      if ( lv == 5 ) then
        return "|c5|d2|610％|410％"
      elseif ( lv == 4 ) then
        return "|c4|d1"
      elseif ( lv == 3 ) then
        return "|c3"
      elseif ( lv == 2 ) then
        return "|c2"
      else
        return "|c1"
      endif
    elseif ( i == 4 ) then
      if ( lv == 5 ) then
        return "|d5|c2|i10％|75％"
      elseif ( lv == 4 ) then
        return "|d4|c1"
      elseif ( lv == 3 ) then
        return "|d3"
      elseif ( lv == 2 ) then
        return "|d2"
      else
        return "|d1"
      endif
    elseif ( i == 5 ) then
      if ( lv == 5 ) then
        return "|e5|a2|710％|k15％"
      elseif ( lv == 4 ) then
        return "|e4|a1"
      elseif ( lv == 3 ) then
        return "|e3"
      elseif ( lv == 2 ) then
        return "|e2"
      else
        return "|e1"
      endif
    elseif ( i == 6 ) then
      if ( lv == 5 ) then
        return "|430％"
      elseif ( lv == 4 ) then
        return "|420％"
      elseif ( lv == 3 ) then
        return "|415％"
      elseif ( lv == 2 ) then
        return "|410％"
      else
        return "|45％"
      endif
    elseif ( i == 7 ) then
      if ( lv == 5 ) then
        return "|630"
      elseif ( lv == 4 ) then
        return "|620"
      elseif ( lv == 3 ) then
        return "|615"
      elseif ( lv == 2 ) then
        return "|610"
      else
        return "|66"
      endif
    elseif ( i == 8 ) then
      if ( lv == 5 ) then
        return "|730％"
      elseif ( lv == 4 ) then
        return "|720％"
      elseif ( lv == 3 ) then
        return "|715％"
      elseif ( lv == 2 ) then
        return "|710％"
      else
        return "|76％"
      endif
    elseif ( i == 9 ) then
      if ( lv == 5 ) then
        return "|530％"
      elseif ( lv == 4 ) then
        return "|520％"
      elseif ( lv == 3 ) then
        return "|515％"
      elseif ( lv == 2 ) then
        return "|510％"
      else
        return "|56％"
      endif
    elseif ( i == 10 ) then
      if ( lv == 5 ) then
        return "|840％"
      elseif ( lv == 4 ) then
        return "|826.5％"
      elseif ( lv == 3 ) then
        return "|819％"
      elseif ( lv == 2 ) then
        return "|813％"
      else
        return "|87.5％"
      endif
    elseif ( i == 11 ) then
      if ( lv == 5 ) then
        return "|90.30x"
      elseif ( lv == 4 ) then
        return "|90.20x"
      elseif ( lv == 3 ) then
        return "|90.15x"
      elseif ( lv == 2 ) then
        return "|90.10x"
      else
        return "|90.06x"
      endif
    elseif ( i == 12 ) then
      if ( lv == 5 ) then
        return "|i30％"
      elseif ( lv == 4 ) then
        return "|i20％"
      elseif ( lv == 3 ) then
        return "|i15％"
      elseif ( lv == 2 ) then
        return "|i10％"
      else
        return "|i5％"
      endif
    elseif ( i == 13 ) then
      if ( lv == 5 ) then
        return "|k44％"
      elseif ( lv == 4 ) then
        return "|k29％"
      elseif ( lv == 3 ) then
        return "|k21％"
      elseif ( lv == 2 ) then
        return "|k13％"
      else
        return "|k7％"
      endif
    elseif ( i == 14 ) then
      if ( lv == 5 ) then
        return "|j120％"
      elseif ( lv == 4 ) then
        return "|j80％"
      elseif ( lv == 3 ) then
        return "|j50％"
      elseif ( lv == 2 ) then
        return "|j30％"
      else
        return "|j15％"
      endif
    elseif ( i == 15 ) then
      if ( lv == 5 ) then
        return "|l77％"
      elseif ( lv == 4 ) then
        return "|l50％"
      elseif ( lv == 3 ) then
        return "|l30％"
      elseif ( lv == 2 ) then
        return "|l20％"
      else
        return "|l10％"
      endif
    elseif ( i == 16 ) then
      if ( lv == 5 ) then
        return "|p35％"
      elseif ( lv == 4 ) then
        return "|p28％"
      elseif ( lv == 3 ) then
        return "|p21％"
      elseif ( lv == 2 ) then
        return "|p14％"
      else
        return "|p7％"
      endif
    elseif ( i == 17 ) then
      if ( lv == 5 ) then
        return "|q40％"
      elseif ( lv == 4 ) then
        return "|q32％"
      elseif ( lv == 3 ) then
        return "|q24％"
      elseif ( lv == 2 ) then
        return "|q16％"
      else
        return "|q8％"
      endif
    elseif ( i == 18 ) then
    //isNamed <90 조정할 것.
      if ( lv == 5 ) then
        return "|s25％"
      elseif ( lv == 4 ) then
        return "|s20％"
      elseif ( lv == 3 ) then
        return "|s15％"
      elseif ( lv == 2 ) then
        return "|s10％"
      else
        return "|s5％"
      endif
    endif
  endif
 return ""
endfunction
constant function GetNamed1 takes integer i, boolean Sys returns string
  if ( i == 1 ) then
    if ( Sys ) then
	  return "미약한 "
	else
      return "빛바랜 "
	endif
  elseif ( i == 2 ) then
    if ( Sys ) then
	  return "선명한 "
	else
      return "신비한 "
	endif
  elseif ( i == 3 ) then
    if ( Sys ) then
	  return "넘칠듯한 "
	else
      return "초월된 "
	endif
  elseif ( i == 4 ) then
    if ( Sys ) then
	  return "파괴적인 "
	else
      return "신화속 "
	endif
  elseif ( i == 5 ) then
    if ( Sys ) then
	  return "삼켜지는 "
	else
      return "어두운 "
	endif
  else
    return ""
  endif
endfunction
constant function GetNamed2 takes integer i returns string
  if ( i == 1 ) then
    return "세토아의 "
  elseif ( i == 2 ) then
    return "셔스의 "
  elseif ( i == 3 ) then
    return "로오의 "
  elseif ( i == 4 ) then
    return "이아의 "
  elseif ( i == 5 ) then
    return "메투스의 "
  elseif ( i == 6 ) then
    return "자존의 "
  elseif ( i == 7 ) then
    return "인연의 "
  elseif ( i == 8 ) then
    return "불멸의 "
  elseif ( i == 9 ) then
    return "위엄의 "
  elseif ( i == 10 ) then
    return "선언의 "
  elseif ( i == 11 ) then
    return "승부의 "
  elseif ( i == 12 ) then
    return "수줍은 "
  elseif ( i == 13 ) then
    return "용기의 "
  elseif ( i == 14 ) then
    return "풍부한 "
  elseif ( i == 15 ) then
    return "재보의 "
  elseif ( i == 16 ) then
    return "유혹의 "
  elseif ( i == 17 ) then
    return "명성의 "
  elseif ( i == 18 ) then
    return "온화한 "
  elseif ( i == 19 ) then
    return "운명의 "
  elseif ( i == 20 ) then
    return "추억의 "
  else
    return ""
  endif
endfunction
constant function GetNamed4AddOption takes integer i returns boolean
// 아래 1개 옵션이면 true(한줄 표시), 아니면 false 반환(여러줄 표시)
  if ( i == 4 ) then
    return true
  elseif ( i == 5 ) then
    return true
  elseif ( i == 9 ) then
    return true
  elseif ( i == 10 ) then
    return true
  elseif ( i == 14 ) then
    return true
  elseif ( i == 15 ) then
    return true
  elseif ( i == 19 ) then
    return true
  elseif ( i == 20 ) then
    return true
  elseif ( i == 24 ) then
    return true
  elseif ( i == 25 ) then
    return true
  endif
 return false
endfunction

constant function GetItemNamedSpecial takes integer i returns string
  if ( i == 30 ) then
    return "뮤레칸의 "
  elseif ( i == 35 ) then
    return "축복의 "
  elseif ( i == 40 ) then
    return "생명의 "
  elseif ( i == 45 ) then
    return "파멸의 "
  elseif ( i == 50 ) then
    return "기회의 "
  elseif ( i == 55 ) then
    return "결정의 "
  elseif ( i == 60 ) then
    return "회복의 "
  elseif ( i == 65 ) then
    return "죽음의 "
  elseif ( i == 70 ) then
    return "탐욕의 "
  elseif ( i == 75 ) then
    return "보물의 "
  elseif ( i == 80 ) then
    return "현혹의 "
  elseif ( i == 85 ) then
    return "품격의 "
  elseif ( i == 90 ) then
    return "상냥한 "
  endif
  return ""
endfunction
function GetItemNamed takes item t returns string
  if ( GetItemNamedSpecial(GetItemCharges(t)) != "") then
    //어두운 자존의 -> 뮤레칸의
    return GetItemNamedSpecial(GetItemCharges(t))+GetItemName(t)
  else
    //빛바랜 세토아의 가죽장갑
    return GetNamed1(isNamed(GetItemCharges(t),false),false)+GetNamed2(isNamed(GetItemCharges(t),true))+GetItemName(t)
  endif
endfunction
function NamedItem takes item t returns string
 local integer i = isNamed(GetItemCharges(t),true) // 1~19(종류)
 local integer lv = isNamed(GetItemCharges(t),false) // 1~5(레벨)
 local string s = ""
  if ( i > 0 ) then
  //장비이며 이름이 있음.
    //set s = "$"+I2S(i)+I2S(lv)
    
    set s = "|$" + GetNamed1(lv,true) + GetNamed2(i) + "힘" + GetNamed4(i,lv)
    //강력하게 느껴지는 로오의 힘: WIS +2

  endif
 return s
endfunction
//ItemValue(~~+NamedItem(t),P,true)
//해야하는것
//FMi Hit에 ItemValue함수에 인자값 NamedItem 추가할 것 (장착, 해제 모두)
//ItemValue함수 내 i / j / k / l 추가할것 + $ 추가할 것 (GetNamed1,GetNamed2 함수 위로 이동시킬 것)
//테스팅
//카페에 업로드: 추가 정보

constant function EffectAttach takes integer no returns string
  /* 이펙트에 따라 부착위치 설정 */
  if ( no == 29 ) then
    return "origin"
  elseif ( no == 31 ) then
    return "head"
  elseif ( no >= 15 and no <= 21 ) then
    return "hand left"
  elseif ( no >= 1 ) then
    return "hand right"
  else
    return ""
  endif
endfunction
constant function EffectCode takes integer no returns string
  // 무기
  // 칼: 목도
  if ( no == 2 ) then
    return "war3mapImported\\ItemEffect_Stave_2H_Long_A_01.mdx"
    // 칼: 단검
  elseif ( no == 3 ) then
    return "war3mapImported\\ItemEffect_Sword_41.mdx"
    // 칼: 에페
  elseif ( no == 4 ) then
    return "war3mapImported\\ItemEffect_Sword_23.mdx"
    // 칼: 커틀라스
  elseif ( no == 5 ) then
    return "war3mapImported\\ItemEffect_Sword_1H_Sabre_C_01.mdx"
    // 칼: 세이버
  elseif ( no == 6 ) then
    return "war3mapImported\\ItemEffect_Sword_18.mdx"
    // 칼: 블랙데쓰
  elseif ( no == 7 ) then
    return "war3mapImported\\ItemEffect_Sword_04.mdx"
    // 칼: 그라디우스
  elseif ( no == 8 ) then
    return "war3mapImported\\ItemEffect_Sword_1H_Long_D_03.mdx"
    // 칼: 매스커레
  elseif ( no == 9 ) then
    return "war3mapImported\\ItemEffect_Sword_1H_AnduinLothar.mdx"
    // 칼: 배틀소드
  elseif ( no == 10 ) then
    return "war3mapImported\\ItemEffect_Sword_15.mdx"
    // 단검: 매단검
  elseif ( no == 11 ) then
    return "war3mapImported\\ItemEffect_Sword_53.mdx"
    // 단검: 월연일단검
  elseif ( no == 12 ) then
    return "war3mapImported\\ItemEffect_Sword_1H_Horde_C_01.mdx"
    // 지팡이: 머큐리아 / 완드
  elseif ( no == 14 ) then
    return "war3mapImported\\ItemEffect_Mindstaff.mdx"
    // 방어구
    
  // 명예의벨트
  elseif ( no == 29 ) then
    return "war3mapImported\\ItemEffect_EtherealAura.mdx"
    
    // 투구: OX밴드
  elseif ( no == 31 ) then
    return "war3mapImported\\ItemEffect_ox band 2.mdx"
    
    // 방패: 나무방패
  elseif ( no == 15 ) then
    return "war3mapImported\\ItemEffect_Buckler_Wood.mdx"
    // 방패: 가죽방패
  elseif ( no == 16 ) then
    return "war3mapImported\\ItemEffect_Shield_Horde_B_02.mdx"
    // 방패: 구리방패
  elseif ( no == 17 ) then
    return "war3mapImported\\ItemEffect_Shield_Horde_B_01.mdx"
    // 방패: 퇴마방패
  elseif ( no == 18 ) then
    return "war3mapImported\\ItemEffect_Shield_Naxxramas_D_02.mdx"
    // 방패: 해골방패
  elseif ( no == 19 ) then
    return "war3mapImported\\ItemEffect_Shield_Stratholme_D_02.mdx"
    // 방패: 은제
  elseif ( no == 20 ) then
    return "war3mapImported\\ItemEffect_Shield_Crest_B_02.mdx"
    // 방패: 금제방패
  elseif ( no == 21 ) then
    return "war3mapImported\\ItemEffect_Shield_Horde_B_04.mdx"
    // 방패: 플라늄방패
    
  elseif ( no == 22 ) then
    return "war3mapImported\\ItemEffect_Shield_2H_OutlandRaid_D_01.mdx"
    // 지팡이: 솔라
  elseif ( no == 23 ) then
    return "war3mapImported\\ItemEffect_Stave_39.mdx"
    // 둔기: 스파이크클럽
  elseif ( no == 25 ) then
    return "war3mapImported\\ItemEffect_SpikedClub.mdx"
    // 도끼: 엑스
  elseif ( no == 26 ) then
    return "war3mapImported\\ItemEffect_Axe_2H_ZulGurub_D_01.mdx"
    // 클로
  elseif ( no == 27 ) then
    return "war3mapImported\\ItemEffect_GoldClaw.mdx"
    // 감시자
  elseif ( no == 28 ) then
    return "war3mapImported\\ItemEffect_Another Divinity Attachment.mdx"
    // 타고나이트액스
  elseif ( no == 30 ) then
    return "war3mapImported\\ItemEffect_Golden Axe.mdx"
    // 한손검: 다크블레이드
  elseif ( no == 32 ) then
    return "war3mapImported\\ItemEffect_DarkBlade.mdx"
    // 지팡이: 로톤스태프
  elseif ( no == 33 ) then
    return "war3mapImported\\ItemEffect_RottenStaff.mdx"
    // 단검(표창): 샤나
  elseif ( no == 34 ) then
    return "war3mapImported\\ItemEffect_MeltingBladev2.mdx"
    // 표창1~5 35~38+13
  elseif ( no == 13 ) then
    return "war3mapImported\\ItemEffect_Sword_cakram.mdx"
  elseif ( no == 35 ) then
    return "war3mapImported\\ItemEffect_Sword_cakram_Blue.mdx"
  elseif ( no == 36 ) then
    return "war3mapImported\\ItemEffect_Sword_cakram_Orange.mdx"
  elseif ( no == 37 ) then
    return "war3mapImported\\ItemEffect_Sword_1H_Miev_D_01.mdx"
  elseif ( no == 38 ) then
    return "war3mapImported\\ItemEffect_Sword_1H_Miev_Purple.mdx"
    // 지팡이: 쥬피티아
  elseif ( no == 39 ) then
    return "war3mapImported\\ItemEffect_draeneistaff.mdx"
    // 클로-용발톱
  elseif ( no == 40 ) then
    return "war3mapImported\\ItemEffect_DragonClow.mdx"
    // 곡단, 아수라, 솔라, 루나, 투핸드, 전용템
  elseif ( no == 41 ) then
    return "war3mapImported\\ItemEffect_AcolyteDagger.mdx"
  elseif ( no == 42 ) then
    return "war3mapImported\\ItemEffect_DemonicSword.mdx"
  elseif ( no == 43 ) then
    return "war3mapImported\\ItemEffect_DruidStaff.mdx"
  elseif ( no == 24 ) then
    return "war3mapImported\\ItemEffect_ArcaneStaff.mdx"
  elseif ( no == 45 ) then
    return "war3mapImported\\ItemEffect_Iron Claymore.mdx"
  elseif ( no == 46 ) then
    return "war3mapImported\\ItemEffect_Harvester.mdx"
    // 도끼- 토마호크
  elseif ( no == 47 ) then
    return "war3mapImported\\ItemEffect_Stone Tomahawk.mdx"
    // 몽둥이
  elseif ( no == 48 ) then
    return "war3mapImported\\ItemEffect_Baseballbat.mdx"
  elseif ( no == 49 ) then
    return "war3mapImported\\ItemEffect_brdishu.mdx"
  endif
  return ""
endfunction
function ItemGetEffect takes integer P, integer no, boolean on returns nothing
  call DestroyEffect(LoadEffectHandle(udg_hash, StringHash("Effect")+P, StringHash(EffectAttach(no))))
  if ( on ) then
    call SaveEffectHandle(udg_hash, StringHash("Effect")+P, StringHash(EffectAttach(no)), AddSpecialEffectTarget(EffectCode(no), udg_Unit[P], EffectAttach(no)))
  else
    call RemoveSavedHandle(udg_hash, StringHash("Effect")+P, StringHash(EffectAttach(no)))
  endif
endfunction
constant function GetNamed5 takes integer i returns string
  if ( i == 0 ) then
    return ""
  elseif ( i-(i/5)*5 == 0 ) then
    return GetNamed4((i-1)/5+1,5)
  else
    return GetNamed4((i-1)/5+1,i-(i/5)*5)
  endif
endfunction
constant function TITLEVALUE takes integer i, integer lv returns string
  if ( i == 1 ) then
    if ( lv == 1 ) then
      return "유저|f50"
    elseif ( lv == 2 ) then
      return "2서클|g100"
    elseif ( lv == 3 ) then
      return "3서클|32|f100|g100"
    elseif ( lv == 4 ) then
      return "4서클|f300|g300"
    elseif ( lv == 5 ) then
      return "5서클|a1|c1"
    elseif ( lv == 6 ) then
      return "베테랑|f200|g200|a1|c1"
    endif
  elseif ( i == 2 ) then
    if ( lv == 1 ) then
      return "좀비Lv1|f44"
    elseif ( lv == 2 ) then
      return "좀비Lv2|f144"
    elseif ( lv == 3 ) then
      return "좀비Lv3|f244"
    elseif ( lv == 4 ) then
      return "좀비Lv4|f344"
    elseif ( lv == 5 ) then
      return "좀비Lv5|f444"
    elseif ( lv == 6 ) then
      return "좀비Lv6|f555"
    elseif ( lv == 7 ) then
      return "좀비Lv7|f666"
    elseif ( lv == 8 ) then
      return "좀비Lv8|f777"
    elseif ( lv == 9 ) then
      return "좀비Lv9|f1000"
    endif
  elseif ( i == 3 ) then
    return "방능자|f200|g200|a1|c1"
  elseif ( i == 4 ) then
    return "행운자|67"
  elseif ( i == 5 ) then
    if ( lv == 1 ) then
      return "초보리포터|73"
    elseif ( lv == 2 ) then
      return "견습리포터|74"
    elseif ( lv == 3 ) then
      return "숙련리포터|75"
    elseif ( lv == 4 ) then
      return "전문리포터|76"
    elseif ( lv == 5 ) then
      return "도인리포터|77"
    elseif ( lv == 6 ) then
      return "달인리포터|79"
    elseif ( lv == 7 ) then
      return "장인리포터|711"
    elseif ( lv == 8 ) then
      return "최고리포터|713"
    elseif ( lv == 9 ) then
      return "유일리포터|715"
    endif
  elseif ( i == 6 ) then
    if ( lv == 1 ) then
      return "당첨자|53|63|73"
    elseif ( lv == 2 ) then
      return "전문가|55|65|75"
    elseif ( lv == 3 ) then
      return "마스터|57|67|77"
    endif
  elseif ( i == 7 ) then
    if ( lv == 1 ) then
      return "초심자|53"
    elseif ( lv == 2 ) then
      return "모험가|55"
    elseif ( lv == 3 ) then
      return "숙련모험가|57"
    elseif ( lv == 4 ) then
      return "달인모험가|59"
    elseif ( lv == 5 ) then
      return "개척가|55|a1|c1"
    elseif ( lv == 6 ) then
      return "달인개척가|57|a1|c1"
    elseif ( lv == 7 ) then
      return "정복자|59|a1|c1"
    elseif ( lv == 8 ) then
      return "정복왕|59|h1"
    elseif ( lv == 9 ) then
      return "끝판왕|h2"
    endif
  elseif ( i == 8 ) then
    if ( lv == 1 ) then
      return "현자"
    elseif ( lv == 2 ) then
      return "최고현자"
    endif
  elseif ( i == 9 ) then
    return "테일러"
  elseif ( i == 10 ) then
    if ( lv == 1 ) then
      return "푸사교|55|63|7-5|f300|g100"
    elseif ( lv == 2 ) then
      return "선구자|57|65|7-5|f400|g200"
    elseif ( lv == 3 ) then
      return "길마|59|69|7-5|f500|g300"
    endif
  elseif ( i == 11 ) then
    if ( lv == 1 ) then
      return "테스터|51|61|71|h1"
    elseif ( lv == 3 ) then
      return "최초지존|53|63|73|h1"
    elseif ( lv == 4 ) then
      return "최초승급|55|65|75|h1"
    endif
  elseif ( i == 12 ) then
  //개인 칭호
    if ( lv == 1 ) then
      return "보상자|f1000|h2"
    elseif ( lv == 2 ) then
      return "멍충이|f777|g345|57|67|7-10|a1|c1"
    elseif ( lv == 3 ) then
      return "방능자|57|67|77|d2"
    elseif ( lv == 4 ) then
      return "법느님|c1|510|p15."
    elseif ( lv == 5 ) then
      return "헬프미|f100|g100|d1|e1|51|61|71"
    elseif ( lv == 6 ) then
      return "침묵의|f1000|a2|55" 
    elseif ( lv == 7 ) then
      return "키리노|f777|p15|57|67|77|c10|d10"
    elseif ( lv == 8 ) then
      return "마스터|f1500|g1250|h5|oZ-1|#전체 캐스팅 -1초|oZ*.5|#전체 캐스팅 -50|p7|725|m3|e3|s15"
    elseif ( lv == 9 ) then
      return "###|h1|g500|75|oK-1|#쿨감(힐) -1초"
    endif
  elseif ( i == 13 ) then
    if ( lv == 1 ) then
      return "사제|h1"
    elseif ( lv == 2 ) then
      return "스승|h1|57|67|77"
    endif
  elseif ( i == 14 ) then
    if ( lv == 1 ) then
      return "임시1|51|61|71"
    elseif ( lv == 2 ) then
      return "임시2|52|62|72"
    elseif ( lv == 3 ) then
      return "임시3|53|63|73"
    elseif ( lv == 4 ) then
      return "임시4|54|64|74"
    elseif ( lv == 5 ) then
      return "임시5|55|65|75"
    elseif ( lv == 6 ) then
      return "임시6|56|66|76"
    elseif ( lv == 7 ) then
      return "임시7|57|67|77"
    elseif ( lv == 8 ) then
      return "임시8|58|68|78"
    elseif ( lv == 9 ) then
      return "임시9|59|69|79"
    endif
  elseif ( i == 15 ) then
    if ( lv == 1 ) then
      return "1임시|h1"
    elseif ( lv == 2 ) then
      return "2임시|h2"
    elseif ( lv == 3 ) then
      return "3임시|h3"
    endif
  elseif ( i == 16 ) then
    if ( lv == 1 ) then
      return "참가상|f200|73"
    elseif ( lv == 2 ) then
      return "개근상|f300|g150|75"
    elseif ( lv == 3 ) then
      return "진행상|f400|g200|77"
    elseif ( lv == 4 ) then
      return "진행왕|f500|g300|79"
    endif
  endif
  //밑에 loopA 15 늘릴것
  return ""
endfunction
native EXExecuteScript takes string script returns string
function EXExecuteScript2 takes string str, integer i, string str2 returns string
    return EXExecuteScript("(require'jass.slk')." + str + "[" + I2S(i)+"]." + str2)
endfunction
constant function Inventory_IC2B takes integer i returns integer
//아이템 종류가 어느 버튼에 들어가야 하는지 반환
//Item Class to Button
  if ( i >= 1 ) and ( i <= 8 ) then /* 한손검, 수리검, 표창, 채찍, 클로, 도끼, 양손검, 스태프 = 무기 */
    return FMI_MAXMAX_INVENTORY+7
  elseif ( i == 10 ) then /* 방패 */
    return FMI_MAXMAX_INVENTORY+6
  elseif ( i == 11 ) then /* 갑옷 */
    return FMI_MAXMAX_INVENTORY+5
  elseif ( i == 12 ) then /* 투구 to 모자 */
    return FMI_MAXMAX_INVENTORY+1
  elseif ( i == 13 ) then /* 목걸이 */
    return FMI_MAXMAX_INVENTORY+3
  elseif ( i == 14 ) then /* 귀걸이 */
    return FMI_MAXMAX_INVENTORY+4
  elseif ( i == 15 ) or ( i == 16 ) then /* 장갑, 팔찌 */
    return FMI_MAXMAX_INVENTORY+8
  elseif ( i == 17 ) then /* 벨트 */
    return FMI_MAXMAX_INVENTORY+9
  elseif ( i == 18 ) then /* 각반 */
    return FMI_MAXMAX_INVENTORY+10
  elseif ( i == 19 ) then /* 신발 */
    return FMI_MAXMAX_INVENTORY+11
  elseif ( i == 20 ) then /* 반지 */
    return FMI_MAXMAX_INVENTORY+12
  elseif ( i == 9 ) then /* 특수부위 - 미구현 자리 */
    return FMI_MAXMAX_INVENTORY+2
  else
    return 0
  endif
endfunction
constant function ISTWOHAND takes string s returns boolean
 return ( s == "6" or s == "7" or s == "8" )
endfunction
function ItemEquip takes integer P, item t, boolean msg, boolean plus returns nothing
 local string all = LoadStr(udg_hash, GetItemTypeId(t), StringHash("FMi-Val"))+GetNamed5(GetItemCharges(t))
 local integer i = 0
 local string S = ""
 local real r = 0.
 local integer i2 = 0
 local string S2 = ""
  if ( t == null ) then
    set all = TITLEVALUE(udg_SysB_TitleNow[P],S2I(SubString(udg_SysB_Title[P],udg_SysB_TitleNow[P]-1,udg_SysB_TitleNow[P])))
debug call BJDebugMsg("ItemEquip - 0. t is null")
  endif
debug call BJDebugMsg("ItemEquip - " + all)
  loop
    set S = JNStringSplit(all, "|", i)
    exitwhen S == null or S == ""
    set i = i + 1
  endloop
  if ( i > 0 ) then
    set i = 1
    if ( t != null ) then
      if ( plus ) then
        if ( msg ) then
          call MSG(Player(P-1), 2, 8., "|c00ffff00" + GetItemNamed(t) + BaseStr(11) + "을(를) 장착했습니다.")
        endif
        /* 양손무기 설정 */
        if ( Inventory_IC2B(S2I(EXExecuteScript2("item", GetItemTypeId(t), "oldLevel"))) == FMI_MAXMAX_INVENTORY+7 ) then
          call SaveBoolean(udg_hash, StringHash("FMi_2Hand"), P, ISTWOHAND(EXExecuteScript2("item", GetItemTypeId(t), "oldLevel")))
        endif
    
        /* 네임드 아이템 설정 */
        if ( GetItemCharges(t) > 0 ) then
          call SaveInteger(udg_hash, P, StringHash("itnad") + isNamed(GetItemCharges(t), true), LoadInteger(udg_hash, P, StringHash("itnad") + isNamed(GetItemCharges(t), true)) + isNamed(GetItemCharges(t), false))
        endif
      else
        if ( msg ) then
          call MSG(Player(P-1), 2, 8., "|c00ffff00" + GetItemNamed(t) + BaseStr(11) + "을(를) 해제했습니다.")
        endif
        
        /* 양손무기 설정 */
        if ( Inventory_IC2B(S2I(EXExecuteScript2("item", GetItemTypeId(t), "oldLevel"))) == FMI_MAXMAX_INVENTORY+7 ) then
          call SaveBoolean(udg_hash, StringHash("FMi_2Hand"), P, ISTWOHAND(EXExecuteScript2("item", GetItemTypeId(t), "oldLevel")))
        endif
    
        /* 네임드 아이템 설정 */
        if ( GetItemCharges(t) > 0 ) then
          call SaveInteger(udg_hash, P, StringHash("itnad") + isNamed(GetItemCharges(t), true), LoadInteger(udg_hash, P, StringHash("itnad") + isNamed(GetItemCharges(t), true)) - isNamed(GetItemCharges(t), false))
        endif
      endif
    endif
    loop
      set S = JNStringSplit(all, "|", i)
      exitwhen S == "" or S == null
      set S2 = SubString(S, 0, 1)
      if ( S2 == "o" ) then
        set S2 = JNStringSplit(all, "|", i+1)
        if ( plus ) then
          call SaveStr(udg_hash, GetHandleId(udg_Unit[P]), StringHash("FCS_" + SubString(S, 1, 2)), LoadStr(udg_hash, GetHandleId(udg_Unit[P]), StringHash("FCS_" + SubString(S, 1, 2))) + "|" + SubString(S, 2, StringLength(S)))
          set S2 = "|cff8080ff" + SubString(S2, 1, StringLength(S2)) + " |cffffdc3c옵션 |cff46ffff추가"
          set i = i + 1
        else
          call SaveStr(udg_hash, GetHandleId(udg_Unit[P]), StringHash("FCS_" + SubString(S, 1, 2)), StringWithoutInput(LoadStr(udg_hash, GetHandleId(udg_Unit[P]), StringHash("FCS_" + SubString(S, 1, 2))) , "|" + SubString(S, 2, StringLength(S))))
          set S2 = "|cff8080ff" + SubString(S2, 1, StringLength(S2)) + " |cffffdc3c옵션 |cffff3315제거"
          set i = i + 1
        endif
      elseif ( ViewFull(S2) ) then
        if ( plus ) then
          set r = S2R(SubString(S, 1, StringLength(S)))
        else
          set r = -S2R(SubString(S, 1, StringLength(S)))
        endif
        if ( S2 == "0" ) then
          loop
            exitwhen SubString(S, i2, i2 + 1) == "~"
            if ( i2 >= StringLength(S) ) then
              set i2 = -1
              exitwhen true
            endif
            set i2 = i2+1
          endloop
          if ( i2 != - 1 ) then
            if ( r > 0 ) then
              call StatAdd("1" , P , S2I(SubString(S, 1, i2)))
              call StatAdd("2" , P , S2I(SubString(S, i2+1, StringLength(S))) - S2I(SubString(S, 1, i2)))
            else
              call StatAdd("1" , P , - S2I(SubString(S, 1, i2)))
              call StatAdd("2" , P , - (S2I(SubString(S, i2+1, StringLength(S))) - S2I(SubString(S, 1, i2))))
            endif
            set S2="|cffffdc3c (현재 공격력: |cff46ffff" + I2S(udg_SysC_DmgAttack[P]) + "~" + I2S(udg_SysC_DmgAttack[P] + udg_SysC_DmgAttackAdd[P]) + "|cffffdc3c)"
          else
            call MSG(Player(P - 1) , - 1 , 8 , "데이터 에러! - 무기류에 ~ 생략")
          endif
        else
          set S2=StatAdd(S2, P, r)
        endif
        if ( r >= 0. ) then
          if ( plus ) then
            set S2="|cff46ffff+" + SubString(S, 1, StringLength(S)) + "|cffffdc3c 증가" + S2
          else
            //공속 등, 버렸을때 오르는 경우, 회복이라고 표시, "-"부호 제거를 위해 한칸 뒤 시작
            set S2="|cff46ffff+" + SubString(S, 2, StringLength(S)) + "|cffffdc3c 회복" + S2
          endif
        else
          if ( not plus ) then
            set S2="|cffff3315" + SubString(S, 1, StringLength(S)) + "|cffffdc3c (감소)" + S2
          else
            //공속 등, 먹었을때 마이너스 상승의 경우 --10라고 뜨는거 방지
            set S2="|cffff3315" + SubString(S, 1, StringLength(S)) + "|cffffdc3c (감소)" + S2
          endif
        endif
      elseif ( S2 == "$" ) then
        //설명문 그대로 붙임
        if ( plus ) then
          set S2="|cff0078ff" + SubString(S, 1, StringLength(S)) + "|r: "
        else
          //끝에서 14자리: 셔스 앞 띄워쓰기 있으면 2글자 판정, 없으면 3글자 판정해서 띄워쓰기 한칸 조절
          if ( SubString(S, StringLength(S) - 14, StringLength(S) - 13) == " " ) then
            set S2="|cff0078ff" + SubString(S, StringLength(S) - 13, StringLength(S)) + "이 거두어진다...|r"
          else
            set S2="|cff0078ff" + SubString(S, StringLength(S) - 16, StringLength(S)) + "이 거두어진다...|r"
          endif
        endif
      else
        if ( plus ) then
          set i2=S2I(SubString(S, 1, StringLength(S)))
        else
          set i2=- S2I(SubString(S, 1, StringLength(S)))
        endif
        set S2=StatAdd(S2 , P , i2)
        if ( i2 >= 0 ) then
          set S2="|cff46ffff+" + I2S(i2) + "|cffffdc3c 증가" + S2
        else
          set S2="|cffff3315" + I2S(i2) + "|cffffdc3c (감소)" + S2
        endif
      endif
      if ( msg ) then
        call MSG(Player(P-1), 1, 8., IData(SubString(S, 0, 1)) + " " + S2)
      endif
      set i=i + 1
    endloop
    call ItemGetEffect(P, S2I(SubString(all,5,7)), plus)
  else
    call MSG(Player(P-1), -1, 8, "데이터 에러! - 아이템 설정 없음 / " + GetItemName(t) + "/" + all)
  endif
endfunction
//call ItemEquip(P, item, msg, plus)

//(=string) EXExecuteScript2("item", itid, "oldLevel")
function ItemJustOff takes integer P, integer slot returns nothing
/* 장비창 → 외부로 버리기 (발 앞) */
 local item t = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), slot)
 local integer itid = GetItemTypeId(t)
 
  call ItemEquip(P, t, true, false)
  call SetItemPosition(t, GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]))
  call SetItemVisible(t, true)
   
  // 해쉬 비우기
  call RemoveSavedBoolean(udg_hash, P, StringHash("Sbol") + slot)
  call RemoveSavedInteger(udg_hash, P, StringHash("Sitid") + slot)
  call RemoveSavedInteger(udg_hash, P, StringHash("Sitco") + slot)
  //call RemoveSavedString(udg_hash, P, StringHash("Sitname") + slot)
  call RemoveSavedHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), slot)
 
  // 버튼 다시 활성화
  if ( GetLocalPlayer() == Player(P-1) ) then
  
    //아이콘 갱신
    call DzFrameShow(DzFrameFindByName("EqSl_DesBack", 0), false)
    call DzFrameShow(DzFrameFindByName("EqSl_Active", 0), false)
    call DzFrameShow(DzFrameFindByName("EqSl_SlotBlackBox", slot), false)
    call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotA", slot), "UI\\Console\\Human\\human-transport-slot.blp", 0)
    call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotB", slot), "UI\\Console\\Human\\human-transport-slot.blp", 0)
    
    //call Inventory_RefreshItemDes(P-1, itid, DzFrameFindByName("EqSl_SlotA", slot), true)
  endif
  set t = null
endfunction

function ItemJustOn takes integer P, item t returns boolean
 local integer itid = GetItemTypeId(t)
 local integer slot = Inventory_IC2B(S2I(EXExecuteScript2("item", itid, "oldLevel")))
/* 외부 → 장비창 바로 먹기 */
  if ( LoadBoolean(udg_hash, P, StringHash("Sbol") + slot) ) then
    return false
  else
    call SaveBoolean(udg_hash, P, StringHash("Sbol") + slot, true)
    call SaveInteger(udg_hash, P, StringHash("Sitid") + slot, itid)
    call SaveInteger(udg_hash, P, StringHash("Sitco") + slot, GetItemCharges(t))
    //call SaveStr(udg_hash, P, StringHash("itname") + slot, GetItemNamed(t))
    call SaveItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), slot, t)
    call ItemEquip(P, t, true, true)
    
    if ( GetLocalPlayer() == Player(P-1) ) then
        // 아이콘 설정
      call DzFrameShow(DzFrameFindByName("EqSl_DesBack", 0), false)
      call DzFrameShow(DzFrameFindByName("EqSl_Active", 0), false)
      call DzFrameShow(DzFrameFindByName("EqSl_SlotBlackBox", slot), false)
      call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotA", slot), EXExecuteScript2("item", itid, "Art"), 0)
      call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotB", slot), EXExecuteScript2("item", itid, "Art"), 0)
    
      // 설명창 갱신
      //call Inventory_RefreshItemDes(P-1, itid, DzFrameFindByName("EqSl_SlotA", slot), true)
    endif
    return true
  endif
endfunction

function IndexGet2 takes integer val, integer i1 returns integer
 local integer loopA = 1
  loop
    if ( i1 == loopA ) then
//debug call BJDebugMsg("IndexGet = " + I2S(ModuloInteger(val,SetupIndex(loopA))))
      return ModuloInteger(val,2)
    endif
    set val = val / 2
    exitwhen loopA >= 3 // Max
    set loopA = loopA + 1
  endloop
 return 0
endfunction
function Load takes string Code, integer P returns boolean
 local integer i = 0
 local string tempCode = ""
 local item tempItem = null
  if ( StringLength(Code) >= 133 ) then
    set Code = Code
//debug call BJDebugMsg("Load..6-2, 복호화 전 코드("+I2S(StringLength(Code))+"): "+Code)
  elseif ( StringLength(Code) == 0 ) then
    call MSG(Player(P-1), 2, 8, "로드 |cffff0000실패! |r - |cffffdc3c빈 코드입니다. 최신버전을 확인하세요.")
    return false
  else
    set Code = FSE_Coding(Code,false)
//debug call BJDebugMsg("Load..6-1, 복호화 전 코드("+I2S(StringLength(Code))+"): "+Code)
    loop
      exitwhen i+4 > StringLength(Code)
      set tempCode = tempCode + FSE_I2S(FSE_S2I(SubString(Code,i,i+4)),9999999)
//debug call BJDebugMsg("Load..8( " + I2S(i+1) + "∼" + I2S(i+4) + " ): " + SubString(Code,i,i+4) + "→" + FSE_I2S(FSE_S2I(SubString(Code,i,i+4)),9999999))
      set i = i + 4
    endloop
    set Code = tempCode
  endif
//debug call BJDebugMsg("Load..6, 복호화 후 코드("+I2S(StringLength(tempCode))+"): "+tempCode)
/* //Check
  set i = 3
  set tempCode = ""
  loop
    exitwhen i >= StringLength(Code)
    set tempCode = I2S(S2I(tempCode) + S2I(SubString(Code,i,i+5)))
//debug call BJDebugMsg("Load..3 "+I2S(i)+"번째 Code +"+SubString(Code,i,i+5)+"="+tempCode)
    set i = i + 5
  endloop
//debug call BJDebugMsg("Load..4 "+tempCode+" + "+I2S(P2I(udg_SysB_Name[P])))
  set tempCode = FSE_I2S(ModuloInteger(S2I(tempCode)+P2I(udg_SysB_Name[P]),1000),999)
  set udg_Save_CodeOri3[P] = tempCode
//debug call BJDebugMsg("Load..5 "+tempCode+" vs "+SubString(Code,0,3))
  if ( tempCode != SubString(Code,0,3) ) then
//debug call BJDebugMsg("Load..6-2 NO")
    call MSG(Player(P-1), 2, 8, "로드 |cffff0000실패! |r - |cffffdc3c잘못된 코드입니다.")
//debug call BJDebugMsg("Value: " + SubString(Code,129,133))
    return false
  endif
  */
//debug call BJDebugMsg("Load..6-1 OK")
  set udg_Save_Count[P] = 2

//자원
  set i = S2I(SubString(Code,3,6))
  if ( i == 999 ) then
    set i = 1000000
  else
    set i = i * 1000
  endif
  call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, i)
  call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, S2I(SubString(Code,6,9)))

//영웅
  set udg_Unit[P] = CreateUnit(Player(P-1),SysInt(1,S2I(SubString(Code,9,11))), 96., -19616., GetRandomReal(0,360))
  set i = S2I(SubString(Code,11,13))
  set udg_SysB_Level[P] = i
  if ( i > 1 ) then
    call SetHeroLevel(udg_Unit[P],i,false)
    set udg_Save_HP[P] = S2I(SubString(Code,31,36)) + S2I(SubString(Code,129,131))*100000
    set udg_Save_MP[P] = S2I(SubString(Code,36,41)) + S2I(SubString(Code,131,133))*100000
    debug call BJDebugMsg("HP+ " + SubString(Code,129,131))
    debug call BJDebugMsg("MP+ " + SubString(Code,131,133))
    set udg_SysC_Armor_B[P] = i/3
    set udg_SysC_Armor[P] = udg_SysC_Armor_B[P]
  endif
  call AddHeroXP(udg_Unit[P],FSE_I2E(udg_Unit[P],S2I(SubString(Code,13,16))),false)
  call SaveInteger(udg_hash, P, StringHash("Exp"), GetHeroXP(udg_Unit[P]))
  call TriggerRegisterUnitEvent(gg_trg_Level_UP, udg_Unit[P], EVENT_UNIT_HERO_LEVEL)
  call TriggerRegisterUnitEvent(gg_trg_ReviveHero, udg_Unit[P], EVENT_UNIT_DEATH)


//스텟
  set udg_SysE_STR1[P] = S2I(SubString(Code,16,19))
  set udg_SysE_DEX1[P] = S2I(SubString(Code,19,22))
  set udg_SysE_INT1[P] = S2I(SubString(Code,22,25))
  set udg_SysE_WIS1[P] = S2I(SubString(Code,25,28))
  set udg_SysE_CON1[P] = S2I(SubString(Code,28,31))
  
  set udg_SysE_STR3[P] = udg_SysE_STR1[P] +udg_SysE_STR2[P]
  set udg_SysE_DEX3[P] = udg_SysE_DEX1[P] +udg_SysE_DEX2[P]
  set udg_SysE_INT3[P] = udg_SysE_INT1[P] +udg_SysE_INT2[P]
  set udg_SysE_WIS3[P] = udg_SysE_WIS1[P] +udg_SysE_WIS2[P]
  set udg_SysE_CON3[P] = udg_SysE_CON1[P] +udg_SysE_CON2[P]
  set udg_SysC_MissMagic[P] = R2I(udg_SysE_INT3[P] * BaseValue(6))
  
  call SetHeroStr(udg_Unit[P], udg_SysE_CON3[P], true)
  call SetHeroAgi(udg_Unit[P], udg_SysE_DEX3[P], true)
  call SetHeroInt(udg_Unit[P], udg_SysE_WIS3[P], true)
  
  call SetUS("Hp", udg_Unit[P], GetHPMP(P,true), true)
  call SetUS("Mp", udg_Unit[P], GetHPMP(P,false), true)

  set udg_SysC_DmgNow[P] = "최근: 0"
  call SetDmg(udg_Unit[P])

//스킬
  set i = 1
  loop
    if ( S2I(SubString(Code,i*4+37,i*4+40)) <= udg_FSE_Skill[0] ) then
      call UnitAddAbility(udg_Unit[P], udg_FSE_Skill[S2I(SubString(Code,i*4+37,i*4+40))])
      call SetUnitAbilityLevel(udg_Unit[P], udg_FSE_Skill[S2I(SubString(Code,i*4+37,i*4+40))], S2I(SubString(Code,i*4+40,i*4+41))+1)
      call SaveInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(i)), udg_FSE_Skill[S2I(SubString(Code,i*4+37,i*4+40))])
    endif
    exitwhen i >= 7
    set i = i + 1
  endloop

//아이템, 장착된 (FMI_MAXMAX_INVENTORY=56 + 1~12) // 124~127
  set i = 1
  loop
    set tempItem = CreateItem(udg_FSE_it[S2I(SubString(Code,i*5+64,i*5+67))], -13888., -23840.)
    if ( tempItem != null ) then
      call SetItemCharges(tempItem, S2I(SubString(Code,i*5+67,i*5+69)))
      call SetItemUserData(tempItem, P)
      
      if ( ItemJustOn(P, tempItem) ) then
        call SetItemVisible(tempItem, false)
      else
        call SetItemPosition(tempItem, 96., -19616.)
      endif
    endif
    exitwhen i >= 12
    set i = i + 1
  endloop

  call SetWidgetLife(udg_Unit[P], GetUnitState(udg_Unit[P], UNIT_STATE_MAX_LIFE))
  call SetUnitState(udg_Unit[P], UNIT_STATE_MANA, GetUnitState(udg_Unit[P], UNIT_STATE_MAX_MANA))
  set i = 0
  set tempCode = null
  set tempItem = null
  return true
endfunction
function FMi_GetEmpty takes integer P returns integer
//다음에 먹을 빈 공간 찾기
 local integer i = 1
 local integer j = StringHash("FMi_Item"+I2S(P))
  loop
    if ( LoadItemHandle(udg_hash, j, i) == null ) or not ( HaveSavedHandle(udg_hash, j, i) ) then 
      return i
    endif
    exitwhen i >= FMI_MAX_INVENTORY+FMI_add_Inventory[P]
    set i = i + 1
  endloop      
  if ( i >= FMI_MAX_INVENTORY+FMI_add_Inventory[P] ) then
    call MSG(Player(P-1), 1, 4, "인벤토리가 가득 찼습니다.")
  endif
  return -1
endfunction
function ForceGiveItem takes integer P, integer no, item t, integer itco returns nothing
  if ( t != null ) then
    if ( itco != -1 ) then /* 강제 설정, 로드 아이템 */
      call SetItemCharges(t, itco)
      call SetItemUserData(t, P)
      call SaveBoolean(udg_hash, StringHash("LoadItem"), GetHandleId(t), true)
      call SaveInteger(udg_hash, P, StringHash("itco") + no, itco)
    else
      call SaveInteger(udg_hash, P, StringHash("itco") + no, GetItemCharges(t))
    endif
    
    set itco = GetItemTypeId(t)
    call SaveBoolean(udg_hash, P, StringHash("bol") + no, true)
    call SaveInteger(udg_hash, P, StringHash("itid") + no, itco)
    
    call SaveItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), no, t)
    if ( GetLocalPlayer() == Player(P-1) ) then
      call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", no), EXExecuteScript2("item", itco, "Art"), 0)
      call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", no), EXExecuteScript2("item", itco, "Art"), 0)
    endif
    call SetItemPosition(t, -13888., -23840.)
    call SetItemVisible(t, false)
  endif
endfunction
//call ForceGiveItem(P, i, item)

function Load2 takes string Code2, integer P returns boolean
 local integer i = 0
 local string tempCode = ""
 local item tempItem = null
//debug call BJDebugMsg("Load2..0 Code2["+I2S(StringLength(Code2))+"]: "+Code2)
  if ( StringLength(Code2) >= 147 ) then
    set Code2 = Code2
  elseif ( Code2 == "" ) or ( Code2 == null) then
    call MSG(Player(P-1), 2, 8, "로드 |cffff0000실패! |r - |cffffdc3c비어있는 코드입니다. ("+udg_Save_CodeOri3[P] +")")
    return false
  else
    set Code2 = FSE_Coding(Code2,false)
    loop
      exitwhen i+4 > StringLength(Code2)
      set tempCode = tempCode + FSE_I2S(FSE_S2I(SubString(Code2,i,i+4)),9999999)
      set i = i + 4
    endloop
    set Code2 = tempCode
  endif
//debug call BJDebugMsg("Load2..2 Code2["+I2S(StringLength(Code2))+"]: "+Code2)
/*
  if ( udg_Save_CodeOri3[P] != SubString(Code2,4,7) ) then
    call MSG(Player(P-1), 2, 8, "로드 |cffff0000실패! |r - |cffffdc3c메인코드와 맞지 않습니다. ("+udg_Save_CodeOri3[P]+"vs"+SubString(Code2,4,7)+")")
    set tempItem = null
    return false
  endif
//Check
  set i = 7
  set tempCode = ""
  loop
    exitwhen i >= StringLength(Code2)
    set tempCode = I2S(S2I(tempCode) + S2I(SubString(Code2,i,i+5)))
//debug call BJDebugMsg("Load2..3 "+I2S(i)+"번째 Code +"+SubString(Code2,i,i+5)+"="+tempCode)
    set i = i + 5
  endloop
  set tempCode = FSE_I2S(ModuloInteger(S2I(tempCode)+P2I(udg_SysB_Name[P]),1000),999)
  if ( tempCode != SubString(Code2,1,4) ) then
    call MSG(Player(P-1), 2, 8, "로드 |cffff0000실패! |r - |cffffdc3c잘못된 코드입니다. ("+tempCode+"vs"+SubString(Code2,1,4)+")")
    set tempItem = null
    return false
  endif
  */

//아이템, 소유한 (1~28)
  set i = 1
  loop
    call ForceGiveItem(P, i, CreateItem(udg_FSE_it[S2I(SubString(Code2,i*5+2,i*5+5))], 0., 0.), S2I(SubString(Code2,i*5+5,i*5+7)))
    exitwhen i >= FMI_MAX_INVENTORY
    set i = i + 1
  endloop
  //call FMi_GetEmpty(P)
  if ( S2I(SubString(Code2,0,1)) > 0 ) then
    set bj_lastCreatedItem = CreateItem('I084', GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]))
    call SetItemCharges(bj_lastCreatedItem, S2I(SubString(Code2,0,1))*100)
    call UnitAddItem(udg_Unit[P], bj_lastCreatedItem)
    call SetItemUserData(bj_lastCreatedItem, P)
    call SaveBoolean(udg_hash, StringHash("LoadItem"), GetHandleId(bj_lastCreatedItem), true)
  endif
  call SetUnitPosition(udg_Unit[P], GetRectCenterX(gg_rct_Setting_Start), GetRectCenterY(gg_rct_Setting_Start))
  
  if ( udg_SysA_ReloadEnd ) and ( LoadTimerDialogHandle(udg_hash, StringHash("Select Timer"), StringHash("TEMP")) == null ) then
    call CreateTimerDialogBJ(CreateTimerBJ(false, 600.), "로드 후 10분간 제련불가")
    call TriggerRegisterTimerExpireEvent(gg_trg_Selcet_N_TD, bj_lastStartedTimer)
    call SaveTimerDialogHandle(udg_hash, StringHash("Select Timer"), StringHash("TEMP"), bj_lastCreatedTimerDialog)
    set udg_SysA_ReloadEnd = false
  elseif ( not JNUse() ) then
    call TriggerSleepAction(1.)
    if ( not JNUse() ) then
      call OnlineGame(Player(P-1), 2, "")
    endif
  endif
 return true
endfunction

function CreateTrackableBJ takes player p, string mpath, real x, real y, real z, integer no, trigger th, trigger tt returns nothing
 local integer i = 0
 local string Flat = "Doodads\\Terrain\\InvisiblePlatform\\InvisiblePlatform.mdl"
  if ( p != null ) then
    if ( no != 43 and no != 0 ) then
    //기본: 전체 공개 / 개인 기능(버리기 등: 해당 플레이어만 보이게 without Turn 버튼)
      if ( GetLocalPlayer() != p ) then
        set mpath = ""
        set Flat = ""
      endif
    endif
  endif
  if ( z > 0. ) then
    set bj_lastCreatedDestructable = CreateDestructableZ('OTip', x, y, z, 0., 1, 0)
    if ( no != 0 ) then
      set udg_temp_tr = CreateTrackable(Flat, x, y, 0)
    endif
    set bj_lastCreatedEffect = AddSpecialEffect(mpath, x, y)
    call RemoveDestructable(bj_lastCreatedDestructable)
  else
    if ( no != 0 ) then
      set udg_temp_tr = CreateTrackable(Flat, x, y, 0)
    endif
    set bj_lastCreatedEffect = AddSpecialEffect(mpath, x, y)
  endif
  if ( th != null ) then
    call TriggerRegisterTrackableHitEvent(th, udg_temp_tr)
  endif
  if ( tt != null ) then
    call TriggerRegisterTrackableTrackEvent(tt, udg_temp_tr)
  endif
  if ( no != 0 ) then
    set i = GetHandleId(udg_temp_tr)
    call SaveReal(udg_hash, i, StringHash("tr-x"), x)
    call SaveReal(udg_hash, i, StringHash("tr-y"), y)
    call SaveReal(udg_hash, i, StringHash("tr-z"), z)
    call SaveInteger(udg_hash, i, StringHash("tr-n"), no)
    
    call SaveTrackableHandle(udg_hash, no, StringHash("FMi_tr"+I2S(GetPlayerId(p)+1)), udg_temp_tr)
  endif
  if ( p == null ) then
    set x = 400
  else
    set x = 401+GetPlayerId(p)
    call SavePlayerHandle(udg_hash, i, StringHash("tr-p"), p)
  endif
  set y = LoadInteger(udg_hash, R2I(x), 0)+1
  call SaveEffectHandle(udg_hash, R2I(x), R2I(y), bj_lastCreatedEffect)
 set Flat = null
endfunction

function DestroyTrackable takes integer i returns nothing
 local integer j = 0
  set j = LoadInteger(udg_hash, i, 0)
  if ( j != 0 ) then
    loop
      exitwhen j <= 0
      call DestroyEffect(LoadEffectHandle(udg_hash, i, j))
      call FlushChildHashtable(udg_hash, GetHandleId(LoadTrackableHandle(udg_hash, i+500, j)))
      set j = j - 1
    endloop
    call TriggerClearActions(LoadTriggerHandle(udg_hash, i, StringHash("tr-tg1")))
    call TriggerClearActions(LoadTriggerHandle(udg_hash, i, StringHash("tr-tg2")))
    //call DestroyTrigger(LoadTriggerHandle(udg_hash, i, StringHash("tr-tg1")))
    //call DestroyTrigger(LoadTriggerHandle(udg_hash, i, StringHash("tr-tg2")))
    call FlushChildHashtable(udg_hash, i)
  endif
endfunction
//FMi 끝

function GetCash takes player p returns gamecache
  if ( udg_Cash[GetPlayerId(p)+1] == null ) then
    set udg_Cash[GetPlayerId(p)+1] = InitGameCache("Cash.w3v")
  endif
  return udg_Cash[GetPlayerId(p)+1]
endfunction
function SetCameraXY takes player p, real x, real y returns nothing
  if ( GetLocalPlayer() == p ) then
    call PanCameraToTimed(x, y, 0.)
  endif
endfunction

function Bufftt takes texttag t, integer i returns nothing
//speed1: 0.0005546875
  if ( i == 1 ) then
  //30
    call SetTextTagVelocity(t, 0., .0166)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 2.)
    call SetTextTagFadepoint(t, 1.)
  elseif ( i == -1 ) then
    call SetTextTagVelocity(t, 0., -.0166)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 2.)
    call SetTextTagFadepoint(t, 1.)
  elseif ( i == 2 ) then
  //80
    call SetTextTagVelocity(t, 0., .045)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 2.4)
    call SetTextTagFadepoint(t, .4)
  elseif ( i == 3 ) then
  //15
    call SetTextTagVelocity(t, 0., .0083)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, .4)
    call SetTextTagFadepoint(t, 1.2)
  elseif ( i == 4 ) then
  //160
    call SetTextTagVelocity(t, 0., .088)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 1.4)
    call SetTextTagFadepoint(t, .4)
  elseif ( i == 5 ) then
  //180
    call SetTextTagVelocity(t, 0., .1)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 1.5)
    call SetTextTagFadepoint(t, .5)
  elseif ( i == 6 ) then
  //85
    call SetTextTagVelocity(t, 0., .047)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 2.1)
    call SetTextTagFadepoint(t, .6)
  elseif ( i == 7 ) then
  //90
    call SetTextTagVelocity(t, 0., .05)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 3.)
    call SetTextTagFadepoint(t, 2.)
  elseif ( i == 8 ) then
  //90
    call SetTextTagVelocity(t, 0., .05)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 1.)
    call SetTextTagFadepoint(t, .3)
  elseif ( i == 9 ) then
  //-160
    call SetTextTagVelocity(t, 0., -.088)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 1.)
    call SetTextTagFadepoint(t, 2.)
  elseif ( i == 10 ) then
  //50, MISS
    call SetTextTagVelocity(t, 0., .028)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 1.2)
    call SetTextTagFadepoint(t, .8)
  elseif ( i == 11 ) then
  //80 힐
    call SetTextTagVelocity(t, 0., .045)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 1.4)
    call SetTextTagFadepoint(t, .4)
  elseif ( i == 12 ) then
  //백어택, 각도80
    call SetTextTagVelocityBJ(t, 80., 80.)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 1.8)
    call SetTextTagFadepoint(t, .8)
  elseif ( i == 13 ) then
  //드래곤모드 스플래쉬, 30속도 80각도  
	call SetTextTagVelocityBJ(t, 30., 80.)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 1.8)
    call SetTextTagFadepoint(t, .8)
  elseif ( i == 14 ) then
  //코마 남은 시간
    call SetTextTagVelocityBJ(t, 120., 85.)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 3.)
    call SetTextTagFadepoint(t, 1.)
  elseif ( i == 15 ) then
  //사슴 죽었을때
	call SetTextTagVelocity(t, 0., .166)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 3.)
    call SetTextTagFadepoint(t, 2.)
  elseif ( i == 16 ) then
  //해안가
    call SetTextTagVelocity(t, 0., .0166)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 3.)
    call SetTextTagFadepoint(t, 2.)
  elseif ( i == 17 ) then
  //유닛청소 Remove
    call SetTextTagVelocity(t, 0., .0166)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 1.4)
    call SetTextTagFadepoint(t, .4)
  elseif ( i == 18 ) then
  //네임드 드랍
    call SetTextTagVelocity(t, 0., 0.)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 3.)
    call SetTextTagFadepoint(t, 2.)
  elseif ( i == 19 ) then
  //Check 표시
    call SetTextTagVelocity(t, 0., 0.)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 7.)
    call SetTextTagFadepoint(t, 2.)
  else
    call SetTextTagVelocity(t, 0., 0.)
    call SetTextTagPermanent(t, false)
    call SetTextTagLifespan(t, 2.)
    call SetTextTagFadepoint(t, 1.)
  endif
endfunction
//call Bufftt(bj_lastCreatedTextTag,1)

//이펙트 대기 후 파괴
function ED2 takes nothing returns nothing
 local timer t = GetExpiredTimer()
  call DestroyEffect(LoadEffectHandle(udg_hash,GetHandleId(t),StringHash("source")))
  call FlushChildHashtable(udg_hash,GetHandleId(t))
  call DestroyTimer(t)
 set t = null
endfunction
function ED takes effect e, real time returns nothing
 local timer t = CreateTimer()
  if ( udg_SysA_EffectSimple ) then
    call DestroyTimer(t)
    call DestroyEffect(e)
  else
    call SaveEffectHandle(udg_hash,GetHandleId(t),StringHash("source"),e)
    call TimerStart(t,time,false,function ED2)
  endif
 set t = null
endfunction
//call ED(Effect,time)

//최고급 필터 설정 (개인)
function CinematicFilterGenericForPlayer takes player p, real duration, blendmode bmode, string tex, real red0, real green0, real blue0, real trans0, real red1, real green1, real blue1, real trans1 returns nothing
  if ( udg_SysA_EffectSimple ) then
    return
  endif
  call AbortCinematicFadeBJ()
  if ( GetLocalPlayer() == p ) then
    call SetCineFilterTexture(tex)
    call SetCineFilterBlendMode(bmode)
    call SetCineFilterTexMapFlags(TEXMAP_FLAG_NONE)
    call SetCineFilterStartUV(0, 0, 1, 1)
    call SetCineFilterEndUV(0, 0, 1, 1)
    call SetCineFilterStartColor(PercentToInt(red0, 255), PercentToInt(green0, 255), PercentTo255(blue0), PercentToInt(100-trans0,255))
    call SetCineFilterEndColor(PercentToInt(red1, 255), PercentToInt(green1, 255), PercentTo255(blue1), PercentToInt(100-trans1, 255))
    call SetCineFilterDuration(duration)
    call DisplayCineFilter(true)
  endif
endfunction
//call call CinematicFilterGenericForPlayer( GetOwningPlayer(GetTriggerUnit()), 8, BLEND_MODE_BLEND, "ReplaceableTextures\\CameraMasks\\White_mask.blp", 100, 100, 100, 0, 100, 100, 100, 100 )

globals
    constant integer ABILITY_STATE_COOLDOWN         = 1                             // +
	constant integer ABILITY_DATA_COST              = 104 // integer    ('amcs')    // +
	constant integer ABILITY_DATA_COOL              = 105 // real       ('acdn')    // +
endglobals
native EXGetUnitAbility takes unit u, integer abilcode returns ability
native EXGetAbilityState takes ability abil, integer state_type returns real
native EXGetAbilityDataReal takes ability abil, integer level, integer data_type returns real
native EXSetAbilityState takes ability abil, integer state_type, real value returns boolean

function CooltimeCombo takes unit u returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(u))+1
 local ability ab = EXGetUnitAbility(u, 'A00X')
  if ( EXGetAbilityState(ab, ABILITY_STATE_COOLDOWN) > 1. ) then
    call EXSetAbilityState(ab, ABILITY_STATE_COOLDOWN, EXGetAbilityState(ab, ABILITY_STATE_COOLDOWN)-EXGetAbilityDataReal(ab, GetUnitAbilityLevel(u, 'A00X'), ABILITY_DATA_COOL)*.15)
  endif
  set ab = EXGetUnitAbility(u, 'A00Y')
  if ( EXGetAbilityState(ab, ABILITY_STATE_COOLDOWN) > 1. ) then
    call EXSetAbilityState(ab, ABILITY_STATE_COOLDOWN, EXGetAbilityState(ab, ABILITY_STATE_COOLDOWN)-EXGetAbilityDataReal(ab, GetUnitAbilityLevel(u, 'A00Y'), ABILITY_DATA_COOL)*.15)
  endif
  set ab = EXGetUnitAbility(u, 'A01L')
  if ( EXGetAbilityState(ab, ABILITY_STATE_COOLDOWN) > 1. ) then
    call EXSetAbilityState(ab, ABILITY_STATE_COOLDOWN, EXGetAbilityState(ab, ABILITY_STATE_COOLDOWN)-EXGetAbilityDataReal(ab, GetUnitAbilityLevel(u, 'A01L'), ABILITY_DATA_COOL)*.15)
  endif
  set ab = EXGetUnitAbility(u, 'A035')
  if ( EXGetAbilityState(ab, ABILITY_STATE_COOLDOWN) > 1. ) then
    call EXSetAbilityState(ab, ABILITY_STATE_COOLDOWN, EXGetAbilityState(ab, ABILITY_STATE_COOLDOWN)-EXGetAbilityDataReal(ab, GetUnitAbilityLevel(u, 'A035'), ABILITY_DATA_COOL)*.15)
  endif
  set ab = EXGetUnitAbility(u, 'A035')
  if ( EXGetAbilityState(ab, ABILITY_STATE_COOLDOWN) > 1. ) then
    call EXSetAbilityState(ab, ABILITY_STATE_COOLDOWN, EXGetAbilityState(ab, ABILITY_STATE_COOLDOWN)-EXGetAbilityDataReal(ab, GetUnitAbilityLevel(u, 'A035'), ABILITY_DATA_COOL)*.15)
  endif
  set ab = EXGetUnitAbility(u, 'A02M')
  if ( EXGetAbilityState(ab, ABILITY_STATE_COOLDOWN) > 1. ) then
    call EXSetAbilityState(ab, ABILITY_STATE_COOLDOWN, EXGetAbilityState(ab, ABILITY_STATE_COOLDOWN)-EXGetAbilityDataReal(ab, GetUnitAbilityLevel(u, 'A02M'), ABILITY_DATA_COOL)*.15)
  endif
  set ab = EXGetUnitAbility(u, 'A037')
  if ( EXGetAbilityState(ab, ABILITY_STATE_COOLDOWN) > 1. ) then
    call EXSetAbilityState(ab, ABILITY_STATE_COOLDOWN, EXGetAbilityState(ab, ABILITY_STATE_COOLDOWN)-EXGetAbilityDataReal(ab, GetUnitAbilityLevel(u, 'A037'), ABILITY_DATA_COOL)*.15)
  endif
  set ab = EXGetUnitAbility(u, 'A04V')
  if ( EXGetAbilityState(ab, ABILITY_STATE_COOLDOWN) > 1. ) then
    call EXSetAbilityState(ab, ABILITY_STATE_COOLDOWN, EXGetAbilityState(ab, ABILITY_STATE_COOLDOWN)-EXGetAbilityDataReal(ab, GetUnitAbilityLevel(u, 'A037'), ABILITY_DATA_COOL)*.15)
  endif
  set ab = EXGetUnitAbility(u, 'A07V')
  if ( EXGetAbilityState(ab, ABILITY_STATE_COOLDOWN) > 1. ) then
    call EXSetAbilityState(ab, ABILITY_STATE_COOLDOWN, EXGetAbilityState(ab, ABILITY_STATE_COOLDOWN)-EXGetAbilityDataReal(ab, GetUnitAbilityLevel(u, 'A07V'), ABILITY_DATA_COOL)*.15)
  endif
  call CinematicFilterGenericForPlayer(GetOwningPlayer(u), .3, BLEND_MODE_BLEND, "ReplaceableTextures\\CameraMasks\\White_mask.blp", 100, 100, 0.00, 30.00, 0., 100., 0., 100)
  set ab = null
endfunction
//더미 명령
function Dummier takes player p, unit u, integer c, integer s, string order returns nothing
  if ( c == -1 ) then
    set c = 'e015'
  endif
  set bj_lastCreatedUnit = CreateUnit(p, c, GetWidgetX(u), GetWidgetY(u), bj_UNIT_FACING)
  call UnitAddAbility(bj_lastCreatedUnit, s)
  call IssueTargetOrder(bj_lastCreatedUnit, order, u)
  call RemoveUnit(bj_lastCreatedUnit)
endfunction
//call Dummier(Player(PLAYER_NEUTRAL_AGGRESSIVE),GetTriggerUnit(),-1,'A000',"invisibility")
//시간제 특수 액션
function TimerAction takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local integer i = LoadInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"))
  if ( i == 1 ) then
    call SetUnitInvulnerable(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), false)
  elseif ( i == 2 ) then
    call IssueImmediateOrder( LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), "stop" )
  elseif ( i == 3 ) then
    call PauseUnit(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), false)
  elseif ( i == 4 ) then
    call DisplayTimedTextToPlayer( GetOwningPlayer(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"))), 0.50, 0, 5.00, LoadStr(udg_hash, GetHandleId(t), StringHash("T.A.s")) )
  elseif ( i == 7 ) then
    call IssueImmediateOrderById(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), 852590)
  elseif ( i == 9 ) then
    set i = GetPlayerId(GetOwningPlayer(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"))))+1
    set udg_SysC_CriP[i] = udg_SysC_CriP[i] - (10. * udg_SysI_Xtical[i])
    set udg_SysC_CriX[i] = udg_SysC_CriX[i] - (.07 * udg_SysI_Xtical[i])
    
    call SetUS("ARMOR", udg_Unit[i], 15*udg_SysI_Xtical[i], false)
    call SetUS("MAC", udg_Unit[i], 15*udg_SysI_Xtical[i], false)
    
    if ( udg_SysI_Xtical[i] >= 7 ) then
      set udg_SysC_Dam[i] = udg_SysC_Dam[i] - 100
    endif
    set udg_SysI_Xtical[i] = 0
    call SetUnitVertexColor(udg_Unit[i], 255, 255, 255, 255)
  elseif ( i == 10 ) then
      set udg_temp_u = LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"))
      set i = LoadInteger(udg_hash, GetPlayerId(GetOwningPlayer(udg_temp_u))+1, StringHash("Wo.HP-i"))
      call SaveInteger(udg_hash, GetPlayerId(GetOwningPlayer(udg_temp_u))+1, StringHash("Wo.HP-i"), 0)
      call SetUS("Hp", udg_temp_u, -i, false)
      call Bufftt(CreateTextTagUnitBJ("Hp -", udg_temp_u, 60., 9., 100., 0., 0., 0),1)
  elseif ( i == 11 ) then
debug call BJDebugMsg("나르 정지해제 - " +GetUnitName(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"))))
    call SetUnitTimeScale(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), 1.)
    //call PauseUnit(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), false)
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), "overhead"))
    call UnitRemoveAbility(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), 'B00E')
  elseif ( i == 12 ) then
    //나르콜리 멈춤 해제
debug call BJDebugMsg("나르 정지 - " +GetUnitName(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"))))
    call Dummier(Player(PLAYER_NEUTRAL_PASSIVE),LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")),-1,'A0AD',"thunderbolt")
    call SetUnitTimeScale(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), 0.)
    //call PauseUnit(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), true)
  elseif ( i == 13 ) then
    //캐스팅 - 소모 마나 저장
    //debug call BJDebugMsg("FCS_마나 = " + R2SW(GetUnitState(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), UNIT_STATE_MANA),5,1) + "=" + R2S(LoadReal(udg_hash, GetHandleId(t), StringHash("T.A.mana"))))
    call SetUnitState(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), UNIT_STATE_MANA, LoadReal(udg_hash, GetHandleId(t), StringHash("T.A.mana")))
  elseif ( i == 14 ) then
  //코마 풀리고 2초 뒤 무적 해제, 버프 제거  
    call SetUnitInvulnerable(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), false)
	call UnitRemoveAbility(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), 'B00M')
  elseif ( i == 15 ) then
  //부활 메시지 표시
    call MSG(GetOwningPlayer(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"))), 2, 10., "|c004f4f4f죽었지만, 초심자의 행운으로 돈과 경험치를 잃지 않았습니다.")
    call SetUnitInvulnerable(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), false)
  elseif ( i == 16 ) then
  //부활 메시지 표시
    call MSG(GetOwningPlayer(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"))), 2, 10., "|c004f4f4f뮤레칸을 만나 대가를 치루고 다시 살아났습니다. (|c0054ab54Exp -" + I2S(LoadInteger(udg_hash, GetHandleId(t), StringHash("T.A.i2"))) + "(7％)|c004f4f4f, |c00d5d500Gold -" + I2S(LoadInteger(udg_hash, GetHandleId(t), StringHash("T.A.i3"))) + "G(5％)|c004f4f4f)")
    call SetUnitInvulnerable(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), false)
  elseif ( i == 17 ) then
  //팅김
    call OnlineGame(GetOwningPlayer(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"))), 10, "")
  elseif ( i == 18 ) then
  //주변에 몬스터 스킬 사용
    if ( isHero(bj_groupRandomCurrentPick) ) then
      call IssueTargetOrder(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), "purge", bj_groupRandomCurrentPick)
    endif
  elseif ( i == 19 ) then
  //유닛 보임
    call ShowUnit(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), true)
  elseif ( i == 20 ) then
  //도가 콤보시스템 - 8종류 중 랜덤옵션
    set i = LoadInteger(udg_hash, GetHandleId(t), StringHash("T.A.i2"))
    call SaveBoolean(udg_hash, GetPlayerId(GetOwningPlayer(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"))))+1, StringHash("C-ing"+I2S(i)), false)
    
    if ( i == 1 ) then
      set i = GetPlayerId(GetOwningPlayer(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"))))+1
      set udg_SysC_Dam[i] = udg_SysC_Dam[i] - 15
      set udg_SysC_AtkSpdAdd[i] = udg_SysC_AtkSpdAdd[i] - 3
      call SetAtkSpd(i)
    elseif ( i == 2 ) then
      set i = GetPlayerId(GetOwningPlayer(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"))))+1
      set udg_SysC_PotAdd[i] = udg_SysC_PotAdd[i]-15
    endif
  elseif ( i == 21 ) then
    call SetUnitAnimation(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), "stand")
  elseif ( i == 22 ) then
    set i = GetPlayerId(GetOwningPlayer(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"))))+1
    set udg_SysI_WoriorPeculiarity[i] = udg_SysI_WoriorPeculiarity[i]-1
    call SetUS("MAC", udg_Unit[i], 10, false)
    if ( udg_SysI_WoriorPeculiarity[i] <= 0 ) then
      call SetUS("ARMOR", udg_Unit[i], -30, false)
    else
      if ( udg_SysI_WoriorPeculiarity[i] == 1 ) then
        call StatAdd("m", i, -3)
        call StatAdd("t", i, -5)
        call SaveInteger(udg_hash, i, StringHash("Wo.HP-i3"), 0)
      elseif ( udg_SysI_WoriorPeculiarity[i] == 2 ) then
        call SetUS("Hp", udg_Unit[i], -LoadInteger(udg_hash, i, StringHash("Wo.HP-i3")), false)
      endif
      call TimerStart(t,10.,false,function TimerAction)
      return
    endif
  elseif ( i == 23 ) then
    call CooltimeCombo(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")))
  elseif ( i == 24 ) then
    call IssueImmediateOrder(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u")), "holdposition")
  elseif ( i == 25 ) then
  //고갈: 리젠 감소
    set i = LoadInteger(udg_hash, GetHandleId(t), StringHash("T.A.P"))
    set udg_SysC_Regen[i] = udg_SysC_Regen[i] + 50
    set udg_SysI_MinusRegen[i] = udg_SysI_MinusRegen[i] - 50
  endif
 set i = 0
 call FlushChildHashtable(udg_hash, GetHandleId(t))
 call DestroyTimer(t)
 set t = null
endfunction


constant function ISBOSS takes integer ut returns integer
  if ( ut == 'n02O' ) then
    return 1
  else
    return 0
  endif
  //  call SaveStr(udg_hash, 'n02O', StringHash("FAI-Set"), "138")
endfunction
function Stuck_Color takes unit u, integer lv returns nothing
//5검정, 4빨강, 3노랑, 2초록, 1(기본) 정도
  if ( ISBOSS(GetUnitTypeId(u)) > 0 ) then
    //보스만
    if ( lv >= 5 ) then
      call SetUnitVertexColor(u, 64, 64, 64, 255)
    elseif ( lv == 4 ) then
      call SetUnitVertexColor(u, 255, 64, 64, 255)
    elseif ( lv == 3 ) then
      call SetUnitVertexColor(u, 255, 255, 64, 255)
    elseif ( lv == 2 ) then
      call SetUnitVertexColor(u, 64, 64, 255, 255)
    elseif ( lv == 1 ) then
      call SetUnitVertexColor(u, 64, 255, 64, 255)
    else
      call SetUnitVertexColor(u, 255, 255, 255, 255)
    endif
  endif
endfunction
constant function BuffCode takes string s returns integer
  if ( s == "ALL" ) then
    return 12
  elseif ( s == "BELLA" ) then
    return 1
  elseif ( s == "ENA" ) or ( s == "SOSU" ) then
    return 2
  elseif ( s == "CURAL" ) then
    return 3
  elseif ( s == "EVA" ) or ( s == "EVA2" ) then
    return 4
  elseif ( s == "TWOHAND" ) then
    return 5
  /*elseif ( s == "DRAGON" ) then
    return 6*/
  elseif ( s == "COLLA" ) then
    return 7
  elseif ( s == "HORR" ) then
    return 8
  elseif ( s == "INVUL" ) then  
    return 9
  elseif ( s == "REFLE" ) then
    return 10
  elseif ( s == "SPEED" ) then
    return 11
  elseif ( s == "CONCEN" ) then
    return 12
  endif
  return 0
endfunction
function BuffTime takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local unit dummy = LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("B.T.d"))
  if ( UnitAlive(dummy) ) then
    call UnitModifySkillPoints(dummy, -1)
  else
    call FlushChildHashtable(udg_hash, GetHandleId(t))
    call DestroyTimer(t)
  endif
  set t = null
  set dummy = null
endfunction
//call UnitModifySkillPoints(bj_lastCreatedUnit, R2I(time-1.))
//set t = CreateTimer()
//call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("B.T.d"), bj_lastCreatedUnit)
//call TimerStart(t,1.,true,function BuffTime)
function BuffTimeSet takes integer v returns nothing
 loop
  exitwhen v <= 0
  call UnitModifySkillPoints(bj_lastCreatedUnit, 1)
  set v = v - 1
 endloop
endfunction
//call BuffTimeSet(999)
function BuffEffectON takes unit u, string s returns nothing
  set s = StringCase(s,true)
  if ( s == "BELLA" ) then
    set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(u), 'e002', GetWidgetX(u), GetWidgetY(u), bj_UNIT_FACING)
    call UnitApplyTimedLife(bj_lastCreatedUnit, 'BHwe', 2.)
    call UnitAddAbility(bj_lastCreatedUnit, 'A094')
    call IssueTargetOrder(bj_lastCreatedUnit, "rejuvination", u)
  elseif ( s == "ENA" ) then
    set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(u), 'e002', GetWidgetX(u), GetWidgetY(u), bj_UNIT_FACING)
    call UnitApplyTimedLife(bj_lastCreatedUnit, 'BHwe', 2.)
    call UnitAddAbility(bj_lastCreatedUnit, 'A095')
    call IssueTargetOrder(bj_lastCreatedUnit, "unholyfrenzy", u)
  elseif ( s == "SOSU" ) then
    set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(u), 'e002', GetWidgetX(u), GetWidgetY(u), bj_UNIT_FACING)
    call UnitApplyTimedLife(bj_lastCreatedUnit, 'BHwe', 2.)
    call UnitAddAbility(bj_lastCreatedUnit, 'A056')
    call IssueTargetOrder(bj_lastCreatedUnit, "unholyfrenzy", u)
  elseif ( s == "CURAL" ) then
    set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(u), 'e002', GetWidgetX(u), GetWidgetY(u), bj_UNIT_FACING)
    call UnitApplyTimedLife(bj_lastCreatedUnit, 'BHwe', 2.)
    call UnitAddAbility(bj_lastCreatedUnit, 'A04A')
    call IssueTargetOrder(bj_lastCreatedUnit, "bloodlust", u)
  elseif ( s == "HORR" ) then
    set bj_lastCreatedItem = CreateItem('schl', 0, 0)
    call UnitAddItem(u, bj_lastCreatedItem)
    call RemoveItem(bj_lastCreatedItem)
  elseif ( s == "COLLA" ) then
    set bj_lastCreatedItem = CreateItem('tmsc', 0, 0)
    call UnitAddItem(u, bj_lastCreatedItem)
    call RemoveItem(bj_lastCreatedItem)
  elseif ( s == "CONCEN" ) then
    set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(u), 'e015', GetWidgetX(u), GetWidgetY(u), bj_UNIT_FACING)
    call UnitApplyTimedLife(bj_lastCreatedUnit, 'BHwe', 2.)
    call UnitAddAbility(bj_lastCreatedUnit, 'A0AE')
    call IssueTargetOrder(bj_lastCreatedUnit, "mindrot", u)
  endif
endfunction
//call BuffEffectON(GetTriggerUnit(), "Bella")
function BuffEnd takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local unit dummy = LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("Buff-u"))
  local integer var = LoadInteger(udg_hash, GetHandleId(t), StringHash("Buff-v"))
  local integer i = LoadInteger(udg_hash, GetHandleId(t), StringHash("Buff-i"))
  local integer P = LoadInteger(udg_hash, GetHandleId(t), StringHash("Buff-P"))
  local unit u = udg_Unit[P]
  if ( not UnitAlive(u) ) then
    call SetWidgetLife(dummy, GetWidgetLife(dummy)+1.)
    call TimerStart(t,1.,false,function BuffEnd)
  else
    call RemoveUnit(dummy)
    if ( i == 1 ) then
      call UnitRemoveAbility(u, 'B006')
      set udg_SysC_Hits[P] = udg_SysC_Hits[P] - var
      call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Starfall\\StarfallTarget.mdl", u, "origin") )
    elseif ( i == 2 ) then
      call UnitRemoveAbility(u, 'B008')
      call UnitRemoveAbility(u, 'B00U')
      
      set udg_SysC_Dam[P] = udg_SysC_Dam[P] - var
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Blizzard\\BlizzardTarget.mdl", u, "origin"))
    elseif ( i == 3 ) then
      call UnitRemoveAbility(u, 'B00R')
      
      call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIso\\AIsoTarget.mdl", u, "origin") )
      set udg_SysC_Regen[P] = udg_SysC_Regen[P] - var
      call Bufftt(CreateTextTagUnitBJ( "재생 -" + I2S(var), u, 60., 8.5, 100., 0., 0., 0 ),1)
    elseif ( i == 4 ) then
      call UnitRemoveAbility(u, 'B00H')
      call SaveReal(udg_hash,GetHandleId(u), StringHash("Miss"), LoadReal(udg_hash, GetHandleId(u), StringHash("Miss"))-var)
      
      call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\CarrionSwarm\\CarrionSwarmDamage.mdl", u, "origin") )
      call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\CarrionSwarm\\CarrionSwarmDamage.mdl", u, "chest") )
      call Bufftt(CreateTextTagUnitBJ( "회피 -", u, 60., 8.5, 100., 0., 0., 0 ),1)
    elseif ( i == 5 ) then
      call UnitRemoveAbility(u, 'B00J')
      
      set udg_SysC_Dam[P] = udg_SysC_Dam[P] - var
      call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\CarrionSwarm\\CarrionSwarmDamage.mdl", u, "origin") )
      call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\CarrionSwarm\\CarrionSwarmDamage.mdl", u, "chest") )
      call Bufftt(CreateTextTagUnitBJ( "뎀 -", u, 90., 8.5, 100., 0., 0., 0 ),1)
    /*elseif ( i == 6 ) then
      call UnitRemoveAbility(u, 'B00K')
      
      set udg_SysC_Dam[P] = udg_SysC_Dam[P] - var
      call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Orc\\EtherealForm\\SpiritWalkerChange.mdl", u, "origin") )
      call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Orc\\EtherealForm\\SpiritWalkerChange.mdl", u, "chest") )
      call Bufftt(CreateTextTagUnitBJ("뎀 -", u, 60., 8.5, 100., 0., 0., 0 ),1)*/
    elseif ( i == 7 ) then
      call UnitRemoveAbility(u, 'B00F')
      call SetUS("Armor", u, -var, IsUnitType(u, UNIT_TYPE_HERO))
      call DestroyEffect( AddSpecialEffectTarget("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", u, "chest") )
      call DestroyEffect( AddSpecialEffectTarget("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", u, "head") )
      call Bufftt(CreateTextTagUnitBJ( "방어 -", u, 60., 8.5, 100., 0., 0., 0 ),1)
    elseif ( i == 8 ) then
      call UnitRemoveAbility(u, 'B00X')
      
      set udg_SysC_AC_R[P] = udg_SysC_AC_R[P] - ( I2R(var) / 100. )
      call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilSpecialArt.mdl", u, "chest") )
      call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilSpecialArt.mdl", u, "head") )
      call Bufftt(CreateTextTagUnitBJ( "받뎀 +" + I2S(var) + "％", u, 60., 8.5, 100., 0., 0., 0 ),1)
    elseif ( i == 9 ) then
      //call UnitRemoveAbility(u,'B00W')
      //call UnitRemoveAbility(u,'B00V')
      call UnitRemoveAbility(u,'B00Y')

      set udg_SysC_AC_R[P] = udg_SysC_AC_R[P] - ( I2R(var) / 100. )      
      call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Human\\Polymorph\\PolyMorphDoneGround.mdl", u, "head") )
      call Bufftt(CreateTextTagUnitBJ("약해짐", u, 60., 8.5, 100., 0., 0., 0 ),1)
    elseif ( i == 10 ) then
      call UnitRemoveAbility(u,'B00A')
      call UnitRemoveAbility(u,'B010')

      call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Devour\\DevourEffectArt.mdl", u, "head") )
      call Bufftt(CreateTextTagUnitBJ("반사 꺼짐", u, 60., 8.5, 100., 0., 0., 0 ),1)
    elseif ( i == 11 ) then
      call SaveInteger(udg_hash, P, 7, 0)
      call DisplayTimedTextToPlayer( GetOwningPlayer(u), 0.50, 0, 5.00, "   |c00D1D1D1이동속도가 |cff9932cc" + I2S(R2I(GetUnitMoveSpeed(u))) + "|c00ff0000-" + I2S( var * 10 ) + " |r|c00D1D1D1/ 522 되었습니다." )
      call SetUnitAbilityLevel(u, 'A02V', 1)
      call Bufftt(CreateTextTagUnitBJ("속도 -", u, 60., 8.5, 100., 0., 0., 0 ),1)
    endif
    call FlushChildHashtable(udg_hash, GetHandleId(t))
    call DestroyTimer(t)
  endif
  set t = null
  set dummy = null
  set u = null
endfunction
function BuffTimerAdd takes integer P, string BuffName, real time returns boolean
  set bj_lastStartedTimer = LoadTimerHandle(udg_hash,P,StringHash("Buff"+I2S(BuffCode(StringCase(BuffName,true)))))
  if ( TimerGetRemaining(bj_lastStartedTimer) > 0. ) then
  //call BJDebugMsg("now hp: " + R2SW(GetWidgetLife(bj_lastCreatedUnit),3,1) + "("+R2SW(TimerGetRemaining(bj_lastStartedTimer),2,1)+"/"+I2S(GetHeroSkillPoints(bj_lastCreatedUnit))+") + " + R2SW(time,2,1))
    call TimerStart(bj_lastStartedTimer,RMaxBJ(0.,TimerGetRemaining(bj_lastStartedTimer)+time),false,function BuffEnd)
    set bj_lastCreatedUnit = LoadUnitHandle(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("Buff-u"))
    call BuffTimeSet(R2I(time))
    call SetUnitState(bj_lastCreatedUnit, UNIT_STATE_MAX_LIFE, TimerGetRemaining(bj_lastStartedTimer)+time+.5)
    call SetWidgetLife(bj_lastCreatedUnit, TimerGetRemaining(bj_lastStartedTimer)+time+.5)
    return true
  else
    return false
  endif
endfunction
//if ( BuffTimerAdd(P, "Resque", 15.) ) then // 해당 버프 시간 15초 증가하거나 false를 반환
function BuffTimerEndN takes integer P, integer no returns nothing
  set bj_lastStartedTimer = LoadTimerHandle(udg_hash,P,StringHash("Buff"+I2S(no)))
  if ( TimerGetRemaining(bj_lastStartedTimer) > 0. ) then
    call TimerStart(bj_lastStartedTimer,0.,false,function BuffEnd)
    call SetWidgetLife(LoadUnitHandle(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("Buff-u")), .2)
  endif
endfunction
//call BuffTimerEndN(P, BuffCode(StringCase("Bella",true)))
function MakeValue takes string s, integer P returns real
 local integer i = 0
 local real v = -0.1
 local real v2 = 0
 local real v3 = 0
 local string S = ""
 local string S2 = ""
  loop
    set i = i + 1
    set S = FCut(s,i)
    exitwhen S == "" or S == null
    if ( i == 1 ) and ( v == -0.1 ) then
      set v = S2R(S)
    else
      set S2 = StringCase(SubString(S,0,2),true)
      if ( S2 == "00" ) then
      // 이전값만 상승
        set v = v - v3
        set v2 = S2R(SubString(S,3,StringLength(S)))
        set S = SubString(S,1,3)
      else
        set v2 = S2R(SubString(S,4,StringLength(S)))
        set S = SubString(S,2,4)
        set v3 = -0.1
        if ( S2 == "ST" ) then
          if ( SubString(S,0,1) == "=" ) then
            set v3 = udg_SysE_STR3[P]
          elseif ( SubString(S,0,1) == "-" ) then
            set v3 = udg_SysE_STR1[P]
          elseif ( SubString(S,0,1) == "+" ) then
            set v3 = udg_SysE_STR2[P]
          endif
        elseif ( S2 == "DE" ) then
          if ( SubString(S,0,1) == "=" ) then
            set v3 = udg_SysE_DEX3[P]
          elseif ( SubString(S,0,1) == "-" ) then
            set v3 = udg_SysE_DEX1[P]
          elseif ( SubString(S,0,1) == "+" ) then
            set v3 = udg_SysE_DEX2[P]
          endif
        elseif ( S2 == "IN" ) then
          if ( SubString(S,0,1) == "=" ) then
            set v3 = udg_SysE_INT3[P]
          elseif ( SubString(S,0,1) == "-" ) then
            set v3 = udg_SysE_INT1[P]
          elseif ( SubString(S,0,1) == "+" ) then
            set v3 = udg_SysE_INT2[P]
          endif
        elseif ( S2 == "WI" ) then
          if ( SubString(S,0,1) == "=" ) then
            set v3 = udg_SysE_WIS3[P]
          elseif ( SubString(S,0,1) == "-" ) then
            set v3 = udg_SysE_WIS1[P]
          elseif ( SubString(S,0,1) == "+" ) then
            set v3 = udg_SysE_WIS2[P]
          endif
        elseif ( S2 == "CO" ) then
          if ( SubString(S,0,1) == "=" ) then
            set v3 = udg_SysE_CON3[P]
          elseif ( SubString(S,0,1) == "-" ) then
            set v3 = udg_SysE_CON1[P]
          elseif ( SubString(S,0,1) == "+" ) then
            set v3 = udg_SysE_CON2[P]
          endif
        elseif ( S2 == "LV" ) then
          if ( SubString(S,0,1) == "-" ) then
            set v3 = GetHeroLevel(udg_Unit[P])
          elseif ( SubString(S,0,1) == "+" ) then
            set v3 = udg_SysB_Level[P]
          endif
        elseif ( S2 == "SE" ) then
          set v3 = v
        elseif ( S2 == "HP" ) then
          if ( SubString(S,0,1) == "-" ) then
            set v3 = GetWidgetLife(udg_Unit[P])
          elseif ( SubString(S,0,1) == "+" ) then
            set v3 = GetUnitState(udg_Unit[P], UNIT_STATE_MAX_LIFE)
          elseif ( SubString(S,0,1) == "_" ) then
            set v3 = GetUnitState(udg_Unit[P], UNIT_STATE_MAX_LIFE)-GetWidgetLife(udg_Unit[P])
          endif
        elseif ( S2 == "MP" ) then
          if ( SubString(S,0,1) == "-" ) then
            set v3 = GetUnitState(udg_Unit[P], UNIT_STATE_MANA)
          elseif ( SubString(S,0,1) == "+" ) then
            set v3 = GetUnitState(udg_Unit[P], UNIT_STATE_MAX_MANA)
          endif
        elseif ( S2 == "HE" ) then
		  set v3 = -0.2
          if ( SubString(S,0,1) == "-" ) then
		  //단일 대상
            set v = v * (1.+(udg_SysC_HealAdd[P]/100.))
          elseif ( SubString(S,0,1) == "+" ) then
		  //다중 대상 - 감소 67만 적용
		    set v = v * (1.+(udg_SysC_HealAdd[P]/150.))
          endif
        elseif ( S2 == "PO" ) then
		  set v3 = -0.2
          if ( SubString(S,0,1) == "-" ) then
		  //단일 대상
            set v = v * (1.+(udg_SysC_PotAdd[P]/100.))
          elseif ( SubString(S,0,1) == "+" ) then
		  //다중 대상 - 감소 33만 적용
		    set v = v * (1.+(udg_SysC_PotAdd[P]/300.))
          endif
		else
          call MSG(Player(P-1), -1, 8, "M.V / " + S2 )
        endif
      endif
	  if ( v3 != -0.2 ) then
        if ( v3 != -0.1 ) then
          if ( SubString(S,1,2) == "+" ) then
            set v3 = v3 + v2
          elseif ( SubString(S,1,2) == "-" ) then
            set v3 = v3 - v2
          elseif ( SubString(S,1,2) == "/" ) then
            set v3 = v3 / v2
          elseif ( SubString(S,1,2) == "*" ) then
            set v3 = v3 * v2
          elseif ( SubString(S,1,2) == "^" ) then
            set v3 = Pow(v3,v2)
          else
            call MSG(Player(P-1), -1, 8, "M.V#2 / " + S )
            set v3 = 0
          endif
          if ( S2 == "SE" ) then
            set v = v3
          else
            set v = v + v3
          endif
        else
          call MSG(Player(P-1), -1, 8, "M.V#3 / " + S2 + " / " + S )
        endif
	  endif
    endif
  endloop
 set i = 0
 set v2 = 0
 set v3 = 0
 set S = null
 set S2 = null
  if ( v == -0.1 ) then
    set v = 0
  elseif ( v < 1 ) then
    set v = 500
  endif
  return v
endfunction
//MakeValue(기본값|더할값), 더할값=ST/DE/IN/WI/CO/LV/SE(값 고정)/HP/MP/HE(힐)/PO(팟)     =(템 등 포함) -(순수치) +(템값만)
//더할값: 3개로 구분: 앞2: 해당 능력치 / 3: 순수or템 등 구분 / 4 수식(+-/＊^) / 5~곱할 값 등
function Condi_EnemyNear takes nothing returns boolean
 return ( UnitAlive(GetFilterUnit()) ) and ( IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(udg_temp_u)) ) and ( not IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) )
endfunction
function GetGroupEnemy takes group g, unit t, real radius, boolexpr filter returns group
 call GroupEnumUnitsInRange(g, GetWidgetX(t), GetWidgetY(t), radius, filter)
 //call DestroyBoolExpr(filter)
 return g
endfunction
constant function PHASEHP takes real nowhp, real dmg, real afterhp returns boolean
  return ( nowhp >= afterhp ) and ( nowhp-dmg <= afterhp )
endfunction

constant function CurseValue takes integer lev, boolean normal returns integer
  if ( normal ) then
  //물리
    if ( lev == 1 ) then
      return 20
    elseif ( lev == 2 ) then
      return 35
    elseif ( lev == 3 ) then
      return 50
    elseif ( lev == 4 ) then
      return 65
    elseif ( lev == 5 ) then
      return 70
    endif
  else
  //마법
    if ( lev == 1 ) then
      return 10
    elseif ( lev == 2 ) then
      return 20
    elseif ( lev == 3 ) then
      return 30
    elseif ( lev == 4 ) then
      return 40
    elseif ( lev == 5 ) then
      return 50
    endif
  endif
 return 0
endfunction
constant function FMi_Inven takes integer i1, integer i2 returns integer
  if ( i1 == 0 ) then
  //메인 인벤토리
    if ( i2 == 0 ) then
    //취소, 돌아가기
      return 'afac'
    elseif ( i2 == 1 ) then
    //첫번째 (핫키 7번) 아이템
      return 'ratc'
    elseif ( i2 == 2 ) then
      return 'rat6'
    elseif ( i2 == 3 ) then
      return 'odef'
    elseif ( i2 == 4 ) then
      return 'rag1'
    elseif ( i2 == 5 ) then
      return 'I08V'
    endif
  elseif ( i1 == 7 ) then
  //1번 인벤토리(핫키 7) - 퀘스트 관련
    if ( i2 == 0 ) then
      return 4
    elseif ( i2 == 1 ) then
      return 'rlif'
    elseif ( i2 == 2 ) then
      return 'ciri'
    elseif ( i2 == 3 ) then
      return 'cnob'
    elseif ( i2 == 4 ) then
      return 'rhth'
    elseif ( i2 == 42 ) then
    //퀘속도 : 빠름
      return 'hcun'
    elseif ( i2 == 43 ) then
    //퀘속도 : 느림
      return 'belv'
    endif
  elseif ( i1 == 8 ) then
  //2번 인벤토리(핫키 8) - 이동 관련
    if ( i2 == 0 ) then
      return 5
    elseif ( i2 == 1 ) then
      return 'prvt'
    elseif ( i2 == 2 ) then
      return 'hval'
    elseif ( i2 == 3 ) then
      return 'spsh'
    elseif ( i2 == 4 ) then
      return 'mort'
    elseif ( i2 == 5 ) then
      return 'pmna'
    endif
  elseif ( i1 == 4 ) then
  //3번 인벤토리(핫키 4) - 파티 관련
    if ( i2 == 0 ) then
      return 5
    elseif ( i2 == 1 ) then
      return 'mcou'
    elseif ( i2 == 2 ) then
      return 'ward'
    elseif ( i2 == 3 ) then
      return 'penr' 
    elseif ( i2 == 4 ) then
      return 'rst1'
    elseif ( i2 == 5 ) then
      return 'rat9'
    elseif ( i2 == 52 ) then
      return 'crys'
    elseif ( i2 == 53 ) then
      return 'brac'
    endif
  elseif ( i1 == 5 ) then
  //4번 인벤토리(핫키 5) - 도움말 관련
    if ( i2 == 0 ) then
      return 5
    elseif ( i2 == 1 ) then
      return 'I09V'
    elseif ( i2 == 2 ) then
      return 'lhst'
    elseif ( i2 == 3 ) then
      return 'ajen'
    elseif ( i2 == 4 ) then
      return 'bgst'
    elseif ( i2 == 5 ) then
      return 'evtl'
    endif
  endif
  return 0
endfunction
function PushCancle takes unit u returns nothing
  set udg_SysA_Item = true
  call RemoveItem(UnitItemInSlot(u, 0))
  call RemoveItem(UnitItemInSlot(u, 1))
  call RemoveItem(UnitItemInSlot(u, 2))
  call RemoveItem(UnitItemInSlot(u, 3))
  call RemoveItem(UnitItemInSlot(u, 4))
  call RemoveItem(UnitItemInSlot(u, 5))
  call UnitAddItem(u, CreateItem(FMi_Inven(0,1), GetWidgetX(u), GetWidgetY(u)))
  call UnitAddItem(u, CreateItem(FMi_Inven(0,2), GetWidgetX(u), GetWidgetY(u)))
  call UnitAddItem(u, CreateItem(FMi_Inven(0,3), GetWidgetX(u), GetWidgetY(u)))
  call UnitAddItem(u, CreateItem(FMi_Inven(0,4), GetWidgetX(u), GetWidgetY(u)))
  if ( CountItem(GetPlayerId(GetOwningPlayer(u))+1, FMi_Inven(0,5)) > 0 ) then
    call UnitAddItem(u, CreateItem(FMi_Inven(0,5), 0, 0))
    call SetItemCharges(UnitItemInSlot(u, 4), CountItem(GetPlayerId(GetOwningPlayer(u))+1, FMi_Inven(0,5)))
  endif
  set udg_SysA_Item = false
endfunction

//파워 유동텍스트
function Ptext2 takes nothing returns nothing
  local timer t = GetExpiredTimer()
  call SaveReal(udg_hash,GetHandleId(t),StringHash("f-3r1"),LoadReal(udg_hash,GetHandleId(t),StringHash("f-3r1"))-LoadReal(udg_hash,GetHandleId(t),StringHash("f-3r3")))
  call SetTextTagTextBJ( LoadTextTagHandle(udg_hash,GetHandleId(t),StringHash("f-1s")), LoadStr(udg_hash, GetHandleId(t), StringHash("f-2s")), LoadReal(udg_hash,GetHandleId(t),StringHash("f-3r1")) )
  if ( LoadReal(udg_hash,GetHandleId(t),StringHash("f-3r1")) <= LoadReal(udg_hash,GetHandleId(t),StringHash("f-3r2")) ) then
    call SaveTextTagHandle(udg_hash,GetHandleId(t),StringHash("f-1s"),null)
    call FlushChildHashtable(udg_hash,GetHandleId(t))
    call DestroyTimer(t)
  else
    call TimerStart(t,LoadReal(udg_hash,GetHandleId(t),StringHash("f-4l")),false,function Ptext2)
  endif
  set t = null
endfunction
function Ptext takes texttag s, string var, real size1, real size2, real size3, real l returns nothing
local timer t = CreateTimer()
  call SaveTextTagHandle( udg_hash, GetHandleId(t), StringHash("f-1s"), s)
  call SaveStr( udg_hash, GetHandleId(t), StringHash("f-2s"), var )
  call SaveReal( udg_hash, GetHandleId(t), StringHash("f-3r1"), size1 )
  call SaveReal( udg_hash, GetHandleId(t), StringHash("f-3r2"), size2 )
  call SaveReal( udg_hash, GetHandleId(t), StringHash("f-3r3"), size3 )
  call SaveReal( udg_hash, GetHandleId(t), StringHash("f-4l"), l )
  call TimerStart(t,l,false,function Ptext2)
set t = null
endfunction
//call Ptext(GetLastCreatedTextTag(),I2S(R2I(GetEventDamage())),48,12,9,0.05)

function SetHoldCam takes player p, rect r returns nothing
  if (GetLocalPlayer() == p) then
	call SetCameraBounds(GetRectMinX(r),GetRectMinY(r),GetRectMinX(r),GetRectMaxY(r),GetRectMaxX(r),GetRectMaxY(r),GetRectMaxX(r),GetRectMinY(r))
  endif
endfunction
function Reviving takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local integer P = LoadInteger(udg_hash, GetHandleId(t), StringHash("Rev-P"))
  call ReviveHero(udg_Unit[P], GetLocationX(udg_SysA_Revive[P]), GetLocationY(udg_SysA_Revive[P]), true)
  call SetCameraXY(Player(P-1), GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]))
  /* call SetHoldCam(Player(P-1), gg_rct_Villeage_15) /* 여관 카메라 */ */
  
  call SelectUnitForPlayerSingle(udg_Unit[P], Player(P-1))
  
	set udg_temp_i = GetHeroLevel(udg_Unit[P])
	set udg_temp_u2 = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'H000', 0, 0, bj_UNIT_FACING)
	call SetHeroLevel(udg_temp_u2, udg_temp_i, false)
    set udg_temp_i2 = GetHeroXP(udg_temp_u2)
	call SetHeroLevel(udg_temp_u2, udg_temp_i+1, false)
	set udg_temp_i = IMinBJ(GetHeroXP(udg_Unit[P]) - udg_temp_i2, R2I((GetHeroXP(udg_temp_u2)-udg_temp_i2)*.07))
	call RemoveUnit(udg_temp_u2)
    call AddHeroXP(udg_Unit[P], -udg_temp_i, false)
    set udg_temp_i2 = GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD)/20
	call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD)-udg_temp_i2)
    
    call DestroyTimer(t)
    call FlushChildHashtable(udg_hash, GetHandleId(t))
      
    //r초 뒤 메시지 표시
    set bj_lastStartedTimer = CreateTimer()
    call SaveUnitHandle(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("T.A.u"), udg_Unit[P])
    call SaveInteger(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("T.A.i"), 16)
    call SaveInteger(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("T.A.i2"), udg_temp_i)
    call SaveInteger(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("T.A.i3"), udg_temp_i2)
    call TimerStart(bj_lastStartedTimer,2.,false,function TimerAction)

  call PushCancle(udg_Unit[P])
  
 set bj_lastCreatedTimerDialog = LoadTimerDialogHandle(udg_hash, P, StringHash("Rev-TimerD"))
 call TimerDialogDisplay(bj_lastCreatedTimerDialog, false)
 call DestroyTimerDialog(bj_lastCreatedTimerDialog)
 call FlushChildHashtable(udg_hash, GetHandleId(t))
 call DestroyTimer(t)
 set t = null  
endfunction
function Revive takes unit u returns nothing
 local integer P = 0
  if ( isHero(u) ) then
    set P = GetPlayerId(GetOwningPlayer(u))+1
    call MSGAll(0, true, 2, 1, 10., SysStr(2,P)+GetUnitName(u)+"|cffffdc3c가 뮤레칸을 만나러 갔습니다. '|cffed89d9"+I2S(1+R2I(udg_SysB_Level[P]*.1))+"|cffffdc3c'초 후 부활합니다.")
	call KillUnit(u)
	set bj_lastStartedTimer = CreateTimer()
	call SaveTimerHandle(udg_hash, P, StringHash("Rev-Timer"), bj_lastStartedTimer)
	call SaveInteger(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("Rev-P"), P)
	call TimerStart(bj_lastStartedTimer, 1.+udg_SysB_Level[P]*.1, false, function Reviving)
    set bj_lastCreatedTimerDialog = CreateTimerDialog(bj_lastStartedTimer)
    call TimerDialogSetTitle(bj_lastCreatedTimerDialog, "Lv. " + I2S(udg_SysB_Level[P]) + ", 『" + GetUnitName(u) + "』")
    call TimerDialogDisplay(bj_lastCreatedTimerDialog, true)
	call SaveTimerDialogHandle(udg_hash, P, StringHash("Rev-TimerD"), bj_lastCreatedTimerDialog)
  endif
endfunction
function Comaring takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local unit u = LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("Coma-u"))
 local real r = LoadReal(udg_hash, GetHandleId(t), StringHash("Coma-time"))
  if ( GetUnitAbilityLevel(u, 'B00M') > 0 ) then
    if ( r > 0. ) then
	  call SetUnitVertexColor(u, GetRandomInt(0,255), GetRandomInt(0,255), GetRandomInt(0,255), 255)
	  call SetWidgetLife(u, 1.)
	  call PauseUnit(u, true)
	  call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)-LoadReal(udg_hash, GetHandleId(t), StringHash("Coma-dmg")))
	  call Bufftt(CreateTextTagUnitBJ(I2S(R2I(r)), u, -30., 11., 0., 0., 100., 0), 14)

      call SaveReal(udg_hash, GetHandleId(t), StringHash("Coma-time"), r-1.)
	  call TimerStart(t, TimerGetTimeout(t), false, function Comaring)
    else
      call SetUnitInvulnerable(u, false)
      call Revive(u)
	  call SetUnitVertexColor(u, 255, 255, 255, 255)
	endif
  else
 //코마 깸
    if ( UnitAlive(u) ) then
	  call SetUnitVertexColor(u, 255, 255, 255, 255)
	  call PauseUnit(u, false)
	  call MSG(GetOwningPlayer(u), 1, 5., "코마 상태가 회복되었습니다.")
	  call SetWidgetLife(u, GetUnitState(u, UNIT_STATE_MAX_LIFE)*GetRandomReal(.05,.3))
      call Bufftt(CreateTextTagUnitBJ("Hp +" + I2S(R2I(GetWidgetLife(u))), u, 30., 11., 100., 0., 0., 0), 1)
	  call SelectUnitForPlayerSingle(u, GetOwningPlayer(u))
	  
      //2초 후 무적 해제
      set bj_lastStartedTimer = CreateTimer()
      call SaveUnitHandle(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("T.A.u"), u)
      call SaveInteger(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("T.A.i"), 14)
      call TimerStart(bj_lastStartedTimer,2.,false,function TimerAction)
	endif
  endif
  if ( TimerGetRemaining(t) == 0. ) then
    call FlushChildHashtable(udg_hash, GetHandleId(t))
    call DestroyTimer(t)
  endif
 set t = null
 set u = null 
endfunction
function Coma takes unit u, real dur, real x returns nothing
//Coma 사용 기준 - 영웅이 현재체력 이상 데미지 입었을 때.
 local timer t = CreateTimer()
  if ( udg_PartyNumber_pP[udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(u))+1]] > 1 ) then
    //살리는건 여기서 처리 안 함.
    call SetWidgetLife(u, 1.)
    set bj_lastCreatedUnit = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'e00B', GetUnitX(u), GetUnitY(u), bj_UNIT_FACING)
	call UnitApplyTimedLife(bj_lastCreatedUnit, 'BTLF', 1.)
    //call SetUnitState(u, UNIT_STATE_LIFE, 999999)
    call IssueTargetOrder(bj_lastCreatedUnit, "soulburn", u)
    /*if ( udg_Quest_29_Num_Note[GetPlayerId(GetOwningPlayer(u))+1] == 25 ) then
      set udg_Quest_29_Num_Note[GetPlayerId(GetOwningPlayer(u))+1] = 26
    endif*/
	call IssueImmediateOrder(u, "stop")
    call MSG(GetOwningPlayer(u), 2, 10., "|c00ff0000코마상태에 빠졌습니다 !!|c00ff8000\n\n"+R2SW(dur/x,2,1)+"초가 지나 마나가 0이되면 사망합니다.")
	call SetUnitInvulnerable(u, true)
	call PauseUnit(u, true)
	call SaveReal(udg_hash, GetHandleId(t), StringHash("Coma-time"), dur)
	call SaveReal(udg_hash, GetHandleId(t), StringHash("Coma-dmg"), GetUnitState(u, UNIT_STATE_MANA)/dur/x)
	call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("Coma-u"), u)
    
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, u, -30)
    call Ptext(bj_lastCreatedTextTag,"|cff0078ffCOMA !!",40,12,4,.03125)
    call SetTextTagPermanent(bj_lastCreatedTextTag, false)
    call SetTextTagLifespan(bj_lastCreatedTextTag, 2.)
    call SetTextTagFadepoint(bj_lastCreatedTextTag, 1.)
    
    call AttachSoundToUnit(gg_snd_HeartBeat, u)
    call StartSound(gg_snd_HeartBeat)
    
	call TimerStart(t, 1./x, false, function Comaring)
  else
  //파티원 없으면 바로 사망 처리
	call Revive(u)
  endif
 set u = null
 set t = null
endfunction
//call Coma(GetTriggerUnit(), 15, 2.) - 2배속
function SetBuff takes unit u, string tp, real time, integer var returns nothing
 local timer t = CreateTimer()
 local integer P = GetPlayerId(GetOwningPlayer(u))+1
 local integer i = BuffCode(StringCase(tp,true))
  set tp = StringCase(tp,true)
  if ( 1 <= i ) and ( i <= BuffCode("ALL") ) then
    if ( TimerGetRemaining(LoadTimerHandle(udg_hash,P,StringHash("Buff"+I2S(i)))) <= .0 ) then
      call BuffEffectON(u, tp)
      if ( tp == "BELLA" ) then
        set udg_SysC_Hits[P] = udg_SysC_Hits[P] + var
        set bj_lastCreatedUnit = CreateUnit(Player(P-1), 'O002', -20256, 16128, bj_UNIT_FACING)
      elseif ( tp == "ENA" ) then
        set udg_SysC_Dam[P] = udg_SysC_Dam[P] + var
        call Bufftt(CreateTextTagUnitBJ("Dmg +" + I2S(var), u, 90., 9.5, 0., 100., 100., 0 ),1)
        set bj_lastCreatedUnit = CreateUnit(Player(P-1), 'O003', -20256, 16128, bj_UNIT_FACING)
      elseif ( tp == "SOSU" ) then
        call DestroyEffect( AddSpecialEffectTarget("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl", u, "origin") )
        call ED( AddSpecialEffectTarget("Abilities\\Spells\\Items\\VampiricPotion\\VampPotionCaster.mdl", u, "origin"), 1. )
        set udg_SysC_Dam[P] = udg_SysC_Dam[P] + var
        call Bufftt(CreateTextTagUnitBJ("Dmg +" + I2S(var), u, 90., 9.5, 0., 100., 100., 0 ),1)
        set bj_lastCreatedUnit = CreateUnit(Player(P-1), 'O009', -20256, 16128, bj_UNIT_FACING)
      elseif ( tp == "CURAL" ) then
        set udg_SysC_Regen[P] = udg_SysC_Regen[P] + var
        set bj_lastCreatedUnit = CreateUnit(Player(P-1), 'e002', GetWidgetX(u), GetWidgetY(u), bj_UNIT_FACING )
        call IssueTargetOrder( bj_lastCreatedUnit, "bloodlust", u )
        call UnitApplyTimedLife( bj_lastCreatedUnit, 'BHwe', 2. )
        call Bufftt(CreateTextTagUnitBJ("Regen +" + I2S(var), u, 60., 9.5, 0., 100., 0., 0 ),1)
        set bj_lastCreatedUnit = CreateUnit(Player(P-1), 'O004', -20256, 16128, bj_UNIT_FACING)
      elseif ( tp == "EVA" ) then
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathPact\\DeathPactTarget.mdl", u, "origin"))
        call SaveReal(udg_hash,GetHandleId(u), StringHash("Miss"), LoadReal(udg_hash, GetHandleId(u), StringHash("Miss"))+var)
        call Bufftt(CreateTextTagUnitBJ("Evasion +" + I2S(var), u, 60., 9.5, 0., 100., 100., 0 ),1)
        set bj_lastCreatedUnit = CreateUnit(Player(P-1), 'O005', -20256, 16128, bj_UNIT_FACING)
      elseif ( tp == "EVA2" ) then
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathPact\\DeathPactTarget.mdl", u, "origin"))
        call SaveReal(udg_hash,GetHandleId(u), StringHash("Miss"), LoadReal(udg_hash, GetHandleId(u), StringHash("Miss"))+var)
        call Bufftt(CreateTextTagUnitBJ("Evasion +" + I2S(var), u, 60., 9.5, 0., 100., 100., 0 ),1)
        set bj_lastCreatedUnit = CreateUnit(Player(P-1), 'O005', -20256, 16128, bj_UNIT_FACING)
      elseif ( tp == "TWOHAND" ) then
        call DestroyEffect( AddSpecialEffectTarget("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl", u, "origin") )
        set udg_SysC_Dam[P] = udg_SysC_Dam[P] + var
        call Bufftt(CreateTextTagUnitBJ("Dmg +" + I2S(var), u, 90., 9.5, 0., 100., 100., 0 ),1)
        set bj_lastCreatedUnit = CreateUnit(Player(P-1), 'O006', -20256, 16128, bj_UNIT_FACING)
      elseif ( tp == "COLLA" ) then
        call SetUS("Armor", u, var, IsUnitType(u, UNIT_TYPE_HERO))
        call Bufftt(CreateTextTagUnitBJ("Armor +" + I2S(var), u, 60., 9.5, 0., 100., 100., 0), 1)
        set bj_lastCreatedUnit = CreateUnit(Player(P-1), 'O008', -20256, 16128, bj_UNIT_FACING)
      elseif ( tp == "HORR" ) then
        set udg_SysC_AC_R[P] = udg_SysC_AC_R[P] + ( I2R(var) / 100. )
        call Bufftt(CreateTextTagUnitBJ("TakeDmg -" + I2S(var) + "％", u, 60., 9.5, 0., 100., 100., 0 ),1)
        set bj_lastCreatedUnit = CreateUnit(Player(P-1), 'O00A', -20256, 16128, bj_UNIT_FACING)
      elseif ( tp == "INVUL" ) then
        set udg_SysC_AC_R[P] = udg_SysC_AC_R[P] + ( I2R(var) / 100. )
        call ED( AddSpecialEffectTarget("Abilities\\Spells\\Items\\VampiricPotion\\VampPotionCaster.mdl", u, "origin"), 1. )
        call ED( AddSpecialEffectTarget("Abilities\\Spells\\Other\\Drain\\ManaDrainTarget.mdl", u, "origin"), 1. )
        call ED( AddSpecialEffectTarget("Abilities\\Spells\\Other\\Doom\\DoomTarget.mdl", u, "origin"), 1. )
        set bj_lastCreatedUnit = CreateUnit(Player(P-1), 'e000', GetWidgetX(u), GetWidgetY(u), bj_UNIT_FACING)
        //call SetUnitAbilityLevel(bj_lastCreatedUnit, 'A01R', 3)
        call IssueTargetOrder( bj_lastCreatedUnit, "faeriefire", u )
        call UnitApplyTimedLife( bj_lastCreatedUnit, 'BHwe', 2. )
        call Bufftt(CreateTextTagUnitBJ("무적", u, 90., 9.5, 0., 100., 100., 0 ),1)
        set bj_lastCreatedUnit = CreateUnit(Player(P-1), 'O00D', -20256, 16128, bj_UNIT_FACING)
      elseif ( tp == "REFLE" ) then
        call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathPact\\DeathPactCaster.mdl", u, "origin") )
        set bj_lastCreatedUnit = CreateUnit(Player(P-1), 'e000', GetWidgetX(u), GetWidgetY(u), bj_UNIT_FACING)
        call SetUnitAbilityLevel(bj_lastCreatedUnit, 'A057', var)
        call IssueTargetOrder( bj_lastCreatedUnit, "innerfire", u)
        call UnitApplyTimedLife( bj_lastCreatedUnit, 'BHwe', 2. )
        call Bufftt(CreateTextTagUnitBJ("Reflection on", u, 90., 9.5, 0., 100., 100., 0 ),1)
        set bj_lastCreatedUnit = CreateUnit(Player(P-1), 'O00E', -20256, 16128, bj_UNIT_FACING)
      elseif ( tp == "SPEED" ) then
        if ( var > 20 ) then
          set var = 20
        endif
        call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Other\\Tornado\\TornadoElementalSmall.mdl", u, "origin") )
        call SaveInteger(udg_hash, P, 7, var)
        call DisplayTimedTextToPlayer( GetOwningPlayer(u), 0.50, 0, 5.00, "   |c00D1D1D1이동속도가 |cff9932cc" + I2S(R2I(GetUnitMoveSpeed(u))) + "|cff46ffff+" + I2S( var * 10 ) + " |r|c00D1D1D1/ 522 되었습니다." )
        if ( GetUnitAbilityLevel(u, 'A02V') == 0 ) then
          call UnitAddAbility(u, 'A02V')
        endif
        call SetUnitAbilityLevel(u, 'A02V', var+1)
        call Bufftt(CreateTextTagUnitBJ("Speed +" + I2S(var*10), u, 90., 9.5, 0., 100., 100., 0 ),1)
        set bj_lastCreatedUnit = CreateUnit(Player(P-1), 'O00F', -20256, 16128, bj_UNIT_FACING)
      elseif ( tp == "CONCEN" ) then
        call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathPact\\DeathPactCaster.mdl", u, "origin") )
        call Dummier(Player(P-1),u,-1,'A0AE',"mindrot")
        call Bufftt(CreateTextTagUnitBJ("집중 !", u, 90., 9.5, 0., 100., 100., 0 ),1)
        set udg_SysC_PotAdd[P] = udg_SysC_PotAdd[P] + 50
        set bj_lastCreatedUnit = CreateUnit(Player(P-1), 'O007', -20256, 16128, bj_UNIT_FACING)
      else
        call DisplayTimedTextToPlayer( GetOwningPlayer(u), 0.50, 0, 4.00, "|cffffdc3c버그입니다. 신고 해 주세요. [Code: " + tp + "]|r" )
        call DestroyTimer(t)
        set P = 0
        set t = null
        set i = 0
        return
      endif
//debug call BJDebugMsg("Buff_"+tp+"("+I2S(BuffCode(tp))+") P(" + I2S(P)+ "), i("+I2S(i) + "), var(" + I2S(var)+ ")" )

      if ( udg_SysK_BuffAdd[P] != 0 ) then
        set time = time * (( 100 + udg_SysK_BuffAdd[P] ) / 100.)
      endif

	  call SetUS("Hp", bj_lastCreatedUnit, R2I(time), true)
      call SetWidgetLife(bj_lastCreatedUnit, time+.5)
      call SaveInteger(udg_hash, GetHandleId(t), StringHash("Buff-P"), P)
      call SaveInteger(udg_hash, GetHandleId(t), StringHash("Buff-i"), i)
      call SaveInteger(udg_hash, GetHandleId(t), StringHash("Buff-v"), var)
      call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("Buff-u"), bj_lastCreatedUnit)
      call SaveTimerHandle(udg_hash, P, StringHash("Buff"+I2S(i)), t)
      call TimerStart(t,time,false,function BuffEnd)
      call BuffTimeSet(R2I(time)-1)
      set t = CreateTimer()
      call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("B.T.d"), bj_lastCreatedUnit)
      call TimerStart(t,1.,true,function BuffTime)
    elseif ( i != 9 and i != 10 ) and ( TimerGetRemaining(LoadTimerHandle(udg_hash,P,StringHash("Buff"+I2S(i)))) < time ) then
      call BuffEffectON(u, tp)
      call BuffTimerAdd(P, tp, time-TimerGetRemaining(LoadTimerHandle(udg_hash,P,StringHash("Buff"+I2S(i)))))
    else
      call DisplayTimedTextToPlayer( GetOwningPlayer(GetTriggerUnit()), 0.50, 0, 4.00, "|cffffdc3c이미 걸려 있으며, 시간이 '"+I2S(R2I(time))+"'초 이상입니다.|r" )
      call DestroyTimer(t)
    endif
  else
    call DisplayTimedTextToPlayer( GetOwningPlayer(GetTriggerUnit()), 0.50, 0, 4.00, "|cffffdc3c버그입니다. 신고 해 주세요. [CODE: " + I2S(i) + " ]|r")
    call DestroyTimer(t)
  endif
  set P = 0
  set t = null
  set i = 0
endfunction
constant function SKILLPER takes integer i returns real
  if ( i == 1 ) then
    return 40.
  elseif ( i == 2 ) then
    return 45.
  elseif ( i == 3 ) then
    return 50.
  elseif ( i == 4 ) then
    return 55.
  elseif ( i == 5 ) then
    return 60.
  elseif ( i == 6 ) then
    return 65.
  elseif ( i == 7 ) then
    return 70.
  elseif ( i == 8 ) then
    return 80.
  elseif ( i == 9 ) then
    return 90.
  elseif ( i == 10 ) then
    return 100.
  else
    return 0.
  endif
endfunction
//기술 퍼센트 반환
function SkillPer takes unit u, integer abc, real per, integer hit returns real
  if ( hit == 1 ) then
  //일반, 40~100
    return SKILLPER(GetUnitAbilityLevel(u, abc)) * ((100.+udg_SysC_Hits[GetPlayerId(GetOwningPlayer(u))+1]) /100.) * per
  elseif ( hit == 2 ) then
  //높은 숙련도, 60~100
    return SKILLPER(GetUnitAbilityLevel(u, abc)/2+5) * ((100.+udg_SysC_Hits[GetPlayerId(GetOwningPlayer(u))+1]) /100.) * per
  elseif ( hit == 3 ) then
  //숙련도 무시 - SkillPer(null, P, .3, 3): 3019b5a0hit
    return SKILLPER(10) * ((100.+udg_SysC_Hits[abc]) /100.) * per
  elseif ( hit == 4 ) then
  //버프류, 스킬레벨, 버프지속 영향 50~130초 + 버프지속
    return ( 50. + (8*GetUnitAbilityLevel(u, abc)) + GetUnitLevel(u) + ( GetUnitState(u, UNIT_STATE_MAX_MANA)/100. ) ) * (( 100 + udg_SysK_BuffAdd[GetPlayerId(GetOwningPlayer(u))+1] ) / 100.)
  elseif ( hit == 5 ) then
  //4번의 숙련도 무시
    return ( 130. + GetUnitLevel(u) + ( GetUnitState(u, UNIT_STATE_MAX_MANA)/100. ) ) * (( 100 + udg_SysK_BuffAdd[GetPlayerId(GetOwningPlayer(u))+1] ) / 100.)
  else
    return 0.
  endif
endfunction
//if ( GetRandomReal(0,100) <= SkillPer(udg_temp_u,'A000',0.9,1) ) then
//SkillPer(null,P,1.,4)
function ExpI2S takes integer exp returns string
  if ( exp >= 10000000 ) then
    return R2SW(exp/1000000.,2,1) + "M"
  elseif ( exp >= 1000000 ) then
    return R2SW(exp/1000000.,2,2) + "M"
  elseif ( exp >= 100000 ) then
    return I2S(exp/1000) + "K"
  elseif ( exp >= 10000 ) then
    return R2SW(exp/1000.,2,1) + "K"
  else
    return I2S(exp)
  endif
endfunction
function ShowTextTagPlayer takes player p, texttag tt returns nothing
  call SetTextTagVisibility(tt, false)
  if ( GetLocalPlayer() == p ) then
    call SetTextTagVisibility(tt, true)
  endif
endfunction
constant function DmgSys_I2C takes integer i returns string
    if ( i == 2 ) then /* Skill */
      return "|c009f9f9f"
    elseif ( i == 3 ) then /* Magic */
      return "|c00609fdf"
    elseif ( i == 4 ) then /* Poison */
      return "|c0050ef9f"
    else
      return "|r"
    endif
endfunction
globals
    unit DmgSys_Enum
    timer DmgSys_Timer
    real DmgSys_Dmg
    
    timer DmgSys_Miss_Timer
    unit DmgSys_Miss_Unit
endglobals
function Looping takes nothing returns nothing
  set DmgSys_Timer = GetExpiredTimer()
  set DmgSys_Enum = LoadUnitHandle(udg_hash, GetHandleId(DmgSys_Timer), StringHash("DSys_Unit"))
  set DmgSys_Dmg = LoadReal(udg_hash, GetHandleId(DmgSys_Enum), StringHash("DSys_Dmg"))
  
  call UnitRemoveAbility(DmgSys_Enum, 'A01S')
  
  if ( LoadBoolean(udg_hash, GetHandleId(DmgSys_Enum), StringHash("DSys_cri")) ) then
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, DmgSys_Enum, -50)
    call Ptext(bj_lastCreatedTextTag,"|c00ff0000"+ExpI2S(R2I(DmgSys_Dmg)),48,12,9,0.05)
    call Bufftt(bj_lastCreatedTextTag, 4)
  else
    call Bufftt(CreateTextTagUnitBJ(DmgSys_I2C(LoadInteger(udg_hash, GetHandleId(DmgSys_Enum), StringHash("DSys_id"))) + ExpI2S(R2I(DmgSys_Dmg)), DmgSys_Enum, -60, 12, 100, 100, 100, 0), 4)
  endif
  
  call RemoveSavedBoolean(udg_hash, GetHandleId(DmgSys_Enum), StringHash("DSys_cri"))
  call RemoveSavedReal(udg_hash, GetHandleId(DmgSys_Enum), StringHash("DSys_Dmg"))
  call RemoveSavedInteger(udg_hash, GetHandleId(DmgSys_Enum), StringHash("DSys_id"))
  
  set DmgSys_Dmg = LoadReal(udg_hash, GetHandleId(DmgSys_Enum), StringHash("DSys_Hp"))-DmgSys_Dmg
  if ( DmgSys_Dmg < .405 ) then
    if ( isHero(DmgSys_Enum) ) then
      if ( GetUnitState(DmgSys_Enum,UNIT_STATE_MANA) < 1. ) then
        call Coma(DmgSys_Enum, 15, 5.)
      elseif ( GetUnitState(DmgSys_Enum,UNIT_STATE_MANA) < GetUnitState(DmgSys_Enum,UNIT_STATE_MAX_MANA)*.15 ) then
        call Coma(DmgSys_Enum, 15, 2.)
      else
        call Coma(DmgSys_Enum, 15, 1.)
      endif
    endif
    //KillUnit At Monster - Killer를 저장해서 계산~ 가능하면 integer로
    //call Death_All_Act(DmgSys_Enum, LoadUnitHandle(udg_hash, GetHandleId(DmgSys_Enum), StringHash("DSys_e")))
    set DeathAll_Unit = DmgSys_Enum
    set DeathAll_Killer = LoadUnitHandle(udg_hash, GetHandleId(DmgSys_Enum), StringHash("DSys_e"))
    call ExecuteFunc("Death_All_Exe")
  else
    call SetWidgetLife(DmgSys_Enum, DmgSys_Dmg)
  endif
  call RemoveSavedHandle(udg_hash, GetHandleId(DmgSys_Enum), StringHash("DSys_e"))
  call FlushChildHashtable(udg_hash, GetHandleId(DmgSys_Timer))
  call DestroyTimer(DmgSys_Timer)
endfunction
function DmgSys_Add takes unit e, unit u, real od, real dmg, integer id, boolean cri returns nothing
  set DmgSys_Timer = CreateTimer()
    call SaveUnitHandle(udg_hash, GetHandleId(DmgSys_Timer), StringHash("DSys_Unit"), u)
    if ( HaveSavedReal(udg_hash, GetHandleId(u), StringHash("DSys_Dmg")) ) then
      call SaveReal(udg_hash, GetHandleId(u), StringHash("DSys_Dmg"), LoadReal(udg_hash, GetHandleId(u), StringHash("DSys_Dmg"))+dmg)
    else
      call SaveReal(udg_hash, GetHandleId(u), StringHash("DSys_Dmg"), dmg)
    endif
    set DmgSys_Dmg = GetWidgetLife(u)
    call SaveReal(udg_hash, GetHandleId(u), StringHash("DSys_Hp"),  DmgSys_Dmg - od)
    if ( od > GetUnitState(u,UNIT_STATE_MAX_LIFE) ) then
      call UnitAddAbility(u, 'A01S')
    endif
    call SetWidgetLife(u, DmgSys_Dmg + od)
    
    call SaveReal(udg_hash, GetHandleId(u), StringHash("DSys_Dmg"), dmg)
    call SaveBoolean(udg_hash, GetHandleId(u), StringHash("DSys_cri"), cri)
    call SaveUnitHandle(udg_hash, GetHandleId(u), StringHash("DSys_e"), e)
    call SaveInteger(udg_hash, GetHandleId(u), StringHash("DSys_id"), id)
    call TimerStart(DmgSys_Timer, 0., false, function Looping)
endfunction
function DmgSys_Missing takes nothing returns nothing
    set DmgSys_Miss_Timer = GetExpiredTimer()
    set DmgSys_Miss_Unit = LoadUnitHandle(udg_hash, GetHandleId(DmgSys_Miss_Timer), StringHash("M-Unit"))
//debug call BJDebugMsg("Miss-End. " + GetUnitName(DmgSys_Miss_Unit) + ", Life: " + R2SW(GetWidgetLife(DmgSys_Miss_Unit),2,1) + "->" +R2SW(LoadReal(udg_hash, GetHandleId(DmgSys_Miss_Timer), StringHash("M-Hp")),2,1))
    call UnitRemoveAbility(DmgSys_Miss_Unit, 'A01S')
    call SetWidgetLife(DmgSys_Miss_Unit, LoadReal(udg_hash, GetHandleId(DmgSys_Miss_Timer), StringHash("M-Hp")))
    call FlushChildHashtable(udg_hash, GetHandleId(DmgSys_Miss_Timer))
    call DestroyTimer(DmgSys_Miss_Timer)
endfunction
function DmgSys_Miss takes unit u, real od returns nothing
    set DmgSys_Miss_Timer = CreateTimer()
    call SaveUnitHandle(udg_hash, GetHandleId(DmgSys_Miss_Timer), StringHash("M-Unit"), u)
    call SaveReal(udg_hash, GetHandleId(DmgSys_Miss_Timer), StringHash("M-Hp"), GetWidgetLife(u)-od)
    if ( od > GetUnitState(u,UNIT_STATE_MAX_LIFE) ) then
      call UnitAddAbility(u, 'A01S')
    endif
    call SetWidgetLife(u, DmgSys_Dmg + od)
    call TimerStart(DmgSys_Miss_Timer, 0., false, function DmgSys_Missing)
endfunction
function DmgTrue takes unit u, unit t, real d returns nothing
  if ( GetUnitState(t, ConvertUnitState($50)) == 6. ) then
    set d = d * .1
  endif
  //call Bufftt(CreateTextTagUnitBJ(I2S(R2I(d)), t, -50, 12, 100, 0., 100, 0), 13)
  call UnitDamageTarget(u, t, d, true, false, ATTACK_TYPE_HERO, DAMAGE_TYPE_DEATH, WEAPON_TYPE_WHOKNOWS)
endfunction
//call DmgTrue(udg_temp_u, udg_temp_u2, d)
function TimeAction takes unit u, real r, integer i returns nothing
 local timer t = CreateTimer()
  if ( i == 1 ) then
    call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"), u)
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), i)
    call TimerStart(t,r,false,function TimerAction)
    call SetUnitInvulnerable(u, true)
    call TimeAction(u, 0.01, 2)
  elseif ( i == 2 ) then
    call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"), u)
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), i)
    call TimerStart(t,r,false,function TimerAction)
  elseif ( i == 3 ) then
    call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"), u)
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), i)
    call PauseUnit(u, true)
    call TimerStart(t,r,false,function TimerAction)
  elseif ( i == 4 ) then
    call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"), u)
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), i)
    call SaveStr(udg_hash, GetHandleId(t), StringHash("T.A.s"), udg_temp_s)
    set udg_temp_s = ""
    call TimerStart(t,r,false,function TimerAction)
  elseif ( i == 5 ) then
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), i)
    set i = GetPlayerId(GetOwningPlayer(u))+1
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i2"), i)
    call TimerStart(t,r,false,function TimerAction)
  elseif ( i == 6 ) then
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), i)
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i2"), GetPlayerId(GetOwningPlayer(u))+1)
    call TimerStart(t,r,false,function TimerAction)
  elseif ( i == 7 ) then
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), i)
    call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"), u)
    call TimerStart(t,r,false,function TimerAction)
  elseif ( i == 8 ) then
    //Stuck - 숫자만큼 Lv 감소

    //면역 아니면
    if ( GetUnitAbilityLevel(u, 'A02S') == 0 ) then
      if ( GetUnitAbilityLevel(u, 'A093') <= R2I(r) ) then
        call UnitRemoveAbility(u, 'A093')
      elseif ( GetUnitAbilityLevel(u, 'A093') > 0 ) then
        call DecUnitAbilityLevel(u, 'A093')
        if ( r == 3. ) then
          call DecUnitAbilityLevel(u, 'A093')
          call DecUnitAbilityLevel(u, 'A093')
        elseif ( r == 2. ) then
          call DecUnitAbilityLevel(u, 'A093')
        endif
      endif
      call Stuck_Color(u, GetUnitAbilityLevel(u, 'A02S'))
    endif
  elseif ( i == 9 ) then
  //도적 X티컬 터졌을때 크리 확률 25증가, 배율 0.15증가, 받는데미지 20증가
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), i)
    call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"), u)
    set i = GetPlayerId(GetOwningPlayer(u))+1
    if ( udg_SysI_NowJob[i] == 3 ) then
      set udg_SysI_Xtical[i] = udg_SysI_Xtical[i] + 1
      if ( udg_SysI_Xtical[i] > 1 ) then
        call DestroyTimer(t)
        set t = LoadTimerHandle(udg_hash, i, StringHash("X-Timer"))
        if ( udg_SysI_Xtical[i] == 7 ) then
            set udg_SysC_Dam[i] = udg_SysC_Dam[i] + 100
        endif
      else
        call SaveTimerHandle(udg_hash, i, StringHash("X-Timer"), t)
      endif
      call SetUnitVertexColor(u, 255, 223-(udg_SysI_Xtical[i]*32), 223-(udg_SysI_Xtical[i]*32), 255-(udg_SysI_Xtical[i]*16))
      set udg_SysC_CriP[i] = udg_SysC_CriP[i] + 10.
      set udg_SysC_CriX[i] = udg_SysC_CriX[i] + .07
      
      call SetUS("ARMOR", u, -15, false)
      call SetUS("MAC", u, -15, false)

      call ED( AddSpecialEffectTarget("Abilities\\Spells\\Orc\\TrollBerserk\\HeadhunterWEAPONSRight.mdl", u, "hand right"), r)
      call TimerStart(t,r,false,function TimerAction)
    else
      call DestroyTimer(t)
    endif
  //elseif ( i == 10 ) then
  //홀드명령
  elseif ( i == 11 ) then
  //나르콜리 (0초대기 위해 따로 처리)
  elseif ( i == 12 ) then
  //나르콜리 0초뒤 정지
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), i)
    call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"), u)
    call TimerStart(t,r,false,function TimerAction)
//12도 나르콜리
  elseif ( i == 13 ) then
  //캐스팅 - 마나 반환.
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), i)
    call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"), u)
	call SaveReal(udg_hash, GetHandleId(t), StringHash("T.A.mana"), GetUnitState(u, UNIT_STATE_MANA))
//debug call BJDebugMsg("13 - Mana: " + R2S(LoadReal(udg_hash, GetHandleId(t), StringHash("T.A.mana"))))
	call TimerStart(t,0.,false,function TimerAction)
  elseif ( i == 14 ) then
  //코마 풀리고 2초 뒤 무적 해제, 버프 제거
    call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"), u)
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), i)
    call TimerStart(t,r,false,function TimerAction)
  elseif ( i == 17 ) then
  //r초뒤 10번호로 튕김
    call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"), u)
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), i)
    call MSG(GetOwningPlayer(u), 1, 7., R2SW(r,2,1)+"초 뒤, 게임이 종료됩니다")
    call TimerStart(t,r,false,function TimerAction)
  elseif ( i == 18 ) then
  //해당 시간 대기 후 주변에 스킬 사용
    call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"), u)
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), i)
    call TimerStart(t, r, false, function TimerAction)
  elseif ( i == 19 ) then
  //해당 시간 대기 후 유닛 보임
    call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"), u)
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), i)
    call ShowUnit(u, false)
    call TimerStart(t, r, false, function TimerAction)
  elseif ( i == 20 ) then
  //도가 콤보시스템 - 8종류 중 랜덤옵션
    set i = GetRandomInt(1,4)
    
    if ( LoadBoolean(udg_hash, GetPlayerId(GetOwningPlayer(u))+1, StringHash("C-ing"+I2S(i))) ) then
    //중복, 시간 연장
      call DestroyTimer(t)
      set t = LoadTimerHandle(udg_hash, GetPlayerId(GetOwningPlayer(u))+1, StringHash("CoTimer"+I2S(i)))
      call TimerStart(t,r,false,function TimerAction)
      if ( i == 1 ) then
        call Bufftt(CreateTextTagUnitBJ("콤보:노멀+", u, 20, 9, 100, 50, 100, 0 ),6)
      elseif ( i == 2 ) then
        call Bufftt(CreateTextTagUnitBJ("콤보:얼티밋+", u, 20, 9, 100, 50, 100, 0 ),6)
      elseif ( i == 3 ) then
        call Bufftt(CreateTextTagUnitBJ("콤보:듀얼+", u, 20, 9, 100, 50, 100, 0 ),6)
      elseif ( i == 4 ) then
        call Bufftt(CreateTextTagUnitBJ("콤보:범위+", u, 20, 9, 100, 50, 100, 0 ),6)
      endif
    else
      call SaveBoolean(udg_hash, GetPlayerId(GetOwningPlayer(u))+1, StringHash("C-ing"+I2S(i)), true)
      
      call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), 20)
      call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"), u)
      call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i2"), i)
      call SaveTimerHandle(udg_hash, GetPlayerId(GetOwningPlayer(u))+1, StringHash("CoTimer"+I2S(i)), t)
      call TimerStart(t,r,false,function TimerAction)
      
      if ( i == 1 ) then
      //콤보:노멀 - 15초간 공속 3단계(20), Dam 15 증가
        call Bufftt(CreateTextTagUnitBJ("콤보:노멀!", u, 20, 13, 100, 50, 100, 0 ),6)
        set i = GetPlayerId(GetOwningPlayer(u))+1
        set udg_SysC_Dam[i] = udg_SysC_Dam[i] + 15
        set udg_SysC_AtkSpdAdd[i] = udg_SysC_AtkSpdAdd[i]+3
        call SetAtkSpd(i)
      elseif ( i == 2 ) then
      //콤보:얼티밋 - 15초간 필살기 데미지 15증가, 자동시전(통배, 발경, 쿠로토)
        call Bufftt(CreateTextTagUnitBJ("콤보:얼티밋!", u, 20, 13, 100, 50, 100, 0 ),6)
        set udg_SysC_PotAdd[GetPlayerId(GetOwningPlayer(u))+1] = udg_SysC_PotAdd[GetPlayerId(GetOwningPlayer(u))+1]+15
      elseif ( i == 3 ) then
      //콤보:듀얼 - 15초간 해당스킬 쿨초 15, 추가사용 15
        call Bufftt(CreateTextTagUnitBJ("콤보:듀얼!", u, 20, 13, 100, 50, 100, 0 ),6)
      elseif ( i == 4 ) then
      //콤보:범위 - 전체 쿨감 15후 15초간 주변 데미지(선풍 50)
        call Bufftt(CreateTextTagUnitBJ("콤보:범위!", u, 20, 13, 100, 50, 100, 0 ),6)
        set t = CreateTimer()
        call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), 23)
        call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"), u)
        call TimerStart(t,0.,false,function TimerAction)
      endif
    endif
  elseif ( i == 21 ) then
  //시간 후 애니메이션 초기화
    call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"), u)
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), i)
    call TimerStart(t, r, false, function TimerAction)
  elseif ( i == 22 ) then
  //전사 특성(의지)
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), i)
    call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"), u)
    set i = GetPlayerId(GetOwningPlayer(u))+1
    if ( udg_SysI_NowJob[i] == 2 ) then
      if ( udg_SysI_WoriorPeculiarity[i] < 4 ) and ( ( udg_SysI_WoriorPeculiarity[i] == 0 ) or ( GetRandomReal(0., 100.) <= 50.*SkillPer(null,i,1.,3) ) ) then
        set udg_SysI_WoriorPeculiarity[i] = udg_SysI_WoriorPeculiarity[i] + 1
        if ( udg_SysI_WoriorPeculiarity[i] > 1 ) then
          call DestroyTimer(t)
          set t = LoadTimerHandle(udg_hash, i, StringHash("X-Timer"))
        else
          call SaveTimerHandle(udg_hash, i, StringHash("X-Timer"), t)
        endif
      
        call SetUS("MAC", u, -10, false)
        if ( udg_SysI_WoriorPeculiarity[i] == 1 ) then
          call Bufftt(CreateTextTagUnitBJ("강철의 의지", u, 20, 13, 100, 50, 100, 0 ),6)
          call SetUS("ARMOR", u, 30, false)
        elseif ( udg_SysI_WoriorPeculiarity[i] == 2 ) then
          call Bufftt(CreateTextTagUnitBJ("신속의 의지", u, 20, 13, 100, 50, 100, 0 ),6)
          call StatAdd("m", i, 3)
          call StatAdd("t", i, 5)
        elseif ( udg_SysI_WoriorPeculiarity[i] == 3 ) then
          
          set r = GetUnitState(u, UNIT_STATE_MAX_LIFE)*.4
          call SaveInteger(udg_hash, i, StringHash("Wo.HP-i3"), R2I(r))
          call SetUS("Hp", u, R2I(r), false)
          
          if ( GetRandomReal(0,100) <= udg_SysC_CriP[i] ) then
            call Bufftt(CreateTextTagUnitBJ("집중의 의지 !!", u, 20, 13, 100, 50, 100, 0 ),6)
            set r = MakeValue("0|Lv+*50|St=*100|Co=*50",i) * udg_SysC_CriX[i]
          else
            call Bufftt(CreateTextTagUnitBJ("집중의 의지", u, 20, 13, 100, 50, 100, 0 ),6)
            set r = MakeValue("0|Lv+*50|St=*100|Co=*50",i)
          endif
          
          set udg_temp_u = u
          set udg_temp_g = GetGroupEnemy(CreateGroup(), u, 330., Condition(function Condi_EnemyNear))
          call Bufftt(CreateTextTagUnitBJ("|c008000ff"+I2S(R2I(r)), u, 0., 12., 100., 100., 100., 0),13)
          loop
            set udg_temp_u2 = FirstOfGroup(udg_temp_g)
            exitwhen udg_temp_u2 == null
            call GroupRemoveUnit(udg_temp_g, udg_temp_u2)
            if ( not IsUnitType(udg_temp_u2, UNIT_TYPE_HERO) ) then
              call DmgTrue(u, udg_temp_u2, r)
              call IssueTargetOrder(udg_temp_u2, "attack", u)
              call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\NightElf\\NightElfBlood\\NightElfBloodDruidRaven.mdl", udg_temp_u2, "overhead"))
            endif
          endloop
          call DestroyGroup(udg_temp_g)
          
          set bj_lastCreatedEffect = AddSpecialEffectTarget("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl", u, "origin")
          call EXSetEffectSize(bj_lastCreatedEffect, .5)
          call DestroyEffect(bj_lastCreatedEffect)
        elseif ( udg_SysI_WoriorPeculiarity[i] == 4 ) then
          call Bufftt(CreateTextTagUnitBJ("불굴의 의지", u, 20, 13, 100, 50, 100, 0 ),6)
          if ( GetUnitAbilityLevel(u, 'B00K') > 0 ) or ( udg_SysI_Dragon[i] ) then
            call SetWidgetLife(u, GetWidgetLife(u)+(GetUnitState(u, UNIT_STATE_MAX_LIFE)*.2))
          else
            call SetWidgetLife(u, GetWidgetLife(u)+(GetUnitState(u, UNIT_STATE_MAX_LIFE)*.1))
          endif
          set bj_lastCreatedEffect = AddSpecialEffectTarget("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl", u, "origin")
          call EXSetEffectSize(bj_lastCreatedEffect, .5)
          call DestroyEffect(bj_lastCreatedEffect)
        endif
        call TimerStart(t,10.,false,function TimerAction)
      else
        call FlushChildHashtable(udg_hash, GetHandleId(t))
        call DestroyTimer(t)
      endif
    endif
  //23: 콤보: 쿨탐 감소
  elseif ( i == 24 ) then
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), i)
    call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"), u)
    call TimerStart(t,r,false,function TimerAction)
  elseif ( i == 25 ) then
  //고갈: 리젠 감소
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"), i)
    set i = GetPlayerId(GetOwningPlayer(u))+1
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.P"), i)
    
    set udg_SysI_MinusRegen[i] = udg_SysI_MinusRegen[i] + 50
    set udg_SysC_Regen[i] = udg_SysC_Regen[i] - 50
    call TimerStart(t,r,false,function TimerAction)
  else
    call DisplayTimedTextToPlayer( GetOwningPlayer(u), 0.50, 0, 4.00, "|cffffdc3c설정 에러입니다. 신고 해 주세요. [CODE: |rTimeAction |cffffdc3c/|r " + R2SW(r,5,1) + " |cffffdc3c/|r " + I2S(i) + " ]|r")
  endif
  set t = null
endfunction
//call TimeAction(GetTriggerUnit(), 1., 1)

constant function DummyCheck takes integer dummy returns boolean
  return ( dummy == 'e00M' ) or ( dummy == 'e00N' ) or ( dummy == 'e00O' ) or ( dummy == 'e00Y' )
endfunction
//더미 생성, 기술
function CreateDummy takes unit u, integer dummy returns nothing
 local real x = GetUnitFacing(u)*bj_DEGTORAD
 local real y = GetWidgetY(u) + 25. * Sin(x)
  set x = GetWidgetX(u) + 25. * Cos(x)
  set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(u), dummy, GetWidgetX(u), GetWidgetY(u), GetUnitFacing(u))
  if ( DummyCheck(dummy) and udg_SysI_Xtical[GetPlayerId(GetOwningPlayer(u))+1] >= 3 ) then
    call UnitRemoveAbility(bj_lastCreatedUnit, 'A05W')
    call UnitAddAbility(bj_lastCreatedUnit, 'A02I')
    call AddSpecialEffectTarget("war3mapImported\\Pierce.mdx", bj_lastCreatedUnit, "origin")
  endif
  call IssuePointOrder(bj_lastCreatedUnit, "carrionswarm", x, y)
  call UnitApplyTimedLife(bj_lastCreatedUnit, 'BHwe', 1.5)
endfunction
//call CreateDummy(GetTriggerUnit(), 'e00G')
function CreateDummy2 takes unit u, integer data, integer rangetype returns nothing
 local real x = GetUnitFacing(u)*bj_DEGTORAD
 local real y = GetWidgetY(u) + 25. * Sin(x)
  set x = GetWidgetX(u) + 25. * Cos(x)
  set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(u), 'e015', GetWidgetX(u), GetWidgetY(u), GetUnitFacing(u))
  
  // 0 - 윈블 이펙트(메블,스톰블) /  1 - 기본(1칸*1명) or 도적(1칸*여러명) / 2 - 멀리(3칸*1명) / 3 - 확장(3칸*여러명) / 4 - 윈블 / 5 - 숏블
  
  if ( rangetype == 0 ) then
    call UnitAddAbility(bj_lastCreatedUnit, 'A0AC')
  elseif ( rangetype == 1 ) then
    if ( DummyCheck(data) and udg_SysI_Xtical[GetPlayerId(GetOwningPlayer(u))+1] >= 3 ) then
      call UnitAddAbility(bj_lastCreatedUnit, 'A02I')
      call AddSpecialEffectTarget("war3mapImported\\Pierce.mdx", bj_lastCreatedUnit, "origin")
    else
      call UnitAddAbility(bj_lastCreatedUnit, 'A05W')
    endif
  elseif ( rangetype == 2 ) then
    call UnitAddAbility(bj_lastCreatedUnit, 'A05X')
  elseif ( rangetype == 3 ) then
    call UnitAddAbility(bj_lastCreatedUnit, 'A05Z')
  elseif ( rangetype == 4 ) then
    call UnitAddAbility(bj_lastCreatedUnit, 'A00B')
  elseif ( rangetype == 5 ) then
    call UnitAddAbility(bj_lastCreatedUnit, 'A02R')
  endif
  call SetUnitUserData(bj_lastCreatedUnit, data)
  
  call IssuePointOrder(bj_lastCreatedUnit, "carrionswarm", x, y)
  call UnitApplyTimedLife(bj_lastCreatedUnit, 'BHwe', 1.5)
endfunction
//call CreateDummy2(GetTriggerUnit(), 'e00G', 4)

//크리 시스템
function EQ takes nothing returns nothing
  if ( GetLocalPlayer() == Player(LoadInteger(udg_hash, GetHandleId(GetExpiredTimer()), 21)-1) ) then
    call CameraSetSourceNoise(0, 0)
    call CameraSetTargetNoise(0, 0)
  endif
  call FlushChildHashtable(udg_hash, GetHandleId(GetExpiredTimer()))
  call DestroyTimer(GetExpiredTimer())
endfunction
function CameraShake takes integer P, real time, real magnitude returns nothing
 local timer t = CreateTimer()
 local real richter = magnitude*Pow(10,RMinBJ(5.,RMaxBJ(2.,magnitude)))
  if ( GetLocalPlayer() == Player(P-1) ) then
    call CameraSetTargetNoiseEx(magnitude*2., richter, true)
    call CameraSetSourceNoiseEx(magnitude*2., richter, true)
  endif
  call SaveInteger(udg_hash, GetHandleId(t), 21, P)
  call TimerStart(t, time, false, function EQ)
endfunction
//call CameraShake(P, .4, 2~5)
function Cri takes real dmg, integer P, real r returns real
//call DisplayTimedTextToPlayer( Player(0), 0.50, 0, 3.00, ( ( "dmg: " + R2S(dmg) ) + ( ( "P: " + I2S(P) ) + ( "r: " + R2S(r) ) ) ) )
  if ( GetRandomReal(0,100) <= udg_SysC_CriP[P] ) and ( dmg > 1 ) and ( r > 0 ) then
    if ( GetRandomReal(0,100) <= (udg_SysC_CriP[P]-(10*udg_SysI_Xtical[P]))/1.5 ) then
      if ( SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])), 1, 2) == "3" ) then
      if ( udg_SysI_Xtical[P] < 10 ) then
        call TimeAction(udg_Unit[P], 5., 9)
        if ( udg_SysI_Xtical[P] > 1 ) then
          call Bufftt(CreateTextTagUnitBJ( "* X tical !! x"+I2S(udg_SysI_Xtical[P]), udg_Unit[P], 20, 13, 100, 0, 0, 0 ),6)
        else
          call Bufftt(CreateTextTagUnitBJ( "* X tical !!", udg_Unit[P], 20, 13, 100, 0, 0, 0 ),6)
        endif
      endif
      elseif ( SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])), 1, 2) == "6" ) then
        call TimeAction(udg_Unit[P], GetRandomReal(1.,8.99), 20)
      endif
    else
      call Bufftt(CreateTextTagUnitBJ( "* Critical !! *", udg_Unit[P], 20, 10, 100, 0, 0, 0 ),6)
      call CameraShake(P, .4, r)
    endif
    if ( r == 33.01 ) then
      set dmg = dmg * udg_SysC_CriX[P] * 2
    else
      set dmg = dmg * udg_SysC_CriX[P]
    endif
    set udg_SYSTEM_isCri = true
  endif
 return dmg
endfunction
//set dmg = Cri(dmg,pN,efOX)



constant function MakeValue3 takes integer lv returns real
//숙련도에 따른 효율
  if ( lv == 1 ) then
    return 0.4
  elseif ( lv == 2 ) then
    return 0.45
  elseif ( lv == 3 ) then
    return 0.5
  elseif ( lv == 4 ) then
    return 0.55
  elseif ( lv == 5 ) then
    return 0.6
  elseif ( lv == 6 ) then
    return 0.65
  elseif ( lv == 7 ) then
    return 0.7
  elseif ( lv == 8 ) then
    return 0.8
  elseif ( lv == 9 ) then
    return 0.9
  elseif ( lv == 10 ) then
    return 1.
  else
    return 0.01
  endif
endfunction
function MakeValue2 takes integer lv, integer P, integer i returns real
  if ( lv == 0 ) and ( i != 2 ) then
    call MSG(Player(P-1), -1, 8, "M.V2 - 0 / " + I2S(i))
  endif
  if ( i == 1 ) then
  //일반. 40~100, 추가없음 (마법에 사용)
    return MakeValue3(lv)
  elseif ( i == 2 ) then
  //숙련도 무시, 항상 100Dam(마법책 속 스킬들 등)
    return MakeValue3(10) * ((100+udg_SysC_Dam[P])/100.)
  elseif ( i == 3 ) then
  //일반 + Dam(일반스킬에 사용)
    return MakeValue3(lv) * ((100+udg_SysC_Dam[P])/100.)
  elseif ( i == 4 ) then
  //일반 + 2xDam(Dam 효율 두배)
    return MakeValue3(lv) * (1.+(udg_SysC_Dam[P]/50.))
  elseif ( i == 5 ) then
  //일반 (스킬 등)
    return MakeValue3(lv)
  else
    call MSG(Player(P-1), -1, 8, "M.V2 / " + R2SW(lv,3,2) + " / " + I2S(i) )
    return 0.01
  endif
endfunction
//MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A000'), GetPlayerId(GetOwningPlayer(udg_temp_u))+1, 1)
constant function MakeValue4 takes integer ty returns real
//숙련도에 따른 효율
  if ( ty == 1 ) then
  //단일 스킬, 85효율
    return .85
  elseif ( ty == 2 ) then
  //범위 스킬, 75효율
    return .75
  elseif ( ty == 3 ) then
  //전체 스킬, 65효율
    return .65
  elseif ( ty == 4 ) then
  //버프 스킬, 55효율
    return .55
  endif
  return 1.
endfunction
function MakeValue22 takes integer lv, integer P, integer i, integer ty returns real
  if ( ty >= 1 ) then
    set lv = 10
  endif
  if ( i == 1 ) then
  //일반. 40~100, 추가없음 (마법에 사용)
    return MakeValue3(lv) * MakeValue4(ty)
  elseif ( i == 2 ) then
  //숙련도 무시, 항상 100Dam(마법책 속 스킬들 등)
    return MakeValue3(10) * ((100+udg_SysC_Dam[P])/100.) * MakeValue4(ty)
  elseif ( i == 3 ) then
  //일반 + Dam(일반스킬에 사용)
    return MakeValue3(lv) * ((100+udg_SysC_Dam[P])/100.) * MakeValue4(ty)
  elseif ( i == 4 ) then
  //일반 + 2xDam(Dam 효율 두배)
    return MakeValue3(lv) * (1.+(udg_SysC_Dam[P]/50.)) * MakeValue4(ty)
  elseif ( i == 5 ) then
  //일반 (스킬 등)
    return MakeValue3(lv) * MakeValue4(ty)
  else
    call MSG(Player(P-1), -1, 8, "M.V22 / " + R2SW(lv,3,2) + " / " + I2S(i) )
    return 0.01
  endif
endfunction

function MCri takes real dmg, integer P, integer v, integer v2 returns real
  set dmg = dmg * (.80 + (udg_SysC_Dam[P]*.01))
  if ( GetRandomReal(0,100) <= udg_SysC_CriP[P] ) then
    call Bufftt(CreateTextTagUnitBJ("Super Casting !!", udg_Unit[P], 20, 10, 30, 100, 30, 0 ), 6)
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ControlMagic\\ControlMagicTarget.mdl", udg_Unit[P], "origin"))
    set dmg = dmg * udg_SysC_CriX[P]
    if ( v == 1 ) or ( v == 4 ) then
    //개인
      call CameraShake(P, .5, 3.)
      if ( v2 == 6 ) then
        call SetWidgetLife(udg_Unit[P], GetWidgetLife(udg_Unit[P])*.85)
      else
        call SetWidgetLife(udg_Unit[P], GetWidgetLife(udg_Unit[P])*.95)
      endif
    elseif ( v == 2 ) then
    //수페라&엑스
      call CameraShake(P, .55, 4.)
      if ( v2 == 6 ) then
        call SetWidgetLife(udg_Unit[P], GetWidgetLife(udg_Unit[P])*.7)
      else
        call SetWidgetLife(udg_Unit[P], GetWidgetLife(udg_Unit[P])*.9)
      endif
    elseif ( v == 3 ) then
    //광역.
      call CameraShake(P, .6, 5.)
      if ( v2 == 6 ) then
        call SetWidgetLife(udg_Unit[P], GetWidgetLife(udg_Unit[P])*.55)
      else
        call SetWidgetLife(udg_Unit[P], GetWidgetLife(udg_Unit[P])*.85)
      endif
    else
    //기타. 독뎀 등
    endif
    if ( v2 == 1 ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Blizzard\\BlizzardTarget.mdl", udg_Unit[P], "origin"))
    elseif ( v2 == 2 ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Volcano\\VolcanoDeath.mdl", udg_Unit[P], "origin"))
    elseif ( v2 == 3 ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Cyclone\\CycloneTarget.mdl", udg_Unit[P], "origin"))
    elseif ( v2 == 4 ) then
      call ED(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Doom\\DoomTarget.mdl", udg_Unit[P], "origin"), 2.)
    elseif ( v2 == 5 ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl", udg_Unit[P], "origin"))
    elseif ( v2 == 6 ) then
      call ED(AddSpecialEffectTarget("Abilities\\Spells\\Demon\\DarkConversion\\ZombifyTarget.mdl", udg_Unit[P], "origin"), 2.)
    endif
    set udg_SYSTEM_isCri = true
  else
    set udg_SYSTEM_isCri = false
  endif
  set udg_SYSTEM_isPot = ( v2 == 6 )
  return dmg
endfunction
//set dmg = MCri(dmg, P, 1, 4)
//v1=1~3(개인, 범위, 전체), v2=1~6(수토풍화빛암)

//트리거 반복 데미지
function FDmg takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local unit target = LoadUnitHandle(udg_hash,GetHandleId(t),StringHash("f-Target"))
 local integer number = LoadInteger(udg_hash,GetHandleId(t),StringHash("f-Number"))
 local integer i = LoadInteger(udg_hash,GetHandleId(t),StringHash("f-type"))
  if not(IsUnitType(target, UNIT_TYPE_DEAD)) and ( number > 0 ) then
    if ( i == 1 ) then
      set udg_SYSTEM_DamgeColor = "베노미"
    elseif ( i == 2 ) then
      set udg_SYSTEM_DamgeColor = "데스"
    else
      set udg_SYSTEM_DamgeColor = "|c0050ef9f"
    endif
    if ( HaveSavedBoolean(udg_hash,GetHandleId(t),StringHash("f-Cri")) ) then
      set udg_SYSTEM_isCri = true
    endif
    call UnitDamageTarget(LoadUnitHandle(udg_hash,GetHandleId(t),StringHash("f-Source")), target, LoadReal(udg_hash,GetHandleId(t),StringHash("f-Damage")), true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
    call SaveInteger(udg_hash,GetHandleId(t),StringHash("f-Number"),number-1)
  else
    call FlushChildHashtable(udg_hash, GetHandleId(t))
    call DestroyTimer(t)
    call UnitRemoveAbility(target,'B005')
    call UnitRemoveAbility(target,'B012')
    call UnitRemoveAbility(target,'B013')
  endif
 set t = null
 set target = null
endfunction
function Fdmg takes unit caster, unit target, real dmg, real time, integer num returns nothing
 local timer t = CreateTimer()
  
  if ( isHero(target) ) then
    if ( GetRandomReal(0.,100.) <= udg_SysC_MissMagic[GetPlayerId(GetOwningPlayer(target))+1] ) then
      call MSG(GetOwningPlayer(target), 2, 5., "|cff46ffff마법 방어 !!|r - |cff9932cc" + udg_temp_s)
      call DestroyTimer(t)
    elseif ( LoadReal(udg_hash, GetHandleId(caster), StringHash("MDmg")) > 0. ) then
      set dmg = dmg * ( 1. + LoadReal(udg_hash, GetHandleId(caster), StringHash("MDmg")) )
    endif
  elseif ( GetRandomReal(0.,100.) <= LoadReal(udg_hash,GetHandleId(target),StringHash("Mdf")) - (udg_SysE_INT3[GetPlayerId(GetOwningPlayer(caster))+1]*.2) ) then
    call MSG(GetOwningPlayer(caster), 2, 5., "빗나갔습니다.")
    call DestroyTimer(t)
  endif
  if ( t != null ) then
    call SaveUnitHandle(udg_hash,GetHandleId(t),StringHash("f-Source"),caster)
    call SaveUnitHandle(udg_hash,GetHandleId(t),StringHash("f-Target"),target)
    if ( udg_SYSTEM_isCri ) then
      call SaveBoolean(udg_hash,GetHandleId(t),StringHash("f-Cri"),udg_SYSTEM_isCri)
    endif
    if ( dmg*num > GetWidgetLife(target) ) then
      call SaveReal(udg_hash,GetHandleId(t),StringHash("f-Damage"),dmg*.5)
      call SaveInteger(udg_hash,GetHandleId(t),StringHash("f-Number"),num*2)
      set time = time *.5
    else
      call SaveReal(udg_hash,GetHandleId(t),StringHash("f-Damage"),dmg)
      call SaveInteger(udg_hash,GetHandleId(t),StringHash("f-Number"),num)
    endif
    if ( LoadReal(udg_hash,GetHandleId(target),StringHash("MRD2")) != 0. ) then
      set dmg = dmg * (1.-LoadReal(udg_hash,GetHandleId(target),StringHash("MRD2")))
    endif
    if ( udg_temp_s == "베노미" ) then
      call SaveInteger(udg_hash,GetHandleId(t),StringHash("f-type"),1)
    elseif ( udg_temp_s == "데스" ) then
      call SaveInteger(udg_hash,GetHandleId(t),StringHash("f-type"),2)
    endif
    call TimerStart(t, time, true, function FDmg)
  else
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\ReplenishManaCasterOverhead.mdl", target, "overhead"))
    call Bufftt(CreateTextTagUnitBJ("Miss !!", target, -30., 15., 100.00, 0, 50., 20.), 10)
  endif
 set t = null
endfunction
function MS1 takes real x, real y returns boolean
 local real ix = 0.
 local real iy = 0.
 call RemoveItem(udg_MS_item)
 set udg_MS_item = CreateItem('gold',x,y)
 set ix=GetWidgetX(udg_MS_item)
 set iy=GetWidgetY(udg_MS_item)
 call SetItemVisible(udg_MS_item,false)
 return (x-ix)*(x-ix)+(y-iy)*(y-iy) <= 10.
endfunction
function Narcoly takes unit u, unit t, real dur returns nothing
  local integer P = GetPlayerId(GetOwningPlayer(u))+1
  local real per = 100.
  if ( u == udg_Unit[P] ) then
    //상대 숙련도에 따라 성공률 설정 ~60
    set per = per/100 * SkillPer(u, 'A02T', 0.6, 1)
  else
    //몬스터 마법공격력 증폭에 따라 성공률 증가
    set per = per * (1.+LoadReal(udg_hash, GetHandleId(u), StringHash("MDmg")))
  endif
  set P = GetPlayerId(GetOwningPlayer(t))+1
  if ( t == udg_Unit[P] ) then
    //유저 마방에 따라 성공률 감소
    if ( GetRandomReal(0,100*per) <= udg_SysC_MissMagic[P] ) then
      set per = -1
    endif
  elseif ( GetRandomReal(0,100*per) <= LoadReal(udg_hash, GetHandleId(t), StringHash("Mdf")) ) then
    set per = -1
  endif
  if ( per < 0 ) then
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\ReplenishManaCasterOverhead.mdl", t, "overhead"))
    call Bufftt(CreateTextTagUnitBJ("|cffff0080Miss !!|r", t, -50., 12., 100., 100., 100., 20.), 10)
    call MSG(GetOwningPlayer(u), 1, 2, "실패했습니다. (나르콜리)")
    call MSG(GetOwningPlayer(t), 2, 3, "|cff46ffff마법 방어 !! |r- |cff9932cc나르콜리|r")
  else
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\Sleep\\SleepSpecialArt.mdl", t, "overhead"))
//캐스팅 중인 마법 있으면 취소시킴.
    call TimeAction(t, 2, 8)
    //0초뒤 정지
    call TimeAction(t, 0., 12)
	//set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(u), 'e000', GetWidgetX(t), GetWidgetY(t), bj_UNIT_FACING)
    //call UnitRemoveAbility(bj_lastCreatedUnit, 'A01R')
    //if ( IssueTargetOrderById(bj_lastCreatedUnit, String2OrderIdBJ("lightningshield"), t) ) then
//debug call BJDebugMsg("나르콜리 - YES")
//debug     else
//debug call BJDebugMsg("나르콜리 - NO")
    //endif
	set bj_lastStartedTimer = LoadTimerHandle(udg_hash, GetHandleId(t), StringHash("Narcolly"))
    if ( bj_lastStartedTimer == null ) then
      set bj_lastStartedTimer = CreateTimer()
      call SaveTimerHandle(udg_hash, GetHandleId(t), StringHash("Narcolly"), bj_lastStartedTimer)
      call SaveInteger(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("T.A.i"), 11)
      call SaveUnitHandle(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("T.A.u"), t)
  	  call SetUnitTimeScale(t, 0.)
    endif
    if ( ISBOSS(GetUnitTypeId(u)) > 0 ) then
      set dur = dur * BaseValue(26)
    elseif ( LoadReal(udg_hash,GetHandleId(t),StringHash("MRD2")) != 0. ) then
      set dur = dur * (1.-LoadReal(udg_hash,GetHandleId(t),StringHash("MRD2")))
    endif
	call TimerStart(bj_lastStartedTimer,dur,false,function TimerAction)
  endif
endfunction

constant function InBookSkill takes string s returns boolean
  return ( s != null ) and ( s != "." )
endfunction
function SkillUp takes unit u, integer skill, real p returns nothing
  if ( GetUnitAbilityLevel(u, skill) == 0 ) then
    call DisplayTimedTextToPlayer( GetOwningPlayer(u), 0.50, 0, 8.00, "|cffffdc3c설정 에러! 카페에 신고 해 주세요 [|rSkillUp|cffffdc3c/|r" + GetObjectName(skill) + "|cffffdc3c]" )
  elseif ( GetUnitAbilityLevel(u, skill) < 10 ) and ( GetRandomReal(0,50.) <= (30.+p)-((((30.+p)/10.)*GetUnitAbilityLevel(u, skill))) ) then
  //x가 20이면 50~5확률로, x가 -28이면 2~0.2확률로. x2
    call IncUnitAbilityLevel(u, skill)
    
    if ( InBookSkill(SubString(LoadStr(udg_hash, udg_temp_ab, 67), 2, 3)) ) then
      call EXSetAbilityState(EXGetUnitAbility(u, udg_temp_ab), ABILITY_STATE_COOLDOWN, EXGetAbilityDataReal(EXGetUnitAbility(u, udg_temp_ab), GetUnitAbilityLevel(u, udg_temp_ab), ABILITY_DATA_COOL))
      call MSG(GetOwningPlayer(u), 1, 2, "숙련도가 상승하였습니다. (|c00ffff80마법책: " + GetObjectName(skill) + BaseStr(11) + ")")
    else
      call MSG(GetOwningPlayer(u), 1, 2, "숙련도가 상승하였습니다. (|c00ffff80" + GetObjectName(skill) + BaseStr(11) + ")")
    endif
  endif
endfunction
//call SkillUp(unit,skill,p)

//v1=1~3, v2=1~6
function DmgMagic takes unit u, unit t, real d returns nothing
  call UnitDamageTarget(u, t, d, true, false, ATTACK_TYPE_HERO, DAMAGE_TYPE_COLD, WEAPON_TYPE_WHOKNOWS)
endfunction
//call DmgMagic(udg_temp_u, udg_temp_u2, MakeValue("300|In=*50", udg_temp_i) * MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A008'),udg_temp_i,5))
//v1 = 마법 대상 종류, v2 = 마법 속성
function DmgSkill takes unit u, unit t, real d returns nothing
  call UnitDamageTarget(u, t, d, true, false, ATTACK_TYPE_HERO, DAMAGE_TYPE_FIRE, WEAPON_TYPE_WHOKNOWS)
endfunction
//call DmgSkill(udg_temp_u, udg_temp_u2, Cri(udg_temp_r, udg_temp_i, 0))
function PolarX takes real x, real dist, real angle returns real
 return x + dist * Cos(angle * bj_DEGTORAD)
endfunction
function PolarY takes real y, real dist, real angle returns real
 return y + dist * Sin(angle * bj_DEGTORAD)
endfunction

function CurseEnd takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local unit u = LoadUnitHandle(udg_hash,GetHandleId(t),StringHash("C-Unit"))
  if IsUnitType(u, UNIT_TYPE_DEAD) and IsUnitType(u, UNIT_TYPE_HERO) and ( GetPlayerController(GetOwningPlayer(u)) == MAP_CONTROL_USER ) then
    call TimerStart(t,2.,false,function CurseEnd)
  else
    call SetUS("ARMOR", u, CurseValue(LoadInteger(udg_hash,GetHandleId(u),StringHash("Curse")), true), false)
    call SetUS("MAC", u, CurseValue(LoadInteger(udg_hash,GetHandleId(u),StringHash("Curse")), false), false)
    call SaveInteger(udg_hash,GetHandleId(u),StringHash("Curse"),0)
    call UnitRemoveAbility(u,'B007')
    call UnitRemoveAbility(u,'B000')
    if IsUnitType(u, UNIT_TYPE_HERO) and ( GetPlayerController(GetOwningPlayer(u)) == MAP_CONTROL_USER ) then
      call RemoveUnit(LoadUnitHandle(udg_hash,GetHandleId(t),StringHash("C-Dummy")))
    endif
    call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\FaerieFire\\FaerieFireTarget.mdl", u, "head") )
    call FlushChildHashtable(udg_hash, GetHandleId(t))
    call DestroyTimer(t)
  endif
  set t = null
  set u = null
endfunction
function Curse takes unit o, unit u, real dur, integer lev returns nothing
local timer t = null
local integer i = LoadInteger(udg_hash,GetHandleId(u),StringHash("Curse"))
call UnitRemoveAbility(u,'B007')
if ( dur == 0 ) then
  if ( i > 0 ) and ( lev >= i ) then
    call TimerStart(LoadTimerHandle(udg_hash,GetHandleId(u),StringHash("C-Timer")),0,false,function CurseEnd)
    call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Human\\DispelMagic\\DispelMagicTarget.mdl", u, "origin") )
  elseif ( i > 0 ) then
    call DisplayTimedTextToPlayer( GetOwningPlayer(o), 0.50, 0, 4.00, "|cffffdc3c너무 강력한 저주입니다. (" + I2S(i) + "단계 저주)|r" )  
  endif
elseif ( i != 0 ) then
  call DisplayTimedTextToPlayer( GetOwningPlayer(o), 0.50, 0, 4.00, "|cffffdc3c이미 다른 저주가 걸려 있습니다. (" + I2S(i) + "단계 저주)|r" )
elseif ( i == 0 ) and ( lev > 0 ) then
  if ( LoadTimerHandle(udg_hash,GetHandleId(u),StringHash("C-Timer")) == null ) then
    set t = CreateTimer()
  else
    set t = LoadTimerHandle(udg_hash,GetHandleId(u),StringHash("C-Timer"))
  endif

  if ( lev == 2 ) then
    call CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'e008', GetWidgetX(u), GetWidgetY(u), bj_UNIT_FACING)
  elseif ( lev == 3 ) then
    call SetUnitVertexColor(CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'e008', GetWidgetX(u), GetWidgetY(u), bj_UNIT_FACING), 204, 102, 204, 255)
  elseif ( lev == 4 ) then
    call SetUnitVertexColor(CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'e008', GetWidgetX(u), GetWidgetY(u), bj_UNIT_FACING), 255, 0, 0, 255)
  else
    call CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'e006', GetWidgetX(u), GetWidgetY(u), bj_UNIT_FACING)
  endif
  
  call SaveInteger(udg_hash,GetHandleId(u),StringHash("Curse"),lev)
  call SaveTimerHandle(udg_hash,GetHandleId(u),StringHash("C-Timer"),t)
  
  call SetUS("ARMOR", u, -CurseValue(lev, true), false)
  call SetUS("MAC", u, -CurseValue(lev, false), false)
  
  call SaveUnitHandle(udg_hash,GetHandleId(t),StringHash("C-Unit"),u)
  call TimerStart(t,dur,false,function CurseEnd)
  if IsUnitType(u, UNIT_TYPE_HERO) and ( GetPlayerController(GetOwningPlayer(u)) == MAP_CONTROL_USER ) then  
    set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(u), 'O00G', -20256, 16128, bj_UNIT_FACING)
	call SetUS("Hp", bj_lastCreatedUnit, R2I(dur), true)
    call SaveUnitHandle(udg_hash,GetHandleId(t),StringHash("C-Dummy"),bj_lastCreatedUnit)
    call BuffTimeSet(R2I(dur)-1)
    set t = CreateTimer()
    call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("B.T.d"), bj_lastCreatedUnit)
    call TimerStart(t,1.,true,function BuffTime)
  endif
  
  set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(o), 'e001', GetWidgetX(u), GetWidgetY(u), bj_UNIT_FACING )
  call SetUnitAbilityLevel(bj_lastCreatedUnit, 'A02B', lev)
  call IssueTargetOrder( bj_lastCreatedUnit, "curse", u )
  call RemoveUnit(bj_lastCreatedUnit)
  set t = null
else
  call DisplayTimedTextToPlayer( GetOwningPlayer(o), 0.50, 0, 4.00, "|cffffdc3c버그입니다. 신고 해 주세요. [CODE: Curse / " + I2S(i) + " / " + I2S(lev) + " ]|r")
endif
endfunction
//call Curse(GetTriggerUnit(),GetSpellTargetUnit(),GetRandomReal(50,100),GetRandomInt(1,5))
function SkipBuff takes integer P, integer i returns nothing
  if ( i != 0 ) then
    set bj_lastStartedTimer = LoadTimerHandle(udg_hash,P,StringHash("Buff"+I2S(i)))
	if ( bj_lastStartedTimer != null ) then
      call TimerStart(bj_lastStartedTimer, 0., false, function BuffEnd)
	endif
  else
    set i = BuffCode("ALL")
	loop
	  exitwhen i == 0
      set bj_lastStartedTimer = LoadTimerHandle(udg_hash,P,StringHash("Buff"+I2S(i)))
	  if ( bj_lastStartedTimer != null ) then
        call TimerStart(bj_lastStartedTimer, 0., false, function BuffEnd)
      endif
	  set i = i - 1
	endloop
  endif
endfunction
//call SkipBuff(P, 1) - 1번 버프(벨라) 삭제
//call SkipBuff(P, 0) - 전체 버프 삭제

function getIndex takes integer x, integer y, integer layer returns integer
  return (x-1)*layer+y
endfunction

function PlaySoundOnUnitForPlayer takes player p, sound soundHandle, real volumePercent, unit whichUnit returns nothing
  if ( soundHandle != null ) then
    if ( GetLocalPlayer() == p ) then
      if ( whichUnit != null ) then
        call AttachSoundToUnit(soundHandle, whichUnit)
      endif
      call SetSoundVolume(soundHandle, PercentToInt(volumePercent, 127))
      call StartSound(soundHandle)
    endif
  endif
endfunction
//스텟 초기화
function ResetStat takes integer P, string msg returns nothing
  local integer i = 1
  local integer i2 = 0
  local string s = ""
  call CreateTextTagUnitBJ("Reset..." , GetTriggerUnit(), 30., 15., GetRandomReal(33.,133.), GetRandomReal(33.,133.), GetRandomReal(0.,75.), 0)
  call Bufftt(bj_lastCreatedTextTag, 1)
  call PauseUnit(GetTriggerUnit(), true)
  
  call CinematicFilterGenericForPlayer(Player(P-1), 2., BLEND_MODE_BLEND, "ReplaceableTextures\\CameraMasks\\White_mask.blp", 0., 0., 0., 100., 0., 0., 0., 0.)
 if ( msg == "스탯 초기화(강제)" ) then
   set s = FormatI2S(udg_SysE_STR1[P]-3,3)+"|"+FormatI2S(udg_SysE_DEX1[P]-3,3)+"|"+FormatI2S(udg_SysE_INT1[P]-3,3)+"|"+FormatI2S(udg_SysE_WIS1[P]-3,3)+"|"+FormatI2S(udg_SysE_CON1[P]-3,3)
 else
  if ( udg_SysE_STR1[P] > 3 ) then
    set i2 = 3
    loop
      exitwhen i > 7
	  set bj_forLoopAIndexEnd = LoadInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(i)))  
      if ( GetUnitAbilityLevel(udg_Unit[P], bj_forLoopAIndexEnd) >= 1 ) then
        if ( S2I(SubString(LoadStr(udg_hash, LoadInteger(udg_hash, StringHash("Skill"), bj_forLoopAIndexEnd), 60), 2, 5)) > i2 ) then
          set i2 = S2I(SubString(LoadStr(udg_hash, LoadInteger(udg_hash, StringHash("Skill"), bj_forLoopAIndexEnd), 60), 2, 5))
        endif
      endif
      set i = i + 1
    endloop
    call TriggerSleepAction(.2)
    if ( 3+udg_SysE_STR2[P] >= i2 ) then
      set s = s + FormatI2S(udg_SysE_STR1[P]-3,3) + "|"
    else
      set s = s + FormatI2S(udg_SysE_STR1[P]+udg_SysE_STR2[P]-i2,3) + "|"
    endif
  else
    set s = s + "000|"
  endif
  
  set i = 1
  if ( udg_SysE_DEX1[P] > 3 ) then
    set i2 = 3
    loop
      exitwhen i > 7
	  set bj_forLoopAIndexEnd = LoadInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(i)))  
      if ( GetUnitAbilityLevel(udg_Unit[P], bj_forLoopAIndexEnd) >= 1 ) then
        if ( S2I(SubString(LoadStr(udg_hash, LoadInteger(udg_hash, StringHash("Skill"), bj_forLoopAIndexEnd), 60), 5, 8)) > i2 ) then
          set i2 = S2I(SubString(LoadStr(udg_hash, LoadInteger(udg_hash, StringHash("Skill"), bj_forLoopAIndexEnd), 60), 5, 8))
        endif
      endif
      set i = i + 1
    endloop
    call TriggerSleepAction(.2)
    if ( 3+udg_SysE_DEX2[P] >= i2 ) then
      set s = s + FormatI2S(udg_SysE_DEX1[P]-3,3) + "|"
    else
      set s = s + FormatI2S(udg_SysE_DEX1[P]+udg_SysE_DEX2[P]-i2,3) + "|"
    endif
  else
    set s = s + "000|"
  endif
  
  set i = 1
  if ( udg_SysE_INT1[P] > 3 ) then
    set i2 = 3
    loop
      exitwhen i > 7
	  set bj_forLoopAIndexEnd = LoadInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(i)))  
      if ( GetUnitAbilityLevel(udg_Unit[P], bj_forLoopAIndexEnd) >= 1 ) then
        if ( S2I(SubString(LoadStr(udg_hash, LoadInteger(udg_hash, StringHash("Skill"), bj_forLoopAIndexEnd), 60), 8, 11)) > i2 ) then
          set i2 = S2I(SubString(LoadStr(udg_hash, LoadInteger(udg_hash, StringHash("Skill"), bj_forLoopAIndexEnd), 60), 8, 11))
        endif
      endif
      set i = i + 1
    endloop
    call TriggerSleepAction(.2)
    if ( 3+udg_SysE_INT2[P] >= i2 ) then
      set s = s + FormatI2S(udg_SysE_INT1[P]-3,3) + "|"
    else
      set s = s + FormatI2S(udg_SysE_INT1[P]+udg_SysE_INT2[P]-i2,3) + "|"
    endif
  else
    set s = s + "000|"
  endif
  
  set i = 1
  if ( udg_SysE_WIS1[P] > 3 ) then
    set i2 = 3
    loop
      exitwhen i > 7
	  set bj_forLoopAIndexEnd = LoadInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(i)))  
      if ( GetUnitAbilityLevel(udg_Unit[P], bj_forLoopAIndexEnd) >= 1 ) then
        if ( S2I(SubString(LoadStr(udg_hash, LoadInteger(udg_hash, StringHash("Skill"), bj_forLoopAIndexEnd), 60), 11, 14)) > i2 ) then
          set i2 = S2I(SubString(LoadStr(udg_hash, LoadInteger(udg_hash, StringHash("Skill"), bj_forLoopAIndexEnd), 60), 11, 14))
        endif
      endif
      set i = i + 1
    endloop
    call TriggerSleepAction(.2)
    if ( 3+udg_SysE_WIS2[P] >= i2 ) then
      set s = s + FormatI2S(udg_SysE_WIS1[P]-3,3) + "|"
    else
      set s = s + FormatI2S(udg_SysE_WIS1[P]+udg_SysE_WIS2[P]-i2,3) + "|"
    endif
  else
    set s = s + "000|"
  endif
  
  set i = 1
  if ( udg_SysE_CON1[P] > 3 ) then
    set i2 = 3
    loop
      exitwhen i > 7
	  set bj_forLoopAIndexEnd = LoadInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(i)))  
//debug call BJDebugMsg("현재" + GetObjectName(bj_forLoopAIndexEnd) + " 스킬, 스킬넘버: "+I2S(LoadInteger(udg_hash, StringHash("Skill"), bj_forLoopAIndexEnd))+", 필요 콘 스텟: " + SubString(LoadStr(udg_hash, LoadInteger(udg_hash, StringHash("Skill"), bj_forLoopAIndexEnd), 60), 14, 17))
      if ( GetUnitAbilityLevel(udg_Unit[P], bj_forLoopAIndexEnd) >= 1 ) then
        if ( S2I(SubString(LoadStr(udg_hash, LoadInteger(udg_hash, StringHash("Skill"), bj_forLoopAIndexEnd), 60), 14, 17)) > i2 ) then
          set i2 = S2I(SubString(LoadStr(udg_hash, LoadInteger(udg_hash, StringHash("Skill"), bj_forLoopAIndexEnd), 60), 14, 17))
        endif
      endif
      set i = i + 1
    endloop
    call TriggerSleepAction(.2)
    if ( 3+udg_SysE_CON2[P] >= i2 ) then
      set s = s + FormatI2S(udg_SysE_CON1[P]-3,3)
    else
      set s = s + FormatI2S(udg_SysE_CON1[P]+udg_SysE_CON2[P]-i2,3)
    endif
  else
    set s = s + "000"
  endif
 endif 
  call TriggerSleepAction(.5)
  call PlaySoundOnUnitForPlayer(Player(P-1), gg_snd_point, 100, null)
  call CinematicFilterGenericForPlayer(Player(P-1), 1.5, BLEND_MODE_BLEND, "ReplaceableTextures\\CameraMasks\\White_mask.blp", 0., 0., 0., 0., 100., 100., 100., 0. )
  call MSG(Player(P-1), 2, 4, "(몸 속으로 무언가가 들어오는것이 느껴지면서 정신이 아득해집니다.)")
  call TriggerSleepAction(2.)
  call CinematicFilterGenericForPlayer(Player(P-1), 5., BLEND_MODE_BLEND, "ReplaceableTextures\\CameraMasks\\White_mask.blp", 100., 100., 100., 0., 100., 100., 100., 100. )
  
  set udg_SysL_Level[P] = 0
  call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)+S2I(FCut(s,1))+S2I(FCut(s,2))+S2I(FCut(s,3))+S2I(FCut(s,4))+S2I(FCut(s,5)))
  if ( msg != "스탯 초기화(강제)" ) then
    if ( udg_SysB_Level[P] > 40 ) then
      call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD)-50000)
    elseif ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) > 600 ) then
      call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD)/2)
    else
      call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, IMaxBJ(0,GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD)-300))
    endif
  endif
  call AddState(P, "STR", -S2I(FCut(s,1)), true)
  call AddState(P, "DEX", -S2I(FCut(s,2)), true)
  call AddState(P, "INT", -S2I(FCut(s,3)), true)
  call AddState(P, "WIS", -S2I(FCut(s,4)), true)
  call AddState(P, "CON", -S2I(FCut(s,5)), true)
  
  set udg_SysI_Exct[P] = true
  call TriggerSleepAction(2.)
  call MSGAll(0, true, 1, 2, 7., SysStr(2,P) + GetPlayerName(Player(P-1)) + "|cffffff00님께서 '|c00d962b5"+msg+"|c00ffff00'를 하셨습니다.")
  call TriggerSleepAction(2.)
  call MSG(Player(P-1), 2, 8, "참고! 레벨업 이전에 모든 스텟을 사용하셔야 합니다.")
  call PauseUnit(GetTriggerUnit(), false)
  set i2 = udg_SysB_Level[P]
  call TriggerSleepAction(300.)
  if ( i2 == udg_SysB_Level[P] ) or ( udg_SysI_Exct[P] ) then
    set udg_SysI_Exct[P] = false
  endif

  set s = null
endfunction
//call ResetStat(P, "스탯 초기화(물약)")

//공격 반복
function AttackLoop takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local real time2 = LoadReal(udg_hash,GetHandleId(t),StringHash("TimeA"))
  local unit u = LoadUnitHandle(udg_hash,GetHandleId(t),StringHash("Unit"))
  local unit ta = LoadUnitHandle(udg_hash,GetHandleId(u),StringHash("Target"))
  set time2 = time2 - TimerGetTimeout(t)
  if ( time2 > 0 ) and not(IsUnitType(u, UNIT_TYPE_DEAD)) and not(IsUnitType(ta, UNIT_TYPE_DEAD)) then
    call SaveReal(udg_hash,GetHandleId(t),StringHash("TimeA"),time2)
    call IssueTargetOrder(u, "attack", ta)
  else
    call PauseTimer(t)
    call FlushChildHashtable(udg_hash, GetHandleId(t))
    call DestroyTimer(t)
  endif
  set t = null
  set u = null
  set ta = null
endfunction
function Attack takes unit u, unit ta, real time1, real time2 returns nothing
  local timer t = CreateTimer()
  if ( IsUnitInvisible(ta, GetOwningPlayer(u))) then
    call IssuePointOrder(u, "patrol", GetWidgetX(ta), GetWidgetY(ta))
    call DestroyTimer(t)
  elseif ( u != ta ) then
    call SaveUnitHandle(udg_hash,GetHandleId(t),StringHash("Unit"),u)
    call SaveUnitHandle(udg_hash,GetHandleId(u),StringHash("Target"),ta)
    if ( ISBOSS(GetUnitTypeId(u)) > 0 ) then
      set time2 = time2 * BaseValue(26)
    elseif ( LoadReal(udg_hash,GetHandleId(t),StringHash("MRD2")) != 0. ) then
      set time2 = time2 * (1.-LoadReal(udg_hash,GetHandleId(t),StringHash("MRD2")))
    endif
    set time1 = RMaxBJ(.05,RMinBJ(time1,time2))
    set time2 = time2 - time1
    call SaveReal(udg_hash,GetHandleId(t),StringHash("TimeA"),time2)
    call TimerStart(t,time1,true,function AttackLoop)
  else
    call DestroyTimer(t)
  endif
  set u = null
  set ta = null
  set t = null
endfunction
//call Attack(GetTriggerUnit(),GetTriggerUnit(),0.5,10)

function DialogClosing takes nothing returns nothing
 local timer t = GetExpiredTimer()
  call DialogDisplay(LoadPlayerHandle(udg_hash, GetHandleId(t), StringHash("Dia-P")), LoadDialogHandle(udg_hash, GetHandleId(t), StringHash("Dia-d")), false)
 call DialogDestroy(LoadDialogHandle(udg_hash, GetHandleId(t), StringHash("Dia-d")))
 call FlushChildHashtable(udg_hash,GetHandleId(t))
 call DestroyTimer(t)
 set t = null
endfunction
function DialogClose takes player p, dialog d, real time returns nothing
 local timer t = CreateTimer()
  call SavePlayerHandle(udg_hash, GetHandleId(t), StringHash("Dia-P"), p)
  call SaveDialogHandle(udg_hash, GetHandleId(t), StringHash("Dia-d"), d)
  call DialogDisplay(p, d, true)
  call TimerStart(t, time, false, function DialogClosing)
 set t = null
endfunction

//개인 멀티보드 최소화/최대화
function LocalMtbM takes player p, multiboard mb, boolean minimize returns nothing
  if ( GetLocalPlayer() == p ) then
    if ( minimize == false ) and ( IsMultiboardMinimized(mb) == false ) then
      call MultiboardMinimize(mb, true)
    endif
    call MultiboardMinimize(mb, minimize)
  endif
endfunction
//call LocalMtbM(GetTriggerPlayer(), bj_lastCreatedMultiboard, true)
//개인 리더보드 최소화/최대화
function LocalLdbM takes player p, leaderboard lb, boolean show returns nothing
  /*if ( show ) and ( lb == udg_ShareChatBoard ) then
    call TimerStart(udg_ShareChatTimer, SHARE_CHAT_TIME, true, null)
    call TimerStart(udg_ShareChatTimer2, 1., true, null)
    call LocalMtbM(p, bj_lastCreatedMultiboard, true)
    call PlayerSetLeaderboard(p, lb)
    call LeaderboardDisplay(lb, show)
  else
    if ( show ) then
      if ( GetLocalPlayer() == p ) then
        call LeaderboardDisplay(udg_ShareChatBoard, false)
      endif
      call PlayerSetLeaderboard(p, lb)
    endif
    */
    if ( GetLocalPlayer() == p ) then
      call LeaderboardDisplay(lb, show)
    endif
  //endif
endfunction
//call LocalLdbM(GetTriggerPlayer(), bj_lastCreatedLeaderboard, true)
//call LocalLdbM(GetTriggerPlayer(), udg_ShareChatBoard, true)

function GetTerrainZ takes real x, real y returns real
  call MoveLocation(udg_temp_l4_TERRAIN, x, y)
  return GetLocationZ(udg_temp_l4_TERRAIN)
endfunction
native EXSetEffectZ takes effect e, real z returns nothing
function GetEffectLoc takes widget t, integer i, integer lv returns nothing
 local integer A = 1
 local real ang = 360./lv
 local real x = GetWidgetX(t)
 local real y = GetWidgetY(t)
  if ( udg_SysA_EffectSimple ) then
    return
  endif
  if ( i == 1 ) then
    if ( lv <= 1 ) then
      call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Blizzard\\BlizzardTarget.mdl", x, y))
    else
      loop
        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Blizzard\\BlizzardTarget.mdl", x - 15*lv * Cos(ang*A*bj_DEGTORAD), y - 15*lv * Sin(ang*A*bj_DEGTORAD)))
	    exitwhen A >= lv
	    set A = A + 1
	  endloop
    endif
  elseif ( i == 2 ) then
      //땅
      loop
	    call DestroyEffect(AddSpecialEffect("abilities\\weapons\\catapult\\catapultmissile.mdl", x - 15*lv * Cos(ang*A*bj_DEGTORAD), y - 15*lv * Sin(ang*A*bj_DEGTORAD)))
	    exitwhen A >= lv
  	  set A = A + 1
	  endloop
  elseif ( i == 3 ) then
    if ( lv <= 1 ) then
      call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Monsoon\\MonsoonBoltTarget.mdl", x, y))
    else
      loop
        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Monsoon\\MonsoonBoltTarget.mdl", x - 15*lv * Cos(ang*A*bj_DEGTORAD), y - 15*lv * Sin(ang*A*bj_DEGTORAD)))
	    exitwhen A >= lv
	    set A = A + 1
	  endloop
    endif
  elseif ( i == 6 ) then
    if ( lv <= 1 ) then
      set bj_lastCreatedEffect = AddSpecialEffect("Units\\Demon\\Infernal\\InfernalBirth.mdl", x, y)
      call EXSetEffectSize(bj_lastCreatedEffect, 2.)
      call DestroyEffect(bj_lastCreatedEffect)
    endif
  elseif ( i == 7 ) then
    //세멜리아 등. 구양/달마/세멜
    if ( lv == 1 ) then
      call SetUnitAnimation(CreateUnit(Player(12), 'e014', x, y, bj_UNIT_FACING), "stand")
      call SetUnitAnimation(CreateUnit(Player(12), 'e014', x, y, GetRandomReal(0,360)), "stand")
    elseif ( lv == 2 ) then
      set bj_lastCreatedEffect = AddSpecialEffect("war3mapImported\\franksile 3.mdx", x, y)
      call EXSetEffectZ(bj_lastCreatedEffect, GetTerrainZ(x, y))
      call EXSetEffectSize(bj_lastCreatedEffect, 2.)
      call EXEffectMatRotateZ(bj_lastCreatedEffect, GetRandomReal(0., 360.))
      call DestroyEffect(bj_lastCreatedEffect)
    elseif ( lv == 3 ) then
      set bj_lastCreatedEffect = AddSpecialEffect("war3mapImported\\Reversoe_star(birth).MDX", x, y)
      call EXSetEffectZ(bj_lastCreatedEffect, 75.+GetTerrainZ(x, y))
      call EXSetEffectSize(bj_lastCreatedEffect, 1.5)
      call ED(bj_lastCreatedEffect, 2.)
    endif
  endif
endfunction
//call GetEffectLoc(udg_temp_u2, 7, 3)
function GetEffectUnit takes unit t, integer i, integer lv returns nothing
  if ( udg_SysA_EffectSimple ) then
    return
  endif
  if ( i == 1 ) then
  //수
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Blink\\BlinkTarget.mdl", t, "origin"))  
	  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\GryphonRiderMissile\\GryphonRiderMissileTarget.mdl", t, "origin"))
	  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl", t, "origin"))
	  if ( lv >= 2 ) then
        call DestroyEffect(AddSpecialEffectTarget("Effect\\StonEff.mdx", t, "chest"))
	    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\CrushingWave\\CrushingWaveDamage.mdl", t, "origin"))  
	    if ( lv >= 3 ) then
		  call DestroyEffect(AddSpecialEffectTarget("Effect\\StonEff.mdx", t, "hand right"))
		  call DestroyEffect(AddSpecialEffectTarget("Effect\\StonEff.mdx", t, "hand left"))
		  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\GryphonRiderMissile\\GryphonRiderMissileTarget.mdl", t, "hand left"))
		  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\GryphonRiderMissile\\GryphonRiderMissileTarget.mdl", t, "foot right"))
  	    endif
      endif
  elseif ( i == 2 ) then
    //토, 땅
  	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RockBoltMissile\\RockBoltMissile.mdl", t, "origin"))
      if ( lv >= 2 ) then
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RockBoltMissile\\RockBoltMissile.mdl", t, "overhead"))
	    if ( lv >= 3 ) then
  	    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RockBoltMissile\\RockBoltMissile.mdl", t, "chest"))
		  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RockBoltMissile\\RockBoltMissile.mdl", t, "hand right"))
		  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RockBoltMissile\\RockBoltMissile.mdl", t, "hand left"))
	    endif
	  endif
  elseif ( i == 3 ) then
      //풍
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Purge\\PurgeBuffTarget.mdl", t, "chest"))
	  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl", t, "chest"))
      if ( lv >= 2 ) then
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Purge\\PurgeBuffTarget.mdl", t, "head"))
        call DestroyEffect(AddSpecialEffectTarget("Effect\\Great Lightning.mdx", t, "chest"))
	    if ( lv >= 3 ) then
		  call DestroyEffect(AddSpecialEffectTarget("Effect\\Great Lightning.mdx", t, "hand right"))
  		call DestroyEffect(AddSpecialEffectTarget("Effect\\Great Lightning.mdx", t, "hand left"))
	    endif
	  endif
  elseif ( i == 4 ) then
  //화
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\BreathOfFire\\BreathOfFireDamage.mdl", t, "origin"))
	  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl", t, "head") )
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl", t, "chest") )
      if ( lv >= 2 ) then
  	  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", t, "origin"))
	    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\BreathOfFire\\BreathOfFireDamage.mdl", t, "chest"))
	    call DestroyEffect(AddSpecialEffectTarget("Effect\\FireNova.mdx", t, "chest"))
	    if ( lv >= 3 ) then
  	    call DestroyEffect(AddSpecialEffectTarget("Effect\\FireNova.mdx", t, "hand right"))
		  call DestroyEffect(AddSpecialEffectTarget("Effect\\FireNova.mdx", t, "hand left"))
		  call DestroyEffect(AddSpecialEffectTarget("Effect\\FireNova.mdx", t, "overhead"))
	      if ( lv >= 4 ) then
            call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Demon\\ReviveDemon\\ReviveDemon.mdl", t, "origin"))
          endif
        endif
      endif
  elseif ( i == 5 ) then
  //회복 (힐) 1샐브반짝이 1.8초 / 2뱀파릭 훔치기 / 3리쥬버 0.5 / 4힐 / 5홀라라이트 / 6힐링웨 / 7리저렉션타겟 // 8파장 / 9트랜퀄2.1초 / 10리저렉션캐스터
    if ( lv == 1 ) then
      call ED(AddSpecialEffectTarget("Abilities\\Spells\\Items\\HealingSalve\\HealingSalveTarget.mdl", t, "chest"), 1.)
    elseif ( lv == 2 ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl", t, "chest"))
    elseif ( lv == 3 ) then
      call ED(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Rejuvenation\\RejuvenationTarget.mdl", t, "chest"), 1.)
    elseif ( lv == 4 ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Heal\\HealTarget.mdl", t, "chest"))
    elseif ( lv == 5 ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl", t, "chest"))
    elseif ( lv == 6 ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\HealingWave\\HealingWaveTarget.mdl", t, "chest"))
    elseif ( lv == 7 ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", t, "origin"))
    elseif ( lv == 8 ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishHealth\\ReplenishHealthCaster.mdl", t, "origin"))
    elseif ( lv == 9 ) then
      call ED(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Tranquility\\Tranquility.mdl", t, "origin"), 1.)
    elseif ( lv == 10 ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", t, "origin"))
    endif
  endif
endfunction
//call GetEffectUnit(udg_temp_u2, 1(속성), 1(단계))

function Ping takes player p, real x, real y, real dur returns nothing
  if ( GetLocalPlayer() == p ) then
    if ( dur < 0 ) then
      call PingMinimapEx(x, y, -dur, 0, 255, 0, true)
    else
      call PingMinimap(x, y, dur)
    endif
    call SetCameraQuickPosition(x, y)
    call StartSound(gg_snd_MapPing)
  endif
endfunction

constant function FMi_Inven2 takes integer i returns integer
 //item code를 받아와 단축키로 반환. 여기에 해당되면( >0) 관련 액션 실행
  if ( i == 'afac' ) then
    return 2
  elseif ( i == 'ratc' ) then
    return 7
  elseif ( i == 'rat6' ) then
    return 8
  elseif ( i == 'odef' ) then
    return 4
  elseif ( i == 'rag1' ) then
    return 5
  elseif ( i == 'I08V' ) then
  //코마디움
    return 11
  elseif ( i == 'rlif' ) then
    return 77
  elseif ( i == 'ciri' ) then
    return 78
  elseif ( i == 'cnob' ) then
    return 74
  elseif ( i == 'rhth' ) then
    return 75
  elseif ( i == 'hcun' ) then
  //퀘속도 빠름
    return 75
  elseif ( i == 'belv' ) then
  //퀘속도 느림
    return 75    
  elseif ( i == 'prvt' ) then
    return 87
  elseif ( i == 'hval' ) then
    return 88
  //888 리콜 - (남)밀레스, 루어스 (성), 호엔, 뤼케, 아벨, 피엣, 여관, 마인
  elseif ( i == 'I00S' ) then
    return 888
  elseif ( i == 'I00U' ) then
    return 888
  elseif ( i == 'I00V' ) then
    return 888
  elseif ( i == 'I00W' ) then
    return 888
  elseif ( i == 'I00X' ) then
    return 888
  elseif ( i == 'I08I' ) then
    return 888
  elseif ( i == 'I07Y' ) then
    return 888
  elseif ( i == 'I083' ) then
    return 888

  elseif ( i == 'spsh' ) then
    return 84
  elseif ( i == 'mort' ) then
    return 85
  elseif ( i == 'pmna' ) then
    return 81
  elseif ( i == 'mcou' ) then
    return 47
  elseif ( i == 'ward' ) then
    return 48
  elseif ( i == 'penr' ) then 
    return 44
  elseif ( i == 'rst1' ) then
    return 45
  elseif ( i == 'rat9' ) then
    return 41
  elseif ( i == 'crys' ) then
    return 41
  elseif ( i == 'brac' ) then
    return 41

  elseif ( i == 'I09V' ) then
  //초보자 퀘스트
    return 11
  elseif ( i == 'lhst' ) then
    return 58
  elseif ( i == 'ajen' ) then
    return 54
  elseif ( i == 'bgst' ) then
    return 55
  elseif ( i == 'evtl' ) then
    return 51
  endif
 return 0
endfunction

function SetCameraBoundsXY takes real x, real y returns nothing
  call SetCameraBounds(x,y,x,y,x,y,x,y)
endfunction

function InvenClear takes integer P, integer slot returns nothing
  //call RemoveItem(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), slot))
  if ( slot <= FMI_MAXMAX_INVENTORY ) then
    if ( GetLocalPlayer() == Player(P-1) ) then
      call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", slot), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
      call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", slot), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
    endif
    call RemoveSavedBoolean(udg_hash, P, StringHash("bol") + slot)
    call RemoveSavedInteger(udg_hash, P, StringHash("itid") + slot)
    call RemoveSavedInteger(udg_hash, P, StringHash("itco") + slot)
  else
    if ( GetLocalPlayer() == Player(P-1) ) then
      call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotA", slot), "UI\\Console\\Human\\human-transport-slot.blp", 0)
      call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotB", slot), "UI\\Console\\Human\\human-transport-slot.blp", 0)
    endif
    call RemoveSavedBoolean(udg_hash, P, StringHash("Sbol") + slot)
    call RemoveSavedInteger(udg_hash, P, StringHash("Sitid") + slot)
    call RemoveSavedInteger(udg_hash, P, StringHash("Sitco") + slot)
  endif
  
  call RemoveSavedHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), slot)
endfunction
function MinusItem takes integer P, integer keyitem, integer c returns boolean
 local integer i = StringHash("FMi_Item"+I2S(P))
 local integer j = 1
  loop
    exitwhen j >= FMI_MAXMAX_INVENTORY
	if ( GetItemTypeId(LoadItemHandle(udg_hash, i, j)) == keyitem ) then
	  if ( GetItemCharges(LoadItemHandle(udg_hash, i, j)) > c ) then
        if ( c > 0 ) then
		  call MSG(Player(P-1), 2, 3., "|c00ffff00" + GetObjectName(keyitem) + "|r [" +I2S(GetItemCharges(LoadItemHandle(udg_hash, i, j))) + " |cffff0000-"+I2S(c)+"|r]")
        endif
	    call SetItemCharges(LoadItemHandle(udg_hash, i, j), GetItemCharges(LoadItemHandle(udg_hash, i, j))-c)
        return true
	  else
		call MSG(Player(P-1), 2, 3., "|cffff0000-" + GetObjectName(keyitem))
	    call RemoveItem(LoadItemHandle(udg_hash, i, j))
	    
        call InvenClear(P, j)
        return true
	  endif
	  exitwhen true
	endif
    set j = j + 1
  endloop
  return false
endfunction
//인벤토리에 keyitem을 c만큼 감소시킴. c보다 적으면 삭제.
//***************************************************************************
//*
//*  Triggers
//*
//***************************************************************************

//===========================================================================
// Trigger: Set Start
//===========================================================================
function Trig_Set_Start_Func006002001001 takes nothing returns boolean
    return ( GetPlayerController(GetFilterPlayer()) == MAP_CONTROL_USER )
endfunction

function Trig_Set_Start_Func006002001002 takes nothing returns boolean
    return ( GetPlayerSlotState(GetFilterPlayer()) == PLAYER_SLOT_STATE_PLAYING )
endfunction

function Trig_Set_Start_Func006002001 takes nothing returns boolean
    return GetBooleanAnd( Trig_Set_Start_Func006002001001(), Trig_Set_Start_Func006002001002() )
endfunction

function Trig_Set_Start_Func010A takes nothing returns nothing
    call TriggerRegisterPlayerChatEvent( gg_trg_Instruction_All, GetEnumPlayer(), "", false )
    set udg_SysB_Name[GetConvertedPlayerId(GetEnumPlayer())] = GetPlayerName(GetEnumPlayer())
    call TriggerRegisterPlayerEventLeave( gg_trg_Sys_Player_Left, GetEnumPlayer() )
    call DisplayTimedTextToPlayer( GetEnumPlayer(), 0.50, 0, 30,                            (BaseStr(8)+udg_temp_s) )
endfunction

function Trig_Set_Start_Func026A takes nothing returns nothing
    call FogModifierStart(CreateFogModifierRadius(GetEnumPlayer(), FOG_OF_WAR_VISIBLE, 28832, -22400, 2000., true, false))
    call TriggerRegisterPlayerSelectionEventBJ( gg_trg_Select_Novice, GetEnumPlayer(), true )
endfunction

function Trig_Set_Start_Func057A takes nothing returns nothing
    call CinematicModeBJ( false, udg_temp_pg )
    if ( FAL_isHasValue(FAL_GetMulti0(GetPlayerId(GetEnumPlayer())+1, 0, 0, 0)) ) then
      call MSG(GetEnumPlayer(),1,8,"\nLoad1: 당신은 |r-Load1" + BaseStr(11) + " 명령어를 사용하실 수 있습니다.")
    endif
endfunction

function Trig_Set_Start_Actions takes nothing returns nothing
    call SetOpLimit(1500000)
    call DzEnableWideScreen(true)
    call SetCameraBoundsXY(GetWidgetX(gg_unit_H017_0002), GetWidgetY(gg_unit_H017_0002))
    set udg_temp_pg = GetPlayersMatching(Condition(function Trig_Set_Start_Func006002001))
    call CinematicModeBJ( true, udg_temp_pg )
    set udg_SysA_COUNT = ( CountPlayersInForceBJ(udg_temp_pg) - 1 )
    set udg_temp_s =                            ("\n|cffffdc3c" + I2S(udg_SysA_COUNT+1) + "인 시작에 따른 경험치/드랍/골드 증가: " + I2S(udg_SysA_COUNT*SysInt(0,30))+"/"+I2S(udg_SysA_COUNT*SysInt(0,31))+"/"+I2S(udg_SysA_COUNT*SysInt(0,32))+"% (퀘스트 보상도 증가)")
    call ForForce( udg_temp_pg, function Trig_Set_Start_Func010A )
    call TriggerExecute( gg_trg_Set_Instruction )
    set udg_temp_u = gg_unit_H017_0002
    // 레벨업시 경험치 설정 부분
    call SetHeroLevelBJ( udg_temp_u, 99, false )
    set udg_temp_i = GetHeroXP(udg_temp_u)
    call SetHeroLevelBJ( udg_temp_u, 100, false )
    call SaveInteger(udg_hash, 99, StringHash("Exp1"), udg_temp_i)
    call SaveInteger(udg_hash, 100, StringHash("Exp1"), GetHeroXP(udg_temp_u))
    call SaveInteger(udg_hash, 100, StringHash("Exp2"), GetHeroXP(udg_temp_u)-udg_temp_i)
    call SetHeroLevelBJ( udg_temp_u, 1, false )
    // //
    call TriggerExecute( gg_trg_Set_Skill_Data )
    call CreateTimerDialogBJ( CreateTimerBJ(false, 600.00), ( "캐릭터 선택/로드시간" + "" ) )
    call TriggerRegisterTimerExpireEventBJ( gg_trg_Selcet_N_TD, GetLastCreatedTimerBJ() )
    call SaveTimerDialogHandleBJ( GetLastCreatedTimerDialogBJ(), StringHash("TEMP"), StringHash("Select Timer"), udg_hash )
    call ForForce( udg_temp_pg, function Trig_Set_Start_Func026A )
    call TriggerExecute( gg_trg_Set_FAL )
    call TriggerSleepAction( 0.10 )
    call TriggerExecute( gg_trg_Set_SaveItem )
    call TriggerSleepAction( 0.10 )
    call TriggerExecute( gg_trg_Set_Items )
    call TriggerSleepAction( 0.10 )
    call TriggerSleepAction( 0.10 )
    call TriggerExecute( gg_trg_Sys_Dmg_Add )
    call TriggerRegisterEnterRectSimple( gg_trg_Sys_Dmg_Add, GetPlayableMapRect() )
    call TriggerSleepAction( 0.10 )
    call TriggerExecute( gg_trg_Set_Monster )
    call TriggerSleepAction( 0.10 )
    call TriggerExecute( gg_trg_Set_Party )
    call TriggerSleepAction( 0.10 )
    call TriggerExecute( gg_trg_Set_NPC )
    call TriggerSleepAction( 0.10 )
    call TriggerExecute( gg_trg_Set_Drops )
    call TriggerSleepAction( 0.10 )
    call TriggerExecute( gg_trg_Set_Etc )
    call TriggerSleepAction( 0.10 )
    call TriggerSleepAction( 0.10 )
    call TriggerExecute( gg_trg_Set_Test )
    call TriggerSleepAction( 0.10 )
    call TriggerExecute( gg_trg_Set_SignBar )
    call TriggerSleepAction( 0.10 )
    call TriggerExecute( gg_trg_Set_Skin )
    call TriggerSleepAction( 1.00 )
    set udg_temp_l4_TERRAIN = Location(0.00, 0)
    call ForForce( udg_temp_pg, function Trig_Set_Start_Func057A )
    call FogEnableOff(  )
    call FogMaskEnableOff(  )
endfunction

//===========================================================================
function InitTrig_Set_Start takes nothing returns nothing
    set gg_trg_Set_Start = CreateTrigger(  )
    call TriggerRegisterTimerEventSingle( gg_trg_Set_Start, 0.00 )
    call TriggerAddAction( gg_trg_Set_Start, function Trig_Set_Start_Actions )
endfunction

//===========================================================================
// Trigger: Set Instruction
//
// TriggerPutSkill(gg_trg_, 'A02F') - 능력 효과 시작
// TriggerPutItem(gg_trg_, 'I000') - 아이템 사용
// TriggerPutItem2(gg_trg_, 'I000') - 아이템 습득 (중첩 가능)
//===========================================================================
function TriggerPutSkill takes trigger t, integer id returns nothing
  call SaveTriggerHandle(udg_hash, id, StringHash("PSkill"), t)
endfunction
function TriggerPutItem takes trigger t, integer id returns nothing
  call SaveTriggerHandle(udg_hash, id, StringHash("Pitem1"), t)
endfunction
function TriggerPutItem2 takes trigger t, integer id returns nothing
  call SaveTriggerHandle(udg_hash, id, StringHash("Pitem2"), t)
endfunction
function TriggerPutMsg takes trigger t, string s returns nothing
  call SaveTriggerHandle(udg_hash, StringHash(s), StringHash("I2T"), t)
endfunction

function AddEvent takes nothing returns nothing
  call TriggerRegisterPlayerUnitEvent(gg_trg_Use_Item, GetEnumPlayer(), EVENT_PLAYER_UNIT_USE_ITEM, null)
  call TriggerRegisterPlayerUnitEvent(gg_trg_FMi_Internal, GetEnumPlayer(), EVENT_PLAYER_UNIT_USE_ITEM, null)
  call TriggerRegisterPlayerUnitEvent(gg_trg_Use_Item2, GetEnumPlayer(), EVENT_PLAYER_UNIT_PICKUP_ITEM, null)
  call TriggerRegisterPlayerUnitEvent(gg_trg_FCS_Start_Cst, GetEnumPlayer(), EVENT_PLAYER_UNIT_SPELL_CAST, null)
  call TriggerRegisterPlayerUnitEvent(gg_trg_FCS_Stop_Cst, GetEnumPlayer(), EVENT_PLAYER_UNIT_SPELL_ENDCAST, null)
  call TriggerRegisterPlayerUnitEvent(gg_trg_FCS_End_Cst, GetEnumPlayer(), EVENT_PLAYER_UNIT_SPELL_EFFECT, null)
  call TriggerRegisterPlayerChatEvent(gg_trg_FSE_Load, GetEnumPlayer(), "-load ", false )
  debug call TriggerRegisterPlayerChatEvent(gg_trg_FSE_Load2, GetEnumPlayer(), "-load2 ", false )
  call TriggerRegisterPlayerChatEvent(gg_trg_Intr_Field_of_View, GetEnumPlayer(), "시야 ", false)
  call SaveInteger(udg_hash, StringHash("FoV"), GetPlayerId(GetEnumPlayer())+1, 1650)
  set udg_Quest_WaitTime[GetPlayerId(GetEnumPlayer())+1] = 1.1
endfunction
function AddEvent2 takes nothing returns nothing
  call TriggerRegisterPlayerChatEvent(gg_trg_Intr_Stats, GetEnumPlayer(), "-힘 ", false)
  call TriggerRegisterPlayerChatEvent(gg_trg_Intr_Stats, GetEnumPlayer(), "-덱 ", false)
  call TriggerRegisterPlayerChatEvent(gg_trg_Intr_Stats, GetEnumPlayer(), "-민 ", false)
  call TriggerRegisterPlayerChatEvent(gg_trg_Intr_Stats, GetEnumPlayer(), "-인 ", false)
  call TriggerRegisterPlayerChatEvent(gg_trg_Intr_Stats, GetEnumPlayer(), "-위 ", false)
  call TriggerRegisterPlayerChatEvent(gg_trg_Intr_Stats, GetEnumPlayer(), "-콘 ", false)
  call TriggerRegisterPlayerChatEvent(gg_trg_Intr_Stats, GetEnumPlayer(), "-gla ", false)
  call TriggerRegisterPlayerChatEvent(gg_trg_Intr_Stats, GetEnumPlayer(), "-epr ", false)
  call TriggerRegisterPlayerChatEvent(gg_trg_Intr_Stats, GetEnumPlayer(), "-als ", false)
  call TriggerRegisterPlayerChatEvent(gg_trg_Intr_Stats, GetEnumPlayer(), "-dls ", false)
  call TriggerRegisterPlayerChatEvent(gg_trg_Intr_Stats, GetEnumPlayer(), "-dnl ", false)
  call TriggerRegisterPlayerChatEvent(gg_trg_Intr_Stats, GetEnumPlayer(), "-zhs ", false)  
  call TriggerRegisterPlayerChatEvent(gg_trg_Intr_Stats, GetEnumPlayer(), "-str ", false)
  call TriggerRegisterPlayerChatEvent(gg_trg_Intr_Stats, GetEnumPlayer(), "-dex ", false)
  call TriggerRegisterPlayerChatEvent(gg_trg_Intr_Stats, GetEnumPlayer(), "-int ", false)
  call TriggerRegisterPlayerChatEvent(gg_trg_Intr_Stats, GetEnumPlayer(), "-wis ", false)
  call TriggerRegisterPlayerChatEvent(gg_trg_Intr_Stats, GetEnumPlayer(), "-con ", false)
endfunction
function Trig_Instruction_Set_Actions takes nothing returns nothing
 call DestroyTrigger(GetTriggeringTrigger())
  //명령어
  call SaveTriggerHandle(udg_hash, StringHash("-save1"), StringHash("I2T"), gg_trg_FSE_Save1)
  call SaveTriggerHandle(udg_hash, StringHash("-load1"), StringHash("I2T"), gg_trg_FAL_Load1)
  call SaveTriggerHandle(udg_hash, StringHash("-save"), StringHash("I2T"), gg_trg_FSE_Save)
  call SaveTriggerHandle(udg_hash, StringHash("1"), StringHash("I2T"), gg_trg_Quest_Type_All)
  call SaveTriggerHandle(udg_hash, StringHash("2"), StringHash("I2T"), gg_trg_Quest_Type_All)
  call SaveTriggerHandle(udg_hash, StringHash("3"), StringHash("I2T"), gg_trg_Quest_Type_All)
  call SaveTriggerHandle(udg_hash, StringHash("4"), StringHash("I2T"), gg_trg_Quest_Type_All)
  call SaveTriggerHandle(udg_hash, StringHash("5"), StringHash("I2T"), gg_trg_Quest_Type_All)
  call SaveTriggerHandle(udg_hash, StringHash("6"), StringHash("I2T"), gg_trg_Quest_Type_All)
  call SaveTriggerHandle(udg_hash, StringHash("7"), StringHash("I2T"), gg_trg_Quest_Type_All)
  call SaveTriggerHandle(udg_hash, StringHash("8"), StringHash("I2T"), gg_trg_Quest_Type_All)
  call SaveTriggerHandle(udg_hash, StringHash("9"), StringHash("I2T"), gg_trg_Quest_Type_All)
  call SaveTriggerHandle(udg_hash, StringHash("10"), StringHash("I2T"), gg_trg_Quest_Type_All)
  call SaveTriggerHandle(udg_hash, StringHash("11"), StringHash("I2T"), gg_trg_Quest_Type_All)
  call SaveTriggerHandle(udg_hash, StringHash("12"), StringHash("I2T"), gg_trg_Quest_Type_All)  
  call SaveTriggerHandle(udg_hash, StringHash("-정보"), StringHash("I2T"), gg_trg_Intr_Infomation)
  call TriggerSleepAction(.1)
  call SaveTriggerHandle(udg_hash, StringHash("-초보자"), StringHash("I2T"), gg_trg_Intr_Newbie)
  call SaveTriggerHandle(udg_hash, StringHash("-팁 끄기"), StringHash("I2T"), gg_trg_Intr_Tip_off)
  call SaveTriggerHandle(udg_hash, StringHash("-주사위"), StringHash("I2T"), gg_trg_Intr_Dice)
  call SaveTriggerHandle(udg_hash, StringHash("-인벤토리"), StringHash("I2T"), gg_trg_Intr_Inventory)
  call SaveTriggerHandle(udg_hash, StringHash("-버전"), StringHash("I2T"), gg_trg_Intr_Version)
  call SaveTriggerHandle(udg_hash, StringHash("-전직"), StringHash("I2T"), gg_trg_Intr_Jobs)
  call SaveTriggerHandle(udg_hash, StringHash("-직업"), StringHash("I2T"), gg_trg_Intr_Jobs)
  call SaveTriggerHandle(udg_hash, StringHash("-체력"), StringHash("I2T"), gg_trg_Intr_HPMP)
  call SaveTriggerHandle(udg_hash, StringHash("-마력"), StringHash("I2T"), gg_trg_Intr_HPMP)
  call SaveTriggerHandle(udg_hash, StringHash("-써클"), StringHash("I2T"), gg_trg_Intr_Circle)
  call SaveTriggerHandle(udg_hash, StringHash("-서클"), StringHash("I2T"), gg_trg_Intr_Circle)
  call SaveTriggerHandle(udg_hash, StringHash("-리콜"), StringHash("I2T"), gg_trg_Intr_Recall)
  call SaveTriggerHandle(udg_hash, StringHash("-쾌스트"), StringHash("I2T"), gg_trg_Intr_Quust)
  call SaveTriggerHandle(udg_hash, StringHash("-스텟"), StringHash("I2T"), gg_trg_Intr_Stat)
  call SaveTriggerHandle(udg_hash, StringHash("-사냥터"), StringHash("I2T"), gg_trg_Intr_Field)
  call SaveTriggerHandle(udg_hash, StringHash("-경험치"), StringHash("I2T"), gg_trg_Intr_Exp)
  call SaveTriggerHandle(udg_hash, StringHash("-스킵"), StringHash("I2T"), gg_trg_Intr_Q_Skip)
  call SaveTriggerHandle(udg_hash, StringHash("-스킬"), StringHash("I2T"), gg_trg_Intr_Skill)
  call SaveTriggerHandle(udg_hash, StringHash("-tmzlq"), StringHash("I2T"), gg_trg_Intr_Q_Skip)
  call SaveTriggerHandle(udg_hash, StringHash("-퀘속도 1"), StringHash("I2T"), gg_trg_Intr_Q_Speed)
  call SaveTriggerHandle(udg_hash, StringHash("-퀘속도 2"), StringHash("I2T"), gg_trg_Intr_Q_Speed)
  call SaveTriggerHandle(udg_hash, StringHash("-퀘속도 3"), StringHash("I2T"), gg_trg_Intr_Q_Speed)
  call SaveTriggerHandle(udg_hash, StringHash("-퀘스트"), StringHash("I2T"), gg_trg_Intr_Quest_Helper)
  call TriggerSleepAction(.1)
  call SaveTriggerHandle(udg_hash, StringHash("-고정"), StringHash("I2T"), gg_trg_Intr_FixCam)
  call SaveTriggerHandle(udg_hash, StringHash("푸잎님 사랑해요"), StringHash("I2T"), gg_trg_Intr_Love_fooiff)
  call SaveTriggerHandle(udg_hash, StringHash("love fooiff"), StringHash("I2T"), gg_trg_Intr_Love_fooiff)
  call SaveTriggerHandle(udg_hash, StringHash("-오픈채팅"), StringHash("I2T"), gg_trg_Intr_Link)
  call SaveTriggerHandle(udg_hash, StringHash("-리셋"), StringHash("I2T"), gg_trg_Intr_Reset)
  call SaveTriggerHandle(udg_hash, StringHash("전직"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  call SaveTriggerHandle(udg_hash, StringHash("환골탈태"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  call SaveTriggerHandle(udg_hash, StringHash("체력"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  call SaveTriggerHandle(udg_hash, StringHash("마력"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  call SaveTriggerHandle(udg_hash, StringHash("승급"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  call SaveTriggerHandle(udg_hash, StringHash("스텟"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  
  call SaveTriggerHandle(udg_hash, StringHash("힘"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  call SaveTriggerHandle(udg_hash, StringHash("덱"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  call SaveTriggerHandle(udg_hash, StringHash("민"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  call SaveTriggerHandle(udg_hash, StringHash("인"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  call SaveTriggerHandle(udg_hash, StringHash("위"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  call SaveTriggerHandle(udg_hash, StringHash("콘"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  
  call TriggerSleepAction(.1)
  call SaveTriggerHandle(udg_hash, StringHash("체력 all"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  call SaveTriggerHandle(udg_hash, StringHash("마력 all"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  call SaveTriggerHandle(udg_hash, StringHash("힘 all"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  call SaveTriggerHandle(udg_hash, StringHash("덱 all"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  call SaveTriggerHandle(udg_hash, StringHash("민 all"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  call SaveTriggerHandle(udg_hash, StringHash("인 all"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  call SaveTriggerHandle(udg_hash, StringHash("위 all"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  call SaveTriggerHandle(udg_hash, StringHash("콘 all"), StringHash("I2T"), gg_trg_Intr_Type_HPMP)
  
  call SaveTriggerHandle(udg_hash, StringHash("-수동스텟"), StringHash("I2T"), gg_trg_Intr_AutoStat)
  call SaveTriggerHandle(udg_hash, StringHash("-자동스텟"), StringHash("I2T"), gg_trg_Intr_AutoStat)
  call SaveTriggerHandle(udg_hash, StringHash("-카페"), StringHash("I2T"), gg_trg_Intr_Cafe)
  call SaveTriggerHandle(udg_hash, StringHash("-최소화"), StringHash("I2T"), gg_trg_Intr_MTSmall)
  call SaveTriggerHandle(udg_hash, StringHash("-이펙트"), StringHash("I2T"), gg_trg_Intr_Effect_Off)
  call SaveTriggerHandle(udg_hash, StringHash("-난이도"), StringHash("I2T"), gg_trg_Intr_MapLevelUp)
  
  call SaveTriggerHandle(udg_hash, StringHash("-스킨"), StringHash("I2T"), gg_trg_Intr_Skin)
  
  call TriggerSleepAction(.1)
  //아이템
  /*call SaveTriggerHandle(udg_hash, 'gold', StringHash("Pitem2"), gg_trg_Sys_Gold_Get)
  call SaveTriggerHandle(udg_hash, 'gol2', StringHash("Pitem2"), gg_trg_Sys_Gold_Get)
  call SaveTriggerHandle(udg_hash, 'gol3', StringHash("Pitem2"), gg_trg_Sys_Gold_Get)
*/
  call ForForce(udg_temp_pg, function AddEvent)
  call TriggerSleepAction(1.)
  call ForForce(udg_temp_pg, function AddEvent2)
endfunction

//===========================================================================
function InitTrig_Set_Instruction takes nothing returns nothing
    set gg_trg_Set_Instruction = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Set_Instruction, function Trig_Instruction_Set_Actions )
endfunction

//===========================================================================
// Trigger: Set Skill Data
//
// SR.0BO	- 스킬,R스킬,0초,B-물리스킬,O-팟임
// MWQ4CX	- 마법,W-Q스킬,4초,C-저주,일반스킬임
// Z-모든 마법(중첩가능)
// A-무속성
// B-물리스킬
// C-저주
// D-水_물속성 (마법)
// E-土_땅속성
// F-風_풍속성
// G-火_화속성
// H-光_빛속성
// I-暗_암속성
// J-중독류 도트데미지
// K-힐류
// L-축복류 (남에게 거는)
// M-기타 (센서스 등)
// O - 단일마법 (기존 DEFGHIJ 통합)
// P - 범위마법 / 전체마법
//===========================================================================
function Trig_Set_Data_Actions takes nothing returns nothing
 local integer i = 1
  //스킬 데이터
  set udg_FSE_Skill[0] = 125
  set udg_FSE_Skill[1] = 'A010'
  set udg_FSE_Skill[2] = 'A02F'
  set udg_FSE_Skill[3] = 'A007'
  set udg_FSE_Skill[4] = 'A01H'
  set udg_FSE_Skill[5] = 'A00A'
  set udg_FSE_Skill[6] = 'A02L'
  set udg_FSE_Skill[7] = 'A02P'
  set udg_FSE_Skill[8] = 'A02N'
  set udg_FSE_Skill[9] = 'A03D' /* 크래셔 */
  set udg_FSE_Skill[10] = 'A03R'
  set udg_FSE_Skill[11] = 'A04O'
  set udg_FSE_Skill[12] = 'A04P'
  set udg_FSE_Skill[13] = 'A06E'
  set udg_FSE_Skill[14] = 'A06L'
  // //도적
  set udg_FSE_Skill[16] = 'A02H'
  set udg_FSE_Skill[17] = 'A01J'
  set udg_FSE_Skill[18] = 'A00C'
  set udg_FSE_Skill[19] = 'A009'
  set udg_FSE_Skill[20] = 'A01I'
  set udg_FSE_Skill[21] = 'A00F'
  set udg_FSE_Skill[22] = 'A03O'
  set udg_FSE_Skill[23] = 'A049'
  set udg_FSE_Skill[24] = 'A04L'
  set udg_FSE_Skill[25] = 'A04T'
  set udg_FSE_Skill[26] = 'A04J'
  // //법사
  set udg_FSE_Skill[27] = 'A008'
  set udg_FSE_Skill[28] = 'A020'
  set udg_FSE_Skill[29] = 'A021'
  set udg_FSE_Skill[30] = 'A022'
  set udg_FSE_Skill[31] = 'A01O'
  set udg_FSE_Skill[32] = 'A025'
  set udg_FSE_Skill[33] = 'A026'
  set udg_FSE_Skill[34] = 'A027'
  set udg_FSE_Skill[35] = 'A028'
  set udg_FSE_Skill[36] = 'A029'
  set udg_FSE_Skill[37] = 'A01V'
  set udg_FSE_Skill[38] = 'A02Q'
  set udg_FSE_Skill[39] = 'A02W'
  set udg_FSE_Skill[40] = 'A02X'
  call TriggerSleepAction(0.01)
  set udg_FSE_Skill[41] = 'A02Y'
  set udg_FSE_Skill[42] = 'A02T'
  set udg_FSE_Skill[43] = 'A00J'
  set udg_FSE_Skill[44] = 'A03J'
  set udg_FSE_Skill[45] = 'A03L'
  set udg_FSE_Skill[46] = 'A03M'
  set udg_FSE_Skill[47] = 'A03N'
  set udg_FSE_Skill[48] = 'A00Z'
  set udg_FSE_Skill[49] = 'A043'
  set udg_FSE_Skill[50] = 'A044'
  set udg_FSE_Skill[51] = 'A045'
  set udg_FSE_Skill[52] = 'A046'
  set udg_FSE_Skill[53] = 'A07O'
  set udg_FSE_Skill[54] = 'A063'
  set udg_FSE_Skill[55] = 'A066'
  set udg_FSE_Skill[56] = 'A067'
  set udg_FSE_Skill[57] = 'A068'
  set udg_FSE_Skill[58] = 'A07R'
  set udg_FSE_Skill[59] = 'A076'
  set udg_FSE_Skill[60] = 'A077'
  set udg_FSE_Skill[61] = 'A078'
  set udg_FSE_Skill[62] = 'A01P'
  // //직자
  set udg_FSE_Skill[63] = 'A00V'
  set udg_FSE_Skill[64] = 'A024'
  set udg_FSE_Skill[65] = 'A01N'
  set udg_FSE_Skill[66] = 'A01Y'
  set udg_FSE_Skill[67] = 'A02D'
  set udg_FSE_Skill[68] = 'A01X'
  set udg_FSE_Skill[69] = 'A02Z'
  set udg_FSE_Skill[70] = 'A030'
  set udg_FSE_Skill[71] = 'A04G'
  set udg_FSE_Skill[72] = 'A031'
  set udg_FSE_Skill[73] = 'A032'
  set udg_FSE_Skill[74] = 'A048'
  set udg_FSE_Skill[75] = 'A04H'
  set udg_FSE_Skill[76] = 'A058'
  set udg_FSE_Skill[77] = 'A059'
  set udg_FSE_Skill[78] = 'A05C'
  set udg_FSE_Skill[79] = 'A05D'
  set udg_FSE_Skill[80] = 'A05F'
  call TriggerSleepAction(0.01)
  set udg_FSE_Skill[81] = 'A05H'
  //(소모니아)
  set udg_FSE_Skill[83] = 'A05M'
  set udg_FSE_Skill[84] = 'A05P'
  set udg_FSE_Skill[85] = 'A07E'
  set udg_FSE_Skill[86] = 'A074'
  set udg_FSE_Skill[87] = 'A075'
  set udg_FSE_Skill[88] = 'A07T'
  set udg_FSE_Skill[89] = 'A08W'
  // //도가
  set udg_FSE_Skill[90] = 'A00X'
  set udg_FSE_Skill[91] = 'A00Y'
  set udg_FSE_Skill[92] = 'A01K'
  set udg_FSE_Skill[93] = 'A07X'
  set udg_FSE_Skill[94] = 'A01L'
  set udg_FSE_Skill[95] = 'A02M'
  set udg_FSE_Skill[96] = 'A035'
  set udg_FSE_Skill[97] = 'A080'
  set udg_FSE_Skill[98] = 'A03F'
  set udg_FSE_Skill[99] = 'A03H'
  set udg_FSE_Skill[100] = 'A034'
  set udg_FSE_Skill[101] = 'A04B'
  set udg_FSE_Skill[102] = 'A083'
  call TriggerSleepAction(0.01)
  set udg_FSE_Skill[103] = 'A04Y'
  set udg_FSE_Skill[104] = 'A04Z'
  set udg_FSE_Skill[105] = 'A050'
  set udg_FSE_Skill[106] = 'A069'
  set udg_FSE_Skill[107] = 'A07B'
  set udg_FSE_Skill[108] = 'A084'
  set udg_FSE_Skill[109] = 'A085'
  set udg_FSE_Skill[110] = 'A01W'
  set udg_FSE_Skill[111] = 'A02A'
  set udg_FSE_Skill[112] = 'A02U'
  set udg_FSE_Skill[113] = 'A02O'
  set udg_FSE_Skill[114] = 'A002'
  set udg_FSE_Skill[115] = 'A01U'
  set udg_FSE_Skill[116] = 'A04F'
  set udg_FSE_Skill[117] = 'A05U'
  set udg_FSE_Skill[118] = 'A05V'
  set udg_FSE_Skill[119] = 'A09X'
  set udg_FSE_Skill[120] = 'A09Y'
  set udg_FSE_Skill[121] = 'A09Z'
  set udg_FSE_Skill[122] = 'A0A1'
  set udg_FSE_Skill[123] = 'A0A4'
  set udg_FSE_Skill[124] = 'A0A7'
  set udg_FSE_Skill[125] = 'A0AA'
  call TriggerSleepAction(0.01)
  
  set i = 1
  loop
    call SaveInteger(udg_hash, StringHash("Skill"), udg_FSE_Skill[i], i)
    exitwhen i == udg_FSE_Skill[0]
    set i = i + 1
    if ( i == 40 ) or ( i == 80 ) or ( i == 120 ) then
      call TriggerSleepAction(0.01)
    endif
  endloop
  
  call TriggerSleepAction(0.01)
  call SaveStr(udg_hash, 1, 60, "01003003003003003D00")
  call SaveStr(udg_hash, 2, 60, "21003003003003003W00")
  call SaveStr(udg_hash, 3, 60, "21010003003003006Q00")
  call SaveStr(udg_hash, 4, 60, "22016003003003010F00")
  call SaveStr(udg_hash, 5, 60, "22032003003003024W10")
  call SaveStr(udg_hash, 6, 60, "23046003003003040F10")
  call SaveStr(udg_hash, 7, 60, "23062003003003054E10")
  call SaveStr(udg_hash, 8, 60, "23071003003003058Q10")
  call SaveStr(udg_hash, 9, 60, "25099003003003073D10")
  call SaveStr(udg_hash, 10, 60, "24092003003003065R10")
  call SaveStr(udg_hash, 11, 60, "24076003003003060D10")
  call SaveStr(udg_hash, 12, 60, "24093003003003067D30")
  call SaveStr(udg_hash, 13, 60, "25094003003003069D10")
  call SaveStr(udg_hash, 14, 60, "25099003003003071D20")
  call SaveStr(udg_hash, 16, 60, "31003003003003003Q00")
  call SaveStr(udg_hash, 17, 60, "32006004003003003W00")
  call SaveStr(udg_hash, 18, 60, "32008006003003003R10")
  call SaveStr(udg_hash, 19, 60, "32018012003003003Q10")
  call SaveStr(udg_hash, 20, 60, "33020018003003003F00")
  call SaveStr(udg_hash, 21, 60, "34038032003003003E20")
  call SaveStr(udg_hash, 22, 60, "34046040003003003T20")
  call SaveStr(udg_hash, 23, 60, "33003008015003003D00")
  call SaveStr(udg_hash, 24, 60, "33003012018012003D10")
  call SaveStr(udg_hash, 25, 60, "33003003020014003D10")
  call SaveStr(udg_hash, 26, 60, "35080055003003003W10")
  call SaveStr(udg_hash, 27, 60, "41003003003003003Q00")
  call SaveStr(udg_hash, 28, 60, "42003003014009003Q00")
  call SaveStr(udg_hash, 29, 60, "42003003014009003Q00")
  call SaveStr(udg_hash, 30, 60, "42003003014009003Q00")
  call SaveStr(udg_hash, 31, 60, "42003003012007003W00")
  call SaveStr(udg_hash, 32, 60, "42003003025017003E10")
  call SaveStr(udg_hash, 33, 60, "42003003025017003E10")
  call SaveStr(udg_hash, 34, 60, "42003003025017003E10")
  call SaveStr(udg_hash, 35, 60, "42003003025017003E10")
  call SaveStr(udg_hash, 36, 60, "43003003043031003F00")
  call SaveStr(udg_hash, 37, 60, "43003003044034003W10")
  call SaveStr(udg_hash, 38, 60, "43003003046037003Q10")
  call SaveStr(udg_hash, 39, 60, "43003003046037003Q10")
  call SaveStr(udg_hash, 40, 60, "43003003046037003Q10")
  call TriggerSleepAction(0.01)
  call SaveStr(udg_hash, 41, 60, "43003003046037003Q10")
  call SaveStr(udg_hash, 42, 60, "43003003056049003R10")
  call SaveStr(udg_hash, 43, 60, "44003003074065003W10")
  call SaveStr(udg_hash, 44, 60, "44003003076063003Q10")
  call SaveStr(udg_hash, 45, 60, "44003003076063003Q10")
  call SaveStr(udg_hash, 46, 60, "44003003076063003Q10")
  call SaveStr(udg_hash, 47, 60, "44003003076063003Q10")
  call SaveStr(udg_hash, 48, 60, "45003003099080003W10")
  call SaveStr(udg_hash, 49, 60, "43003003059049003E20")
  call SaveStr(udg_hash, 50, 60, "43003003059049003E20")
  call SaveStr(udg_hash, 51, 60, "43003003059049003E20")
  call SaveStr(udg_hash, 52, 60, "43003003059049003E20")
  call SaveStr(udg_hash, 53, 60, "44003003088069003F10")
  call SaveStr(udg_hash, 54, 60, "44003003092071003T20")
  call SaveStr(udg_hash, 55, 60, "44003003092071003T20")
  call SaveStr(udg_hash, 56, 60, "44003003092071003T20")
  call SaveStr(udg_hash, 57, 60, "44003003092071003T20")
  call SaveStr(udg_hash, 58, 60, "45003003099080003F20")
  call SaveStr(udg_hash, 59, 60, "45003003101077003Q00")
  call SaveStr(udg_hash, 60, 60, "45003003102077003E10")
  call SaveStr(udg_hash, 61, 60, "45003003103077003E20")
  call SaveStr(udg_hash, 62, 60, "45003003104077003T20")
  call SaveStr(udg_hash, 63, 60, "51003003003003003Q00")
  call SaveStr(udg_hash, 64, 60, "51003003009005003W00")
  call SaveStr(udg_hash, 65, 60, "52003003013009003E00")
  call SaveStr(udg_hash, 66, 60, "52003003017012003Q10")
  call SaveStr(udg_hash, 67, 60, "52003003023016003W10")
  call SaveStr(udg_hash, 68, 60, "52003003028020003F10")
  call SaveStr(udg_hash, 69, 60, "52003003035028003R00")
  call SaveStr(udg_hash, 70, 60, "53003003045032003Q10")
  call SaveStr(udg_hash, 71, 60, "53003003049036003W10")
  call SaveStr(udg_hash, 72, 60, "53003003053044003F20")
  call SaveStr(udg_hash, 73, 60, "53003003053045003T20")
  call SaveStr(udg_hash, 74, 60, "53003003058050003D10")
  call SaveStr(udg_hash, 75, 60, "54003003079067003W10")
  call SaveStr(udg_hash, 76, 60, "53003003069055003D10")
  call SaveStr(udg_hash, 77, 60, "53003003070060003E10")
  call SaveStr(udg_hash, 78, 60, "54003003072064003D10")
  call SaveStr(udg_hash, 79, 60, "54003003078065003Q10")
  call SaveStr(udg_hash, 80, 60, "54003003084067003D20")
  call TriggerSleepAction(0.01)
  call SaveStr(udg_hash, 81, 60, "54003003087068003F20")
  call SaveStr(udg_hash, 83, 60, "54003003093073003D10")
  call SaveStr(udg_hash, 84, 60, "54003003096075003D10")
  call SaveStr(udg_hash, 85, 60, "55003003099080003D10")
  call SaveStr(udg_hash, 86, 60, "55003003101077003Q10")
  call SaveStr(udg_hash, 87, 60, "55003003102077003F20")
  call SaveStr(udg_hash, 88, 60, "55003003103077003D20")
  call SaveStr(udg_hash, 89, 60, "55003003104077003D20")
  call SaveStr(udg_hash, 90, 60, "61007003003003004Q00")
  call SaveStr(udg_hash, 91, 60, "62011003003003008W00")
  call SaveStr(udg_hash, 92, 60, "62016003003003014F00")
  call SaveStr(udg_hash, 93, 60, "62020003003003017F10")
  call SaveStr(udg_hash, 94, 60, "63023003003003019E10")
  call SaveStr(udg_hash, 95, 60, "63025003003003022T20")
  call SaveStr(udg_hash, 96, 60, "64039003003003028R10")
  call SaveStr(udg_hash, 97, 60, "64047003003003032F10")
  call SaveStr(udg_hash, 98, 60, "62003003013010003D10")
  call SaveStr(udg_hash, 99, 60, "63003003023020003D10")
  call SaveStr(udg_hash, 100, 60, "63003003028024003D10") 
  call SaveStr(udg_hash, 101, 60, "63003003030026003D10")
  call SaveStr(udg_hash, 102, 60, "64050003003003035F20")
  call SaveStr(udg_hash, 103, 60, "64003003036028003D10")
  call SaveStr(udg_hash, 104, 60, "64003003039029003D10")
  call SaveStr(udg_hash, 105, 60, "64003003042031003D10")
  call SaveStr(udg_hash, 106, 60, "65003003049034003D10")
  call SaveStr(udg_hash, 107, 60, "65003003053037003D10")
  call SaveStr(udg_hash, 108, 60, "65053003003003035F20")
  call SaveStr(udg_hash, 109, 60, "65048003003003039F10")
  call SaveStr(udg_hash, 110, 60, "26003003003003003F11")
  call SaveStr(udg_hash, 111, 60, "26003003003003003T11")
  call SaveStr(udg_hash, 112, 60, "36003003003003003R11")
  call SaveStr(udg_hash, 113, 60, "36003003003003003F11")
  call SaveStr(udg_hash, 114, 60, "56003003003003003Q11")
  call SaveStr(udg_hash, 115, 60, "56003003003003003T12")
  call SaveStr(udg_hash, 116, 60, "46003003003003003T11")
  call SaveStr(udg_hash, 117, 60, "66003003003003003W11")
  call SaveStr(udg_hash, 118, 60, "52003003017012003T00")
  
  /*18 - 선행스킬
  19 - 승급스킬*/
  call SaveStr(udg_hash, 119, 60, "26152014016014090Q11")
  call SaveStr(udg_hash, 120, 60, "26150020010010092W11")
  call SaveStr(udg_hash, 121, 60, "26150020010010092E11")
  call SaveStr(udg_hash, 122, 60, "26090003003003070D11")
  call SaveStr(udg_hash, 123, 60, "26148010012008080D11")
  call SaveStr(udg_hash, 124, 60, "26003003003003003D12")
  call SaveStr(udg_hash, 125, 60, "26003003003003003D12")

  call TriggerSleepAction(0.01)
  call SaveStr(udg_hash, 'A02U', 67, "SR.0BO")
  call SaveStr(udg_hash, 'A02A', 67, "ST.0BO")
  call SaveStr(udg_hash, 'A02M', 67, "ST.0BX")
  call SaveStr(udg_hash, 'A035', 67, "SR.0BX")
  call SaveStr(udg_hash, 'A02F', 67, "SW.0BX")
  call SaveStr(udg_hash, 'A03O', 67, "ST.0BX")
  call SaveStr(udg_hash, 'A00C', 67, "SR.0MX")
  call SaveStr(udg_hash, 'A04J', 67, "SW.0BX")
  call SaveStr(udg_hash, 'A00A', 67, "SW.0BX")
   call SaveStr(udg_hash, 'A09Y', 67, "SW.0BX")
  call SaveStr(udg_hash, 'A00Y', 67, "SW.0MX")
  call SaveStr(udg_hash, 'A03R', 67, "SR.0MX")
  call SaveStr(udg_hash, 'A01K', 67, "SF.0JX")
  call SaveStr(udg_hash, 'A01J', 67, "SW.0BX")
  call SaveStr(udg_hash, 'A05U', 67, "SW.0BX")
  call SaveStr(udg_hash, 'A00X', 67, "SQ.0BX")
  call SaveStr(udg_hash, 'A00F', 67, "SE.0BX")
  call SaveStr(udg_hash, 'A007', 67, "SQ.0MX")
  call SaveStr(udg_hash, 'A02P', 67, "SE.0BX")
  call SaveStr(udg_hash, 'A09Z', 67, "SE.0BX")
  call SaveStr(udg_hash, 'A02N', 67, "SQ.0MX")
   call SaveStr(udg_hash, 'A09X', 67, "SQ.0MX")
  call SaveStr(udg_hash, 'A01L', 67, "SE.0BX")
  call SaveStr(udg_hash, 'A02H', 67, "SQ.0BX")
  call SaveStr(udg_hash, 'A009', 67, "SQ.0MX")
    // in Magics
  call SaveStr(udg_hash, 'A02T', 67, "MR.4MX")
   call SaveStr(udg_hash, 'A09A', 67, "MZR4MX")
  call SaveStr(udg_hash, 'A00J', 67, "MW.3CX")
  call SaveStr(udg_hash, 'A04G', 67, "MW.2LX")
  call SaveStr(udg_hash, 'A024', 67, "MW.2LX")
  call SaveStr(udg_hash, 'A02D', 67, "MW.2LX")
  call SaveStr(udg_hash, 'A04H', 67, "MW.2LX")
   call SaveStr(udg_hash, 'A09J', 67, "MZW2LX")
  call SaveStr(udg_hash, 'A01O', 67, "MW.2CX")
  call SaveStr(udg_hash, 'A063', 67, "MT.4PX")
  call SaveStr(udg_hash, 'A03J', 67, "MQ.2OX")
  call SaveStr(udg_hash, 'A008', 67, "MQ.2OX")
  call SaveStr(udg_hash, 'A02Q', 67, "MQ.2OX")
  call SaveStr(udg_hash, 'A01V', 67, "MW.2CX")
  call SaveStr(udg_hash, 'A029', 67, "MF.4JX")
  call SaveStr(udg_hash, 'A067', 67, "MT.4PX")
  call SaveStr(udg_hash, 'A03M', 67, "MQ.2OX")
  call SaveStr(udg_hash, 'A021', 67, "MQ.2OX")
  call SaveStr(udg_hash, 'A02X', 67, "MQ.2OX")
  call SaveStr(udg_hash, 'A043', 67, "ME.3PX")
  call SaveStr(udg_hash, 'A045', 67, "ME.3PX")
  call SaveStr(udg_hash, 'A075', 67, "MF.3KX")
   call SaveStr(udg_hash, 'A09Q', 67, "MZZ3KX")
  call SaveStr(udg_hash, 'A044', 67, "ME.3PX")
  call SaveStr(udg_hash, 'A046', 67, "ME.3PX")
  call SaveStr(udg_hash, 'A05H', 67, "MF.3KX")
  call SaveStr(udg_hash, 'A031', 67, "MF.3KX")
  call TriggerSleepAction(0.01)
  call SaveStr(udg_hash, 'A01X', 67, "MF.3KX")
  call SaveStr(udg_hash, 'A010', 67, "MD.0KX")
  call SaveStr(udg_hash, 'A03L', 67, "MQ.2OX")
  call SaveStr(udg_hash, 'A066', 67, "MT.4PX")
  call SaveStr(udg_hash, 'A020', 67, "MQ.2OX")
  call SaveStr(udg_hash, 'A02W', 67, "MQ.2OX")
  call SaveStr(udg_hash, 'A00Z', 67, "MW.3CX")
   call SaveStr(udg_hash, 'A098', 67, "MZW3CX")
  call SaveStr(udg_hash, 'A03N', 67, "MQ.2OX")
  call SaveStr(udg_hash, 'A022', 67, "MQ.2OX")
  call SaveStr(udg_hash, 'A02Y', 67, "MQ.2OX")
  call SaveStr(udg_hash, 'A068', 67, "MT.4PX")
  call SaveStr(udg_hash, 'A01U', 67, "MT.9HO")
  call SaveStr(udg_hash, 'A032', 67, "MT.3KX")
  call SaveStr(udg_hash, 'A05V', 67, "MT.3KX")
  call SaveStr(udg_hash, 'A01N', 67, "ME.2LX")
  call SaveStr(udg_hash, 'A025', 67, "ME.3PX")
  call SaveStr(udg_hash, 'A059', 67, "ME.2LX")
   call SaveStr(udg_hash, 'A09K', 67, "MZE7LX")
  call SaveStr(udg_hash, 'A027', 67, "ME.3PX")
  call SaveStr(udg_hash, 'A05D', 67, "MQ.2KX")
  call SaveStr(udg_hash, 'A026', 67, "ME.3PX")
  call SaveStr(udg_hash, 'A028', 67, "ME.3PX")
  call SaveStr(udg_hash, 'A02Z', 67, "MR.2LX")
  call SaveStr(udg_hash, 'A074', 67, "MQ.2KX")
   call SaveStr(udg_hash, 'A09I', 67, "MZQ2KX")
  call SaveStr(udg_hash, 'A01Y', 67, "MQ.2KX")
  call SaveStr(udg_hash, 'A030', 67, "MQ.2KX")
  call SaveStr(udg_hash, 'A00V', 67, "MQ.2KX")
  call SaveStr(udg_hash, 'A002', 67, "MQ.2KX")
    // in Books
  call SaveStr(udg_hash, 'A03A', 67, "MDE0MX")
  call SaveStr(udg_hash, 'A03Y', 67, "MDE0MX")
  call SaveStr(udg_hash, 'A053', 67, "MDS0MX")
  call SaveStr(udg_hash, 'A054', 67, "MDS0MX")
  call SaveStr(udg_hash, 'A07V', 67, "SFS0BX")
  call SaveStr(udg_hash, 'A07D', 67, "MDZ5AX")
  call SaveStr(udg_hash, 'A037', 67, "SFA0BX")
  call SaveStr(udg_hash, 'A04V', 67, "SFA0BX")
  call SaveStr(udg_hash, 'A07Q', 67, "MFE6JO")
   call SaveStr(udg_hash, 'A09H', 67, "MZC6JO")
  call SaveStr(udg_hash, 'A03S', 67, "SDW0MX")
  call SaveStr(udg_hash, 'A06D', 67, "SDW0MX")
  call SaveStr(udg_hash, 'A08A', 67, "MTA5IO")
   call SaveStr(udg_hash, 'A09E', 67, "MZF5IO")
  call SaveStr(udg_hash, 'A03I', 67, "MTA5IO")
  call SaveStr(udg_hash, 'A05B', 67, "MDE4MX")
  call SaveStr(udg_hash, 'A05E', 67, "MDE4MX")
   call SaveStr(udg_hash, 'A09N', 67, "MZS4MX")
  call SaveStr(udg_hash, 'A08Y', 67, "MDZ2MX")
  call SaveStr(udg_hash, 'A08Z', 67, "MDZ2MX")
   call SaveStr(udg_hash, 'A09R', 67, "MZX2MX")
  call SaveStr(udg_hash, 'A05G', 67, "MDR2MX")
  call SaveStr(udg_hash, 'A05I', 67, "MDR2MX")
   call SaveStr(udg_hash, 'A09M', 67, "MZA2MX")
  call SaveStr(udg_hash, 'A07G', 67, "MDF2MX")
  call TriggerSleepAction(0.01)
  call SaveStr(udg_hash, 'A08X', 67, "MDF2MX")
   call SaveStr(udg_hash, 'A09P', 67, "MZF2MX")
  call SaveStr(udg_hash, 'A086', 67, "MTQ4PX")
   call SaveStr(udg_hash, 'A09B', 67, "MZA4PX")
  call SaveStr(udg_hash, 'A07A', 67, "MQQ2OX")
   call SaveStr(udg_hash, 'A097', 67, "MZQ2OX")
  call SaveStr(udg_hash, 'A06K', 67, "SDA0MX")
   call SaveStr(udg_hash, 'A03C', 67, "SDR0MX")
   call SaveStr(udg_hash, 'A06W', 67, "SDR0MX")
   call SaveStr(udg_hash, 'A0A8', 67, "SDA0MX")
   call SaveStr(udg_hash, 'A0A9', 67, "SDA0MX")
  call SaveStr(udg_hash, 'A05T', 67, "MTS9IO")
  call SaveStr(udg_hash, 'A081', 67, "SFE0MX")
  call SaveStr(udg_hash, 'A082', 67, "SFE0MX")
  call SaveStr(udg_hash, 'A07P', 67, "MFQ4JX")
   call SaveStr(udg_hash, 'A09F', 67, "MZZ4JX")
  call SaveStr(udg_hash, 'A079', 67, "MQA3IO")
   call SaveStr(udg_hash, 'A09C', 67, "MZS3IO")
  call SaveStr(udg_hash, 'A04R', 67, "MDE0MX")
  call SaveStr(udg_hash, 'A07M', 67, "MFW3MX")
  call SaveStr(udg_hash, 'A07N', 67, "MFW3MX")
   call SaveStr(udg_hash, 'A09G', 67, "MZX3MX")
  call SaveStr(udg_hash, 'A04U', 67, "SFR0MX")
  call SaveStr(udg_hash, 'A04X', 67, "SFR0MX")
  call SaveStr(udg_hash, 'A08G', 67, "MES4IO")
   call SaveStr(udg_hash, 'A09D', 67, "MZD4IO")
  call SaveStr(udg_hash, 'A088', 67, "MTE3PX")
  call SaveStr(udg_hash, 'A08J', 67, "MQE2PX")
  call SaveStr(udg_hash, 'A08F', 67, "MEA4IO")
  call SaveStr(udg_hash, 'A08H', 67, "MEA4IO")
  call SaveStr(udg_hash, 'A08B', 67, "MEQ3PX")
   call SaveStr(udg_hash, 'A099', 67, "MZE3PX")
  call SaveStr(udg_hash, 'A08D', 67, "MEE3PX")
  call SaveStr(udg_hash, 'A08C', 67, "MEW3PX")
  call SaveStr(udg_hash, 'A08E', 67, "MER3PX")
  call SaveStr(udg_hash, 'A06C', 67, "SDE0MX")
  call SaveStr(udg_hash, 'A06J', 67, "SDE0MX")
  call SaveStr(udg_hash, 'A05Q', 67, "MDS0MX")
  call SaveStr(udg_hash, 'A07F', 67, "MDS0MX")
   call SaveStr(udg_hash, 'A09O', 67, "MZD3MX")
  call SaveStr(udg_hash, 'A051', 67, "MDA3AX")
  call SaveStr(udg_hash, 'A052', 67, "MDA3AX")
  call SaveStr(udg_hash, 'A04C', 67, "MDA0MX")
  call SaveStr(udg_hash, 'A04W', 67, "MDA0MX")
  call SaveStr(udg_hash, 'A090', 67, "MDX2LX")
   call SaveStr(udg_hash, 'A09S', 67, "MZC2LX")
  call SaveStr(udg_hash, 'A03T', 67, "MDW2LX")
  call SaveStr(udg_hash, 'A05A', 67, "MDW2LX")
  call SaveStr(udg_hash, 'A055', 67, "MDD0KX")
  call SaveStr(udg_hash, 'A06A', 67, "MDD0KX")
  call SaveStr(udg_hash, 'A033', 67, "MDQ0MX")
  call SaveStr(udg_hash, 'A04D', 67, "MDQ0MX")
   call SaveStr(udg_hash, 'A09L', 67, "MZR0MX")
  call SaveStr(udg_hash, 'A03G', 67, "MDD0KX")
  call SaveStr(udg_hash, 'A03E', 67, "SDS0BO")
   call SaveStr(udg_hash, 'A0A0', 67, "SDS0BO")
   call SaveStr(udg_hash, 'A0AB', 67, "SDS0BO")
  call SaveStr(udg_hash, 'A08I', 67, "MQW2PX")
  call SaveStr(udg_hash, 'A087', 67, "MTW4PX")
  call SaveStr(udg_hash, 'A07Y', 67, "SFQ0JX")
  call SaveStr(udg_hash, 'A08K', 67, "MQR2PX")
  call SaveStr(udg_hash, 'A089', 67, "MTR4PX")
  call SaveStr(udg_hash, 'A04I', 67, "MDW0MX")
  call SaveStr(udg_hash, 'A04Q', 67, "MDW0MX")
  call TriggerSleepAction(0.01)
  call SaveStr(udg_hash, 'A05N', 67, "MDA2LX")
  call SaveStr(udg_hash, 'A05O', 67, "MDA2LX")
  call SaveStr(udg_hash, 'A038', 67, "MDQ0LX")
  call SaveStr(udg_hash, 'A04M', 67, "MDQ0LX")
  call SaveStr(udg_hash, 'A03B', 67, "MDW0LX")
  call SaveStr(udg_hash, 'A03K', 67, "MDW0LX")
  call SaveStr(udg_hash, 'A06B', 67, "MDF0LX")
  call SaveStr(udg_hash, 'A07C', 67, "MDF0LX")
  call SaveStr(udg_hash, 'A03P', 67, "SDQ0MX")
  call SaveStr(udg_hash, 'A04N', 67, "SDQ0MX")
   call SaveStr(udg_hash, 'A0A2', 67, "SDW0MX")
   call SaveStr(udg_hash, 'A0A3', 67, "SDW0MX")
  call SaveStr(udg_hash, 'A0A5', 67, "MDR7LX")
   call SaveStr(udg_hash, 'A0A6', 67, "MDR7LX")

  // 능력 효과 시작 - 플레이어 스킬(기술+마법)
  call TriggerPutSkill(gg_trg_SQResqueDA007, 'A007')
  call TriggerPutSkill(gg_trg_SWShortBlacdeA02F, 'A02F')
  call TriggerPutSkill(gg_trg_SW2WindBladeA00A, 'A00A')
   call TriggerPutSkill(gg_trg_SW2WindBladeA00A, 'A06Q')
  call TriggerPutSkill(gg_trg_SEMegaBladeA02P, 'A02P')
   call TriggerPutSkill(gg_trg_SEMegaBladeA02P, 'A06R')
  call TriggerPutSkill(gg_trg_SQ2BatuDA02N, 'A02N')
  call TriggerPutSkill(gg_trg_SQ2BatuDA02N, 'A064')
  call TriggerPutSkill(gg_trg_SRHitarmsDA03R, 'A03R')
   call TriggerPutSkill(gg_trg_SRHitarmsDA03R, 'A06S')
  call TriggerPutSkill(gg_trg_STRushA02A, 'A02A')
  call TriggerPutSkill(gg_trg_SQ3PyohoA09X, 'A09X')
  call TriggerPutSkill(gg_trg_SW3RuneBladeA09Y, 'A09Y')
  call TriggerPutSkill(gg_trg_SE2StomeBladeA09Z, 'A09Z')
  call TriggerPutSkill(gg_trg_SQSPierceDA02H, 'A02H')
  call TriggerPutSkill(gg_trg_SQPierceDA009, 'A009')
   call TriggerPutSkill(gg_trg_SQPierceDA009, 'A06T')
  call TriggerPutSkill(gg_trg_SRAmunejiaDA00C, 'A00C')
   call TriggerPutSkill(gg_trg_SRAmunejiaDA00C, 'A072')
  call TriggerPutSkill(gg_trg_SWDartThrowDA01J, 'A01J')
  call TriggerPutSkill(gg_trg_SEPierce2DA00F, 'A00F')
   call TriggerPutSkill(gg_trg_SEPierce2DA00F, 'A071')
  call TriggerPutSkill(gg_trg_STAssaultDA03O, 'A03O')
   call TriggerPutSkill(gg_trg_STAssaultDA03O, 'A073')
  call TriggerPutSkill(gg_trg_SWAssassinateDA04J, 'A04J')
   call TriggerPutSkill(gg_trg_SWAssassinateDA04J, 'A070')
  call TriggerPutSkill(gg_trg_SR2RaidDA02U, 'A02U')
  call TriggerPutSkill(gg_trg_MQ1MTAPA008A020A021A022, 'A008')
  call TriggerPutSkill(gg_trg_MQ1MTAPA008A020A021A022, 'A020')
  call TriggerPutSkill(gg_trg_MQ1MTAPA008A020A021A022, 'A021')
  call TriggerPutSkill(gg_trg_MQ1MTAPA008A020A021A022, 'A022')
  call TriggerPutSkill(gg_trg_MW1RentoA01O, 'A01O')
  call TriggerPutSkill(gg_trg_ME1SuperaA025A026A027A028, 'A025')
  call TriggerPutSkill(gg_trg_ME1SuperaA025A026A027A028, 'A026')
  call TriggerPutSkill(gg_trg_ME1SuperaA025A026A027A028, 'A027')
  call TriggerPutSkill(gg_trg_ME1SuperaA025A026A027A028, 'A028')
  call TriggerPutSkill(gg_trg_MF1VenomiA029, 'A029')
   call TriggerPutSkill(gg_trg_MF1VenomiA029, 'A07P')
   call TriggerPutSkill(gg_trg_MF1VenomiA029, 'A09F')
  call TriggerPutSkill(gg_trg_MW2BardoA01V, 'A01V')
  call TriggerPutSkill(gg_trg_MQ2MTAPA02QA02WA02XA02Y, 'A02Q')
  call TriggerPutSkill(gg_trg_MQ2MTAPA02QA02WA02XA02Y, 'A02W')
  call TriggerPutSkill(gg_trg_MQ2MTAPA02QA02WA02XA02Y, 'A02X')
  call TriggerSleepAction(0.01)
  call TriggerPutSkill(gg_trg_MQ2MTAPA02QA02WA02XA02Y, 'A02Y')
  call TriggerPutSkill(gg_trg_MRNarcolyA02T, 'A02T')
   call TriggerPutSkill(gg_trg_MRNarcolyA02T, 'A09A')
  call TriggerPutSkill(gg_trg_ME2XTAPA043A044A045A046, 'A043')
  call TriggerPutSkill(gg_trg_ME2XTAPA043A044A045A046, 'A044')
  call TriggerPutSkill(gg_trg_ME2XTAPA043A044A045A046, 'A045')
  call TriggerPutSkill(gg_trg_ME2XTAPA043A044A045A046, 'A046')
  call TriggerPutSkill(gg_trg_MW3DeprecoA00J, 'A00J')
  call TriggerPutSkill(gg_trg_MQ3MTAPA03JA03LA03MA03N, 'A03J')
  call TriggerPutSkill(gg_trg_MQ3MTAPA03JA03LA03MA03N, 'A03L')
  call TriggerPutSkill(gg_trg_MQ3MTAPA03JA03LA03MA03N, 'A03M')
  call TriggerPutSkill(gg_trg_MQ3MTAPA03JA03LA03MA03N, 'A03N')
  call TriggerPutSkill(gg_trg_MF2WISorumaDA07M, 'A07M')
   call TriggerPutSkill(gg_trg_MF2WISorumaDA07M, 'A07N')
   call TriggerPutSkill(gg_trg_MF2WISorumaDA07M, 'A09G')
  call TriggerPutSkill(gg_trg_MT1TAPA063A066A067A068, 'A063')
  call TriggerPutSkill(gg_trg_MT1TAPA063A066A067A068, 'A066')
  call TriggerPutSkill(gg_trg_MT1TAPA063A066A067A068, 'A067')
  call TriggerPutSkill(gg_trg_MT1TAPA063A066A067A068, 'A068')
  call TriggerPutSkill(gg_trg_MW4PraboA00ZA098, 'A00Z')
   call TriggerPutSkill(gg_trg_MW4PraboA00ZA098, 'A098')
  call TriggerPutSkill(gg_trg_MF3DeathA07Q, 'A07Q')
   call TriggerPutSkill(gg_trg_MF3DeathA07Q, 'A09H')
  call TriggerPutSkill(gg_trg_MQ4QWERA07AA08IA08JA08K, 'A07A')
   call TriggerPutSkill(gg_trg_MQ4QWERA07AA08IA08JA08K, 'A097')
  call TriggerPutSkill(gg_trg_MQ4QWERA07AA08IA08JA08K, 'A08I')
  call TriggerPutSkill(gg_trg_MQ4QWERA07AA08IA08JA08K, 'A08J')
  call TriggerPutSkill(gg_trg_MQ4QWERA07AA08IA08JA08K, 'A08K')
  call TriggerPutSkill(gg_trg_MQ4ASemeliaA079, 'A079')
   call TriggerPutSkill(gg_trg_MQ4ASemeliaA079, 'A09C')
  call TriggerPutSkill(gg_trg_ME3QWERA08BA08CA08DA08E, 'A08B')
   call TriggerPutSkill(gg_trg_ME3QWERA08BA08CA08DA08E, 'A099')
  call TriggerPutSkill(gg_trg_ME3QWERA08BA08CA08DA08E, 'A08C')
  call TriggerPutSkill(gg_trg_ME3QWERA08BA08CA08DA08E, 'A08D')
  call TriggerPutSkill(gg_trg_ME3QWERA08BA08CA08DA08E, 'A08E')
  call TriggerPutSkill(gg_trg_ME3AIAmagetdonA08F, 'A08F')
   call TriggerPutSkill(gg_trg_ME3AIAmagetdonA08F, 'A08H')
  call TriggerSleepAction(0.01)
  call TriggerPutSkill(gg_trg_ME4SSoommastellaA08G, 'A08G')
   call TriggerPutSkill(gg_trg_ME4SSoommastellaA08G, 'A09D')
  call TriggerPutSkill(gg_trg_MT2QWERA086A087A088A089, 'A086')
   call TriggerPutSkill(gg_trg_MT2QWERA086A087A088A089, 'A09B')
  call TriggerPutSkill(gg_trg_MT2QWERA086A087A088A089, 'A087')
  call TriggerPutSkill(gg_trg_MT2QWERA086A087A088A089, 'A088')
  call TriggerPutSkill(gg_trg_MT2QWERA086A087A088A089, 'A089')
  call TriggerPutSkill(gg_trg_MT2AIRagnarokA08A_A09E_A03I, 'A08A')
   call TriggerPutSkill(gg_trg_MT2AIRagnarokA08A_A09E_A03I, 'A09E')
   call TriggerPutSkill(gg_trg_MT2AIRagnarokA08A_A09E_A03I, 'A03I')
  //call TriggerPutSkill(gg_trg_MT2ARagnarokA03I, 'A03I')
  call TriggerPutSkill(gg_trg_MT3SIMeteorA05T, 'A05T')
  call TriggerPutSkill(gg_trg_MQCuroA00V, 'A00V')
  call TriggerPutSkill(gg_trg_MWDeRentoA024, 'A024')
  call TriggerPutSkill(gg_trg_MEBellaA01N, 'A01N')
  call TriggerPutSkill(gg_trg_MW2DeBardoA02D, 'A02D')
  call TriggerPutSkill(gg_trg_MQ2CuranoA01Y, 'A01Y')
  call TriggerPutSkill(gg_trg_MFCureceA01X, 'A01X')
  call TriggerPutSkill(gg_trg_MREnarmaA02Z, 'A02Z')
  call TriggerPutSkill(gg_trg_MQ3CuranosoA030, 'A030')
  call TriggerPutSkill(gg_trg_MW3DeDeprecaA04G, 'A04G')
  call TriggerPutSkill(gg_trg_MF2CuranuceA031, 'A031')
  call TriggerPutSkill(gg_trg_MT1HolyShotA05V, 'A05V')
  call TriggerPutSkill(gg_trg_MT2HolyBoltA032, 'A032')
  call TriggerPutSkill(gg_trg_MW4DePrabaA04H, 'A04H')
   call TriggerPutSkill(gg_trg_MW4DePrabaA04H, 'A09J')
  call TriggerPutSkill(gg_trg_ME2SuBellaA059, 'A059')
   call TriggerPutSkill(gg_trg_MZESmallBuffA09K, 'A09K')
  call TriggerPutSkill(gg_trg_MQ4SuCuranoA05D, 'A05D')
  call TriggerPutSkill(gg_trg_MF3CuraneraA05H, 'A05H')
  call TriggerPutSkill(gg_trg_MQ5XCuranoA074, 'A074')
   call TriggerPutSkill(gg_trg_MQ5XCuranoA074, 'A09I')
  call TriggerPutSkill(gg_trg_MF4XCuraneraA075, 'A075')
   call TriggerPutSkill(gg_trg_MF4XCuraneraA075, 'A09Q')
  call TriggerPutSkill(gg_trg_MQ6HCuranoA002, 'A002')
  call TriggerPutSkill(gg_trg_MT2HdragonA01U, 'A01U')
  call TriggerPutSkill(gg_trg_SQDangakDA00X, 'A00X')
  call TriggerPutSkill(gg_trg_SWJumpA00Y, 'A00Y')
  call TriggerPutSkill(gg_trg_SEBunggakDA01L, 'A01L')
  call TriggerSleepAction(0.01)
  call TriggerPutSkill(gg_trg_SRSeonpoongA035, 'A035')
  call TriggerPutSkill(gg_trg_STbaekboDA02M, 'A02M')
  call TriggerPutSkill(gg_trg_SFQTongbaeA01KA07Y, 'A01K')
  call TriggerPutSkill(gg_trg_SFQTongbaeA01KA07Y, 'A07Y')
  call TriggerPutSkill(gg_trg_SFEBalGyengDA081A082, 'A081')
  call TriggerPutSkill(gg_trg_SFEBalGyengDA081A082, 'A082')
  call TriggerPutSkill(gg_trg_SFRSosuA04UA04X, 'A04U')
  call TriggerPutSkill(gg_trg_SFRSosuA04UA04X, 'A04X')
  call TriggerPutSkill(gg_trg_SFADalmaA037A04V, 'A04V')
  call TriggerPutSkill(gg_trg_SFADalmaA037A04V, 'A037')
  call TriggerPutSkill(gg_trg_SFSGuyangA07V, 'A07V')
  call TriggerPutSkill(gg_trg_SW2Jump2A05U, 'A05U')
  call TriggerPutSkill(gg_trg_CurotoA010, 'A010')
  call TriggerPutSkill(gg_trg_SDQlTwohandAttackA03PA04N, 'A03P')
  call TriggerPutSkill(gg_trg_SDQlTwohandAttackA03PA04N, 'A04N')
   call TriggerPutSkill(gg_trg_SDQlTwohandAttackA03PA04N, 'A06Z')
  call TriggerPutSkill(gg_trg_SDWlDragonModeA03SA06D, 'A03S')
   call TriggerPutSkill(gg_trg_SDWlDragonModeA03SA06D, 'A06D')
   call TriggerPutSkill(gg_trg_SDWlDragonModeA03SA06D, 'A06U')
  call TriggerPutSkill(gg_trg_SDElDefallA06CA06J, 'A06C')
  call TriggerPutSkill(gg_trg_SDElDefallA06CA06J, 'A06J')
   call TriggerPutSkill(gg_trg_SDElDefallA06CA06J, 'A06V')
  call TriggerPutSkill(gg_trg_SDRIMadA06KA03C, 'A06K')
   call TriggerPutSkill(gg_trg_SDRIMadA06KA03C, 'A03C')
   call TriggerPutSkill(gg_trg_SDRIMadA06KA03C, 'A06W')
  call TriggerPutSkill(gg_trg_SDAICratherA03EA06X, 'A03E')
   call TriggerPutSkill(gg_trg_SDAICratherA03EA06X, 'A06X')
   call TriggerPutSkill(gg_trg_SDAICratherA03EA06X, 'A0A0')
  call TriggerPutSkill(gg_trg_SDWIPhoenixModeA0A2A0A3, 'A0A2')
   call TriggerPutSkill(gg_trg_SDWIPhoenixModeA0A2A0A3, 'A0A3')
  call TriggerPutSkill(gg_trg_MDRlConcentrationA0A5, 'A0A5')
   call TriggerPutSkill(gg_trg_MDRlConcentrationA0A5, 'A0A6')
  call TriggerPutSkill(gg_trg_SDRIMad2A0A8A0A9, 'A0A8')
   call TriggerPutSkill(gg_trg_SDRIMad2A0A8A0A9, 'A0A9')
  call TriggerPutSkill(gg_trg_SDAIDevilCratherA0AB, 'A0AB')
  
  call TriggerPutSkill(gg_trg_MDQlLightningMoveA038, 'A038')
  call TriggerPutSkill(gg_trg_MDQlLightningMoveA038, 'A04M')
  call TriggerPutSkill(gg_trg_MDQlLightningMoveA038, 'A08R')
  
  call TriggerSleepAction(0.01)
  call TriggerPutSkill(gg_trg_MDWlHideA04I, 'A04I')
  call TriggerPutSkill(gg_trg_MDWlHideA04I, 'A04Q')
   call TriggerPutSkill(gg_trg_MDWlHideA04I, 'A08S')
  call TriggerPutSkill(gg_trg_MDWlCensusA04R, 'A04R')
   call TriggerPutSkill(gg_trg_MDWlCensusA04R, 'A08T')
  call TriggerPutSkill(gg_trg_MDQlCuraltumA033, 'A033')
   call TriggerPutSkill(gg_trg_MDQlCuraltumA033, 'A04D')
   call TriggerPutSkill(gg_trg_MDQlCuraltumA033, 'A09L')
  call TriggerPutSkill(gg_trg_MDWlColamaA03T, 'A03T')
  call TriggerPutSkill(gg_trg_MDElLocameaA05B, 'A05B')
   call TriggerPutSkill(gg_trg_MDElLocameaA05B, 'A05E')
   call TriggerPutSkill(gg_trg_MDElLocameaA05B, 'A09N')
  call TriggerPutSkill(gg_trg_MDRlLichmanaA05G, 'A05G')
   call TriggerPutSkill(gg_trg_MDRlLichmanaA05G, 'A05I')
   call TriggerPutSkill(gg_trg_MDRlLichmanaA05G, 'A09M')
  call TriggerPutSkill(gg_trg_MDAlHorramaA05N, 'A05N')
  call TriggerPutSkill(gg_trg_MDSlImmortalA05Q, 'A05Q')
   //call TriggerPutSkill(gg_trg_MDSlImmortalA05Q, 'A07F')
   //call TriggerPutSkill(gg_trg_MDSlImmortalA05Q, 'A09O')
  call TriggerPutSkill(gg_trg_MDFIReflectoA07G, 'A07G')
   call TriggerPutSkill(gg_trg_MDFIReflectoA07G, 'A08X')
   call TriggerPutSkill(gg_trg_MDFIReflectoA07G, 'A09P')
  call TriggerPutSkill(gg_trg_MDZIReberatoA08Y, 'A08Y')
   call TriggerPutSkill(gg_trg_MDZIReberatoA08Y, 'A08Z')
   call TriggerPutSkill(gg_trg_MDZIReberatoA08Y, 'A09R')
  call TriggerPutSkill(gg_trg_MDXIComadiaA090, 'A090')
   call TriggerPutSkill(gg_trg_MDXIComadiaA090, 'A09S')
  call TriggerPutSkill(gg_trg_MDWlMisngA03B, 'A03B')
  call TriggerSleepAction(0.01)
  call TriggerPutSkill(gg_trg_MDElMovingUpA03A, 'A03A')
  call TriggerPutSkill(gg_trg_MDRlIronSkinA04C, 'A04C')
  call TriggerPutSkill(gg_trg_MDAlHameA051, 'A051')
  call TriggerPutSkill(gg_trg_MDSlAdamantineA053, 'A053')
  call TriggerPutSkill(gg_trg_MDDlCuranotoA055, 'A055')
  call TriggerPutSkill(gg_trg_MDFlReflectionA06B, 'A06B')
  call TriggerPutSkill(gg_trg_MDZlDaraA07D, 'A07D')
  call TriggerPutSkill(gg_trg_MDDCurotoA03G, 'A03G')
  //call TriggerPutSkill(gg_trg_SDWDragonModeA06D, 'A06D')
   //call TriggerPutSkill(gg_trg_SDWDragonModeA06D, 'A06U')
  //call TriggerPutSkill(gg_trg_SDEDefallA06J, 'A06J')
   //call TriggerPutSkill(gg_trg_SDEDefallA06J, 'A06V')
  //call TriggerPutSkill(gg_trg_SDRMadA03C, 'A03C')
   //call TriggerPutSkill(gg_trg_SDRMadA03C, 'A06W')
  //call TriggerPutSkill(gg_trg_MDQLightningMoveA04M, 'A04M')
  //call TriggerPutSkill(gg_trg_MDWHideA04Q, 'A04Q')
  //call TriggerPutSkill(gg_trg_MDQCuraltumA04D, 'A04D')
  call TriggerPutSkill(gg_trg_MDWColamaA05A, 'A05A')
  //call TriggerPutSkill(gg_trg_MDELocameaA05E, 'A05E')
  //call TriggerPutSkill(gg_trg_MDRLichmanaA05I, 'A05I')
  call TriggerPutSkill(gg_trg_MDAHorramaA05O, 'A05O')
  //call TriggerPutSkill(gg_trg_MDSImmortalA07F, 'A07F')
  //call TriggerPutSkill(gg_trg_MDFReflectoA08X, 'A08X')
  //call TriggerPutSkill(gg_trg_MDZReberatoA08Z, 'A08Z')
  call TriggerPutSkill(gg_trg_MDWMisngA03K, 'A03K')
  call TriggerPutSkill(gg_trg_MDEMovingUpA03Y, 'A03Y')
  call TriggerPutSkill(gg_trg_MDRIronSkinA04W, 'A04W')
  call TriggerPutSkill(gg_trg_MDAHameA052, 'A052')
  //call TriggerPutSkill(gg_trg_MDSAdamantineA054, 'A054')
  call TriggerPutSkill(gg_trg_MDDCuranotoA06A, 'A06A')
  call TriggerPutSkill(gg_trg_MDFReflectionA07C, 'A07C')
  call TriggerSleepAction(0.01)
  call SaveStr(udg_hash, 'A015', 67, "M005MX")
  call TriggerPutSkill(gg_trg_Item81A015, 'A015')
  call TriggerPutSkill(gg_trg_Item45A014, 'A014')
  call TriggerPutItem2(gg_trg_Item_fooiffs_Buff, 'guvi')
  call TriggerPutItem2(gg_trg_Item_RecallAll, 'I08T')
  call TriggerPutItem2(gg_trg_Solo_Add_skrt, 'skrt')
  call TriggerPutItem2(gg_trg_Solo_Exit_sorf, 'sorf')
  call TriggerPutItem2(gg_trg_Item_Move_Horr_pnvu, 'pnvu')
  call TriggerPutItem2(gg_trg_Item_Move_Mine_mgtk, 'mgtk')
  call TriggerPutItem2(gg_trg_Item_Move_DeadVilleage_dthb, 'dthb')
  
  call TriggerPutSkill(gg_trg_Skill_SkillCheckA01D, 'A01D')
  call TriggerPutSkill(gg_trg_Skill_SkillLearnA01E, 'A01E')
  call TriggerPutSkill(gg_trg_Item_RecallAll, 'A01F')
  
  call TriggerPutSkill(gg_trg_Skill_StateAddALL, 'A00N')
  call TriggerPutSkill(gg_trg_Skill_StateAddALL, 'A00R')
  call TriggerPutSkill(gg_trg_Skill_StateAddALL, 'A00S')
  call TriggerPutSkill(gg_trg_Skill_StateAddALL, 'A00T')
  call TriggerPutSkill(gg_trg_Skill_StateAddALL, 'A00U')
  call TriggerPutSkill(gg_trg_Skill_StateAddALL, 'A017')
  call TriggerPutSkill(gg_trg_Skill_StateAddALL, 'A018')
  call TriggerPutSkill(gg_trg_Skill_StateAddALL, 'A019')
  call TriggerPutSkill(gg_trg_Skill_StateAddALL, 'A01A')
  call TriggerPutSkill(gg_trg_Skill_StateAddALL, 'A01B')
  call TriggerPutSkill(gg_trg_Skill_Reset, 'A01C')
  call TriggerPutSkill(gg_trg_Skill_EatItemsA039, 'A039')
  call TriggerPutSkill(gg_trg_Skill_AutoSaveA05J, 'A05J')
  call TriggerPutSkill(gg_trg_Skill_FooiffBuffA05L, 'A05L')
  
  call TriggerPutItem2(gg_trg_Item_Comax10dtsbdrph, 'dtsb')
  call TriggerPutItem2(gg_trg_Item_Comax10dtsbdrph, 'drph')
  call TriggerPutItem2(gg_trg_Item_Hornshea, 'shea')
  call TriggerPutItem2(gg_trg_Event_Buff, 'phlt')
  call TriggerPutItem2(gg_trg_Event_Buff2, 'arsc')
  call TriggerPutItem2(gg_trg_Event_DailyCheck_bzbe, 'bzbe')
  call TriggerPutItem2(gg_trg_Event_DailyCheckState_mlst, 'mlst')
  call TriggerPutItem2(gg_trg_Item_Boss1lmbr, 'lmbr')
  
  call TriggerPutItem2(gg_trg_Item_Move1Wood1shwd, 'shwd')
  call TriggerPutItem2(gg_trg_Item_Move1Wood2rma2, 'rma2')
  call TriggerPutItem2(gg_trg_Item_Move1Wood3rej1, 'rej1')
  
  call TriggerPutItem2(gg_trg_Item_Move_Graves1tels, 'tels')
  call TriggerPutItem2(gg_trg_Item_Move_Graves2gobm, 'gobm')
  call TriggerPutItem2(gg_trg_Item_Move_fote_nflg, 'nflg')
  call TriggerPutItem2(gg_trg_Item_Move_bitch_shdt, 'shdt')
  call TriggerPutItem2(gg_trg_Item_Move_harmony_ram3, 'ram3')
  
  call TriggerSleepAction(0.01)
  call TriggerPutItem2(gg_trg_Item_Buy_Orens, 'ofro')
  call TriggerPutItem2(gg_trg_Item_Buy_Orens, 'ckng')
  call TriggerPutItem2(gg_trg_Item_Buy_Orens, 'ratf')
  call TriggerPutItem2(gg_trg_Item_Buy_Orens, 'tst2')
  call TriggerPutItem2(gg_trg_Item_Buy_Orens, 'desc')
  call TriggerPutItem2(gg_trg_Item_Buy_Orens, 'modt')
  call TriggerPutItem2(gg_trg_Item_Buy_Orens, 'tstr')
  
  call TriggerPutItem2(gg_trg_Item_Buy_Orens, 'moon')
  call TriggerPutItem2(gg_trg_Item_Buy_Orens, 'rhe2')
  call TriggerPutItem2(gg_trg_Item_Buy_Orens, 'rde4')
  call TriggerPutItem2(gg_trg_Item_Buy_Orens, 'manh')
  call TriggerPutItem2(gg_trg_Item_Buy_Orens, 'rwat')
  call TriggerPutItem2(gg_trg_Item_Buy_Orens, 'shas')
  
  call TriggerPutItem2(gg_trg_Move_Mine_Elevator, 'rsps')
  call TriggerPutItem2(gg_trg_Move_Mine_Elevator, 'rreb')
  call TriggerPutItem2(gg_trg_Move_Mine_Elevator, 'tdex')
  
  call TriggerPutItem2(gg_trg_Quest_15_D_BuyItems, 'rej6')
  call TriggerPutItem2(gg_trg_Quest_15_D_BuyItems, 'dphe')
  call TriggerPutItem2(gg_trg_Quest_15_D_BuyItems, 'wswd')
  call TriggerPutItem2(gg_trg_Quest_15_D_BuyItems, 'rump')
  call TriggerPutItem2(gg_trg_Quest_15_D_BuyItems, 'rej3')
  call TriggerPutItem2(gg_trg_Quest_15_D_BuyItems, 'phea')
  call TriggerPutItem2(gg_trg_Quest_15_D_BuyItems, 'bspd')
  call TriggerPutItem2(gg_trg_Quest_15_D_BuyItems, 'fgsk')
  call TriggerPutItem2(gg_trg_Quest_15_D_BuyItems, 'pgma')
  
  call TriggerPutItem2(gg_trg_Mine_Trade_Items_crdt_wneu_wneg, 'crdt')
  call TriggerPutItem2(gg_trg_Mine_Trade_Items_crdt_wneu_wneg, 'wneu')
  call TriggerPutItem2(gg_trg_Mine_Trade_Items_crdt_wneu_wneg, 'wneg')
  
  call TriggerPutItem2(gg_trg_Give_Wood_engs, 'engs')
  call TriggerPutItem2(gg_trg_Give_SkillMax_sbch, 'sbch')
  
  call TriggerSleepAction(0.01)
  call SaveStr(udg_hash, 'AIlu', 67, "M005MX")
  call TriggerPutSkill(gg_trg_Item87AIlu, 'AIlu')
  call SaveStr(udg_hash, 'A01E', 67, "M005MX")
  call SaveStr(udg_hash, 'A01F', 67, "M003MX")
  /* call SaveStr(udg_hash, 'A03V', 67, "M001MX") 코마디움 쿨 삭제 */
  /* call TriggerPutSkill(gg_trg_Skill_ComadiumI08V, 'A03V') */
  call TriggerPutItem(gg_trg_Skill_ComadiumI08V, 'I08V')
  call TriggerPutSkill(gg_trg_Quest_00_Note, 'A03Q')
endfunction

//===========================================================================
function InitTrig_Set_Skill_Data takes nothing returns nothing
    set gg_trg_Set_Skill_Data = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Set_Skill_Data, function Trig_Set_Data_Actions )
endfunction

//===========================================================================
// Trigger: Set SaveItem
//
// 'I000' == 1227894832
// 'I009' == 1227894841
// 'I00A' == 1227894849
// 'I00Z' == 1227894874
// 'I010' == 1227895088
// 'I01Z' == 1227895130
// 'I020' == 1227895344
// 'I0A0' == 1227899184
// 'I09Z' == 1227897178
// 'I0A0' == 1227899184
//===========================================================================
function Trig_Setup_Actions takes nothing returns nothing
                      //'I000'
 local integer i = 1227894832
 local integer j = 0
 local integer now = 1
 
  loop
    set bj_lastCreatedItem = CreateItem(i, 0., 0.)
    if ( bj_lastCreatedItem != null ) and not( GetItemType(bj_lastCreatedItem) == ITEM_TYPE_UNKNOWN and ( GetItemLevel(bj_lastCreatedItem) == 1 or GetItemLevel(bj_lastCreatedItem) == 3 ) ) then
    //if ( GetObjectName(i) != "" and GetObjectName(i) != null ) then
      call SaveInteger(udg_hash, i, StringHash("FSE_T2I"), now)
      set udg_FSE_it[now] = i
      set now = now + 1
//debug call BJDebugMsg("Setup Items all: " + I2S(now) + " = " + GetObjectName(i))
    endif
    call RemoveItem(bj_lastCreatedItem)
      
    if ( i >= 1227897178 ) then
    //I09Z → I0A0, 차후 적용 예정
      set i = i + 2006
      exitwhen true
    elseif ( j == 9 ) then
      //I009 → I00A, I019 → I01A...
      set i = i + 8
      set j = j + 8
    elseif ( j >= 42 ) then
    //I00Z → I010, I01Z → I020...
      call TriggerSleepAction(.01)
      set i = i + 214
      set j = 0
    else
      set i = i + 1
      set j = j + 1
    endif
  endloop
  
  //추가저장
  set udg_FSE_it[now+1] = 'k3m1'
  call SaveInteger(udg_hash, 'k3m1', StringHash("FSE_T2I"), now+1)
  
  set udg_FSE_it[0] = now+1
//debug call BJDebugMsg("Setup Items all: " + I2S(udg_FSE_it[0]) + " / 1=" + GetObjectName(udg_FSE_it[1]))
 set i = 0
 set j = 0
 set now = 0
  call DestroyTrigger( GetTriggeringTrigger())
  set gg_trg_Set_SaveItem = null
endfunction

//===========================================================================
function InitTrig_Set_SaveItem takes nothing returns nothing
    set gg_trg_Set_SaveItem = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Set_SaveItem, function Trig_Setup_Actions )
endfunction

//===========================================================================
// Trigger: Set Items
//
// 5번째 값 무조건 0으로
// 567 - 이펙트
// 890 - 아이콘. 연동
// 아이콘 연동 업데이트 할 것
// //1. 최소공격력/ 2. 최대공격력/ 3. 방어력AC/ 4. 마법 방어력/ 5. Dam/ 6. Hit/ 7. Regen/ 8. CriP/ 9. CriX/ a. STR/ b. DEX/ c. INT/ d. WIS/ e. CON/ f. hp/ g. mp/ h. AllState
// / i. 힐량 / j. 골드 / k. 팟 뎀 / l. 드랍률 / m 공속 / o 강제옵 / p회피 / q 판매율 / s 버프효율 / t 이동속도(1~20단계)
//===========================================================================
function Trig_Set_Items_Actions takes nothing returns nothing
  call DestroyTrigger( GetTriggeringTrigger() )
//                       '0000'아이템 ID                           |아이템 기본 설명(긴 설명은 #x로 길이 설정, 기본 1)
//                                                       1			- 직업 구분    |능력치
//                                                        23        - 아이템 종류 구분
//                                                          4       - 레벨제한 구분
//                                                           567    - 아이템 장착시 붙는 이펙트 구분

  //시스템 - 양손 무기 먹었을 때 방패 칸 등록되는 임시 아이템
  call SaveStr(udg_hash, 'cnhn', StringHash("FMi-Val"), "0011034|0666~7777|320|f2000|g5000|610|75|850.0|90.5|h5")
  call SaveStr(udg_hash, 'kpin', StringHash("FMi-Val"), "0031049|0333~3333|320|f2500|g1250|650|h3|720|8-10.0|91.0")
  // 현재 여기까지 완료
  
  
  
  call SaveStr(udg_hash, 'sneg', StringHash("FMi-Val"), "0161029|33|h1|73")
  call SaveStr(udg_hash, 'hlst', StringHash("FMi-Val"), "0171029|34|h2|75")
  call SaveStr(udg_hash, 'shar', StringHash("FMi-Val"), "0181029|35|h3|77")
  
  call SaveStr(udg_hash, 'gopr', StringHash("FMi-Val"), "0081046|0180~9819|g2000|6200|c10|d15|715|435")
  //명예벨트 벨트
  //사람벨트 벨트
  //루키벨트 벨트
  call SaveStr(udg_hash, 'k3m1', StringHash("FMi-Val"), "0216000|31|57|67|77")
  //ㅁㄴㅍㅇ 스태프
// 파워 업 - 5 (no-save)
//#여기부터
  call SaveStr(udg_hash, 'rde3', StringHash("FMi-Val"), "5118000|351|g1000")
  call SaveStr(udg_hash, 'rde2', StringHash("FMi-Val"), "4118000|348|g1000")
  call SaveStr(udg_hash, 'rde1', StringHash("FMi-Val"), "3118000|357|f1000")
  call SaveStr(udg_hash, 'gcel', StringHash("FMi-Val"), "2118000|368|f2000")
  call SaveStr(udg_hash, 'clfm', StringHash("FMi-Val"), "6118000|357|f500|g500")
// 파워 업 - 7
  //call SaveStr(udg_hash, 'I06D', StringHash("FMi-Val"), "-02720|f1200|g600")
  //call SaveStr(udg_hash, 'I05X', StringHash("FMi-Val"), "-02580|f200|g200|51|63|410")
  //call SaveStr(udg_hash, 'I07J', StringHash("FMi-Val"), "-02080|31|f600|g300")
  //call SaveStr(udg_hash, 'I07K', StringHash("FMi-Val"), "-02080|31|f600|g300")
// 갑옷류 - 보물 - 34
  call SaveStr(udg_hash, 'I047', StringHash("FMi-Val"), "4116000|332")
  call SaveStr(udg_hash, 'I03W', StringHash("FMi-Val"), "2118000|355")
  call SaveStr(udg_hash, 'I04E', StringHash("FMi-Val"), "5118000|343")
  call SaveStr(udg_hash, 'I040', StringHash("FMi-Val"), "3112000|320")
  call SaveStr(udg_hash, 'I048', StringHash("FMi-Val"), "4118000|340")
  call SaveStr(udg_hash, 'I04H', StringHash("FMi-Val"), "6112000|319")
  call SaveStr(udg_hash, 'I045', StringHash("FMi-Val"), "4112000|316")
  call SaveStr(udg_hash, 'I04G', StringHash("FMi-Val"), "6111000|310")
  call SaveStr(udg_hash, 'I04B', StringHash("FMi-Val"), "5112000|317")
  call SaveStr(udg_hash, 'I03P', StringHash("FMi-Val"), "2111000|311")
  call SaveStr(udg_hash, 'I046', StringHash("FMi-Val"), "4114000|324")
  call SaveStr(udg_hash, 'I04C', StringHash("FMi-Val"), "5114000|326")
  call SaveStr(udg_hash, 'I043', StringHash("FMi-Val"), "3118000|350")
  call SaveStr(udg_hash, 'I04J', StringHash("FMi-Val"), "6116000|338")
  call SaveStr(udg_hash, 'I04A', StringHash("FMi-Val"), "5111000|38")
  call SaveStr(udg_hash, 'I00P', StringHash("FMi-Val"), "0111000|35")
  call SaveStr(udg_hash, 'I03Z', StringHash("FMi-Val"), "3111000|310")
  call SaveStr(udg_hash, 'I04D', StringHash("FMi-Val"), "5116000|334")
  call SaveStr(udg_hash, 'I03U', StringHash("FMi-Val"), "2116000|343")
  call SaveStr(udg_hash, 'I03Q', StringHash("FMi-Val"), "2112000|317")
  call SaveStr(udg_hash, 'I04I', StringHash("FMi-Val"), "6114000|329")
  call SaveStr(udg_hash, 'I03T', StringHash("FMi-Val"), "2115000|336")
  call SaveStr(udg_hash, 'I03S', StringHash("FMi-Val"), "2114000|330")
  call SaveStr(udg_hash, 'I042', StringHash("FMi-Val"), "3116000|340")
  call SaveStr(udg_hash, 'I04K', StringHash("FMi-Val"), "6118000|348")
  call SaveStr(udg_hash, 'I041', StringHash("FMi-Val"), "3114000|330")
  call SaveStr(udg_hash, 'I03V', StringHash("FMi-Val"), "2117000|349")
  call SaveStr(udg_hash, 'I03R', StringHash("FMi-Val"), "2113000|324")
  call SaveStr(udg_hash, 'I03Y', StringHash("FMi-Val"), "2118000|368|f1000|g-1000")
  call SaveStr(udg_hash, 'I04L', StringHash("FMi-Val"), "6118000|357|f1000|g-1000")
  call SaveStr(udg_hash, 'I049', StringHash("FMi-Val"), "4118000|348|f-1000|g1000")
  call TriggerSleepAction(.1)
  call SaveStr(udg_hash, 'I044', StringHash("FMi-Val"), "3112000|357|f1000|g-1000")
  call SaveStr(udg_hash, 'I04F', StringHash("FMi-Val"), "5112000|351|f-1000|g1000")
  call SaveStr(udg_hash, 'I03X', StringHash("FMi-Val"), "4111000|38")
// 방어구류 - 구입가능 - 157
  call SaveStr(udg_hash, 'I05F', StringHash("FMi-Val"), "0182000|32")
  call SaveStr(udg_hash, 'I05K', StringHash("FMi-Val"), "0102016|35")
  call SaveStr(udg_hash, 'I05Y', StringHash("FMi-Val"), "0172000|d1")
  call SaveStr(udg_hash, 'I06Q', StringHash("FMi-Val"), "7152000|32")
  call SaveStr(udg_hash, 'I06K', StringHash("FMi-Val"), "6162000|32")
  call SaveStr(udg_hash, 'I069', StringHash("FMi-Val"), "0202000|g600")
  call SaveStr(udg_hash, 'I06J', StringHash("FMi-Val"), "0206000|32|f1100|g550|52")
  call SaveStr(udg_hash, 'I05L', StringHash("FMi-Val"), "0103017|38")
  call SaveStr(udg_hash, 'I05I', StringHash("FMi-Val"), "0188000|38")
  call SaveStr(udg_hash, 'I064', StringHash("FMi-Val"), "0202000|g200")
  call SaveStr(udg_hash, 'I060', StringHash("FMi-Val"), "0172000|d1|e1")
  call SaveStr(udg_hash, 'I00I', StringHash("FMi-Val"), "0132000|51")
  call SaveStr(udg_hash, 'I06T', StringHash("FMi-Val"), "7158000|38")
  call SaveStr(udg_hash, 'I05Q', StringHash("FMi-Val"), "0106021|315|410")
  call SaveStr(udg_hash, 'I06N', StringHash("FMi-Val"), "6168000|38|b6")
  call SaveStr(udg_hash, 'I05T', StringHash("FMi-Val"), "0108000|320|430")
  call SaveStr(udg_hash, 'I05J', StringHash("FMi-Val"), "0101015|31")
  call SaveStr(udg_hash, 'I058', StringHash("FMi-Val"), "7194000|t6")
  call SaveStr(udg_hash, 'I06C', StringHash("FMi-Val"), "0202000|f800|g400|45")
  call SaveStr(udg_hash, 'I095', StringHash("FMi-Val"), "0133000|31|65|65|75")
  call SaveStr(udg_hash, 'I078', StringHash("FMi-Val"), "0146000|31|52|610|710")
  call SaveStr(udg_hash, 'I05G', StringHash("FMi-Val"), "0184000|34")
  call SaveStr(udg_hash, 'I06R', StringHash("FMi-Val"), "7154000|34")
  call SaveStr(udg_hash, 'I06L', StringHash("FMi-Val"), "6164000|34|b2")
  call SaveStr(udg_hash, 'I06U', StringHash("FMi-Val"), "7158000|34")
  call SaveStr(udg_hash, 'I059', StringHash("FMi-Val"), "7195000|t8")
  call SaveStr(udg_hash, 'I075', StringHash("FMi-Val"), "0146000|32|g100|61|c3|410|75")
  call SaveStr(udg_hash, 'I081', StringHash("FMi-Val"), "4208000|32|f-1000|g1000|c2|75")
  call SaveStr(udg_hash, 'I063', StringHash("FMi-Val"), "0201000|32")
  call SaveStr(udg_hash, 'I073', StringHash("FMi-Val"), "0142000|a1|c1|75")
  call SaveStr(udg_hash, 'I07H', StringHash("FMi-Val"), "0132000|53")
  call SaveStr(udg_hash, 'I05B', StringHash("FMi-Val"), "7197000|t14")
  call SaveStr(udg_hash, 'I07E', StringHash("FMi-Val"), "0132000|51|65")
  call SaveStr(udg_hash, 'I06H', StringHash("FMi-Val"), "-0202000|g1600|a-2|b-2|c-6|d-6|e-2")
  call SaveStr(udg_hash, 'I05W', StringHash("FMi-Val"), "0188000|38|410|75|m1")
  call SaveStr(udg_hash, 'I06Y', StringHash("FMi-Val"), "7158000|01~300|38|52|62")
  call SaveStr(udg_hash, 'I05C', StringHash("FMi-Val"), "7198000|t14")
  call SaveStr(udg_hash, 'I05D', StringHash("FMi-Val"), "7194000|t16")
  call TriggerSleepAction(.1)
  call SaveStr(udg_hash, 'I093', StringHash("FMi-Val"), "6208000|32|f1250|g1250|55|e2|32")
  call SaveStr(udg_hash, 'I00H', StringHash("FMi-Val"), "0131000")
  call SaveStr(udg_hash, 'I07G', StringHash("FMi-Val"), "0134000|31|65|75|32")
  call SaveStr(udg_hash, 'I077', StringHash("FMi-Val"), "0146000|31|410|710")
  call SaveStr(udg_hash, 'I096', StringHash("FMi-Val"), "0133000|31|55|65|75")
  call SaveStr(udg_hash, 'I079', StringHash("FMi-Val"), "0146000|31|a3|710")
  call SaveStr(udg_hash, 'I05A', StringHash("FMi-Val"), "7196000|t10")
  call SaveStr(udg_hash, 'I07C', StringHash("FMi-Val"), "0132000|610")
  call SaveStr(udg_hash, 'I062', StringHash("FMi-Val"), "0174000|37")
  call SaveStr(udg_hash, 'I06B', StringHash("FMi-Val"), "0202000|f1200")
  call SaveStr(udg_hash, 'I05U', StringHash("FMi-Val"), "0184000|36|45|72")
  call SaveStr(udg_hash, 'I071', StringHash("FMi-Val"), "0142000|c2")
  call SaveStr(udg_hash, 'I067', StringHash("FMi-Val"), "0202000|g400")
  call SaveStr(udg_hash, 'I074', StringHash("FMi-Val"), "0145000|32|f100|61|a3|75")
  call SaveStr(udg_hash, 'I06P', StringHash("FMi-Val"), "6166000|36|52|62|420")
  call SaveStr(udg_hash, 'I06O', StringHash("FMi-Val"), "6165000|34|52|62|420")
  call SaveStr(udg_hash, 'I06E', StringHash("FMi-Val"), "0202000|32|f1200|g600|420")
  call SaveStr(udg_hash, 'I06F', StringHash("FMi-Val"), "0205000|33|f1200|g600|420")
  call SaveStr(udg_hash, 'I086', StringHash("FMi-Val"), "2208200|32|f2000|g-500|55|a2|32")
  call SaveStr(udg_hash, 'I087', StringHash("FMi-Val"), "3208000|32|g-750|b2|85|31")
  call SaveStr(udg_hash, 'I070', StringHash("FMi-Val"), "0142000|c1")
  call SaveStr(udg_hash, 'I061', StringHash("FMi-Val"), "0172000|a1|e1")
  call SaveStr(udg_hash, 'I06I', StringHash("FMi-Val"), "0204000|32|f1000|g500|52")
  call TriggerSleepAction(.1)
  call SaveStr(udg_hash, 'I05E', StringHash("FMi-Val"), "7197000|t12")
  call SaveStr(udg_hash, 'I072', StringHash("FMi-Val"), "0142000|a2")
  call SaveStr(udg_hash, 'I06Z', StringHash("FMi-Val"), "0142000|a1")
  call SaveStr(udg_hash, 'I05V', StringHash("FMi-Val"), "0186000|38|410|73")
  call SaveStr(udg_hash, 'I06W', StringHash("FMi-Val"), "7155000|34|51|61|410")
  call SaveStr(udg_hash, 'I06X', StringHash("FMi-Val"), "7156000|36|51|61|410")
  call SaveStr(udg_hash, 'I08R', StringHash("FMi-Val"), "0122000|31")
  call SaveStr(udg_hash, 'I05H', StringHash("FMi-Val"), "0186000|36")
  call SaveStr(udg_hash, 'I05Z', StringHash("FMi-Val"), "0172000|e1")
  call SaveStr(udg_hash, 'I06S', StringHash("FMi-Val"), "7156000|36")
  call SaveStr(udg_hash, 'I05P', StringHash("FMi-Val"), "0105020|313|410")
  call SaveStr(udg_hash, 'I06M', StringHash("FMi-Val"), "6166000|36|b4")
  call SaveStr(udg_hash, 'I094', StringHash("FMi-Val"), "5208000|32|f-1000|g1000|d2|75")
  call SaveStr(udg_hash, 'I07D', StringHash("FMi-Val"), "0132000|52")
  call SaveStr(udg_hash, 'I068', StringHash("FMi-Val"), "0202000|f800")
  call SaveStr(udg_hash, 'I07Z', StringHash("FMi-Val"), "0136000|h1|73")
  call SaveStr(udg_hash, 'I07X', StringHash("FMi-Val"), "0176000|33|h1")
  call SaveStr(udg_hash, 'I06V', StringHash("FMi-Val"), "7158000|35|f-1500|g1000|712")
  call SaveStr(udg_hash, 'I00J', StringHash("FMi-Val"), "0132000|65")
  call SaveStr(udg_hash, 'I05M', StringHash("FMi-Val"), "0104017|310|45")
  call SaveStr(udg_hash, 'I06G', StringHash("FMi-Val"), "-0202000|f2400|a-6|b-2|c-2|d-2|e-6")
  call SaveStr(udg_hash, 'I07I', StringHash("FMi-Val"), "0134000|51|65")
  call SaveStr(udg_hash, 'I009', StringHash("FMi-Val"), "0131000|31")
  call SaveStr(udg_hash, 'I07F', StringHash("FMi-Val"), "0132000|32")
  call SaveStr(udg_hash, 'I05O', StringHash("FMi-Val"), "0104018|318|420")
  call SaveStr(udg_hash, 'I056', StringHash("FMi-Val"), "7192000|f50|g50|t2")
  call SaveStr(udg_hash, 'I05S', StringHash("FMi-Val"), "0106022|320|430")
  call TriggerSleepAction(.1)
  call SaveStr(udg_hash, 'I05R', StringHash("FMi-Val"), "0107022|318|430")
  call SaveStr(udg_hash, 'I05N', StringHash("FMi-Val"), "0104019|318|420")
  call SaveStr(udg_hash, 'I065', StringHash("FMi-Val"), "0202000|f400")
  call SaveStr(udg_hash, 'I06A', StringHash("FMi-Val"), "0202000|f800|g400")
  call SaveStr(udg_hash, 'I076', StringHash("FMi-Val"), "0146000|31")
  call SaveStr(udg_hash, 'I066', StringHash("FMi-Val"), "0202000|f400|g200")
  call SaveStr(udg_hash, 'I097', StringHash("FMi-Val"), "0135000|31|55|65|75|31|55|65|75")
  call SaveStr(udg_hash, 'I07A', StringHash("FMi-Val"), "0146000|31|f150|710")
  call SaveStr(udg_hash, 'I057', StringHash("FMi-Val"), "7193000|t4")
//캠페인, 무기 101개
  call SaveStr(udg_hash, 'I02C', StringHash("FMi-Val"), "-0128011")
  call SaveStr(udg_hash, 'I029', StringHash("FMi-Val"), "-0128042")
  call SaveStr(udg_hash, 'I02B', StringHash("FMi-Val"), "-0128011")
  call SaveStr(udg_hash, 'I035', StringHash("FMi-Val"), "-01580")
  call SaveStr(udg_hash, 'I028', StringHash("FMi-Val"), "-0128011")
  call SaveStr(udg_hash, 'I032', StringHash("FMi-Val"), "-01580")
  call SaveStr(udg_hash, 'I01Y', StringHash("FMi-Val"), "-0108007")
  call SaveStr(udg_hash, 'I01T', StringHash("FMi-Val"), "-0108007")
  call SaveStr(udg_hash, 'I01R', StringHash("FMi-Val"), "-0108007")
  call SaveStr(udg_hash, 'I02S', StringHash("FMi-Val"), "-01480")
  call SaveStr(udg_hash, 'I01O', StringHash("FMi-Val"), "-0108007")
  call SaveStr(udg_hash, 'I01P', StringHash("FMi-Val"), "-0108007")
  call SaveStr(udg_hash, 'I02W', StringHash("FMi-Val"), "-01480")
  call SaveStr(udg_hash, 'I02V', StringHash("FMi-Val"), "-01480")
  call SaveStr(udg_hash, 'I02X', StringHash("FMi-Val"), "-01480")
  call SaveStr(udg_hash, 'I04N', StringHash("FMi-Val"), "-01480")
  call SaveStr(udg_hash, 'I01S', StringHash("FMi-Val"), "-0118007")
  call SaveStr(udg_hash, 'I01Q', StringHash("FMi-Val"), "-0118007")
  call SaveStr(udg_hash, 'I01W', StringHash("FMi-Val"), "-0108007")
  call SaveStr(udg_hash, 'I01V', StringHash("FMi-Val"), "-0108007")
  call SaveStr(udg_hash, 'I01U', StringHash("FMi-Val"), "-0108007")
  call SaveStr(udg_hash, 'I030', StringHash("FMi-Val"), "-01480")
  call SaveStr(udg_hash, 'I02Z', StringHash("FMi-Val"), "-01480")
  call SaveStr(udg_hash, 'I02Y', StringHash("FMi-Val"), "-01480")
  call SaveStr(udg_hash, 'I01X', StringHash("FMi-Val"), "-01080")
  call SaveStr(udg_hash, 'I02T', StringHash("FMi-Val"), "-01480")
  
  call SaveStr(udg_hash, 'I02M', StringHash("FMi-Val"), "2062007|0285~360")
  call SaveStr(udg_hash, 'I01L', StringHash("FMi-Val"), "2017007|0225~315|84.0")
  call SaveStr(udg_hash, 'I02A', StringHash("FMi-Val"), "3028041|0805~805|m8")
  call SaveStr(udg_hash, 'I024', StringHash("FMi-Val"), "3025011|0197~197|m5")
  call SaveStr(udg_hash, 'I018', StringHash("FMi-Val"), "2012008|060~90")
  call SaveStr(udg_hash, 'I01J', StringHash("FMi-Val"), "2017007|0201~291|83.0")
  call SaveStr(udg_hash, 'I014', StringHash("FMi-Val"), "0011003|06~21")
  call TriggerSleepAction(.1)
  call SaveStr(udg_hash, 'I01Z', StringHash("FMi-Val"), "2012007|0315~405")
  call SaveStr(udg_hash, 'I01E', StringHash("FMi-Val"), "2014007|0165~225")
  call SaveStr(udg_hash, 'I034', StringHash("FMi-Val"), "3046002|01~2415|830.0|m3")
  call SaveStr(udg_hash, 'I022', StringHash("FMi-Val"), "3023011|077~77|m3")
  call SaveStr(udg_hash, 'I04M', StringHash("FMi-Val"), "2013009|099~51")
  call SaveStr(udg_hash, 'I019', StringHash("FMi-Val"), "2013009|093~123")
  call SaveStr(udg_hash, 'I03J', StringHash("FMi-Val"), "4086033|0180~270|oO-2|#단일 캐스팅 -2초|oP-1|#범위 캐스팅 -1초")
  call SaveStr(udg_hash, 'I03L', StringHash("FMi-Val"), "4083024|090~120|oZ*.8|#전체 캐스팅 -20%")
  call SaveStr(udg_hash, 'I03G', StringHash("FMi-Val"), "4082014|045~60")
  call SaveStr(udg_hash, 'I03H', StringHash("FMi-Val"), "4084014|045~60|oO-1.5|#단일 캐스팅 -1.5초")
  call SaveStr(udg_hash, 'I03N', StringHash("FMi-Val"), "4088014|0210~300")
  call SaveStr(udg_hash, 'I03K', StringHash("FMi-Val"), "4087043|0120~300|oZ-1|#전체 캐스팅 -1초|oZ*.8|#전체 캐스팅 -20%")
  call SaveStr(udg_hash, 'I03F', StringHash("FMi-Val"), "4082014|030~45|d1")
  call SaveStr(udg_hash, 'I03I', StringHash("FMi-Val"), "4085039|060~120|oC-2|#저주 캐스팅 -2초|oZ*.85|#전체 캐스팅 -15%")
  call SaveStr(udg_hash, 'I03M', StringHash("FMi-Val"), "4088023|0150~225")
  call SaveStr(udg_hash, 'I013', StringHash("FMi-Val"), "0011002|06~36")
  call SaveStr(udg_hash, 'I033', StringHash("FMi-Val"), "3046002|01~945|820.0|m2")
  call SaveStr(udg_hash, 'I080', StringHash("FMi-Val"), "6056027|0270~300|a3")
  call SaveStr(udg_hash, 'I01A', StringHash("FMi-Val"), "2013010|099~137")
  call SaveStr(udg_hash, 'I02R', StringHash("FMi-Val"), "2066030|0240~330|90.50")
  call SaveStr(udg_hash, 'I01B', StringHash("FMi-Val"), "2014007|0102~162")
  call SaveStr(udg_hash, 'I02H', StringHash("FMi-Val"), "3035036|01~394|90.25")
  call SaveStr(udg_hash, 'I02F', StringHash("FMi-Val"), "3033035|01~154|90.15")
  call SaveStr(udg_hash, 'I02D', StringHash("FMi-Val"), "3031013|01~60|90.05")
  call SaveStr(udg_hash, 'I02J', StringHash("FMi-Val"), "3037037|01~1006|90.35|m2")
  call SaveStr(udg_hash, 'I02G', StringHash("FMi-Val"), "3034036|01~246|90.2")
  call SaveStr(udg_hash, 'I02I', StringHash("FMi-Val"), "3036037|01~630|90.3|m1")
  call SaveStr(udg_hash, 'I02E', StringHash("FMi-Val"), "3032013|01~96|90.1")
  call SaveStr(udg_hash, 'I02K', StringHash("FMi-Val"), "3038038|01~1610|90.4|m3")
  call SaveStr(udg_hash, 'I020', StringHash("FMi-Val"), "3021011|030~30|m1")
  call SaveStr(udg_hash, 'I017', StringHash("FMi-Val"), "2012006|060~90")
  call SaveStr(udg_hash, 'I01D', StringHash("FMi-Val"), "2014007|0147~207")
  call SaveStr(udg_hash, 'I02Q', StringHash("FMi-Val"), "2065025|0255~330|a2")
  call SaveStr(udg_hash, 'I01N', StringHash("FMi-Val"), "2017007|0240~330|")
  call SaveStr(udg_hash, 'I03O', StringHash("FMi-Val"), "4087000|0270~360")
  call SaveStr(udg_hash, 'I01H', StringHash("FMi-Val"), "2016007|0186~246|82.0")
  call SaveStr(udg_hash, 'I015', StringHash("FMi-Val"), "0011004|09~18")
  call SaveStr(udg_hash, 'I02N', StringHash("FMi-Val"), "2064026|0165~210|a1")
  call SaveStr(udg_hash, 'I026', StringHash("FMi-Val"), "3027012|0503~503|m7")
  call SaveStr(udg_hash, 'I082', StringHash("FMi-Val"), "6058040|01200~1500|310")
  call SaveStr(udg_hash, 'I02O', StringHash("FMi-Val"), "2064025|0141~225|a1")
  call SaveStr(udg_hash, 'I023', StringHash("FMi-Val"), "3024012|123~123|m4")
  call SaveStr(udg_hash, 'I025', StringHash("FMi-Val"), "3026012|0315~315|m6")
  call SaveStr(udg_hash, 'I000', StringHash("FMi-Val"), "-")
  call SaveStr(udg_hash, 'I021', StringHash("FMi-Val"), "3022011|048~48|m2")
  call SaveStr(udg_hash, 'I031', StringHash("FMi-Val"), "3043002|01~231|810.|m1")
  call SaveStr(udg_hash, 'I007', StringHash("FMi-Val"), "0011002|012~72|33|45")
  call SaveStr(udg_hash, 'I016', StringHash("FMi-Val"), "2012005|054~84")
  call SaveStr(udg_hash, 'I01F', StringHash("FMi-Val"), "2016007|0210~270|81.0")
  call SaveStr(udg_hash, 'I001', StringHash("FMi-Val"), "6053027|099~165|")
  call TriggerSleepAction(.1)
  call SaveStr(udg_hash, 'I02L', StringHash("FMi-Val"), "2063047|0144~189|e1")
  call SaveStr(udg_hash, 'I01M', StringHash("FMi-Val"), "2078045|01683~1818|f1500|55")
  call SaveStr(udg_hash, 'I01K', StringHash("FMi-Val"), "2077045|0999~1134|a3|85.0")
  call SaveStr(udg_hash, 'I01I', StringHash("FMi-Val"), "2076007|0603~693|a1|83.0")
  call SaveStr(udg_hash, 'I01G', StringHash("FMi-Val"), "2076007|0675~785|a1|81.5")
  call SaveStr(udg_hash, 'I01C', StringHash("FMi-Val"), "2014007|0120~180")
  call SaveStr(udg_hash, 'I02P', StringHash("FMi-Val"), "2065000|0270~360")
  call SaveStr(udg_hash, 'I027', StringHash("FMi-Val"), "3027011|0503~503|m7")
  call SaveStr(udg_hash, 'I03B', StringHash("FMi-Val"), "5086033|0180~270|oK-1.5|#힐 캐스팅 -1.5초|oL-1.5|#축복 캐스팅 -1.5초")
  call SaveStr(udg_hash, 'I03D', StringHash("FMi-Val"), "5083024|090~120|oZ*.8|#전체 캐스팅 -20%")
  call SaveStr(udg_hash, 'I037', StringHash("FMi-Val"), "5082014|030~45")
  call SaveStr(udg_hash, 'I039', StringHash("FMi-Val"), "5084014|045~60|oK-1.|#힐 캐스팅 -1초|oL-.5|#축복 캐스팅 -0.5초")
  call SaveStr(udg_hash, 'I03C', StringHash("FMi-Val"), "5087043|0120~180|oZ-1|#전체 캐스팅 -1초|oZ*.8|#전체 캐스팅 -20%")
  call SaveStr(udg_hash, 'I038', StringHash("FMi-Val"), "5082014|030~45|oL*.5|#축복 캐스팅 -50%")
  call SaveStr(udg_hash, 'I03F', StringHash("FMi-Val"), "4082014|030~45|oC*.5|#저주 캐스팅 -50%")
  call SaveStr(udg_hash, 'I09W', StringHash("FMi-Val"), "4081014|030~45|g50|oO*.67|#단일 캐스팅 -33%|5-10")
  call SaveStr(udg_hash, 'I036', StringHash("FMi-Val"), "5081014|030~45|g50|oK*.67|#힐 캐스팅 -33%|5-10")
  
  call SaveStr(udg_hash, 'I03A', StringHash("FMi-Val"), "5085039|060~120|oL-2|#축복 캐스팅 -2초|oZ*.85|#전체 캐스팅 -15%")
  call SaveStr(udg_hash, 'I03E', StringHash("FMi-Val"), "5088023|0150~225")
  call SaveStr(udg_hash, 'I02U', StringHash("FMi-Val"), "-21420")
endfunction

//===========================================================================
function InitTrig_Set_Items takes nothing returns nothing
    set gg_trg_Set_Items = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Set_Items, function Trig_Set_Items_Actions )
endfunction

//===========================================================================
// Trigger: Set NPC
//===========================================================================
constant function FMi_Rect takes integer i returns rect
  if ( i == 0 ) then
    return gg_rct_TMi_Rect_00
  elseif ( i == 1 ) then
    return gg_rct_TMi_Rect_01
  elseif ( i == 2 ) then
    return gg_rct_TMi_Rect_02
  elseif ( i == 3 ) then
    return gg_rct_TMi_Rect_03
  elseif ( i == 4 ) then
    return gg_rct_TMi_Rect_04
  elseif ( i == 5 ) then
    return gg_rct_TMi_Rect_05
  elseif ( i == 6 ) then
    return gg_rct_TMi_Rect_06
  elseif ( i == 7 ) then
    return gg_rct_TMi_Rect_07
  elseif ( i == 8 ) then
    return gg_rct_TMi_Rect_08
  elseif ( i == 9 ) then
    return gg_rct_TMi_Rect_09
  elseif ( i == 10 ) then
    return gg_rct_TMi_Rect_10
  elseif ( i == 11 ) then
    return gg_rct_TMi_Rect_11
  elseif ( i == 12 ) then
    return gg_rct_TMi_Rect_12
  else
    return bj_mapInitialPlayableArea
  endif
endfunction

function Condi_NPC takes nothing returns boolean
 return ( GetUnitAbilityLevel(GetFilterUnit(), 'A003') > 0 )
endfunction

function Action_NPC takes nothing returns nothing
  call TriggerRegisterUnitEvent(gg_trg_Sys_NPC_No_Attack, GetEnumUnit(), EVENT_UNIT_ATTACKED)
endfunction
function Trig_Set_NPC_Actions takes nothing returns nothing
  call DestroyTrigger(GetTriggeringTrigger())
  set gg_trg_Set_NPC = null
  set udg_temp_g = GetUnitsInRectMatching(FMi_Rect(-1), Condition(function Condi_NPC))
  call ForGroup(udg_temp_g, function Action_NPC)
  call DestroyGroup(udg_temp_g)
endfunction

//===========================================================================
function InitTrig_Set_NPC takes nothing returns nothing
    set gg_trg_Set_NPC = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Set_NPC, function Trig_Set_NPC_Actions )
endfunction

//===========================================================================
// Trigger: Set Drops
//
// 아이템　　86　　　'I001'　'I000'　// 0을 먹으면 1으로 됨. (레벨 != 3, 버려진템 변경)
//===========================================================================
function Trig_Setting_M_DropItems_Actions takes nothing returns nothing
  //한군데 최대 9마리 몬스터, 20개 아이템 가능
  call DestroyTrigger( GetTriggeringTrigger() )
  set gg_trg_Set_Drops = null
  // -------- -------- -------- -------- -------- -------- -------- -------- --------
  //밀 - 밀다발 - 150%
  set udg_SysD_drop_i = 1
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'o000'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 1
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I00O'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 150.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 1
  // -------- -------- -------- -------- -------- -------- -------- -------- --------
  //포테 놀 - 채찍
  set udg_SysD_drop_i = 3
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n030'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 1
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I031'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 1.25
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 1
  
call TriggerSleepAction(.05)
  //해안가: 퐁퐁이
  set udg_SysD_drop_i = 4
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n02H'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 1
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I074'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 1.4
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I062'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = .08
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 2
  
  //난파선: 보스
  set udg_SysD_drop_i = 5
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n02O'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 1
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I075'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 16.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I062'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 10.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I01C'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 60.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'I01D'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 40.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = 'I01E'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = 28.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 6, SysInt(0,5))] = 'I00W'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 6, SysInt(0,5))] = 100.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 6, SysInt(0,5))] = 'I09U'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 7, SysInt(0,5))] = 50.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 7
  
  
  //해안가 몬스터들
  set udg_SysD_drop_i = 6
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n02D'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n02E'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n02F'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 4, SysInt(0,4))] = 'n02G'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 5, SysInt(0,4))] = 'n02H'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 6, SysInt(0,4))] = 'n02I'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 6
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I06I'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .55
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I05U'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = .5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I07G'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = .2
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'I01C'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = .75
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = 'I01D'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = .4
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 6, SysInt(0,5))] = 'I01E'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 6, SysInt(0,5))] = .2
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 6
  
call TriggerSleepAction(.05)
  //해안가 몬스터들(상급)
  set udg_SysD_drop_i = 7
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n02G'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n02H'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n02I'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 3
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I06W'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .4
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I06O'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = .3
  
  //난파선 몬스터들
  set udg_SysD_drop_i = 8
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n02J'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n02K'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n02L'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 4, SysInt(0,4))] = 'n02M'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 5, SysInt(0,4))] = 'n02N'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I06J'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .2
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I05V'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = .25
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I07G'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = .3
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'I075'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = .08
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 4
  
  //난파선 몬스터들(상급)
  set udg_SysD_drop_i = 9
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n02L'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n02M'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n02N'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 3
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I06X'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .45
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I06P'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = .3
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 2
  
call TriggerSleepAction(.05)
  //고블린 FAMILY
  set udg_SysD_drop_i = 10
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n018'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n00D'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n01S'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 4, SysInt(0,4))] = 'n019'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 5, SysInt(0,4))] = 'n01T'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 6, SysInt(0,4))] = 'n01R'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 6
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I02N'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .8
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I02O'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = .7
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I095'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = .35
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'wolg'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 8.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = 'I01C'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = .7
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 6, SysInt(0,5))] = 'I01D'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 6, SysInt(0,5))] = .4
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 7, SysInt(0,5))] = 'I01E'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 7, SysInt(0,5))] = .15
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 8, SysInt(0,5))] = 'I02L'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 8, SysInt(0,5))] = .8
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 8
  
  //고블린 FAMILY (마법사)
  set udg_SysD_drop_i = 11
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n00E'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n01A'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n00F'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 4, SysInt(0,4))] = 'n01U'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 5, SysInt(0,4))] = 'n01B'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 6, SysInt(0,4))] = 'n01V'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 6
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I03I'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .4
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I03A'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = .35
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I02Q'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = .3
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'wolg'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 8.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 4
  
  //지하 (초반귀걸이) 지네-순옥
  set udg_SysD_drop_i = 12
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n00Q'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n013'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n01Y'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 3
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I070'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 4.5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'azhr'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 8.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I07Y'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 5.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 3
  
call TriggerSleepAction(.05)
  //지하 (초반귀걸이) 박쥐-쌍은
  set udg_SysD_drop_i = 12
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n00S'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n01D'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 2
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I06Z'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 4.5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I01A'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 2.2
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I04M'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 1.2
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'I07Y'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 5.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 4
  
  //지하 미믹
  set udg_SysD_drop_i = 13
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n00W'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n024'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n025'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 3
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I03J'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 3.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I03B'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 3.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I01C'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 1.5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'I01D'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = .7
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = 'I01E'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = .4
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 6, SysInt(0,5))] = 'I07Y'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 6, SysInt(0,5))] = 3.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 6
  
call TriggerSleepAction(.05)
  //지하 흰박쥐 - 은제
  set udg_SysD_drop_i = 14
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n00X'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n01F'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n026'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 3
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I05P'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 4.5
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 1
  
  //지하 카디 - 금제
  set udg_SysD_drop_i = 15
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n00Y'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n01G'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n027'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 3
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I05Q'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .6
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I01G'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = .15
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I01I'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = .12
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 3
  
call TriggerSleepAction(.05)
  //지하 Boss
  set udg_SysD_drop_i = 16
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n010'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n011'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 2
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I01I'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 5.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I01G'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 5.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I027'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 4.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'I03M'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 6.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = 'I03E'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = 6.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 6, SysInt(0,5))] = 'I02J'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 6, SysInt(0,5))] = 8.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 7, SysInt(0,5))] = 'I07Y'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 7, SysInt(0,5))] = 50.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 8, SysInt(0,5))] = 'I034'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 8, SysInt(0,5))] = 2.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 8
  
call TriggerSleepAction(.05)
  //포테의숲 FAMILY
  set udg_SysD_drop_i = 17
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n02Y'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n02Z'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n030'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 4, SysInt(0,4))] = 'n031'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 4
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I03L'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 2.2
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I03D'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 2.2
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I096'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = .6
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'I01A'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 1.4
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = 'I04M'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = .8
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 6, SysInt(0,5))] = 'I01C'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 6, SysInt(0,5))] = .5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 7, SysInt(0,5))] = 'I01D'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 7, SysInt(0,5))] = .3
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 8, SysInt(0,5))] = 'I01E'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 8, SysInt(0,5))] = .2
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 8
  
  //늑대/늑인
  set udg_SysD_drop_i = 18
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n005'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n017'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n01P'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 4, SysInt(0,4))] = 'n006'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 5, SysInt(0,4))] = 'n01Q'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I031'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .25
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I005'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 50.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I01A'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 1.5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'I04M'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 1.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 4
  
call TriggerSleepAction(.05)
  //ㅅ사마구/벌
  set udg_SysD_drop_i = 19
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n00A'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n029'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n02B'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 4, SysInt(0,4))] = 'n016'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 5, SysInt(0,4))] = 'n01O'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 6, SysInt(0,4))] = 'n028'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 6
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I038'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .4
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I018'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = .6
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I06C'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = .3
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'I064'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 3.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = 'I065'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = 3.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 6, SysInt(0,5))] = 'azhr'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 6, SysInt(0,5))] = 9.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 7, SysInt(0,5))] = 'I00U'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 7, SysInt(0,5))] = 8.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 7
  
call TriggerSleepAction(.05)
  //우드 5써 이상
  set udg_SysD_drop_i = 20
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n00G'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n01V'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n01C'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 4, SysInt(0,4))] = 'n00H'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 5, SysInt(0,4))] = 'n01W'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 6, SysInt(0,4))] = 'n00I'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 6
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I02J'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .02
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I027'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = .01
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I026'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = .02
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 3
  
  //아칸더스
  set udg_SysD_drop_i = 21
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n02B'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n005'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n028'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 4, SysInt(0,4))] = 'n006'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 5, SysInt(0,4))] = 'n017'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 6, SysInt(0,4))] = 'n01P'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 7, SysInt(0,4))] = 'n01Q'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 8, SysInt(0,4))] = 'n016'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 8
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I008'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 55.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I00U'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 4.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 2
  
call TriggerSleepAction(.05)
  //고기 ( 동물 )
  set udg_SysD_drop_i = 22
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n031'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n005'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n017'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n01P'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 4
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'wtlg'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 12.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 1
  
  //조화의 던전
  set udg_SysD_drop_i = 23
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n03D'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n03E'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n03L'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n03F'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n03H'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n03I'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n03K'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 7
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I05P'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I05Q'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = .25
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I02R'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = .3
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 3
  
  //조화의 던전
  set udg_SysD_drop_i = 24
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n03G'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n03J'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n03L'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 3
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I080'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .45
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I033'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = .4
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I03J'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = .4
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'I03B'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = .4
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 4
  
  //조화의 던전
  set udg_SysD_drop_i = 25
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n03L'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 1
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I07Z'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 3.5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I07X'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 2.5
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 2
  
call TriggerSleepAction(.05)
  //사막
  set udg_SysD_drop_i = 26
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n037'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n038'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n039'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 4, SysInt(0,4))] = 'n03A'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 4
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'azhr'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 7.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I095'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = .5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I01C'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 1.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'I01D'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = .5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = 'I01E'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = .25
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 5
  
call TriggerSleepAction(.05)
  //사막
  set udg_SysD_drop_i = 27
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n01B'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n00G'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n01V'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 4, SysInt(0,4))] = 'n01C'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 5, SysInt(0,4))] = 'n01H'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 6, SysInt(0,4))] = 'n01W'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 7, SysInt(0,4))] = 'n00I'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 8, SysInt(0,4))] = 'n026'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 9, SysInt(0,4))] = 'n01G'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 10, SysInt(0,4))] = 'n00Z'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 11, SysInt(0,4))] = 'n027'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 12, SysInt(0,4))] = 'n01H'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 12
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I084'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .75
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I00V'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 4.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 2
  
call TriggerSleepAction(.05)
  set udg_SysD_drop_i = 28
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n03P'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n03X'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 2
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I084'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'gcel'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = .75
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I01K'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = .03
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'I086'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = .1
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 4
  set udg_SysD_drop_i = 29
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n03Q'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n03U'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 2
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I084'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'rde1'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = .75
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I02A'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = .02
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'I02K'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = .01
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = 'I087'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = .1
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 5
  set udg_SysD_drop_i = 30
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n03R'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n03V'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 2
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I084'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'rde2'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = .75
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I03K'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = .03
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'I081'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = .1
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 4
  set udg_SysD_drop_i = 31
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n03S'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n03W'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 2
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I084'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'rde3'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = .75
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I03C'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = .03
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'I094'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = .1
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 4
  set udg_SysD_drop_i = 32
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n03T'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n03Y'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 2
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I084'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'clfm'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = .75
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I082'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = .03
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'I093'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = .1
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 4
  
call TriggerSleepAction(.05)
  //슈리커 갓
  set udg_SysD_drop_i = 33
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n00G'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n01C'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n01W'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 3
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'whwd'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 12.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 1
  
  //좀비
  set udg_SysD_drop_i = 34
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n04C'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n047'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n04A'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 4, SysInt(0,4))] = 'n04B'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 5, SysInt(0,4))] = 'n049'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 6, SysInt(0,4))] = 'n048'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 6
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I05O'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .02
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I084'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = .4
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I097'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = .008
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'I09Q'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 1.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 4
  
  //마법좀비
  set udg_SysD_drop_i = 35
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n04C'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 1
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I097'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = .04
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I084'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 2.5
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 2
  
call TriggerSleepAction(.05)
  //광산
  set udg_SysD_drop_i = 36
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n04P'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n04Q'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n04J'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 4, SysInt(0,4))] = 'n04D'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 5, SysInt(0,4))] = 'n04E'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 6, SysInt(0,4))] = 'n04F'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 7, SysInt(0,4))] = 'n04G'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 8, SysInt(0,4))] = 'n04I'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 9, SysInt(0,4))] = 'n04R'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 10, SysInt(0,4))] = 'n04S'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 11, SysInt(0,4))] = 'n04H'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 11
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I06Y'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 1.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I084'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 7.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 'I05W'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 3, SysInt(0,5))] = 1.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = 'I05E'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 4, SysInt(0,5))] = .6
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = 'I062'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = .6
  /*set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = 'I09Q'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 5, SysInt(0,5))] = 0.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 6, SysInt(0,5))] = 'I09R'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 6, SysInt(0,5))] = 0.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 7, SysInt(0,5))] = 'I09S'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 7, SysInt(0,5))] = 0.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 8, SysInt(0,5))] = 'I09T'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 8, SysInt(0,5))] = 0.
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 9, SysInt(0,5))] = 'I09U'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 9, SysInt(0,5))] = 0.*/
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 5
call TriggerSleepAction(.05)
  //광산
  set udg_SysD_drop_i = 37
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n04G'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 1
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I06V'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 2.5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I05B'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 1.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 2
  
call TriggerSleepAction(.05)
  
  set udg_SysD_drop_i = 40
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n04L'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 1
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I03Y'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 2.5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I05B'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 1.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 2
  set udg_SysD_drop_i = 41
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n04M'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 1
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I044'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 2.5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I05B'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 1.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 2
  set udg_SysD_drop_i = 42
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n04O'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 1
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I049'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 2.5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I05B'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 1.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 2
  set udg_SysD_drop_i = 43
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n04N'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 1
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I04F'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 2.5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I05B'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 1.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 2

  set udg_SysD_drop_i = 44
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n04K'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 1
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'I04L'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 2.5
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 'I05B'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 2, SysInt(0,5))] = 1.
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 2

  set udg_SysD_drop_i = 45
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 1, SysInt(0,4))] = 'n04V'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 2, SysInt(0,4))] = 'n04W'
  set udg_SysD_dropMonsterType[getIndex(udg_SysD_drop_i, 3, SysInt(0,4))] = 'n04X'
  set udg_SysD_dropMonN[udg_SysD_drop_i] = 3
  set udg_SysD_dropItems[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 'pgma'
  set udg_SysD_dropPb[getIndex(udg_SysD_drop_i, 1, SysInt(0,5))] = 12.5
  set udg_SysD_dropItemN[udg_SysD_drop_i] = 1
  call TriggerSleepAction(.05)
  //*Openning : 템드랍
  //------------------------------------------------
  
//debug call BJDebugMsg("OK!_Drops")
endfunction

//===========================================================================
function InitTrig_Set_Drops takes nothing returns nothing
    set gg_trg_Set_Drops = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Set_Drops, function Trig_Setting_M_DropItems_Actions )
endfunction

//===========================================================================
// Trigger: Set Etc
//===========================================================================
function Condi_IsDmgTarget2 takes nothing returns boolean
 return ( GetOwningPlayer(GetFilterUnit()) == Player(PLAYER_NEUTRAL_AGGRESSIVE) ) or ( isHero(GetFilterUnit()) )
endfunction

function Condi_IsDmgTarget takes nothing returns boolean
 return ( GetOwningPlayer(GetFilterUnit()) == Player(PLAYER_NEUTRAL_AGGRESSIVE) )
endfunction
function GroupEnumUnitsInRect2 takes group whichGroup, rect r, boolexpr filter returns group
  call GroupEnumUnitsInRect(whichGroup, r, filter)
  //call DestroyBoolExpr(filter) - 누수
  return whichGroup
endfunction

function GroupAdd2 takes nothing returns nothing
  call TriggerRegisterUnitEvent(DmgTrigger_v6, GetEnumUnit(), EVENT_UNIT_DAMAGED)
endfunction
function AddDmgEvt takes unit u returns nothing
  set udg_SysJ_Count = udg_SysJ_Count + 1
  if ( udg_SysJ_Count > 9999 ) then
    call BJDebugMsg("데미지 시스템 초기화! - " + I2S(udg_SysJ_Count))
    set udg_SysJ_Count = 0
    call DestroyTrigger(DmgTrigger_v6)
    call ExecuteFunc("DmgSys_Init_v6")
    set udg_temp_g = GroupEnumUnitsInRect2(CreateGroup(), FMi_Rect(-1), Condition(function Condi_IsDmgTarget2))
    call ForGroup(udg_temp_g, function GroupAdd2)
    call DestroyGroup(udg_temp_g)
  else
    call TriggerRegisterUnitEvent(DmgTrigger_v6, u, EVENT_UNIT_DAMAGED)
  endif  
endfunction

function GroupAdd takes nothing returns nothing
  call AddDmgEvt(GetEnumUnit())
  if ( GetUnitTypeId(GetEnumUnit()) == 'o001' ) then
    call TriggerRegisterUnitEvent(gg_trg_Sys_Dummy_Attacked, GetEnumUnit(), EVENT_UNIT_DAMAGED)
    call SaveReal(udg_hash, GetHandleId(GetEnumUnit()), StringHash("Rev-LocX"), GetWidgetX(GetEnumUnit()))
    call SaveReal(udg_hash, GetHandleId(GetEnumUnit()), StringHash("Rev-LocY"), GetWidgetY(GetEnumUnit()))
  elseif ( GetUnitTypeId(GetEnumUnit()) == 'nder' ) then
    call TriggerRegisterUnitEvent(gg_trg_Sys_Elk, GetEnumUnit(), EVENT_UNIT_DEATH)
  endif
  call SetUnitUserData(GetEnumUnit(), -1)
endfunction

function AddOnce takes nothing returns nothing
  //최초 게임 시작시 1회
  set udg_temp_g = GroupEnumUnitsInRect2(CreateGroup(), FMi_Rect(-1), Condition(function Condi_IsDmgTarget))
  call ForGroup(udg_temp_g, function GroupAdd)
  call DestroyGroup(udg_temp_g)
endfunction

function Trig_Set_Etc_Actions takes nothing returns nothing
//멀티보드 실행
  call TriggerRegisterTimerEvent(gg_trg_Sys_MT_Set, 1., true)
  //F9창 만들기
  call TriggerExecute(gg_trg_Sys_F9_Set)
  call TriggerSleepAction(1.)
  call MultiboardMinimize(bj_lastCreatedMultiboard, true)
  call TriggerSleepAction(2.)
  //맵 안개
  //call FogEnable(true)
  //call FogMaskEnable(true)
  
  call CameraSetSmoothingFactor(200)
  //음악 재생
  call PlayMusic(gg_snd_15)
  //PlayMusicBJ(gg_snd_18)
  call ResumeMusic()

  //이벤트 유닛 (사슴)
  //우드랜드 대기실
  call CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'nder', -5888., 6016., bj_UNIT_FACING)
  //운디네
  call CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'nder', -23136., 1792., bj_UNIT_FACING)
  call CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'nder', -23136., 1792., bj_UNIT_FACING)
  //로톤 밭
  call CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'nder', 14976., -6144., bj_UNIT_FACING)
  //지하묘지
  call CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'nder', 13472., -18816., bj_UNIT_FACING)
  //여관
  call CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'nder', 28768., -28608., bj_UNIT_FACING)
  call CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'nder', 28768., -28608., bj_UNIT_FACING)
  call CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'nder', 28768., -28608., bj_UNIT_FACING)
  
  call DestroyTrigger(GetTriggeringTrigger())
  set gg_trg_Set_Etc = null
  
  call AddOnce()
endfunction

//===========================================================================
function InitTrig_Set_Etc takes nothing returns nothing
    set gg_trg_Set_Etc = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Set_Etc, function Trig_Set_Etc_Actions )
endfunction

//===========================================================================
// Trigger: Set FAL
//===========================================================================
/*
function msgCheck2 takes player p, integer i returns boolean
  if ( i == 0 ) then
    return true
  elseif ( i == -1 ) then
    call MSG(p, 1, 4, "세팅 파일 로드 실패: 인증 실패")
  elseif ( i == -2 ) then
    call MSG(p, 1, 4, "세팅 파일 로드 실패: 현재 사용중(동시로드 비허용 맵)")
  elseif ( i == -3 ) then
    call MSG(p, 1, 4, "세팅 파일 로드 실패: 이미 로드됨")
  endif
 return false
endfunction

if ( msgCheck2(p, JNObjectCharacterInit(JN_MAPID, udg_SysB_Name[P], JN_SECRETKEY, JNKeyWord[P])) ) then
*/

function JN_ServerLoad takes player p, integer i returns nothing
  if ( i == 0 ) then
    set JN_LoaderSlot[GetPlayerId(p)+1] = 0
    call JNLoadServerCode(p, "0_0")
  elseif ( i <= 5 ) then
    set JN_LoaderSlot[GetPlayerId(p)+1] = i
    call JNLoadServerCode(p, I2S(i))
/*
  if ( i == 0 ) then
    set JNKeyWord[P] = "Setting"
    call JNObjectCharacterResetCharacter(udg_SysB_Name[P])
    if ( msgCheck2(p, JNObjectCharacterInit(JN_MAPID, udg_SysB_Name[P], JN_SECRETKEY, JNKeyWord[P])) ) then
//debug call BJDebugMsg("SET FAL:" + JNObjectCharacterGetString(udg_SysB_Name[P], "0-0") + "회 ALL")
      call DzSyncData("JNStrSync", "||" + "0-0" + "||" + JNObjectCharacterGetString(udg_SysB_Name[P], "0-0") + "||")
      call DzSyncData("JNStrSync", "||" + "0-1" + "||" + JNObjectCharacterGetString(udg_SysB_Name[P], "0-1") + "||")
      call DzSyncData("JNStrSync", "||" + "0-2" + "||" + JNObjectCharacterGetString(udg_SysB_Name[P], "0-2") + "||")
      call DzSyncData("JNStrSync", "||" + "0-3" + "||" + JNObjectCharacterGetString(udg_SysB_Name[P], "0-3") + "||")
      call DzSyncData("JNStrSync", "||" + "0-4" + "||" + JNObjectCharacterGetString(udg_SysB_Name[P], "0-4") + "||")
      loop
        call DzSyncData("JNStrSync", "||" + "1-"+I2S(loopA) + "||" + JNObjectCharacterGetString(udg_SysB_Name[P], "1-"+I2S(loopA)) + "||")
        call DzSyncData("JNStrSync", "||" + "2-"+I2S(loopA) + "||" + JNObjectCharacterGetString(udg_SysB_Name[P], "2-"+I2S(loopA)) + "||")
        call DzSyncData("JNStrSync", "||" + "3-"+I2S(loopA) + "||" + JNObjectCharacterGetString(udg_SysB_Name[P], "3-"+I2S(loopA)) + "||")
        exitwhen loopA >= 5
        set loopA = loopA + 1
      endloop
      call DzSyncData("JNEndSync", "_")
debug    else
debug call BJDebugMsg("SET FAL Failed.")
      call TriggerSleepAction(.1)
    endif
  elseif ( i <= 5 ) then
    set JNKeyWord[P] = I2S(i)
    call JNObjectCharacterResetCharacter(udg_SysB_Name[P])
    if ( msgCheck2(p, JNObjectCharacterInit(JN_MAPID, udg_SysB_Name[P], JN_SECRETKEY, JNKeyWord[P])) ) then
//debug call BJDebugMsg("GO SET FAL no." + I2S(i))
      call DzSyncData("JNStrSync", "||" + "Code1" + "||" + JNObjectCharacterGetString(udg_SysB_Name[P], "Code1") + "||")
      call DzSyncData("JNStrSync", "||" + "Code2" + "||" + JNObjectCharacterGetString(udg_SysB_Name[P], "Code2") + "||")
      call DzSyncData("JNEndSync", "_")
debug    else
debug call BJDebugMsg("GO SET Failed : ")
    endif
    */
  else
    call MSG(p, 1, 4, "세팅 파일 로드 실패: 없는 키워드 - " + I2S(i))
  endif
endfunction
/*
function Trig_Set_FAL_Func008A takes nothing returns nothing
  set udg_FAL_Table0[GetPlayerId(GetEnumPlayer())+1] = Localtable.create(GetEnumPlayer(), "LoDSave\\"+udg_SysB_Name[GetPlayerId(GetEnumPlayer())+1]+"'s\\data0.txt")
  set udg_FAL_Table1[GetPlayerId(GetEnumPlayer())+1] = Localtable.create(GetEnumPlayer(), "LoDSave\\"+udg_SysB_Name[GetPlayerId(GetEnumPlayer())+1]+"'s\\data1.txt")
  set udg_FAL_Table2[GetPlayerId(GetEnumPlayer())+1] = Localtable.create(GetEnumPlayer(), "LoDSave\\"+udg_SysB_Name[GetPlayerId(GetEnumPlayer())+1]+"'s\\data2.txt")
  set udg_FAL_Table3[GetPlayerId(GetEnumPlayer())+1] = Localtable.create(GetEnumPlayer(), "LoDSave\\"+udg_SysB_Name[GetPlayerId(GetEnumPlayer())+1]+"'s\\data3.txt")
  set udg_FAL_Table4[GetPlayerId(GetEnumPlayer())+1] = Localtable.create(GetEnumPlayer(), "LoDSave\\"+udg_SysB_Name[GetPlayerId(GetEnumPlayer())+1]+"'s\\data4.txt")
  set udg_FAL_Table5[GetPlayerId(GetEnumPlayer())+1] = Localtable.create(GetEnumPlayer(), "LoDSave\\"+udg_SysB_Name[GetPlayerId(GetEnumPlayer())+1]+"'s\\data5.txt")
endfunction

function JN_LocalLoadALL takes nothing returns nothing
 local string filepath = "LoDSave\\PRELOAD.PRELOADER"
 local integer P = 1
//debug call BJDebugMsg("FAL SET...")
  call PreloadGenClear()
  call PreloadGenStart()
  call PreloadGenEnd(filepath)
  call Preloader(filepath)
  call ForForce(udg_temp_pg, function Trig_Set_FAL_Func008A)
  call TriggerSleepAction(1.)
  loop
    if ( GetPlayerController(Player(P-1)) == MAP_CONTROL_USER ) and ( GetPlayerSlotState(Player(P-1)) == PLAYER_SLOT_STATE_PLAYING ) then
//debug call BJDebugMsg("Set Fal2 Load-" + I2S(P))
      call Localtable(udg_FAL_Table0[P]).read(0.2, 10, null)
    endif
    exitwhen P >= bj_MAX_PLAYERS
    set P = P + 1
  endloop
 set filepath = null
endfunction
*/
function Trig_Set_FAL_Actions takes nothing returns nothing
 local integer P = 1
  //call JN_LocalLoadALL()
  call TriggerSleepAction(1.)
  loop
    if ( GetPlayerController(Player(P-1)) == MAP_CONTROL_USER ) and ( GetPlayerSlotState(Player(P-1)) == PLAYER_SLOT_STATE_PLAYING ) then
      call JN_ServerLoad(Player(P-1), 0)
      call TriggerSleepAction(.5)
    endif
    exitwhen P >= bj_MAX_PLAYERS
    set P = P + 1
  endloop
  call TriggerSleepAction(1.)
  call TriggerExecute(gg_trg_Quest_Set)
 call DestroyTrigger(GetTriggeringTrigger())
 set gg_trg_Set_FAL = null
endfunction

//===========================================================================
function InitTrig_Set_FAL takes nothing returns nothing
    set gg_trg_Set_FAL = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Set_FAL, function Trig_Set_FAL_Actions )
endfunction

//===========================================================================
// Trigger: Set Monster
//===========================================================================
constant function Map_Data takes integer i returns integer
  if ( i == 1 ) then
  //사냥터 갯수
    return 67
  elseif ( i == 2 ) then
  //마을 갯수
    return 17
  elseif ( i == 3 ) then
  //이동 구역 갯수
    return 19
  endif
 return 0
endfunction
constant function Hunting_Data takes integer i returns string
 if ( i < 0 ) then
  if ( i == -1 ) then
    return "노비스 마을"
  elseif ( i == -2 ) then
    return "호러캐슬 대기실"
  elseif ( i == -6 ) then
    return "밀레스 마을"
  elseif ( i == -7 ) then
    return "루어스 성"
  elseif ( i == -8 ) then
    return "루어스 왕실"
  elseif ( i == -9 ) then
    return "수오미 마을"
  elseif ( i == -10 ) then
    return "피에트 마을"
  elseif ( i == -11 ) then
    return "아벨 마을"
  elseif ( i == -12 ) then
    return "로톤 마을"
  elseif ( i == -13 ) then
    return "호엔 마을"
  elseif ( i == -14 ) then
    return "뤼케시온 마을"
  elseif ( i == -15 ) then
    return "여관"
  elseif ( i == -16 ) then
    return "마인 마을"
  elseif ( i == -17 ) then
    return "운디네 마을"
  endif
 else
  if ( i == 1 ) then
  //사냥터 이름 / 기타 데이터 (사냥터 특성)
    return "주인없는 호밀밭"
	//특성 추가 - 소환시 화려하지 않음
	//특성 추가 - 돌연변이 없음
  elseif ( i == 2 ) then
    return "팜팻 골짜기"
	//특성 추가 - 회피 30%
	//특성 추가 - 색깔이 랜덤
  elseif ( i == 3 ) then
    return "노비스 남쪽 숲"
	//＊체력 +30%, 크리 10%
  elseif ( i == 4 ) then
    return "루어스 경계 숲"
	//＊체력 +25%
  elseif ( i == 5 ) then
    return "옛 세계수 터"
	//＊체력 +30%, 크리 10%
  elseif ( i == 6 ) then
    return "큐르페이 동굴"
	//＊거대화 - HP300%/데미지 +200%, 경험치 200%, 돌연변이 없음.
  elseif ( i == 7 ) then
    return "오솔길"
	//＊회피 15%, 이동속도 +50%, 체력리젠 2%/초
  elseif ( i == 8 ) then
    return "숲 속 공터"
	//＊쉬운 보스(회피 25%, 마방 15%, 체력리젠 3%/초)
  elseif ( i == 9 ) then
    return "메아리치는 산 골짜기"
	//＊마방 20%, 회피 20%, 기본 체력
  elseif ( i == 10 ) then
    return "포테의 숲"
	//＊마방or회피 30%(랜덤), 이속 +100%, 공속 -67%, 데미지 +50%, 크리 10%x1.5
  elseif ( i == 11 ) then
    return "포테의 숲 골짜기"
	//＊일반몹) 힐 - 3초 캐스팅, 자신 체력 30% 회복, (스킬로 캔슬 가능)
    //이속 +100%, 데미지 +75%, 공속 -100%, 데미지감소 15%, 크리 15%x1.5
  elseif ( i == 12 ) then
    return "메마른 길"
	//＊체력회복 3%/s, 방어 +30 (물리 내성 15%)
  elseif ( i == 13 ) then
    return "황폐한 언덕"
	//＊체력 회복 4%/s, 방어 +40, 배쉬 15% 2초스턴
  elseif ( i == 14 ) then
    return "옛 바위 언덕"
	//＊체력회복 5%/s, 방어 +50, 배쉬 15%
  elseif ( i == 15 ) then
    return "농경지"
	//＊마방 30% / 회피 30% / 공속 +100% / 체력회복 10%/s 중 하나 (클릭으로 옵션 확인 가능)
  elseif ( i == 16 ) then
    return "지하묘지 최상층"
  elseif ( i == 17 ) then
    return "지하묘지 2층"
  elseif ( i == 18 ) then
    return "지하묘지 2.5층"
  elseif ( i == 19 ) then
    return "지하묘지 3층"
  elseif ( i == 20 ) then
    return "지하묘지 3.5층"
  elseif ( i == 21 ) then
    return "지하묘지 4층"
  elseif ( i == 22 ) then
    return "지하묘지 4.5층"
  elseif ( i == 23 ) then
    return "지하묘지 최하층"
  elseif ( i == 24 ) then
    return "\"오\"아시스 (입구)"
  elseif ( i == 25 ) then
    return "오\"아\"시스"
  elseif ( i == 26 ) then
    return "오아\"시스\" (운디네 가는 길)"
  elseif ( i == 27 ) then
    return "우드랜드 I"
  elseif ( i == 28 ) then
    return "우드랜드 II"
  elseif ( i == 29 ) then
    return "우드랜드 III"
  elseif ( i == 30 ) then
    return "우드랜드 IV"
  elseif ( i == 31 ) then
    return "우드랜드 V"
  elseif ( i == 32 ) then
    return "우드랜드 VI"
  elseif ( i == 33 ) then
    return "우드랜드 VII"
  elseif ( i == 34 ) then
    return "우드랜드 VIII"
  elseif ( i == 35 ) then
    return "우드랜드 IX"
  elseif ( i == 36 ) then
    return "우드랜드 X(숲 속 오두막)"
  elseif ( i == 37 ) then
    return "해안가 입구"
  elseif ( i == 38 ) then
    return "해안가 중심"
  elseif ( i == 39 ) then
    return "해안가 깊은곳"
  elseif ( i == 40 ) then
    return "난파선 얕은곳"
  elseif ( i == 41 ) then
    return "난파선 근처"
  elseif ( i == 42 ) then
    return "난파선 중심"
  elseif ( i == 43 ) then
    return "조화의 던전 D"
  elseif ( i == 44 ) then
    return "조화의 던전 A"
  elseif ( i == 45 ) then
    return "조화의 던전 R"
  elseif ( i == 46 ) then
    return "조화의 던전 K"
  elseif ( i == 47 ) then
    return "솔로던전"
  elseif ( i == 48 ) then
    return "호러캐슬(초급)"
  elseif ( i == 49 ) then
    return "호러캐슬(중급)"
  elseif ( i == 50 ) then
    return "호러캐슬(상급)"
  elseif ( i == 51 ) then
    return "광산 입구 (I)"
  elseif ( i == 52 ) then
    return "광산 위험지대 (II)"
  elseif ( i == 53 ) then
    return "광산 중심부 (III)"
  elseif ( i == 54 ) then
    return "광산 금지구역 (IV)"
  elseif ( i == 55 ) then
    return "광산 깊은 곳 (V)"
  elseif ( i == 56 ) then
    return "광산 숨겨진 곳 (VI)"
  elseif ( i == 57 ) then
    return "심연의 문턱 (VII)"
  elseif ( i == 58 ) then
    return "심연의 뿌리 (VIII)"
  elseif ( i == 59 ) then
    return "심연 (IX)"
  elseif ( i == 60 ) then
    return "무저갱 (X)"
  elseif ( i == 61 ) then
    return "죽음의 마을: 묘지기의 터"
  elseif ( i == 62 ) then
    return "죽음의 마을: 잊혀진 성당"
  elseif ( i == 63 ) then
    return "죽음의 마을: 목매단 나무"
  elseif ( i == 64 ) then
    return "죽음의 마을: 크립트의 좀비"
  elseif ( i == 65 ) then
    return "죽음의 마을: 몰락귀족의 저택"
  elseif ( i == 66 ) then
    return "죽음의 마을: 이차원 제단"
  elseif ( i == 67 ) then
    return "죽음의 마을: 디펜스 맵"
  endif
 endif
  return "위치확인 불가"
endfunction

constant function Hunting_Rect takes integer i returns rect
//아래 사냥터 개수 늘릴 것
    if ( i == 1 ) then
      return gg_rct_Hunting_01
    elseif ( i == 2 ) then
      return gg_rct_Hunting_02
    elseif ( i == 3 ) then
      return gg_rct_Hunting_03
    elseif ( i == 4 ) then
      return gg_rct_Hunting_04
    elseif ( i == 5 ) then
      return gg_rct_Hunting_05
    elseif ( i == 6 ) then
      return gg_rct_Hunting_06
    elseif ( i == 7 ) then
      return gg_rct_Hunting_07
    elseif ( i == 8 ) then
      return gg_rct_Hunting_08
    elseif ( i == 9 ) then
      return gg_rct_Hunting_09
    elseif ( i == 10 ) then
      return gg_rct_Hunting_10
    elseif ( i == 11 ) then
      return gg_rct_Hunting_11
    elseif ( i == 12 ) then
      return gg_rct_Hunting_12
    elseif ( i == 13 ) then
      return gg_rct_Hunting_13
    elseif ( i == 15 ) then
      return gg_rct_Hunting_15
    elseif ( i == 16 ) then
      return gg_rct_Hunting_16
    elseif ( i == 17 ) then
      return gg_rct_Hunting_17
    elseif ( i == 18 ) then
      return gg_rct_Hunting_18
    elseif ( i == 19 ) then
      return gg_rct_Hunting_19
    elseif ( i == 20 ) then
      return gg_rct_Hunting_20
    elseif ( i == 21 ) then
      return gg_rct_Hunting_21
    elseif ( i == 22 ) then
      return gg_rct_Hunting_22
    elseif ( i == 23 ) then
      return gg_rct_Hunting_23
    elseif ( i == 24 ) then
      return gg_rct_Hunting_24
    elseif ( i == 25 ) then
      return gg_rct_Hunting_25
    elseif ( i == 26 ) then
      return gg_rct_Hunting_26
    elseif ( i == 27 ) then
      return gg_rct_Hunting_27
    elseif ( i == 28 ) then
      return gg_rct_Hunting_28
    elseif ( i == 29 ) then
      return gg_rct_Hunting_29
    elseif ( i == 30 ) then
      return gg_rct_Hunting_30
    elseif ( i == 31 ) then
      return gg_rct_Hunting_31
    elseif ( i == 32 ) then
      return gg_rct_Hunting_32
    elseif ( i == 33 ) then
      return gg_rct_Hunting_33
    elseif ( i == 34 ) then
      return gg_rct_Hunting_34
    elseif ( i == 35 ) then
      return gg_rct_Hunting_35
    elseif ( i == 36 ) then
      return gg_rct_Hunting_36
    elseif ( i == 37 ) then
      return gg_rct_Hunting_37
    elseif ( i == 38 ) then
      return gg_rct_Hunting_38
    elseif ( i == 39 ) then
      return gg_rct_Hunting_39
    elseif ( i == 40 ) then
      return gg_rct_Hunting_40
    elseif ( i == 41 ) then
      return gg_rct_Hunting_41
    elseif ( i == 42 ) then
      return gg_rct_Hunting_42
    elseif ( i == 43 ) then
      return gg_rct_Hunting_43
    elseif ( i == 44 ) then
      return gg_rct_Hunting_44
    elseif ( i == 45 ) then
      return gg_rct_Hunting_45
    elseif ( i == 46 ) then
      return gg_rct_Hunting_46
    elseif ( i == 47 ) then
      return gg_rct_Hunting_47
    elseif ( i == 48 ) then
      return gg_rct_Hunting_48
    elseif ( i == 49 ) then
      return gg_rct_Hunting_49
    elseif ( i == 50 ) then
      return gg_rct_Hunting_50
    elseif ( i == 51 ) then
      return gg_rct_Hunting_51
    elseif ( i == 61 ) then
      return gg_rct_Hunting_61
    elseif ( i == 62 ) then
      return gg_rct_Hunting_62
    elseif ( i == 63 ) then
      return gg_rct_Hunting_63
    elseif ( i == 64 ) then
      return gg_rct_Hunting_64
    elseif ( i == 65 ) then
      return gg_rct_Hunting_65
    elseif ( i == 66 ) then
      return gg_rct_Hunting_66
    endif
 return null
endfunction
constant function Vileage_Rect takes integer i returns rect
  if ( i == 1 ) then
    return gg_rct_Villeage_01
  elseif ( i == 2 ) then
    return gg_rct_Villeage_02
  elseif ( i == 6 ) then
    return gg_rct_Villeage_06
  elseif ( i == 7 ) then
    return gg_rct_Villeage_07
  elseif ( i == 8 ) then
    return gg_rct_Villeage_08
  elseif ( i == 9 ) then
    return gg_rct_Villeage_09
  elseif ( i == 10 ) then
    return gg_rct_Villeage_10
  elseif ( i == 11 ) then
    return gg_rct_Villeage_11
  elseif ( i == 12 ) then
    return gg_rct_Villeage_12
  elseif ( i == 13 ) then
    return gg_rct_Villeage_13
  elseif ( i == 14 ) then
    return gg_rct_Villeage_14
  elseif ( i == 15 ) then
    return gg_rct_Villeage_15
  elseif ( i == 16 ) then
    return gg_rct_Villeage_16
  elseif ( i == 17 ) then
    return gg_rct_Villeage_17
  else
    return null
  endif
endfunction
constant function Moving_Rect takes integer i returns rect
//0 - 여관 아웃
  if ( i == 0 ) then
    return gg_rct_Moving_00
  elseif ( i == 1 ) then
    return gg_rct_Moving_01
  elseif ( i == 2 ) then
    return gg_rct_Moving_02
  elseif ( i == 3 ) then
    return gg_rct_Moving_03
  elseif ( i == 4 ) then
    return gg_rct_Moving_04
  elseif ( i == 5 ) then
    return gg_rct_Moving_05
  elseif ( i == 6 ) then
    return gg_rct_Moving_06
  elseif ( i == 7 ) then
    return gg_rct_Moving_07
  elseif ( i == 8 ) then
    return gg_rct_Moving_08
  elseif ( i == 9 ) then
    return gg_rct_Moving_09
  elseif ( i == 10 ) then
    return gg_rct_Moving_10
  elseif ( i == 11 ) then
    return gg_rct_Moving_11
  elseif ( i == 12 ) then
    return gg_rct_Moving_12
  elseif ( i == 13 ) then
    return gg_rct_Moving_13
  elseif ( i == 14 ) then
    return gg_rct_Moving_14
  elseif ( i == 15 ) then
    return gg_rct_Moving_15
  elseif ( i == 16 ) then
    return gg_rct_Moving_16
  elseif ( i == 17 ) then
    return gg_rct_Moving_17
  elseif ( i == 18 ) then
    return gg_rct_Moving_18
  elseif ( i == 19 ) then
    return gg_rct_Moving_19
  endif
  return null
endfunction
//A 지역에 들어가면 Ax Ay로 이동,
//멘트가 있으면 멘트 표시
constant function MovingXY takes integer i, boolean x returns real
  //밀레스(신전쪽) -> 지하묘지
  if ( i == 1 ) then
    if ( x ) then
      return 9440.
    else
      return -13568.
    endif
  //지하묘지 -> 밀레스(신전쪽)
  elseif ( i == 2 ) then
    if ( x ) then
      return 5120.
    else
      return -16864.
    endif
  elseif ( i == 3 ) then
  //큐르굴 입장
    if ( x ) then
      return 896.
    else
      return -15168.
    endif
  elseif ( i == 4 ) then
  //큐르굴 퇴장
    if ( x ) then
      return 2592.
    else
      return -14720.
    endif
  //뤼케시온 -> 해안가
  elseif ( i == 5 ) then
    if ( x ) then
      return -12096.
    else
      return -12192.
    endif
  elseif ( i == 6 ) then
    if ( x ) then
      return -2400.
    else
      return -13440.
    endif
  //조화 to 밖 (입장은 따로)
  elseif ( i == 7 ) then
    if ( x ) then
      return -2432.
    else
      return -8544.
    endif
  //여관 -> 우드
  elseif ( i == 8 ) then
    if ( x ) then
      return -7136.
    else
      return 4608.
    endif
  //루어스 -> 우드
  elseif ( i == 9 ) then
    if ( x ) then
      return -7136.
    else
      return 4608.
    endif
  //루어스 -> 우드
  elseif ( i == 10 ) then
    if ( x ) then
      return -544.
    else
      return -9280.
    endif
  //호러캐슬 입장
  elseif ( i == 11 ) then
    if ( x ) then
      return 20416.
    else
      return -19328.
    endif
  elseif ( i == 12 ) then
    if ( x ) then
      return 15776.
    else
      return -18176.
    endif
  elseif ( i == 13 ) then
    if ( x ) then
      return 29088.
    else
      return -28608.
    endif
  elseif ( i == 14 ) then
    if ( x ) then
      return 20896.
    else
      return -15456.
    endif
  elseif ( i == 15 ) then
    if ( x ) then
      return 16064.
    else
      return -18176.
    endif
  elseif ( i == 16 ) then
    return -1.
  // 상급 아웃, 인
  elseif ( i == 17 ) then
    if ( x ) then
      return 16448.
    else
      return -18112.
    endif
  elseif ( i == 18 ) then
    if ( x ) then
      return 22752.
    else
      return -19424.
    endif
  elseif ( i == 19 ) then
    if ( x ) then
      return 5632.
    else
      return -14976.
    endif
  endif
 return 0.
endfunction
function Trig_Sys_Monster_Set_Actions takes nothing returns nothing
 local integer i = 1
  loop
  //사냥터 정보 저장  
    if ( Hunting_Rect(i) != null ) then
      set udg_temp_rg = CreateRegion()
      call RegionAddRect(udg_temp_rg, Hunting_Rect(i))
	  call SaveInteger(udg_hash, GetHandleId(udg_temp_rg), StringHash("Rect-i"), i)
//debug call BJDebugMsg("SET HUNTER RECT : "+I2S(LoadInteger(udg_hash, GetHandleId(udg_temp_rg), StringHash("Rect-i"))) + " - " + R2S(GetRectCenterX(Hunting_Rect(i))))
      call TriggerRegisterEnterRegion(gg_trg_Sys_Create_Monster, udg_temp_rg, null)
    endif
    exitwhen i >= Map_Data(1)
	set i = i + 1
  endloop
//debug call BJDebugMsg("SET HUNTER RECT LAST: "+I2S(LoadInteger(udg_hash, GetHandleId(udg_temp_rg), StringHash("Rect-i"))))
  call TriggerSleepAction(.1)
  set i = 1
  loop
  //마을 정보 저장  
    if ( Vileage_Rect(i) != null ) then
      set udg_temp_rg = CreateRegion()
      call RegionAddRect(udg_temp_rg, Vileage_Rect(i))
	  call SaveInteger(udg_hash, GetHandleId(udg_temp_rg), StringHash("Rect-i"), i)
      call TriggerRegisterEnterRegion(gg_trg_Sys_Enter_Villeage, udg_temp_rg, null)
	  call TriggerRegisterLeaveRegion(gg_trg_Sys_Exit_Villeage, udg_temp_rg, null)
    endif
    exitwhen i >= Map_Data(2)
	//16 - 현재 마을 개수.
	set i = i + 1
  endloop  
  call TriggerSleepAction(.1)
  set i = 0
  loop
  //이동 정보 저장  
    set udg_temp_rg = CreateRegion()
    call RegionAddRect(udg_temp_rg, Moving_Rect(i))
	call SaveInteger(udg_hash, GetHandleId(udg_temp_rg), StringHash("Rect-i"), i)
    call TriggerRegisterEnterRegion(gg_trg_Sys_Moving, udg_temp_rg, null)
    exitwhen i >= Map_Data(3)
	set i = i + 1
  endloop
  set udg_temp_rg = null
  call TriggerSleepAction(.1)
  
  //소환되는 몬스터 정보 저장
  //1. 주인없는 호밀밭 - 밀93.75% 뱀6.25%
  call SaveInteger(udg_hash, 1, StringHash("FCU-Count"), 2)
  call SaveInteger(udg_hash, 1, StringHash("FCU-Unit1"), 'o000')
  call SaveInteger(udg_hash, 1, StringHash("FCU-Unit2"), 'n015')
  call SaveReal(udg_hash, 1, StringHash("FCU-Per1"), 19.)
  call SaveReal(udg_hash, 1, StringHash("FCU-Per"), 20.)
  call SaveReal(udg_hash, 1, StringHash("FCU-Time"), 3.)
  call SaveReal(udg_hash, 1, StringHash("FCU-Time2"), 1.5)
  call SaveReal(udg_hash, 1, StringHash("FCU-Mu"), -5)
  call SaveInteger(udg_hash, 1, StringHash("FCU-Add1"), 1)

  //2. 팜팻 골짜기 - Lv 1. 팜팻 100%
  call SaveInteger(udg_hash, 2, StringHash("FCU-Count"), 1)
  call SaveInteger(udg_hash, 2, StringHash("FCU-Unit1"), 'n002')
  call SaveReal(udg_hash, 2, StringHash("FCU-Time"), 6.)
  call SaveReal(udg_hash, 2, StringHash("FCU-Time2"), 3.)
  call SaveReal(udg_hash, 2, StringHash("FCU-Miss"), 30.)

  //3. 노비스 북쪽 숲 - Lv 2~3. 팜팻, 니에, 뱀, 녹색 벌
  call SaveInteger(udg_hash, 3, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 3, StringHash("FCU-Unit1"), 'n035')
  call SaveInteger(udg_hash, 3, StringHash("FCU-Unit2"), 'n007')
  call SaveInteger(udg_hash, 3, StringHash("FCU-Unit3"), 'n001')
  call SaveInteger(udg_hash, 3, StringHash("FCU-Unit4"), 'n004')
  call SaveReal(udg_hash, 3, StringHash("FCU-Per1"), 3.)
  call SaveReal(udg_hash, 3, StringHash("FCU-Per2"), 5.)
  call SaveReal(udg_hash, 3, StringHash("FCU-Per3"), 7.)
  call SaveReal(udg_hash, 3, StringHash("FCU-Per"), 8.)
  call SaveReal(udg_hash, 3, StringHash("FCU-Time"), 8.)
  call SaveReal(udg_hash, 3, StringHash("FCU-Time2"), 4.)
  call SaveReal(udg_hash, 3, StringHash("FCU-HPx"), .3)
  call SaveReal(udg_hash, 3, StringHash("FCU-CriP"), 10.)

  //4. 루어스 경계 숲 - Lv. 3~8. 녹색벌3, 브티스5, 완두콩5, 녹색벌6, 브티스8
  call SaveInteger(udg_hash, 4, StringHash("FCU-Count"), 5)
  call SaveInteger(udg_hash, 4, StringHash("FCU-Unit1"), 'n004')
  call SaveInteger(udg_hash, 4, StringHash("FCU-Unit2"), 'n003')
  call SaveInteger(udg_hash, 4, StringHash("FCU-Unit3"), 'n008')
  call SaveInteger(udg_hash, 4, StringHash("FCU-Unit4"), 'n00B')
  call SaveInteger(udg_hash, 4, StringHash("FCU-Unit5"), 'n01N')  
  call SaveReal(udg_hash, 4, StringHash("FCU-Per1"), 3.)
  call SaveReal(udg_hash, 4, StringHash("FCU-Per2"), 5.)
  call SaveReal(udg_hash, 4, StringHash("FCU-Per3"), 7.)
  call SaveReal(udg_hash, 4, StringHash("FCU-Per4"), 8.)
  call SaveReal(udg_hash, 4, StringHash("FCU-Per"), 8.5)
  call SaveReal(udg_hash, 4, StringHash("FCU-Time"), 7.)
  call SaveReal(udg_hash, 4, StringHash("FCU-Time2"), 4.)
  call SaveReal(udg_hash, 4, StringHash("FCU-HPx"), .25)

  //5. 옛 세계수 터 - Lv. 10~16. 말벌10, 맨티스11, 말벌12, 맨티스14, 말벌15, 늑대 16
  call SaveInteger(udg_hash, 5, StringHash("FCU-Count"), 6)
  call SaveInteger(udg_hash, 5, StringHash("FCU-Unit1"), 'n016')
  call SaveInteger(udg_hash, 5, StringHash("FCU-Unit2"), 'n00A')
  call SaveInteger(udg_hash, 5, StringHash("FCU-Unit3"), 'n01O')
  call SaveInteger(udg_hash, 5, StringHash("FCU-Unit4"), 'n029')
  call SaveInteger(udg_hash, 5, StringHash("FCU-Unit5"), 'n028')
  call SaveInteger(udg_hash, 5, StringHash("FCU-Unit6"), 'n005')
  call SaveReal(udg_hash, 5, StringHash("FCU-Per1"), 1.)
  call SaveReal(udg_hash, 5, StringHash("FCU-Per2"), 2.2)
  call SaveReal(udg_hash, 5, StringHash("FCU-Per3"), 3.3)
  call SaveReal(udg_hash, 5, StringHash("FCU-Per4"), 4.3)
  call SaveReal(udg_hash, 5, StringHash("FCU-Per5"), 5.2)
  call SaveReal(udg_hash, 5, StringHash("FCU-Per"), 5.9)
  call SaveReal(udg_hash, 5, StringHash("FCU-Time"), 7.)
  call SaveReal(udg_hash, 5, StringHash("FCU-Time2"), 4.)
  call SaveReal(udg_hash, 5, StringHash("FCU-HPx"), .3)
  call SaveReal(udg_hash, 5, StringHash("FCU-CriP"), 10.)
  
  call TriggerSleepAction(.25)
  //6. 큐르페이 동굴 - Lv.11 - 큐르페이 100%
  call SaveInteger(udg_hash, 6, StringHash("FCU-Count"), 1)
  call SaveInteger(udg_hash, 6, StringHash("FCU-Unit1"), 'n009')
  call SaveReal(udg_hash, 6, StringHash("FCU-Time"), 14.)
  call SaveReal(udg_hash, 6, StringHash("FCU-Time2"), 7.)
  call SaveReal(udg_hash, 6, StringHash("FCU-HP"), 2.)
  call SaveReal(udg_hash, 6, StringHash("FCU-Mu"), -5)
  
  //7. 오솔길 Lv 15~25 - 말벌15, 늑대16, 맨티스18, 늑대20, 늑대25
  call SaveInteger(udg_hash, 7, StringHash("FCU-Count"), 5)
  call SaveInteger(udg_hash, 7, StringHash("FCU-Unit1"), 'n028')
  call SaveInteger(udg_hash, 7, StringHash("FCU-Unit2"), 'n005')
  call SaveInteger(udg_hash, 7, StringHash("FCU-Unit3"), 'n02B')
  call SaveInteger(udg_hash, 7, StringHash("FCU-Unit4"), 'n017')
  call SaveInteger(udg_hash, 7, StringHash("FCU-Unit5"), 'n01P')
  call SaveReal(udg_hash, 7, StringHash("FCU-Per1"), 2.)
  call SaveReal(udg_hash, 7, StringHash("FCU-Per2"), 4.)
  call SaveReal(udg_hash, 7, StringHash("FCU-Per3"), 3.5)
  call SaveReal(udg_hash, 7, StringHash("FCU-Per4"), 4.5)
  call SaveReal(udg_hash, 7, StringHash("FCU-Per"), 5.)
  call SaveReal(udg_hash, 7, StringHash("FCU-Time"), 8.)
  call SaveReal(udg_hash, 7, StringHash("FCU-Time2"), 4.)
  call SaveReal(udg_hash, 7, StringHash("FCU-Miss"), 15.)

  //8. 숲 속 공터 Lv 20~27 - 맨티스18, 늑대20, 늑대25, 늑대인간 27
  call SaveInteger(udg_hash, 8, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 8, StringHash("FCU-Unit1"), 'n02B')
  call SaveInteger(udg_hash, 8, StringHash("FCU-Unit2"), 'n017')
  call SaveInteger(udg_hash, 8, StringHash("FCU-Unit3"), 'n01P')
  call SaveInteger(udg_hash, 8, StringHash("FCU-Unit4"), 'n006')
  call SaveReal(udg_hash, 8, StringHash("FCU-Per1"), 2.)
  call SaveReal(udg_hash, 8, StringHash("FCU-Per2"), 4.)
  call SaveReal(udg_hash, 8, StringHash("FCU-Per3"), 5.)
  call SaveReal(udg_hash, 8, StringHash("FCU-Per"), 5.75)
  call SaveReal(udg_hash, 8, StringHash("FCU-Time"), 8.)
  call SaveReal(udg_hash, 8, StringHash("FCU-Time2"), 4.)
  call SaveReal(udg_hash, 8, StringHash("FCU-Miss"), 25.)
  call SaveReal(udg_hash, 8, StringHash("FCU-MDF"), 15.)

  //9. 메아리치는 산 골짜기 Lv 25~35 - 늑대25, 늑대인간 27, 늑대인간 31, 늑대인간 35
  call SaveInteger(udg_hash, 9, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 9, StringHash("FCU-Unit1"), 'n01P')
  call SaveInteger(udg_hash, 9, StringHash("FCU-Unit2"), 'n006')
  call SaveInteger(udg_hash, 9, StringHash("FCU-Unit3"), 'n01Q')
  call SaveInteger(udg_hash, 9, StringHash("FCU-Unit4"), 'n01R')
  call SaveReal(udg_hash, 9, StringHash("FCU-Per1"), 2.5)
  call SaveReal(udg_hash, 9, StringHash("FCU-Per2"), 5.)
  call SaveReal(udg_hash, 9, StringHash("FCU-Per3"), 6.5)
  call SaveReal(udg_hash, 9, StringHash("FCU-Per"), 7.5)
  call SaveReal(udg_hash, 9, StringHash("FCU-Time"), 8.)
  call SaveReal(udg_hash, 9, StringHash("FCU-Time2"), 4.)
  call SaveReal(udg_hash, 9, StringHash("FCU-Miss"), 20.)
  call SaveReal(udg_hash, 9, StringHash("FCU-MDF"), 20.)

  call TriggerSleepAction(.25)
  //10. 포테의 숲 Lv 23~36 - 팜팻23, 트렌트27, 엔트라이온33, 놀34, 은빛늑대36
  call SaveInteger(udg_hash, 10, StringHash("FCU-Count"), 5)
  call SaveInteger(udg_hash, 10, StringHash("FCU-Unit1"), 'n02X')
  call SaveInteger(udg_hash, 10, StringHash("FCU-Unit2"), 'n02Y')
  call SaveInteger(udg_hash, 10, StringHash("FCU-Unit3"), 'n02Z')
  call SaveInteger(udg_hash, 10, StringHash("FCU-Unit4"), 'n030')
  call SaveInteger(udg_hash, 10, StringHash("FCU-Unit5"), 'n031')
  call SaveReal(udg_hash, 10, StringHash("FCU-Per1"), 3.)
  call SaveReal(udg_hash, 10, StringHash("FCU-Per2"), 6.)
  call SaveReal(udg_hash, 10, StringHash("FCU-Per3"), 7.5)
  call SaveReal(udg_hash, 10, StringHash("FCU-Per4"), 8.5)
  call SaveReal(udg_hash, 10, StringHash("FCU-Per"), 9.)
  call SaveReal(udg_hash, 10, StringHash("FCU-Time"), 10.)
  call SaveReal(udg_hash, 10, StringHash("FCU-Time2"), 5.)
  call SaveReal(udg_hash, 10, StringHash("FCU-CriP"), 10.)
  
  //11. 포테의 숲 골짜기 Lv 23~36 - 팜팻23, 트렌트27, 엔트라이온33, 놀34, 은빛늑대36
  call SaveInteger(udg_hash, 11, StringHash("FCU-Count"), 5)
  call SaveInteger(udg_hash, 11, StringHash("FCU-Unit1"), 'n02X')
  call SaveInteger(udg_hash, 11, StringHash("FCU-Unit2"), 'n02Y')
  call SaveInteger(udg_hash, 11, StringHash("FCU-Unit3"), 'n02Z')
  call SaveInteger(udg_hash, 11, StringHash("FCU-Unit4"), 'n030')
  call SaveInteger(udg_hash, 11, StringHash("FCU-Unit5"), 'n031')
  call SaveReal(udg_hash, 11, StringHash("FCU-Per1"), 1.)
  call SaveReal(udg_hash, 11, StringHash("FCU-Per2"), 2.5)
  call SaveReal(udg_hash, 11, StringHash("FCU-Per3"), 3.75)
  call SaveReal(udg_hash, 11, StringHash("FCU-Per4"), 5.)
  call SaveReal(udg_hash, 11, StringHash("FCU-Per"), 6.)
  call SaveReal(udg_hash, 11, StringHash("FCU-Time"), 5.)
  call SaveReal(udg_hash, 11, StringHash("FCU-Time2"), 5.)
  call SaveReal(udg_hash, 11, StringHash("FCU-CriP"), 15.)
  call SaveInteger(udg_hash, 11, StringHash("FCU-AC"), 30)
  call SaveInteger(udg_hash, 11, StringHash("FCU-MAC"), 30)
  
  //12. 메마른 길 Lv 18~25 -맨티스18, 늑대20, 늑대25
  call SaveInteger(udg_hash, 12, StringHash("FCU-Count"), 3)
  call SaveInteger(udg_hash, 12, StringHash("FCU-Unit1"), 'n02B')
  call SaveInteger(udg_hash, 12, StringHash("FCU-Unit2"), 'n017')
  call SaveInteger(udg_hash, 12, StringHash("FCU-Unit3"), 'n01P')
  call SaveReal(udg_hash, 12, StringHash("FCU-Per1"), 2.)
  call SaveReal(udg_hash, 12, StringHash("FCU-Per2"), 4.)
  call SaveReal(udg_hash, 12, StringHash("FCU-Per"), 5.)
  call SaveReal(udg_hash, 12, StringHash("FCU-Time"), 8.)
  call SaveReal(udg_hash, 12, StringHash("FCU-Time2"), 4.)
  call SaveInteger(udg_hash, 12, StringHash("FCU-AC"), 30)

  call TriggerSleepAction(.1)
  //13. 황폐한 늑대의 언덕 Lv 20~30 - 늑대 20, 늑대 25, 늑대인간 27, 늑대인간 31
  call SaveInteger(udg_hash, 13, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 13, StringHash("FCU-Unit1"), 'n017')
  call SaveInteger(udg_hash, 13, StringHash("FCU-Unit2"), 'n01P')
  call SaveInteger(udg_hash, 13, StringHash("FCU-Unit3"), 'n006')
  call SaveInteger(udg_hash, 13, StringHash("FCU-Unit4"), 'n01Q')
  call SaveReal(udg_hash, 13, StringHash("FCU-Per1"), 2.5)
  call SaveReal(udg_hash, 13, StringHash("FCU-Per2"), 5.)
  call SaveReal(udg_hash, 13, StringHash("FCU-Per3"), 6.5)
  call SaveReal(udg_hash, 13, StringHash("FCU-Per"), 7.25)
  call SaveReal(udg_hash, 13, StringHash("FCU-Time"), 6.)
  call SaveReal(udg_hash, 13, StringHash("FCU-Time2"), 4.)
  call SaveInteger(udg_hash, 13, StringHash("FCU-AC"), 40)
  call SaveReal(udg_hash, 13, StringHash("FCU-CriP"), 15.)
  call SaveReal(udg_hash, 13, StringHash("FCU-Bash"), 1.)
  
  call TriggerSleepAction(.25)
  //15. 농경지 - Lv 31~40 :: 웜31*2.5, 로커스트33*2.5, 모쓰36*1.5, 그레이트 웜40*1
  //추가생성 1마리
  call SaveInteger(udg_hash, 15, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 15, StringHash("FCU-Unit1"), 'n055')
  call SaveInteger(udg_hash, 15, StringHash("FCU-Unit2"), 'n056')
  call SaveInteger(udg_hash, 15, StringHash("FCU-Unit3"), 'n057')
  call SaveInteger(udg_hash, 15, StringHash("FCU-Unit4"), 'n058')
  call SaveReal(udg_hash, 15, StringHash("FCU-Per1"), 2.5)
  call SaveReal(udg_hash, 15, StringHash("FCU-Per2"), 5.)
  call SaveReal(udg_hash, 15, StringHash("FCU-Per3"), 6.5)
  call SaveReal(udg_hash, 15, StringHash("FCU-Per"), 7.5)
  call SaveReal(udg_hash, 15, StringHash("FCU-Time"), 7.5)
  call SaveReal(udg_hash, 15, StringHash("FCU-Time2"), 7.)
  call SaveInteger(udg_hash, 15, StringHash("FCU-Add1"), 1)
  
  call TriggerSleepAction(.25)
  //16. 밀레스 지하묘지 최상층 - Lv 4~10 :: 생쥐4*4, 독거미5*3.5, 지네8*2.5, 독거미10*1.5
  call SaveInteger(udg_hash, 16, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 16, StringHash("FCU-Unit1"), 'n00O')
  call SaveInteger(udg_hash, 16, StringHash("FCU-Unit2"), 'n00P')
  call SaveInteger(udg_hash, 16, StringHash("FCU-Unit3"), 'n00Q')
  call SaveInteger(udg_hash, 16, StringHash("FCU-Unit4"), 'n012')
  call SaveReal(udg_hash, 16, StringHash("FCU-Per1"), 4.)
  call SaveReal(udg_hash, 16, StringHash("FCU-Per2"), 7.5)
  call SaveReal(udg_hash, 16, StringHash("FCU-Per3"), 10.)
  call SaveReal(udg_hash, 16, StringHash("FCU-Per"), 11.5)
  call SaveReal(udg_hash, 16, StringHash("FCU-Time"), 6.)
  call SaveReal(udg_hash, 16, StringHash("FCU-Time2"), 2.)
  //17. 밀레스 지하묘지 2층 - Lv 10~18 :: 독거미10*2, 독거미14*2, 지네15*1, 작은박쥐18*1
  call SaveInteger(udg_hash, 17, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 17, StringHash("FCU-Unit1"), 'n012')
  call SaveInteger(udg_hash, 17, StringHash("FCU-Unit2"), 'n01X')
  call SaveInteger(udg_hash, 17, StringHash("FCU-Unit3"), 'n013')
  call SaveInteger(udg_hash, 17, StringHash("FCU-Unit4"), 'n00S')
  call SaveReal(udg_hash, 17, StringHash("FCU-Per1"), 2.)
  call SaveReal(udg_hash, 17, StringHash("FCU-Per2"), 4.)
  call SaveReal(udg_hash, 17, StringHash("FCU-Per3"), 5.)
  call SaveReal(udg_hash, 17, StringHash("FCU-Per"), 6.)
  call SaveReal(udg_hash, 17, StringHash("FCU-Time"), 6.)
  call SaveReal(udg_hash, 17, StringHash("FCU-Time2"), 3.)
  //18. 밀레스 지하묘지 2.5층 - Lv 15~28 :: 지네15*3, 작은박쥐18*3, 지네23*2, 작은박쥐25*1.5, 전갈28*1
  call SaveInteger(udg_hash, 18, StringHash("FCU-Count"), 5)
  call SaveInteger(udg_hash, 18, StringHash("FCU-Unit1"), 'n013')
  call SaveInteger(udg_hash, 18, StringHash("FCU-Unit2"), 'n00S')
  call SaveInteger(udg_hash, 18, StringHash("FCU-Unit3"), 'n01Y')
  call SaveInteger(udg_hash, 18, StringHash("FCU-Unit4"), 'n01D')
  call SaveInteger(udg_hash, 18, StringHash("FCU-Unit5"), 'n00R')
  call SaveReal(udg_hash, 18, StringHash("FCU-Per1"), 3.)
  call SaveReal(udg_hash, 18, StringHash("FCU-Per2"), 6.)
  call SaveReal(udg_hash, 18, StringHash("FCU-Per3"), 8.)
  call SaveReal(udg_hash, 18, StringHash("FCU-Per4"), 9.5)
  call SaveReal(udg_hash, 18, StringHash("FCU-Per"), 10.5)
  call SaveReal(udg_hash, 18, StringHash("FCU-Time"), 5.)
  call SaveReal(udg_hash, 18, StringHash("FCU-Time2"), 4.)
  //19. 밀레스 지하묘지 3층 - Lv 25~42 :: 작은박쥐25*3, 전갈28*3, 작은박쥐33*2, 전갈35*2, 박쥐38*1.5, 드랜스부42*1
  call SaveInteger(udg_hash, 19, StringHash("FCU-Count"), 6)
  call SaveInteger(udg_hash, 19, StringHash("FCU-Unit1"), 'n01D')
  call SaveInteger(udg_hash, 19, StringHash("FCU-Unit2"), 'n00R')
  call SaveInteger(udg_hash, 19, StringHash("FCU-Unit3"), 'n01Z')
  call SaveInteger(udg_hash, 19, StringHash("FCU-Unit4"), 'n014')
  call SaveInteger(udg_hash, 19, StringHash("FCU-Unit5"), 'n00T')
  call SaveInteger(udg_hash, 19, StringHash("FCU-Unit6"), 'n00V')
  call SaveReal(udg_hash, 19, StringHash("FCU-Per1"), 3.)
  call SaveReal(udg_hash, 19, StringHash("FCU-Per2"), 6.)
  call SaveReal(udg_hash, 19, StringHash("FCU-Per3"), 8.)
  call SaveReal(udg_hash, 19, StringHash("FCU-Per4"), 10.)
  call SaveReal(udg_hash, 19, StringHash("FCU-Per5"), 11.5)
  call SaveReal(udg_hash, 19, StringHash("FCU-Per"), 12.5)
  call SaveReal(udg_hash, 19, StringHash("FCU-Time"), 5.)
  call SaveReal(udg_hash, 19, StringHash("FCU-Time2"), 4.)
  //20. 밀레스 지하묘지 3.5층 - Lv 38~53 :: 박쥐38*2, 드랜스부42*2, 전갈43*2, 박쥐45*1.5, 바사크지네47*1.5, 미믹48*1, 박쥐53*0.75
  call SaveInteger(udg_hash, 20, StringHash("FCU-Count"), 7)
  call SaveInteger(udg_hash, 20, StringHash("FCU-Unit1"), 'n00T')
  call SaveInteger(udg_hash, 20, StringHash("FCU-Unit2"), 'n00V')
  call SaveInteger(udg_hash, 20, StringHash("FCU-Unit3"), 'n020')
  call SaveInteger(udg_hash, 20, StringHash("FCU-Unit4"), 'n01E')
  call SaveInteger(udg_hash, 20, StringHash("FCU-Unit5"), 'n022')
  call SaveInteger(udg_hash, 20, StringHash("FCU-Unit6"), 'n00W')
  call SaveInteger(udg_hash, 20, StringHash("FCU-Unit7"), 'n021')
  call SaveReal(udg_hash, 20, StringHash("FCU-Per1"), 2.)
  call SaveReal(udg_hash, 20, StringHash("FCU-Per2"), 4.)
  call SaveReal(udg_hash, 20, StringHash("FCU-Per3"), 6.)
  call SaveReal(udg_hash, 20, StringHash("FCU-Per4"), 7.5)
  call SaveReal(udg_hash, 20, StringHash("FCU-Per5"), 9.)
  call SaveReal(udg_hash, 20, StringHash("FCU-Per6"), 10.)
  call SaveReal(udg_hash, 20, StringHash("FCU-Per"), 10.75)
  call SaveReal(udg_hash, 20, StringHash("FCU-Time"), 5.)
  call SaveReal(udg_hash, 20, StringHash("FCU-Time2"), 3.5)
  
  call TriggerSleepAction(.25)
  //21. 밀레스 지하묘지 4층 - Lv 42~65 :: 바사크지네42*1.5, 드랜스부47*1.5, 미믹48*1.5, 박쥐53*2, 미믹55*2, 흰박쥐58*1, 미믹63*0.75, 흰박쥐65*0.6
  call SaveInteger(udg_hash, 21, StringHash("FCU-Count"), 8)
  call SaveInteger(udg_hash, 21, StringHash("FCU-Unit1"), 'n00U')
  call SaveInteger(udg_hash, 21, StringHash("FCU-Unit2"), 'n023')
  call SaveInteger(udg_hash, 21, StringHash("FCU-Unit3"), 'n00W')
  call SaveInteger(udg_hash, 21, StringHash("FCU-Unit4"), 'n021')
  call SaveInteger(udg_hash, 21, StringHash("FCU-Unit5"), 'n024')
  call SaveInteger(udg_hash, 21, StringHash("FCU-Unit6"), 'n00X')
  call SaveInteger(udg_hash, 21, StringHash("FCU-Unit7"), 'n025')
  call SaveInteger(udg_hash, 21, StringHash("FCU-Unit8"), 'n01F')
  call SaveReal(udg_hash, 21, StringHash("FCU-Per1"), 1.5)
  call SaveReal(udg_hash, 21, StringHash("FCU-Per2"), 3.)
  call SaveReal(udg_hash, 21, StringHash("FCU-Per3"), 4.5)
  call SaveReal(udg_hash, 21, StringHash("FCU-Per4"), 6.5)
  call SaveReal(udg_hash, 21, StringHash("FCU-Per5"), 8.5)
  call SaveReal(udg_hash, 21, StringHash("FCU-Per6"), 9.5)
  call SaveReal(udg_hash, 21, StringHash("FCU-Per7"), 10.25)
  call SaveReal(udg_hash, 21, StringHash("FCU-Per"), 10.85)
  call SaveReal(udg_hash, 21, StringHash("FCU-Time"), 6.)
  call SaveReal(udg_hash, 21, StringHash("FCU-Time2"), 4.)
  //22. 밀레스 지하묘지 4.5층 - Lv 63~75 :: 미믹63*2, 흰박쥐65*2, 카디68*1.5, 흰박쥐73*1, 카디75*0.75
  call SaveInteger(udg_hash, 22, StringHash("FCU-Count"), 5)
  call SaveInteger(udg_hash, 22, StringHash("FCU-Unit1"), 'n025')
  call SaveInteger(udg_hash, 22, StringHash("FCU-Unit2"), 'n01F')
  call SaveInteger(udg_hash, 22, StringHash("FCU-Unit3"), 'n00Y')
  call SaveInteger(udg_hash, 22, StringHash("FCU-Unit4"), 'n026')
  call SaveInteger(udg_hash, 22, StringHash("FCU-Unit5"), 'n01G')
  call SaveReal(udg_hash, 22, StringHash("FCU-Per1"), 2.)
  call SaveReal(udg_hash, 22, StringHash("FCU-Per2"), 4.)
  call SaveReal(udg_hash, 22, StringHash("FCU-Per3"), 5.5)
  call SaveReal(udg_hash, 22, StringHash("FCU-Per4"), 6.5)
  call SaveReal(udg_hash, 22, StringHash("FCU-Per"), 7.25)
  call SaveReal(udg_hash, 22, StringHash("FCU-Time"), 6.)
  call SaveReal(udg_hash, 22, StringHash("FCU-Time2"), 3.5)
  //23. 밀레스 지하묘지 최하층 - Lv 73~90 :: 흰박쥐73*4, 카디75*3.5, 멜로더80*3, 카디83*2.5, 멜로더90*1.5
  call SaveInteger(udg_hash, 23, StringHash("FCU-Count"), 5)
  call SaveInteger(udg_hash, 23, StringHash("FCU-Unit1"), 'n026')
  call SaveInteger(udg_hash, 23, StringHash("FCU-Unit2"), 'n01G')
  call SaveInteger(udg_hash, 23, StringHash("FCU-Unit3"), 'n00Z')
  call SaveInteger(udg_hash, 23, StringHash("FCU-Unit4"), 'n027')
  call SaveInteger(udg_hash, 23, StringHash("FCU-Unit5"), 'n01H')
  call SaveReal(udg_hash, 23, StringHash("FCU-Per1"), 4.)
  call SaveReal(udg_hash, 23, StringHash("FCU-Per2"), 7.5)
  call SaveReal(udg_hash, 23, StringHash("FCU-Per3"), 10.5)
  call SaveReal(udg_hash, 23, StringHash("FCU-Per4"), 13.)
  call SaveReal(udg_hash, 23, StringHash("FCU-Per"), 14.5)
  call SaveReal(udg_hash, 23, StringHash("FCU-Time"), 6.)
  call SaveReal(udg_hash, 23, StringHash("FCU-Time2"), 3.)
  //23-2. 최하층 (강화) - Lv 73~90 :: 흰박쥐73*1.25, 카디75*1.25, 카디83*2.25, 멜로더90*1.75, 변이 확률 x2
  /*
  call SaveReal(udg_hash, 16~23, StringHash("FCU-Time"), LoadReal(udg_hash, 16~23, StringHash("FCU-Time"))/1.5)
  call SaveReal(udg_hash, 16~23, StringHash("FCU-Time2"), LoadReal(udg_hash, 16~23, StringHash("FCU-Time2"))/1.5)
  call SaveReal(udg_hash, 16~23, StringHash("FCU-Mu"), .25)
  
  call SaveInteger(udg_hash, 23, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 23, StringHash("FCU-Unit3"), 'n027')
  call SaveInteger(udg_hash, 23, StringHash("FCU-Unit4"), 'n01H')
  call SaveReal(udg_hash, 23, StringHash("FCU-Per1"), 1.25)
  call SaveReal(udg_hash, 23, StringHash("FCU-Per2"), 2.5)
  call SaveReal(udg_hash, 23, StringHash("FCU-Per3"), 4.75)
  call SaveReal(udg_hash, 23, StringHash("FCU-Per"), 6.5)
  */
  
  //24. 오아시스 1 - Lv 32~37 :: 전갈32*4, 전갈35*2, 전갈37*1
  call SaveInteger(udg_hash, 24, StringHash("FCU-Count"), 3)
  call SaveInteger(udg_hash, 24, StringHash("FCU-Unit1"), 'n037')
  call SaveInteger(udg_hash, 24, StringHash("FCU-Unit2"), 'n038')
  call SaveInteger(udg_hash, 24, StringHash("FCU-Unit3"), 'n039')
  call SaveReal(udg_hash, 24, StringHash("FCU-Per1"), 4.)
  call SaveReal(udg_hash, 24, StringHash("FCU-Per2"), 6.)
  call SaveReal(udg_hash, 24, StringHash("FCU-Per"), 7.)
  call SaveReal(udg_hash, 24, StringHash("FCU-Time"), 6.)
  call SaveReal(udg_hash, 24, StringHash("FCU-Time2"), 4.)
  
  //25. 오아시스 2 - Lv 32~37 :: 전갈32*1, 전갈35*3, 전갈37*2
  call SaveInteger(udg_hash, 25, StringHash("FCU-Count"), 3)
  call SaveInteger(udg_hash, 25, StringHash("FCU-Unit1"), 'n037')
  call SaveInteger(udg_hash, 25, StringHash("FCU-Unit2"), 'n038')
  call SaveInteger(udg_hash, 25, StringHash("FCU-Unit3"), 'n039')
  call SaveReal(udg_hash, 25, StringHash("FCU-Per1"), 1.)
  call SaveReal(udg_hash, 25, StringHash("FCU-Per2"), 4.)
  call SaveReal(udg_hash, 25, StringHash("FCU-Per"), 6.)
  call SaveReal(udg_hash, 25, StringHash("FCU-Time"), 6.)
  call SaveReal(udg_hash, 25, StringHash("FCU-Time2"), 3.)
  
  call TriggerSleepAction(.25)
  //26. 오아시스 3 - Lv 37~42 :: 전갈37*1, 전갈42*2
  call SaveInteger(udg_hash, 26, StringHash("FCU-Count"), 2)
  call SaveInteger(udg_hash, 26, StringHash("FCU-Unit1"), 'n039')
  call SaveInteger(udg_hash, 26, StringHash("FCU-Unit2"), 'n03A')
  call SaveReal(udg_hash, 26, StringHash("FCU-Per1"), 1.)
  call SaveReal(udg_hash, 26, StringHash("FCU-Per"), 3.)
  call SaveReal(udg_hash, 26, StringHash("FCU-Time"), 7.)
  call SaveReal(udg_hash, 26, StringHash("FCU-Time2"), 1.)
  
  //27. 우드랜드 I - Lv8~18(10.5)	::  브맨8*2 말벌10*3 맨팃11*3 말벌12*2 맨팃14*2 말벌15*1 늑대16*1
  call SaveInteger(udg_hash, 27, StringHash("FCU-Count"), 7)
  call SaveInteger(udg_hash, 27, StringHash("FCU-Unit1"), 'n01N')
  call SaveInteger(udg_hash, 27, StringHash("FCU-Unit2"), 'n016')
  call SaveInteger(udg_hash, 27, StringHash("FCU-Unit3"), 'n00A')
  call SaveInteger(udg_hash, 27, StringHash("FCU-Unit4"), 'n01O')
  call SaveInteger(udg_hash, 27, StringHash("FCU-Unit5"), 'n029')
  call SaveInteger(udg_hash, 27, StringHash("FCU-Unit6"), 'n028')
  call SaveInteger(udg_hash, 27, StringHash("FCU-Unit7"), 'n005')
  call SaveReal(udg_hash, 27, StringHash("FCU-Per1"), 2.)
  call SaveReal(udg_hash, 27, StringHash("FCU-Per2"), 5.)
  call SaveReal(udg_hash, 27, StringHash("FCU-Per3"), 8.)
  call SaveReal(udg_hash, 27, StringHash("FCU-Per4"), 10.)
  call SaveReal(udg_hash, 27, StringHash("FCU-Per5"), 12.)
  call SaveReal(udg_hash, 27, StringHash("FCU-Per6"), 13.)
  call SaveReal(udg_hash, 27, StringHash("FCU-Per"), 14.)
  call SaveReal(udg_hash, 27, StringHash("FCU-Time"), 7.)
  call SaveReal(udg_hash, 27, StringHash("FCU-Time2"), 5.)
  //28. 우드랜드 2 - Lv16~27(20.0)  ::	말벌15*1, 늑대16*1.5, 맨팃18*2, 늑대20*2, 늑대25*1.5, 늑대인간27*1.1
  call SaveInteger(udg_hash, 28, StringHash("FCU-Count"), 6)
  call SaveInteger(udg_hash, 28, StringHash("FCU-Unit1"), 'n028')
  call SaveInteger(udg_hash, 28, StringHash("FCU-Unit2"), 'n005')
  call SaveInteger(udg_hash, 28, StringHash("FCU-Unit3"), 'n02B')
  call SaveInteger(udg_hash, 28, StringHash("FCU-Unit4"), 'n017')
  call SaveInteger(udg_hash, 28, StringHash("FCU-Unit5"), 'n01P')
  call SaveInteger(udg_hash, 28, StringHash("FCU-Unit6"), 'n006')
  call SaveReal(udg_hash, 28, StringHash("FCU-Per1"), 1.)
  call SaveReal(udg_hash, 28, StringHash("FCU-Per2"), 2.5)
  call SaveReal(udg_hash, 28, StringHash("FCU-Per3"), 4.5)
  call SaveReal(udg_hash, 28, StringHash("FCU-Per4"), 6.5)
  call SaveReal(udg_hash, 28, StringHash("FCU-Per5"), 8.)
  call SaveReal(udg_hash, 28, StringHash("FCU-Per"), 9.1)
  call SaveReal(udg_hash, 28, StringHash("FCU-Time"), 6.75)
  call SaveReal(udg_hash, 28, StringHash("FCU-Time2"), 5.5)
  //29. 우드랜드 3 - Lv25~38(29.1)  ::  늑대25*4, 늑인27*3.5, 늑인31*2.5, 늑인35*1.75, 고병38*1
  call SaveInteger(udg_hash, 29, StringHash("FCU-Count"), 5)
  call SaveInteger(udg_hash, 29, StringHash("FCU-Unit1"), 'n01P')
  call SaveInteger(udg_hash, 29, StringHash("FCU-Unit2"), 'n006')
  call SaveInteger(udg_hash, 29, StringHash("FCU-Unit3"), 'n01Q')
  call SaveInteger(udg_hash, 29, StringHash("FCU-Unit4"), 'n01R')
  call SaveInteger(udg_hash, 29, StringHash("FCU-Unit5"), 'n00C')
  call SaveReal(udg_hash, 29, StringHash("FCU-Per1"), 4.)
  call SaveReal(udg_hash, 29, StringHash("FCU-Per2"), 7.5)
  call SaveReal(udg_hash, 29, StringHash("FCU-Per3"), 10.)
  call SaveReal(udg_hash, 29, StringHash("FCU-Per4"), 11.75)
  call SaveReal(udg_hash, 29, StringHash("FCU-Per"), 12.75)
  call SaveReal(udg_hash, 29, StringHash("FCU-Time"), 6.5)
  call SaveReal(udg_hash, 29, StringHash("FCU-Time2"), 6.)
  //30. 우드랜드 4 - Lv32~46(37.0)  ::	늑인31*1.5, 늑인35*2, 고병38*2, 고병46*1.25
  call SaveInteger(udg_hash, 30, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 30, StringHash("FCU-Unit1"), 'n01Q')
  call SaveInteger(udg_hash, 30, StringHash("FCU-Unit2"), 'n01R')
  call SaveInteger(udg_hash, 30, StringHash("FCU-Unit3"), 'n00C')
  call SaveInteger(udg_hash, 30, StringHash("FCU-Unit4"), 'n018')
  call SaveReal(udg_hash, 30, StringHash("FCU-Per1"), 1.5)
  call SaveReal(udg_hash, 30, StringHash("FCU-Per2"), 3.5)
  call SaveReal(udg_hash, 30, StringHash("FCU-Per3"), 5.5)
  call SaveReal(udg_hash, 30, StringHash("FCU-Per"), 6.75)
  call SaveReal(udg_hash, 30, StringHash("FCU-Time"), 6.25)
  call SaveReal(udg_hash, 30, StringHash("FCU-Time2"), 6.5)
  
  call TriggerSleepAction(.25)
  //31. 우드랜드 5 - Lv40~54(46.2)  ::	고병38*1.5, 고병46*2, 고전48*1.75, 고병54*1.25
  call SaveInteger(udg_hash, 31, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 31, StringHash("FCU-Unit1"), 'n00C')
  call SaveInteger(udg_hash, 31, StringHash("FCU-Unit2"), 'n018')
  call SaveInteger(udg_hash, 31, StringHash("FCU-Unit3"), 'n00D')
  call SaveInteger(udg_hash, 31, StringHash("FCU-Unit4"), 'n01S')
  call SaveReal(udg_hash, 31, StringHash("FCU-Per1"), 1.5)
  call SaveReal(udg_hash, 31, StringHash("FCU-Per2"), 3.5)
  call SaveReal(udg_hash, 31, StringHash("FCU-Per3"), 5.25)
  call SaveReal(udg_hash, 31, StringHash("FCU-Per"), 6.5)
  call SaveReal(udg_hash, 31, StringHash("FCU-Time"), 6.)
  call SaveReal(udg_hash, 31, StringHash("FCU-Time2"), 7.)
  //32. 우드랜드 6 - Lv48~59(54.5)  ::	고전48*1.25, 고병54*2, 고전56*2.5, 고가59*1.25
  call SaveInteger(udg_hash, 32, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 32, StringHash("FCU-Unit1"), 'n00D')
  call SaveInteger(udg_hash, 32, StringHash("FCU-Unit2"), 'n01S')
  call SaveInteger(udg_hash, 32, StringHash("FCU-Unit3"), 'n019')
  call SaveInteger(udg_hash, 32, StringHash("FCU-Unit4"), 'n00E')
  call SaveReal(udg_hash, 32, StringHash("FCU-Per1"), 1.25)
  call SaveReal(udg_hash, 32, StringHash("FCU-Per2"), 3.25)
  call SaveReal(udg_hash, 32, StringHash("FCU-Per3"), 5.75)
  call SaveReal(udg_hash, 32, StringHash("FCU-Per"), 7.)
  call SaveReal(udg_hash, 32, StringHash("FCU-Time"), 6.)
  call SaveReal(udg_hash, 32, StringHash("FCU-Time2"), 6.5)
  //33. 우드랜드 7 - Lv56~69(63.1)  ::	고전56*1, 고가59*1.5, 고전64*2.25, 고가66*1.5, 홉고69*1.25
  call SaveInteger(udg_hash, 33, StringHash("FCU-Count"), 5)
  call SaveInteger(udg_hash, 33, StringHash("FCU-Unit1"), 'n019')
  call SaveInteger(udg_hash, 33, StringHash("FCU-Unit2"), 'n00E')
  call SaveInteger(udg_hash, 33, StringHash("FCU-Unit3"), 'n01T')
  call SaveInteger(udg_hash, 33, StringHash("FCU-Unit4"), 'n01A')
  call SaveInteger(udg_hash, 33, StringHash("FCU-Unit5"), 'n00F')
  call SaveReal(udg_hash, 33, StringHash("FCU-Per1"), 1.)
  call SaveReal(udg_hash, 33, StringHash("FCU-Per2"), 2.5)
  call SaveReal(udg_hash, 33, StringHash("FCU-Per3"), 4.75)
  call SaveReal(udg_hash, 33, StringHash("FCU-Per4"), 6.25)
  call SaveReal(udg_hash, 33, StringHash("FCU-Per"), 7.5)
  call SaveReal(udg_hash, 33, StringHash("FCU-Time"), 5.75)
  call SaveReal(udg_hash, 33, StringHash("FCU-Time2"), 6.25)
  //34. 우드랜드 8 - Lv64~79(71.7)  ::	고전64*1, 고가66*1.25, 홉고69*1.5, 고가73*2.5, 홉고76*1.5, 슈79*1.25
  call SaveInteger(udg_hash, 34, StringHash("FCU-Count"), 6)
  call SaveInteger(udg_hash, 34, StringHash("FCU-Unit1"), 'n01T')
  call SaveInteger(udg_hash, 34, StringHash("FCU-Unit2"), 'n01A')
  call SaveInteger(udg_hash, 34, StringHash("FCU-Unit3"), 'n00F')
  call SaveInteger(udg_hash, 34, StringHash("FCU-Unit4"), 'n01U')
  call SaveInteger(udg_hash, 34, StringHash("FCU-Unit5"), 'n01B')
  call SaveInteger(udg_hash, 34, StringHash("FCU-Unit6"), 'n00G')
  call SaveReal(udg_hash, 34, StringHash("FCU-Per1"), 1.)
  call SaveReal(udg_hash, 34, StringHash("FCU-Per2"), 2.25)
  call SaveReal(udg_hash, 34, StringHash("FCU-Per3"), 3.75)
  call SaveReal(udg_hash, 34, StringHash("FCU-Per4"), 6.25)
  call SaveReal(udg_hash, 34, StringHash("FCU-Per5"), 7.75)
  call SaveReal(udg_hash, 34, StringHash("FCU-Per"), 9.)
  call SaveReal(udg_hash, 34, StringHash("FCU-Time"), 5.5)
  call SaveReal(udg_hash, 34, StringHash("FCU-Time2"), 6.0)
  //35. 우드랜드 9 - Lv72~86(80.7)  ::	고가73*0.75, 홉고76*1, 슈79*1.25, 홉고83*2, 슈86*1.5
  call SaveInteger(udg_hash, 35, StringHash("FCU-Count"), 5)
  call SaveInteger(udg_hash, 35, StringHash("FCU-Unit1"), 'n01U')
  call SaveInteger(udg_hash, 35, StringHash("FCU-Unit2"), 'n01B')
  call SaveInteger(udg_hash, 35, StringHash("FCU-Unit3"), 'n00G')
  call SaveInteger(udg_hash, 35, StringHash("FCU-Unit4"), 'n01V')
  call SaveInteger(udg_hash, 35, StringHash("FCU-Unit5"), 'n01C')
  call SaveReal(udg_hash, 35, StringHash("FCU-Per1"), 0.75)
  call SaveReal(udg_hash, 35, StringHash("FCU-Per2"), 1.75)
  call SaveReal(udg_hash, 35, StringHash("FCU-Per3"), 3.)
  call SaveReal(udg_hash, 35, StringHash("FCU-Per4"), 5.)
  call SaveReal(udg_hash, 35, StringHash("FCU-Per"), 6.5)
  call SaveReal(udg_hash, 35, StringHash("FCU-Time"), 5.25)
  call SaveReal(udg_hash, 35, StringHash("FCU-Time2"), 5.75)
  
  call TriggerSleepAction(.25)
  //36. 우드랜드 X - Lv83~96(90.0)  ::	홉고83*1, 슈86*1.25, 위스프91*2.5, 슈92*1.5, 에인96*1.1
  call SaveInteger(udg_hash, 36, StringHash("FCU-Count"), 5)
  call SaveInteger(udg_hash, 36, StringHash("FCU-Unit1"), 'n01V')
  call SaveInteger(udg_hash, 36, StringHash("FCU-Unit2"), 'n01C')
  call SaveInteger(udg_hash, 36, StringHash("FCU-Unit3"), 'n00H')
  call SaveInteger(udg_hash, 36, StringHash("FCU-Unit4"), 'n01W')
  call SaveInteger(udg_hash, 36, StringHash("FCU-Unit5"), 'n00I')
  call SaveReal(udg_hash, 36, StringHash("FCU-Per1"), 1.)
  call SaveReal(udg_hash, 36, StringHash("FCU-Per2"), 2.25)
  call SaveReal(udg_hash, 36, StringHash("FCU-Per3"), 4.75)
  call SaveReal(udg_hash, 36, StringHash("FCU-Per4"), 6.25)
  call SaveReal(udg_hash, 36, StringHash("FCU-Per"), 7.35)
  call SaveReal(udg_hash, 36, StringHash("FCU-Time"), 5.)
  call SaveReal(udg_hash, 36, StringHash("FCU-Time2"), 5.5)
  
  //37. 해안가1	- Lv35~43(37.6) :: 터틀35*3, 문어39*2, 그래브43*1
  call SaveInteger(udg_hash, 37, StringHash("FCU-Count"), 3)
  call SaveInteger(udg_hash, 37, StringHash("FCU-Unit1"), 'n02D')
  call SaveInteger(udg_hash, 37, StringHash("FCU-Unit2"), 'n02E')
  call SaveInteger(udg_hash, 37, StringHash("FCU-Unit3"), 'n02F')
  call SaveReal(udg_hash, 37, StringHash("FCU-Per1"), 3.)
  call SaveReal(udg_hash, 37, StringHash("FCU-Per2"), 5.)
  call SaveReal(udg_hash, 37, StringHash("FCU-Per"), 6.)
  call SaveReal(udg_hash, 37, StringHash("FCU-Time"), 9.)
  call SaveReal(udg_hash, 37, StringHash("FCU-Time2"), 6.)
  //38. 해안가2	- Lv39~53(43.4) :: 문어39*4, 그래브43*3, 일48*2, 퐁퐁이53*1
  call SaveInteger(udg_hash, 38, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 38, StringHash("FCU-Unit1"), 'n02E')
  call SaveInteger(udg_hash, 38, StringHash("FCU-Unit2"), 'n02F')
  call SaveInteger(udg_hash, 38, StringHash("FCU-Unit3"), 'n02G')
  call SaveInteger(udg_hash, 38, StringHash("FCU-Unit4"), 'n02H')
  call SaveReal(udg_hash, 38, StringHash("FCU-Per1"), 4.)
  call SaveReal(udg_hash, 38, StringHash("FCU-Per2"), 7.)
  call SaveReal(udg_hash, 38, StringHash("FCU-Per3"), 9.)
  call SaveReal(udg_hash, 38, StringHash("FCU-Per"), 10.)
  call SaveReal(udg_hash, 38, StringHash("FCU-Time"), 9.)
  call SaveReal(udg_hash, 38, StringHash("FCU-Time2"), 6.)
  //39. 해안가3	- Lv48~63(53.75) :: 일48*1, 퐁퐁이53*2, 슬러그61-1*1
  call SaveInteger(udg_hash, 39, StringHash("FCU-Count"), 3)
  call SaveInteger(udg_hash, 39, StringHash("FCU-Unit1"), 'n02G')
  call SaveInteger(udg_hash, 39, StringHash("FCU-Unit2"), 'n02H')
  call SaveInteger(udg_hash, 39, StringHash("FCU-Unit3"), 'n02I')
  call SaveReal(udg_hash, 39, StringHash("FCU-Per1"), 1.)
  call SaveReal(udg_hash, 39, StringHash("FCU-Per2"), 3.)
  call SaveReal(udg_hash, 39, StringHash("FCU-Per"), 4.)
  call SaveReal(udg_hash, 39, StringHash("FCU-Time"), 9.)
  call SaveReal(udg_hash, 39, StringHash("FCU-Time2"), 6.)
  //40. 난파선4	- Lv61~69(63.2) :: 크라켄61-2*2.5, 애스코63*2, 가스69*1
  call SaveInteger(udg_hash, 40, StringHash("FCU-Count"), 3)
  call SaveInteger(udg_hash, 40, StringHash("FCU-Unit1"), 'n02J')
  call SaveInteger(udg_hash, 40, StringHash("FCU-Unit2"), 'n02K')
  call SaveInteger(udg_hash, 40, StringHash("FCU-Unit3"), 'n02L')
  call SaveReal(udg_hash, 40, StringHash("FCU-Per1"), 2.5)
  call SaveReal(udg_hash, 40, StringHash("FCU-Per2"), 4.5)
  call SaveReal(udg_hash, 40, StringHash("FCU-Per"), 5.5)
  call SaveReal(udg_hash, 40, StringHash("FCU-Time"), 9.)
  call SaveReal(udg_hash, 40, StringHash("FCU-Time2"), 6.)
  call TriggerSleepAction(.25)
  //41. 난파선5	- Lv63~75(69.3) :: 애스코63*1, 가스69*1.5, 바크70*1.5, 오튜75*1
  call SaveInteger(udg_hash, 41, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 41, StringHash("FCU-Unit1"), 'n02K')
  call SaveInteger(udg_hash, 41, StringHash("FCU-Unit2"), 'n02L')
  call SaveInteger(udg_hash, 41, StringHash("FCU-Unit3"), 'n02M')
  call SaveInteger(udg_hash, 41, StringHash("FCU-Unit4"), 'n02N')
  call SaveReal(udg_hash, 41, StringHash("FCU-Per1"), 1.)
  call SaveReal(udg_hash, 41, StringHash("FCU-Per2"), 2.5)
  call SaveReal(udg_hash, 41, StringHash("FCU-Per3"), 4.)
  call SaveReal(udg_hash, 41, StringHash("FCU-Per"), 5.)
  call SaveReal(udg_hash, 41, StringHash("FCU-Time"), 9.)
  call SaveReal(udg_hash, 41, StringHash("FCU-Time2"), 6.)
  //42. 난파선6	- Lv69~75(71.3)+80 :: 가스69*1, 바크70*2.5, 오튜75*1.5, HP/Exp +15%, ＊돌연변이+ 25%
  call SaveInteger(udg_hash, 42, StringHash("FCU-Count"), 3)
  call SaveInteger(udg_hash, 42, StringHash("FCU-Unit1"), 'n02L')
  call SaveInteger(udg_hash, 42, StringHash("FCU-Unit2"), 'n02M')
  call SaveInteger(udg_hash, 42, StringHash("FCU-Unit3"), 'n02N')
  call SaveReal(udg_hash, 42, StringHash("FCU-Per1"), 1.)
  call SaveReal(udg_hash, 42, StringHash("FCU-Per2"), 3.5)
  call SaveReal(udg_hash, 42, StringHash("FCU-Per"), 5.)
  call SaveReal(udg_hash, 42, StringHash("FCU-Time"), 9.)
  call SaveReal(udg_hash, 42, StringHash("FCU-Time2"), 6.)
  call SaveReal(udg_hash, 42, StringHash("FCU-HPx"), .15)
  call SaveReal(udg_hash, 42, StringHash("FCU-Mu"), .25)
  
  //43. 조화의던전 D - 65~74(69.8) :: D65*2 A71*2 *R73*1 K74*1 * HP+100%~120%
  call SaveInteger(udg_hash, 43, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 43, StringHash("FCU-Unit1"), 'n03D')
  call SaveInteger(udg_hash, 43, StringHash("FCU-Unit2"), 'n03E')
  call SaveInteger(udg_hash, 43, StringHash("FCU-Unit3"), 'n03G')
  call SaveInteger(udg_hash, 43, StringHash("FCU-Unit4"), 'n03F')
  call SaveReal(udg_hash, 43, StringHash("FCU-Per1"), 2.)
  call SaveReal(udg_hash, 43, StringHash("FCU-Per2"), 4.)
  call SaveReal(udg_hash, 43, StringHash("FCU-Per3"), 5.)
  call SaveReal(udg_hash, 43, StringHash("FCU-Per"), 6.)
  call SaveReal(udg_hash, 43, StringHash("FCU-Time"), 8.)
  call SaveReal(udg_hash, 43, StringHash("FCU-Time2"), 7.)
  call SaveReal(udg_hash, 43, StringHash("FCU-HP"), 1.)
  call SaveReal(udg_hash, 43, StringHash("FCU-HP2"), 0.2)
  //44. 조화의던전 A - 71~82(74.3) :: A71*2 *R73*2.5 K74*2.5 N78*1.5, E82*0.75 * HP+100%~120%
  call SaveInteger(udg_hash, 44, StringHash("FCU-Count"), 5)
  call SaveInteger(udg_hash, 44, StringHash("FCU-Unit1"), 'n03E')
  call SaveInteger(udg_hash, 44, StringHash("FCU-Unit2"), 'n03G')
  call SaveInteger(udg_hash, 44, StringHash("FCU-Unit3"), 'n03F')
  call SaveInteger(udg_hash, 44, StringHash("FCU-Unit4"), 'n03H')
  call SaveInteger(udg_hash, 44, StringHash("FCU-Unit5"), 'n03I')
  call SaveReal(udg_hash, 44, StringHash("FCU-Per1"), 2.)
  call SaveReal(udg_hash, 44, StringHash("FCU-Per2"), 4.5)
  call SaveReal(udg_hash, 44, StringHash("FCU-Per3"), 7.)
  call SaveReal(udg_hash, 44, StringHash("FCU-Per4"), 8.5)
  call SaveReal(udg_hash, 44, StringHash("FCU-Per"), 9.25)
  call SaveReal(udg_hash, 44, StringHash("FCU-Time"), 8.)
  call SaveReal(udg_hash, 44, StringHash("FCU-Time2"), 7.)
  call SaveReal(udg_hash, 44, StringHash("FCU-HP"), 1.)
  call SaveReal(udg_hash, 44, StringHash("FCU-HP2"), 0.2)
  //45. 조화의던전 R - 78~86(80.8) :: N78*3 E82*3 *S81*1.5 S86*1 * HP+100%~120%, 변이 +50%
  call SaveInteger(udg_hash, 45, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 45, StringHash("FCU-Unit1"), 'n03H')
  call SaveInteger(udg_hash, 45, StringHash("FCU-Unit2"), 'n03I')
  call SaveInteger(udg_hash, 45, StringHash("FCU-Unit3"), 'n03J')
  call SaveInteger(udg_hash, 45, StringHash("FCU-Unit4"), 'n03K')
  call SaveReal(udg_hash, 45, StringHash("FCU-Per1"), 3.)
  call SaveReal(udg_hash, 45, StringHash("FCU-Per2"), 6.)
  call SaveReal(udg_hash, 45, StringHash("FCU-Per3"), 7.5)
  call SaveReal(udg_hash, 45, StringHash("FCU-Per"), 8.5)
  call SaveReal(udg_hash, 45, StringHash("FCU-Time"), 8.)
  call SaveReal(udg_hash, 45, StringHash("FCU-Time2"), 7.)
  call SaveReal(udg_hash, 45, StringHash("FCU-HP"), 1.)
  call SaveReal(udg_hash, 45, StringHash("FCU-HP2"), 0.2)
  call SaveReal(udg_hash, 45, StringHash("FCU-Mu"), 0.5)
  //46. 조화의던전 K - 81~91(85.1) :: *S81*2.5 S86*4.5 D!91*1 * HP+100%~120%, 변이 +100%
  call SaveInteger(udg_hash, 46, StringHash("FCU-Count"), 3)
  call SaveInteger(udg_hash, 46, StringHash("FCU-Unit1"), 'n03J')
  call SaveInteger(udg_hash, 46, StringHash("FCU-Unit2"), 'n03K')
  call SaveInteger(udg_hash, 46, StringHash("FCU-Unit3"), 'n03L')
  call SaveReal(udg_hash, 46, StringHash("FCU-Per1"), 2.5)
  call SaveReal(udg_hash, 46, StringHash("FCU-Per2"), 7.)
  call SaveReal(udg_hash, 46, StringHash("FCU-Per"), 8.)
  call SaveReal(udg_hash, 46, StringHash("FCU-Time"), 8.)
  call SaveReal(udg_hash, 46, StringHash("FCU-Time2"), 7.)
  call SaveReal(udg_hash, 46, StringHash("FCU-HP"), 1.)
  call SaveReal(udg_hash, 46, StringHash("FCU-HP2"), 0.2)
  call SaveReal(udg_hash, 46, StringHash("FCU-Mu"), 1.)
  
  //47. 솔로 던전
//[190]솔로던전 - 3종 :: 사이렌, 변종 슬러그, 물귀신 // Lv 30-7~98+3
  call SaveInteger(udg_hash, 47, StringHash("FCU-Count"), 3)
  call SaveInteger(udg_hash, 47, StringHash("FCU-Unit1"), 'n03M')
  call SaveInteger(udg_hash, 47, StringHash("FCU-Unit2"), 'n03N')
  call SaveInteger(udg_hash, 47, StringHash("FCU-Unit3"), 'n03O')
  call SaveReal(udg_hash, 47, StringHash("FCU-Per1"), .5)
  call SaveReal(udg_hash, 47, StringHash("FCU-Per2"), .65)
  call SaveReal(udg_hash, 47, StringHash("FCU-Per"), 1.)
  call SaveReal(udg_hash, 47, StringHash("FCU-Add2"), .2)
  call SaveReal(udg_hash, 47, StringHash("FCU-Time"), 15.)
  call SaveReal(udg_hash, 47, StringHash("FCU-Time2"), 7.5)
  
//48. 호러 초급(변이x) - 변이x
  call SaveInteger(udg_hash, 48, StringHash("FCU-Count"), 5)
  call SaveInteger(udg_hash, 48, StringHash("FCU-Unit1"), 'n03P')
  call SaveInteger(udg_hash, 48, StringHash("FCU-Unit2"), 'n03Q')
  call SaveInteger(udg_hash, 48, StringHash("FCU-Unit3"), 'n03R')
  call SaveInteger(udg_hash, 48, StringHash("FCU-Unit4"), 'n03S')
  call SaveInteger(udg_hash, 48, StringHash("FCU-Unit5"), 'n03T')
  call SaveReal(udg_hash, 48, StringHash("FCU-Per1"), 1.)
  call SaveReal(udg_hash, 48, StringHash("FCU-Per2"), 2.)
  call SaveReal(udg_hash, 48, StringHash("FCU-Per3"), 3.)
  call SaveReal(udg_hash, 48, StringHash("FCU-Per4"), 4.)
  call SaveReal(udg_hash, 48, StringHash("FCU-Per"), 5.)
  call SaveReal(udg_hash, 48, StringHash("FCU-Time"), 6.)
  call SaveReal(udg_hash, 48, StringHash("FCU-Time2"), 3.)
  call SaveReal(udg_hash, 48, StringHash("FCU-HP"), 0.4)
  call SaveReal(udg_hash, 48, StringHash("FCU-HP2"), 0.3)
  call SaveReal(udg_hash, 48, StringHash("FCU-Mu"), -5)
  call SaveInteger(udg_hash, 48, StringHash("FCU-Add1"), 1)
  call SaveReal(udg_hash, 48, StringHash("FCU-Add2"), .2)

//호러 캐슬 중급[202] - 변이x
  call SaveInteger(udg_hash, 49, StringHash("FCU-Count"), 5)
  call SaveInteger(udg_hash, 49, StringHash("FCU-Unit1"), 'n03X')
  call SaveInteger(udg_hash, 49, StringHash("FCU-Unit2"), 'n03U')
  call SaveInteger(udg_hash, 49, StringHash("FCU-Unit3"), 'n03V')
  call SaveInteger(udg_hash, 49, StringHash("FCU-Unit4"), 'n03W')
  call SaveInteger(udg_hash, 49, StringHash("FCU-Unit5"), 'n03Y')
  call SaveReal(udg_hash, 49, StringHash("FCU-Per1"), 1.)
  call SaveReal(udg_hash, 49, StringHash("FCU-Per2"), 2.)
  call SaveReal(udg_hash, 49, StringHash("FCU-Per3"), 3.)
  call SaveReal(udg_hash, 49, StringHash("FCU-Per4"), 4.)
  call SaveReal(udg_hash, 49, StringHash("FCU-Per"), 5.)
  call SaveReal(udg_hash, 49, StringHash("FCU-Time"), 6.)
  call SaveReal(udg_hash, 49, StringHash("FCU-Time2"), 2.)
  call SaveReal(udg_hash, 49, StringHash("FCU-HP"), 1.)
  call SaveReal(udg_hash, 49, StringHash("FCU-HP2"), 0.7)
  call SaveReal(udg_hash, 49, StringHash("FCU-Mu"), -5)
  call SaveReal(udg_hash, 49, StringHash("FCU-Add2"), 1.)

//호러 캐슬 상급[202] - 변이x
  call SaveInteger(udg_hash, 50, StringHash("FCU-Count"), 5)
  call SaveInteger(udg_hash, 50, StringHash("FCU-Unit1"), 'n03X')
  call SaveInteger(udg_hash, 50, StringHash("FCU-Unit2"), 'n03U')
  call SaveInteger(udg_hash, 50, StringHash("FCU-Unit3"), 'n03V')
  call SaveInteger(udg_hash, 50, StringHash("FCU-Unit4"), 'n03W')
  call SaveInteger(udg_hash, 50, StringHash("FCU-Unit5"), 'n03Y')
  call SaveReal(udg_hash, 50, StringHash("FCU-Per1"), 1.)
  call SaveReal(udg_hash, 50, StringHash("FCU-Per2"), 2.)
  call SaveReal(udg_hash, 50, StringHash("FCU-Per3"), 3.)
  call SaveReal(udg_hash, 50, StringHash("FCU-Per4"), 4.)
  call SaveReal(udg_hash, 50, StringHash("FCU-Per"), 5.)
  call SaveReal(udg_hash, 50, StringHash("FCU-Time"), 6.)
  call SaveReal(udg_hash, 50, StringHash("FCU-Time2"), 2.)
  call SaveReal(udg_hash, 50, StringHash("FCU-HP"), 2.)
  call SaveReal(udg_hash, 50, StringHash("FCU-HP2"), 0.7)
  call SaveReal(udg_hash, 50, StringHash("FCU-HP3"), 0.3)
  call SaveReal(udg_hash, 50, StringHash("FCU-Mu"), -5)
  call SaveReal(udg_hash, 50, StringHash("FCU-Add2"), 1.5)
call TriggerSleepAction(.1)

//광산들
  call SaveReal(udg_hash, 'n04D', StringHash("FCU-Miss"), 15.)
  call SaveReal(udg_hash, 'n04E', StringHash("FCU-Miss"), 20.)
  call SaveReal(udg_hash, 'n04F', StringHash("FCU-Miss"), 25.)
  call SaveReal(udg_hash, 'n04G', StringHash("FCU-Miss"), 30.)
  call SaveReal(udg_hash, 'n04H', StringHash("FCU-CriP"), 15.)
  call SaveReal(udg_hash, 'n04H', StringHash("FCU-CriX"), .5)
  call SaveReal(udg_hash, 'n04F', StringHash("FCU-CriP"), 25.)
  call SaveReal(udg_hash, 'n04F', StringHash("FCU-CriX"), .5)
  call SaveReal(udg_hash, 'n04H', StringHash("FCU-CriP"), 25.)
  call SaveReal(udg_hash, 'n04H', StringHash("FCU-CriX"), .5)
  call SaveReal(udg_hash, 'n04R', StringHash("FCU-CriP"), 20.)
  call SaveReal(udg_hash, 'n04R', StringHash("FCU-CriX"), .5)
  call SaveReal(udg_hash, 'n04R', StringHash("FCU-Bash"), 2000)
  call SaveReal(udg_hash, 'n04S', StringHash("FCU-CriP"), 20.)
  call SaveReal(udg_hash, 'n04S', StringHash("FCU-CriX"), .5)
  call SaveReal(udg_hash, 'n04S', StringHash("FCU-Bash"), 3000)
  
  //01층: "2종" 오크병사, 그림록
  call SaveInteger(udg_hash, 51, StringHash("FCU-Count"), 2)
  call SaveInteger(udg_hash, 51, StringHash("FCU-Unit1"), 'n04P')
  call SaveInteger(udg_hash, 51, StringHash("FCU-Unit2"), 'n04D')
  call SaveReal(udg_hash, 51, StringHash("FCU-Per1"), .6)
  call SaveReal(udg_hash, 51, StringHash("FCU-Per"), 1.)
  call SaveReal(udg_hash, 51, StringHash("FCU-Time"), 40.)
  call SaveReal(udg_hash, 51, StringHash("FCU-Time2"), 10.)
//05층: "4종" 오크병사, 그림록%+, 광산드워프, 오크전사
  call SaveInteger(udg_hash, 52, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 52, StringHash("FCU-Unit1"), 'n04P')
  call SaveInteger(udg_hash, 52, StringHash("FCU-Unit2"), 'n04D')
  call SaveInteger(udg_hash, 52, StringHash("FCU-Unit3"), 'n04R')
  call SaveInteger(udg_hash, 52, StringHash("FCU-Unit4"), 'n04Q')
  call SaveReal(udg_hash, 52, StringHash("FCU-Per1"), .3)
  call SaveReal(udg_hash, 52, StringHash("FCU-Per2"), 1.)
  call SaveReal(udg_hash, 52, StringHash("FCU-Per3"), 1.3)
  call SaveReal(udg_hash, 52, StringHash("FCU-Per"), 1.6)
  call SaveReal(udg_hash, 52, StringHash("FCU-Time"), 40.)
  call SaveReal(udg_hash, 52, StringHash("FCU-Time2"), 10.)
//08층: "4종" 그림록, 광산드워프, 오크전사, 그림록병사
  call SaveInteger(udg_hash, 53, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 53, StringHash("FCU-Unit1"), 'n04D')
  call SaveInteger(udg_hash, 53, StringHash("FCU-Unit2"), 'n04R')
  call SaveInteger(udg_hash, 53, StringHash("FCU-Unit3"), 'n04Q')
  call SaveInteger(udg_hash, 53, StringHash("FCU-Unit4"), 'n04E')
  call SaveReal(udg_hash, 53, StringHash("FCU-Per1"), .1)
  call SaveReal(udg_hash, 53, StringHash("FCU-Per2"), .3)
  call SaveReal(udg_hash, 53, StringHash("FCU-Per3"), .6)
  call SaveReal(udg_hash, 53, StringHash("FCU-Per"), .9)
  call SaveReal(udg_hash, 53, StringHash("FCU-Time"), 40.)
  call SaveReal(udg_hash, 53, StringHash("FCU-Time2"), 10.)
//12층: "4종" 광산드워프, 오크전사, 그림록병사, 광산드워프병사
  call SaveInteger(udg_hash, 54, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 54, StringHash("FCU-Unit1"), 'n04R')
  call SaveInteger(udg_hash, 54, StringHash("FCU-Unit2"), 'n04Q')
  call SaveInteger(udg_hash, 54, StringHash("FCU-Unit3"), 'n04E')
  call SaveInteger(udg_hash, 54, StringHash("FCU-Unit4"), 'n04S')
  call SaveReal(udg_hash, 54, StringHash("FCU-Per1"), .3)
  call SaveReal(udg_hash, 54, StringHash("FCU-Per2"), .6)
  call SaveReal(udg_hash, 54, StringHash("FCU-Per3"), 1.)
  call SaveReal(udg_hash, 54, StringHash("FCU-Per"), 1.05)
  call SaveReal(udg_hash, 54, StringHash("FCU-Time"), 40.)
  call SaveReal(udg_hash, 54, StringHash("FCU-Time2"), 10.)

call TriggerSleepAction(.1)
//16층: "5종" 그림록병사, 광산드워프병사, 오크가드, 도둑산타, 그림록근위병
  call SaveInteger(udg_hash, 55, StringHash("FCU-Count"), 5)
  call SaveInteger(udg_hash, 55, StringHash("FCU-Unit1"), 'n04E')
  call SaveInteger(udg_hash, 55, StringHash("FCU-Unit2"), 'n04S')
  call SaveInteger(udg_hash, 55, StringHash("FCU-Unit3"), 'n04J')
  call SaveInteger(udg_hash, 55, StringHash("FCU-Unit4"), 'n04H')
  call SaveInteger(udg_hash, 55, StringHash("FCU-Unit5"), 'n04F')
  call SaveReal(udg_hash, 55, StringHash("FCU-Per1"), .2)
  call SaveReal(udg_hash, 55, StringHash("FCU-Per2"), .4)
  call SaveReal(udg_hash, 55, StringHash("FCU-Per3"), .55)
  call SaveReal(udg_hash, 55, StringHash("FCU-Per4"), .6)
  call SaveReal(udg_hash, 55, StringHash("FCU-Per"), .7)
  call SaveReal(udg_hash, 55, StringHash("FCU-Time"), 40.)
  call SaveReal(udg_hash, 55, StringHash("FCU-Time2"), 10.)

//19층: "4종" 광산드워프병사, 오크가드, 도둑산타, 그림록근위병
  call SaveInteger(udg_hash, 56, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 56, StringHash("FCU-Unit1"), 'n04S')
  call SaveInteger(udg_hash, 56, StringHash("FCU-Unit2"), 'n04J')
  call SaveInteger(udg_hash, 56, StringHash("FCU-Unit3"), 'n04H')
  call SaveInteger(udg_hash, 56, StringHash("FCU-Unit4"), 'n04F')
  call SaveReal(udg_hash, 56, StringHash("FCU-Per1"), .15)
  call SaveReal(udg_hash, 56, StringHash("FCU-Per2"), .35)
  call SaveReal(udg_hash, 56, StringHash("FCU-Per3"), .45)
  call SaveReal(udg_hash, 56, StringHash("FCU-Per"), .65)
  call SaveReal(udg_hash, 56, StringHash("FCU-Time"), 40.)
  call SaveReal(udg_hash, 56, StringHash("FCU-Time2"), 10.)

//23층: "2종" 도둑산타, 그림록근위병
  call SaveInteger(udg_hash, 57, StringHash("FCU-Count"), 2)
  call SaveInteger(udg_hash, 57, StringHash("FCU-Unit1"), 'n04H')
  call SaveInteger(udg_hash, 57, StringHash("FCU-Unit2"), 'n04F')
  call SaveReal(udg_hash, 57, StringHash("FCU-Per1"), .05)
  call SaveReal(udg_hash, 57, StringHash("FCU-Per"), .5)
  call SaveReal(udg_hash, 57, StringHash("FCU-Time"), 40.)
  call SaveReal(udg_hash, 57, StringHash("FCU-Time2"), 10.)

call TriggerSleepAction(.1)
//26층: "3종" 도둑산타, 그림록근위병%+, 드라코
  call SaveInteger(udg_hash, 58, StringHash("FCU-Count"), 3)
  call SaveInteger(udg_hash, 58, StringHash("FCU-Unit1"), 'n04H')
  call SaveInteger(udg_hash, 58, StringHash("FCU-Unit2"), 'n04F')
  call SaveInteger(udg_hash, 58, StringHash("FCU-Unit3"), 'n04I')
  call SaveReal(udg_hash, 58, StringHash("FCU-Per1"), .1)
  call SaveReal(udg_hash, 58, StringHash("FCU-Per2"), .35)
  call SaveReal(udg_hash, 58, StringHash("FCU-Per"), .45)
  call SaveReal(udg_hash, 58, StringHash("FCU-Time"), 40.)
  call SaveReal(udg_hash, 58, StringHash("FCU-Time2"), 10.)

//28층: "4종" 도둑산타, 그림록근위병, 드라코, 그림록퀸
  call SaveInteger(udg_hash, 59, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 59, StringHash("FCU-Unit1"), 'n04H')
  call SaveInteger(udg_hash, 59, StringHash("FCU-Unit2"), 'n04F')
  call SaveInteger(udg_hash, 59, StringHash("FCU-Unit3"), 'n04I')
  call SaveInteger(udg_hash, 59, StringHash("FCU-Unit4"), 'n04G')
  call SaveReal(udg_hash, 59, StringHash("FCU-Per1"), .1)
  call SaveReal(udg_hash, 59, StringHash("FCU-Per2"), .3)
  call SaveReal(udg_hash, 59, StringHash("FCU-Per3"), .45)
  call SaveReal(udg_hash, 59, StringHash("FCU-Per"), .5)
  call SaveReal(udg_hash, 59, StringHash("FCU-Time"), 40.)
  call SaveReal(udg_hash, 59, StringHash("FCU-Time2"), 10.)

//29층: "7종" 드라코, 그림록퀸, 헬X5
  call SaveInteger(udg_hash, 60, StringHash("FCU-Count"), 7)
  call SaveInteger(udg_hash, 60, StringHash("FCU-Unit1"), 'n04I')
  call SaveInteger(udg_hash, 60, StringHash("FCU-Unit2"), 'n04G')
  call SaveInteger(udg_hash, 60, StringHash("FCU-Unit3"), 'n04L')
  call SaveInteger(udg_hash, 60, StringHash("FCU-Unit4"), 'n04M')
  call SaveInteger(udg_hash, 60, StringHash("FCU-Unit5"), 'n04N')
  call SaveInteger(udg_hash, 60, StringHash("FCU-Unit6"), 'n04O')
  call SaveInteger(udg_hash, 60, StringHash("FCU-Unit7"), 'n04K')
  call SaveReal(udg_hash, 60, StringHash("FCU-Per1"), .25)
  call SaveReal(udg_hash, 60, StringHash("FCU-Per2"), .35)
  call SaveReal(udg_hash, 60, StringHash("FCU-Per3"), .45)
  call SaveReal(udg_hash, 60, StringHash("FCU-Per4"), .55)
  call SaveReal(udg_hash, 60, StringHash("FCU-Per5"), .65)
  call SaveReal(udg_hash, 60, StringHash("FCU-Per6"), .75)
  call SaveReal(udg_hash, 60, StringHash("FCU-Per"), .85)
  call SaveReal(udg_hash, 60, StringHash("FCU-Time"), 40.)
  call SaveReal(udg_hash, 60, StringHash("FCU-Time2"), 10.)

call TriggerSleepAction(.1)
//[61]죽음의 마을: 묘지기의 터 - 3종 :: 좀비 2, 거지좀비 1 // 20초에 3~4.5마리 [분당 11.25마리]
  call SaveInteger(udg_hash, 61, StringHash("FCU-Count"), 2)
  call SaveInteger(udg_hash, 61, StringHash("FCU-Unit1"), 'n048')
  call SaveInteger(udg_hash, 61, StringHash("FCU-Unit2"), 'n047')
  call SaveReal(udg_hash, 61, StringHash("FCU-Per1"), 1.8)
  call SaveReal(udg_hash, 61, StringHash("FCU-Per"), 3.)
  call SaveReal(udg_hash, 61, StringHash("FCU-Time"), 13.)
  call SaveReal(udg_hash, 61, StringHash("FCU-Time2"), 4.)
  call SaveReal(udg_hash, 61, StringHash("FCU-HP"), 3.)
  call SaveReal(udg_hash, 61, StringHash("FCU-HP2"), 1.5)
  call SaveReal(udg_hash, 61, StringHash("FCU-HP3"), .25)
  //call SaveInteger(udg_hash, 61, StringHash("FCU-Add1"), 2)
  call SaveReal(udg_hash, 61, StringHash("FCU-Add2"), 1.5)
  
//[62]죽음의 마을: 잊혀진 성당 - 10종 :: 좀비 6, 거지좀비 3, 마법좀비 // 7초에 1~1.5마리 [분당 10.7마리]
  call SaveInteger(udg_hash, 62, StringHash("FCU-Count"), 3)
  call SaveInteger(udg_hash, 62, StringHash("FCU-Unit1"), 'n048')
  call SaveInteger(udg_hash, 62, StringHash("FCU-Unit2"), 'n047')
  call SaveInteger(udg_hash, 62, StringHash("FCU-Unit3"), 'n04C')
  call SaveReal(udg_hash, 62, StringHash("FCU-Per1"), 6.5)
  call SaveReal(udg_hash, 62, StringHash("FCU-Per2"), 9.5)
  call SaveReal(udg_hash, 62, StringHash("FCU-Per"), 10.)
  call SaveReal(udg_hash, 62, StringHash("FCU-Time"), 13.)
  call SaveReal(udg_hash, 62, StringHash("FCU-Time2"), 4.)
  call SaveReal(udg_hash, 62, StringHash("FCU-HP"), 4.)
  call SaveReal(udg_hash, 62, StringHash("FCU-HP2"), 2.)
  call SaveReal(udg_hash, 62, StringHash("FCU-HP3"), 0.05)
  call SaveReal(udg_hash, 62, StringHash("FCU-Add2"), 1.7)
//[63]죽음의 마을: 목매단 나무 - 4종 :: 거지좀비, 광부좀비, 농부좀비, 목수좀비 // 17~24초에 4마리 [분당 11.7마리]
  call SaveInteger(udg_hash, 63, StringHash("FCU-Count"), 4)
  call SaveInteger(udg_hash, 63, StringHash("FCU-Unit1"), 'n048')
  call SaveInteger(udg_hash, 63, StringHash("FCU-Unit2"), 'n049')
  call SaveInteger(udg_hash, 63, StringHash("FCU-Unit3"), 'n04A')
  call SaveInteger(udg_hash, 63, StringHash("FCU-Unit4"), 'n04B')
  call SaveReal(udg_hash, 63, StringHash("FCU-Per1"), 1.)
  call SaveReal(udg_hash, 63, StringHash("FCU-Per2"), 2.)
  call SaveReal(udg_hash, 63, StringHash("FCU-Per3"), 3.)
  call SaveReal(udg_hash, 63, StringHash("FCU-Per"), 4.)
  call SaveReal(udg_hash, 63, StringHash("FCU-Time"), 13.)
  call SaveReal(udg_hash, 63, StringHash("FCU-Time2"), 4.)
  call SaveReal(udg_hash, 63, StringHash("FCU-HP"), 4.)
  call SaveReal(udg_hash, 63, StringHash("FCU-HP2"), 2.)
  call SaveReal(udg_hash, 62, StringHash("FCU-Add2"), .95)
call TriggerSleepAction(.1)
//[64]죽음의 마을: 좀비와 크립트 - 1종 :: 좀비 // 12초에 1~3.5마리
  call SaveInteger(udg_hash, 64, StringHash("FCU-Count"), 1)
  call SaveInteger(udg_hash, 64, StringHash("FCU-Unit1"), 'n047')
  call SaveReal(udg_hash, 64, StringHash("FCU-Time"), 13.)
  call SaveReal(udg_hash, 64, StringHash("FCU-Time2"), 4.)
  call SaveReal(udg_hash, 64, StringHash("FCU-HP"), 4.)
  call SaveReal(udg_hash, 64, StringHash("FCU-HP2"), 2.)
  call SaveReal(udg_hash, 64, StringHash("FCU-Add2"), 2.1)
//[65]죽음의마을: 몰락귀족의 저택 - 6종 :: 좀비 2, 거지좀비, 광부좀비, 농부좀비, 목수좀비 // 16초에 3~4.5마리 [분당 14.06마리]
  call SaveInteger(udg_hash, 65, StringHash("FCU-Count"), 5)
  call SaveInteger(udg_hash, 65, StringHash("FCU-Unit1"), 'n048')
  call SaveInteger(udg_hash, 65, StringHash("FCU-Unit2"), 'n047')
  call SaveInteger(udg_hash, 65, StringHash("FCU-Unit3"), 'n049')
  call SaveInteger(udg_hash, 65, StringHash("FCU-Unit4"), 'n04A')
  call SaveInteger(udg_hash, 65, StringHash("FCU-Unit5"), 'n04B')
  call SaveReal(udg_hash, 65, StringHash("FCU-Per1"), 1.)
  call SaveReal(udg_hash, 65, StringHash("FCU-Per2"), 2.)
  call SaveReal(udg_hash, 65, StringHash("FCU-Per3"), 3.)
  call SaveReal(udg_hash, 65, StringHash("FCU-Per4"), 4.)
  call SaveReal(udg_hash, 65, StringHash("FCU-Per"), 5.)
  call SaveReal(udg_hash, 65, StringHash("FCU-Time"), 13.)
  call SaveReal(udg_hash, 65, StringHash("FCU-Time2"), 4.)
  call SaveReal(udg_hash, 65, StringHash("FCU-HP"), 4.)
  call SaveReal(udg_hash, 65, StringHash("FCU-HP2"), 2.)
  //call SaveInteger(udg_hash, 65, StringHash("FCU-Add1"), 2)
  call SaveReal(udg_hash, 65, StringHash("FCU-Add2"), 2.3)
//[66]죽음의 마을: 이차원 제단 - 23종 :: 좀비x6, 거지좀비x4, 광부좀비x4, 농부좀비x4, 목수좀비x4, 마법좀비 // 22초에 4~6.5마리 [분당 14.3마리]
  call SaveInteger(udg_hash, 66, StringHash("FCU-Count"), 6)
  call SaveInteger(udg_hash, 66, StringHash("FCU-Unit1"), 'n048')
  call SaveInteger(udg_hash, 66, StringHash("FCU-Unit2"), 'n047')
  call SaveInteger(udg_hash, 66, StringHash("FCU-Unit3"), 'n049')
  call SaveInteger(udg_hash, 66, StringHash("FCU-Unit4"), 'n04A')
  call SaveInteger(udg_hash, 66, StringHash("FCU-Unit5"), 'n04B')
  call SaveInteger(udg_hash, 66, StringHash("FCU-Unit6"), 'n04C')
  call SaveReal(udg_hash, 66, StringHash("FCU-Per1"), 4.)
  call SaveReal(udg_hash, 66, StringHash("FCU-Per2"), 8.)
  call SaveReal(udg_hash, 66, StringHash("FCU-Per3"), 12.)
  call SaveReal(udg_hash, 66, StringHash("FCU-Per4"), 16.)
  call SaveReal(udg_hash, 66, StringHash("FCU-Per5"), 22.)
  call SaveReal(udg_hash, 66, StringHash("FCU-Per"), 23.)
  call SaveReal(udg_hash, 66, StringHash("FCU-Time"), 13.)
  call SaveReal(udg_hash, 66, StringHash("FCU-Time2"), 4.)
  call SaveReal(udg_hash, 66, StringHash("FCU-HP"), 4.)
  call SaveReal(udg_hash, 66, StringHash("FCU-HP2"), 2.)
  call SaveReal(udg_hash, 66, StringHash("FCU-HP3"), .1)
  //call SaveInteger(udg_hash, 66, StringHash("FCU-Add1"), 3)
  call SaveReal(udg_hash, 66, StringHash("FCU-Add2"), 2.5)
call TriggerSleepAction(.1)
//[67]죽음의 마을: 오염된 구역 - 4종 ::거지좀비 25% 좀비 20% 광부/농부/목수 15% 마법좀비 10% // 1초에 3마리
  call SaveInteger(udg_hash, 67, StringHash("FCU-Count"), 6)
  call SaveInteger(udg_hash, 67, StringHash("FCU-Unit1"), 'n048')
  call SaveInteger(udg_hash, 67, StringHash("FCU-Unit2"), 'n047')
  call SaveInteger(udg_hash, 67, StringHash("FCU-Unit3"), 'n049')
  call SaveInteger(udg_hash, 67, StringHash("FCU-Unit4"), 'n04A')
  call SaveInteger(udg_hash, 67, StringHash("FCU-Unit5"), 'n04B')
  call SaveInteger(udg_hash, 67, StringHash("FCU-Unit6"), 'n04C')
  call SaveReal(udg_hash, 67, StringHash("FCU-Per1"), 2.5)
  call SaveReal(udg_hash, 67, StringHash("FCU-Per2"), 4.5)
  call SaveReal(udg_hash, 67, StringHash("FCU-Per3"), 6.)
  call SaveReal(udg_hash, 67, StringHash("FCU-Per4"), 7.5)
  call SaveReal(udg_hash, 67, StringHash("FCU-Per5"), 9.)
  call SaveReal(udg_hash, 67, StringHash("FCU-Per"), 10.)
  call SaveReal(udg_hash, 67, StringHash("FCU-Time"), 1.)
  call SaveInteger(udg_hash, 67, StringHash("FCU-Add1"), 2)

//Ai Set
  call SaveStr(udg_hash, 'n03W', StringHash("FAI-Set"), "#")
  call SaveStr(udg_hash, 'n010', StringHash("FAI-Set"), "1347")
  call SaveStr(udg_hash, 'n011', StringHash("FAI-Set"), "1235")
  call SaveStr(udg_hash, 'n01M', StringHash("FAI-Set"), "1#")
  call SaveStr(udg_hash, 'n02O', StringHash("FAI-Set"), "138")
  call SaveStr(udg_hash, 'n04W', StringHash("FAI-Set"), "#")
  call SaveStr(udg_hash, 'n04C', StringHash("FAI-Set"), "3#5")
endfunction

//===========================================================================
function InitTrig_Set_Monster takes nothing returns nothing
  set gg_trg_Set_Monster = CreateTrigger()
  call TriggerAddAction(gg_trg_Set_Monster, function Trig_Sys_Monster_Set_Actions)
endfunction

//===========================================================================
// Trigger: Set Party
//
// -파티생성 (메시지)
// -파티해체
// -파티목록
// -파티탈퇴
// -파티원목록/정보
// -파티초대
// -파티성향
// -파티장변경
//===========================================================================
function Trig_Set_Party_Set takes nothing returns nothing
  set bj_forLoopAIndex = 1
  loop
    if ( isPlaying(Player(bj_forLoopAIndex-1)) ) then
      call SetPlayerAllianceStateBJ(GetEnumPlayer(), Player(bj_forLoopAIndex-1), bj_ALLIANCE_ALLIED)
    endif
    exitwhen bj_forLoopAIndex >= bj_MAX_PLAYERS
    set bj_forLoopAIndex = bj_forLoopAIndex + 1
  endloop
  call TriggerRegisterPlayerChatEvent(gg_trg_Party_Intr_all, GetEnumPlayer(), "-파티", false)
  call TriggerRegisterPlayerChatEvent(gg_trg_Party_Intr_all, GetEnumPlayer(), "-가입", false)
  call TriggerRegisterPlayerChatEvent(gg_trg_Intr_Title, GetEnumPlayer(), "-칭호", false)
endfunction

function Trig_Set_Party_Actions takes nothing returns nothing
  call DestroyTrigger( GetTriggeringTrigger() )
  set gg_trg_Set_Party = null
  call ForForce(udg_temp_pg, function Trig_Set_Party_Set)
endfunction

//===========================================================================
function InitTrig_Set_Party takes nothing returns nothing
  set gg_trg_Set_Party = CreateTrigger(  )
  call TriggerAddAction( gg_trg_Set_Party, function Trig_Set_Party_Actions )
endfunction

//===========================================================================
// Trigger: Set SignBar
//
// 1표지판 밀레스 입구, 1920, -17248 "밀레스에 오신걸 환영합니다"
// 2표지판 지하묘지, 13259.|-15181. "앞은 2층입니다. 조심하세요."
// 3표지판 지하묘지, 9408, -18176, (흐릿한 글귀가 있습니다) | 이 앞.. ㅂ..룸... 매우 강.... 조심...
// 4표지만 큐르페이 굴, 2300, -14853. 큐르페이 굴
// 5, 조화의던전 -4360, -5960, 조화의던전
// 6, -11522, 4852, ←우드랜드 II / 우드 I→
// 7 -13888, 6784, ↙III / ↖IV / V →
// 8 -10464, 8080 ↙V / →VI / VII ↑
// 9  -13888, 10560 ↘ VII / ← VIII / IX ↗
// 10  -11968, 11232 ↘ VII / ↑ IX / X ↗
// drag - 무언가 적혀져 있다. 2초간 유동텍스트 표시
//===========================================================================
native EXSetEffectSize takes effect e, real size returns nothing
native EXEffectMatRotateZ takes effect e, real angle returns nothing
//표지판 생성
constant function GetPath takes integer i, boolean x returns real
  if ( i == 1 ) then
    if ( x ) then
      return 1920.
    else
      return -17248.
    endif
  elseif ( i == 2 ) then
    if ( x ) then
      return 13259.
    else
      return -15181.
    endif
  elseif ( i == 3 ) then
    if ( x ) then
      return 9408.
    else
      return -18176.
    endif
  elseif ( i == 4 ) then
    if ( x ) then
      return 2305.
    else
      return -14853.
    endif
  elseif ( i == 5 ) then
    if ( x ) then
      return -4360.
    else
      return -5960.
    endif
  elseif ( i == 6 ) then
    if ( x ) then
      return -11522.
    else
      return 4852.
    endif
  elseif ( i == 7 ) then
    if ( x ) then
      return -13888.
    else
      return 6784.
    endif
  elseif ( i == 8 ) then
    if ( x ) then
      return -10464.
    else
      return 8080.
    endif
  elseif ( i == 9 ) then
    if ( x ) then
      return -13888.
    else
      return 10560.
    endif
  elseif ( i == 10 ) then
    if ( x ) then
      return -11968.
    else
      return 11232.
    endif
  endif
  return 0.
endfunction
constant function GetPString takes integer i returns string
  if ( i == 1 ) then
    return "밀레스에 오신걸 환영합니다"
  elseif ( i == 2 ) then
    return "앞은 2층입니다. 조심하세요"
  elseif ( i == 3 ) then
    return "이 앞.. ㅂ..룸... 매우 강.... 조심..."
  elseif ( i == 4 ) then
    return "큐르페이를 조심하라"
  elseif ( i == 5 ) then
    return "조화의던전 입구"
  elseif ( i == 6 ) then
    return "←우드랜드 II / 우드 I→"
  elseif ( i == 7 ) then
    return "↙III / ↖IV / V →"
  elseif ( i == 8 ) then
    return "↙V / →VI / VII ↑"
  elseif ( i == 9 ) then
    return "↘ VII / ← VIII / IX ↗"
  elseif ( i == 10 ) then
    return "↘ VII / ↑ IX / X ↗"
  else
    return ""
  endif
endfunction

function CreateTrackable2 takes player p, integer no returns nothing
 local string s = ""
 local string Flat = ""
  if ( p != null ) then
    if ( GetLocalPlayer() == p ) then
      set s = "Doodads\\LordaeronSummer\\Props\\SignPost\\SignPost.mdl"
      set Flat = "Doodads\\Terrain\\InvisiblePlatform\\InvisiblePlatform.mdl"
    endif
  endif
  if ( GetPath(no, true) != 0. ) then
    set udg_temp_tr = CreateTrackable(Flat, GetPath(no, true), GetPath(no, false), 0)
    set bj_lastCreatedEffect = AddSpecialEffect(s, GetPath(no, true), GetPath(no, false))
    call EXSetEffectSize(bj_lastCreatedEffect, 2.)
    call EXEffectMatRotateZ(bj_lastCreatedEffect, bj_UNIT_FACING)
    
    call TriggerRegisterTrackableTrackEvent(gg_trg_SignBar_Drag, udg_temp_tr)
    call SaveInteger(udg_hash, GetHandleId(udg_temp_tr), StringHash("tr-n"), no)
    call SavePlayerHandle(udg_hash, GetHandleId(udg_temp_tr), StringHash("tr-p"), p)
  endif
 set s = null
endfunction
constant function GetPathX takes integer no returns real
if ( no == 1 ) then
  return 1012.9
elseif ( no == 2 ) then
  return 1876.9
elseif ( no == 3 ) then
  return 788.9
elseif ( no == 4 ) then
  return 1044.9
elseif ( no == 5 ) then
  return 1652.9
elseif ( no == 6 ) then
  return 1652.9
else
  return 0.
endif
endfunction
constant function GetPathY takes integer no returns real
if ( no == 1 ) then
  return -8961.3
elseif ( no == 2 ) then
  return -9345.3
elseif ( no == 3 ) then
  return -9345.3
elseif ( no == 4 ) then
  return -9697.3
elseif ( no == 5 ) then
  return -9697.3
elseif ( no == 6 ) then
  return -8929.3
else
  return 0.
endif
endfunction
constant function GetPathA takes integer no returns real
if ( no == 1 ) then
  return 332.923
elseif ( no == 2 ) then
  return 199.317
elseif ( no == 3 ) then
  return 11.630
elseif ( no == 4 ) then
  return 45.999
elseif ( no == 5 ) then
  return 123.733
elseif ( no == 6 ) then
  return 250.235
else
  return 0.
endif
endfunction
constant function GetPathS takes integer i returns string
  if ( i == 1 ) then
    return "rookie544|루키, 140법사(S1)/99순도(S2)|2011.2.03~|The Nerfer: 너프를 가져오는 자"
  elseif ( i == 2 ) then
    return "han1547|사람, 직자 99|2012.8.09~|카페를 활성화합시다"
  elseif ( i == 3) then
    return "devildevil|데빌, 전사 99|2011.2.14~|괴물 순수전사"
  elseif ( i == 4) then
    return "Cabin|케빈, 직자 99|5년간 직자만 키움"
  elseif ( i == 5) then
    return "lovemi17|럽미, 직자 99|2010.8.13~|2011.6.11(장가감)"
  elseif ( i == 6) then
    return "없음|없음|2022.2~|미래의 주인공, 당신!"
  else    
    return "ERROR(HAF)"
  endif
endfunction
function CreateTrackable3 takes integer no returns nothing
  call CreateDestructable('YTpc', GetPathX(no), GetPathY(no), bj_UNIT_FACING, 1., 0)
  if ( GetPathX(no) != 0. ) then
    set udg_temp_tr = CreateTrackable("Doodads\\Terrain\\InvisiblePlatform\\InvisiblePlatform.mdl", GetPathX(no), GetPathY(no), bj_UNIT_FACING)
    call EXEffectMatRotateZ(AddSpecialEffect("Doodads\\Dungeon\\Props\\AzsharaStatue\\AzsharaStatue.mdl", GetPathX(no), GetPathY(no)), GetPathA(no))
    
    call TriggerRegisterTrackableTrackEvent(gg_trg_SignBar_Drag2, udg_temp_tr)
    call TriggerRegisterTrackableHitEvent(gg_trg_SignBar_Hit, udg_temp_tr)
    call SaveInteger(udg_hash, GetHandleId(udg_temp_tr), StringHash("tr-n"), no)
  endif
endfunction
//call CreateTrackable2(GetEnumPlayer(), no)
function SignBar takes nothing returns nothing
 local integer no = 1
  loop
    call CreateTrackable2(GetEnumPlayer(), no)
    exitwhen no >= 10
    set no = no + 1
  endloop
endfunction
function Trig_P_set_Actions takes nothing returns nothing
  call ForForce(udg_temp_pg, function SignBar)
  call DestroyTrigger(GetTriggeringTrigger())
  call TriggerSleepAction(.2)
  call CreateTrackable3(1)
  call CreateTrackable3(2)
  call CreateTrackable3(3)
  call CreateTrackable3(4)
  call CreateTrackable3(5)
  call CreateTrackable3(6)
endfunction

//===========================================================================
function InitTrig_Set_SignBar takes nothing returns nothing
    set gg_trg_Set_SignBar = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Set_SignBar, function Trig_P_set_Actions )
endfunction

//===========================================================================
// Trigger: Set Skin
//===========================================================================
native DzSetUnitModel takes unit whichUnit, string path returns nothing
constant function FCM_U2D takes unit u returns string
  //번호 / 직업구분 / 모델명
  if ( u == gg_unit_e011_0229 ) then
    return "1|2|war3mapImported\\PVP_paladin_01.mdl"
  elseif ( u == gg_unit_e011_0231 ) then
    return "2|3|war3mapImported\\BloodElfMale2.mdl"
  elseif ( u == gg_unit_e011_0232 ) then
    return "3|4|war3mapImported\\BloodElfFemale12_complete2.mdl"
  elseif ( u == gg_unit_e011_0233 ) then
    return "4|5|war3mapImported\\HERO_HumanFemale_MAGE_01.mdl"
  elseif ( u == gg_unit_e011_0235 ) then
    return "5|6|war3mapImported\\Claw.mdl"
    
  elseif ( u == gg_unit_e011_0220 ) then
    return "6|2|war3mapImported\\Hero_BloodElfFemalePriestT8.mdx"
  elseif ( u == gg_unit_e011_0219 ) then
    return "7|3|war3mapImported\\Hero_BloodElfMale.MDX"
  elseif ( u == gg_unit_e011_0211 ) then
    return "8|4|war3mapImported\\Hero_HumanFemale_0.mdx"
  elseif ( u == gg_unit_e011_0210 ) then
    return "9|5|war3mapImported\\Hero_SunwellGuard.MDX"
  elseif ( u == gg_unit_e011_0209 ) then
    return "10|6|war3mapImported\\Hero_Warrior.mdx"
    
  elseif ( u == gg_unit_e011_0228 ) then
    return "11|2|war3mapImported\\Hero_King's Guardian.mdx"
  elseif ( u == gg_unit_e011_0224 ) then
    return "12|3|war3mapImported\\Hero_Dreamhuntress.mdx"
  elseif ( u == gg_unit_e011_0223 ) then
    return "13|4|war3mapImported\\Hero_FlamingRaven.mdx"
  elseif ( u == gg_unit_e011_0222 ) then
    return "14|5|war3mapImported\\Hero_BlackSunElementalist.mdx"
  elseif ( u == gg_unit_e011_0221 ) then
    return "15|6|war3mapImported\\Hero_Mirjana.mdx"

  elseif ( u == gg_unit_e011_0236 ) then
    return "16|2|war3mapImported\\Hero_Blackheart.mdx"
  else
  endif
  return ""
endfunction
constant function FCM_I2U takes integer i returns unit
  if ( i == 1 ) then
    return gg_unit_e011_0229
  elseif ( i == 2 ) then
    return gg_unit_e011_0231
  elseif ( i == 3 ) then
    return gg_unit_e011_0232
  elseif ( i == 4 ) then
    return gg_unit_e011_0233
  elseif ( i == 5 ) then
    return gg_unit_e011_0235
    
  elseif ( i == 6 ) then
    return gg_unit_e011_0209
  elseif ( i == 7 ) then
    return gg_unit_e011_0210
  elseif ( i == 8 ) then
    return gg_unit_e011_0211
  elseif ( i == 9 ) then
    return gg_unit_e011_0219
  elseif ( i == 10 ) then
    return gg_unit_e011_0220
    
  elseif ( i == 11 ) then
    return gg_unit_e011_0228
  elseif ( i == 12 ) then
    return gg_unit_e011_0224
  elseif ( i == 13 ) then
    return gg_unit_e011_0223
  elseif ( i == 14 ) then
    return gg_unit_e011_0222
  elseif ( i == 15 ) then
    return gg_unit_e011_0221
  
  elseif ( i == 16 ) then
    return gg_unit_e011_0236
  endif
  return null
endfunction
function FCM_ISTARGET takes nothing returns boolean
  return FCM_U2D(GetFilterUnit()) != ""
endfunction

function AddEvnet3 takes nothing returns nothing
  call TriggerRegisterPlayerUnitEvent(gg_trg_Select_Skin, GetEnumPlayer(), EVENT_PLAYER_UNIT_SELECTED, Condition(function FCM_ISTARGET))
endfunction

function Trig_Set_Skin_Actions takes nothing returns nothing
  set bj_forLoopAIndex = 1
  loop
    call SetUnitUserData((FCM_I2U(bj_forLoopAIndex)), bj_forLoopAIndex)
    call DzSetUnitModel(FCM_I2U(bj_forLoopAIndex), FCut(FCM_U2D(FCM_I2U(bj_forLoopAIndex)),3))
    exitwhen bj_forLoopAIndex >= 16
    set bj_forLoopAIndex = bj_forLoopAIndex + 1
  endloop
  
  call ForForce(udg_temp_pg, function AddEvnet3)
endfunction

//===========================================================================
function InitTrig_Set_Skin takes nothing returns nothing
  set gg_trg_Set_Skin = CreateTrigger(  )
  call TriggerAddAction( gg_trg_Set_Skin, function Trig_Set_Skin_Actions )
  call DisableTrigger(gg_trg_Set_Skin)
endfunction

//===========================================================================
// Trigger: Quest Set
//
// 1번이 완료 - 1 저장
// 2번이 완료 - 2 저장
// 3번이 완료 - 4 저장
// Mod(xx,2) 30회 반복
// 정수	"QLevel"	pN	0~3 // 퀘스트 진행도 표시. 공용 퀘스트는 pN을 0으로.
//===========================================================================
constant function QuestName takes integer Qno returns string
//퀘스트 이름, 단계, 최소레벨, 최대레벨
  if ( Qno == 0 ) then
    return "초보자퀘스트|35|1|99|인벤토리"
  elseif ( Qno == 1 ) then
    return "농부의부탁|2|1|5|노비스 마을"
  elseif ( Qno == 2 ) then
    return "쓰러진 마을 남자|2|6|14|밀레스 입구"
  elseif ( Qno == 3 ) then
    return "귀여운 아이|2|2|9|노비스 마을"
  elseif ( Qno == 4 ) then
    return "부자노인의 건강식품|5|7|40|밀레스 마을"
  elseif ( Qno == 5 ) then
    return "포테의 숲 지배자|7|11|40|수오미 마을"
  elseif ( Qno == 6 ) then
    return "그 마을의 골치거리|3|6|40|밀레스 마을"
  elseif ( Qno == 7 ) then
    return "해안가의 위협|14|41|80|뤼케시온 마을"
  elseif ( Qno == 8 ) then
    return "우드랜드의 말썽거리|3|41|98|여관"
  elseif ( Qno == 9 ) then
    return "아이 엄마의 고민|4|6|70|밀레스 마을"
  elseif ( Qno == 10 ) then
    return "NPC 푸잎의 부탁|1|1|10|밀레스 마을"
  elseif ( Qno == 11 ) then
    return "요정의 날개 치료|2|71|99|여관"
  elseif ( Qno == 12 ) then
    return "게으른 팔라딘|3|99|99|호러캐슬 대기실"
  elseif ( Qno == 13 ) then
    return "궁중 마법사의 연구|4|99|99|호러캐슬 대기실"
  elseif ( Qno == 14 ) then
    return "괴짜 미식 경비들|2|99|99|죽음의마을 대기실"
  elseif ( Qno == 15 ) then
    return "도전! 몬스터 웨이브|11|99|99|죽음의마을 대기실"
  elseif ( Qno == 16 ) then
    return "망령의 원한|2|99|99|죽음의마을 대기실"
  endif
 return ""
endfunction

function Quest_Level takes integer P, integer Qno returns integer
  if ( P < 0 ) then
  // P가 마이너스이면 그냥 설정(+1)
    if ( Qno < 0 ) then
    //Qno가 마이너스이면 퀘스트 완료, -1 설정
      call SaveInteger(udg_hash, StringHash("QLevel"+I2S(-Qno)), -P, -1)
    else
    //-P, Qno의 경우 정상 +1 (정상 Quest_Start)
      call SaveInteger(udg_hash, StringHash("QLevel"+I2S(Qno)), -P, LoadInteger(udg_hash, StringHash("QLevel"+I2S(Qno)), -P)+1)
    endif
  else
    return LoadInteger(udg_hash, StringHash("QLevel"+I2S(Qno)), P)
  endif
 return 0
endfunction
//if ( Quest_Level(P, 1) == 1 ) then
//call Quest_Level(-P, 1) // P의 1번퀘스트 진행도 +1

constant function Lv_Exp takes integer lv returns integer
  if ( lv == 0 ) then
    return 10
  elseif ( lv == 1 ) then
    return 25
  elseif ( lv == 2 ) then
    return 36
  elseif ( lv == 3 ) then
    return 50
  elseif ( lv == 4 ) then
    return 67
  elseif ( lv == 5 ) then
    return 87
  elseif ( lv == 6 ) then
    return 110
  elseif ( lv == 7 ) then
    return 136
  elseif ( lv == 8 ) then
    return 165
  elseif ( lv == 9 ) then
    return 197
  elseif ( lv == 10 ) then
    return 232
  elseif ( lv == 11 ) then
    return 270
  elseif ( lv == 12 ) then
    return 311
  elseif ( lv == 13 ) then
    return 355
  elseif ( lv == 14 ) then
    return 402
  elseif ( lv == 15 ) then
    return 452
  elseif ( lv == 16 ) then
    return 505
  elseif ( lv == 17 ) then
    return 561
  elseif ( lv == 18 ) then
    return 620
  elseif ( lv == 19 ) then
    return 682
  elseif ( lv == 20 ) then
    return 747
  elseif ( lv == 21 ) then
    return 815
  elseif ( lv == 22 ) then
    return 886
  elseif ( lv == 23 ) then
    return 960
  elseif ( lv == 24 ) then
    return 1037
  elseif ( lv == 25 ) then
    return 1117
  elseif ( lv == 26 ) then
    return 1200
  elseif ( lv == 27 ) then
    return 1286
  elseif ( lv == 28 ) then
    return 1375
  elseif ( lv == 29 ) then
    return 1467
  elseif ( lv == 30 ) then
    return 1562
  elseif ( lv == 31 ) then
    return 1660
  elseif ( lv == 32 ) then
    return 1761
  elseif ( lv == 33 ) then
    return 1865
  elseif ( lv == 34 ) then
    return 1972
  elseif ( lv == 35 ) then
    return 2082
  elseif ( lv == 36 ) then
    return 2195
  elseif ( lv == 37 ) then
    return 2311
  elseif ( lv == 38 ) then
    return 2430
  elseif ( lv == 39 ) then
    return 2552
  elseif ( lv == 40 ) then
    return 2677
  elseif ( lv == 41 ) then
    return 2805
  elseif ( lv == 42 ) then
    return 2936
  elseif ( lv == 43 ) then
    return 3070
  elseif ( lv == 44 ) then
    return 3207
  elseif ( lv == 45 ) then
    return 3347
  elseif ( lv == 46 ) then
    return 3490
  elseif ( lv == 47 ) then
    return 3636
  elseif ( lv == 48 ) then
    return 3785
  elseif ( lv == 49 ) then
    return 3937
  elseif ( lv == 50 ) then
    return 4092
  elseif ( lv == 51 ) then
    return 4250
  elseif ( lv == 52 ) then
    return 4411
  elseif ( lv == 53 ) then
    return 4575
  elseif ( lv == 54 ) then
    return 4742
  elseif ( lv == 55 ) then
    return 4912
  elseif ( lv == 56 ) then
    return 5085
  elseif ( lv == 57 ) then
    return 5261
  elseif ( lv == 58 ) then
    return 5440
  elseif ( lv == 59 ) then
    return 5622
  elseif ( lv == 60 ) then
    return 5807
  elseif ( lv == 61 ) then
    return 5995
  elseif ( lv == 62 ) then
    return 6186
  elseif ( lv == 63 ) then
    return 6380
  elseif ( lv == 64 ) then
    return 6577
  elseif ( lv == 65 ) then
    return 6777
  elseif ( lv == 66 ) then
    return 6980
  elseif ( lv == 67 ) then
    return 7186
  elseif ( lv == 68 ) then
    return 7395
  elseif ( lv == 69 ) then
    return 7607
  elseif ( lv == 70 ) then
    return 7822
  elseif ( lv == 71 ) then
    return 8040
  elseif ( lv == 72 ) then
    return 8261
  elseif ( lv == 73 ) then
    return 8485
  elseif ( lv == 74 ) then
    return 8712
  elseif ( lv == 75 ) then
    return 8942
  elseif ( lv == 76 ) then
    return 9175
  elseif ( lv == 77 ) then
    return 9411
  elseif ( lv == 78 ) then
    return 9650
  elseif ( lv == 79 ) then
    return 9892
  elseif ( lv == 80 ) then
    return 10137
  elseif ( lv == 81 ) then
    return 10385
  elseif ( lv == 82 ) then
    return 10636
  elseif ( lv == 83 ) then
    return 10890
  elseif ( lv == 84 ) then
    return 11147
  elseif ( lv == 85 ) then
    return 11407
  elseif ( lv == 86 ) then
    return 11670
  elseif ( lv == 87 ) then
    return 11936
  elseif ( lv == 88 ) then
    return 12205
  elseif ( lv == 89 ) then
    return 12477
  elseif ( lv == 90 ) then
    return 12752
  elseif ( lv == 91 ) then
    return 13030
  elseif ( lv == 92 ) then
    return 13311
  elseif ( lv == 93 ) then
    return 13595
  elseif ( lv == 94 ) then
    return 13882
  elseif ( lv == 95 ) then
    return 14172
  elseif ( lv == 96 ) then
    return 14465
  elseif ( lv == 97 ) then
    return 14761
  elseif ( lv == 98 ) then
    return 15060
  elseif ( lv == 99 ) then
    return 15362
  elseif ( lv == 100 ) then
    return 15667
  elseif ( lv == 101 ) then
    return 15975
  elseif ( lv == 102 ) then
    return 16286
  elseif ( lv == 103 ) then
  //호러 중상급
    return 16600
    
  //이하 광산
  elseif ( lv == 107 ) then
    return 17886
  elseif ( lv == 109 ) then
    return 18547
  elseif ( lv == 115 ) then
    return 20602
  elseif ( lv == 118 ) then
    return 21670
    
  //죽마
  elseif ( lv == 120 ) then
    return 22397
  elseif ( lv == 121 ) then
    return 22765
  elseif ( lv == 122 ) then
    return 23136
  elseif ( lv == 125 ) then
    return 24267
  elseif ( lv == 128 ) then
    return 25425
  elseif ( lv == 129 ) then
    return 25817
/*
15667

15975
16286
16600
16917
17237
17560
17886
18215
18547
18882

19220
19561
19905
20252
20602
20955
21311
21670
22032
22397

22765
23136
23510
23887
24267
24650
25036
25425
25817
26212

26610
27011
27415
27822
28232
28645
29061
29480
29902
30327

30755
31186
31620
32057
32497
32940
33386
33835
34287
34742
*/
  endif
 return 0
endfunction

constant function I2QU takes integer Qno returns unit
  if ( Qno == 1 ) then
    return gg_unit_nvil_0117
  elseif ( Qno == 2 ) then
    return gg_unit_n000_0018
  elseif ( Qno == 3 ) then
    return gg_unit_nvlk_0188
  elseif ( Qno == 4 ) then
    return gg_unit_u000_0190
  elseif ( Qno == 5 ) then
    return gg_unit_u001_0191
  elseif ( Qno == 6 ) then
    return gg_unit_n02S_0195
  elseif ( Qno == 7 ) then
    return gg_unit_n02T_0204
  elseif ( Qno == 8 ) then
    return gg_unit_Harf_0372
  elseif ( Qno == 9 ) then
    return gg_unit_nhef_0373
  elseif ( Qno == 10 ) then
    return gg_unit_e019_0374
  elseif ( Qno == 11 ) then
    return gg_unit_efdr_0197
  elseif ( Qno == 12 ) then
    return gg_unit_Hpal_0121
  elseif ( Qno == 13 ) then
    return gg_unit_Hkal_0069
  elseif ( Qno == 14 ) then
    return gg_unit_hmtm_0369
  elseif ( Qno == 15 ) then
    return gg_unit_Hmkg_0135
  elseif ( Qno == 16 ) then
    return gg_unit_Hgam_0174
  endif
 return null
endfunction
function I2Q takes integer i returns string
//10 -> "1010". 10진법 to 2진법, 30자리 맞추고
 local string s = ""
  loop
    exitwhen i <= 0
    set s = I2S(ModuloInteger(i,2)) + s
    set i = i / 2
  endloop
  
  set i = 30-StringLength(s)
  loop
    exitwhen i <= 0
    set s = "0" + s
    set i = i - 1
  endloop
  return s
endfunction
function Q2B takes string s, integer i returns boolean
//"1101",2 -> false, 나머진 1,3,4는 true
 return "1" == SubString(s,StringLength(s)-i,StringLength(s)-i+1)
endfunction
//Q2B(I2Q(FAL_GetMulti0(P, 0, 0, 3)), 2) // 2번째 퀘스트 진행되었는지 확인
//if ( Q2B(udg_Quest_Save[P],2) ) then동일
function B2Q takes integer P, integer Qno, boolean ox returns nothing
//플레이어의 n번째 퀘스트를 완료/미완료로 설정
 local integer i = FAL_GetMulti0(P, 0, 0, 3)
 local string s = ""
  if ( i == 0 ) then
    set s = udg_Quest_Save[P]
  else
    set s = I2Q(i)
  endif
  if ( ox != Q2B(s,Qno) ) then
    //저장된 값이 다를때만 설정. (같을땐 저장 안해도 되기때문)
    if ( ox ) then
      set i = i + R2I(Pow(2,Qno-1))
      //5번째 값을 바꾸면: 1~4번째 + "1" + 6~길이. 즉 중간부분만 1로 바꿈
      set udg_Quest_Save[P] = SubString(s,1,Qno-1) + "1" + SubString(s,Qno,StringLength(s))
    else
      set i = i - R2I(Pow(2,Qno-1))
      set udg_Quest_Save[P] = SubString(s,1,Qno-1) + "0" + SubString(s,Qno,StringLength(s))
    endif
    call FAL_SetMulti0(P, 0, 0, 3, i)
  endif
endfunction
//call B2Q(P, Qno, true)

constant function QuestEffect takes integer i returns string
 /* 퀘스트 이펙트 표시
 1번 - UI_Quest_Not	맵 시작할때 세팅	[stand, death(1프레임)]
 2번 - UI_Quest_Low	가까이 가면 변경 (퀘 받을 수 있을때)	[stand, birth]
 3번 - UI_Quest_Ori	퀘스트 진행중일 때. (받았을 때)	[stand, birth, death]

 4번 - UI_Quest_Ing	얘기중일 때(느낌표)	[stand, death - 플레이어에게 표시]
 5번 - UI_Quest_Compt	퀘스트 완료(파란 느낌표)	[stand] */
  if ( i == 1 ) then
    return "UI_Quest_NOT.mdx"
  elseif ( i == 2 ) then
    return "UI_Quest_Low.mdx"
  elseif ( i == 3 ) then
    return "UI_Quest_Ori.mdx"
  elseif ( i == 4 ) then
    return "UI_Quest_Ing.mdx"
  elseif ( i == 5 ) then
    return "UI_Quest_Compt.mdx"
  elseif ( i == 6 ) then
    return "UI_Quest_Compt2.mdx"
  endif
 return ""
endfunction
function SetEffiect takes unit u, integer i returns nothing
  call DestroyEffect(LoadEffectHandle(udg_hash, GetHandleId(u), StringHash("Quest")))
  if ( QuestEffect(i) != "" ) then
    call SaveEffectHandle(udg_hash, GetHandleId(u), StringHash("Quest"), AddSpecialEffectTarget(QuestEffect(i), u, "overhead"))
  endif
  call SaveInteger(udg_hash, GetHandleId(u), StringHash("Quest-id"), i)
endfunction
//플레이어 머리위에
//call SetEffiect(u, 4)
function SetEffiectLocal takes integer P, unit u, integer i returns nothing
 local integer id = LoadInteger(udg_hash, GetHandleId(u), StringHash("Quest-id"))
  call DestroyEffect(LoadEffectHandle(udg_hash, GetHandleId(u), StringHash("Quest")))
  if ( GetLocalPlayer() == Player(P-1) ) then
    set id = i
  endif
  if ( u == I2QU(2) ) then
    call SaveEffectHandle(udg_hash, GetHandleId(u), StringHash("Quest"), AddSpecialEffect(QuestEffect(id), GetWidgetX(u), GetWidgetY(u)+60.))
  else
    call SaveEffectHandle(udg_hash, GetHandleId(u), StringHash("Quest"), AddSpecialEffectTarget(QuestEffect(id), u, "overhead"))
  endif
  call SaveInteger(udg_hash, GetHandleId(u), StringHash("Quest-id"), id)
endfunction
//퀘스트 완료 후에~
//call SetEffiectLocal(P, LoadUnitHandle(udg_hash, StringHash("Quest-no"), 1~30)), 5)
//call B2Q(P, 1~30, true)

function Quest_Start takes integer P, integer Qno, boolean first returns nothing
//퀘스트 시작 : 케릭터 정지, NPC ? 색깔 변경, 유저 ! 표시, 변수 저장
  if ( first ) then
  //첫 단계에서만 NPC ? 색깔 조절
    call SetEffiectLocal(P, I2QU(Qno), 3)
  endif
  call PauseUnit(udg_Unit[P], true)
  call SetEffiect(udg_Unit[P], 4)
  call Quest_Level(-P, Qno)
endfunction
//call Quest_Start(P, 1, true) // 1번퀘스트 첫 시작
//반복퀘 가능한 것.
function Quest_End takes integer P, integer Qno, boolean lop returns nothing
//퀘스트 완료 : NPC ? -> 파랑 ! 변경, 완료 변수 저장
  if ( lop ) then
    call SetEffiectLocal(P, I2QU(Qno), 5)
    call Quest_Level(-P, Qno)
  else
    //검정 느낌표
    call SetEffiectLocal(P, I2QU(Qno), 6)
    //변수 -1 설정(완전 완료)
    call Quest_Level(-P, -Qno)
    call B2Q(P, Qno, true)
  endif
endfunction
function Quest_End2 takes integer P returns nothing
  //퀘 마무리 하고, 정지해제 + 캐릭터 ! 제거
  call PauseUnit(udg_Unit[P], false)
  call SetEffiect(udg_Unit[P], 0)
endfunction

function CondiALL takes nothing returns boolean
//debug call BJDebugMsg("Q.Unit: 0 Check")
 return ( GetPlayerController(GetOwningPlayer(GetTriggerUnit())) == MAP_CONTROL_USER ) and ( IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) )
endfunction
function QuestCondi01 takes nothing returns boolean
//debug call BJDebugMsg("Q.Unit: 1 Enter")
  //사용자 유닛이 들어오면
  if ( CondiALL() ) then
    //레벨, 퀘스트 진행도 확인 후 변경
//debug call BJDebugMsg("Q.Unit: " + GetUnitName(GetTriggerUnit()) + ", Lv: " + I2S(GetHeroLevel(GetTriggerUnit())) + ", QLv: "+ I2S(Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 1)))
    if ( GetHeroLevel(GetTriggerUnit()) < 5 ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 1) == 0 ) then
//debug call BJDebugMsg("TRUE")
      call SetEffiectLocal(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, I2QU(1), 2)
      set bj_lastCreatedTextTag = CreateTextTag()
      call SetTextTagText(bj_lastCreatedTextTag, "나에게 말을 걸어봐..", 0.023)
      call SetTextTagPos(bj_lastCreatedTextTag, GetWidgetX(I2QU(1)), GetWidgetY(I2QU(1)), 100.)
      call SetTextTagColor(bj_lastCreatedTextTag, 255, 255, 255, 255)
      call Bufftt(bj_lastCreatedTextTag, 0)
//debug else
//debug call BJDebugMsg("FALSE")
    endif
  endif
 return false
endfunction
function QuestCondi02 takes nothing returns boolean
  if ( CondiALL() ) then
  //6~15
    if ( 6 <= GetHeroLevel(GetTriggerUnit()) ) and ( GetHeroLevel(GetTriggerUnit()) < 15 ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 2) == 0 ) then
      call SetEffiectLocal(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, I2QU(2), 2)
    endif
  endif
 return false
endfunction
function QuestCondi03 takes nothing returns boolean
  if ( CondiALL() ) then
    if ( 2 <= GetHeroLevel(GetTriggerUnit()) ) and ( GetHeroLevel(GetTriggerUnit()) < 10 ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 3) == 0 ) then
      call SetEffiectLocal(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, I2QU(3), 2)
      
      set bj_lastCreatedTextTag = CreateTextTag()
      call SetTextTagText(bj_lastCreatedTextTag, "고민인걸..", 0.023)
      call SetTextTagPos(bj_lastCreatedTextTag, GetWidgetX(I2QU(3)), GetWidgetY(I2QU(3)), 100.)
      call SetTextTagColor(bj_lastCreatedTextTag, 255, 255, 255, 255)
      call Bufftt(bj_lastCreatedTextTag, 0)
    endif
  endif
 return false
endfunction
function QuestCondi04 takes nothing returns boolean
  if ( CondiALL() ) then
    if ( 7 <= GetHeroLevel(GetTriggerUnit()) ) and ( GetHeroLevel(GetTriggerUnit()) < 27 ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 4) == 0 ) then
      call SetEffiectLocal(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, I2QU(4), 2)
    endif
  endif
 return false
endfunction
function QuestCondi05 takes nothing returns boolean
  if ( CondiALL() ) then
    if ( 11 <= GetHeroLevel(GetTriggerUnit()) ) and ( GetHeroLevel(GetTriggerUnit()) <= 40 ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 5) == 0 ) then
      call SetEffiectLocal(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, I2QU(5), 2)
    endif
  endif
 return false
endfunction
function QuestCondi05_2 takes nothing returns boolean
  if ( CondiALL() ) then
    if ( 11 <= GetHeroLevel(GetTriggerUnit()) ) and ( GetHeroLevel(GetTriggerUnit()) <= 40 ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 5) == 1 ) then
      call SetEffiectLocal(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, gg_unit_u002_0192, 2)
    endif
  endif
 return false
endfunction
function QuestCondi05_3 takes nothing returns boolean
  if ( CondiALL() ) then
    if ( 11 <= GetHeroLevel(GetTriggerUnit()) ) and ( GetHeroLevel(GetTriggerUnit()) <= 40 ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 5) == 2 ) then
      call SetEffiectLocal(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, gg_unit_n02P_0193, 2)
    endif
  endif
 return false
endfunction
function QuestCondi06 takes nothing returns boolean
  if ( CondiALL() ) then
    if ( 6 <= GetHeroLevel(GetTriggerUnit()) ) and ( GetHeroLevel(GetTriggerUnit()) < 27 ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 6) == 0 ) then
      call SetEffiectLocal(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, I2QU(6), 2)
    endif
  endif
 return false
endfunction
function QuestCondi07 takes nothing returns boolean
  if ( CondiALL() ) then
    if ( 41 <= GetHeroLevel(GetTriggerUnit()) ) and ( GetHeroLevel(GetTriggerUnit()) <= 80 ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 7) == 0 ) then
      call SetEffiectLocal(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, I2QU(7), 2)
    endif
  endif
 return false
endfunction
function QuestCondi07_2 takes nothing returns boolean
  if ( CondiALL() ) then
    if ( 41 <= GetHeroLevel(GetTriggerUnit()) ) and ( GetHeroLevel(GetTriggerUnit()) <= 80 ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 7) == 4 ) then
      call SetEffiectLocal(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, gg_unit_hfoo_0202, 2)
    endif
  endif
 return false
endfunction
function QuestCondi07_3 takes nothing returns boolean
  if ( CondiALL() ) then
    if ( 41 <= GetHeroLevel(GetTriggerUnit()) ) and ( GetHeroLevel(GetTriggerUnit()) <= 80 ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 7) == 8 ) then
      call SetEffiectLocal(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, gg_unit_hhes_0203, 2)
    endif
  endif
 return false
endfunction
function QuestCondi08 takes nothing returns boolean
  if ( CondiALL() ) then
    if ( 41 <= GetHeroLevel(GetTriggerUnit()) ) and ( GetHeroLevel(GetTriggerUnit()) < 71 ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 8) == 0 ) then
      call SetEffiectLocal(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, I2QU(8), 2)
    endif
  endif
 return false
endfunction
function QuestCondi09 takes nothing returns boolean
  if ( CondiALL() ) then
    if ( 10 <= GetHeroLevel(GetTriggerUnit()) ) and ( GetHeroLevel(GetTriggerUnit()) < 71 ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 9) == 0 ) then
      call SetEffiectLocal(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, I2QU(9), 2)
    endif
  endif
 return false
endfunction
function QuestCondi10 takes nothing returns boolean
  if ( CondiALL() ) then
    if ( GetUnitTypeId(GetTriggerUnit()) != 'H000' ) and ( GetHeroLevel(GetTriggerUnit()) < 11 ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 10) == 0 ) then
      call SetEffiectLocal(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, I2QU(10), 2)
    endif
  endif
 return false
endfunction
function QuestCondi11 takes nothing returns boolean
  if ( CondiALL() ) then
    if ( GetHeroLevel(GetTriggerUnit()) >= 71 ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 11) == 0 ) then
      call SetEffiectLocal(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, I2QU(11), 2)
    endif
  endif
 return false
endfunction
function QuestCondi12 takes nothing returns boolean
  if ( CondiALL() ) then
    if ( GetHeroLevel(GetTriggerUnit()) >= 99 ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 12) == 0 ) then
      call SetEffiectLocal(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, I2QU(12), 2)
    endif
  endif
 return false
endfunction
function QuestCondi13 takes nothing returns boolean
  if ( CondiALL() ) then
    if ( GetHeroLevel(GetTriggerUnit()) >= 99 ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 13) == 0 ) then
      call SetEffiectLocal(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, I2QU(13), 2)
    endif
  endif
 return false
endfunction
function QuestCondi14 takes nothing returns boolean
  if ( CondiALL() ) then
    if ( GetHeroLevel(GetTriggerUnit()) >= 99 ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 14) == 0 ) then
      call SetEffiectLocal(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, I2QU(14), 2)
    endif
  endif
 return false
endfunction
function QuestCondi16 takes nothing returns boolean
  if ( CondiALL() ) then
    if ( GetHeroLevel(GetTriggerUnit()) >= 99 ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 16) == 0 ) then
      call SetEffiectLocal(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, I2QU(16), 2)
    endif
  endif
 return false
endfunction

function Trig_Quest_Set_Actions takes nothing returns nothing
 local integer array i
 local string array s
 local integer j = 12
  //Data_0파일,0,3에 저장되는 퀘스트
  //call SaveUnitHandle(udg_hash, StringHash("Quest-no"), 1, I2QU(1))
  //call SaveUnitHandle(udg_hash, StringHash("Quest-no"), 2, gg_unit_nvil_0117)
//debug call BJDebugMsg("Q-Set Start")
  loop
    exitwhen j <= 0
    set i[j] = FAL_GetMulti0(j, 0, 0, 3)
    set s[j] = I2Q(i[j])
    set j = j - 1
  endloop
  set s[0] = s[GetPlayerId(GetLocalPlayer())+1]

  set j = 1
//debug call BJDebugMsg("Q-Set - " + s[0])
  loop
    exitwhen j > QUEST_COUNT
    if ( Q2B(s[0],j) ) then
//debug call BJDebugMsg("Q-Set - OK - " + I2S(j) + "번째 퀘스트")
      call SaveEffectHandle(udg_hash, GetHandleId(I2QU(j)), StringHash("Quest"), AddSpecialEffectTarget(QuestEffect(6), I2QU(j), "overhead"))
      call SaveInteger(udg_hash, GetHandleId(I2QU(j)), StringHash("Quest-id"), 6)
    else
      call SaveEffectHandle(udg_hash, GetHandleId(I2QU(j)), StringHash("Quest"), AddSpecialEffectTarget(QuestEffect(1), I2QU(j), "overhead"))
      call SaveInteger(udg_hash, GetHandleId(I2QU(j)), StringHash("Quest-id"), 1)
    endif
    //자맨 퀘스트 추가 저장
    if ( j == 5 ) then
      if ( Q2B(s[0],j) ) then
        call SaveEffectHandle(udg_hash, GetHandleId(gg_unit_u002_0192), StringHash("Quest"), AddSpecialEffectTarget(QuestEffect(6), gg_unit_u002_0192, "overhead"))
        call SaveInteger(udg_hash, GetHandleId(gg_unit_u002_0192), StringHash("Quest-id"), 6)
        call SaveEffectHandle(udg_hash, GetHandleId(gg_unit_n02P_0193), StringHash("Quest"), AddSpecialEffectTarget(QuestEffect(6), gg_unit_n02P_0193, "overhead"))
        call SaveInteger(udg_hash, GetHandleId(gg_unit_n02P_0193), StringHash("Quest-id"), 6)
      else
        call SaveEffectHandle(udg_hash, GetHandleId(gg_unit_u002_0192), StringHash("Quest"), AddSpecialEffectTarget(QuestEffect(1), gg_unit_u002_0192, "overhead"))
        call SaveInteger(udg_hash, GetHandleId(gg_unit_u002_0192), StringHash("Quest-id"), 1)
        call SaveEffectHandle(udg_hash, GetHandleId(gg_unit_n02P_0193), StringHash("Quest"), AddSpecialEffectTarget(QuestEffect(1), gg_unit_n02P_0193, "overhead"))
        call SaveInteger(udg_hash, GetHandleId(gg_unit_n02P_0193), StringHash("Quest-id"), 1)
      endif
    elseif ( j == 7 ) then
      if ( Q2B(s[0],j) ) then
        call SaveEffectHandle(udg_hash, GetHandleId(gg_unit_hfoo_0202), StringHash("Quest"), AddSpecialEffectTarget(QuestEffect(6), gg_unit_hfoo_0202, "overhead"))
        call SaveInteger(udg_hash, GetHandleId(gg_unit_hfoo_0202), StringHash("Quest-id"), 6)
        call SaveEffectHandle(udg_hash, GetHandleId(gg_unit_hhes_0203), StringHash("Quest"), AddSpecialEffectTarget(QuestEffect(6), gg_unit_hhes_0203, "overhead"))
        call SaveInteger(udg_hash, GetHandleId(gg_unit_hhes_0203), StringHash("Quest-id"), 6)
      else
        call SaveEffectHandle(udg_hash, GetHandleId(gg_unit_hfoo_0202), StringHash("Quest"), AddSpecialEffectTarget(QuestEffect(1), gg_unit_hfoo_0202, "overhead"))
        call SaveInteger(udg_hash, GetHandleId(gg_unit_hfoo_0202), StringHash("Quest-id"), 1)
        call SaveEffectHandle(udg_hash, GetHandleId(gg_unit_hhes_0203), StringHash("Quest"), AddSpecialEffectTarget(QuestEffect(1), gg_unit_hhes_0203, "overhead"))
        call SaveInteger(udg_hash, GetHandleId(gg_unit_hhes_0203), StringHash("Quest-id"), 1)
      endif
    endif
    set j = j + 1
  endloop

  call DestroyTrigger(gg_trg_Quest_Set)
  set gg_trg_Quest_Set = CreateTrigger()
  call TriggerRegisterUnitInRange(gg_trg_Quest_Set, I2QU(1), 400., Condition(function QuestCondi01))
  call TriggerRegisterUnitInRange(gg_trg_Quest_Set, I2QU(2), 400., Condition(function QuestCondi02))
  call TriggerRegisterUnitInRange(gg_trg_Quest_Set, I2QU(3), 400., Condition(function QuestCondi03))
  call UnitRemoveAbility(I2QU(3), 'Awan')
  call TriggerRegisterUnitInRange(gg_trg_Quest_Set, I2QU(4), 400., Condition(function QuestCondi04))
  call TriggerRegisterUnitInRange(gg_trg_Quest_Set, I2QU(5), 400., Condition(function QuestCondi05))
  call TriggerRegisterUnitInRange(gg_trg_Quest_Set, gg_unit_u002_0192, 400., Condition(function QuestCondi05_2))
  call TriggerRegisterUnitInRange(gg_trg_Quest_Set, gg_unit_n02P_0193, 400., Condition(function QuestCondi05_3))
  call TriggerRegisterUnitInRange(gg_trg_Quest_Set, I2QU(6), 400., Condition(function QuestCondi06))
  call TriggerRegisterUnitInRange(gg_trg_Quest_Set, I2QU(7), 400., Condition(function QuestCondi07))
  call TriggerRegisterUnitInRange(gg_trg_Quest_Set, gg_unit_hfoo_0202, 400., Condition(function QuestCondi07_2))
  call TriggerRegisterUnitInRange(gg_trg_Quest_Set, gg_unit_hhes_0203, 400., Condition(function QuestCondi07_3))
  call TriggerRegisterUnitInRange(gg_trg_Quest_Set, I2QU(8), 400., Condition(function QuestCondi08))
  call TriggerRegisterUnitInRange(gg_trg_Quest_Set, I2QU(9), 400., Condition(function QuestCondi09))
  call TriggerRegisterUnitInRange(gg_trg_Quest_Set, I2QU(10), 400., Condition(function QuestCondi10))
  call TriggerRegisterUnitInRange(gg_trg_Quest_Set, I2QU(11), 400., Condition(function QuestCondi11))
  call TriggerRegisterUnitInRange(gg_trg_Quest_Set, I2QU(12), 400., Condition(function QuestCondi12))
  call TriggerRegisterUnitInRange(gg_trg_Quest_Set, I2QU(13), 400., Condition(function QuestCondi13))
  call TriggerSleepAction(1.)
  call TriggerExecute(gg_trg_UTextSet)
endfunction

//===========================================================================
function InitTrig_Quest_Set takes nothing returns nothing
  set gg_trg_Quest_Set = CreateTrigger()
  call TriggerAddAction( gg_trg_Quest_Set, function Trig_Quest_Set_Actions )
endfunction

function Quest00 takes integer P, integer no returns boolean
 return ( udg_Quest_Boolean_B[P] == false ) and ( LoadBoolean(udg_hash, getIndex(P, no, 100), 31) )
endfunction
function QuestAll takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local integer P = LoadInteger(udg_hash, GetHandleId(t), StringHash("Q-choice"))
 local integer no = LoadInteger(udg_hash, GetHandleId(t), StringHash("Q-choiceNo"))
  if ( Quest00(P, no) ) then
    call SaveBoolean(udg_hash, getIndex(P, no, 100), 31, false)
    if ( no == 12 ) then
      set no = udg_SysB_Level[P]
      if ( no < 26 ) then
        set no = 500
      elseif ( no < 41 ) then
        set no = 2000
      elseif ( no < 71 ) then
        set no = 8000
      elseif ( no < 99 ) then
        set no = 15000
      else
        set no = 25000
      endif
      call MSG(Player(P-1), 1, 2.5, I2S(no) + "골드가 반환되었습니다.")
      call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) - no)
    elseif ( no == 14 ) then
      call MSG(Player(P-1), 1, 4., "파티 성향이 기본성향으로 설정되었습니다.")
      set udg_SysK_Exp[P] = udg_SysA_COUNT*SysInt(0,30)
      set udg_SysK_Drop[P] = udg_SysA_COUNT*SysInt(0,31)
      set udg_SysK_Gold[P] = udg_SysA_COUNT*SysInt(0,32)
      set udg_PartyTitle[P] = udg_PartyTitle[P] + "|cffffdc3c[기본성향]|r"
      if ( udg_PartyNumber_pP[P] >= 2 ) then
        set bj_forLoopAIndex = 1
        loop
          if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) then
            call MSG(Player(bj_forLoopAIndex-1), 1, 4, "파티의 성향이 설정되었습니다: " + udg_PartyTitle[P])
            set udg_SysK_Exp[bj_forLoopAIndex] = udg_SysK_Exp[P]
            set udg_SysK_Drop[bj_forLoopAIndex] = udg_SysK_Drop[P]
            set udg_SysK_Gold[bj_forLoopAIndex] = udg_SysK_Gold[P]
          endif
          exitwhen bj_forLoopAIndex >= bj_MAX_PLAYERS
          set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
      endif
    elseif ( no == 25 ) then
      call MSG(Player(P-1), 6, 4., "아이 엄마|r : |c00ffff00할말이 없으면.. 가세요!")
      call SaveInteger(udg_hash, StringHash("QLevel8"), P, -2)
      call PauseUnit(udg_Unit[P], false)
    elseif ( no == 26 ) then
      call MSG(Player(P-1), 6, 4., "아이 엄마|r : |c00ffff00대답하지 못하는군요..")
      call SaveInteger(udg_hash, StringHash("QLevel8"), P, -2)
      call PauseUnit(udg_Unit[P], false)
      call MSG(Player(P-1), 1, 4., "당분간 해당 퀘스트를 하실 수 없습니다 (2분)")
      call TriggerSleepAction(120.)
      call SaveInteger(udg_hash, StringHash("QLevel8"), P, 0)
    elseif ( no == 35 ) then
      call MSG(Player(P-1), 6, 4., "NPC 푸잎|r : |c00ffff00그래.... 싫다면 어쩔 수 없고....")
      call SaveInteger(udg_hash, StringHash("QLevel10"), P, 0)
    endif
  else
    set udg_Quest_Boolean_B[P] = false
  endif
  call DestroyTimer(t)
  set t = null
endfunction
function Choice takes integer P, integer no, real dur returns nothing
 local timer t = null
  if ( no < 0 ) then
  //-14 면 14번 중지
    call SaveBoolean(udg_hash, getIndex(P,-no,100), 31, false)
    set t = LoadTimerHandle(udg_hash, StringHash("Q-choiceT"), P)
    call FlushChildHashtable(udg_hash, GetHandleId(t))
    call DestroyTimer(t)
  else
    call SaveBoolean(udg_hash, getIndex(P, no, 100), 31, true)
    set udg_Quest_00_NumberAt[P] = no
    call SaveTimerHandle(udg_hash, StringHash("Q-choiceT"), P, t)
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("Q-choice"), P)
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("Q-choiceNo"), no)
    call TimerStart(t, dur, false, function QuestAll)
  endif
  set t = null
endfunction
//call Choice(P, -25, 0)
//call QMsg(P, 25, "3", "1.~~\n2. ~~", 10.)
function QMsg takes integer P, real r, string s1, string s2, real wait returns nothing
  if ( s1 == "1" ) then
    if ( P < 0 ) then
      call MSGAll(-P, false, 1, 7, r, s2)
    else
      call MSG(Player(P-1), 7, r, s2)
    endif
    call TriggerSleepAction(wait)
  elseif ( s1 == "2" ) then
    if ( P < 0 ) then
      call MSGAll(-P, false, 1, 14, r, s2)
    else
      call MSG(Player(P-1), 14, r, s2)
    endif
    call TriggerSleepAction(wait)
  elseif ( s1 == "3" ) then
  //퀘 선택
    if ( P < 0 ) then
      call MSGAll(-P, false, 1, 15, r, s2)
      call Choice(-P, R2I(r), wait)
    else
      call MSG(Player(P-1), 15, r, s2)
      call Choice(P, R2I(r), wait)
    endif
  elseif ( udg_Quest_WaitTime[P] > .1 ) then
    if ( s1 == "플레이어" ) then
      set s1 = GetPlayerName(Player(P-1))
    endif
    if ( r == 0. ) then
      set r = 4.
    endif
    if ( P < 0 ) then
      if ( s1 == "0" ) then
        call MSGAll(-P, false, 1, 1, r, s2)
  	  else
        call MSGAll(-P, false, 1, 6, r, s1+"|r : "+BaseStr(15)+s2)
	  endif
      if ( udg_Quest_WaitTime[-P]*wait > .1 ) then
        call TriggerSleepAction(udg_Quest_WaitTime[-P]*wait)
      endif
    else
	  if ( s1 == "0" ) then
	    call MSG(Player(P-1), 1, r, s2)
  	  else
  	    call MSG(Player(P-1), 6, r, s1+"|r : "+BaseStr(15)+s2)
	  endif
      if ( udg_Quest_WaitTime[P]*wait > .1 ) then
        call TriggerSleepAction(udg_Quest_WaitTime[P]*wait)
      endif
    endif
  endif
endfunction
//call QMsg(P, 0, "이름", "할말", 1.0) // "1"/"2" - 퀘스트 발동/완료(스킵시 무시 안됨) // "0" - 코딩 없이 그냥 말. // -P : 전체에게(동맹만)

function MakeTestt takes integer P, boolean gold, integer v returns nothing
  if ( gold ) then
    if ( udg_SysA_COUNT > 0 ) then
      set v = R2I(v * (100+udg_SysA_COUNT*SysInt(0,32))/100.)
    endif
    call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) + v)
    set bj_lastCreatedTextTag = CreateTextTag()
    if ( v > 10000 ) then
      call SetTextTagText(bj_lastCreatedTextTag, " Gold +" + I2S(v/1000) + "K", TextTagSize2Height(10))
    else
      call SetTextTagText(bj_lastCreatedTextTag, " Gold +" + I2S(v), TextTagSize2Height(9))
    endif
    call SetTextTagPosUnit(bj_lastCreatedTextTag, udg_Unit[P], -30.)
    call SetTextTagColor(bj_lastCreatedTextTag, 255, 255, 0, 255)
    call Bufftt(bj_lastCreatedTextTag, 7)
  else
    if ( udg_SysA_COUNT > 0 ) then
      set v = R2I(v * (100+udg_SysA_COUNT*SysInt(0,30))/100.)
    endif
    
    if ( v > 10000000 ) then
      set bj_lastCreatedTextTag = CreateTextTag()
      call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) + v/10000000)
      set udg_SysL_Wood[bj_forLoopAIndex] = GetPlayerState(Player(bj_forLoopAIndex-1), PLAYER_STATE_RESOURCE_LUMBER)
      call SetTextTagText(bj_lastCreatedTextTag, " Point +" + I2S(v/10000000) + "P", TextTagSize2Height(12))
      call SetTextTagPosUnit(bj_lastCreatedTextTag, udg_Unit[P], -150.)
      call SetTextTagColor(bj_lastCreatedTextTag, 85, 255, 0, 255)
      call Bufftt(bj_lastCreatedTextTag, 7)
      set v = ModuloInteger(v,10000000)
    endif
    
    if ( v > 0 ) then
      set bj_lastCreatedTextTag = CreateTextTag()
      if ( v >= 1000000 ) then
        call SetTextTagText(bj_lastCreatedTextTag, " EXP +" + I2S(v/1000000) + "M", TextTagSize2Height(11))
      elseif ( v > 10000 ) then
        call SetTextTagText(bj_lastCreatedTextTag, " EXP +" + I2S(v/1000) + "K", TextTagSize2Height(10))
      else
        call SetTextTagText(bj_lastCreatedTextTag, " EXP +" + I2S(v), TextTagSize2Height(9))
      endif
      set udg_SysL_Exp[P] = GetHeroXP(udg_Unit[P])+v
      call AddHeroXP(udg_Unit[P], v, true)
      set udg_SysL_Level[P] = GetHeroLevel(udg_Unit[P])
      call SetTextTagPosUnit(bj_lastCreatedTextTag, udg_Unit[P], -90.)
      call SetTextTagColor(bj_lastCreatedTextTag, 85, 255, 0, 255)
      call Bufftt(bj_lastCreatedTextTag, 7)
    endif
  endif
endfunction
//call MakeTestt(GetAttacker(), true, 500)//===========================================================================
// Trigger: Config Set
//===========================================================================
native DzCreateFrameByTagName takes string frameType, string name, integer parent, string template, integer id returns integer
native DzFrameFindByName takes string name, integer id returns integer
native DzFrameSetAbsolutePoint takes integer frame, integer point, real x, real y returns nothing
native DzFrameSetText takes integer frame, string text returns nothing
native DzFrameSetSize takes integer frame, real w, real h returns nothing
native DzFrameSetScriptByCode takes integer frame, integer eventId, code funcHandle, boolean sync returns nothing

native DzFrameSetPoint takes integer frame, integer point, integer relativeFrame, integer relativePoint, real x, real y returns nothing
native DzLoadToc takes string fileName returns nothing
native JNGetConnectionState takes nothing returns integer
native DzFrameGetAlpha takes integer frame returns integer
native DzFrameSetUpdateCallback takes string func returns nothing
scope Lobby
  globals
    private constant real UICenterX = 0.65
    private constant real UICenterY = 0.25
    
    private integer Button     //버튼
    constant integer JN_FRAMEPOINT_LEFT = 3
    constant integer JN_FRAMEPOINT_CENTER = 4
    constant integer JN_FRAMEPOINT_RIGHT = 5
    
    private constant integer JN_FRAMEEVENT_CHECKBOX_CHECKED = 7
    private constant integer JN_FRAMEEVENT_CHECKBOX_UNCHECKED = 8
    
    
    private integer AniScreenCount = 0    //프레임 카운트
    private integer AniScreenMaxCount = 65  //프레임 종료 카운트
    
    private integer LobbyCheckBox = 0     //체크 박스 프레임
    private integer LobbyCheckBoxText = 0   //체크 박스 설명 텍스트 프레임
    
    boolean simplecheck = false        //난이도 논리값
  endglobals
  
  private function OpenURL1 takes nothing returns nothing
    call JNOpenBrowser("https://open.kakao.com/o/gM1u4zn")
  endfunction
  
  private function OpenURL2 takes nothing returns nothing
    call JNOpenBrowser("https://cafe.naver.com/w3lod")
  endfunction
  
  private function OpenURL3 takes nothing returns nothing
    call JNOpenBrowser("https://m16tool.xyz/Game/fooiff/Download/Index")
  endfunction
  
  private function OpenURL4 takes nothing returns nothing
    call JNOpenBrowser("https://cafe.naver.com/w3lod/35413")
  endfunction
  
  //체크박스 체크시 작동
  private function LobbyMenuChecked takes nothing returns nothing
    set simplecheck = true
  endfunction
  //체크박스 체크 해제시 작동
  private function LobbyMenuUnchecked takes nothing returns nothing
    set simplecheck = false
  endfunction
  //대기실 UI 생성
  private function CreateLobbyOption takes nothing returns nothing
    //체크박스 템플릿을 사용하려면 실행시켜야 합니다
    call DzLoadToc("MainToc.toc")
    
    //체크박스 생성
    set LobbyCheckBox = DzCreateFrameByTagName("GLUECHECKBOX", "", DzFrameFindByName("MapInfoPane", 0), "StandardCheckBoxTemplate", 0)
    call DzFrameSetPoint(LobbyCheckBox, JN_FRAMEPOINT_RIGHT, DzFrameFindByName("MapTilesetValue", 0), JN_FRAMEPOINT_RIGHT, 0, -0.09)
    call DzFrameSetScriptByCode(LobbyCheckBox, JN_FRAMEEVENT_CHECKBOX_CHECKED, function LobbyMenuChecked, false)
    call DzFrameSetScriptByCode(LobbyCheckBox, JN_FRAMEEVENT_CHECKBOX_UNCHECKED, function LobbyMenuUnchecked, false)
    
    //체크박스 설명 텍스트 생성
    set LobbyCheckBoxText = DzCreateFrameByTagName("TEXT", "", LobbyCheckBox, "StandardLabelTextTemplate", 0)
    call DzFrameSetPoint(LobbyCheckBoxText, JN_FRAMEPOINT_LEFT, DzFrameFindByName("MapTilesetLabel", 0), JN_FRAMEPOINT_LEFT, 0, -0.09)
    call DzFrameSetText(LobbyCheckBoxText, "최적화 모드(방장전용, 샌박시 권장):")
  endfunction
  
  private function AnimationScreen takes nothing returns nothing
    if AniScreenCount >= AniScreenMaxCount then
      call CreateLobbyOption()
      call DzFrameSetUpdateCallback(null)
      //프레임이 AniScreenMaxCount에 도달하면 UI 생성 후, 프레임마다 함수 동작을 중지.(페이탈 방지)
    endif
    set AniScreenCount = AniScreenCount + 1
  endfunction
  //! inject config
    
    //재생 or 일시정지 버튼
    set Button = DzCreateFrameByTagName("GLUETEXTBUTTON", "", DzFrameFindByName("MapInfoPane", 0), "DebugButton", 0)
    call DzFrameSetAbsolutePoint(Button, JN_FRAMEPOINT_CENTER, UICenterX-0.09, UICenterY+0.03)
    call DzFrameSetText(Button, "|cffffff00채팅")
    call DzFrameSetSize(Button, 0.06, 0.03)
    call DzFrameSetScriptByCode(Button, 1, function OpenURL1, false)
    
    //정지 버튼
    set Button = DzCreateFrameByTagName("GLUETEXTBUTTON", "", DzFrameFindByName("MapInfoPane", 0), "DebugButton", 0)
    call DzFrameSetAbsolutePoint(Button, JN_FRAMEPOINT_CENTER, UICenterX-0.03, UICenterY+0.03)
    call DzFrameSetText(Button, "|cffffff00카페")
    call DzFrameSetSize(Button, 0.06, 0.03)
    call DzFrameSetScriptByCode(Button, 1, function OpenURL2, false)
    
    //정지 버튼
    set Button = DzCreateFrameByTagName("GLUETEXTBUTTON", "", DzFrameFindByName("MapInfoPane", 0), "DebugButton", 0)
    call DzFrameSetAbsolutePoint(Button, JN_FRAMEPOINT_CENTER, UICenterX+0.03, UICenterY+0.03)
    call DzFrameSetText(Button, "|cffffff00다운")
    call DzFrameSetSize(Button, 0.06, 0.03)
    call DzFrameSetScriptByCode(Button, 1, function OpenURL3, false)
    
    //정지 버튼
    set Button = DzCreateFrameByTagName("GLUETEXTBUTTON", "", DzFrameFindByName("MapInfoPane", 0), "DebugButton", 0)
    call DzFrameSetAbsolutePoint(Button, JN_FRAMEPOINT_CENTER, UICenterX+0.09, UICenterY+0.03)
    call DzFrameSetText(Button, "|cffffff00공략")
    call DzFrameSetSize(Button, 0.06, 0.03)
    call DzFrameSetScriptByCode(Button, 1, function OpenURL4, false)
    
    
    if ( JNGetConnectionState() == 1413697614 ) then
    //호스트만 작동(LAN에서 플레이 중 == true or 게임 시작 버튼의 알파값 == 255)
    //LAN에선 AniScreenMaxCount이 65면 UI가 느리게 생성되기 때문에 30으로 축소
      set AniScreenMaxCount = 30
      call DzFrameSetUpdateCallbackByCode(function AnimationScreen)
    elseif ( DzFrameGetAlpha(DzFrameFindByName("CreateGameButton", 0)) == 255 ) then
      call DzFrameSetUpdateCallbackByCode(function AnimationScreen)
    endif
    //끝
    
    call SetMapName("|c01c432d8어둠의전설 RPG|rNew1.30F")
    call SetMapDescription("cafe.naver.com/w3Lod
카페에서 원하는 최신 정보를 얻으세요!

제작 : fooiff
업데이트: 2023.10.28
Cafe: |cffFF0033http://cafe.naver.com/w3Lod|r
|c00d1d1d1공식채널 |cffffdc3c Clan FLoD|r")
    call SetPlayers(12)
    call SetTeams(12)
    call SetGamePlacement(MAP_PLACEMENT_TEAMS_TOGETHER)

    call DefineStartLocation(0, 28864., -22464.)
    call DefineStartLocation(1, 28864., -22464.)
    call DefineStartLocation(2, 28864., -22464.)
    call DefineStartLocation(3, 28864., -22464.)
    call DefineStartLocation(4, 28864., -22464.)
    call DefineStartLocation(5, 28864., -22464.)
    call DefineStartLocation(6, 28864., -22464.)
    call DefineStartLocation(7, 28864., -22464.)
    call DefineStartLocation(8, 28864., -22464.)
    call DefineStartLocation(9, 28864., -22464.)
    call DefineStartLocation(10, 28864., -22464.)
    call DefineStartLocation(11, 28864., -22464.)

    call InitCustomPlayerSlots()
    call InitCustomTeams()
    call InitAllyPriorities()
    
    call PlayMusic("war3mapImported\\24.mp3")
//! endinject
endscope//===========================================================================
// Trigger: ModifiedEvents
//===========================================================================
native DzEnableWideScreen takes boolean enable returns nothing
library ModifiedEvents // fix 7th
  globals
    private hashtable HASH = InitHashtable()
    constant playerunitevent EVENT_PLAYER_UNIT_DAMAGED = ConvertPlayerUnitEvent(52)
    private constant integer ABILITIES_UNIT_INDEXER = 'AIDX'
  endglobals
  
  private function SetHandleData takes handle t, integer i returns nothing
    call SaveInteger(HASH, 0, GetHandleId(t), i)
  endfunction
  private function GetHandleData takes handle t returns integer
    return LoadInteger(HASH, 0, GetHandleId(t))
  endfunction
  private function FlushHandleData takes handle t returns nothing
    call RemoveSavedInteger(HASH, 0, GetHandleId(t))
  endfunction
  private struct ofTrig
    trigger trig
    thistype next
    thistype prev
    static thistype Head = 0
    static thistype now = Head
    
    static method create takes trigger t returns thistype
      local thistype this = allocate()
      set trig = t
      set now. next = this
      set this.prev = now
      set now = this
      call SetHandleData(t, this)
      return this
    endmethod
    
    method destroy takes nothing returns nothing
      call FlushHandleData(trig)
      set prev.next = next
      set next.prev = prev
      if now == this then
        set now = prev
      endif
      set next = 0
      set prev = 0
      set trig = null
    endmethod
    
    method Execute takes nothing returns nothing
      if IsTriggerEnabled(trig) then
        call ConditionalTriggerExecute(trig)
      endif
    endmethod
    
    static method ExecuteAll takes nothing returns nothing
      local thistype this = Head
      loop
        set this = this.next
        exitwhen this == Head
        
        call Execute()
      endloop
    endmethod
  endstruct
  
  hook DestroyTrigger ModifiedEvents_WhenTriggerDestroyed
  public function WhenTriggerDestroyed takes trigger t returns nothing
    local ofTrig this = GetHandleData(t)
    if this != 0 then
      call this.destroy()
    endif
  endfunction
  
  function TriggerRegisterAnyUnitEventBJBJ takes trigger trig, playerunitevent whichEvent returns nothing
    if whichEvent != EVENT_PLAYER_UNIT_DAMAGED then
      call TriggerRegisterAnyUnitEventBJBJBJ.evaluate(trig, whichEvent)
    else
      call ofTrig.create.evaluate(trig)
    endif
  endfunction
  function TriggerRegisterAnyUnitEventBJBJBJ takes trigger trig, playerunitevent whichEvent returns nothing
    local integer index
    
    set index = 0
    loop
      call TriggerRegisterPlayerUnitEvent(trig, Player(index), whichEvent, null)
  
      set index = index + 1
      exitwhen index == bj_MAX_PLAYER_SLOTS
    endloop
  endfunction
  
  
  
  //================================
  //       Indexer
  //================================
  private struct Allocator extends array
    thistype p_next
    static thistype p_this = 1
    static method onInit takes nothing returns nothing
      local thistype this = p_this
      loop
        set p_next = this + 1
        set this = this + 1
        exitwhen this >= 8192
      endloop
    endmethod
    
    static method operator new takes nothing returns integer
      local thistype this = p_this
      set p_this = p_next
      return this
    endmethod
    static method Return takes thistype this returns nothing
      set p_next = p_this
      set p_this = this
    endmethod
  endstruct
  
	private module InitTimer
		static if thistype.init.exists then
			private static method initex takes nothing returns nothing
				call DestroyTimer(GetExpiredTimer())
				call init()
			endmethod
			private static method onInit takes nothing returns nothing
				call TimerStart(CreateTimer(), 0, false, function thistype.initex)
			endmethod
		endif
	endmodule
  
  private struct UnitAttach extends array
    trigger tDamaged
    static trigger onUnitIndexer = CreateTrigger()
    static trigger onUnitDeindexer = CreateTrigger()
    
    static method UnitDamaged takes nothing returns boolean
      call ofTrig.ExecuteAll()
      return true
    endmethod
    
    static method onUnitIndex takes nothing returns boolean
      local thistype this
      local unit u = GetFilterUnit()
      if GetUnitAbilityLevel(u, 'Aloc') > 0 then
        set u = null
        return false
      elseif GetHandleData(u) != 0 then
        set u = null
        return false
      endif
      call UnitAddAbility(u, ABILITIES_UNIT_INDEXER)
      call UnitMakeAbilityPermanent(u, true, ABILITIES_UNIT_INDEXER)
      set this = Allocator.new
      call SetHandleData(u, this)
      
      set tDamaged = CreateTrigger()
      call TriggerRegisterUnitEvent(tDamaged, u, EVENT_UNIT_DAMAGED)
      call TriggerAddCondition(tDamaged, Condition(function thistype.UnitDamaged))
      
      set u = null
      return true
    endmethod
    
    static method onUnitDeindex takes nothing returns boolean
      local thistype this
      local unit u = GetFilterUnit()
      if GetUnitAbilityLevel(u, ABILITIES_UNIT_INDEXER) == 0 then
        if GetHandleData(u) != 0 then
          set this = GetHandleData(u)
          call DestroyTrigger(tDamaged)
          call FlushHandleData(u)
          call Allocator.Return(this)
        endif
      endif
      set u = null
      return true
    endmethod
    
    static method init takes nothing returns nothing
      local group g = CreateGroup()
      local rect r = GetWorldBounds()
      local region rectRegion = CreateRegion()
      local integer i = 0
      call GroupEnumUnitsInRect(g, r, Condition(function thistype.onUnitIndex))
      call RegionAddRect(rectRegion, r)
      call TriggerRegisterEnterRegion(onUnitIndexer, rectRegion, Condition(function thistype.onUnitIndex))
      loop
        call TriggerRegisterPlayerUnitEvent(onUnitDeindexer, Player(i), EVENT_PLAYER_UNIT_ISSUED_ORDER, Condition(function thistype.onUnitDeindex))
        call SetPlayerAbilityAvailable(Player(i), ABILITIES_UNIT_INDEXER, false)
        set i = i+1
        exitwhen i>=16
      endloop
      
      call DestroyGroup(g)
      call RemoveRect(r)
      set r = null
      set g = null
    endmethod
    implement InitTimer
  endstruct
  
  //====================================
  // Other Player Events
  //====================================
  function TriggerRegisterAnyPlayerSelectionEventBJBJ takes trigger trig, boolean selected returns nothing
    local integer i = 0
    loop
      call TriggerRegisterPlayerSelectionEventBJ(trig, Player(i), selected)
      set i = i+1
      exitwhen i>=12
    endloop
  endfunction
  function TriggerRegisterAnyPlayerSelectionEventBJ takes trigger trig, boolean selected returns nothing
    call TriggerRegisterAnyPlayerSelectionEventBJBJ.evaluate(trig, selected)
  endfunction
  //===========================================================================
  function TriggerRegisterPlayerAllianceChangeBJBJ takes trigger trig, alliancetype whichAlliance returns nothing
    local integer i = 0
    loop
      call TriggerRegisterPlayerAllianceChange(trig, Player(i), whichAlliance)
      set i = i+1
      exitwhen i>=12
    endloop
  endfunction
  function TriggerRegisterPlayerAllianceChangeBJ takes trigger trig, alliancetype whichAlliance returns nothing
    call TriggerRegisterPlayerAllianceChangeBJBJ.evaluate(trig, whichAlliance)
  endfunction
  //===========================================================================
  function TriggerRegisterPlayerStateEventBJBJ takes trigger trig, playerstate whichState, limitop opcode, real limitval returns nothing
    local integer i = 0
    loop
      call TriggerRegisterPlayerStateEvent(trig, Player(i), whichState, opcode, limitval)
      set i = i+1
      exitwhen i>=12
    endloop
  endfunction
  function TriggerRegisterPlayerStateEventBJ takes trigger trig, playerstate whichState, limitop opcode, real limitval returns nothing
    call TriggerRegisterPlayerStateEventBJBJ.evaluate(trig, whichState, opcode, limitval)
  endfunction
  //===========================================================================
  function TriggerRegisterAnyPlayerKeyEventBJBJ takes trigger trig, integer keType, integer keKey returns nothing
    local integer i = 0
    loop
      call TriggerRegisterPlayerKeyEventBJ(trig, Player(i), keType, keKey)
      set i = i+1
      exitwhen i>=12
    endloop
  endfunction
  function TriggerRegisterAnyPlayerKeyEventBJ takes trigger trig, integer keType, integer keKey returns nothing
    call TriggerRegisterAnyPlayerKeyEventBJBJ.evaluate(trig, keType, keKey)
  endfunction
  //===========================================================================

  //! textmacro TRAPEvent takes NAME
  function TriggerRegisterAnyPlayerEvent$NAME$BJBJ takes trigger trig returns nothing
    local integer i = 0
    loop
      call TriggerRegisterPlayerEvent$NAME$(trig, Player(i))
      set i = i+1
      exitwhen i>=12
    endloop
  endfunction
  function TriggerRegisterAnyPlayerEvent$NAME$BJ takes trigger trig returns nothing
    call TriggerRegisterAnyPlayerEvent$NAME$BJBJ.evaluate(trig)
  endfunction
  //! endtextmacro

  //! runtextmacro TRAPEvent("Victory")
  //! runtextmacro TRAPEvent("Defeat")
  //! runtextmacro TRAPEvent("Leave")
  //! runtextmacro TRAPEvent("AllianceChanged")
  //! runtextmacro TRAPEvent("EndCinematic")
  //===========================================================================



  function TriggerRegisterAnyPlayerChatEventBJBJ takes trigger trig, string chatMessageToDetect, boolean exactMatchOnly returns nothing
    local integer i = 0
    loop
      call TriggerRegisterPlayerChatEvent(trig, Player(i), chatMessageToDetect, exactMatchOnly)
      set i = i+1
      exitwhen i>=12
    endloop
  endfunction
  function TriggerRegisterAnyPlayerChatEventBJ takes trigger trig, string chatMessageToDetect, boolean exactMatchOnly returns nothing
    call TriggerRegisterAnyPlayerChatEventBJBJ.evaluate(trig, chatMessageToDetect, exactMatchOnly)
  endfunction
endlibrary//===========================================================================
// Trigger: JN Load
//===========================================================================
library JNServerCode initializer init
// import "JNServer.j"
native JNUse takes nothing returns boolean
native JNOpenBrowser takes string Address returns nothing
native JNGetLoadCode takes string MapId, string UserId, string SecretKey, string Character returns string
native JNSetSaveCode takes string MapId, string UserId, string SecretKey, string Character, string Code returns string

//import "JNString.j"
native JNStringSplit takes string str, string sub, integer index returns string
native JNStringTrim takes string str returns string

//import "DzAPISync.j"
native DzTriggerRegisterSyncData takes trigger trig, string prefix, boolean server returns nothing
native DzSyncData takes string prefix, string data returns nothing
native DzGetTriggerSyncData takes nothing returns string
native DzGetTriggerSyncPlayer takes nothing returns player

native JNDailySave takes string MapId, string UserId, string SecretKey, string Character, string DailyType returns string
native JNDailyCheckTodayList takes string MapId, string UserId, string SecretKey, string Character, string DailyType returns string
native JNDailyCountWeek takes string MapId, string UserId, string SecretKey, string Character, string DailyType, string WeekDay returns string

native IsHostPlayer takes nothing returns boolean

constant function FAL_isHasValue takes integer i returns boolean
 return not ( i == 0 or i == 2147483647 )
endfunction
function FAL_SetMulti0 takes integer P, integer TableNumber, integer input1, integer input2, integer val returns nothing
//debug call BJDebugMsg("FAL GET" + I2S(TableNumber) + " - " + I2S(P)+"/" + I2S(TableNumber)+"/" + I2S(input1)+"/"+ I2S(input2)+"=" + I2S(Localtable(udg_FAL_Table0[P]).getValue(input1, input2)))
  call SaveInteger(udg_hash, StringHash(I2S(P)+"_"+I2S(TableNumber)), StringHash(I2S(input1)+"_"+I2S(input2)), val)
endfunction
function FAL_GetMulti0 takes integer P, integer TableNumber, integer input1, integer input2 returns integer
//debug call BJDebugMsg("FAL GET" + I2S(TableNumber) + " - " + I2S(P)+"/" + I2S(TableNumber)+"/" + I2S(input1)+"/"+ I2S(input2)+"=" + I2S(Localtable(udg_FAL_Table0[P]).getValue(input1, input2)))
  return LoadInteger(udg_hash, StringHash(I2S(P)+"_"+I2S(TableNumber)), StringHash(I2S(input1)+"_"+I2S(input2)) )
endfunction

//native JNServerTime takes string Format returns string
  globals
    constant string JN_MAPID = "fooiff"
    constant string JN_SECRETKEY = "36be2b53-a7e5-41cc-9654-6741f64a9437"
    player GetServerPlayer
    string GetServerCode = null
    integer JN_LoaderNow = 0
    integer array JN_LoaderSlot
    string array JN_SlotName
  endglobals

  private function SyncGetServerCode takes nothing returns nothing
    set GetServerPlayer = DzGetTriggerSyncPlayer()
    set GetServerCode = DzGetTriggerSyncData()
    call TriggerExecute(gg_trg_JN_Load_Complete2)
  endfunction
  private function SyncGetDailyCode takes nothing returns nothing
    set GetServerPlayer = DzGetTriggerSyncPlayer()
    set GetServerCode = DzGetTriggerSyncData()
    call TriggerExecute(gg_trg_Event_DailyCheck2)
  endfunction
  private function SyncGetDailyStateCode takes nothing returns nothing
    set GetServerPlayer = DzGetTriggerSyncPlayer()
    set GetServerCode = DzGetTriggerSyncData()
    call TriggerExecute(gg_trg_Event_DailyCheckState2)
  endfunction
  private function SyncGetEventCode takes nothing returns nothing
    set GetServerPlayer = DzGetTriggerSyncPlayer()
    set GetServerCode = DzGetTriggerSyncData()
    call TriggerExecute(gg_trg_Event_Buff22)
  endfunction

  function JNLoadServerCode takes player p, string jnkeyword returns nothing
//debug call BJDebugMsg("JN Load_KEYWORD: " + jnkeyword)
    if ( GetLocalPlayer() == p ) then
      call DzSyncData("JN서버", JNGetLoadCode(JN_MAPID, udg_SysB_Name[GetPlayerId(p)+1], JN_SECRETKEY, jnkeyword))
//debug call BJDebugMsg("JN Load_GETCODE: - " + getcode)
    endif
  endfunction
  function JNDailyCheck takes player p returns nothing
    local string getcode
    local string slot = I2S(FAL_GetMulti0(GetPlayerId(p)+1,0,0,4))
    if ( GetLocalPlayer() == p ) then
      set getcode = JNDailyCheckTodayList(JN_MAPID, StringCase(udg_SysB_Name[GetPlayerId(p)+1],true), JN_SECRETKEY,slot,"DailyType1") + "|"
      call JNDailySave(JN_MAPID, StringCase(udg_SysB_Name[GetPlayerId(p)+1],true), JN_SECRETKEY,slot,"DailyType1")
      set getcode = getcode + JNDailyCountWeek(JN_MAPID, StringCase(udg_SysB_Name[GetPlayerId(p)+1],true), JN_SECRETKEY,slot,"DailyType1","1")
      call DzSyncData("JNDaily", getcode)      
    endif
  endfunction
  function JNDailyCheck_State takes player p returns nothing
    local string getcode
    local string slot = I2S(FAL_GetMulti0(GetPlayerId(p)+1,0,0,4))
    if ( GetLocalPlayer() == p ) then
      set getcode = JNDailyCheckTodayList(JN_MAPID, StringCase(udg_SysB_Name[GetPlayerId(p)+1],true), JN_SECRETKEY,slot,"DailyType2") + "|"
      call JNDailySave(JN_MAPID, StringCase(udg_SysB_Name[GetPlayerId(p)+1],true), JN_SECRETKEY,slot,"DailyType2")
      set getcode = getcode + JNDailyCountWeek(JN_MAPID, StringCase(udg_SysB_Name[GetPlayerId(p)+1],true), JN_SECRETKEY,slot,"DailyType2","1")
      call DzSyncData("JNDaily2", getcode)      
    endif
  endfunction
  //call JNLoadServerCode(p, "0_0")
  function JNEventCheck takes player p returns nothing
    if ( GetLocalPlayer() == p ) then
      call DzSyncData("JNEvent", JNUseUserRoleItemInfo(JN_MAPID, JN_SECRETKEY, udg_SysB_Name[GetPlayerId(p)+1], "Event"))
    endif
  endfunction
  
  //동기화 완료
  private function SetLevel takes nothing returns nothing
    if ( DzGetTriggerSyncData() == "Simple" ) then
      set simplecheck = true
      call TriggerExecute(gg_trg_Intr_Effect_Off)
    else
      set simplecheck = false
    endif
    set udg_SysA_Host = DzGetTriggerSyncPlayer()
  endfunction
  
  //게임 시작 0초 후에 작동
  private function Main takes nothing returns nothing
    //호스트 플레이어의 HardMode 값을 동기화
    if ( IsHostPlayer() ) then
      if ( simplecheck ) then
        call DzSyncData("JNSimple", "Simple")
      else
        call DzSyncData("JNSimple", "normal")
      endif
    endif
  endfunction

  private function init takes nothing returns nothing
    local trigger trig = CreateTrigger()
//debug call BJDebugMsg("JN Load 작동")
    call DzTriggerRegisterSyncData(trig, "JN서버", false)
    call TriggerAddAction(trig, function SyncGetServerCode)
    
    set trig = CreateTrigger()
    call DzTriggerRegisterSyncData(trig, "JNDaily", false)
    call TriggerAddAction(trig, function SyncGetDailyCode)

    set trig = CreateTrigger()
    call DzTriggerRegisterSyncData(trig, "JNDaily2", false)
    call TriggerAddAction(trig, function SyncGetDailyStateCode)

    set trig = CreateTrigger()
    call DzTriggerRegisterSyncData(trig, "JNEvent", false)
    call TriggerAddAction(trig, function SyncGetEventCode)
    
    set trig = CreateTrigger()
    call TriggerRegisterTimerEvent(trig, 7., false)
    call TriggerAddAction(trig, function Main)
    
    set trig = CreateTrigger()
    call DzTriggerRegisterSyncData(trig, "JNSimple", false)
    call TriggerAddAction(trig, function SetLevel)
    
    set trig = null
  
    //set udg_ShareChatBoard = CreateLeaderboard()
    call JNUse()
  endfunction

endlibrary//===========================================================================
// Trigger: JN NOTICE
//===========================================================================
native JNPushReg takes string MapId returns nothing
native JNGetPushMessage takes nothing returns string
native JNWriteLog takes string str returns nothing
native JNStringContains takes string str, string sub returns boolean

native DzGetTriggerUIEventFrame takes nothing returns integer
native DzFrameSetTextColor takes integer frame, integer color returns nothing
native DzFrameClearAllPoints takes integer frame returns nothing
native DzGetTriggerUIEventPlayer takes nothing returns player
native DzFrameSetUpdateCallbackByCode takes code funcHandle returns nothing
native DzFrameSetEnable takes integer name, boolean enable returns nothing
native DzCreateFrame takes string frame, integer parent, integer id returns integer
globals
    constant integer JN_FRAMEEVENT_CONTROL_CLICK = 1
    constant integer JN_FRAMEPOINT_BOTTOM = 7
    constant integer JN_FRAMEPOINT_TOP = 1
    constant integer JN_FRAMEPOINT_TOPRIGHT = 2
endglobals
scope MapNotice initializer init
  globals
    integer array NoticeFrame
    integer array NoticeFrameButton
    integer array NoticeText
    integer array NoticeEscFrame
    integer array NoticeFrameEscButton
    string array Notice
    boolean MinMaxBol = false
    
    integer FrameBackDropCount = 0
    integer FrameButtonCount = 0
    integer FrameTextCount = 0
  endglobals
  
  private function FrameCounter takes string str returns integer
    if str == "BACKDROP" then
      set FrameBackDropCount = FrameBackDropCount + 1
      return FrameBackDropCount
    elseif str == "GLUETEXTBUTTON" then
      set FrameButtonCount = FrameButtonCount + 1
      return FrameButtonCount
    elseif str == "TEXT" then
      set FrameTextCount = FrameTextCount + 1
      return FrameTextCount
    endif
    return -1
  endfunction
  
  private function GetNoticeTexturePath takes string notice, string path returns string
    if JNStringContains(notice, "공지") then
      return path + "_1.tga"
    endif
    return path + "_2.tga"
  endfunction
  
  private function Rearrangement takes nothing returns nothing
    local string str
    local integer i = 1

    if GetLocalPlayer() == GetLocalPlayer() then
      if Notice[1] == null then
        call DzFrameShow(NoticeFrame[5], false)
      else
        call DzFrameShow(NoticeFrame[5], true)
        if MinMaxBol then
          call DzFrameSetTexture(NoticeFrame[5], GetNoticeTexturePath(Notice[1], "D"), 0)
          loop
          exitwhen i == 4
            if Notice[i] != null then
              call DzFrameShow(NoticeFrame[i], true)
              call DzFrameSetTexture(NoticeFrame[i], GetNoticeTexturePath(Notice[i], "N"), 0)
              call DzFrameSetText(NoticeText[i], JNStringSplit(Notice[i], "||", 1))
              call DzFrameSetTexture(NoticeEscFrame[i], GetNoticeTexturePath(Notice[i], "X"), 0)
            else
              call DzFrameShow(NoticeFrame[i], false)
            endif
            set i = i + 1
          endloop
        else
          call DzFrameShow(NoticeFrame[1], false)
          call DzFrameSetTexture(NoticeFrame[5], GetNoticeTexturePath(Notice[1], "U"), 0)  
        endif
      endif
    endif

  endfunction
  
  private function GetNotice takes nothing returns nothing
    local string notice

    if GetLocalPlayer() == GetLocalPlayer() then
      set notice = JNGetPushMessage()
      if notice != "" then
        if Notice[1] == null then
          set Notice[1] = notice
        elseif Notice[2] == null then
          set Notice[2] = notice
        else
          set Notice[3] = notice
        endif
      endif
      call Rearrangement()
    endif
  endfunction

  private function NoticeOpenBrowser takes nothing returns nothing
    local integer frame = DzGetTriggerUIEventFrame()

    if frame == NoticeFrameButton[1] then
      call JNOpenBrowser(JNStringSplit(Notice[1], "||", 2))
      set Notice[1] = null
      if Notice[2] != null then
        set Notice[1] = Notice[2]
        set Notice[2] = null
        if Notice[3] != null then
          set Notice[2] = Notice[3]
          set Notice[3] = null
        endif
      else
        set MinMaxBol = false
      endif
    elseif frame == NoticeFrameButton[2] then
      call JNOpenBrowser(JNStringSplit(Notice[2], "||", 2))
      set Notice[2] = null
      if Notice[3] != null then
        set Notice[2] = Notice[3]
        set Notice[3] = null
      endif
    elseif frame == NoticeFrameButton[3] then
      call JNOpenBrowser(JNStringSplit(Notice[3], "||", 2))
      set Notice[3] = null
    endif

    call Rearrangement()
  endfunction
  
  private function NoticeESC takes nothing returns nothing
    local integer frame = DzGetTriggerUIEventFrame()

    if frame == NoticeFrameEscButton[1] then
      set Notice[1] = null
      if Notice[2] != null then
        set Notice[1] = Notice[2]
        set Notice[2] = null
        if Notice[3] != null then
          set Notice[2] = Notice[3]
          set Notice[3] = null
        endif
      else
        set MinMaxBol = false
      endif
    elseif frame == NoticeFrameEscButton[2] then
      set Notice[2] = null
      if Notice[3] != null then
        set Notice[2] = Notice[3]
        set Notice[3] = null
      endif
    elseif frame == NoticeFrameEscButton[3] then
      set Notice[3] = null
    endif

    call Rearrangement()
  endfunction
  
  private function MinMaxFrame takes nothing returns nothing
    if MinMaxBol then
      call DzFrameSetTexture(NoticeFrame[5], GetNoticeTexturePath(Notice[1], "U"), 0)
      set MinMaxBol = false
    else
      call DzFrameSetTexture(NoticeFrame[5], GetNoticeTexturePath(Notice[1], "D"), 0)
      set MinMaxBol = true
    endif
    
    call Rearrangement()
  endfunction
  
  private function MakeFrame takes nothing returns nothing
    local integer ui = DzGetGameUI()
    local integer i = 1
    
    // MinMaxButton index 5
    set NoticeFrame[5] = DzCreateFrameByTagName("BACKDROP", "MINMAXBACKDROP", ui, "", FrameCounter("BACKDROP"))
    call DzFrameSetSize(NoticeFrame[5], 0.02, 0.02)
    call DzFrameSetPoint(NoticeFrame[5], JN_FRAMEPOINT_BOTTOMLEFT, ui,  JN_FRAMEPOINT_BOTTOMLEFT, 0.05, 0.17)
    call DzFrameShow(NoticeFrame[5], false)
    set NoticeFrameButton[5] = DzCreateFrameByTagName("GLUETEXTBUTTON", "MINMAXBUTTON", NoticeFrame[5], "", FrameCounter("GLUETEXTBUTTON"))
    call DzFrameSetSize(NoticeFrameButton[5], 0.02, 0.02)
    call DzFrameSetPoint(NoticeFrameButton[5], JN_FRAMEPOINT_CENTER, NoticeFrame[5],  JN_FRAMEPOINT_CENTER, 0, 0)
    call DzFrameSetScriptByCode(NoticeFrameButton[5], JN_FRAMEEVENT_CONTROL_CLICK, function MinMaxFrame, false)
    
    // Notice Frame Point
    set NoticeFrame[0] = DzCreateFrameByTagName("BACKDROP", "NOTICEBACKDROP", NoticeFrame[5], "", FrameCounter("BACKDROP"))
    call DzFrameSetTexture(NoticeFrame[0], "B.tga", 0)
    call DzFrameSetSize(NoticeFrame[0], 0.3, 0.001)
    call DzFrameSetPoint(NoticeFrame[0], JN_FRAMEPOINT_TOPLEFT, NoticeFrame[5],  JN_FRAMEPOINT_BOTTOMRIGHT, 0, 0)
    
    // Notice Frame
    loop
    exitwhen i == 4
      set NoticeFrame[i] = DzCreateFrameByTagName("BACKDROP", "NOTICEBACKDROP", NoticeFrame[i - 1], "", FrameCounter("BACKDROP"))
      call DzFrameSetSize(NoticeFrame[i], 0.3, 0.02)
      call DzFrameSetPoint(NoticeFrame[i], JN_FRAMEPOINT_BOTTOM, NoticeFrame[i - 1],  JN_FRAMEPOINT_TOP, 0, 0)
      call DzFrameShow(NoticeFrame[i], false)
      
      set NoticeText[i] = DzCreateFrameByTagName("TEXT", "NOTICENAME", NoticeFrame[i], "", FrameCounter("TEXT"))
      call DzFrameSetTextColor(NoticeText[i], 0)
      call DzFrameSetSize(NoticeText[i], 0.25, 0.02)
      call DzFrameSetPoint(NoticeText[i], JN_FRAMEPOINT_LEFT, NoticeFrame[i],  JN_FRAMEPOINT_LEFT, 0.043, -0.004)
      
      set NoticeFrameButton[i] = DzCreateFrameByTagName("GLUETEXTBUTTON", "NOTICEBUTTON", NoticeFrame[i], "", FrameCounter("GLUETEXTBUTTON"))
      call DzFrameSetSize(NoticeFrameButton[i], 0.3, 0.02)
      call DzFrameSetPoint(NoticeFrameButton[i], JN_FRAMEPOINT_CENTER, NoticeFrame[i],  JN_FRAMEPOINT_CENTER, 0, 0)
      call DzFrameSetScriptByCode(NoticeFrameButton[i], JN_FRAMEEVENT_CONTROL_CLICK, function NoticeOpenBrowser, false)
      
      set NoticeEscFrame[i] = DzCreateFrameByTagName("BACKDROP", "NOTICEBACKDROP", NoticeFrame[i], "", FrameCounter("BACKDROP"))
      call DzFrameSetSize(NoticeEscFrame[i], 0.017, 0.017)
      call DzFrameSetPoint(NoticeEscFrame[i], JN_FRAMEPOINT_RIGHT, NoticeFrame[i],  JN_FRAMEPOINT_RIGHT, -0.002, 0)
      
      set NoticeFrameEscButton[i] = DzCreateFrameByTagName("GLUETEXTBUTTON", "NOTICEBUTTON", NoticeEscFrame[i], "", FrameCounter("GLUETEXTBUTTON"))
      call DzFrameSetSize(NoticeFrameEscButton[i], 0.017, 0.017)
      call DzFrameSetPoint(NoticeFrameEscButton[i], JN_FRAMEPOINT_CENTER, NoticeEscFrame[i],  JN_FRAMEPOINT_CENTER, 0, 0)
      call DzFrameSetScriptByCode(NoticeFrameEscButton[i], JN_FRAMEEVENT_CONTROL_CLICK, function NoticeESC, false)
      
      set i = i + 1
    endloop
  endfunction
  
  private function init takes nothing returns nothing
    call JNPushReg(JN_MAPID)
    call MakeFrame()
    call TimerStart(CreateTimer(), 60.01, true, function GetNotice)
  endfunction
endscope//===========================================================================
// Trigger: JN OpLimit
//===========================================================================
//import "JNMemory.j"
native JNGetModuleHandle takes string moduleName returns integer
native JNMemorySetInteger takes integer offset, integer value returns nothing

library OpLimit
    function SetOpLimit takes integer opLimit returns nothing
        local integer pGameDll = JNGetModuleHandle("game.dll")
        call JNMemorySetInteger(pGameDll + 0x2100B9, opLimit)
        call JNMemorySetInteger(pGameDll + 0x239C1F, opLimit)
        call JNMemorySetInteger(pGameDll + 0x23F941, opLimit)
        call JNMemorySetInteger(pGameDll + 0x24255A, opLimit)
        call JNMemorySetInteger(pGameDll + 0x8D0303, opLimit)
        call JNMemorySetInteger(pGameDll + 0x8D133A, opLimit)
        call JNMemorySetInteger(pGameDll + 0x970A85, opLimit)
        call JNMemorySetInteger(pGameDll + 0x970A95, opLimit)
        call JNMemorySetInteger(pGameDll + 0x972134, opLimit)
//        call JNMemorySetInteger(pGameDll + 0x94CB58, opLimit)  // OpLimit인지 불확실
//        call JNMemorySetInteger(pGameDll + 0x9A1F3C, opLimit)  // OpLimit인지 불확실
//        call JNMemorySetInteger(pGameDll + 0x9A218E, opLimit)  // OpLimit인지 불확실
//        call JNMemorySetInteger(pGameDll + 0x9A282E, opLimit)  // OpLimit인지 불확실
    endfunction
endlibrary
//===========================================================================
// Trigger: RankEx
//
// JN_MAPID
//===========================================================================
native JNObjectScoreGet takes string UserId, string Field returns integer
native JNObjectScoreSet takes string UserId, string Field, integer Value returns nothing
native JNObjectScoreAdd takes string UserId, string Field, integer Value returns nothing
native JNObjectScoreInit takes string MapId, string SecretKey, string UserId, string Character returns integer
native JNObjectScoreSave takes string MapId, string SecretKey, string UserId, string Character returns string
library RankEx
  globals
    private string Tag1 = "Wood"
    private string Tag2 = "HP"
    private string Tag3 = "MP"
    private string Tag4 = "Defence"
    private string Tag5 = "Stats"
    private string Tag6 = "Inchant"
  endglobals
  private constant function Tags takes integer i returns string
    if ( i == 1 ) then
      return Tag1
    elseif ( i == 2 ) then
      return Tag2
    elseif ( i == 3 ) then
      return Tag3
    elseif ( i == 4 ) then
      return Tag4
    elseif ( i == 5 ) then
      return Tag5
    elseif ( i == 6 ) then
      return Tag6
    else
      return ""
    endif
  endfunction
  private function I2PN takes integer P returns string
    return udg_SysB_Name[P]
  endfunction
  private function ScoreInit takes integer P, string Character returns boolean
    if ( not LoadBoolean(udg_hash, P, StringHash(Character)) ) then
      call SaveBoolean(udg_hash, P, StringHash(Character), true)
      call JNObjectScoreInit(JN_MAPID, JN_SECRETKEY, I2PN(P), Character)
      call TriggerSleepAction(.1)
    endif
    return true
  endfunction
  private function ScoreView takes integer P, integer TagId returns nothing
    call DisplayTimedTextToPlayer(GetLocalPlayer(), .5+udg_SysA_AddValue, 0, 6., I2PN(P) + "|cffffdc3c님의|r " + Tags(TagId) + "|cffffdc3c 점수 갱신: |r" + I2S(JNObjectScoreGet(I2PN(P), Tags(TagId))) + "|r" )
  endfunction
  private function ScoreGet takes integer P, integer TagId returns integer
    return JNObjectScoreGet(I2PN(P), Tags(TagId))
  endfunction
  private function ScoreSet takes integer P, integer val, integer TagId returns nothing
    call JNObjectScoreSet(I2PN(P), Tags(TagId), val)
  endfunction
  private function ScoreAdd takes integer P, integer add, integer TagId returns nothing
    call JNObjectScoreAdd(I2PN(P), Tags(TagId), add)
  endfunction
  
  private function ScoreSave takes integer P, string Character returns nothing
    call JNObjectScoreSave(JN_MAPID, JN_SECRETKEY, I2PN(P), Character)
  endfunction
  public function HighSave takes integer P, integer TagId, integer val, string Character returns nothing
    call ScoreInit(P, Character)
    if ( ScoreGet(P, TagId) < val ) then
      call ScoreSet(P, val, TagId)
      call ScoreSave(P, Character)
      call ScoreView(P, TagId)
    endif
  endfunction
  //call HighSave(P, 1~6, val, GetUnitName(udg_Unit[P]))
endlibrary//===========================================================================
// Trigger: DmgText
//
// N	평타
// C	크리
// H	회복
// S	스킬
// G	스킬-드모 등
// M	마법
// D	필살기 (라그나로크 등)
//===========================================================================
native EXSetEffectSpeed takes effect e, real speed returns nothing
library DmgText
  globals
    private constant real NUMBER_SPACE = 40. /*글자 사이 간격 */
    private constant real BASE_Y = 30. /* 기본 높이 */
    
    /* 누수 방지 */
    private effect temp_effect
    private string temp_s
    private real temp_r
  endglobals
  
  private constant function I2SS takes integer i returns string
  /* 아래 constant function은 I2S 사용이 안되니 그걸 위한 함수 */
    if ( i == 1 ) then
      return "1"
    elseif ( i == 2 ) then
      return "2"
    elseif ( i == 3 ) then
      return "3"
    elseif ( i == 4 ) then
      return "4"
    elseif ( i == 5 ) then
      return "5"
    elseif ( i == 6 ) then
      return "6"
    elseif ( i == 7 ) then
      return "7"
    elseif ( i == 8 ) then
      return "8"
    elseif ( i == 9 ) then
      return "9"
    elseif ( i == -1 ) then
      return "C"
    else
      return "0"
    endif
  endfunction
  /*private constant function I2SSS takes integer Tag returns string
    /* 모델 및 구분자 */
    if Tag == 1 then     /* 평타 - 크리티컬 */
      return "C"
    elseif Tag == 2 then /* 회복 */
      return "H"
    elseif Tag == 3 then /* 물리 스킬 */
      return "S"
    elseif Tag == 4 then /* 마법 스킬 */
      return "M"
    elseif Tag == 5 then /* 필살기 */
      return "D"
    else /* 평타 */
      return "N"
    endif
  endfunction
  */
  private constant function II2S takes integer inCount, string Tag returns string
    return "war3mapImported\\Dfont_" + Tag + I2SS(inCount) + ".mdl"
  endfunction
  private constant function SS2I takes string s returns integer
  /* 글자 최적화 */
    if ( s == "1" ) then
      return 1
    elseif ( s == "2" ) then
      return 2
    elseif ( s == "3" ) then
      return 3
    elseif ( s == "4" ) then
      return 4
    elseif ( s == "5" ) then
      return 5
    elseif ( s == "6" ) then
      return 6
    elseif ( s == "7" ) then
      return 7
    elseif ( s == "8" ) then
      return 8
    elseif ( s == "9" ) then
      return 9
    else
      return 0
    endif
  endfunction
  private constant function CriTag takes string s returns boolean
    return ( s == "S" ) or ( s == "G" ) or ( s == "M" ) or ( s == "D" )
  endfunction
  private constant function BaseSize takes string Tag returns real
    if ( Tag == "M" ) then
      return 1.6
    else
      return .8
    endif
  endfunction
  public function View takes string Tag, boolean cri, real x, real y, integer dmg, real size returns nothing
    local integer loopA
    set temp_s = I2S(dmg)  /* 5687.21 -> "5687" */
    set loopA = StringLength(temp_s)
    set x = x-(loopA-1)*.5*(NUMBER_SPACE*size*BaseSize(Tag)) /* 글자 가운데 정렬 */
    
    set y = y + BASE_Y + GetRandomReal(-50.,50.)
    if ( cri ) then
      if ( Tag == "N" ) then
        set Tag = "C"
      elseif ( CriTag(Tag) ) then
        set temp_effect = AddSpecialEffect(II2S(-1, Tag), x, y)
        call EXSetEffectSize(temp_effect, size*BaseSize(Tag))
        call EXSetEffectSpeed(temp_effect, 2.)
        call DestroyEffect(temp_effect)
      endif
    endif
    
    loop
      exitwhen loopA <= 0
      set temp_effect = AddSpecialEffect(II2S(SS2I(SubString(temp_s, loopA-1, loopA)), Tag), x+(NUMBER_SPACE*size)*loopA, y)
      call EXSetEffectSize(temp_effect, size*BaseSize(Tag))
      call EXSetEffectSpeed(temp_effect, 2.)
      call DestroyEffect(temp_effect)
    
      set loopA = loopA - 1
    endloop
  endfunction
  //call DmgText_View("M", cri, GetWidgetX(u), GetWidgetY(u), od, 1.)
  
endlibrary//===========================================================================
// Trigger: Party Intr all
//
// 생성, 해체, 목록,
// 가입승낙, 파티승낙
//===========================================================================
function GetPartyMember2 takes integer P, boolean leader returns string
  if ( leader ) then
    return "|c000080ff파티장 : "+SysStr(2,P)+udg_SysB_Name[P]+"|cfffff200Lv."+I2S(GetUnitLevel(udg_Unit[P]))+"|c00ffff80『"+GetUnitName(udg_Unit[P])+"』|c000080ff[ 스탯 : |r"+I2S(udg_SysE_STR3[P])+" |c000080ff/|r "+I2S(udg_SysE_DEX3[P])+" |c000080ff/|r "+I2S(udg_SysE_INT3[P])+" |c000080ff/|r "+I2S(udg_SysE_WIS3[P])+" |c000080ff/|r "+I2S(udg_SysE_CON3[P])+" |c000080ff ] 《|cffffdc3c"+Hunting_Data(udg_OnesPositionN[P])+"|c000080ff》|r"
  else
    return "|c0000ffff파티원 : "+SysStr(2,P)+udg_SysB_Name[P]+"|cfffff200Lv."+I2S(GetUnitLevel(udg_Unit[P]))+"|c00ffff80『"+GetUnitName(udg_Unit[P])+"』|c000080ff[ 스탯 : |r"+I2S(udg_SysE_STR3[P])+" |c0000ffff/|r "+I2S(udg_SysE_DEX3[P])+" |c0000ffff/|r "+I2S(udg_SysE_INT3[P])+" |c0000ffff/|r "+I2S(udg_SysE_WIS3[P])+" |c0000ffff/|r "+I2S(udg_SysE_CON3[P])+" |c0000ffff ] 《|cffffdc3c"+Hunting_Data(udg_OnesPositionN[P])+"|c0000ffff》|r"
  endif
endfunction
function GetPartyMember takes integer P returns string
 return SysStr(5,P) + "|c008bc7fc＊" + SysStr(2,P) + udg_SysB_Name[P] + "|cffffdc3c(" + SysStr(2,P) + GetUnitName(udg_Unit[P]) + "|cfffff200Lv." + I2S(GetUnitLevel(udg_Unit[P])) + "|cffffdc3c)|c00ffff80《"+Hunting_Data(udg_OnesPositionN[P])+"|r》"
endfunction

function SelectorEnd takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local integer P = LoadInteger(udg_hash, GetHandleId(t), StringHash("Selector-P"))
 local integer no = LoadInteger(udg_hash, GetHandleId(t), StringHash("Selector-no"))
 local string msg = LoadStr(udg_hash, GetHandleId(t), StringHash("Selector-S"))
  
  //시간 종료시
  if ( udg_Quest_Boolean_B[P] == false ) and ( LoadBoolean(udg_hash, getIndex(P, no, 100), 31) ) then
    call SaveBoolean(udg_hash, getIndex(P,no,100), 31, false)
    if ( msg != null ) then
      call MSG(Player(P-1), 2, 6., msg)
    endif
    if ( no == 14 ) then
      set udg_PartyTitle[P] = udg_PartyTitle[P] + "|cffffdc3c[기본성향]|r"
      set udg_SysK_Exp[P] = udg_SysA_COUNT*SysInt(0,30)
      set udg_SysK_Drop[P] = udg_SysA_COUNT*SysInt(0,31)
      set udg_SysK_Gold[P] = udg_SysA_COUNT*SysInt(0,32)
    endif
    set udg_Quest_00_NumberAt[P] = 0
  else
    set udg_Quest_Boolean_B[P] = false
  endif
  call FlushChildHashtable(udg_hash, GetHandleId(t))
  call DestroyTimer(t)
 set t = null
endfunction
function Selector takes integer P, integer no, real time, string msg returns nothing
 local timer t = CreateTimer()
  call SaveInteger(udg_hash, GetHandleId(t), StringHash("Selector-P"), P)
  call SaveInteger(udg_hash, GetHandleId(t), StringHash("Selector-no"), no)
  if ( msg != null ) then
    call SaveStr(udg_hash, GetHandleId(t), StringHash("Selector-S"), msg)
  endif
  set udg_Quest_00_NumberAt[P] = no
  call SaveBoolean(udg_hash, getIndex(P,no,100), 31, true)
  call TimerStart(t, time, false, function SelectorEnd)
 set t = null
endfunction
//파티 보너스
function Party takes integer who, integer to, boolean add returns nothing
 local integer loopA = S2I(SubString(SysStr(1, GetUnitTypeId(udg_Unit[who])), 1, 2))
  if ( udg_PartyNumber_pP[to] != 0 ) then
    if ( add ) then
      call SaveInteger(udg_hash,loopA,300+to,LoadInteger(udg_hash,loopA,300+to)+1)
      if ( LoadBoolean(udg_hash,to,300) == false ) and ( udg_PartyNumber_pP[to] >= 5 ) then
        if ( LoadInteger(udg_hash,2,300+to) >= 1 ) and ( LoadInteger(udg_hash,3,300+to) >= 1 ) and ( LoadInteger(udg_hash,4,300+to) >= 1 ) and ( LoadInteger(udg_hash,5,300+to) >= 1 ) and ( LoadInteger(udg_hash,6,300+to) >= 1 ) then
          call SaveBoolean(udg_hash,to,300,true)
          set loopA = 1
          loop
            if ( udg_PartyNumber_ThisP[to] == udg_PartyNumber_ThisP[loopA] ) then
              set udg_SysK_ExpAdd[loopA] = udg_SysK_ExpAdd[loopA] + SysInt(0,23)
              set udg_SysK_DropAdd[loopA] = udg_SysK_DropAdd[loopA] + SysInt(0,24)
              set udg_SysK_GoldAdd[loopA] = udg_SysK_GoldAdd[loopA] + SysInt(0,25)
              call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", udg_Unit[loopA], "origin") )
              call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", udg_Unit[loopA], "origin") )
              call MSG(Player(loopA-1), 1, 7., "파티에 모든 직업이 모였습니다. 경험치/드랍률(템/골드)이 "+I2S(SysInt(0,23))+"%/"+I2S(SysInt(0,24))+"%/"+I2S(SysInt(0,25))+"% 상승합니다.")
            endif
            exitwhen loopA >= bj_MAX_PLAYERS
            set loopA = loopA + 1
          endloop
        endif
      elseif ( LoadBoolean(udg_hash,to,300) ) then
        set udg_SysK_ExpAdd[who] = udg_SysK_ExpAdd[who] + SysInt(0,23)
        set udg_SysK_DropAdd[who] = udg_SysK_DropAdd[who] + SysInt(0,24)
        set udg_SysK_GoldAdd[who] = udg_SysK_GoldAdd[who] + SysInt(0,25)
        
        call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", udg_Unit[who], "origin") )
        call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", udg_Unit[who], "origin") )
        call MSG(Player(loopA-1), 1, 7., "모든 직업이 모인 파티입니다. 경험치/드랍률(템/골드)이 "+I2S(SysInt(0,23))+"%/"+I2S(SysInt(0,24))+"%/"+I2S(SysInt(0,25))+"% 상승합니다.")
      endif
    
    //파티해체
    elseif ( to == who ) then
      if ( LoadBoolean(udg_hash, to, 300) ) then
        call SaveBoolean(udg_hash, to, 300, false)
        set loopA = 1
        loop
          set udg_SysK_ExpAdd[loopA] = udg_SysK_ExpAdd[loopA] - SysInt(0,23)
          set udg_SysK_DropAdd[loopA] = udg_SysK_DropAdd[loopA] - SysInt(0,24)
          set udg_SysK_GoldAdd[loopA] = udg_SysK_GoldAdd[loopA] - SysInt(0,25)
          call MSG(Player(loopA-1), 1, 3., "직업 보너스가 사라집니다.")
          exitwhen loopA >= bj_MAX_PLAYERS
          set loopA = loopA + 1
        endloop
      endif
      set loopA = 1
      loop
        call SaveInteger(udg_hash, loopA, 300+to, 0)
        exitwhen loopA >= 6
        set loopA = loopA + 1
      endloop
      set loopA = 1
      loop
        if ( udg_PartyNumber_ThisP[to] == udg_PartyNumber_ThisP[loopA] ) then
          set udg_SysK_Exp[loopA] = udg_SysA_COUNT*SysInt(0,30)
          set udg_SysK_Drop[loopA] = udg_SysA_COUNT*SysInt(0,31)
          set udg_SysK_Gold[loopA] = udg_SysA_COUNT*SysInt(0,32)
        endif
        exitwhen loopA >= bj_MAX_PLAYERS
        set loopA = loopA + 1
      endloop
    //파티원탈퇴
    else
      call SaveInteger(udg_hash, loopA, 300+to, LoadInteger(udg_hash, loopA, 300+to)-1)
      if ( LoadBoolean(udg_hash, to, 300) ) and ( LoadInteger(udg_hash, loopA, 300+to) == 0 ) then
        call SaveBoolean(udg_hash, to, 300, false)
        set loopA = 1
        loop
          if ( udg_PartyNumber_ThisP[to] == udg_PartyNumber_ThisP[loopA] ) then
            set udg_SysK_ExpAdd[loopA] = udg_SysK_ExpAdd[loopA] - SysInt(0,23)
            set udg_SysK_DropAdd[loopA] = udg_SysK_DropAdd[loopA] - SysInt(0,24)
            set udg_SysK_GoldAdd[loopA] = udg_SysK_GoldAdd[loopA] - SysInt(0,25)
            call MSG(Player(loopA-1), 1, 3., "직업 보너스가 사라집니다.")
          endif
          exitwhen loopA >= bj_MAX_PLAYERS
          set loopA = loopA + 1
        endloop
      endif
      set loopA = 1
      loop
        set udg_SysK_Exp[who] = udg_SysA_COUNT*SysInt(0,30)
        set udg_SysK_Drop[who] = udg_SysA_COUNT*SysInt(0,31)
        set udg_SysK_Gold[who] = udg_SysA_COUNT*SysInt(0,32)
        exitwhen loopA >= bj_MAX_PLAYERS
        set loopA = loopA + 1
      endloop
    endif
  endif
 set loopA = 0
endfunction
//call Party(GetConvertedPlayerId(GetTriggerPlayer()),GetConvertedPlayerId(GetTriggerPlayer()),"+")

function PartyMake takes integer P, string s returns nothing
  if ( udg_PartyNumber_ThisP[P] == 0 ) then
    if ( UnitAlive(udg_Unit[P]) ) then
      if ( udg_PartyNumber_pP[0] <= 3 ) then
        set udg_PartyNumber_pP[0] = udg_PartyNumber_pP[0] + 1
        set udg_PartyNumber_pP[P] = 1
        set udg_PartyNumber_ThisP[P] = P
        if ( StringLength(s) <= 14 ) then
          if ( GetRandomReal(0,100) <= 10. ) then
            set udg_PartyTitle[P] = GetPlayerName(Player(P-1)) + "의 멋쟁이 파티"
          elseif ( GetRandomReal(0,90) <= 10. ) then
            set udg_PartyTitle[P] = GetPlayerName(Player(P-1)) + "'s Super Party"
          elseif ( GetRandomReal(0,80) <= 10. ) then
            set udg_PartyTitle[P] = GetPlayerName(Player(P-1)) + "의 초대 or PK 파티"
          elseif ( GetRandomReal(0,70) <= 10. ) then
            set udg_PartyTitle[P] = GetPlayerName(Player(P-1)) + "님이 푸잎님을 좋아합니다."
          elseif ( GetRandomReal(0,60) <= 10. ) then
            set udg_PartyTitle[P] = GetPlayerName(Player(P-1)) + "님의 낮은 주사위 승리 파티"
          elseif ( GetRandomReal(0,50) <= 10. ) then
            set udg_PartyTitle[P] = GetPlayerName(Player(P-1)) + "님의 발컨파티"
          elseif ( GetRandomReal(0,40) <= 10. ) then
            set udg_PartyTitle[P] = GetPlayerName(Player(P-1)) + "'s Communist Party"
          elseif ( GetRandomReal(0,30) <= 10. ) then
            set udg_PartyTitle[P] = GetPlayerName(Player(P-1)) + "님의 힐러갈굼 파티"
          elseif ( GetRandomReal(0,20) <= 10. ) then
            set udg_PartyTitle[P] = GetPlayerName(Player(P-1)) + "님의 비주얼 최강 파티"
          else
            set udg_PartyTitle[P] = GetPlayerName(Player(P-1)) + "님의 잘생긴 파티"
          endif
        else
          set udg_PartyTitle[P] = SubString(s, 14, 44)
        endif
        call MSG(Player(P-1), 13, 6., "'"+udg_PartyTitle[P] + "'|c000080ff파티가 생성되었습니다.")
        set udg_SysK_Exp[P] = udg_SysA_COUNT*SysInt(0,30)
        set udg_SysK_Drop[P] = udg_SysA_COUNT*SysInt(0,31)
        set udg_SysK_Gold[P] = udg_SysA_COUNT*SysInt(0,32)
        call Party(P,P,true)
        call TriggerSleepAction(.3)
        // 성향
        call MSG(Player(P-1), 13, 8., SysStr(6,8))
        call Selector(P, 14, 10., "|c00d962b5＊|cffffdc3c시간이 모두 지났습니다. 기본성향으로 설정되었습니다.")
      else
        call MSG(Player(P-1), 13, 6., "현재 파티는 |c00d962b51" + I2S(udg_PartyNumber_pP[0]) + "|cffffdc3c개로, 너무 많습니다. 최대 |c00d962b53|cffffdc3c개까지 가능합니다.")
      endif
    else
      call MSG(Player(P-1), 13, 4., "케릭터가 생존하지 않아 생성할 수 없습니다 !!")
    endif
  else
    call MSG(Player(P-1), 13, 4., "이미 파티가 있습니다 !!")
  endif
endfunction
function PartyAdd takes integer who, integer to returns nothing
 local integer loopA = 1
  set udg_PartyNumber_ThisP[who] = to
  set udg_PartyNumber_pP[to] = udg_PartyNumber_pP[to] + 1
debug call BJDebugMsg("PartyAdd: to/pp" + I2S(to) +"/" + I2S(udg_PartyNumber_pP[to]))
  set udg_SysK_Exp[who] = udg_SysK_Exp[to]
  set udg_SysK_Drop[who] = udg_SysK_Drop[to]
  set udg_SysK_Gold[who] = udg_SysK_Gold[to]
  loop
    if ( udg_PartyNumber_ThisP[loopA] == to ) and ( loopA != who ) then
      call SetPlayerAllianceStateBJ(Player(who-1), Player(loopA-1), bj_ALLIANCE_ALLIED_VISION)
      call SetPlayerAllianceStateBJ(Player(loopA-1), Player(who-1), bj_ALLIANCE_ALLIED_VISION)
      call MSG(Player(loopA-1), 13, 3., SysStr(2,who)+udg_SysB_Name[who]+"|cffffdc3c님이 파티에 들어왔습니다.")
    endif
    exitwhen loopA >= bj_MAX_PLAYERS
    set loopA = loopA + 1
  endloop
  call Party(who,to,true)
  call MSG(Player(who-1), 13, 3., udg_PartyTitle[to]+"|cffffdc3c파티에 가입했습니다.")
endfunction
function PartyInviteOX takes integer who, boolean ok returns nothing
  if ( udg_PartyNumber_ThisP[who] == who ) and ( udg_Party_Invite[who] == 0 ) then
    call MSG(Player(who-1), 13, 4., "가입 신청한 사람이 없습니다.")
  elseif ( udg_PartyNumber_ThisP[who] == 0 ) and ( udg_Party_InviteTake[who] == 0 ) then
    call MSG(Player(who-1), 13, 4., "초대 온 메시지가 없습니다.")
  elseif ( ok ) then
    if ( udg_PartyNumber_ThisP[who] == who ) then
      set bj_forLoopAIndex = 1
      loop
        if ( bj_forLoopAIndex != who ) and ( udg_Party_Invite[bj_forLoopAIndex] == who ) then
          call PartyAdd(who, bj_forLoopAIndex)
          set udg_Party_Invite[who] = udg_Party_Invite[who] - 1
          set udg_Party_Invite[bj_forLoopAIndex] = 0
        endif
        exitwhen bj_forLoopAIndex >= bj_MAX_PLAYERS
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
    else
      call PartyAdd(who, udg_Party_InviteTake[who])
      set udg_Party_Invite[udg_Party_InviteTake[who]] = 0
      set udg_Party_InviteTake[who] = 0
    endif
  else
    if ( udg_PartyNumber_ThisP[who] == who ) then
      call MSG(Player(udg_Party_Invite[who]-1), 13, 3., "상대방이 가입을 승낙하지 않았습니다.")
      call MSG(Player(who-1), 13, 3., SysStr(2,who)+udg_SysB_Name[who]+"|cffffdc3c님의 가입을 승낙하지 않았습니다.")
      set udg_Party_Invite[who] = 0
    else
      call MSG(Player(udg_Party_InviteTake[who]-1), 13, 3., SysStr(2,who)+udg_SysB_Name[who]+"|cffffdc3c님이 파티를 거절했습니다.")
      call MSG(Player(who-1), 13, 3., udg_PartyTitle[udg_PartyNumber_ThisP[udg_Party_InviteTake[who]]]+"|cffffdc3c파티의 초대를 승낙하지 않았습니다.")
      set udg_Party_InviteTake[who] = 0
    endif
  endif
endfunction
function PartyBoom takes integer P returns nothing
  if ( udg_PartyNumber_ThisP[P] == P ) then
    set bj_forLoopAIndex = 1
    loop
      if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == P ) and ( bj_forLoopAIndex != P ) then
        // : 같은파티, A != 트작플
        set bj_forLoopBIndex = 1
        loop
          if ( udg_PartyNumber_ThisP[bj_forLoopBIndex] == udg_PartyNumber_ThisP[P] ) and ( bj_forLoopAIndex != bj_forLoopBIndex ) then
            // : 같은파티, B != A
            call SetPlayerAllianceStateBJ(Player(bj_forLoopBIndex-1), Player(bj_forLoopAIndex-1), bj_ALLIANCE_ALLIED)
            call SetPlayerAllianceStateBJ(Player(bj_forLoopAIndex-1), Player(bj_forLoopBIndex-1), bj_ALLIANCE_ALLIED)
          endif
          exitwhen bj_forLoopBIndex >= bj_MAX_PLAYERS
          set bj_forLoopBIndex = bj_forLoopBIndex + 1
        endloop
        set udg_SysK_Exp[bj_forLoopAIndex] = udg_SysA_COUNT*SysInt(0,30)
        set udg_SysK_Drop[bj_forLoopAIndex] = udg_SysA_COUNT*SysInt(0,31)
        set udg_SysK_Gold[bj_forLoopAIndex] = udg_SysA_COUNT*SysInt(0,32)
        if ( LoadBoolean(udg_hash,P,300) ) then
          set udg_SysK_ExpAdd[bj_forLoopAIndex] = udg_SysK_ExpAdd[bj_forLoopAIndex] - SysInt(0,23)
          set udg_SysK_DropAdd[bj_forLoopAIndex] = udg_SysK_DropAdd[bj_forLoopAIndex] - SysInt(0,24)
          set udg_SysK_GoldAdd[bj_forLoopAIndex] = udg_SysK_GoldAdd[bj_forLoopAIndex] - SysInt(0,25)
        endif
        set udg_PartyNumber_ThisP[bj_forLoopAIndex] = 0
        call MSG(Player(bj_forLoopAIndex-1), 13, 4., "파티가 해체 되었습니다.")
      endif
      exitwhen bj_forLoopAIndex >= bj_MAX_PLAYERS
      set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    call Party(P,P,false)
    set udg_SysK_Exp[P] = udg_SysA_COUNT*SysInt(0,30)
    set udg_SysK_Drop[P] = udg_SysA_COUNT*SysInt(0,31)
    set udg_SysK_Gold[P] = udg_SysA_COUNT*SysInt(0,32)
    set udg_PartyNumber_ThisP[P] = 0
    set udg_PartyNumber_pP[P] = 0
    set udg_PartyNumber_pP[0] = udg_PartyNumber_pP[0] - 1
    set udg_PartyTitle[0] = ""
    call MSG(GetTriggerPlayer(), 13, 4., "파티가 해체 되었습니다.")
  else
    call MSG(GetTriggerPlayer(), 13, 4., "당신은 파티장이 아닙니다.")
  endif
endfunction
function PartyLeft takes integer P returns nothing
  if ( udg_PartyNumber_ThisP[P] == 0 ) then
    call MSG(Player(P-1), 13, 4., "탈퇴 할 파티가 없습니다.")
  elseif ( udg_PartyNumber_ThisP[P] == P ) then
    call MSG(Player(P-1), 13, 4., "당신은 파티장입니다. 파티 탈퇴가 아닌 파티 해체됩니다.")
    call PartyBoom(P)
  else
    set bj_forLoopAIndex = 1
    loop
      if ( bj_forLoopAIndex != P ) and ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) then
        call SetPlayerAllianceStateBJ(Player(bj_forLoopAIndex-1), Player(P-1), bj_ALLIANCE_ALLIED)
        call SetPlayerAllianceStateBJ(Player(P-1), Player(bj_forLoopAIndex-1), bj_ALLIANCE_ALLIED)
        call MSG(Player(bj_forLoopAIndex-1), 13, 3., SysStr(2,P)+udg_SysB_Name[P]+"|cffffdc3c님이 파티에서 탈퇴했습니다.")
      endif
      exitwhen bj_forLoopAIndex >= bj_MAX_PLAYERS
      set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    call Party(P,udg_PartyNumber_ThisP[P],false)
    set udg_PartyNumber_pP[udg_PartyNumber_ThisP[P]] = udg_PartyNumber_pP[udg_PartyNumber_ThisP[P]] - 1
    call MSG(Player(P-1), 13, 3., udg_PartyTitle[udg_PartyNumber_ThisP[P]]+"|cffffdc3c파티에서 탈퇴했습니다.")
    set udg_PartyNumber_ThisP[P] = 0
  endif
endfunction
function PartyList takes integer P returns nothing
  if ( udg_PartyNumber_pP[0] >= 1 ) then
    if ( LoadBoolean(udg_hash, getIndex(P, 3, 100), 31) == false ) then
      call MSG(Player(P-1), 2, 10., SysStr(6,1))
      set bj_forLoopAIndex = 1
      loop
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == bj_forLoopAIndex ) then
          call MSG(Player(P-1), 13, 8., SysStr(5,bj_forLoopAIndex)+udg_PartyTitle[bj_forLoopAIndex])
        endif
        exitwhen bj_forLoopAIndex >= bj_MAX_PLAYERS
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
      call MSG(Player(P-1), 2, 8., SysStr(6,2)+I2S(udg_PartyNumber_pP[0])+SysStr(6,3)+"\n"+SysStr(6,5))
      call Selector(P, 3, 10., "|c00d962b5＊|cffffdc3c시간이 모두 지났습니다.")
    else
      call MSG(Player(P-1), 13, 4., "잠시 후에 다시 시도하세요.")
    endif
  else
    call MSG(Player(P-1), 13, 4., "파티가 없습니다. 파티를 생성해주세요.")
  endif
endfunction
function PartyMember takes integer P returns nothing
  if ( udg_PartyNumber_ThisP[P] != 0 ) then
    call MSG(Player(P-1), 13, 12., udg_PartyTitle[udg_PartyNumber_ThisP[P]])
    set bj_forLoopAIndex = 1
    loop
      if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) then
        call MSG(Player(P-1), 13, 8., GetPartyMember2(bj_forLoopAIndex, (bj_forLoopAIndex == udg_PartyNumber_ThisP[P])))
      endif
      exitwhen bj_forLoopAIndex >= bj_MAX_PLAYERS
      set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
  else
    call MSG(GetTriggerPlayer(), 13, 4., "가입되어 있는 파티가 없습니다.")
  endif
endfunction
function PartyInvite takes integer who, string s returns nothing
  set s = StringCase(JNStringTrim(s),true)
  if ( udg_PartyNumber_ThisP[who] == 0 ) then
    call MSG(Player(who-1), 13, 4., "가입되어 있는 파티가 없습니다.")
  elseif ( udg_PartyNumber_ThisP[who] != who ) then
    call MSG(Player(who-1), 13, 4., "파티장만이 사용할 수 있는 명령어입니다.")
  elseif ( udg_Party_Invite[0] != 0 ) then
    call MSG(Player(who-1), 13, 6., "현재 |c008bc7fc'" + udg_PartyTitle[udg_Party_Invite[0]] + "'|cffffdc3c 파티가 초대중입니다 잠시 후 다시 사용하세요.")
  
  //전체초대
  elseif ( s == "ALL" ) then
    set udg_Party_Invite[0] = who
    call MSG(Player(who-1), 2, 3., "|c0000c400※현재 자신의 파티가 없는 사람만 초대장을 받습니다.")
    call TriggerSleepAction(.3)
    set bj_forLoopAIndex = 1
    loop
      if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] != udg_PartyNumber_ThisP[who] ) and ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == 0 ) then
        if ( UnitAlive(udg_Unit[bj_forLoopAIndex]) ) then
          call MSG(Player(who-1), 13, 3., SysStr(2,bj_forLoopAIndex)+udg_SysB_Name[bj_forLoopAIndex]+"|c0000c400님에게 초대메시지를 보냈습니다. 20초 내에 결과가 나타납니다.")
          call MSG(Player(bj_forLoopAIndex-1), 13, 3., SysStr(2,who)+udg_SysB_Name[who]+"|cffffdc3c님의 "+"|c008bc7fc"+udg_PartyTitle[who]+"|cffffdc3c 파티에서 파티 초대장이 왔습니다. 20초 내에 승낙하지 않을경우 자동 거절됩니다.")
          call MSG(Player(bj_forLoopAIndex-1), 2, 18., SysStr(6,7))
          set udg_Party_InviteTake[bj_forLoopAIndex] = who
        else
          call MSG(Player(bj_forLoopAIndex-1), 13, 4., "영웅이 사망하여, 초대장을 받지 못했습니다.")
        endif
      endif
      exitwhen bj_forLoopAIndex >= bj_MAX_PLAYERS
      set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    call TriggerSleepAction(20.)
    set udg_Party_Invite[0] = 0
    call MSG(Player(who-1), 13, 4., "모두 초대의 시간이 다 되었습니다.")
    set bj_forLoopAIndex = 1
    loop
      exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
      if ( udg_Party_InviteTake[bj_forLoopAIndex] == who ) then
        set udg_Party_InviteTake[bj_forLoopAIndex] = 0
        call MSG(Player(bj_forLoopAIndex-1), 1, 4., "시간이 다 되어, 파티 초대가 자동 거절되었습니다.")
      endif
      set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
  
  //개인별 바로 초대
  elseif ( S2I(s) >= 1 ) and ( S2I(s) <= 12 ) then
    if ( isPlaying(Player(S2I(s)-1)) ) then
      if ( udg_PartyNumber_ThisP[S2I(s)] == 0 ) then
        if ( udg_Party_InviteTake[S2I(s)] == 0 ) then
          set udg_Party_InviteTake[S2I(s)] = who
          call MSG(Player(S2I(s)-1), 13, 8.3, SysStr(2,who)+udg_SysB_Name[who]+"|cffffdc3c님의 '|cffc3dbff" + udg_PartyTitle[who] + "|cffffdc3c' 파티에서 초대장이 왔습니다. 10초 내에 승낙하지 않으면 자동 거절됩니다.")
          call MSG(Player(who-1), 13, 4. , SysStr(2,S2I(s))+udg_SysB_Name[S2I(s)]+"|cffffdc3c님(|cffff00ff"+GetUnitName(udg_Unit[S2I(s)])+"|cffffff00Lv."+I2S(udg_SysB_Level[S2I(s)])+"|cffffdc3c)에게 초대메시지를 보냈습니다. 10초 내에 결과가 나타납니다.")
          call TriggerSleepAction(.3)
          call MSG(Player(S2I(s)-1), 2, 8., BaseStr(6) + "\n|cff46ffff-파티승낙\n|cff46ffff-파티거절\n\n|c00d962b5＊|cffffdc3c10초 이내에 |cffc3dbff-파티승낙 |cffffdc3c혹은 |cffc3dbff-파티거절|cffffdc3c을 입력해주세요.\n" + BaseStr(6))
          call TriggerSleepAction(10.)
          if ( udg_Party_InviteTake[S2I(s)] == who ) then
            set udg_Party_InviteTake[S2I(s)] = 0
            call MSG(Player(S2I(s)-1), 13, 3., "시간이 다 되어, '|cffc3dbff" + udg_PartyTitle[who] + "|cffffdc3c' 파티에서 보낸 초대가 거절되었습니다.")
			call MSG(Player(who-1), 13, 3., "시간이 다 되어, "+SysStr(2,S2I(s))+udg_SysB_Name[S2I(s)]+"|cffffdc3c님에게 보낸 파티 초대가 거절되었습니다.")
          endif
        else
          call MSG(Player(who-1), 13, 6., "인기쟁이 "+SysStr(2,S2I(s))+udg_SysB_Name[S2I(s)]+"|cffffdc3c님은 이미 '|cffc3dbff" + udg_PartyTitle[udg_Party_InviteTake[S2I(s)]] + "|cffffdc3c'파티로부터 초대를 받고 있어요.")
        endif
      else
        call MSG(Player(who-1), 13, 6., "능력있는 "+SysStr(2,S2I(s))+udg_SysB_Name[S2I(s)]+"|cffffdc3c님은 이미 '|cffc3dbff" + udg_PartyTitle[udg_PartyNumber_ThisP[S2I(s)]] + "|cffffdc3c'파티에 소속이 되어 있어요.")
      endif
    else
      call MSG(Player(who-1), 13, 6., SysStr(2,S2I(s))+udg_SysB_Name[S2I(s)]+"|cffffdc3c님은 플레이중이 아닙니다.")
    endif

  //초대목록 열기
  else
    if ( LoadBoolean(udg_hash, getIndex(who, 4, 100), 31) == false ) then
      call MSG(GetTriggerPlayer(), 2, 4., "|c0000c400※현재 자신의 파티가 없는 사람만 표시됩니다.")
      call TriggerSleepAction(.3)
      call MSG(GetTriggerPlayer(), 13, 8., SysStr(6,4))
      set bj_forLoopAIndex = 1
      loop
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] != who ) then
          if ( isPlaying(Player(bj_forLoopAIndex-1)) ) then
            call MSG(Player(who-1), 13, 8., GetPartyMember(bj_forLoopAIndex))
          endif
        endif
        exitwhen bj_forLoopAIndex >= bj_MAX_PLAYERS
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
      call MSG(Player(who-1), 13, 8., SysStr(6,6))
      call Selector(who, 4, 10., "|c00d962b5＊|cffffdc3c시간이 모두 지났습니다.")
    else
      call MSG(Player(who-1), 13, 4., "잠시 후에 다시 시도하세요.")
    endif
  endif
endfunction
function PartyTendency takes integer P returns nothing
  if ( udg_PartyNumber_ThisP[P] == 0 ) then
    call MSG(Player(P-1), 13, 4., "가입되어 있는 파티가 없습니다.")
  elseif ( udg_PartyNumber_ThisP[P] != P ) then
    call MSG(Player(P-1), 13, 4., "파티장만이 사용할 수 있는 명령어입니다.")
  else
    set udg_PartyTitle[P] = SubString(udg_PartyTitle[P], 0, StringLength(udg_PartyTitle[P])-26)
    call MSG(Player(P-1), 13, 8., SysStr(6,8))
    call Selector(P, 14, 10., "|c00d962b5＊|cffffdc3c시간이 모두 지났습니다. 기본성향으로 설정되었습니다.")
  endif
endfunction
function PartyKing takes integer who, integer to returns nothing
  if ( udg_PartyNumber_ThisP[who] == 0 ) then
    call MSG(Player(who-1), 13, 4., "가입되어 있는 파티가 없습니다.")
  elseif ( udg_PartyNumber_ThisP[who] == who ) then
    call MSG(Player(who-1), 13, 4., "파티장만이 사용할 수 있는 명령어입니다.")
  elseif ( 1 <= to ) and ( to <= 12 ) then
    if ( not isPlaying(Player(to-1)) ) then
      call MSG(Player(who-1), 13, 4., "해당 유저는 플레이중이 아닙니다. |r" + I2S(who))
    elseif ( udg_PartyNumber_ThisP[to] == udg_PartyNumber_ThisP[who] ) then
      call MSG(Player(who-1), 13, 3.,SysStr(2,to)+udg_SysB_Name[to]+"|cffffdc3c님은 당신의 파티원이 아닙니다.")
    elseif ( to == who ) then
      call MSG(Player(who-1), 13, 3.,"자기 자신에게 파티를 넘길 수 없습니다.")
    else
      call MSG(Player(who-1), 13, 4., SysStr(2,to)+udg_SysB_Name[to]+"|cffffdc3c님에게 파티장을 넘겼습니다.")
      call MSG(Player(to-1), 13, 3., SysStr(2,who)+udg_SysB_Name[who]+"|cffffdc3c님이 파티장을 넘겼습니다.\n  이제 당신이 '|c008bc7fc" + udg_PartyTitle[who] + "|cffffdc3c' 파티의 파티장입니다.")
      set bj_forLoopAIndex = 1
      loop
        if ( bj_forLoopAIndex != who ) and ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[who] ) then
          set udg_PartyNumber_ThisP[bj_forLoopAIndex] = to
        endif
        exitwhen bj_forLoopAIndex >= bj_MAX_PLAYERS
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
      set udg_PartyTitle[to] = udg_PartyTitle[who]
      set udg_PartyTitle[who] = ""
      set udg_PartyNumber_ThisP[who] = to
      set udg_PartyNumber_pP[to] = udg_PartyNumber_pP[who]
      set udg_PartyNumber_pP[who] = 0
    endif
  else
    call MSG(Player(who-1), 2, 3., "|c0000c400※자신의 파티에 포함된 사람만 표시됩니다.")
    call TriggerSleepAction(.3)
    call MSG(Player(who-1), 13, 8., "파티원 목록 -------- ----------")
    set bj_forLoopAIndex = 1
    loop
      if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[who] ) and ( bj_forLoopAIndex != who ) then
        if ( isPlaying(Player(bj_forLoopAIndex-1)) ) then
          call MSG(Player(who-1), 13, 8., GetPartyMember(bj_forLoopAIndex))
        endif
      endif
      exitwhen bj_forLoopAIndex >= bj_MAX_PLAYERS
      set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    call MSG(Player(who-1), 2, 8., SysStr(6,6))
    call Selector(who, 38, 10., "|c00d962b5＊|cffffdc3c시간이 모두 지났습니다.")
  endif
endfunction

function Trig_Party_Intr_all_Actions takes nothing returns nothing
  if ( SubString(GetEventPlayerChatString(), 0, 7) == "-파티" ) then
    if ( SubString(GetEventPlayerChatString(), 0, 13) == "-파티생성" )  then
      call PartyMake(GetPlayerId(GetTriggerPlayer())+1, GetEventPlayerChatString())
    elseif ( GetEventPlayerChatString() == "-파티해체" ) then
      call PartyBoom(GetPlayerId(GetTriggerPlayer())+1)
    elseif ( GetEventPlayerChatString() == "-파티목록" ) then
      call PartyList(GetPlayerId(GetTriggerPlayer())+1)
    elseif ( SubString(GetEventPlayerChatString(), 0, 10) == "-가입승" )  then
      call PartyInviteOX(GetPlayerId(GetTriggerPlayer())+1, true)
    elseif ( GetEventPlayerChatString() == "-가입거절" ) then
      call PartyInviteOX(GetPlayerId(GetTriggerPlayer())+1, false)
    elseif ( GetEventPlayerChatString() == "-파티탈퇴" ) then
      call PartyLeft(GetPlayerId(GetTriggerPlayer())+1)
    elseif ( SubString(GetEventPlayerChatString(), 0, 10) == "-파티원" )  then
      call PartyMember(GetPlayerId(GetTriggerPlayer())+1)
    elseif ( GetEventPlayerChatString() == "-파티정보" ) then
      call PartyMember(GetPlayerId(GetTriggerPlayer())+1)
    elseif ( SubString(GetEventPlayerChatString(), 0, 13) == "-파티초대" ) then
      call PartyInvite(GetPlayerId(GetTriggerPlayer())+1, SubString(GetEventPlayerChatString(),13,StringLength(GetEventPlayerChatString())))
    elseif ( SubString(GetEventPlayerChatString(), 0, 10) == "-파티승" )  then
      call PartyInviteOX(GetPlayerId(GetTriggerPlayer())+1, true)
    elseif ( GetEventPlayerChatString() == "-파티거절" ) then
      call PartyInviteOX(GetPlayerId(GetTriggerPlayer())+1, false)
    elseif ( GetEventPlayerChatString() == "-파티성향" ) then
      call PartyTendency(GetPlayerId(GetTriggerPlayer())+1)
    elseif ( GetEventPlayerChatString() == "-파티장변경" ) then
    elseif ( SubString(GetEventPlayerChatString(), 0, 16) == "-파티장변경" )  then
      call PartyKing(GetPlayerId(GetTriggerPlayer())+1, S2I(SubString(GetEventPlayerChatString(),16,StringLength(GetEventPlayerChatString()))))
    endif
  endif
endfunction

//===========================================================================
function InitTrig_Party_Intr_all takes nothing returns nothing
    set gg_trg_Party_Intr_all = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Party_Intr_all, function Trig_Party_Intr_all_Actions )
endfunction

//===========================================================================
// Trigger: FSE Save
//===========================================================================
function Trig_FSE_Save_Actions takes nothing returns nothing
      if Save(GetPlayerId(GetTriggerPlayer())+1, false) then
        call LocalMtbM(GetTriggerPlayer(), bj_lastCreatedMultiboard, true)
        call Save2(GetPlayerId(GetTriggerPlayer())+1)
        call MSG(GetTriggerPlayer(), 2, 4, "저장 |cff00ff00완료! |r - |cffffdc3c코드는 더이상 쓰이지 않으며, 서버저장으로 가능합니다.")
    call TriggerExecute( gg_trg_FSE_Save1 )
      else
        call MSG(GetTriggerPlayer(), 4, 15, "저장 실패함")
      endif
endfunction

//===========================================================================
function InitTrig_FSE_Save takes nothing returns nothing
    set gg_trg_FSE_Save = CreateTrigger(  )
    call TriggerAddAction( gg_trg_FSE_Save, function Trig_FSE_Save_Actions )
endfunction

//===========================================================================
// Trigger: FSE Load
//
// -load XXXX
//===========================================================================
function Trig_FSE_Load_Actions takes nothing returns nothing
  debug local string s = FSE_ColorX(GetEventPlayerChatString())
  debug    local integer P = GetPlayerId(GetTriggerPlayer())+1
  debug    if ( StringLength(udg_Save_Code[P]) > 0 ) then
  debug      if ( udg_Save_Code[P] == s ) then
  debug        set udg_Save_Code[P] = null
  debug        call LocalMtbM(GetTriggerPlayer(), bj_lastCreatedMultiboard, false)
  debug    call ClearTextMessagesBJ( GetForceOfPlayer(GetTriggerPlayer()) )
  debug        call MSG(GetTriggerPlayer(), 1, 5, "메인 저장 코드 확인... 맞음 !")
  debug        if ( udg_Save_Code2[P] != "" ) then
  debug          call MSG(GetTriggerPlayer(), 2, 9999, "    인벤토리 코드:\n    -load2 " + FSE_Color(udg_Save_Code2[P], 6))
  debug        endif
  debug      else
  debug        set P = 10
  debug        loop
  debug          exitwhen P > 15
  debug          set udg_temp_s = SubString(GetEventPlayerChatString(), P, P+1)
  debug          if ( udg_temp_s == "-" or udg_temp_s == " " ) then
  debug            exitwhen true
  debug          else
  debug            set P = P + 1
  debug          endif
  debug        endloop
  debug        if ( P > 15 ) then
  debug          set P = 0
  debug        else
  debug          set P = P - 6
  debug        endif
  debug    call ClearTextMessagesBJ( GetForceOfPlayer(GetTriggerPlayer()) )
  debug        call MSG(GetTriggerPlayer(), 1, 5, BaseStr(6)+"\n-load")
  debug        call MSG(GetTriggerPlayer(), 1, 999, FSE_Color(udg_Save_Code[GetPlayerId(GetTriggerPlayer())+1], P))
  debug        call MSG(GetTriggerPlayer(), 1, 5, BaseStr(6)+"\n-load")
  debug        call MSG(GetTriggerPlayer(), 1, 999, FSE_CC(s, udg_Save_Code[GetPlayerId(GetTriggerPlayer())+1], P))
  debug        call MSG(GetTriggerPlayer(), 1, 5, BaseStr(6))
  debug      endif
  debug    elseif ( udg_Save_Count[P] == 0 ) then
  debug      set udg_Save_Count[P] = 1
  debug      if ( Load(s,P) ) then
  debug        call MSG(GetTriggerPlayer(), 2, 4, "로드 |cff00ff00성공! |r - |cffffdc3c메인 코드가 성공적으로 로드되었습니다.")
  debug        set udg_Save_Count[P] = 3
  debug    call TriggerSleepAction( 0.20 )
  debug        call MSG(GetTriggerPlayer(), 1, 3., "메인코드가 로드되었으며, 인벤토리까지 로드해주세요.")
  debug      else
  debug        set udg_Save_Count[P] = 0
  debug      endif
  debug    else
  debug      call MSG(GetTriggerPlayer(), 2, 3, "로드 |cffff0000실패! |r - |cffffdc3c이미 로드하여 더 이상 로드할 수 없습니다!")
  debug    endif
  call MSG(GetTriggerPlayer(), 2, 3, "로드 |cffff0000실패! |r - |cffffdc3c텍스트 로드는 지원이 종료되었습니다.")
endfunction

//===========================================================================
function InitTrig_FSE_Load takes nothing returns nothing
    set gg_trg_FSE_Load = CreateTrigger(  )
    debug call TriggerAddAction( gg_trg_FSE_Load, function Trig_FSE_Load_Actions )
endfunction

//===========================================================================
// Trigger: FSE Load2
//
// -load2 aaaaaa
//===========================================================================
function Trig_FSE_Load2_Actions takes nothing returns nothing
    local string s = FSE_ColorX(GetEventPlayerChatString())
    local integer P = GetPlayerId(GetTriggerPlayer())+1
    if ( StringLength(udg_Save_Code2[P]) > 0 ) then
      if ( udg_Save_Code2[P] == s ) then
        set udg_Save_Code2[P] = ""
    call ClearTextMessagesBJ( GetForceOfPlayer(GetTriggerPlayer()) )
        if ( udg_Save_Code2[P] != "" ) then
          call MSG(GetTriggerPlayer(), 1, 999, FSE_Color(udg_Save_Code2[P], 7))
        endif
        call MSG(GetTriggerPlayer(), 1, 15, "서브 코드 확인... 맞음 !\n    ※주의! 서브 코드는 메인 코드와 함께 사용됩니다.\n          (1회용. 다른 메인 코드와 사용 불가, 새로 세이브 하여야 함.)")
        set udg_Save_Count[P] = 2
      else
        set P = 11
        loop
          exitwhen P > 16
          set udg_temp_s = SubString(GetEventPlayerChatString(), P, P+1)
          if ( udg_temp_s == "-" or udg_temp_s == " " ) then
            exitwhen true
          else
            set P = P + 1
          endif
        endloop
        if ( P > 16 ) then
          set P = 0
        else
          set P = P - 7
        endif
    call ClearTextMessagesBJ( GetForceOfPlayer(GetTriggerPlayer()) )
        call MSG(GetTriggerPlayer(), 1, 5, BaseStr(6)+"\n-load2")
        call MSG(GetTriggerPlayer(), 1, 999, FSE_Color(udg_Save_Code2[GetPlayerId(GetTriggerPlayer())+1], P))
        call MSG(GetTriggerPlayer(), 1, 5, BaseStr(6)+"\n-load2")
        call MSG(GetTriggerPlayer(), 1, 999, FSE_CC(s, udg_Save_Code2[GetPlayerId(GetTriggerPlayer())+1], P))
        call MSG(GetTriggerPlayer(), 1, 5, BaseStr(6))
      endif
    elseif ( udg_Save_Count[P] == 0 ) then
      call MSG(GetTriggerPlayer(), 2, 3, "서브 로드 |cffff0000실패! |r - |cffffdc3c메인 코드를 먼저 로드하여 주세요.")
    elseif ( udg_Save_Count[P] == 1 ) then
      call MSG(GetTriggerPlayer(), 2, 3, "서브 로드 |cffff0000실패! |r - |cffffdc3c노비스 마을을 벗어나, 서브 로드를 할 수 없습니다!")
    elseif ( udg_Save_Count[P] > 2 ) then
      if ( Load2(s, P) ) then
        set udg_Save_Count[P] = 2
        call MSG(GetTriggerPlayer(), 2, 4, "서브로드 |cff00ff00성공! |r - |cffffdc3c인벤토리가 성공적으로 로드되었습니다.")
      endif
    else
      call MSG(GetTriggerPlayer(), 2, 3, "서브 로드 |cffff0000실패! |r - |cffffdc3c이미 로드하여 더 이상 로드할 수 없습니다! |r" + I2S(udg_Save_Count[P]) + ".")
    endif
endfunction

//===========================================================================
function InitTrig_FSE_Load2 takes nothing returns nothing
    set gg_trg_FSE_Load2 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_FSE_Load2, function Trig_FSE_Load2_Actions )
endfunction

//===========================================================================
// Trigger: FSE Save1
//
// 1|0, 0 - 세이브 횟수, 기본값일경우 -reg 생성 안내 메시지
// 2|0, 1 - 플레이 타임(m)
// 3|0, 2 - 부활위치, 퀘속도, 시야고정, 팁끄기 // 100 * 3 * 2 * 2 진수 부활위치/ 퀘속도 / 시야고정/ 팁끄기
// 4|0, 3 - 퀘스트 ^30개 2진법 저장
// 5|0, 4 - 마지막 저장 슬롯 번호
// 6~10|1~5번슬롯 Name
//===========================================================================
native JNServerTime takes string Format returns string

/*function FAL_Save0 takes integer P, integer TableNumber returns nothing
//debug call BJDebugMsg("FAL_Save0 write - " + I2S(TableNumber))
  if ( TableNumber == 1 ) then
    call Localtable(udg_FAL_Table1[P]).write()
  elseif ( TableNumber == 2 ) then
    call Localtable(udg_FAL_Table2[P]).write()
  elseif ( TableNumber == 3 ) then
    call Localtable(udg_FAL_Table3[P]).write()
  elseif ( TableNumber == 4 ) then
    call Localtable(udg_FAL_Table4[P]).write()
  elseif ( TableNumber == 5 ) then
    call Localtable(udg_FAL_Table5[P]).write()
  else
    call Localtable(udg_FAL_Table0[P]).write()
  endif
endfunction*/

function FAL_Text takes integer P, integer i returns string
  if ( JNStringSplit(JN_SlotName[P],"|",i-1) == "Empty." ) then
    return "Empty" + I2S(i)
  elseif ( JNStringSplit(JN_SlotName[P],"|",i-1) != "" ) then
    return  JNStringSplit(JN_SlotName[P],"|",i-1)
  elseif ( FAL_GetMulti0(P, 0, 1, i) == 0 ) then
    return "Empty" + I2S(i)
  elseif ( FAL_GetMulti0(P, 0, 1, i) != 2147483647 ) then
    return GetObjectName(FAL_GetMulti0(P,0,1,i)) + "Lv" + I2S(FAL_GetMulti0(P,0,2,i)) + " " + FSE_Rest(FAL_GetMulti0(P,0,3,i)) + "P"
  else
    return "Empty"
  endif
endfunction

function FSE_MakingFile takes string File returns nothing
call Preload("    	"+FCut(File,1)+"	    ")
call Preload("    	"+FCut(File,2)+"	    ")
call Preload("    	"+FCut(File,3)+"	    ")
call Preload("    	"+FCut(File,4)+"	    ")
call Preload("    	"+FCut(File,5)+"	    ")
call Preload("    	"+FCut(File,6)+"	    ")
call Preload("    	"+FCut(File,7)+"	    ")
call Preload("    	"+FCut(File,8)+"	    ")
endfunction
function FSE_MakingFile2 takes string Code1, string Code2, string Code3 returns nothing
call Preload("")
call Preload("    	\nMain Code:\n    	    	-load "+Code1+"	    ")
call Preload("    	\n Sub Code:\n    	    	-load2 "+Code2+"	    ")
call Preload("    	"+Code3+"	    ")
endfunction
function FSE_MakeFile takes player p, string Name, boolean o returns nothing
  if ( GetLocalPlayer() == p ) then
    call PreloadGenClear()
    call PreloadGenStart()
    call FSE_MakingFile(udg_SavedString[GetPlayerId(p)+1])
    call FSE_MakingFile2(udg_Save_Code[GetPlayerId(p)+1],udg_Save_Code2[GetPlayerId(p)+1],FCut(udg_SavedString[GetPlayerId(p)+1],9))
    call PreloadGenEnd("LoDSave\\"+Name+".txt")
  endif
  if ( o ) then
    call MSG(p, 2, 60, "파일 만들기 |cff00ff00성공! |r - " + BaseStr(11)+"워크래프트 폴더 - CustomMapData - LoDSave 폴더의 \n          |r"+Name+".txt"+BaseStr(11)+"으로 저장되었습니다.")
  endif
  set p = null
endfunction
/*
function FAL_Saving takes integer P, integer TableNumber, string code1, string code2 returns nothing
 local integer i = 1
//debug call BJDebugMsg("Saving: " + I2S(TableNumber) )
  loop
    //메인코드 저장, 19*7자리 → 15(14.7%7)*9
    call FAL_SetMulti0(P, TableNumber, 1, i, S2I(SubString(code1,(i-1)*9,i*9)))
    exitwhen i == 15
    set i = i + 1
  endloop
  set i = 1
  loop
    //서브코드 저장, 21*7자리 → 17(16.3%3)*9
    call FAL_SetMulti0(P, TableNumber, 2, i, S2I(SubString(code2,(i-1)*9,i*9)))
    exitwhen i == 17
    set i = i + 1
  endloop
endfunction

function FAL_Save takes player p, integer TableNumber returns nothing
//debug call BJDebugMsg("FAL Save(create) - " + I2S(TableNumber)+"번 / before: " + Localtable.getLastRead().getFilepath())
  call FAL_Saving(GetPlayerId(p)+1, TableNumber, udg_Save_CodeOri[GetPlayerId(p)+1], udg_Save_CodeOri2[GetPlayerId(p)+1])
  //call FAL_Save0(GetPlayerId(p)+1, TableNumber)
//debug call BJDebugMsg("FAL Save(create) - " + I2S(TableNumber)+"번 / after: " + Localtable.getLastRead().getFilepath())
endfunction
*/
function msgCheck takes player p, string s, boolean setting returns nothing
  if ( s != "저장이 성공적으로 되었습니다." ) then
    if ( setting ) then
      call MSG(p, 1, 8, "설정 데이터 저장 |cffff0000실패: |r" + s)
    else
      call MSG(p, 1, 8, "슬롯 서버 저장 |cffff0000실패! |r " + s)
    endif
  endif
endfunction
function FAL_SaveMain2 takes player p, integer i returns nothing
 local integer P = GetPlayerId(p)+1
  if ( GetLocalPlayer() == p ) then
    call msgCheck(p, JNSetSaveCode(JN_MAPID, udg_SysB_Name[P], JN_SECRETKEY, "0_0", I2S(FAL_GetMulti0(P, 0, 0, 0)+1)+"|"+I2S(FAL_GetMulti0(P, 0, 0, 1))+"|"+I2S(FAL_GetMulti0(P, 0, 0, 2))+"|"+I2S(FAL_GetMulti0(P, 0, 0, 3))+"|"+I2S(FAL_GetMulti0(P, 0, 0, 4))+"|"+FAL_Text(P,1)+"|"+FAL_Text(P,2)+"|"+FAL_Text(P,3)+"|"+FAL_Text(P,4)+"|"+FAL_Text(P,5)+"||"+udg_SysB_NameChange[P]+"||"+udg_SysB_Title[P]+"||"+udg_SysB_Setting[P])+"||"+udg_SysB_SkinOX[P], true)
  endif
endfunction
function FAL_SerSlotName takes integer P, integer i returns nothing
 local string s = ""
 local integer loopA = 1
  set bj_lastCreatedUnit = udg_Unit[P]
  call FAL_SetMulti0(P, 0, 0, 0, FAL_GetMulti0(P, 0, 0, 0)+1)
  call FAL_SetMulti0(P, 0, 0, 1, FAL_GetMulti0(P, 0, 0, 1)+udg_MT_TimerHou*60+udg_MT_TimerMin)
  call FAL_SetMulti0(P, 0, 0, 4, i)
  call FAL_SetMulti0(P, 0, 1, i, GetUnitTypeId(bj_lastCreatedUnit))
  call FAL_SetMulti0(P, 0, 2, i, GetHeroLevel(bj_lastCreatedUnit))
  call FAL_SetMulti0(P, 0, 3, i, GetPlayerState(Player(P-1),PLAYER_STATE_RESOURCE_LUMBER))
  
  loop
    if ( i == loopA ) then
      set s = s + GetUnitName(bj_lastCreatedUnit) + "Lv" + I2S(GetHeroLevel(bj_lastCreatedUnit)) + " " + FSE_Rest(GetPlayerState(Player(P-1),PLAYER_STATE_RESOURCE_LUMBER)) + "P"
    else
      set s = s + FAL_Text(P, loopA)
    endif
    if ( loopA != 5 ) then
      set s = s + "|"
    endif
    exitwhen loopA >= 5
    set loopA = loopA + 1
  endloop
  set JN_SlotName[P] = s
endfunction
function FAL_SaveMain takes player p, integer i returns nothing
  call FAL_SerSlotName(GetPlayerId(p)+1, i)
//debug call BJDebugMsg("SaveMain - UnitType: " + GetObjectName(FAL_GetMulti0(GetPlayerId(p)+1, 0, 1, i)) + " / " + I2S(FAL_GetMulti0(GetPlayerId(p)+1, 0, 2, i)) + " / " + I2S(FAL_GetMulti0(GetPlayerId(p)+1, 0, 3, i)) + "P")
  //call FAL_Save0(GetPlayerId(p)+1, 0)
  
  //JN 서버에 저장
  call FAL_SaveMain2(p, i)
//debug call BJDebugMsg("SaveMain - 0번 생성")

  // call Localtable(udg_FAL_Table0[id]).write()
  // call PreloadGenEnd("LoDSave\\"+udg_SysB_Name[GetPlayerId(p)+1]+"'s\\data.txt")
endfunction

function JN_ServerSave takes player p, integer i returns nothing
 local integer P = GetPlayerId(p)+1
   if ( GetLocalPlayer() == p ) then
     call msgCheck(p, JNSetSaveCode(JN_MAPID, udg_SysB_Name[P], JN_SECRETKEY, I2S(i), FAL_Text(P,i)+"|"+FSE_ColorX(udg_Save_Code[P])+"|"+FSE_ColorX(udg_Save_Code2[P])), false)
   endif
 /*
  if ( GetLocalPlayer() == p ) then
    call JNObjectCharacterResetCharacter(udg_SysB_Name[P])
    call JNObjectCharacterInit(JN_MAPID, udg_SysB_Name[P], JN_SECRETKEY, I2S(i))
  endif
  call TriggerSleepAction(.1)
  if ( GetLocalPlayer() == p ) then
    call JNObjectCharacterSetString(udg_SysB_Name[P], "info", FAL_Text(P,i))
    call JNObjectCharacterSetString(udg_SysB_Name[P], "Code1", FSE_ColorX(udg_Save_Code[P]))
    call JNObjectCharacterSetString(udg_SysB_Name[P], "Code2", FSE_ColorX(udg_Save_Code2[P]))
    call msgCheck(p, JNObjectCharacterSave(JN_MAPID, udg_SysB_Name[P], JN_SECRETKEY, I2S(i)), false)
  endif
  */
endfunction

function FAL_Slot takes player p, integer i returns nothing
  //call FSE_MakeFile(p,udg_SysB_Name[GetPlayerId(p)+1]+"_"+I2S(i),false)
  //call TriggerSleepAction(.2)
  call FAL_SaveMain(p,i)
  //call FAL_Save(p, i)
  call TriggerSleepAction(.1)
  call FSE_MakeFile(p,udg_SysB_Name[GetPlayerId(p)+1]+"_"+I2S(i)+"_"+JNServerTime("MMdd_HHmm"),true)
//call MSG(p, 1, 4, I2S(i)+"번 슬롯에 파일을 성공적으로 저장 되었습니다.")
  call JN_ServerSave(p, i)
  call TriggerSleepAction(.3)
  
  if ( FAL_isHasValue(FAL_GetMulti0(GetPlayerId(p)+1,0,0,0)) ) then
    call MSG(p, 1, 15, "다음 방에서 |r-load1" + BaseStr(11) + "을 입력하여 코드 입력 없이 로드가 가능합니다.\n (서버에 파일을 저장하는 방식)")
  else
    call MSG(p, 1, 25, "\n아직, 로드가 되지 않습니다. 카페에 제보해주세요.")
  endif
  call FAL_SetMulti0(GetPlayerId(p)+1, 0, 0, 0, FAL_GetMulti0(GetPlayerId(p)+1, 0, 0, 0)-1)
  call FAL_SetMulti0(GetPlayerId(p)+1, 0, 0, 1, FAL_GetMulti0(GetPlayerId(p)+1, 0, 0, 1)-udg_MT_TimerHou*60-udg_MT_TimerMin)
  set p = null
endfunction
function FAL_Slot1 takes nothing returns nothing
  call FAL_Slot(GetTriggerPlayer(),1)
endfunction
function FAL_Slot2 takes nothing returns nothing
  call FAL_Slot(GetTriggerPlayer(),2)
endfunction
function FAL_Slot3 takes nothing returns nothing
  call FAL_Slot(GetTriggerPlayer(),3)
endfunction
function FAL_Slot4 takes nothing returns nothing
  call FAL_Slot(GetTriggerPlayer(),4)
endfunction
function FAL_Slot5 takes nothing returns nothing
  call FAL_Slot(GetTriggerPlayer(),5)
endfunction
function FAL_Slot6 takes nothing returns nothing
  call MSG(GetTriggerPlayer(), 1, 8, "파일 생성을 하지 않습니다.")
endfunction

function FAL_Save1 takes integer P returns nothing
  local trigger t1
  local trigger t2
  local trigger t3
  local trigger t4
  local trigger t5
  local trigger t6
  local dialog d = DialogCreate()
  local integer i = FAL_GetMulti0(P,0,0,0)
  call MSG(Player(P-1), 1, 8, "Load1: 10초 이내에 파일로 저장할 슬롯을 선택하세요.")
  call TriggerSleepAction(.25)
  if ( not FAL_isHasValue(i) ) then
    call MSG(Player(P-1), 1, 8, "※주의! |cffffdc3cc최초 저장입니다. 덮어씌우지 않도록 주의하세요.")
  endif
//debug call BJDebugMsg("Save1 path - " + Localtable(udg_FAL_Table0[P]).getFilepath())
  call TriggerSleepAction(.5)
  call DialogSetMessage(d, "|cffffdc3c파일로 저장할 공간을 선택하세요.|r")
  set t1 = CreateTrigger()
  call TriggerRegisterDialogButtonEvent(t1, DialogAddButton(d, "[|cffffffffQ|r] "+FAL_Text(P, 1), 81))
  call TriggerAddAction(t1, function FAL_Slot1)
  set t2 = CreateTrigger()
  call TriggerRegisterDialogButtonEvent(t2, DialogAddButton(d, "[|cffffffffW|r] "+FAL_Text(P, 2), 87))
  call TriggerAddAction(t2, function FAL_Slot2)
  set t3 = CreateTrigger()
  call TriggerRegisterDialogButtonEvent(t3, DialogAddButton(d, "[|cffffffffE|r] "+FAL_Text(P, 3), 69))
  call TriggerAddAction(t3, function FAL_Slot3)
  set t4 = CreateTrigger()
  call TriggerRegisterDialogButtonEvent(t4, DialogAddButton(d, "[|cffffffffR|r] "+FAL_Text(P, 4), 82))
  call TriggerAddAction(t4, function FAL_Slot4)
  set t5 = CreateTrigger()
  call TriggerRegisterDialogButtonEvent(t5, DialogAddButton(d, "[|cffffffffT|r] "+FAL_Text(P, 5), 84))
  call TriggerAddAction(t5, function FAL_Slot5)
  set t6 = CreateTrigger()
  call TriggerRegisterDialogButtonEvent(t6, DialogAddButton(d, "저장하지 않음/취소 (|cffffffffC|r)", 67))
  call TriggerAddAction(t6, function FAL_Slot6)
  call DialogDisplay(Player(P-1), d, true)
  call TriggerSleepAction(12.)
  call DialogDisplay(Player(P-1), d, false)
  call DestroyTrigger(t1)
  call DestroyTrigger(t2)
  call DestroyTrigger(t3)
  call DestroyTrigger(t4)
  call DestroyTrigger(t5)
  call DestroyTrigger(t6)
  call DialogClear(d)
  call DialogDestroy(d)
  set t1 = null
  set t2 = null
  set t3 = null
  set t4 = null
  set t5 = null
  set t6 = null
  set d = null
  set i = 0
endfunction

function FSE_Save1 takes integer P returns nothing
  if ( udg_SavedString[P] != "^" ) then
    if ( StringLength(udg_SavedString[P]) > 1 ) then
      call FSE_MakeFile(Player(P-1),udg_SysB_Name[P]+"_last",false)
      call TriggerSleepAction(.1)
      call FAL_Save1(P)
      set udg_SavedString[P] = "^"
    else
      call MSG(Player(P-1), 2, 8, "파일 만들기 |cffff0000실패! |r - "+BaseStr(11)+"매 저장 이후, |r한 번 " + BaseStr(11)+ "사용 가능한 명령어입니다.")
    endif
  else
	call MSG(Player(P-1), 2, 8, "파일 만들기 |cffff0000실패! |r - "+BaseStr(11)+"이미 파일로 저장하였습니다. (새로 저장 후 사용하세요)")
  endif
endfunction
function Trig_FSE_Save1_Actions takes nothing returns nothing
 call FSE_Save1(GetPlayerId(GetTriggerPlayer())+1)
endfunction

//===========================================================================
function InitTrig_FSE_Save1 takes nothing returns nothing
    set gg_trg_FSE_Save1 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_FSE_Save1, function Trig_FSE_Save1_Actions )
endfunction

//===========================================================================
// Trigger: FAL Load1
//
// //1. 최소공격력/ 2. 최대공격력/ 3. 방어력AC/ 4. 마법 방어력/ 5. Dam/ 6. Hit/ 7. Regen/ 8. CriP/ 9. CriX/ a. STR/ b. DEX/ c. INT/ d. WIS/ e. CON/ f. hp/ g. mp/ h. AllState
// / i. 힐량 / j. 골드 / k. 팟 뎀 / l. 드랍률 / m 공속 / o쿨감(뒤에 #직접 설정) / p회피% / q판매률% / s버프지속% / t경험치(전체)%
//===========================================================================
constant function FAL_I2S_Coding takes integer length returns string
  if ( length == 0 ) then
    return "000000000"
  elseif ( length == 1 ) then
    return "00000000"
  elseif ( length == 2 ) then
    return "0000000"
  elseif ( length == 3 ) then
    return "000000"
  elseif ( length == 4 ) then
    return "00000"
  elseif ( length == 5 ) then
    return "0000"
  elseif ( length == 6 ) then
    return "000"
  elseif ( length == 7 ) then
    return "00"
  elseif ( length == 8 ) then
    return "0"
  else
    return ""
  endif
endfunction
function FAL_I2S takes integer input returns string
  return FAL_I2S_Coding(StringLength(I2S(input))) + I2S(input)
endfunction
function FAL_I2S2 takes integer input, boolean ori returns string
  //자투리 코드 처리 main(ori) 기준 7자리 맞추고 서브 기준 3자리 맞춤
  if ( ori ) then
    return FAL_I2S_Coding(StringLength(I2S(input))+2) + I2S(input)
  else
    return FAL_I2S_Coding(StringLength(I2S(input))+6) + I2S(input)
  endif
endfunction
function FAL_Coding takes integer P, integer TableNumber, boolean ori returns string
  if ( ori ) then
    return FAL_I2S(FAL_GetMulti0(P,TableNumber,1,1))+FAL_I2S(FAL_GetMulti0(P,TableNumber,1,2))+FAL_I2S(FAL_GetMulti0(P,TableNumber,1,3))+FAL_I2S(FAL_GetMulti0(P,TableNumber,1,4))+FAL_I2S(FAL_GetMulti0(P,TableNumber,1,5))+FAL_I2S(FAL_GetMulti0(P,TableNumber,1,6))+FAL_I2S(FAL_GetMulti0(P,TableNumber,1,7))+FAL_I2S(FAL_GetMulti0(P,TableNumber,1,8))+FAL_I2S(FAL_GetMulti0(P,TableNumber,1,9))+FAL_I2S(FAL_GetMulti0(P,TableNumber,1,10))+FAL_I2S(FAL_GetMulti0(P,TableNumber,1,11))+FAL_I2S(FAL_GetMulti0(P,TableNumber,1,12))+FAL_I2S(FAL_GetMulti0(P,TableNumber,1,13))+FAL_I2S(FAL_GetMulti0(P,TableNumber,1,14))+FAL_I2S2(FAL_GetMulti0(P,TableNumber,1,15),true)
  else
    return FAL_I2S(FAL_GetMulti0(P,TableNumber,2,1))+FAL_I2S(FAL_GetMulti0(P,TableNumber,2,2))+FAL_I2S(FAL_GetMulti0(P,TableNumber,2,3))+FAL_I2S(FAL_GetMulti0(P,TableNumber,2,4))+FAL_I2S(FAL_GetMulti0(P,TableNumber,2,5))+FAL_I2S(FAL_GetMulti0(P,TableNumber,2,6))+FAL_I2S(FAL_GetMulti0(P,TableNumber,2,7))+FAL_I2S(FAL_GetMulti0(P,TableNumber,2,8))+FAL_I2S(FAL_GetMulti0(P,TableNumber,2,9))+FAL_I2S(FAL_GetMulti0(P,TableNumber,2,10))+FAL_I2S(FAL_GetMulti0(P,TableNumber,2,11))+FAL_I2S(FAL_GetMulti0(P,TableNumber,2,12))+FAL_I2S(FAL_GetMulti0(P,TableNumber,2,13))+FAL_I2S(FAL_GetMulti0(P,TableNumber,2,14))+FAL_I2S(FAL_GetMulti0(P,TableNumber,2,15))+FAL_I2S(FAL_GetMulti0(P,TableNumber,2,16))+FAL_I2S2(FAL_GetMulti0(P,TableNumber,2,17),false)
  endif
endfunction
constant function FAL_Error takes integer i returns string
  if ( i == 1 ) then
    return "1, 읽기 버전 문제"
  elseif ( i == 2 ) then
    return "2, 파일 엑세스 문제"
  elseif ( i == 3 ) then
    return "3, 시간 초과"
  elseif ( i == 4 ) then
    return "4, 동기화 문제"
  elseif ( i == 5 ) then
    return "5, 변환 실패"
  else
    return "-1, ???"
  endif
endfunction
/*function FAL_Loading takes nothing returns nothing
 local Localtable table = Localtable.getLastRead()
 local player p = table.getOwningPlayer()
 local integer P = GetPlayerId(p)+1
  if ( Localtable.getLastRead().getError() == Localtable.ERROR_NONE ) then
    call MSG(p, 2, 10, "파일 읽기 |cff00ff00성공! |r - " + BaseStr(11)+"경로: |r"+I2S(FAL_GetMulti0(P, 0, 0, 4)) + ". "+table.getFilepath())
    call TriggerSleepAction(.25)
    set udg_Save_CodeOri[P] = FAL_Coding(P, FAL_GetMulti0(P, 0, 0, 4), true)
    set udg_Save_CodeOri2[P] = FAL_Coding(P, FAL_GetMulti0(P, 0, 0, 4), false)
//debug call BJDebugMsg("Loaded Code1(" +I2S(StringLength(udg_Save_CodeOri[P])) + "): "+ udg_Save_CodeOri[P])
//debug call BJDebugMsg("Loaded Code2(" +I2S(StringLength(udg_Save_CodeOri2[P])) + "): "+ udg_Save_CodeOri2[P])
	call TriggerSleepAction(.25)
    if ( StringLength(udg_Save_CodeOri[P]) == 133 ) then
      if ( Load(udg_Save_CodeOri[P], P) ) then
	    set udg_Save_Count[P] = 3
		call MSG(p, 2, 4, "로드 |cff00ff00성공! |r - |cffffdc3c메인 코드가 성공적으로 로드되었습니다.")
	    call TriggerSleepAction(.1)
	    if ( StringLength(udg_Save_CodeOri2[P]) == 147 ) then
          if ( Load2(udg_Save_CodeOri2[P], P) ) then
            set udg_Save_Count[P] = 2
			call MSG(p, 2, 4, "서브로드 |cff00ff00성공! |r - |cffffdc3c인벤토리가 성공적으로 로드되었습니다.")
		  endif
	    else
	      call MSG(p, 2, 20, "로드 |cffff0000실패! |r - "+BaseStr(11)+"서브 코드의 길이가 맞지 않아 로드에 실패 했습니다. (수동 로드 가능) - " + I2S(StringLength(udg_Save_CodeOri2[P])))
	    endif
      endif
    else
      call MSG(p, 2, 20, "로드 |cffff0000실패! |r - "+BaseStr(11)+"메인 코드의 길이가 맞지 않아 로드에 실패 했습니다. - " + I2S(StringLength(udg_Save_CodeOri[P])))
    endif
  elseif ( JN_LoaderSlot[JN_LoaderNow] > 0 ) then
    call MSG(p, 2, 10, "파일 읽기 |cff00ff00성공! |r - " + BaseStr(11)+"경로: |rServer(m16)/"+udg_SysB_Name[P]+"/"+I2S(JN_LoaderSlot[P])+"번파일")
    call TriggerSleepAction(.25)
    call JN_ServerLoad(Player(P-1), FAL_GetMulti0(P, 0, 0, 4))
  else
    call MSG(p, 2, 20, "파일 읽기 |cffff0000실패! |r - "+BaseStr(11)+"에러코드 : " + FAL_Error(table.getError()))
  endif
 set p = null  
endfunction*/

function FAL_LSlot takes integer TableNumber returns nothing
 local player p = GetTriggerPlayer()
  call MSG(p, 1, 3, I2S(TableNumber)+"번 칸("+FAL_Text(GetPlayerId(p)+1, TableNumber)+")의 정보를 불러옵니다...")
  
  call FAL_SetMulti0(GetPlayerId(p)+1, 0, 0, 4, TableNumber)
  if ( FAL_GetMulti0(GetPlayerId(p)+1, 0, 0, 0) > 0 ) then
    call JN_ServerLoad(p, TableNumber)
  endif
 set p = null
endfunction
function FAL_LSlot1 takes nothing returns nothing
  call FAL_LSlot(1)
endfunction
function FAL_LSlot2 takes nothing returns nothing
  call FAL_LSlot(2)
endfunction
function FAL_LSlot3 takes nothing returns nothing
  call FAL_LSlot(3)
endfunction
function FAL_LSlot4 takes nothing returns nothing
  call FAL_LSlot(4)
endfunction
function FAL_LSlot5 takes nothing returns nothing
  call FAL_LSlot(5)
endfunction
function FAL_LSlot6 takes nothing returns nothing
  call MSG(GetTriggerPlayer(), 1, 4, "불러오기를 하지 않습니다.")
endfunction
function FAL_Load2 takes player p returns nothing
  local trigger t1 = CreateTrigger()
  local trigger t2 = CreateTrigger()
  local trigger t3 = CreateTrigger()
  local trigger t4 = CreateTrigger()
  local trigger t5 = CreateTrigger()
  local trigger t6 = CreateTrigger()
  local dialog d = DialogCreate()
  call MSG(p, 1, 8, "10초 이내에 불러올 공간을 선택하여 주세요.")
  call TriggerSleepAction(.25)
  
  call TriggerRegisterDialogButtonEvent(t1, DialogAddButton(d, "[|cffffffffQ|r] "+FAL_Text(GetPlayerId(p)+1, 1), 81))
  call TriggerAddAction(t1, function FAL_LSlot1)
  call TriggerRegisterDialogButtonEvent(t2, DialogAddButton(d, "[|cffffffffW|r] "+FAL_Text(GetPlayerId(p)+1, 2), 87))
  call TriggerAddAction(t2, function FAL_LSlot2)
  call TriggerRegisterDialogButtonEvent(t3, DialogAddButton(d, "[|cffffffffE|r] "+FAL_Text(GetPlayerId(p)+1, 3), 69))
  call TriggerAddAction(t3, function FAL_LSlot3)
  call TriggerRegisterDialogButtonEvent(t4, DialogAddButton(d, "[|cffffffffR|r] "+FAL_Text(GetPlayerId(p)+1, 4), 82))
  call TriggerAddAction(t4, function FAL_LSlot4)
  call TriggerRegisterDialogButtonEvent(t5, DialogAddButton(d, "[|cffffffffT|r] "+FAL_Text(GetPlayerId(p)+1, 5), 84))
  call TriggerAddAction(t5, function FAL_LSlot5)
  call DialogSetMessage(d, "|cffffdc3c불러올 공간을 선택하세요.|r")
  call TriggerRegisterDialogButtonEvent(t6, DialogAddButton(d, "불러오지 않음/취소 (|cffffffffC|r)", 67))
  call TriggerAddAction(t6, function FAL_LSlot6)
  call DialogDisplay(p, d, true)
  
  call DialogClose(p, d, 12.)
  call TriggerSleepAction(12.)
  call DestroyTrigger(t1)
  call DestroyTrigger(t2)
  call DestroyTrigger(t3)
  call DestroyTrigger(t4)
  call DestroyTrigger(t5)
  call DestroyTrigger(t6)
  set t1 = null
  set t2 = null
  set t3 = null
  set t4 = null
  set t5 = null
  set t6 = null
  set d = null
endfunction
function ResetInven takes integer P returns nothing
 local integer i = 1
 local item temp_item
  if ( GetLocalPlayer() == Player(P-1) ) then
    call DzFrameShow(DzFrameFindByName("InVe_DesBack", 0), false)
    call DzFrameShow(DzFrameFindByName("EqSl_DesBack", 0), false) /* EquipSlot 연동 */
  endif
  loop
    if ( LoadBoolean(udg_hash, P, StringHash("bol") + i) ) then
      set temp_item = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), i)
      if ( GetLocalPlayer() == Player(P-1) ) then
        // 버튼 되돌리기
        call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", i), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
        call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", i), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
      endif
      call FlushChildHashtable(udg_hash, GetHandleId(temp_item))
      call RemoveItem(temp_item)
      // 해쉬 비우기
      call RemoveSavedHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), i)
      
      call RemoveSavedBoolean(udg_hash, P, StringHash("bol") + i)
      call RemoveSavedInteger(udg_hash, P, StringHash("itid") + i)
      call RemoveSavedInteger(udg_hash, P, StringHash("itco") + i)
    endif
    exitwhen i >= FMI_MAX_INVENTORY+FMI_add_Inventory[P]
    set i = i + 1
  endloop

  set i = FMI_MAXMAX_INVENTORY+1
  loop
    if ( LoadBoolean(udg_hash, P, StringHash("Sbol") + i) ) then
      set temp_item = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), i)
      if ( GetLocalPlayer() == Player(P-1) ) then
        // 버튼 되돌리기
        call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotA", i), "UI\\Console\\Human\\human-transport-slot.blp", 0)
        call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotB", i), "UI\\Console\\Human\\human-transport-slot.blp", 0)
      endif
      call RemoveSavedInteger(udg_hash, P, StringHash("itnad") + isNamed(GetItemCharges(temp_item), true))
      call FlushChildHashtable(udg_hash, GetHandleId(temp_item))
      call RemoveItem(temp_item)
      // 해쉬 비우기
      call RemoveSavedHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), i)
      
      call RemoveSavedBoolean(udg_hash, P, StringHash("Sbol") + i)
      call RemoveSavedInteger(udg_hash, P, StringHash("Sitid") + i)
      call RemoveSavedInteger(udg_hash, P, StringHash("Sitco") + i)
    endif
    exitwhen i >= FMI_MAXMAX_INVENTORY+12
    set i = i + 1
  endloop
  call RemoveSavedBoolean(udg_hash, StringHash("FMi_2Hand"), P)
  set temp_item = null
endfunction
function ResetSkill takes integer P returns nothing
 local integer i = 1
  loop
    call RemoveSavedInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(i)))
    exitwhen i >= 7
    set i = i + 1
  endloop
endfunction
function ItemsClear takes nothing returns nothing
 if ( GetItemUserData(GetEnumItem()) == udg_temp_i ) then
    call FlushChildHashtable(udg_hash, GetHandleId(GetEnumItem()))
    call RemoveItem(GetEnumItem())
 endif
endfunction
function ClearItems takes integer P returns nothing
 set udg_temp_i = P
 call EnumItemsInRect(FMi_Rect(-1), null, function ItemsClear)
endfunction

function TitleGet takes integer P, integer num returns integer
  return S2I(SubString(udg_SysB_Title[P],num-1,num))
endfunction
function TitleSet takes integer P, integer num, integer lv returns nothing
  if ( lv > S2I(SubString(udg_SysB_Title[P],num-1,num)) ) then
    set udg_SysB_Title[P] = SubString(udg_SysB_Title[P],0,num-1) + I2S(lv) + SubString(udg_SysB_Title[P],num,StringLength(udg_SysB_Title[P]))
  endif
endfunction
//call TitleSet(P, 1, 1)

function Title_Reset takes integer P returns nothing
//칭호 장착 해제
  if ( udg_SysB_TitleNow[P] != 0 ) then
    call MSG(Player(P-1), 1, 3, "칭호, \""+FCut(TITLEVALUE(udg_SysB_TitleNow[P], S2I(SubString(udg_SysB_Title[P],udg_SysB_TitleNow[P]-1,udg_SysB_TitleNow[P]))),1)+"\"를 장착 해제합니다.")
    call ItemEquip(P, null, true, false)
    //call ItemValue(TITLEVALUE(udg_SysB_TitleNow[P],S2I(SubString(udg_SysB_Title[P],udg_SysB_TitleNow[P]-1,udg_SysB_TitleNow[P]))), P, false)
    set udg_SysB_TitleNow[P] = 0
  endif
endfunction
function Ori_Name takes integer P returns string
  if ( udg_SysB_NameChange[P] != "" ) then
    return udg_SysB_NameChange[P]
  else
    return udg_SysB_Name[P]
  endif
endfunction
function Quest_Reset takes integer P returns nothing
 local integer i = 1
  call FAL_SetMulti0(P, 0, 0, 3, 0)
  loop
    call SaveInteger(udg_hash, StringHash("QLevel"+I2S(i)), P, 0)
    exitwhen i >= QUEST_COUNT
    set i = i + 1
  endloop
  set udg_Quest_00_Note[P] = 0
endfunction

function Trig_FAL_Load_Actions takes nothing returns nothing
 local player p = GetTriggerPlayer()
 local integer P = GetPlayerId(p)+1
 local integer i = FAL_GetMulti0(P, 0, 0, 0)
 if ( udg_Quest_SkipWait[P] < 1. ) then
   set udg_Quest_SkipWait[P] = 3.
  if ( udg_Save_Count[GetPlayerId(p)+1] == 0 ) then
    if ( i == 0 ) then
      set JN_LoaderSlot[GetPlayerId(p)+1] = 0
      call JNLoadServerCode(p, "0_0")
      call MSG(p, 2, 4, "불러오기 |cffff0000재설정! |r - |cffffdc3c값을 재설정했습니다. ("+I2S(i)+"→"+I2S(FAL_GetMulti0(P, 0, 0, 0))+")")
      call TriggerSleepAction(.1)
      set i = FAL_GetMulti0(P, 0, 0, 0)
    endif
    if ( i == 2147483647 ) then
      call MSG(p, 2, 4, "불러오기 |cffff0000불가! |r - |cffffdc3c불러오기 설정을 ON으로 해 두시지 않았습니다.\n  저장은 가능하며, |r-reg|cffffdc3c를 입력하여 설정 파일을 생성할 수 있습니다. \n    생성된 파일을 실행 후, 워크를 완전히 종료 후 다시 켜시면 로드가 가능합니다.\n      다음 방에서 |r-load1|cffffdc3c을 입력하여 코드 입력 없이 로드가 가능합니다.\n       (컴퓨터에 파일을 저장하는 방식)")
    elseif ( i == 0 ) then
      call MSG(p, 2, 4, "불러오기 |cffff0000불가! |r - |cffffdc3c로드할 내용이 없습니다. 한번의 저장 이후 로드하세요.")
    elseif ( i > 999 ) then
      call MSG(p, 2, 4, "불러오기 |cffff0000불가! |r - |cffffdc3c파일이 없거나 정상적이지 않습니다. ("+I2S(i)+")\n  한번의 저장 이후 다음방에서 로드를 시도해보세요.")
    else
      call MSG(p, 2, 4, "불러오기 |cff00ff00가능! |r - |cffffdc3c표시되는 선택창을 클릭시 로드가 진행됩니다.")
    endif
    call TriggerSleepAction(.9)
    call FAL_Load2(p)
    set udg_Save_Code[P] = null
    set udg_Save_Code2[P] = null
  elseif ( udg_PartyNumber_ThisP[P] != 0 ) then
    call MSG(p, 2, 4, "초기화 |cffff0000실패! |r - |cffffdc3c먼저, 파티를 탈퇴해 주세요.")
  else
    call PartyLeft(P)
    
    call Title_Reset(P)
    call SetPlayerName(Player(P-1), Ori_Name(P))
    
    set i = 1
    loop
      set bj_lastStartedTimer = LoadTimerHandle(udg_hash,P,StringHash("Buff"+I2S(i)))
      if ( TimerGetRemaining(bj_lastStartedTimer) >.1 ) then
        call TimerStart(bj_lastStartedTimer,0.,false,function BuffEnd)
      endif
      exitwhen i >= BuffCode("ALL")
      set i = i + 1
    endloop
    call ResetInven(P)
    call ResetSkill(P)
    call TriggerSleepAction(.01)
    if ( GetLocalPlayer() == p ) then
      call SetCameraField(CAMERA_FIELD_TARGET_DISTANCE, LoadInteger(udg_hash, StringHash("FoV"), P), 0)
      call SetCameraField(CAMERA_FIELD_ANGLE_OF_ATTACK, bj_CAMERA_DEFAULT_AOA, 0)
      call SetCameraBoundsXY(GetWidgetX(gg_unit_H017_0002), GetWidgetY(gg_unit_H017_0002))
    endif
    call ClearItems(P)
  
    call RemoveUnit(udg_Unit[P])
    call TriggerSleepAction(.01)
    set udg_Unit[P] = null
    set udg_SysL_Level[P] = 0
    set udg_Save_HP[P] = 0
    set udg_Save_MP[P] = 0
    
    set udg_SysC_DmgAttack[P] = 0
    set udg_SysC_DmgAttackAdd[P] = 0
    call SaveInteger(udg_hash, P, StringHash("Exp"), 0)
    set udg_SysC_CriP[P] = 0.
    set udg_SysC_CriX[P] = 0.
    set udg_SysC_Dam[P] = 0
    set udg_SysC_Hits[P] = 0.
    set udg_SysC_Regen[P] = 0
    
    set udg_SysE_STR2[P] = 0
    set udg_SysE_DEX2[P] = 0
    set udg_SysE_INT2[P] = 0
    set udg_SysE_WIS2[P] = 0
    set udg_SysE_CON2[P] = 0
    
    set udg_SysK_Exp[P] = 0
    set udg_SysK_Drop[P] = 0
    set udg_SysK_Gold[P] = 0
      
    set udg_SysK_ExpAdd[P] = 0
    set udg_SysK_DropAdd[P] = 0
    set udg_SysK_GoldAdd[P] = 0
    
    call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, 0)
    call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, 0)
    
    set udg_SysC_AtkSpdAdd[P] = 0
    set udg_SysC_PotAdd[P] = 0
    
    set udg_SysC_Armor[P] = 0
    set udg_SysC_ArmorM[P] = 0
    set udg_SysC_MissMagic[P] = 0.
    
    set udg_Save_Code[P] = ""
    set udg_Save_Code2[P] = ""
    set udg_Save_Count[P] = 0
    call Quest_Reset(P)
    call MSG(p, 2, 3, "불러오기 |cff00ff00초기화! |r - |cffffdc3c모든 데이터가 초기화되었습니다.\n  로드 후 파티를 생성하여 경험치 보너스를 다시 받으세요.")
  endif
 call TriggerSleepAction(2.)
 set udg_Quest_SkipWait[P] = 0.
 else
    call MSG(p, 2, 3, "불러오기 |c00ffff00대기중! |r - |cffffdc3c조금 천천히 입력해주세요. (최대 3초)")
 endif
 set p = null  
endfunction

//===========================================================================
function InitTrig_FAL_Load1 takes nothing returns nothing
    set gg_trg_FAL_Load1 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_FAL_Load1, function Trig_FAL_Load_Actions )
endfunction

//===========================================================================
// Trigger: Instruction All
//===========================================================================
constant function SetupIndex takes integer i returns integer
  if ( i == 0 ) then
  //인덱스 총 개수
    return 4
  elseif ( i == 1 ) then
  //부활 마을 저장(100진법 = 99개)
    return 100
  elseif ( i == 2 ) then
  //퀘속도 = 3개
    return 3
  elseif ( i == 3 ) then
  //화면 고정
    return 2
  elseif ( i == 4 ) then
  //팁 끄기
    return 2
  else
    return 0
  endif
endfunction

function IndexSet takes integer P, integer i1, integer i2 returns nothing
 local integer loopA = 1
 local integer sum = 1
 local integer val = FAL_GetMulti0(P, 0, 0, 2)
  loop
    if ( i1 == loopA ) then
      call FAL_SetMulti0(P, 0, 0, 2, FAL_GetMulti0(P, 0, 0, 2) + ( sum * ( i2 - ModuloInteger(val,SetupIndex(loopA)) ) ))
//debug call BJDebugMsg("IndexSet - " + I2S(FAL_GetMulti0(P, 0, 0, 2)))
      return
    endif
    set val = val / SetupIndex(loopA)
    set sum = sum * SetupIndex(loopA)
    exitwhen loopA >= SetupIndex(0)
    set loopA = loopA + 1
  endloop
endfunction
//call IndexSet(P, 4, 1)  //4번째 값을 1로 변경

function IndexGet takes integer val, integer i1 returns integer
 local integer loopA = 1
  loop
    if ( i1 == loopA ) then
//debug call BJDebugMsg("IndexGet = " + I2S(ModuloInteger(val,SetupIndex(loopA))))
      return ModuloInteger(val,SetupIndex(loopA))
    endif
    set val = val / SetupIndex(loopA)
    exitwhen loopA >= SetupIndex(0)
    set loopA = loopA + 1
  endloop
 return 0
endfunction
//val의 i1번째 인덱스를 가져온다.

function CZ4 takes nothing returns nothing
  local integer P = GetPlayerId(GetTriggerPlayer())+1
  local timer t = LoadTimerHandle(udg_hash, P, StringHash("zzZ-t2"))
  call DestroyTrigger(GetTriggeringTrigger())
  call DialogDestroy(GetClickedDialog())
  call FlushChildHashtable(udg_hash, GetHandleId(t))
  call DestroyTimer(t)
  call ClearTextMessagesBJ(GetForceOfPlayer(Player(P-1)))
  call MSG(Player(P-1), 2, 9999, "당신의 코드: \n-load " + FSE_Color(udg_Save_Code[P], 7))
  call MSG(Player(P-1), 2, 9999, "    인벤토리 코드\n    -load2 " + FSE_Color(udg_Save_Code2[P], 6))
  
  call FSE_MakeFile(Player(P-1),udg_SysB_Name[P]+"_last",false)
  call TriggerSleepAction(.1)
  call FAL_Save1(P)
  set udg_SavedString[P] = "^"
  
  set t = null
  set P = 0
endfunction
function CZ3 takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local integer P = LoadInteger(udg_hash, GetHandleId(t), StringHash("zzZ-P"))
 local trigger t1 = CreateTrigger()
  set udg_temp_d = DialogCreate()
  call DialogSetMessage(udg_temp_d, "|cffffdc3c자동 세이브 되었습니다.|r (잠수)")
  call DialogAddButton(udg_temp_d, "코드 확인하기 (|cffffffffQ|r)", 81)
  call TriggerAddAction(t1, function CZ4)
  call TriggerRegisterDialogEvent(t1, udg_temp_d)
  call DialogDisplay(Player(P-1), udg_temp_d, true)
  call TimerStart(t, RMaxBJ(60.,TimerGetTimeout(t)+10), false, function CZ3)
  set P = 0
  set t = null
  set t1 = null
endfunction
function CZ2 takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local integer P = LoadInteger(udg_hash, GetHandleId(t), StringHash("zzZ-P"))
  call MSGAll(0, true, 1, 2, 30., SysStr(2,P)+udg_SysB_Name[P]+"|c00ffff00님이 장기간 잠수로 인해 자동 세이브되었습니다.")
  set udg_Save_Count[P] = 7
  //강제 세이브
  if ( Save(P, true) ) then
    call LocalMtbM(Player(P-1), bj_lastCreatedMultiboard, true)  
    call Save2(P)
    call FSE_MakeFile(Player(P-1),udg_SysB_Name[P]+"_last",false)
    
    set udg_temp_i2 = FAL_GetMulti0(P, 0, 0, 4)
    //슬롯 이름저장
    call FAL_SerSlotName(P, udg_temp_i2)
    if ( udg_temp_i2 > 0 ) then
      if ( GetLocalPlayer() == Player(P-1) ) then
        call MSG(Player(P-1), 2, 4, "|c00d962b5＊|cffffdc3c자동저장 되었습니다(서버)|r: " + JNSetLog(JN_MAPID, udg_SysB_Name[P], JN_SECRETKEY, I2S(udg_temp_i2), JNServerTime("MMdd_HHmm")+"_"+I2S(udg_MT_TimerHou*60+udg_MT_TimerMin)+"m (잠수)", FAL_Text(P,udg_temp_i2)+"|"+FSE_ColorX(udg_Save_Code[P])+"|"+FSE_ColorX(udg_Save_Code2[P])))
      endif
    endif      
  endif
 call TimerStart(t,1.,false,function CZ3)
 set t = null
endfunction
function CZ takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local integer P = LoadInteger(udg_hash, GetHandleId(t), StringHash("zzZ-P"))
 local timer t2 = CreateTimer()
  if ( isPlaying(Player(P-1)) ) then
    call SaveInteger(udg_hash, GetHandleId(t2), StringHash("zzZ-P"), P)
    call SaveTimerHandle(udg_hash, P, StringHash("zzZ-t2"), t2)
    call TimerStart(t2,300.,false,function CZ2)
	call MSGAll(0, true, 1, 2, 20., SysStr(2,P)+udg_SysB_Name[P]+"|c00ffff00님이 잠수입니다. 5분 내 아무런 말도 없을시 자동으로 강제 세이브됩니다.")
  else
    call RemoveUnit(udg_Unit[P])
    call DestroyTimer(t2)
  endif
 call FlushChildHashtable(udg_hash, GetHandleId(t))
 call DestroyTimer(t)
 set t = null
 set t2 = null
endfunction
constant function Withoutstring takes string s returns boolean
  if ( s == "1" ) then
    return true
  elseif ( s == "2" ) then
    return true
  elseif ( s == "3" ) then
    return true
  elseif ( s == "4" ) then
    return true
  elseif ( s == "5" ) then
    return true
  elseif ( s == "6" ) then
    return true
  elseif ( s == "7" ) then
    return true
  elseif ( s == "8" ) then
    return true
  elseif ( s == "9" ) then
    return true
  elseif ( s == "10" ) then
    return true
  elseif ( s == "11" ) then
    return true
  elseif ( s == "12" ) then
    return true
  else
    return false
  endif
endfunction
function Trig_Instruction_All_Conditions takes nothing returns boolean
 local timer t = LoadTimerHandle(udg_hash, GetPlayerId(GetTriggerPlayer())+1, StringHash("zzZ-t"))
  if not ( LoadBoolean(udg_hash, StringHash("EventBuff"), GetPlayerId(GetTriggerPlayer())+1) ) and ( t == null ) then
    set t = CreateTimer()
    call SaveTimerHandle(udg_hash, GetPlayerId(GetTriggerPlayer())+1, StringHash("zzZ-t"), t)
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("zzZ-P"), GetPlayerId(GetTriggerPlayer())+1)
    call DestroyTimer(LoadTimerHandle(udg_hash, GetPlayerId(GetTriggerPlayer())+1, StringHash("zzZ-t2")))
  endif
  call TimerStart(t,2400.,false,function CZ)
  if ( HaveSavedString(udg_hash, StringHash(udg_SysB_Name[GetPlayerId(GetTriggerPlayer())+1]), StringHash("P/W")) ) then
    if ( GetEventPlayerChatString() == LoadStr(udg_hash, StringHash(udg_SysB_Name[GetPlayerId(GetTriggerPlayer())+1]), StringHash("P/W")) ) then
	  call RemoveSavedString(udg_hash, StringHash(udg_SysB_Name[GetPlayerId(GetTriggerPlayer())+1]), StringHash("P/W"))	
	  call MSG(GetTriggerPlayer(), 1, 3., "플레이어 |c0087F264"+GetPlayerName(GetTriggerPlayer())+"|cffffdc3c, 본인 확인되었습니다.")
    endif
  endif
 set t = null
 return ( HaveSavedHandle(udg_hash, StringHash(GetEventPlayerChatString()), StringHash("I2T")) )
endfunction

function Trig_Instruction_All_Actions takes nothing returns nothing
  if ( HaveSavedHandle(udg_hash, StringHash(GetEventPlayerChatString()), StringHash("I2T")) ) then
    if ( TriggerEvaluate(LoadTriggerHandle(udg_hash, StringHash(GetEventPlayerChatString()), StringHash("I2T"))) ) then
      call TriggerExecute(LoadTriggerHandle(udg_hash, StringHash(GetEventPlayerChatString()), StringHash("I2T")))
    endif
  endif
endfunction

//===========================================================================
function InitTrig_Instruction_All takes nothing returns nothing
    set gg_trg_Instruction_All = CreateTrigger(  )
    call TriggerAddCondition( gg_trg_Instruction_All, Condition( function Trig_Instruction_All_Conditions ) )
    call TriggerAddAction( gg_trg_Instruction_All, function Trig_Instruction_All_Actions )
endfunction

//===========================================================================
// Trigger: Use Item
//===========================================================================
function Trig_Use_Item_Actions takes nothing returns nothing
  if ( GetManipulatedItem() != null ) then
    if ( HaveSavedHandle(udg_hash, GetItemTypeId(GetManipulatedItem()), StringHash("Pitem1")) ) then
      if ( TriggerEvaluate(LoadTriggerHandle(udg_hash, GetItemTypeId(GetManipulatedItem()), StringHash("Pitem1"))) ) then
        call TriggerExecute(LoadTriggerHandle(udg_hash, GetItemTypeId(GetManipulatedItem()), StringHash("Pitem1")))
      endif
    endif
  endif
endfunction

//===========================================================================
function InitTrig_Use_Item takes nothing returns nothing
  set gg_trg_Use_Item = CreateTrigger()
  call TriggerAddAction(gg_trg_Use_Item, function Trig_Use_Item_Actions)
endfunction

//===========================================================================
// Trigger: Use Item2
//===========================================================================
function Trig_Use_Item2_Actions takes nothing returns nothing
 local integer i = GetItemTypeId(GetManipulatedItem())
  if ( not udg_SysA_Item ) then
    if ( HaveSavedHandle(udg_hash, i, StringHash("Pitem2")) ) then
      if ( TriggerEvaluate(LoadTriggerHandle(udg_hash, i, StringHash("Pitem2"))) ) then
        call TriggerExecute(LoadTriggerHandle(udg_hash, i, StringHash("Pitem2")))
        call TriggerSleepAction(.1)
        call RemoveItem(GetManipulatedItem())
      endif
    elseif ( StringCase(GetObjectName(i),true) == "GOLD" ) then
      call TriggerExecute(gg_trg_Sys_Gold_Get)
    elseif ( TriggerEvaluate(gg_trg_FMi_GetItem) ) then
      call TriggerExecute(gg_trg_FMi_GetItem)
    endif
    call SaveInteger(udg_hash, GetHandleId(GetManipulatedItem()), StringHash("iLife"), 31)
  endif
endfunction

//===========================================================================
function InitTrig_Use_Item2 takes nothing returns nothing
  set gg_trg_Use_Item2 = CreateTrigger()
  call TriggerAddAction(gg_trg_Use_Item2, function Trig_Use_Item2_Actions)
endfunction

//===========================================================================
// Trigger: Sys Dmg Add
//
// 환ringHash("FAI-Set2") - abc 값 - 기존 83
// 클린 코드 작성하기
// call BossSetting(1)
// 보스 이름(넘버)
// 보스 페이즈
// 1~4페이즈 효과
// 각 페이즈 체력 제한
// 사망 후 효과
// - 드랍 아이템
// - 영혼 생성, 추가 보상 (돌연변이 10회 잡은효과 등)
// 	82~84 : AI 설정 관련.
// 마공 c: 회복의구슬: 회복 - 5~7초(수동) + Stuck면역
// 마공 d: 폭발의구슬
//===========================================================================
constant function BOSSRECT takes integer i returns rect
  if ( i == 1 ) then
    return gg_rct_Boss_Rect_01
  else
    return null
  endif
endfunction

//쿨다운/쿨다운-페이즈당감소/다음스킬 쿨다운/캐스팅시간/캐스팅시간-페이즈당감소/Stuck 숫자
constant function AI_SKILL_DATA takes string skill, string s returns real
  if ( skill == "1" ) then
    //Cooltime. 쿨탐
    if ( s == "COOL" ) then
      return 30.
      
    //Cooltime minus per phase : 페이즈당 감소 쿨탐
    elseif ( s == "COOL_P-" ) then
      return 5.
    
    //Cooltime next skill : 다음 스킬까지 쿨탐 (스킬 후딜)
    elseif ( s == "COOL_N" ) then
      return 6.
    
    //casting time
    elseif ( s == "CASTING" ) then
      return 5.
      
    //casiting munus per phase : 페이즈당 캐스팅 감소
    elseif ( s == "CASTING_P-" ) then
      return .5
      
    //STUCK 숫자: 이 숫자만큼 Stuck 쌓여야 캔슬
    elseif ( s == "STUCK" ) then
      return 3.

    endif
  elseif ( skill == "9" ) then
    if ( s == "COOL" ) then
      return 10.
    elseif ( s == "COOL_P-" ) then
      return 1.
    elseif ( s == "COOL_N" ) then
      return 5.
    elseif ( s == "CASTING" ) then
      return 4.
    elseif ( s == "CASTING_P-" ) then
      return .25
    elseif ( s == "STUCK" ) then
      return 2.
    endif
  endif
  return 0.
endfunction
//AI_SKILL_DATA(s,"STUCK")

function GRU takes nothing returns nothing
  set bj_groupRandomConsidered = bj_groupRandomConsidered + 1
  if ( GetRandomReal(0.,I2R(bj_groupRandomConsidered)) <= 1. ) then
    set bj_groupRandomCurrentPick = GetEnumUnit()
  endif
endfunction
function GetGRU takes group g returns unit
  set bj_groupRandomConsidered = 0
  set bj_groupRandomCurrentPick = null
  call ForGroup(g, function GRU)
  return bj_groupRandomCurrentPick
endfunction

function AI_text takes integer i1, integer i2 returns string
  local string s = ""
  if ( i1 > 0 ) then
    set s = "|cff80ffff"
    set i2 = i2 - i1
    loop
      exitwhen i1 <= 0
      set s = s + "I"
      set i1 = i1 - 1
    endloop
  endif
  if ( i2 > 0 ) then
    set s = s + "|cff8f8f8f"
    loop
      exitwhen i2 <= 0
      set s = s + "l"
      set i2 = i2 - 1
    endloop
  endif
  return s
endfunction
function AI_String takes string s returns string
  if ( s == null ) then
    return ""
  else
    return s
  endif
endfunction
function AI_Cooldown takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local unit u = LoadUnitHandle(udg_hash, StringHash("FAI-Unit"), GetHandleId(t))
  if ( u != null ) then
    call SaveStr(udg_hash, GetHandleId(u), StringHash("FAI-S"), AI_String(LoadStr(udg_hash, GetHandleId(u), StringHash("FAI-S"))) + AI_String(LoadStr(udg_hash, GetHandleId(t), StringHash("FAI-S"))))
  endif
  call FlushChildHashtable(udg_hash, GetHandleId(t))
  call DestroyTimer(t)
  set t = null
  set u = null
endfunction
function AI_Condi_1 takes nothing returns boolean
  //체 닳은 아군 찾기
  return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) != true ) and ( IsUnitAlly(udg_temp_AI_u, GetOwningPlayer(GetFilterUnit())) ) and ( GetWidgetLife(GetFilterUnit()) > 2 ) and ( GetWidgetLife(GetFilterUnit()) < GetUnitState(GetFilterUnit(), UNIT_STATE_MAX_LIFE) )
endfunction
function AI_Condi_2 takes nothing returns boolean
  //적 찾기
  return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) != true ) and ( IsUnitEnemy(udg_temp_AI_u, GetOwningPlayer(GetFilterUnit())) ) and ( GetWidgetLife(GetFilterUnit()) > 2 )
endfunction
function AI_Condi_3 takes nothing returns boolean
  //보스 찾기
  return ( IsUnitAlly(udg_temp_AI_u, GetOwningPlayer(GetFilterUnit())) ) and ( GetUnitAbilityLevel(GetFilterUnit(), 'A00O') > 0 )
endfunction
function AI_Group takes group g, unit u, real r, boolexpr e returns group
  set udg_temp_AI_u = u
  if ( HaveSavedHandle(udg_hash, GetHandleId(u), StringHash("FAI-Rect")) ) then
    call GroupEnumUnitsInRect(g, LoadRectHandle(udg_hash, GetHandleId(u), StringHash("FAI-Rect")), e)
  else
    call GroupEnumUnitsInRange(g, GetWidgetX(u), GetWidgetY(u), 950+r, e)
  endif
  //call DestroyBoolExpr(e)
  return g
endfunction
//라이트닝 대기 후 파괴
function DestroyLightning3 takes nothing returns nothing
 local timer t = GetExpiredTimer()
  call DestroyLightning(LoadLightningHandle(udg_hash,GetHandleId(t),StringHash("source")))
  call FlushChildHashtable(udg_hash,GetHandleId(t))
  call DestroyTimer(t)
 set t = null
endfunction
function DestroyLightning2 takes lightning e, real time returns nothing
 local timer t = CreateTimer()
  call SaveLightningHandle(udg_hash,GetHandleId(t),StringHash("source"),e)
  call TimerStart(t,time,false,function DestroyLightning3)
 set t = null
endfunction
//call DestroyLightning2(AddLightningEx("AFOD", true, GetWidgetX(u), GetWidgetY(u), 30., GetWidgetX(t), GetWidgetY(t), 30.), .5)

function CountInGroup takes group g returns integer
 set bj_groupCountUnits = 0
  call ForGroup(g, function CountUnitsInGroupEnum)
 return bj_groupCountUnits
endfunction

function AI_Skill_1 takes unit u returns nothing
  local group g = AI_Group(CreateGroup(),u,600.,Condition(function AI_Condi_2))
  local unit t = FirstOfGroup(g)
  loop
    exitwhen ( t == null )
    call GroupRemoveUnit(g, t)
    
    call DmgTrue(u, t, RMaxBJ(5000.,GetWidgetLife(t)*.9))
    call DestroyLightning2(AddLightningEx("AFOD", true, GetWidgetX(u), GetWidgetY(u), 30., GetWidgetX(t), GetWidgetY(t), 30.), .5)
    
    set t = FirstOfGroup(g)
  endloop
  call DestroyGroup(g)
  set g = null
  set t = null
endfunction
function AI_Skill_2a takes unit u returns boolean
  local group g = AI_Group(CreateGroup(),u,0,Condition(function AI_Condi_2))
  local unit t
  local group g2 = CreateGroup()
  if ( FirstOfGroup(g) != null ) then
    loop
      set t = FirstOfGroup(g)
      exitwhen t == null
      call GroupRemoveUnit(g, t)
      set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(u), 'e018', GetWidgetX(t), GetWidgetY(t), bj_UNIT_FACING)
      call UnitApplyTimedLife(bj_lastCreatedUnit, 'BHwe', 3.)
      call GroupAddUnit(g2, bj_lastCreatedUnit)
      call ED(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Aneu\\AneuCaster.mdl", t, "overhead"), 1.5)
    endloop
    call SaveGroupHandle(udg_hash, GetHandleId(u), StringHash("FAI-2aG"), g2)
    call DestroyGroup(g)
    set g = null
    set t = null
    set g2 = null
    return true
  endif
  call DestroyGroup(g)
  set g = null
  set t = null
  call DestroyGroup(g2)
  set g2 = null
  return false
endfunction
function AI_Skill_2 takes unit u returns nothing
  local group g = LoadGroupHandle(udg_hash, GetHandleId(u), StringHash("FAI-2aG"))
  local unit t
  local group g2
  local unit t2
  if ( FirstOfGroup(g) != null ) then
    loop
      set t = FirstOfGroup(g)
      exitwhen t == null
      call GroupRemoveUnit(g, t)
      call DestroyEffect(AddSpecialEffect("Units\\Demon\\Infernal\\InfernalBirth.mdl", GetWidgetX(t), GetWidgetY(t)))
      call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Demon\\RainOfFire\\RainOfFireTarget.mdl", GetWidgetX(t), GetWidgetY(t)))
      set g2 = AI_Group(CreateGroup(),t,-850,Condition(function AI_Condi_2))
      if ( FirstOfGroup(g2) != null ) then
        set t2 = FirstOfGroup(g2)
        exitwhen t2 == null
        call GroupRemoveUnit(g2, t2)
        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosTarget.mdl", GetWidgetX(t2), GetWidgetY(t2)))
        call UnitDamageTarget(u, t2, 50000, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_FIRE, WEAPON_TYPE_WHOKNOWS)
      endif
      call DestroyGroup(g2)
    endloop
  endif
  call DestroyGroup(g)
  set g = null
  set g2 = null
  set t = null
  set t2 = null
endfunction
function AI_Skill_3 takes unit u returns nothing
  local group g = AI_Group(CreateGroup(),u,-200,Condition(function AI_Condi_1))
  local unit t = FirstOfGroup(g)
  local unit t2
  local real r = 0
  if ( t != null ) then
    call GroupRemoveUnit(g, t)
    loop
      set t2 = FirstOfGroup(g)
      exitwhen t2 == null
      call GroupRemoveUnit(g, t2)
      set r = GetWidgetLife(t2)/GetUnitState(t2, UNIT_STATE_MAX_LIFE)
      if ( r < GetWidgetLife(t)/GetUnitState(t, UNIT_STATE_MAX_LIFE) ) then
        set t = t2
      endif
    endloop
    set r = GetUnitState(t, UNIT_STATE_MAX_LIFE) * GetRandomReal(0.1,0.2)
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", t, "origin"))
    call SetWidgetLife(t, GetWidgetLife(t)+r)
  endif
  call DestroyGroup(g)
  set g = null
  set t = null
  set t2 = null
endfunction
constant function SOMMONDATA takes integer ut, integer count returns integer
  if ( ut == 'n010' ) then
  //써큐버스
    if ( count == -1 ) then
      //추가소환 개수 (기본 1~2)
      return 2
    elseif ( count == 0 ) then
      //아래 유닛들 총 종류 개수
      return 3
    elseif ( count == 1 ) then
    //첫번째 유닛 유닛타입
      return 'n027'
    elseif ( count == 2 ) then
    //첫번째 유닛 유닛타입
      return 'n01H'
    elseif ( count == 3 ) then
    //첫번째 유닛 유닛타입
      return 'n026'
    endif
  endif
  return 0
endfunction
function AI_Skill_4 takes unit u returns nothing
 local integer c = GetRandomInt(1,2) + SOMMONDATA(GetUnitTypeId(u),-1)
  loop
    if ( SOMMONDATA(GetUnitTypeId(u), 0) > 0 ) then
      set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(u), GetRandomInt(1,SOMMONDATA(GetUnitTypeId(u), 0)), GetWidgetX(u), GetWidgetY(u), GetRandomReal(0,360))
    else
      set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(u), GetUnitTypeId(u), GetWidgetX(u), GetWidgetY(u), GetRandomReal(0,360))
    endif
    call SaveReal(udg_hash, GetHandleId(bj_lastCreatedUnit), StringHash("BonusHP"), (LoadReal(udg_hash, GetHandleId(u), StringHash("BonusHP"))-1.) * .25)
    
    call SetUnitState(bj_lastCreatedUnit, UNIT_STATE_MAX_LIFE, GetUnitState(u, UNIT_STATE_MAX_LIFE))
    call SetWidgetLife(bj_lastCreatedUnit, GetUnitState(bj_lastCreatedUnit, UNIT_STATE_MAX_LIFE)*.75)
    exitwhen c <= 1
    set c = c - 1
  endloop
endfunction
function AI_Skill_5 takes unit u returns nothing
  local group g = AI_Group(CreateGroup(),u,0,Condition(function AI_Condi_2))
  local unit t = GetGRU(g)
  if ( t != null ) then
    call Attack(u, t, 0.5, 7)
    set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(u),'e015',GetWidgetX(u),GetWidgetY(u),0)
    call UnitAddAbility(bj_lastCreatedUnit, 'A061')
    call IssueTargetOrder(bj_lastCreatedUnit, "bloodlust", u)
    call RemoveUnit(bj_lastCreatedUnit)
    call ED(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", u, "overhead"), 5)
    call ED(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", t, "overhead"), 5)
  endif
  call DestroyGroup(g)
  set g = null
  set t = null
endfunction
function AI_Skill_6 takes unit u returns nothing
  local group g = AI_Group(CreateGroup(),u,-500,Condition(function AI_Condi_2))
  local unit t
  loop
    set t = GetGRU(g)
    exitwhen t == null
    call GroupRemoveUnit(g, t)
    call UnitDamageTarget(u, t, 5000, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_FIRE, WEAPON_TYPE_WHOKNOWS)
    if ( GetRandomReal(1,2) < 1 ) then
      call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl", GetWidgetX(t), GetWidgetY(t)))
    else
      call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl", GetWidgetX(t), GetWidgetY(t)))
    endif
  endloop
  call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl", GetWidgetX(u), GetWidgetY(u)))
  call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl", GetWidgetX(u), GetWidgetY(u)))
  call DestroyGroup(g)
  set g = null
  set t = null
endfunction
function AI_Skill_7 takes unit u returns nothing
  local group g = AI_Group(CreateGroup(),u,0,Condition(function AI_Condi_2))
  local unit t = GetGRU(g)
  if ( t != null ) then
    if ( udg_SysA_EffectSimple ) then
      call MSG(GetOwningPlayer(t), 2, 3., "|cff46ffff시스템 방어 !! |r- |cff9932cc딜루메나|r")
    else
      call CinematicFilterGenericForPlayer(GetOwningPlayer(t), 20., BLEND_MODE_BLEND, "ReplaceableTextures\\CameraMasks\\Black_mask.blp", 120, 120, 120, 0.00, 100, 100, 100, 100 )
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilSpecialArt.mdl", t, "overhead"))
      call MSG(GetOwningPlayer(t), 1, 2, "|c00ff0000" + GetUnitName(u) + "|c00d1d1d1(이)가 당신에게 |c00baf1e7딜루메나|c00d1d1d1를 시전하였습니다.")
    endif
  endif
  call DestroyGroup(g)
  set g = null
  set t = null
endfunction
function AI_Skill_8 takes unit u returns nothing
  local group g = LoadGroupHandle(udg_hash, GetHandleId(u), StringHash("FAI-2aG"))
  local unit t
  local group g2
  local unit t2
  if ( FirstOfGroup(g) != null ) then
    loop
      set t = GetGRU(g)
      exitwhen t == null
      call GroupRemoveUnit(g, t)
      call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl", GetWidgetX(t), GetWidgetY(t)))
      call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\GryphonRiderMissile\\GryphonRiderMissileTarget.mdl", GetWidgetX(t), GetWidgetY(t)))
      set g2 = AI_Group(CreateGroup(),t,-850.,Condition(function AI_Condi_2))
      if ( FirstOfGroup(g2) != null ) then
        set t2 = FirstOfGroup(g2)
        exitwhen t2 == null
        call GroupRemoveUnit(g2, t2)
        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl", GetWidgetX(t2), GetWidgetY(t2)))
        call UnitDamageTarget(u, t2, 50000, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_FIRE, WEAPON_TYPE_WHOKNOWS)
      endif
      call DestroyGroup(g2)
    endloop
  endif
  call DestroyGroup(g)
  set g = null
  set g2 = null
  set t = null
  set t2 = null
endfunction
constant function FAI_LEVEL takes integer lev returns integer
  if ( lev <= 25 ) then
    return 1
  elseif ( lev <= 40 ) then
    return 2
  elseif ( lev <= 55 ) then
    return 3
  elseif ( lev <= 70 ) then
    return 4
  elseif ( lev <= 85 ) then
    return 5
  elseif ( lev <= 95 ) then
    return 6
  elseif ( lev <= 105 ) then
    return 7
  elseif ( lev <= 115 ) then
    return 8
  else
    return 9
  endif
endfunction
function AI_Skill_a takes unit u returns nothing
  local group g = AI_Group(CreateGroup(),u,-150.,Condition(function AI_Condi_2))
  local unit t = GetGRU(g)
  local integer LEVEL = GetUnitLevel(u)+LoadInteger(udg_hash, GetHandleId(u), StringHash("Level"))
  if ( t != null ) then
    set bj_groupCountUnits = 0
    call ForGroup(g, function CountUnitsInGroupEnum)
    if ( udg_SysA_MapLevel == 3 ) then
      set udg_temp_r = (100. + (LEVEL *(15+FAI_LEVEL(LEVEL)*2))) * GetRandomReal(0.57, .63) * 2
    elseif ( udg_SysA_MapLevel == 4 ) then
      set udg_temp_r = (100. + (LEVEL *(15+FAI_LEVEL(LEVEL)*2))) * GetRandomReal(0.57, .63) * 3
    else
      set udg_temp_r = (100. + (LEVEL *(15+FAI_LEVEL(LEVEL)*2))) * GetRandomReal(0.57, .63)
    endif
    set LEVEL = FAI_LEVEL(LEVEL)
    if ( LEVEL >= 6 ) and ( bj_groupCountUnits >= 4 ) and ( GetRandomReal(0.,100.) <= 10. ) then
      set LEVEL = R2I(GetRandomReal(1., 4.999))
      if ( LEVEL <= 1 ) then
        set udg_temp_s = "마네나로"
      elseif ( LEVEL <= 2 ) then
        set udg_temp_s = "테라미칼로"
      elseif ( LEVEL <= 3 ) then
        set udg_temp_s = "아듀랄로"
      else
        set udg_temp_s = "플라미칼로"
      endif
      loop
        set t = FirstOfGroup(g)
        exitwhen t == null
        call GroupRemoveUnit(g, t)
        set udg_SYSTEM_DamgeColor = udg_temp_s
        call UnitDamageTarget(u, t, udg_temp_r, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_COLD, WEAPON_TYPE_WHOKNOWS)
        call GetEffectUnit(t, LEVEL, 3)
      endloop
    elseif ( LEVEL >= 4 ) and ( bj_groupCountUnits >= 3 ) and ( GetRandomReal(0.,90.) <= 20. ) then
      set LEVEL = R2I(GetRandomReal(1., 4.999))
      if ( LEVEL <= 1 ) then
        set udg_temp_s = "엑스마레나"
      elseif ( LEVEL <= 2 ) then
        set udg_temp_s = "엑스테라미카"
      elseif ( LEVEL <= 3 ) then
        set udg_temp_s = "엑스아듀라"
      else
        set udg_temp_s = "엑스플라미카"
      endif
      set bj_groupCountUnits = 3
      loop
        set t = GetGRU(g)
        exitwhen t == null or bj_groupCountUnits <= 0
        call GroupRemoveUnit(g, t)
        set udg_SYSTEM_DamgeColor = udg_temp_s
        call UnitDamageTarget(u, t, udg_temp_r, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_COLD, WEAPON_TYPE_WHOKNOWS)
        call GetEffectUnit(t, LEVEL, 2)
        set bj_groupCountUnits = bj_groupCountUnits - 1
      endloop
    elseif ( LEVEL >= 2 ) and ( bj_groupCountUnits >= 2 ) and ( GetRandomReal(0.,70.) <= 30. ) then
      set LEVEL = R2I(GetRandomReal(1., 4.999))
      if ( LEVEL <= 1 ) then
        set udg_temp_s = "수페라마레나"
      elseif ( LEVEL <= 2 ) then
        set udg_temp_s = "수페라테라미카"
      elseif ( LEVEL <= 3 ) then
        set udg_temp_s = "수페라아듀라"
      else
        set udg_temp_s = "수페라플라미카"
      endif
      set bj_groupCountUnits = 2
      loop
        set t = GetGRU(g)
        exitwhen t == null or bj_groupCountUnits <= 0
        call GroupRemoveUnit(g, t)
        set udg_SYSTEM_DamgeColor = udg_temp_s
        call UnitDamageTarget(u, t, udg_temp_r, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_COLD, WEAPON_TYPE_WHOKNOWS)
        call GetEffectUnit(t, LEVEL, 2)
        set bj_groupCountUnits = bj_groupCountUnits - 1
      endloop
    elseif ( LEVEL >= 5 ) then
      set LEVEL = R2I(GetRandomReal(1., 4.999))
      if ( LEVEL <= 1 ) then
        set udg_temp_s = "마레네라"
      elseif ( LEVEL <= 2 ) then
        set udg_temp_s = "테라미에라"
      elseif ( LEVEL <= 3 ) then
        set udg_temp_s = "아듀레나"
      else
        set udg_temp_s = "플라메라"
      endif
      set udg_SYSTEM_DamgeColor = udg_temp_s
      call UnitDamageTarget(u, t, udg_temp_r, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_COLD, WEAPON_TYPE_WHOKNOWS)
    elseif ( LEVEL >= 2 ) then
      set LEVEL = R2I(GetRandomReal(1., 4.999))
      if ( LEVEL <= 1 ) then
        set udg_temp_s = "마레누스"
      elseif ( LEVEL <= 2 ) then
        set udg_temp_s = "테라미쿠스"
      elseif ( LEVEL <= 3 ) then
        set udg_temp_s = "아듀로스"
      else
        set udg_temp_s = "플라무스"
      endif
      set udg_SYSTEM_DamgeColor = udg_temp_s
      call UnitDamageTarget(u, t, udg_temp_r, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_COLD, WEAPON_TYPE_WHOKNOWS)
    else
      set LEVEL = R2I(GetRandomReal(1., 4.999))
      if ( LEVEL <= 1 ) then
        set udg_temp_s = "마레노"
      elseif ( LEVEL <= 2 ) then
        set udg_temp_s = "테라미코"
      elseif ( LEVEL <= 3 ) then
        set udg_temp_s = "아듀로"
      else
        set udg_temp_s = "플라모"
      endif
      set udg_SYSTEM_DamgeColor = udg_temp_s
      call UnitDamageTarget(u, t, udg_temp_r, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_COLD, WEAPON_TYPE_WHOKNOWS)
    endif
    set udg_SYSTEM_DamgeColor = ""
  endif
  call DestroyGroup(g)
  set g = null
  set t = null
endfunction
function AntiMagic takes unit t, string s returns boolean
  if ( GetRandomReal(0.,100.) <= udg_SysC_MissMagic[GetPlayerId(GetOwningPlayer(t))+1] ) then
    call MSG(GetOwningPlayer(t), 2, 5., "|cff46ffff마법 방어 !! |r- |cff9932cc" + s + "|r")
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\ReplenishManaCasterOverhead.mdl", t, "overhead"))
    call Bufftt(CreateTextTagUnitBJ("Miss !!", t, -50., 15., 100.00, 0, 50., 20.), 10)
    return true
  endif
 return false
endfunction
function AI_Skill_b takes unit u returns nothing
  local group g = AI_Group(CreateGroup(),u,-150.,Condition(function AI_Condi_2))
  local unit t = GetGRU(g)
  local integer LEVEL = FAI_LEVEL(GetUnitLevel(u)+LoadInteger(udg_hash, GetHandleId(u), StringHash("Level")))
  if ( t != null ) then
    if ( LEVEL >= 7 ) and ( GetRandomReal(0.,100.) <= 6. ) and ( GetUnitAbilityLevel(u, 'A047') > 0 ) then
      if ( not AntiMagic(t, "데스") ) then
        call Fdmg(u, t, GetUnitState(t, UNIT_STATE_MAX_LIFE)*.1, 2., 3)
        call MSG(GetOwningPlayer(t), 2, 5., "|c00ff0000" + GetUnitName(u) + "|c00d1d1d1(이)가 당신에게 |c00baf1e7데스|c00d1d1d1(을)를 시전하여, |cff0080ff죽음의 기운|c00d1d1d1이 당신을 감쌉니다.")
        set bj_lastCreatedUnit = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'e000', GetUnitX(t), GetUnitY(t), bj_UNIT_FACING)
        call SetUnitAbilityLevel(bj_lastCreatedUnit, 'A01M', 3)
        call IssueTargetOrderById(bj_lastCreatedUnit, OrderId("cripple"), t)
        call RemoveUnit(bj_lastCreatedUnit)
        set bj_lastCreatedUnit = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'e00Z', GetUnitX(t), GetUnitY(t), bj_UNIT_FACING)
        call SetUnitFlyHeight(bj_lastCreatedUnit, -200., 200.)
      endif
    elseif ( LEVEL >= 5 ) and ( GetRandomReal(0.,94.) <= 12. ) then
      if ( GetUnitAbilityLevel(t, 'B010') > 0 ) and ( GetRandomReal(0.,100.) <= 70. ) then
        call MSG(GetOwningPlayer(t), 2, 3., "|cff46ffff마법 반사 !!|r - |cff9932cc" + "나르콜리")
        call Bufftt(CreateTextTagUnitBJ("Reflect !!", t, -30., 12., 0., 75., 50., 20.), 8)
        call Narcoly(t, u, 5+LEVEL)
      elseif ( not AntiMagic(t, "나르콜리") ) then
        call MSG(GetOwningPlayer(t), 2, 5., "|c00ff0000" + GetUnitName(u) + "|c00d1d1d1(이)가 당신에게 |c00baf1e7나르콜리|c00d1d1d1(을)를 시전하여, "+I2S(5+LEVEL)+"초간 |cff0080ff수면|c00d1d1d1 상태에 빠져듭니다...")
        call Narcoly(u, t, 5+LEVEL)
      endif
    elseif ( LEVEL >= 4 ) and ( GetRandomReal(0.,82.) <= 18. ) then
      if ( GetUnitAbilityLevel(t, 'B010') > 0 ) and ( GetRandomReal(0.,100.) <= 70. ) then
        call MSG(GetOwningPlayer(t), 2, 3., "|cff46ffff마법 반사 !!|r - |cff9932cc" + "소루마")
        call Bufftt(CreateTextTagUnitBJ("Reflect !!", t, -30., 12., 0., 75., 50., 20.), 8)
        call Dummier(GetOwningPlayer(t),u,-1,'A01Q',"thunderbolt")
      elseif ( not AntiMagic(t, "소루마") ) then
        call ED(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathTargetArt.mdl", t, "origin"), 3.)
        call Dummier(Player(PLAYER_NEUTRAL_AGGRESSIVE),t,-1,'A01Q',"thunderbolt")
        call MSG(GetOwningPlayer(t), 2, 5., "|c00ff0000" + GetUnitName(u) + "|c00d1d1d1(이)가 당신에게 |c00baf1e7소루마|c00d1d1d1(을)를 시전하여, |cff0080ff결빙|c00d1d1d1 상태에 걸렸습니다.")
      endif
    elseif ( LEVEL >= 3 ) and ( GetRandomReal(0.,64.) <= 24. ) then
      if ( not AntiMagic(t, "베노미") ) then
        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\Darksummoning\\DarkSummonTarget.mdl", GetUnitX(t), GetUnitY(t)) )
        set bj_lastCreatedUnit = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'e000', GetUnitX(t), GetUnitY(t), bj_UNIT_FACING)
        call SetUnitAbilityLevel(bj_lastCreatedUnit, 'A01M', 2)
        call IssueTargetOrderById(bj_lastCreatedUnit, OrderId("cripple"), t)
        call RemoveUnit(bj_lastCreatedUnit)
        //6%데미지 x 1+등급(1~9) (12~54% 데미지)
        call Fdmg( u, t, GetUnitState(t,UNIT_STATE_MAX_LIFE)*.06, 2.5, 1+LEVEL)
        call MSG(GetOwningPlayer(t), 2, 5., "|c00ff0000" + GetUnitName(u) + "|c00d1d1d1(이)가 당신에게 |c00baf1e7베노미|c00d1d1d1(을)를 시전하여, |cff0080ff중독|c00d1d1d1 상태에 걸렸습니다.")
      endif
    else
      if ( LEVEL >= 8 ) and ( GetUnitAbilityLevel(u, 'A047') > 0 ) then
        set udg_temp_s = "어둠의각인"
        set LEVEL = 5
      elseif ( LEVEL >= 6 ) then
        set udg_temp_s = "프라보"
        set LEVEL = 4
      elseif ( LEVEL >= 4 ) then
        set udg_temp_s = "데프레코"
        set LEVEL = 3
      elseif ( LEVEL >= 2 ) then
        set udg_temp_s = "바르도"
        set LEVEL = 2
      else
        set udg_temp_s = "렌토"
        set LEVEL = 1
      endif
      if ( not AntiMagic(t, udg_temp_s) ) then
        call Curse(u,t,75,LEVEL)
        call UnitAddAbility(u, 'A02J')
      endif
    endif
  endif
  set g = null
  set t = null
endfunction
function AI_Skill_c takes unit u returns nothing
  local group g = AI_Group(CreateGroup(),u,0.,Condition(function AI_Condi_3))
  local unit t = FirstOfGroup(g)
  local real r = GetUnitState(t, UNIT_STATE_MAX_LIFE) * 0.05
  
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", t, "origin"))
  
  call SetWidgetLife(t, GetWidgetLife(t)+r)
  call KillUnit(u)
  
  call DestroyGroup(g)
  set g = null
  set t = null
endfunction
function AI_Skill_d takes unit u returns nothing
//300범위: 950-650
 local group g = AI_Group(CreateGroup(),u,-650.,Condition(function AI_Condi_2))
 local unit t = FirstOfGroup(g)
  loop
    exitwhen t == null
    if ( GetRandomReal(0., 100.) <= 25. ) then
      call Fdmg(u, t, GetWidgetLife(t) * GetRandomReal(0.,.33), 4.00, 4 )
      call MSG(GetOwningPlayer(t), 2, 5., "|c00ff0000" + GetUnitName(u) + "|c00d1d1d1(이)가 당신에게 |c00baf1e7데스|c00d1d1d1(을)를 시전하여, |cff0080ff죽음의 기운|c00d1d1d1이 당신을 감쌉니다.")
      set bj_lastCreatedUnit = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'e000', GetUnitX(t), GetUnitY(t), bj_UNIT_FACING)
      call SetUnitAbilityLevel(bj_lastCreatedUnit, 'A01M', 3)
      call IssueTargetOrderById(bj_lastCreatedUnit, OrderId("cripple"), t)
      call RemoveUnit(bj_lastCreatedUnit)
      set bj_lastCreatedUnit = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'e00Z', GetUnitX(t), GetUnitY(t), bj_UNIT_FACING)
      call SetUnitFlyHeight(bj_lastCreatedUnit, -200., 200.)
    elseif ( GetRandomReal(0., 75.) <= 25. ) then
      call MSG(GetOwningPlayer(t), 2, 5., "|c00ff0000" + GetUnitName(u) + "|c00d1d1d1(이)가 당신에게 |c00baf1e7나르콜리|c00d1d1d1(을)를 시전하여, "+I2S(10)+"초간 |cff0080ff수면|c00d1d1d1 상태에 빠져듭니다...")
      call Narcoly(u, t, 10.)
    elseif ( GetRandomReal(0., 50.) <= 25. ) then
      call ED(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathTargetArt.mdl", t, "origin"), 3.)
      call Dummier(Player(PLAYER_NEUTRAL_AGGRESSIVE),t,-1,'A01Q',"thunderbolt")
      call MSG(GetOwningPlayer(t), 2, 5., "|c00ff0000" + GetUnitName(u) + "|c00d1d1d1(이)가 당신에게 |c00baf1e7소루마|c00d1d1d1(을)를 시전하여, |cff0080ff결빙|c00d1d1d1 상태에 걸렸습니다.")
    elseif ( not AntiMagic(t, "어둠의각인") ) then
      call Curse(u,t,75,5)
    endif
    call GroupRemoveUnit(g, t)
    set t = FirstOfGroup(g)
  endloop
 call KillUnit(u)
 call DestroyGroup(g)
 set g = null
 set t = null
endfunction
function AI_Skill_9 takes unit u returns nothing
  local group g = AI_Group(CreateGroup(),u,0.,Condition(function AI_Condi_2))
  local unit t = GetGRU(g)
  local real Random = GetRandomReal(0., 100.)
  if ( t != null ) then
    if ( Random <= 25. ) then
      call Fdmg(u, t, GetWidgetLife(t) * GetRandomReal(0.,.33), 4.00, 4 )
      call MSG(GetOwningPlayer(t), 2, 5., "|c00ff0000" + GetUnitName(u) + "|c00d1d1d1(이)가 당신에게 |c00baf1e7데스|c00d1d1d1(을)를 시전하여, |cff0080ff죽음의 기운|c00d1d1d1이 당신을 감쌉니다.")
      set bj_lastCreatedUnit = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'e000', GetUnitX(t), GetUnitY(t), bj_UNIT_FACING)
      call SetUnitAbilityLevel(bj_lastCreatedUnit, 'A01M', 3)
      call IssueTargetOrderById(bj_lastCreatedUnit, OrderId("cripple"), t)
      call RemoveUnit(bj_lastCreatedUnit)
      set bj_lastCreatedUnit = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'e00Z', GetUnitX(t), GetUnitY(t), bj_UNIT_FACING)
      call SetUnitFlyHeight(bj_lastCreatedUnit, -200., 200.)
    elseif ( Random <= 50. ) then
      call MSG(GetOwningPlayer(t), 2, 5., "|c00ff0000" + GetUnitName(u) + "|c00d1d1d1(이)가 당신에게 |c00baf1e7나르콜리|c00d1d1d1(을)를 시전하여, "+I2S(10)+"초간 |cff0080ff수면|c00d1d1d1 상태에 빠져듭니다...")
      call Narcoly(u, t, 10.)
    elseif ( Random <= 75. ) then
      call ED(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathTargetArt.mdl", t, "origin"), 3.)
      call Dummier(Player(PLAYER_NEUTRAL_AGGRESSIVE),t,-1,'A01Q',"thunderbolt")
      call MSG(GetOwningPlayer(t), 2, 5., "|c00ff0000" + GetUnitName(u) + "|c00d1d1d1(이)가 당신에게 |c00baf1e7소루마|c00d1d1d1(을)를 시전하여, |cff0080ff결빙|c00d1d1d1 상태에 걸렸습니다.")
    elseif ( not AntiMagic(t, "어둠의각인") ) then
      call Curse(u,t,75,5)
      call UnitAddAbility(u, 'A02J')
    endif
  endif
 call DestroyGroup(g)
 set g = null
 set t = null
endfunction
constant function ZombieColor takes integer ut returns integer
  if ( ut == 'n048' ) then
    return 64
  elseif ( ut == 'n047' ) then
    return 96
  else
    return 80
  endif
endfunction
function AI_Skill_e takes unit u, boolean mu returns nothing
 local integer c = 2
  if ( mu ) then
    set c = c + 1
  endif
  loop
    set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(u), GetUnitTypeId(u), GetWidgetX(u), GetWidgetY(u), GetRandomReal(0,360))
    call SaveReal(udg_hash, GetHandleId(bj_lastCreatedUnit), StringHash("BonusHP"), (LoadReal(udg_hash, GetHandleId(u), StringHash("BonusHP"))-1.)*.5)
    
    call SetUnitState(bj_lastCreatedUnit, UNIT_STATE_MAX_LIFE, GetUnitState(u, UNIT_STATE_MAX_LIFE))
    call SetWidgetLife(bj_lastCreatedUnit, GetUnitState(bj_lastCreatedUnit, UNIT_STATE_MAX_LIFE)*.5)
    call SetUnitVertexColor(bj_lastCreatedUnit, ZombieColor(GetUnitTypeId(u)), ZombieColor(GetUnitTypeId(u)), ZombieColor(GetUnitTypeId(u)), 255)
    if ( mu ) then
      call SetUnitScale(bj_lastCreatedUnit, 1.45, 1.45, 1.45)
    else
      call SetUnitScale(bj_lastCreatedUnit, .9, .9, .9)
    endif
    
    exitwhen c <= 1
    set c = c - 1
  endloop
endfunction


function AI_UseSkill takes unit u, string s returns nothing
  set udg_temp_AI_u = u
  if ( s == "1" ) then
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 0)
    call SetTextTagText(bj_lastCreatedTextTag, "죽음의 손길 !", .035)
    call Bufftt(bj_lastCreatedTextTag, 5)
    call AI_Skill_1(u)
  elseif ( s == "2" ) then
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 0)
    call SetTextTagText(bj_lastCreatedTextTag, "메테오 !", .035)
    call AI_Skill_2(u)
  elseif ( s == "3" ) then
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 0)
    call SetTextTagText(bj_lastCreatedTextTag, "회복 !!", .035)
    call AI_Skill_3(u)
  elseif ( s == "#" ) then
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 0)
    call SetTextTagText(bj_lastCreatedTextTag, "회복 !", .015)
    call AI_Skill_3(u)
  elseif ( s == "4" ) then
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 0)
    call SetTextTagText(bj_lastCreatedTextTag, "소환 !!", .035)
    call AI_Skill_4(u)
  elseif ( s == "$" ) then
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 0)
    call SetTextTagText(bj_lastCreatedTextTag, "소환 !", .035)
    call AI_Skill_4(u)
  elseif ( s == "5" ) then
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 0)
    call SetTextTagText(bj_lastCreatedTextTag, "분노 !", .035)
    call AI_Skill_5(u)
  elseif ( s == "6" ) then
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 0)
    call SetTextTagText(bj_lastCreatedTextTag, "지진 !", .035)
    call AI_Skill_6(u)
  elseif ( s == "7" ) then
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 0)
    call SetTextTagText(bj_lastCreatedTextTag, "딜루메니 !", .035)
    call AI_Skill_7(u)
  elseif ( s == "8" ) then
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 0)
    call SetTextTagText(bj_lastCreatedTextTag, "블리자드 !", .035)
    call AI_Skill_8(u)
  elseif ( s == "9" ) then
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 0)
    call SetTextTagText(bj_lastCreatedTextTag, "디버프 !", .035)
    call AI_Skill_9(u)
  elseif ( s == "a" ) then
    call AI_Skill_a(u)
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 0)
    call SetTextTagText(bj_lastCreatedTextTag, udg_temp_s+" !", .035)
  elseif ( s == "b" ) then
    call AI_Skill_b(u)
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 0)
    call SetTextTagText(bj_lastCreatedTextTag, udg_temp_s+" !", .035)
  elseif ( s == "c" ) then
    call AI_Skill_c(u)
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 0)
    call SetTextTagText(bj_lastCreatedTextTag, "회복 !", .035)
  elseif ( s == "d" ) then
    call AI_Skill_d(u)
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 0)
    call SetTextTagText(bj_lastCreatedTextTag, "자폭 !!", .035)
  elseif ( s == "e" ) then
    call AI_Skill_e(u, GetUnitAbilityLevel(u,'A047')>0)
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 0)
    call SetTextTagText(bj_lastCreatedTextTag, "좀비 소환", .035)
  else
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 0)
    call SetTextTagText(bj_lastCreatedTextTag, "Bug ! - " + (s), .035)
    call Bufftt(bj_lastCreatedTextTag, 5)
    return
  endif
  call Bufftt(bj_lastCreatedTextTag, 5)

  call SetUnitAnimation(u, "spell")
  call PauseUnit(u, false)
  //애니메이션 초기화
  call TimeAction(u, 1., 21)
  call UnitRemoveAbility(u, 'A093')
  call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u,UNIT_STATE_MANA)-1.)
endfunction
constant function AI_GuegeAccel takes real HPper, boolean Mu, boolean Boss returns real
  if ( Boss ) then
    return 4. - (HPper*3.)
  elseif ( Mu ) then
    return 3. - (HPper*2.)
  else
    return 2. - HPper
  endif
endfunction
function AI_GuegeLoop takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer i = LoadInteger(udg_hash, GetHandleId(t), StringHash("FAI-G"))
  local integer i2 = LoadInteger(udg_hash, GetHandleId(t), StringHash("FAI-G2")) + 1
  local unit u = LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("FAI-Unit"))
  local texttag tx = LoadTextTagHandle(udg_hash, GetHandleId(t), StringHash("FAI-Tag"))
  call SaveInteger(udg_hash, GetHandleId(t), StringHash("FAI-G2"), i2)

  if ( i2 < i ) and ( UnitAlive(u) ) and ( GetUnitAbilityLevel(u, 'A093')+GetUnitAbilityLevel(u, 'A02S') > 0 ) then
    call SetTextTagText(tx, AI_text(i2,i), .023)
    call SetTextTagPos(tx, GetWidgetX(u), GetWidgetY(u), 30)
  else
    if ( i2 != 0 and i2 == i ) then
      call SetTextTagText(tx, AI_text(i2,0), .023)
      call AI_UseSkill(u, LoadStr(udg_hash, GetHandleId(t), StringHash("FAI-S")))
    elseif ( GetUnitAbilityLevel(u, 'A093') == 0 ) then
      set bj_lastCreatedTextTag = CreateTextTag()
      call SetTextTagPos(bj_lastCreatedTextTag, GetWidgetX(u), GetWidgetY(u), 30)
      call SetTextTagText(bj_lastCreatedTextTag, "Stuck", .035)
      call Bufftt(bj_lastCreatedTextTag, 3)
    endif
    call FlushChildHashtable(udg_hash, GetHandleId(t))
    call DestroyTextTag(tx)
    call DestroyTimer(t)
  endif
  set t = null
  set u = null
  set tx = null
endfunction
function AI_Guege takes unit u, string s, integer i, real r, boolean o returns nothing
  local timer t = CreateTimer()
  if ( o ) then
    if ( i == 0 ) then
      call AI_UseSkill(u,s)
    else
      //보스 40%체력 미만 면역추가
      if ( GetUnitAbilityLevel(u, 'A00O') == 1 ) and ( GetUnitAbilityLevel(u, 'A02S') == 0 ) and ( GetWidgetLife(u)/GetUnitState(u, UNIT_STATE_MAX_LIFE) < .4 ) then
        call UnitAddAbility(u, 'A02S')
        set bj_lastCreatedTextTag = CreateTextTag()
        call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 50)
        call SetTextTagText(bj_lastCreatedTextTag, "Immune !", .035)
        call Bufftt(bj_lastCreatedTextTag, 5)
        call SetWidgetLife(u, GetUnitState(u, UNIT_STATE_MAX_LIFE)*.5)
        call SetUS2("Mdmg", bj_lastCreatedUnit, 2.)
        call SetUS("DMG", bj_lastCreatedUnit, 500, true)
        call SetUS2("Miss", bj_lastCreatedUnit, 15.)
        
        call SetUS("ARMOR", bj_lastCreatedUnit, 30, true)
        call SetUS("MAC", bj_lastCreatedUnit, 30, true)
      endif
      call UnitRemoveAbility(u, 'A093')
      call UnitAddAbility(u, 'A093')
      if ( AI_SKILL_DATA(s,"STUCK") > 1. ) then
        call SetUnitAbilityLevel(u, 'A093', R2I(AI_SKILL_DATA(s,"STUCK")))
      endif
      call Stuck_Color(u, R2I(AI_SKILL_DATA(s,"STUCK")))
      
      call SaveInteger(udg_hash, GetHandleId(t), StringHash("FAI-G"), i)
      call SaveInteger(udg_hash, GetHandleId(t), StringHash("FAI-G2"), 0)
      call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("FAI-Unit"), u)
      call SaveStr(udg_hash, GetHandleId(t), StringHash("FAI-S"), s)
      set bj_lastCreatedTextTag = CreateTextTag()
      call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 0)
      call SaveTextTagHandle(udg_hash, GetHandleId(t), StringHash("FAI-Tag"), bj_lastCreatedTextTag)
      call SetTextTagText(bj_lastCreatedTextTag, AI_text(0,i), .023)
      set bj_lastCreatedTextTag = null
      if ( GetUnitLevel(u) < 99 ) then /* 99 미만 몬스터 정지 */
        call PauseUnit(u, true)
      endif
      call TimerStart(t, .25/AI_GuegeAccel(GetWidgetLife(u)/GetUnitState(u, UNIT_STATE_MAX_LIFE),GetUnitAbilityLevel(u, 'A047') == 1, GetUnitAbilityLevel(u, 'A00O') == 1), true, function AI_GuegeLoop)

      set t = CreateTimer()
    endif
  endif
  call SaveStr(udg_hash, GetHandleId(t), StringHash("FAI-S"), s)
  call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("FAI-Unit"), u)
  call TimerStart(t, r, false, function AI_Cooldown)
  
  set t = null
endfunction
constant function AI_GuegeTime takes string s returns integer
  if ( s == "1" ) then
    return 20
  elseif ( s == "2" ) then
    return -20
  elseif ( s == "3" ) then
    return 5
  elseif ( s == "4" ) then
    return 15
  elseif ( s == "$" ) then
    return 28
  elseif ( s == "5" ) then
    return 7
  elseif ( s == "6" ) then
    return 30
  elseif ( s == "8" ) then
    return -30
  elseif ( s == "9" ) then
    return 16
  elseif ( s == "a" ) then
    return 24
  elseif ( s == "b" ) then
    return 20
  elseif ( s == "e" ) then
    return 28
  else
    return 0
  endif
endfunction
constant function AI_CoolTime takes string s returns real
  if ( s == "1" ) then
    return 30.
  elseif ( s == "2" ) then
    return 60.
  elseif ( s == "3" ) then
    return 8.
  elseif ( s == "#" ) then
    return 24.
  elseif ( s == "4" ) then
    return 40.
  elseif ( s == "$" ) then
    return 30.
  elseif ( s == "5" ) then
    return 30.
  elseif ( s == "6" ) then
    return 35.
  elseif ( s == "7" ) then
    return 25.
  elseif ( s == "8" ) then
    return 35.
  elseif ( s == "a" ) then
    return 15.
  elseif ( s == "b" ) then
    return 60.
  elseif ( s == "e" ) then
    return 30.
  else
    return 0.
  endif
endfunction
function AI_CondiCheck takes unit u, string s returns boolean
  local group g
  if ( GetUnitState(u,UNIT_STATE_MANA) < 1. ) then
    set g = null
    return false
  endif
  if ( s == "3" ) or ( s == "#" ) then
  //힐: 본인 아군대상
    set g = AI_Group(CreateGroup(),u,-200,Condition(function AI_Condi_1))
    return true
  else
    set g = AI_Group(CreateGroup(),u,0,Condition(function AI_Condi_2))
  endif
  set bj_groupCountUnits = 0
  call ForGroup(g, function CountUnitsInGroupEnum)
  call DestroyGroup(g)
  set g = null
  return bj_groupCountUnits != 0
endfunction

function AI_Boss takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local unit u = LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("FAI-Unit"))
  local string s = LoadStr(udg_hash, GetHandleId(u), StringHash("FAI-Set2"))
  local integer i = 0
//debug call BJDebugMsg("AI_Boss: Timer: " + R2S(TimerGetTimeout(t)))
  if ( GetWidgetLife(u) > 0.4 ) and ( s != null ) then
    //모든 스킬 끝나고 쿨 기다림
    if ( StringLength(s) > 0 ) then
    
      set i = GetRandomInt(0,StringLength(s))
//debug call BJDebugMsg("AI_Boss: s/i/s " + s +"/" +I2S(i)+"/"+SubString(s,i-1,i))
      if ( s == SubString(s,i,i+1) ) then
        call SaveStr(udg_hash, GetHandleId(u), StringHash("FAI-Set2"), "")
      else
        call SaveStr(udg_hash, GetHandleId(u), StringHash("FAI-Set2"), SubString(s,0,i-1) + SubString(s,i,StringLength(s)))
      endif
      set s = SubString(s,i,i+1)
      
      if ( StringLength(s) > 0 ) then
        //마나 혹은 대상 없을때
        
        if ( AI_CondiCheck(u,s) ) then
          if ( ISBOSS(GetUnitTypeId(u)) > 0 ) then
            //페이즈 확인
            set i = LoadInteger(udg_hash, GetHandleId(u), StringHash("FAI-Phase")) -1
            
            //스킬 캐스팅
            call AI_Guege(u, s, R2I((AI_SKILL_DATA(s, "CASTING")-(i*AI_SKILL_DATA(s, "CASTING_P-")))*4.), R2I((AI_SKILL_DATA(s, "COOL")-(i*AI_SKILL_DATA(s, "COOL_P-")))*4.), true)
//debug call BJDebugMsg("AI_Boss: " + I2S(i)+"/"+I2S(R2I((AI_SKILL_DATA(s, "CASTING")-(i*AI_SKILL_DATA(s, "CASTING_P-")))*4.))+"/"+I2S(R2I((AI_SKILL_DATA(s, "COOL")-(i*AI_SKILL_DATA(s, "COOL_P-")))*4.)))
            //스킬 쿨
            call TimerStart(t, AI_SKILL_DATA(s, "CASTING")-(i*AI_SKILL_DATA(s, "CASTING_P-"))+AI_SKILL_DATA(s, "COOL_N"), false, function AI_Boss)
          else
            if ( AI_GuegeTime(s) < 0 ) and ( not AI_Skill_2a(u) ) then
            call AI_Guege(u, s, 0, 3., false)
            else
            call AI_Guege(u, s, AI_GuegeTime(s), AI_CoolTime(s), true)
            endif
            //속도 증가(차징 시작 기준): 체력 100% : 스킬쿨 2배 후 사용   ~ 0% : 스킬 후 바로 사용
            call TimerStart(t, RMaxBJ(5., AI_GuegeTime(s)/4.*(1.+GetWidgetLife(u)/GetUnitState(u,UNIT_STATE_MAX_LIFE))), false, function AI_Boss)
          endif
        else
          //주변에 적이 없을때, 3~10초에 한번 스킬 사용
          call AI_Guege(u, s, 0, 3., false)
          call TimerStart(t, RMinBJ(10.,TimerGetTimeout(t)+1.), false, function AI_Boss)
        endif
      endif
    else
//debug call BJDebugMsg("AI_Boss: Reset \"" + s + "\"")
      //1초마다 스킬 비교, 생기면 사용
      call TimerStart(t, 1., false, function AI_Boss)
    endif
  else
    call FlushChildHashtable(udg_hash, GetHandleId(t))
    call DestroyTimer(t)
  endif
  set t = null
  set u = null
  set s = null
  set i = 0
endfunction
function AI_Check takes unit u returns boolean
  if ( LoadStr(udg_hash, GetHandleId(u), StringHash("FAI-Set2")) != null ) then
    call SetUnitState(u,UNIT_STATE_MAX_MANA, GetUnitState(u,UNIT_STATE_MANA)+StringLength(LoadStr(udg_hash, GetHandleId(u), StringHash("FAI-Set2"))))
    call SetUnitState(u,UNIT_STATE_MANA, GetUnitState(u,UNIT_STATE_MAX_MANA))
    set bj_lastStartedTimer = CreateTimer()
    call SaveTimerHandle(udg_hash, GetHandleId(u), StringHash("FAI-Timer"), bj_lastStartedTimer)
    call SaveUnitHandle(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("FAI-Unit"), u)
    call TimerStart(bj_lastStartedTimer, GetRandomReal(3.,10.), false, function AI_Boss)
    return true
  endif
  return false
endfunction
//FAI==================================================
function BossSetting takes unit u returns nothing
  if ( ISBOSS(GetUnitTypeId(u)) == 1 ) then
  //킹아크퍼스
    
    // 저장된 스킬 : "1"
    call SaveStr(udg_hash, GetHandleId(u), StringHash("FAI-Set2"), "19")
    
    
    //저장된 필드: 1번필드
    call SaveRectHandle(udg_hash, GetHandleId(u), StringHash("FAI-Rect"), BOSSRECT(1))
    
    
    //현재 페이즈: 4페이즈(기본 / 70% / 40% / 10%)
    call SaveInteger(udg_hash, GetHandleId(u), StringHash("FAI-Phase"), 1)
    
    //다음 페이즈 체력%
    call SaveReal(udg_hash, GetHandleId(u), StringHash("FAI-Phase2"), .7)
    call SaveReal(udg_hash, GetHandleId(u), StringHash("FAI-Phase3"), .4)
    call SaveReal(udg_hash, GetHandleId(u), StringHash("FAI-Phase4"), .1)

    call TriggerRegisterUnitEvent(gg_trg_Sys_Boss1_Dead, u, EVENT_UNIT_DEATH)

    //실행
    call AI_Check(u)
  endif
endfunction
function Trig_Sys_Dmg_Add_Actions takes nothing returns nothing
  if ( IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) ) then
    if ( isPlaying(GetOwningPlayer(GetTriggerUnit())) ) then
      call AddDmgEvt(GetTriggerUnit())
	  call TriggerRegisterUnitEvent(gg_trg_Sys_NoPatroll, GetTriggerUnit(), EVENT_UNIT_ISSUED_POINT_ORDER)
	  call TriggerRegisterUnitEvent(gg_trg_Sys_NoTeamKill, GetTriggerUnit(), EVENT_UNIT_ATTACKED)
      call TriggerRegisterUnitEvent(gg_trg_Quest_Attack, GetTriggerUnit(), EVENT_UNIT_ISSUED_TARGET_ORDER)
    endif
  elseif ( GetOwningPlayer(GetTriggerUnit()) == Player(PLAYER_NEUTRAL_AGGRESSIVE) ) then
    call AddDmgEvt(GetTriggerUnit())
	if ( GetUnitTypeId(GetTriggerUnit()) == 'o001' ) then
	  call TriggerRegisterUnitEvent(gg_trg_Sys_Dummy_Attacked, GetTriggerUnit(), EVENT_UNIT_DAMAGED)
	elseif ( ISBOSS(GetUnitTypeId(GetTriggerUnit())) > 0 ) then
      call BossSetting(GetTriggerUnit())
    elseif ( GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_MANA) >= 1. ) then
      if ( HaveSavedString(udg_hash, GetUnitTypeId(GetTriggerUnit()), StringHash("FAI-Set")) ) then
        call SaveStr(udg_hash, GetHandleId(GetTriggerUnit()), StringHash("FAI-Set2"), LoadStr(udg_hash, GetUnitTypeId(GetTriggerUnit()), StringHash("FAI-Set"))+LoadStr(udg_hash, GetHandleId(GetTriggerUnit()), StringHash("FAI-Set2")))
      elseif ( HaveSavedString(udg_hash, GetHandleId(GetTriggerUnit()), StringHash("FAI-Set2")) ) then
        call SaveStr(udg_hash, GetHandleId(GetTriggerUnit()), StringHash("FAI-Set2"), LoadStr(udg_hash, GetUnitTypeId(GetTriggerUnit()), StringHash("FAI-Set"))+LoadStr(udg_hash, GetHandleId(GetTriggerUnit()), StringHash("FAI-Set2")))
      endif
      if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A047') == 1 ) and ( GetRandomReal(0., 100.) <= 50. ) then
        call SaveStr(udg_hash, GetHandleId(GetTriggerUnit()), StringHash("FAI-Set2"), LoadStr(udg_hash, GetUnitTypeId(GetTriggerUnit()), StringHash("FAI-Set"))+LoadStr(udg_hash, GetHandleId(GetTriggerUnit()), StringHash("FAI-Set2"))+"ab#7$")
      
      //15% 저주
      elseif ( GetRandomReal(0.,100.) <= 15. ) then
        call SaveStr(udg_hash, GetHandleId(GetTriggerUnit()), StringHash("FAI-Set2"), LoadStr(udg_hash, GetUnitTypeId(GetTriggerUnit()), StringHash("FAI-Set"))+LoadStr(udg_hash, GetHandleId(GetTriggerUnit()), StringHash("FAI-Set2"))+"b")
      
      //3써클 이상 몬스터, 투명 감지 3%
      elseif ( GetUnitLevel(GetTriggerUnit()) > 40 ) and ( GetRandomReal(0.,85.) <= 1. ) then
        call UnitAddAbility(GetEnteringUnit(), 'A06F')
        
      //0~33% 마공
      elseif ( GetRandomReal(0.,84.) <= GetUnitLevel(GetTriggerUnit())*.25 ) then
        call SaveStr(udg_hash, GetHandleId(GetTriggerUnit()), StringHash("FAI-Set2"), LoadStr(udg_hash, GetUnitTypeId(GetTriggerUnit()), StringHash("FAI-Set"))+LoadStr(udg_hash, GetHandleId(GetTriggerUnit()), StringHash("FAI-Set2"))+"a")
      
      elseif ( udg_SysA_MapLevel == 3 ) and ( GetRandomReal(0.,52.) <= GetUnitLevel(GetTriggerUnit())*.125 ) then
        call SaveStr(udg_hash, GetHandleId(GetTriggerUnit()), StringHash("FAI-Set2"), LoadStr(udg_hash, GetUnitTypeId(GetTriggerUnit()), StringHash("FAI-Set"))+LoadStr(udg_hash, GetHandleId(GetTriggerUnit()), StringHash("FAI-Set2"))+"a")
      elseif ( udg_SysA_MapLevel == 4 ) and ( GetRandomReal(0.,52.) <= GetUnitLevel(GetTriggerUnit())*.25 ) then
        call SaveStr(udg_hash, GetHandleId(GetTriggerUnit()), StringHash("FAI-Set2"), LoadStr(udg_hash, GetUnitTypeId(GetTriggerUnit()), StringHash("FAI-Set"))+LoadStr(udg_hash, GetHandleId(GetTriggerUnit()), StringHash("FAI-Set2"))+"a")
      endif
      call AI_Check(GetTriggerUnit())
	endif
  endif
endfunction

//===========================================================================
function InitTrig_Sys_Dmg_Add takes nothing returns nothing
    set gg_trg_Sys_Dmg_Add = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Sys_Dmg_Add, function Trig_Sys_Dmg_Add_Actions )
endfunction//===========================================================================
// Trigger: Sys MT Set
//===========================================================================
native JNSetLog takes string MapId, string UserId, string SecretKey, string Character, string Version, string Loging returns string

function SimpleMB takes multiboard mb, integer col, integer row, string val, real width returns nothing
 local multiboarditem mbitem = MultiboardGetItem(mb, row-1, col-1)
  if ( val != null ) then
    call MultiboardSetItemValue(mbitem, val)
  else
    call MultiboardSetItemValue(mbitem, "")
  endif
  if ( width >= 0. ) then
    call MultiboardSetItemWidth(mbitem, width/100.)
  endif
  call MultiboardReleaseItem(mbitem)
 set mbitem = null
endfunction
function SimpleMBAll takes multiboard mb returns nothing
  local integer curRow = 0
  local integer curCol = 0
  local integer numRows = MultiboardGetRowCount(mb)
  local integer numCols = MultiboardGetColumnCount(mb)
  local multiboarditem mbitem = null
  loop
    set curRow = curRow + 1
    exitwhen curRow > numRows
    set curCol = 0
    loop
      set curCol = curCol + 1
      exitwhen curCol > numCols
      set mbitem = MultiboardGetItem(mb, curRow-1, curCol-1)
      call MultiboardSetItemStyle(mbitem, true, false)
      call MultiboardSetItemValue(mbitem, "")
      if ( curCol == 3 ) then  
		call MultiboardSetItemWidth(mbitem, 4.5/100.)
	  else
		call MultiboardSetItemWidth(mbitem, 3./100.)
      endif
      call MultiboardReleaseItem(mbitem)
    endloop
  endloop
  set mbitem = null
endfunction
//call SimpleMB(bj_lastCreatedMultiboard, 1, 1, "aa", -1)
constant function MT_Add0 takes integer i returns string
  if ( i < 10 ) then
    return "0"
  else
    return ""
  endif
endfunction

function MT_Loop takes nothing returns nothing
 local integer P = GetPlayerId(GetLocalPlayer())+1
  //매 초 반복 액션
  call SimpleMB(bj_lastCreatedMultiboard, 2, 1, SysStr(2,P) + GetUnitName(udg_Unit[P]), -1)
  call SimpleMB(bj_lastCreatedMultiboard, 3, 1, SysStr(2,P) + I2S(udg_SysB_Level[P]), -1)
  call SimpleMB(bj_lastCreatedMultiboard, 2, 2, "|cffff3315" + I2S(R2I(GetWidgetLife(udg_Unit[P]))), -1)
  call SimpleMB(bj_lastCreatedMultiboard, 3, 2, " ／ |cffff3315" + I2S(R2I(GetUnitState(udg_Unit[P], UNIT_STATE_MAX_LIFE))), -1)
  call SimpleMB(bj_lastCreatedMultiboard, 2, 3, "|cff8bc7fc" + I2S(R2I(GetUnitState(udg_Unit[P], UNIT_STATE_MANA))), -1)
  call SimpleMB(bj_lastCreatedMultiboard, 3, 3, " ／ |cff218def" + I2S(R2I(GetUnitState(udg_Unit[P], UNIT_STATE_MAX_MANA))), -1)
  call SimpleMB(bj_lastCreatedMultiboard, 2, 4, I2S(udg_SysE_STR3[P]), -1)
  call SimpleMB(bj_lastCreatedMultiboard, 3, 4, "[ " + I2S(udg_SysE_STR1[P]) + "+" + I2S(udg_SysE_STR2[P]) + " ]", -1)
  call SimpleMB(bj_lastCreatedMultiboard, 2, 5, I2S(udg_SysE_DEX3[P]), -1)
  call SimpleMB(bj_lastCreatedMultiboard, 3, 5, "[ " + I2S(udg_SysE_DEX1[P]) + "+" + I2S(udg_SysE_DEX2[P]) + " ]", -1)
  call SimpleMB(bj_lastCreatedMultiboard, 2, 6, I2S(udg_SysE_INT3[P]), -1)
  call SimpleMB(bj_lastCreatedMultiboard, 3, 6, "[ " + I2S(udg_SysE_INT1[P]) + "+" + I2S(udg_SysE_INT2[P]) + " ]", -1)
  call SimpleMB(bj_lastCreatedMultiboard, 2, 7, I2S(udg_SysE_WIS3[P]), -1)
  call SimpleMB(bj_lastCreatedMultiboard, 3, 7, "[ " + I2S(udg_SysE_WIS1[P]) + "+" + I2S(udg_SysE_WIS2[P]) + " ]", -1)
  call SimpleMB(bj_lastCreatedMultiboard, 2, 8, I2S(udg_SysE_CON3[P]), -1)
  call SimpleMB(bj_lastCreatedMultiboard, 3, 8, "[ " + I2S(udg_SysE_CON1[P]) + "+" + I2S(udg_SysE_CON2[P]) + " ]", -1)
  
  //자동 최대화 추가 액션
    call SimpleMB(bj_lastCreatedMultiboard, 2, 9, I2S(IMaxBJ(0,udg_SysC_DmgAttack[P])) + "~" + I2S(R2I((udg_SysC_DmgAttack[P]+udg_SysC_DmgAttackAdd[P])*GetDmg(P))) + " (" +udg_SysC_DmgNow[P]+")", -1)
    call SimpleMB(bj_lastCreatedMultiboard, 2, 10, "|cff46ffff"+I2S(udg_SysC_Armor[P]), -1)
    call SimpleMB(bj_lastCreatedMultiboard, 3, 10, "( 감소 " + ( I2S(udg_SysC_Armor[P]/2) + "% )" ), -1)
    call SimpleMB(bj_lastCreatedMultiboard, 2, 11, "|cff46ffff"+I2S(udg_SysC_ArmorM[P]), -1)
    call SimpleMB(bj_lastCreatedMultiboard, 3, 11, "( 마방 " + I2S(R2I(udg_SysC_MissMagic[P])) + "% )", -1)
    call SimpleMB(bj_lastCreatedMultiboard, 2, 12, "|cff9932cc" + I2S(udg_SysC_Regen[P]) + "%", -1)
    call SimpleMB(bj_lastCreatedMultiboard, 3, 12, "(" + LoadStr(udg_hash, P, StringHash("Regen-View")) + ")", -1)
    call SimpleMB(bj_lastCreatedMultiboard, 2, 13, " |c00ff8040+" + I2S(udg_SysC_Dam[P]) + "%", -1)
    call SimpleMB(bj_lastCreatedMultiboard, 3, 13, "/ |c00ff8040+" + R2SW(udg_SysC_Hits[P], 3, 1) + "% ", -1)
    call SimpleMB(bj_lastCreatedMultiboard, 2, 14, "|cffff0080"+R2SW(udg_SysC_CriP[P], 2, 1) + "%", -1)
    call SimpleMB(bj_lastCreatedMultiboard, 3, 14, "( |cffff00ffx" + R2SW(udg_SysC_CriX[P], 2, 2) + " |r)", -1)
    call SimpleMB(bj_lastCreatedMultiboard, 2, 15, "|cff55ff00"+I2S(100+udg_SysK_Exp[P]+udg_SysK_ExpAdd[P])+"%|r/|cff0078ff"+I2S(100+udg_SysK_Drop[P]+udg_SysK_DropAdd[P]) + "%|r/|cfffff200"+I2S(100+udg_SysK_Gold[P]+udg_SysK_GoldAdd[P])+"%", 7.)

  //시간 표시
  if ( udg_MT_TimerMin == 59 ) and ( udg_MT_TimerSec == 59 ) then
    set udg_MT_TimerHou = udg_MT_TimerHou + 1
    set udg_MT_TimerMin = 0
    set udg_MT_TimerSec = 0
    
    if ( udg_MT_TimerHou == 2 ) or ( udg_MT_TimerHou == 4 ) or ( udg_MT_TimerHou == 6 ) or ( udg_MT_TimerHou == 8 ) or ( udg_MT_TimerHou == 10 ) then
    set P = 1
      loop
        if ( TitleGet(P, 2) < udg_MT_TimerHou/2 ) then
          if ( udg_SysB_TitleNow[P] == 2 ) then
            call Title_Reset(P)
          endif
          call TitleSet(P, 2, udg_MT_TimerHou/2)
          call MSG(Player(P-1), 1, 8, "칭호, |cff46ffff좀비 Lv."+I2S(udg_MT_TimerHou/2)+"|cffffdc3c을 받았습니다. (기존 좀비 사라짐)")
        endif
        exitwhen P >= bj_MAX_PLAYERS
        set P = P + 1
      endloop
    endif
    
    set P = 1
    loop
      if ( isPlaying(Player(P-1)) ) then
        if ( Save(P, false) ) then
          call Save2(P)
          
          //자동 저장(서버)
          set udg_temp_i2 = FAL_GetMulti0(P, 0, 0, 4)
          if ( udg_temp_i2 > 0 ) then
          //슬롯 이름저장
            call FAL_SerSlotName(P, udg_temp_i2)
            if ( GetLocalPlayer() == Player(P-1) ) then
              call MSG(Player(P-1), 2, 2, "|c00d962b5＊|cffffdc3c자동저장 되었습니다(서버)|r: " + JNSetLog(JN_MAPID, udg_SysB_Name[P], JN_SECRETKEY, I2S(udg_temp_i2), JNServerTime("MMdd_HHmm")+"_A", FAL_Text(P,udg_temp_i2)+"|"+FSE_ColorX(udg_Save_Code[P])+"|"+FSE_ColorX(udg_Save_Code2[P])))
            endif
            call JN_ServerSave(Player(P-1), udg_temp_i2)
          else
            call FAL_Save1(P)
          endif
        else
          call MSG(Player(P-1), 2, 8, "자동저장 |cffff0000실패! |r - |cffffdc3c수동저장으로 데이터를 보존하세요.")
        endif
        call TriggerSleepAction(1.)
      endif
      exitwhen P >= bj_MAX_PLAYERS
      set P = P + 1
    endloop
        
  elseif ( udg_MT_TimerSec == 59 ) then
    set udg_MT_TimerMin = udg_MT_TimerMin + 1
    set udg_MT_TimerSec = 0
  else
    set udg_MT_TimerSec = udg_MT_TimerSec + 1
  endif
  call SimpleMB(bj_lastCreatedMultiboard, 3, MultiboardGetRowCount(bj_lastCreatedMultiboard), "|cffffffff" + I2S(udg_MT_TimerHou) + ":" + MT_Add0(udg_MT_TimerMin)+I2S(udg_MT_TimerMin) + ":" + MT_Add0(udg_MT_TimerSec)+I2S(udg_MT_TimerSec), -1)
 set P = 0
endfunction
function Trig_Sys_MT_Set_Actions takes nothing returns nothing
  if ( bj_lastCreatedMultiboard == null ) then
  //멀티보드 없음: 생성
    set bj_lastCreatedMultiboard = CreateMultiboard()
    call MultiboardSetRowCount(bj_lastCreatedMultiboard, 17)
    call MultiboardSetColumnCount(bj_lastCreatedMultiboard, 3)
    call MultiboardSetTitleText(bj_lastCreatedMultiboard, BaseStr(9))
    call MultiboardDisplay(bj_lastCreatedMultiboard, true)
    call SimpleMBAll(bj_lastCreatedMultiboard)
    call SimpleMB(bj_lastCreatedMultiboard, 1, 1, "|cff8bc7fc" + udg_SysB_Name[GetPlayerId(GetLocalPlayer())+1] + "|r", 6.5)
    call SimpleMB(bj_lastCreatedMultiboard, 2, 1, null, 3)
    call SimpleMB(bj_lastCreatedMultiboard, 3, 1, null, 1)
    call SimpleMB(bj_lastCreatedMultiboard, 1, 2, "ＨＰ：", -1)
    call SimpleMB(bj_lastCreatedMultiboard, 1, 3, "ＭＰ：", -1)
    call SimpleMB(bj_lastCreatedMultiboard, 1, 4, "|cfff2f200STR|r", -1)
    call SimpleMB(bj_lastCreatedMultiboard, 1, 5, "|cfff2f200DEX|r", -1)
    call SimpleMB(bj_lastCreatedMultiboard, 1, 6, "|cfff2f200INT|r", -1)
    call SimpleMB(bj_lastCreatedMultiboard, 1, 7, "|cfff2f200WIS|r", -1)
    call SimpleMB(bj_lastCreatedMultiboard, 1, 8, "|cfff2f200CON|r", -1)

  //최대화 생성
    call SimpleMB(bj_lastCreatedMultiboard, 1, 9, "공격력", -1)
    call SimpleMB(bj_lastCreatedMultiboard, 2, 9, null, 6.)
    call SimpleMB(bj_lastCreatedMultiboard, 3, 9, null, 0.)
    call SimpleMB(bj_lastCreatedMultiboard, 1, 10, "방어", 3.)
    call SimpleMB(bj_lastCreatedMultiboard, 3, 11, null, 4.5)
    call SimpleMB(bj_lastCreatedMultiboard, 1, 11, "회피", 3.)
    call SimpleMB(bj_lastCreatedMultiboard, 1, 12, "재생력", 3.)
    call SimpleMB(bj_lastCreatedMultiboard, 1, 13, "뎀/힛", 3.)
    call SimpleMB(bj_lastCreatedMultiboard, 1, 14, "치명타", 3.)
    call SimpleMB(bj_lastCreatedMultiboard, 1, 15, "경치/템/골드", 4.)
	call SimpleMB(bj_lastCreatedMultiboard, 1, 17, "경과 시간 : ", 3.5)
  endif
  call MT_Loop()
endfunction

//===========================================================================
function InitTrig_Sys_MT_Set takes nothing returns nothing
  set gg_trg_Sys_MT_Set = CreateTrigger()
  call TriggerAddAction( gg_trg_Sys_MT_Set, function Trig_Sys_MT_Set_Actions )
endfunction

//===========================================================================
// Trigger: Sys Exp Get
//===========================================================================
scope ExpSys
  globals
    private unit killer
    private real bonus
  endglobals
  constant function Exp_Bonus takes integer count returns real
    if ( count == 2 ) then
      return 0.8
    elseif ( count == 3 ) then
      return 0.75
    elseif ( count == 4 ) then
      return 0.7
    elseif ( count == 5 ) then
      return 0.65
    elseif ( count == 6 ) then
      return 0.6
    elseif ( count == 7 ) then
      return 0.55
    elseif ( count == 8 ) then
      return 0.5
    elseif ( count == 9 ) then
      return 0.45
    elseif ( count == 10 ) then
      return 0.4
    elseif ( count == 11 ) then
      return 0.35
    elseif ( count == 12 ) then
      return 0.3
    endif
    return 0.1
  endfunction
  function Cond_NearParty2 takes nothing returns boolean
    return ( UnitAlive(GetFilterUnit()) ) and ( IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) ) and ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] == udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(killer))+1] )
  endfunction
  
  function GiveExp takes unit u, integer exp, integer i returns nothing
    set exp = exp * 2
    if ( i == 1 ) then
      call AddHeroXP(u, exp, true)
      call Bufftt(CreateTextTagUnitBJ("*Exp +" + ExpI2S(exp), GetDyingUnit(), -90., 9., 33., 100., 0., 0), 1)
    elseif ( i == -1 ) then
      call AddHeroXP(u, exp, true)
      call Bufftt(CreateTextTagUnitBJ("*Exp +" + ExpI2S(exp), GetDyingUnit(), -90., 9., 33., 66., 33., 30.), 1)
    elseif ( i == 2 ) then
      call AddHeroXP(u, exp/2, true)
      call Bufftt(CreateTextTagUnitBJ("*Exp +" + ExpI2S(exp) + "／2", GetDyingUnit(), -90., 9., 33., 100., 0., 30.), 1)
    elseif ( i == -2 ) then
      call AddHeroXP(u, exp/2, true)
      call Bufftt(CreateTextTagUnitBJ("*Exp +" + ExpI2S(exp) + "／2", GetDyingUnit(), -90., 9., 33., 66., 33., 60.), 1)
    elseif ( i == 3 ) then
      call AddHeroXP(u, 1, true)
      call Bufftt(CreateTextTagUnitBJ("*Exp +1", GetDyingUnit(), -90., 9., 33., 100., 0., 30.), 1)
    elseif ( i == -3 ) then
      call AddHeroXP(u, 1, true)
      call Bufftt(CreateTextTagUnitBJ("*Exp +1", GetDyingUnit(), -90., 9., 33., 66., 33., 30.), 1)
    elseif ( i == 4 ) then
      call AddHeroXP(u, exp, true)
      call Bufftt(CreateTextTagUnitBJ(" Exp +" + ExpI2S(exp), GetDyingUnit(), -90., 9., 33., 80., 0., 20.), 1)
    endif
    call ShowTextTagPlayer(GetOwningPlayer(u), bj_lastCreatedTextTag)
  endfunction
  constant function LvGap takes integer lv1, integer lv2 returns integer
    if ( lv1 > 99 ) and ( lv2 > 90 ) then
      return 1
    elseif ( lv1-lv2 < 15 ) and ( lv2-lv1 < 20 ) then
      return 1
    elseif ( lv1-lv2 <= 20 ) and ( lv2-lv1 <= 25 ) then
      return 2
    else
      return 3
    endif
  endfunction
  function PartyExp takes nothing returns nothing
    local integer lv = GetUnitLevel(GetTriggerUnit())
    local integer P = GetPlayerId(GetOwningPlayer(GetEnumUnit()))+1
    if ( GetEnumUnit() == killer ) then
      call GiveExp(GetEnumUnit(), R2I(Lv_Exp(lv)*Exp_Bonus(bj_groupCountUnits)*BaseValue(10)*bonus*(1.+(udg_SysK_Exp[P]+udg_SysK_ExpAdd[P])*.01)), LvGap(lv,udg_SysB_Level[P]))
    else
      call GiveExp(GetEnumUnit(), R2I(Lv_Exp(lv)*Exp_Bonus(bj_groupCountUnits)*              bonus*(1.+(udg_SysK_Exp[P]+udg_SysK_ExpAdd[P])*.01)), LvGap(lv,udg_SysB_Level[P]))
    endif
  endfunction
  function GetGroup takes unit u, boolexpr filter returns group
    set udg_PartyGoldGroup = CreateGroup()
    call GroupEnumUnitsInRange(udg_PartyGoldGroup, GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), 1000., filter)
    //call DestroyBoolExpr(filter)
    return udg_PartyGoldGroup
  endfunction
  function Sys_Exp_Act takes unit e, unit u returns nothing
    local integer lv = GetUnitLevel(u)
    local integer P = GetPlayerId(GetOwningPlayer(e))+1
    set killer = e
    set bonus = (1.+LoadReal(udg_hash, GetHandleId(u), StringHash("BonusHP")))
    if ( GetUnitAbilityLevel(u, 'A08P') == 1 ) then /* 솔던 */
      call GiveExp(killer, R2I(BaseValue(11)*Lv_Exp(LoadInteger(udg_hash, GetHandleId(u), StringHash("Level")))*bonus*(1.+(udg_SysK_Exp[P]+udg_SysK_ExpAdd[P])*.01)), 4)
    else
      call GetGroup(u, Condition(function Cond_NearParty2))
      set bj_groupCountUnits = 0
      call ForGroup(udg_PartyGoldGroup, function CountUnitsInGroupEnum)
      if ( bj_groupCountUnits >= 2 ) and ( udg_PartyNumber_pP[udg_PartyNumber_ThisP[P]] >= 2 ) then
        call ForGroup(udg_PartyGoldGroup, function PartyExp)
      else
        if ( udg_PartyNumber_pP[udg_PartyNumber_ThisP[P]] >= 2 ) then /* 파티 있는데 혼자 사냥시:  경험치 약간 흐리게 표시 */
          call GiveExp(killer, R2I(Lv_Exp(lv)*BaseValue(10)*bonus*(1.+(udg_SysK_Exp[P]+udg_SysK_ExpAdd[P])*.01)), -LvGap(lv,udg_SysB_Level[P]))
        else
          call GiveExp(killer, R2I(Lv_Exp(lv)*BaseValue(10)*bonus*(1.+(udg_SysK_Exp[P]+udg_SysK_ExpAdd[P])*.01)), LvGap(lv,udg_SysB_Level[P]))
        endif
      endif
      call DestroyGroup(udg_PartyGoldGroup)
    endif
  endfunction
endscope
  //===========================================================================
// Trigger: Sys Item Drop
//
// 최적화ed at Dec. 17th. 2011
// 변이, 보스몹 추가 - 220312
//===========================================================================
function ItemDropEffect takes item t, real p returns nothing
  //비둘기
  
  if ( GetRandomReal(0.,100.) <= 15. * ((100+p)/100.) ) then
    call SetItemCharges(t, GetItemCharges(t)+1)
    call SetItemPosition(t, GetWidgetX(GetKillingUnit()), GetWidgetY(GetKillingUnit()))
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\Starfall\\StarfallTarget.mdl", GetWidgetX(t), GetWidgetY(t)))
    call AttachSoundToUnit(gg_snd_ItemDrop01, GetKillingUnit())
    call StartSound(gg_snd_ItemDrop01)
  endif
  
  call ED(AddSpecialEffect("Units\\NightElf\\Owl\\Owl.mdl", GetWidgetX(t), GetWidgetY(t)), 3.)
  
  set bj_lastCreatedTextTag = CreateTextTag()
  call SetTextTagText(bj_lastCreatedTextTag, "|cffDFFB4F" + GetItemNamed(t), 0.015)
  call SetTextTagPos(bj_lastCreatedTextTag, GetWidgetX(t)-80., GetWidgetY(t), -50.)
  call SetTextTagColor(bj_lastCreatedTextTag, 255, 255, 255, 255)
  call Bufftt(bj_lastCreatedTextTag, 18)
endfunction

//아이템 드랍
scope DropSys
  globals
    private unit killer
  endglobals
  function createDropItems takes integer x, real p, unit u returns nothing
    local integer i = 1
    local boolean magicion = SysInt(4, GetUnitTypeId(killer)) == 4
    local boolean Mu = GetUnitAbilityLevel(u,'A047') >= 1
    local boolean Boss = GetUnitAbilityLevel(u,'A00O') == 1
    if ( Boss ) then
      set p = 0.
    elseif ( Mu ) then
      set p = p * 2.
    endif
    loop
      exitwhen i > udg_SysD_dropItemN[x]
      if ( GetRandomReal(0,100) <= udg_SysD_dropPb[getIndex(x,i,SysInt(0,5))]*p ) then
        if ( magicion ) then
          set bj_lastCreatedItem = CreateItem(udg_SysD_dropItems[getIndex(x,i,SysInt(0,5))], GetWidgetX(killer), GetWidgetY(killer))
        else
          set bj_lastCreatedItem = CreateItem(udg_SysD_dropItems[getIndex(x,i,SysInt(0,5))], GetWidgetX(u), GetWidgetY(u))
        endif
        if ( GetItemType(bj_lastCreatedItem) != ITEM_TYPE_UNKNOWN ) then
          if ( Boss ) and ( GetRandomReal(0., 100.) <= 50. ) then
            call SetItemCharges(bj_lastCreatedItem, (GetRandomInt(0,SysInt(0,29))*5)+1)
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl", GetWidgetX(bj_lastCreatedItem), GetWidgetY(bj_lastCreatedItem)))
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIda\\AIdaCaster.mdl,Abilities\\Spells\\Other\\Andt\\Andt.mdl", GetWidgetX(bj_lastCreatedItem), GetWidgetY(bj_lastCreatedItem)))
          elseif ( Mu ) and ( GetRandomReal(0., 100.) <= 25. )then
            call SetItemCharges(bj_lastCreatedItem, (GetRandomInt(0,SysInt(0,29))*5)+1)
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl", GetWidgetX(bj_lastCreatedItem), GetWidgetY(bj_lastCreatedItem)))
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIda\\AIdaCaster.mdl,Abilities\\Spells\\Other\\Andt\\Andt.mdl", GetWidgetX(bj_lastCreatedItem), GetWidgetY(bj_lastCreatedItem)))
          endif
          if ( GetItemCharges(bj_lastCreatedItem) > 0 ) then
            call ItemDropEffect(bj_lastCreatedItem, udg_SysK_Drop[GetPlayerId(GetOwningPlayer(killer))+1]+udg_SysK_DropAdd[GetPlayerId(GetOwningPlayer(killer))+1])
          endif
        elseif ( GetItemTypeId(bj_lastCreatedItem) == 'I084' ) then
          if ( not magicion ) then
            call SetItemPosition(bj_lastCreatedItem, GetWidgetX(killer), GetWidgetY(killer))
          endif
          if ( GetRandomReal(0., 100.) <= 10. ) then
            call AttachSoundToUnit(gg_snd_ExcuDrop, u)
            call StartSound(gg_snd_ExcuDrop)
            call CreateItem('I084', GetWidgetX(bj_lastCreatedItem), GetWidgetY(bj_lastCreatedItem))
          else
            call AttachSoundToUnit(gg_snd_GemDrop, u)
            call StartSound(gg_snd_GemDrop)
          endif
        endif
      endif
      set i = i + 1
    endloop
  endfunction
  
  function Item_Drop_Act takes unit e, unit u returns nothing
    local integer d = GetUnitTypeId(u)
    local integer P = udg_SysK_Drop[GetPlayerId(GetOwningPlayer(e))+1]+udg_SysK_DropAdd[GetPlayerId(GetOwningPlayer(e))+1]
    set killer = e
    set bj_forLoopAIndex = 1
    loop
      exitwhen bj_forLoopAIndex > udg_SysD_drop_i
      set bj_forLoopBIndex = 1
      loop
        exitwhen bj_forLoopBIndex > udg_SysD_dropMonN[bj_forLoopAIndex]
        if ( d == udg_SysD_dropMonsterType[getIndex(bj_forLoopAIndex,bj_forLoopBIndex,SysInt(0,4))] ) then
          call createDropItems(bj_forLoopAIndex, 1.+(P)*.01, u)
        endif
        set bj_forLoopBIndex = bj_forLoopBIndex + 1
      endloop
      set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
  endfunction
endscope//===========================================================================
// Trigger: Sys Death ALL
//===========================================================================
scope DeathAll initializer Init
  globals
    public unit Unit
    public unit Killer
    public trigger Death_ALL = CreateTrigger()
  endglobals

constant function QuestI2Q takes integer Qno returns trigger
  if ( Qno == 2 ) then
    return gg_trg_Quest_02_B
  elseif ( Qno == 3 ) then
    return gg_trg_Quest_03_B
  elseif ( Qno == 4 ) then
    return gg_trg_Quest_04_B
  elseif ( Qno == 6 ) then
    return gg_trg_Quest_06_B
  elseif ( Qno == 7 ) then
    return gg_trg_Quest_07_B
  elseif ( Qno == 8 ) then
    return gg_trg_Quest_08_B
  elseif ( Qno == 9 ) then
    return gg_trg_Quest_09_B
  elseif ( Qno == 12 ) then
    return gg_trg_Quest_12_B
  elseif ( Qno == 13 ) then
    return gg_trg_Quest_13_B
  elseif ( Qno == 14 ) then
    return gg_trg_Quest_14_B
  elseif ( Qno == 16 ) then
    return gg_trg_Quest_16_B
  else
    return null
  endif
endfunction
function QuestI2B takes integer P, integer Qno returns boolean
  if ( Qno == 2 ) then
    return ( Quest_Level(P, Qno) == 1 )
  elseif ( Qno == 3 ) then
    return ( Quest_Level(P, Qno) == 1 )
  elseif ( Qno == 4 ) then
    return ( Quest_Level(P, Qno) >= 1 )
  elseif ( Qno == 6 ) then
    return ( Quest_Level(P, Qno) >= 1 ) and ( GetRandomReal(0,100) <= 60. )
  elseif ( Qno == 7 ) then
    return ( Quest_Level(P, Qno) >= 1 )
  elseif ( Qno == 8 ) then
    return ( Quest_Level(P, Qno) >= 1 )
  elseif ( Qno == 9 ) then
    return ( Quest_Level(P, Qno) >= 1 )
  elseif ( Qno == 12 ) then
    return ( Quest_Level(P, Qno) >= 1 )
  elseif ( Qno == 14 ) then
    return ( Quest_Level(P, Qno) >= 1 )
  else
    return false
  endif
endfunction
constant function QuestU2Q takes integer ut returns integer
  if ( ut == 'n002' ) or ( ut == 'n035' ) then
    return 3
  elseif ( ut == 'n00P' ) or ( ut == 'n012' ) or ( ut == 'n014' ) then
    return 4
  elseif ( ut == 'n009' ) then
    return 6
  elseif ( ut == 'A06I' ) then
    return 7
  elseif ( ut == 'A016' ) then
    return 8
  elseif ( ut == 'A06H' ) then
    return 9
  elseif ( ut == 'A012' ) then
    return 12
  else
    return 0
  endif
endfunction

function Death_All_Act takes unit u, unit e returns nothing
//더미 삭제
  if ( GetUnitState(u, UNIT_STATE_MAX_LIFE) < 10. ) then
    call FlushChildHashtable(udg_hash, GetHandleId(u))
    call RemoveUnit(u)
  elseif ( GetUnitAbilityLevel(u, 'Aloc') == 0 ) then
    //적대 유닛
    if ( GetOwningPlayer(u) == Player(PLAYER_NEUTRAL_AGGRESSIVE) ) then
      //골드
      if ( GetUnitAbilityLevel(u, 'A08Q') == 0 ) then
        call TriggerExecute(gg_trg_Sys_Gold_Drop)
      elseif ( GetUnitTypeId(u) == 'o001' ) then
        call TriggerExecute(gg_trg_Sys_Dummy_Rev)
      endif
      if ( GetUnitAbilityLevel(u, 'A08P') == 1 ) then
        call Sys_Exp_Act(e, u)
      elseif ( e != null ) then
        call Sys_Exp_Act(e, u)
        call Item_Drop_Act(e, u)
        
        //살해 퀘스트 유닛 잡았을때 - 유닛타입 비교(팜펫, 큐르페이, 독거미 등)
        if ( QuestU2Q(GetUnitTypeId(u)) != 0 ) then
          if ( QuestI2B(GetPlayerId(GetOwningPlayer(e))+1, QuestU2Q(GetUnitTypeId(u))) ) then
            call TriggerExecute(QuestI2Q(QuestU2Q(GetUnitTypeId(u))))
          elseif ( QuestU2Q(GetUnitTypeId(u)) == 4 ) and ( ( QuestI2B(GetPlayerId(GetOwningPlayer(e))+1,8) ) or ( QuestI2B(GetPlayerId(GetOwningPlayer(e))+1,11) ) ) then
            call TriggerExecute(QuestI2Q(QuestU2Q(GetUnitTypeId(u))))
          endif
        //살해 퀘스트 - 유닛 스킬 비교 - 해안가
        elseif ( GetUnitAbilityLevel(u, 'A06I') == 1 ) then
          if ( QuestI2B(GetPlayerId(GetOwningPlayer(e))+1, QuestU2Q('A06I')) ) then
            call TriggerExecute(QuestI2Q(QuestU2Q('A06I')))
          endif
        //스킬 - 우드
        elseif ( GetUnitAbilityLevel(u, 'A016') == 1) then
          if ( QuestI2B(GetPlayerId(GetOwningPlayer(e))+1, QuestU2Q('A016')) ) then
            call TriggerExecute(QuestI2Q(QuestU2Q('A016')))
          endif
        //아이엄마, 지묘
        elseif ( GetUnitAbilityLevel(u, 'A06H') == 1 ) then
          if ( QuestI2B(GetPlayerId(GetOwningPlayer(e))+1, 2) ) then
            call TriggerExecute(QuestI2Q(2))
          endif
          if ( QuestI2B(GetPlayerId(GetOwningPlayer(e))+1, QuestU2Q('A06H')) ) then
            call TriggerExecute(QuestI2Q(QuestU2Q('A06H')))
          endif
        //포테
        elseif ( GetUnitAbilityLevel(u, 'A05R') == 1 ) then
          call TriggerExecute(gg_trg_Quest_00_47_B)
        
        elseif ( GetUnitAbilityLevel(u, 'A012') == 1 ) then
        //호러
          call TriggerExecute(QuestI2Q(QuestU2Q('A012')))
          call TriggerExecute(QuestI2Q(13))
        
        elseif ( GetUnitAbilityLevel(u, 'A09T') == 1 ) then
        //죽마
          call TriggerExecute(QuestI2Q(14))
          call TriggerExecute(QuestI2Q(16))
        endif
      endif
      call KillUnit(u)
      if ( not udg_SysA_EffectSimple ) then
        call SetUnitTimeScale(u, 1.)
        call TriggerSleepAction(2.)
      endif
      if ( not UnitAlive(u) ) then
        call FlushChildHashtable(udg_hash, GetHandleId(u))
        call RemoveUnit(u)
      endif
    endif
  elseif ( isHero(u) ) then
    call Coma(u, 15., 1.5)
  else
    call FlushChildHashtable(udg_hash, GetHandleId(u))
    call RemoveUnit(u)
  endif
endfunction
  function Trig_Sys_Death_ALL_Actions takes nothing returns nothing
    call Death_All_Act(GetTriggerUnit(), GetKillingUnit())
  endfunction
  function Death_All_Exe takes nothing returns nothing
    call Death_All_Act(Unit, Killer)
  endfunction
  //call ExecuteFunc("Death_All_Exe")
  //===========================================================================
  private function Init takes nothing returns nothing
    call TriggerRegisterAnyUnitEventBJ(Death_ALL, EVENT_PLAYER_UNIT_DEATH)
    call TriggerAddAction(Death_ALL, function Trig_Sys_Death_ALL_Actions)
  endfunction
endscope//===========================================================================
// Trigger: Sys Dmg Manager v6
//
// N	평타
// C	크리
// H	회복
// S	스킬
// G	스킬-드모 등
// M	마법
// D	필살기 (라그나로크 등)
// call DmgText_View("M", cri, GetWidgetX(u), GetWidgetY(u), od, 1.)
//===========================================================================
native EXGetEventDamageData takes integer edd_type returns integer
native EXSetEventDamage takes real amount returns boolean

scope DmgSys initializer Init_v6
  globals
    trigger DmgTrigger_v6
    private integer handle_u
    private integer stringhash
    private integer P_e
    private real temp_r
    private boolean cri = false
    
    private timer double_timer
    private unit double_u
    private unit double_e
    private integer double_sk
  endglobals
  
  function Dis takes unit u, unit t returns real
    local real dx = GetWidgetX(t) - GetWidgetX(u)
    local real dy = GetWidgetY(t) - GetWidgetY(u)
    return SquareRoot(dx * dx + dy * dy)
  endfunction
  private function Ang takes unit u, unit t returns real
    return bj_RADTODEG * Atan2(GetWidgetY(t) - GetWidgetY(u), GetWidgetX(t) - GetWidgetX(u))
  endfunction
  private function RushTimer takes nothing returns nothing
    local timer t = GetExpiredTimer()
    local unit u = LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"))
    local unit u2 = LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u2"))
    local integer c = LoadInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"))+1
    local real ang = 0
    
    if not( IsUnitType(u2, UNIT_TYPE_DEAD) ) and ( c < 30 ) and ( Dis(u,u2) > 100. ) then
      set ang = Ang(u,u2)
      call SetUnitFacingTimed(u, ang, 0)
      set bj_meleeNearestMineToLoc = GetUnitLoc(u)
      set bj_enumDestructableCenter = PolarProjectionBJ(bj_meleeNearestMineToLoc, 30., ang)
      call SetUnitX(u, GetLocationX(bj_enumDestructableCenter))
      call SetUnitY(u, GetLocationY(bj_enumDestructableCenter))
      call DestroyEffect( AddSpecialEffectLoc("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl", bj_meleeNearestMineToLoc) )
      call RemoveLocation(bj_meleeNearestMineToLoc)
      call RemoveLocation(bj_enumDestructableCenter)
      
      call SaveInteger(udg_hash, GetHandleId(t), StringHash("T.A.i"),c)
      call TimerStart(t,.03125,false,function RushTimer)
    else
      if ( Dis(u,u2) < 101. ) then
        call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Human\\Polymorph\\PolyMorphTarget.mdl", u2, "overhead") )
        call DestroyEffect( AddSpecialEffectTarget("Objects\\Spawnmodels\\NightElf\\NightElfBlood\\NightElfBloodDruidoftheClaw.mdl", u2, "overhead") )
        call SetUnitAnimation(u, "attack")
        set c = GetPlayerId(GetOwningPlayer(u))+1
        call DmgSkill(u, u2, Cri(MakeValue("-10000|St=*500|Po-", c)*MakeValue2(GetUnitAbilityLevel(u,'A02A'),c,3),c,35))
        call Dummier(Player(c-1), u2, -1, 'A00D', "thunderbolt")
      endif
      call PauseUnit(u, false)
      call FlushChildHashtable(udg_hash, GetHandleId(t))
      call DestroyTimer(t)
    endif
    set t = null
    set u = null
    set u2 = null
  endfunction
  private function Rush takes unit u, unit u2 returns nothing
    local timer t = CreateTimer()
    call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u"), u)
    call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("T.A.u2"), u2)
    call PauseUnit(u, true)
    call TimerStart(t,0.,false,function RushTimer)
    set t = null
  endfunction
  
  private function DoubleAttacking takes nothing returns nothing
    set double_timer = GetExpiredTimer()
    set double_u = LoadUnitHandle(udg_hash, GetHandleId(double_timer), StringHash("DAK_u"))
    set double_e = LoadUnitHandle(udg_hash, GetHandleId(double_timer), StringHash("DAK_e"))
    set double_sk = LoadInteger(udg_hash, GetHandleId(double_timer), StringHash("DAK_sk"))
    if ( UnitAlive(double_u) ) then
      call SetUnitAnimation(double_e, "attack")
      set temp_r = LoadReal(udg_hash, GetHandleId(double_timer), StringHash("DAK_r"))
      call DmgTrue(double_e, double_u, temp_r)
	  if ( double_sk == 'A00F' ) then
        call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", double_u, "overhead"))
        call DmgText_View("G", false, GetWidgetX(double_u)+33., GetWidgetY(double_u)-15., R2I(temp_r), .8)
	  elseif ( double_sk == -1 ) then
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl", double_u, "overhead"))
        call DmgText_View("N", false, GetWidgetX(double_u)+100., GetWidgetY(double_u)+15., R2I(temp_r), .8)
	  else
        call DmgText_View("G", false, GetWidgetX(double_u)+33., GetWidgetY(double_u)-15., R2I(temp_r), .8)
      endif
    endif
    call FlushChildHashtable(udg_hash, GetHandleId(double_timer))
    call DestroyTimer(double_timer)
endfunction
  private function DoubleAttack takes unit e, unit u, real d, integer sk, integer P returns nothing
    set double_timer = CreateTimer()
    call SaveUnitHandle(udg_hash, GetHandleId(double_timer), StringHash("DAK_e"), e)
    call SaveUnitHandle(udg_hash, GetHandleId(double_timer), StringHash("DAK_u"), u)
    call SaveReal(udg_hash, GetHandleId(double_timer), StringHash("DAK_r"), d)
    if ( sk == -2 ) then
      call SaveInteger(udg_hash, GetHandleId(double_timer), StringHash("DAK_sk"), 'A00F')
      call TimerStart(double_timer, (ATTACKSPEED(udg_SysC_AtkSpdDEX[P]+udg_SysC_AtkSpdAdd[P]))*.5, false, function DoubleAttacking)
    elseif ( sk == -1 ) then        /* 평타 - 백어택 */
      call TimerStart(double_timer, (ATTACKSPEED(udg_SysC_AtkSpdDEX[P]+udg_SysC_AtkSpdAdd[P]))*.5, false, function DoubleAttacking)
    elseif ( sk == 'A00F' ) then    /* 두번찌르기 */
      call TimerStart(double_timer, (ATTACKSPEED(udg_SysC_AtkSpdDEX[P]+udg_SysC_AtkSpdAdd[P]))*.25, false, function DoubleAttacking)
    else                            /* 더블어택류 */
      call TimerStart(double_timer, (ATTACKSPEED(udg_SysC_AtkSpdDEX[P]+udg_SysC_AtkSpdAdd[P]))*.25, false, function DoubleAttacking)
    endif
  endfunction
  
  function DummyActionNo takes integer No, unit e, unit u, integer P, integer ty returns real
    if ( No == 'e00G' ) then
      //레스큐
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl", u, "overhead"))
      call IssueTargetOrder(u, "attack", e)
      call Attack(u, e, .5, 15.)
    elseif ( No == 'e000' ) then
      return Cri(MakeValue("300|St=*10", P) * MakeValue22(GetUnitAbilityLevel(e,'A02F'), P, 3, ty), P, 5)
    elseif ( No == 'e00U' ) then
      return Cri(MakeValue("0|Lv+*25|St=*80", P) * MakeValue22(GetUnitAbilityLevel(e,'A00A'), P, 3, ty), P, 10)
    elseif ( No == 'e01Q' ) then
      return Cri(MakeValue("5000|St=*160", P) * MakeValue22(GetUnitAbilityLevel(e,'A09Y'), P, 3, ty), P, 10)
    elseif ( No == 'e00T' ) then
      return Cri(MakeValue("0|Lv+*30|St=*90", P) * MakeValue22(GetUnitAbilityLevel(e,'A02P'), P, 3, ty), P, 10)
    elseif ( No == 'e01P' ) then
      return Cri(MakeValue("3000|St=*180", P) * MakeValue22(GetUnitAbilityLevel(e,'A09Z'), P, 3, ty), P, 10)
    elseif ( No == 'e00D' ) then
      call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Critters\\Albatross\\CritterBloodAlbatross.mdl", u, "head") )
      return MakeValue("0|Lv+*8|De=*25|Set^1.07", P) *MakeValue22(0, P, 2, ty)
    elseif ( No == 'e00J' ) then
      set bj_lastCreatedUnit = CreateUnit(Player(P-1), 'e001', GetWidgetX(e), GetWidgetY(e), bj_UNIT_FACING)
      call IssueTargetOrder(bj_lastCreatedUnit, "thunderbolt", u)
      call RemoveUnit(bj_lastCreatedUnit)
      set bj_lastCreatedUnit = CreateUnit(Player(P-1), 'e000', GetWidgetX(e), GetWidgetY(e), bj_UNIT_FACING)
      call SetUnitAbilityLevel(bj_lastCreatedUnit, 'A023', 2)
      call IssueTargetOrder(bj_lastCreatedUnit, "slow", u)
      call RemoveUnit(bj_lastCreatedUnit)
      call Attack(u, e, 0.5, 8)
    elseif ( No == 'e00K' ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\FaerieFire\\FaerieFireTarget.mdl", u, "overhead"))
      set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(e), 'e001', GetWidgetX(e), GetWidgetY(e), bj_UNIT_FACING)
      call SetUnitAbilityLevel(bj_lastCreatedUnit, 'A03U', GetUnitAbilityLevel(e, 'A03R'))
      call IssueTargetOrder(bj_lastCreatedUnit, "innerfire", u)
      call RemoveUnit(bj_lastCreatedUnit)
    elseif ( No == 'e00L' ) then
      call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", u, "overhead"))
      return Cri(MakeValue("200|De=*15", P) * MakeValue22(GetUnitAbilityLevel(e,'A02H'), P, 3, ty), P, 15)
    elseif ( No == 'e00M' ) then
      call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", u, "overhead"))
      if ( udg_SysI_Xtical[P] >= 3 ) then
        return Cri(MakeValue("0|Lv+*15|De=*45|Se.*"+R2S(udg_SysI_Xtical[P]/2.), P) * MakeValue22(GetUnitAbilityLevel(e,'A009'), P, 3, ty), P, 15)
      else
        return Cri(MakeValue("0|Lv+*15|De=*45", P) * MakeValue22(GetUnitAbilityLevel(e,'A009'), P, 3, ty), P, 15)
      endif
    elseif ( No == 'e00N' ) then
      call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", u, "overhead"))
      if ( udg_SysI_Xtical[P] >= 5 ) then
        set udg_temp_r = Cri(MakeValue("0|Lv+*15|De=*45|Se.*"+R2S(udg_SysI_Xtical[P]/3.), P) * MakeValue22(GetUnitAbilityLevel(e,'A00F'), P, 3, ty), P, 20) * GetDmg(P)
        if ( HaveSavedInteger(udg_hash, GetHandleId(u), StringHash("AC")) ) then
          //몬스터 아머에 따른 데미지 감소
          return udg_temp_r - ( udg_temp_r/200. * LoadInteger(udg_hash, GetHandleId(u), StringHash("AC")) )
        endif
        
        call DoubleAttack(e,u,udg_temp_r,'A00F',P)
        call DoubleAttack(e,u,udg_temp_r,-2,P)
      else
        set udg_temp_r = Cri(MakeValue("0|Lv+*15|De=*45", P) * MakeValue22(GetUnitAbilityLevel(e,'A00F'), P, 3, ty), P, 20) * GetDmg(P)
        if ( HaveSavedInteger(udg_hash, GetHandleId(u), StringHash("AC")) ) then
          //몬스터 아머에 따른 데미지 감소
          set udg_temp_r = udg_temp_r - ( udg_temp_r/200. * LoadInteger(udg_hash, GetHandleId(u), StringHash("AC")) )
        endif
        call DoubleAttack(e,u,udg_temp_r,'A00F',P)
      endif
      return udg_temp_r
    elseif ( No == 'e00O' ) then
      call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", u, "overhead"))
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Disenchant\\DisenchantSpecialArt.mdl", u, "chest"))
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Incinerate\\IncinerateBuff.mdl", u, "chest"))
      return GetRandomReal(5000.,Cri(MakeValue("0|St=*400", P) * MakeValue22(GetUnitAbilityLevel(e,'A00F'), P, 4, ty), P, 25))
    elseif ( No == 'e00P' ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl", u, "overhead") )
      return Cri(MakeValue("0|Lv+*30|St=*42|Co=*18", P) * MakeValue22(GetUnitAbilityLevel(e,'A00X'), P, 3, ty), P, 15)
    elseif ( No == 'e00Q' ) then
      call Fdmg(e, u, RMaxBJ(100, MakeValue("0|Lv+*4|St=*20|In=*45", P)), RMaxBJ(.5, 2.-udg_SysE_INT3[P]*.03), IMinBJ(20, udg_SysE_WIS3[P]/5+1))
      set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(e), 'e000', GetWidgetX(e), GetWidgetY(e), bj_UNIT_FACING)
      call IssueTargetOrderById(bj_lastCreatedUnit, OrderId("cripple"), u)
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilSpecialArt.mdl", u, "origin"))
      call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Orc\\Orcblood\\BattrollBlood.mdl", u, "chest"))
    elseif ( No == 'e00R' ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl", u, "overhead"))
      return Cri(MakeValue("0|Lv+*30|St=*56|Co=*24", P) * MakeValue22(GetUnitAbilityLevel(e,'A01L'), P, 4, ty), P, 20)
    elseif ( No == 'e00S' ) then
      call TimeAction(u, 1, 8)
      set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(e), 'e009', GetWidgetX(e), GetWidgetY(e), bj_UNIT_FACING)
      call IssueTargetOrderById(bj_lastCreatedUnit, OrderId("thunderbolt"), u)
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilSpecialArt.mdl", u, "origin"))
      call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Orc\\Orcblood\\BattrollBlood.mdl", u, "chest"))
      if ( GetUnitAbilityLevel(e, 'A082') >= 1 ) then
        return RMaxBJ(100, MakeValue("0|Lv+*30|In=*200",P))
      else
        return RMaxBJ(100, MakeValue("0|Lv+*30|In=*200",P)*MakeValue22(GetUnitAbilityLevel(e,'A080'),P,1,ty))
      endif
    elseif ( No == 'e00I' ) then
      call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Critters\\Albatross\\CritterBloodAlbatross.mdl", u, "head") )
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ManaBurn\\ManaBurnTarget.mdl", u, "head") )
      call DestroyEffect(AddSpecialEffectTarget("Units\\NightElf\\Wisp\\WispExplode.mdl", u, "origin") )
      return Cri(MakeValue("0|Lv+*40|St=*60|Co=*60",P)*MakeValue22(GetUnitAbilityLevel(e,'A02M'),P,3, ty), P, 20)
    elseif ( No == 'e00H' ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl", u, "overhead"))
      call IssueImmediateOrder(u, "stop")
      set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(e), 'e001', GetWidgetX(e), GetWidgetY(e), bj_UNIT_FACING)
      call IssueTargetOrder(bj_lastCreatedUnit, "thunderbolt", u)
      call RemoveUnit(bj_lastCreatedUnit)
      call DestroyEffect(AddSpecialEffectTarget("Objects\\RandomObject\\RandomObject.mdl", u, "overhead"))
      set bj_meleeNearestMineToLoc = PolarProjectionBJ(Location(GetWidgetX(e), GetWidgetY(e)), 50., GetRandomReal(0,360))
      call IssuePointOrderLoc(u, "move", bj_meleeNearestMineToLoc)
      call RemoveLocation(bj_meleeNearestMineToLoc)
    elseif ( No == 'e00W' ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FragDriller\\FragDriller.mdl", u, "chest"))
      call SetWidgetLife(e, RMaxBJ(1.,GetWidgetLife(e)*.1))
      call DestroyEffect(AddSpecialEffect("war3mapImported\\Artillery Shell.mdx", GetWidgetX(u), GetWidgetY(u)))
      call TimeAction(u, 0, 8)
      return Cri(MakeValue("0|HP-*20|Po-",P)*MakeValue22(0,P,2, ty), P, 30)
    elseif ( No == 'e01R' ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FragDriller\\FragDriller.mdl", u, "chest"))
      call SetWidgetLife(e, RMaxBJ(1.,GetWidgetLife(e)*.05))
      call DestroyEffect(AddSpecialEffect("war3mapImported\\Artillery Shell.mdx", GetWidgetX(u), GetWidgetY(u)))
      call TimeAction(u, 0, 8)
      return Cri(MakeValue("0|HP-*60|Po-",P)*MakeValue22(0,P,2, ty), P, 30)
    elseif ( No == 'e00X' ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FragDriller\\FragDriller.mdl", u, "chest"))
      
      call TimeAction(udg_Unit[P], 10., 22)
      set bj_lastCreatedUnit = CreateUnit(Player(12), 'e010', GetWidgetX(e), GetWidgetY(e), GetUnitFacing(e))
      call SetUnitTimeScale(bj_lastCreatedUnit, 3.)
      set bj_lastCreatedUnit = CreateUnit(Player(12), 'e010', GetWidgetX(u), GetWidgetY(u), GetUnitFacing(e))
      call SetUnitTimeScale(bj_lastCreatedUnit, 3.)
      call TimeAction(u, 0, 8)
      
      if ( GetWidgetLife(e) <= GetUnitState(e, UNIT_STATE_MAX_LIFE)*.07 ) then
        return Cri(MakeValue("0|HP_*6|Po-",P)*MakeValue22(0,P,2, ty), P, 30)
      elseif ( GetItemTypeId(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), 1)) == 'I085' ) then
        call SetWidgetLife(udg_Unit[P], 7)
        if ( GetRandomReal(0.,100.) <= 33. ) then
          call MSG(Player(P-1), 1, 4, "알 수 없는 액체가 소모되었습니다.")
          call MinusItem(P, 'I085', 1)
        else
          call MSG(Player(P-1), 1, 4, "알 수 없는 액체가 빛이 납니다.")
        endif
        return Cri(MakeValue("0|HP_*6|Po-",P)*MakeValue22(0,P,2, ty), P, 30)
      else
        return Cri(MakeValue("0|HP_*4|Po-",P)*MakeValue22(0,P,2, ty), P, 30)
      endif
    elseif ( No == 'e01S' ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FragDriller\\FragDriller.mdl", u, "chest"))
      
      call TimeAction(udg_Unit[P], 10., 22)
      set bj_lastCreatedUnit = CreateUnit(Player(12), 'e010', GetWidgetX(e), GetWidgetY(e), GetUnitFacing(e))
      call SetUnitTimeScale(bj_lastCreatedUnit, 3.)
      set bj_lastCreatedUnit = CreateUnit(Player(12), 'e010', GetWidgetX(u), GetWidgetY(u), GetUnitFacing(e))
      call SetUnitTimeScale(bj_lastCreatedUnit, 3.)
      call TimeAction(u, 0, 8)
      
      if ( GetWidgetLife(e) <= GetUnitState(e, UNIT_STATE_MAX_LIFE)*.07 ) then
        return Cri(MakeValue("0|HP_*9|Po-",P)*MakeValue22(0,P,2, ty), P, 30)
      elseif ( GetItemTypeId(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), 1)) == 'I085' ) then
        call SetWidgetLife(udg_Unit[P], 7)
        if ( GetRandomReal(0.,100.) <= 33. ) then
          call MSG(Player(P-1), 1, 4, "알 수 없는 액체가 소모되었습니다.")
          call MinusItem(P, 'I085', 1)
        else
          call MSG(Player(P-1), 1, 4, "알 수 없는 액체가 빛이 납니다.")
        endif
        return Cri(MakeValue("0|HP_*9|Po-",P)*MakeValue22(0,P,2, ty), P, 30)
      else
        return Cri(MakeValue("0|HP_*6|Po-",P)*MakeValue22(0,P,2, ty), P, 30)
      endif
    elseif ( No == 'e00Y' ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FragDriller\\FragDriller.mdl", u, "chest"))
      if ( udg_SysI_Xtical[P] >= 9 ) then
        set bj_lastCreatedUnit = CreateUnit(Player(12), 'e00F', GetWidgetX(u), GetWidgetY(u), bj_UNIT_FACING)
        call SetUnitTimeScale(bj_lastCreatedUnit, 7.)
        if ( GetUnitAbilityLevel(e,'A04I')+GetUnitAbilityLevel(e,'A04Q') >= 1 ) then
          call Dummier(Player(P-1),e,-1,'A04K',"invisibility")
          call CreateTextTagUnitBJ("Hide...", e, 60., 9.5, 0, 100, 100, 0)
          call Bufftt(bj_lastCreatedTextTag,1)
          
          call TimeAction(e, 3., 1)
        endif
        return Cri(MakeValue("-10000|Hp-*1.50|De=*150|Po-",P)*MakeValue22(0,P,2,ty), P, 33.01)
      else
        call SetWidgetLife(e, GetWidgetLife(e)*.28)
        set bj_lastCreatedUnit = CreateUnit(Player(12), 'e00F', GetWidgetX(u), GetWidgetY(u), bj_UNIT_FACING)
        call SetUnitTimeScale(bj_lastCreatedUnit, 4.5)
        if ( GetUnitAbilityLevel(e,'A04I')+GetUnitAbilityLevel(e,'A04Q') >= 1 ) then
          call Dummier(Player(P-1),e,-1,'A04K',"invisibility")
          call CreateTextTagUnitBJ("Hide...", e, 60., 9.5, 0, 100, 100, 0)
          call Bufftt(bj_lastCreatedTextTag,1)
          
          call TimeAction(e, 1.5, 1)
        endif
        return Cri(MakeValue("-10000|Hp-*5.35|De=*150|Po-",P)*MakeValue22(0,P,2,ty), P, 33.01)
      endif
    elseif ( No == 'e012' ) then
      call SetWidgetLife(e, GetWidgetLife(e)*.75)
      call TimeAction(u, 1, 8)
      call GetEffectLoc(u, 7, 2)
      call GetEffectLoc(u, 7, 2)
      return Cri(RMaxBJ(5000, MakeValue("-20000|Hp-*2|St=*210|Co=*90|Po-",P)*MakeValue22(1,P,2,ty)), P, 30)
    elseif ( No == 'e016' ) then
      call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", u, "overhead"))
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Disenchant\\DisenchantSpecialArt.mdl", u, "chest"))
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Incinerate\\IncinerateBuff.mdl", u, "chest"))
      if ( RAbsBJ(GetUnitFacing(e) - GetUnitFacing(u)) <= 30. ) then
        return Cri(GetRandomReal(10000., MakeValue("0|St=*800|Po-", P)) * MakeValue22(GetUnitAbilityLevel(e,'A02U'), P, 4, ty), P, 40)
      else
        return Cri(GetRandomReal(5000., MakeValue("0|St=*800|Po-", P)) * MakeValue22(GetUnitAbilityLevel(e,'A02U'), P, 3, ty), P, 35)
      endif
    elseif ( No == 'e017' ) then
      call RemoveUnit(GetEventDamageSource())
      call Rush(e,u)
    endif
    return 0.
  endfunction
  
  private constant function IsBoss takes boolean b returns real
    if ( b ) then
      return .1
    else
      return 1.
    endif
  endfunction
  private function RangeAdd2 takes real r, integer P returns real
    return r * RMaxBJ(1., SquareRoot(udg_SysE_STR3[P]/100))
  endfunction
  private function DragonCallback takes nothing returns nothing
    call DmgTrue(double_u, GetEnumUnit(), temp_r)
    call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\NightElf\\NightElfBlood\\NightElfBloodDruidRaven.mdl", GetEnumUnit(), "overhead"))
  endfunction
  private function Condi_Enemy takes nothing returns boolean
    return ( UnitAlive(GetFilterUnit()) ) and ( IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(double_u)) ) and ( not IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) )
  endfunction
  private function v6_Action2 takes unit u, unit e, real od, boolean hero returns nothing
    if ( hero ) then
      set handle_u = GetHandleId(u)
      set stringhash = StringHash("Miss")
      set P_e = GetPlayerId(GetOwningPlayer(e))+1
      
      /* 평타 회피 - 미스 처리 */
      if ( HaveSavedReal(udg_hash, handle_u, stringhash) ) and ( GetRandomReal(0.,100.) <= LoadReal(udg_hash, handle_u, stringhash)-udg_SysC_Hits[P_e] ) then
        call EXSetEventDamage(0.)
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl", u, "overhead"))
        call Bufftt(CreateTextTagUnitBJ("Miss", u, -50, 8, 0, 100, 0, 0), 4)
      else
      
        /* 보스 10% 데미지 */
        set od = od * IsBoss(GetUnitState(u, ConvertUnitState($50)) == 6. )
        
        set stringhash = StringHash("AC")
        if ( HaveSavedInteger(udg_hash, handle_u, stringhash) ) then
          set od = od - ( od*.005 * LoadInteger(udg_hash, handle_u, stringhash) ) /* 아머 */
        else
          set od = od - ( od*.005 * udg_SysC_Armor[GetPlayerId(GetOwningPlayer(u))+1] ) /* 아머 */
          set od = od * ( 1.-udg_SysC_AC_R[GetPlayerId(GetOwningPlayer(u))+1] )       /* 호르라마 */
        endif
        
        /* 갭 시스템, 레벨^2만큼 추가데미지 */
        set stringhash = StringHash("Level")
        if ( HaveSavedInteger(udg_hash, handle_u, stringhash) ) then
          set od = od + Pow(udg_SysB_Level[P_e] - (GetUnitLevel(u) + LoadInteger(udg_hash, handle_u, stringhash)), 2.)
        else
          set od = od + Pow(udg_SysB_Level[P_e] -  GetUnitLevel(u),                              2.)
        endif
        
        /* 추가데미지 */
        set od = od + GetRandomInt(0, udg_SysC_DmgAttackAdd[P_e])
        
        /* Dam에 따른 추가데미지 */
        set od = od * GetDmg(P_e)
        
        if ( GetRandomReal(0.,100.) <= udg_SysC_CriP[P_e] ) then /* 크리티컬 */
          set od = od * udg_SysC_CriX[P_e]
          set cri = true
        else
          set cri = false
        endif
        
        /* 더블어택류 */
        if ( od > 0. ) and ( GetWidgetLife(u) > od ) and ( IsUnitEnemy(u, GetOwningPlayer(e)) ) then
          if ( GetUnitAbilityLevel(e, 'A01H') >= 1 ) then       /* 전사 - 더블어택 */
            if ( GetRandomReal(0.,100.) <= SkillPer(e, 'A01H', .7, 1) ) then
              call DoubleAttack(e, u, od, 'A01H', P_e)
            else
              call SkillUp(e,'A01H',-25.)
            endif
          elseif ( GetUnitAbilityLevel(e, 'A02L') >= 1 ) then   /* 전사 - 트리플어택 */
            if ( GetRandomReal(0.,100.) <= SkillPer(e, 'A02L', .7, 1) ) then
              call DoubleAttack(e, u, od*2., 'A02L', P_e)
            else
              call SkillUp(e,'A02L',-25.)
            endif
          elseif ( GetUnitAbilityLevel(e, 'A01W') >= 1 ) then   /* 전사 - 메가어택 (전사) */
            if ( GetRandomReal(0.,100.) <= SkillPer(e, 'A01W', .7, 1) ) then
              call DoubleAttack(e, u, od*3., 'A01W', P_e)
            else
              call SkillUp(e,'A01W',-25.)
            endif
          elseif ( GetUnitAbilityLevel(e, 'A01I') >= 1 ) then   /* 도적 - 더블어택 */
            if ( GetRandomReal(0.,100.) <= SkillPer(e, 'A01I', .6, 1) ) then
              call DoubleAttack(e, u, od, 'A01I', P_e)
            else
              call SkillUp(e,'A01I',-25.)
            endif
          elseif ( GetUnitAbilityLevel(e, 'A02O') >= 1 ) then   /* 도적 - 트리플어택 */
            if ( GetRandomReal(0.,100.) <= SkillPer(e, 'A02O', .6, 1) ) then
              call DoubleAttack(e, u, od*2., 'A02O', P_e)
            else
              call SkillUp(e,'A02O',-25.)
            endif
          elseif ( GetUnitAbilityLevel(e, 'A01G') >= 1 ) then   /* 도가 - 양의신권 */
            if ( GetRandomReal(0.,100.) <= SkillPer(e, 'A07X', .7, 1) ) then
              call DoubleAttack(e, u, od, 'A07X', P_e)
            else
              call SkillUp(e,'A07X',-5.)
            endif
          elseif ( GetUnitAbilityLevel(e, 'A07Z') >= 1 ) and ( GetRandomReal(0.,100.) <= SkillPer(e, P_e, .7, 3) ) then   /* 도가 - 양의신권 (숙련도 풀) */
            call DoubleAttack(e, u, od, 'A07Z', P_e)
          
          /* 전직 후 추가 더블어택 */
          elseif ( GetUnitAbilityLevel(e, 'A06Y') >= 1 ) and ( GetRandomReal(0.,100.) <= SkillPer(e, P_e, .7, 3) ) then
            call DoubleAttack(e, u, od*2., 'A06Y', P_e)
          
          elseif ( GetUnitAbilityLevel(e, 'A08U') >= 1 ) and ( GetRandomReal(0.,100.) <= SkillPer(e, P_e, .6, 3) ) then
            call DoubleAttack(e, u, od, 'A08U', P_e)
          endif
          
          if ( GetUnitAbilityLevel(e, 'A01J') + GetUnitAbilityLevel(e, 'A04J') >= 1 ) then /* 도적 - 표창날리기 */
            if ( SubString(LoadStr(udg_hash, GetItemTypeId(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P_e)), FMI_MAXMAX_INVENTORY+7)), StringHash("FMi-Val")),1,3) == "03" ) and ( GetRandomReal(0.,100.) <=  SkillPer(e, P_e, 0.15, 3) ) then
              call MSG(Player(P_e-1), 1, .3, "표창날리기 !!")
              call CreateDummy(e, 'e00D')
            endif
          endif
          
          if (RAbsBJ(GetUnitFacing(e) - GetUnitFacing(u)) <= 50. ) then /* 백어택 */
            call DoubleAttack(e, u, od*2, -1, P_e)
            set temp_r = 25.
          else
            set temp_r = 5.
          endif
          if ( GetRandomReal(0.,100.) <= temp_r ) then        /* 직업 특성 */
            if ( udg_SysI_NowJob[P_e] == 2 ) then         /* 직업 특성 - 전사 */
              call TimeAction(e, 10., 22)
            elseif ( udg_SysI_NowJob[P_e] == 3 ) then       /* 직업 특성 - 도적 */
              if ( udg_SysI_Xtical[P_e] > 1 ) then
                call Bufftt(CreateTextTagUnitBJ( "* X tical !! x"+I2S(udg_SysI_Xtical[P_e]), e, 20, 13, 100, 0, 0, 0 ),6)
              else
                call Bufftt(CreateTextTagUnitBJ("* X tical !! *", e, 20, 13, 100, 0, 0, 0 ),6)
              endif
              call TimeAction(e, 5., 9)
            elseif ( SysInt(4,GetUnitTypeId(e)) == 6 ) then   /* 직업 특성 - 도가 */
              call TimeAction(e, 7., 20)
            endif
          endif
        endif
        
        /* 드래곤모드 스플래시 - 주변에 데미지 - 콘125, 힘150 기준 125 ~ 100+275% 데미지 */
        if ( GetUnitAbilityLevel(e, 'B00K') > 0 ) then
          set double_u = e
          set udg_temp_g = GetGroupEnemy(CreateGroup(), u, RangeAdd2(200.,P_e), Condition(function Condi_Enemy))
          //call DestroyEffect(AddSpecialEffectTarget("abilities\\weapons\\catapult\\catapultmissile.mdl", u, "overhead"))
          set temp_r = od * GetRandomReal(udg_SysE_CON3[P_e]/100., (100+udg_SysE_CON3[P_e]+udg_SysE_STR3[P_e])*.01)
          call DmgText_View("G", cri, GetWidgetX(u)+33., GetWidgetY(u)-15., R2I(temp_r), .8)
          
          call ForGroup(udg_temp_g, function DragonCallback)
          call DestroyGroup(udg_temp_g)
        endif
        
        /* 나르콜리 */
        if ( UnitRemoveAbility(u, 'B00E') ) then
          call SetUnitTimeScale(u, 1)
          call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", u, "overhead"))
          call DmgText_View("M", cri, GetWidgetX(u)+33., GetWidgetY(u)-15., R2I(od), .8)
          call EXSetEventDamage(od*2.)
        else
          call EXSetEventDamage(od)
        endif
        
        call DmgText_View("N", cri, GetWidgetX(u), GetWidgetY(u), R2I(od), 1.)
        /*if ( cri ) then
          call Bufftt(CreateTextTagUnitBJ("|c00ff0000" + ExpI2S(R2I(od)), u, 20, 14, 100, 100, 100, 0), 4)
        else
          call Bufftt(CreateTextTagUnitBJ(               ExpI2S(R2I(od)), u,-50, 12, 100, 100, 100, 0), 4)
        endif*/
      endif
    
    /* 몹이 공격 = 유저가 맞음 */
    else
      set handle_u = GetHandleId(u)
      set stringhash = StringHash("Miss")
      set P_e = GetPlayerId(GetOwningPlayer(u))+1
      
      /* 회피율에 따른 미스 */
      if ( HaveSavedReal(udg_hash, handle_u, stringhash) ) and ( GetRandomReal(0.,100.) <= LoadReal(udg_hash, handle_u, stringhash) ) then
        call EXSetEventDamage(0.)
        call Bufftt(CreateTextTagUnitBJ("Miss", u, -50, 8, 0, 100, 0, 0), 4)
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl", u, "overhead"))
        
      /* 빗나감 - 이모탈&금강불괴&완전방어 */
      elseif ( (GetUnitAbilityLevel(u, 'B00W')+GetUnitAbilityLevel(u, 'B00V')+GetUnitAbilityLevel(u, 'B00Y')) > 0 ) then
        call EXSetEventDamage(0.)
        call Bufftt(CreateTextTagUnitBJ("Protect", u, -30.00, 12., 0., 75., 50., 20.), 8)
      else
        /* 크리, 배쉬 */
        set handle_u = GetHandleId(e)
        set stringhash = StringHash("CriP")
        
        if ( HaveSavedReal(udg_hash, handle_u, stringhash) ) and ( GetRandomReal(0.,100.) <= LoadReal(udg_hash, handle_u, stringhash) ) then
          set od = od * ( 1.5+LoadReal(udg_hash, handle_u, StringHash("CriX")) )
          
          set stringhash = StringHash("Bash")
          if ( HaveSavedReal(udg_hash, handle_u, stringhash) ) and ( GetRandomReal(0.,100.) <= LoadReal(udg_hash, handle_u, stringhash) ) then
            set od = od + LoadReal(udg_hash, handle_u, stringhash)
            call Dummier(GetOwningPlayer(e), u, -1, 'A091', "thunderbolt")
            call Bufftt(CreateTextTagUnitBJ("* Bash !! *"    , e, 20, 10, 100, 0, 0, 0 ),6)
          else
            call Bufftt(CreateTextTagUnitBJ("* Critical !! *", e, 20, 10, 100, 0, 0, 0 ),6)
          endif
          set cri = true
          call CameraShake(P_e, .4, od / GetUnitState(u, UNIT_STATE_MAX_LIFE) * 10.)
        else
          set cri = false
        endif
        
        set od = od - ( od*.005 * udg_SysC_Armor[P_e] ) /* 아머 */
        set od = od * ( 1.-udg_SysC_AC_R[P_e] )       /* 호르라마 */
        
        /* 갭 시스템, 레벨^2만큼 추가데미지 */
        set handle_u = GetHandleId(u)
        set stringhash = StringHash("Level")
        if ( HaveSavedInteger(udg_hash, handle_u, stringhash) ) then
          set od = od + Pow((GetUnitLevel(u) + LoadInteger(udg_hash, handle_u, stringhash)) - udg_SysB_Level[P_e], 2.)
        else
          set od = od + Pow( GetUnitLevel(u)                                                - udg_SysB_Level[P_e], 2.)
        endif
        
        /* 반탄신공 - 70%로 70% 감소 후 반사(셋 중 낮은수치) = 데미지x3, 적 최대체력의 12.5% */
        if ( GetUnitAbilityLevel(u, 'B00A') > 0 ) and ( GetRandomReal(0.,100.) <= 70 ) then
          call Bufftt(CreateTextTagUnitBJ("Reflection", u, -30., 8., 0., 75., 50., 20.), 8)
          call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Defend\\DefendCaster.mdl", u, "origin"))
          call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ThornsAura\\ThornsAuraDamage.mdl", e, "head"))
          debug call BJDebugMsg("반사 Dmg: " + R2S(GetUnitState(u, UNIT_STATE_MAX_LIFE)*.125)+ " ~ " + R2S(od*3.))
          set temp_r = RMinBJ(GetUnitState(u, UNIT_STATE_MAX_LIFE)*.125, od*3.)
          call DmgTrue(u, e, temp_r)
          call DmgText_View("G", cri, GetWidgetX(e), GetWidgetY(e), R2I(temp_r), .8)
          set od = od * .3
        endif
        
        /* 나르콜리 */
        if ( UnitRemoveAbility(u, 'B00E') ) then
          call SetUnitTimeScale(u, 1)
          call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", u, "overhead"))
          call DmgText_View("M", cri, GetWidgetX(u)+33., GetWidgetY(u)-15., R2I(od), .8)
          call EXSetEventDamage(od*2.)
        else
          call EXSetEventDamage(od)
        endif
        
        call DmgText_View("N", cri, GetWidgetX(u), GetWidgetY(u), R2I(od), 1.)
      endif
    endif
  endfunction
  private function v6_Action3 takes unit u, unit e returns nothing
  /* 더미 */
    set P_e = GetPlayerId(GetOwningPlayer(e))+1
    if ( GetUnitTypeId(e) == 'e015' ) then
      if ( GetUnitState(e, UNIT_STATE_MANA) > 0. ) then
        set temp_r = GetUnitState(e, UNIT_STATE_MANA)
      else
        set temp_r = DummyActionNo(GetUnitUserData(e), udg_Unit[P_e], u, P_e, 0)
      endif
    else
      set temp_r = DummyActionNo(GetUnitTypeId(e), udg_Unit[P_e], u, P_e, 0)
    endif
    
    call DmgSkill(udg_Unit[P_e], u, temp_r)
  endfunction
  
  /* 스킬 */
  private function v6_Action4 takes unit u, unit e, real od, boolean hero returns nothing
    if ( hero ) then
      set handle_u = GetHandleId(u)
      set stringhash = StringHash("Miss")
      set P_e = GetPlayerId(GetOwningPlayer(e))+1
      
      /* 스킬 회피 - 보정 5배 */
      if ( not udg_SYSTEM_isCri ) and ( HaveSavedReal(udg_hash, handle_u, stringhash) ) and ( GetRandomReal(0.,100.) <= (LoadReal(udg_hash, handle_u, stringhash)-udg_SysC_Hits[P_e])*.2 ) then
        call EXSetEventDamage(0.)
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl", u, "overhead"))
        call Bufftt(CreateTextTagUnitBJ("Miss", u, -50, 8, 0, 100, 0, 0), 4)
      else
        set udg_SYSTEM_isCri = false
        
        /* 보스 10% 데미지 */
        set od = od * IsBoss(GetUnitState(u, ConvertUnitState($50)) == 6. )
        set stringhash = StringHash("AC")
        if ( HaveSavedInteger(udg_hash, handle_u, stringhash) ) then
          set od = od - ( od*.005 * LoadInteger(udg_hash, handle_u, stringhash) )       /* 아머 */
        else
          set od = od - ( od*.005 * udg_SysC_Armor[GetPlayerId(GetOwningPlayer(u))+1] ) /* 아머 */
          set od = od * ( 1.-udg_SysC_AC_R[GetPlayerId(GetOwningPlayer(u))+1] )         /* 호르라마 */
        endif
        
        /* Dam에 따른 추가데미지 */
        set od = od * GetDmg(P_e)
        
        /* 크리티컬: 사전 처리 */
        
        /* 나르콜리 */
        if ( UnitRemoveAbility(u, 'B00E') ) then
          call SetUnitTimeScale(u, 1)
          call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", u, "overhead"))
          //call Bufftt(CreateTextTagUnitBJ("       |c00ffff00+|c00609fdf" + ExpI2S(R2I(od)), u, -50., 11., 100., 100., 100., 0), 6)
          call DmgText_View("M", cri, GetWidgetX(u)+33., GetWidgetY(u)-15., R2I(od), .8)
          call EXSetEventDamage(od*2.)
        else
          call EXSetEventDamage(od)
        endif
        
        call DmgText_View("S", cri, GetWidgetX(u), GetWidgetY(u), R2I(od), 1.)
        
        /* 무도가 - 콤보:범위 */
        set stringhash = StringHash("ing4")
        if ( HaveSavedBoolean(udg_hash, P_e, stringhash) ) and ( LoadBoolean(udg_hash, P_e, stringhash) ) then
          if ( GetRandomReal(0.,100.) <= udg_SysC_CriP[P_e] ) then
            set temp_r = od * MakeValue("0|Lv+*25|St=*25|Co=*25",P_e) * GetDmg(P_e) * udg_SysC_CriX[P_e]
            set cri = true
          else
            set temp_r = od * MakeValue("0|Lv+*25|St=*25|Co=*25",P_e) * GetDmg(P_e)
            set cri = false
          endif
          call DmgText_View("G", cri, GetWidgetX(u), GetWidgetY(u), R2I(temp_r), 1.)
          
          set double_u = e
          set udg_temp_g = GetGroupEnemy(CreateGroup(), u, 150., Condition(function Condi_Enemy))
          call DestroyEffect(AddSpecialEffectTarget("abilities\\weapons\\catapult\\catapultmissile.mdl", u, "overhead"))
          call ForGroup(udg_temp_g, function DragonCallback)
          call DestroyGroup(udg_temp_g)
        endif
      endif
    
    /* 몹이 공격 */
    else
      set handle_u = GetHandleId(u)
      set stringhash = StringHash("Miss")
      set P_e = GetPlayerId(GetOwningPlayer(u))+1
      /* 스킬 회피 - 보정 5배 */
      if ( not udg_SYSTEM_isCri ) and ( HaveSavedReal(udg_hash, handle_u, stringhash) ) and ( GetRandomReal(0.,100.) <= (LoadReal(udg_hash, handle_u, stringhash)-udg_SysC_Hits[P_e])*.2 ) then
        call EXSetEventDamage(0.)
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl", u, "overhead"))
        call Bufftt(CreateTextTagUnitBJ("Miss", u, -50, 8, 0, 100, 0, 0), 4)
      else
        set od = od - ( od*.005 * udg_SysC_Armor[GetPlayerId(GetOwningPlayer(u))+1] ) /* 아머 */
        set od = od * ( 1.-udg_SysC_AC_R[GetPlayerId(GetOwningPlayer(u))+1] )         /* 호르라마 */
        
        /* 나르콜리 */
        if ( UnitRemoveAbility(u, 'B00E') ) then
          call SetUnitTimeScale(u, 1)
          call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", u, "overhead"))
          call DmgText_View("M", udg_SYSTEM_isCri, GetWidgetX(u)+33., GetWidgetY(u)-15., R2I(od), .8)
          call EXSetEventDamage(od*2.)
        else
          call EXSetEventDamage(od)
        endif
        
        call DmgText_View("S", udg_SYSTEM_isCri, GetWidgetX(u), GetWidgetY(u), R2I(od), 1.)
      endif
    endif
  endfunction
  
  /* 중독류 */
  private function v6_Action5 takes unit u, unit e, real od returns nothing
    if ( isHero(u) ) then
      if (GetUnitAbilityLevel(u, 'B00W') > 0) or (GetUnitAbilityLevel(u, 'B00V') > 0) or (GetUnitAbilityLevel(u, 'B00Y') > 0) then
        call Bufftt(CreateTextTagUnitBJ("Protect", u, -30.00, 12., 0., 75., 50., 20.), 8)
        call EXSetEventDamage(0.)
      else
        set od = od * ( 1.-udg_SysC_AC_R[GetPlayerId(GetOwningPlayer(u))+1] )         /* 호르라마 */
        
        /* 나르콜리 */
        if ( UnitRemoveAbility(u, 'B00E') ) then
          call SetUnitTimeScale(u, 1)
          call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", u, "overhead"))
          call DmgText_View("M", udg_SYSTEM_isCri, GetWidgetX(u)+33., GetWidgetY(u)-15., R2I(od), .8)
          call EXSetEventDamage(od*2.)
        else
          call EXSetEventDamage(od)
        endif
        call DmgText_View("M", udg_SYSTEM_isCri, GetWidgetX(u), GetWidgetY(u), R2I(od), 1.)
      endif
    else
      set handle_u = GetHandleId(u)
      set stringhash = StringHash("MAC")
      if ( HaveSavedInteger(udg_hash, handle_u, stringhash) ) then
        set od = od - ( od*.005 * LoadInteger(udg_hash, handle_u, stringhash) )       /* 마방 */
      endif
      
      /* 나르콜리 */
      if ( UnitRemoveAbility(u, 'B00E') ) then
        call SetUnitTimeScale(u, 1)
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", u, "overhead"))
        call DmgText_View("M", udg_SYSTEM_isCri, GetWidgetX(u)+33., GetWidgetY(u)-15., R2I(od), .8)
        call EXSetEventDamage(od*2.)
      else
        call EXSetEventDamage(od)
      endif
      call DmgText_View("M", udg_SYSTEM_isCri, GetWidgetX(u), GetWidgetY(u), R2I(od), 1.)
    endif
  endfunction
  
  /* 마법 */
  private function v6_Action1 takes unit u, unit e, real od, boolean hero returns nothing
    if ( hero ) then
      set handle_u = GetHandleId(u)
      set stringhash = StringHash("Mdf")
      set P_e = GetPlayerId(GetOwningPlayer(e))+1
      
      /* 마법 회피(방어) */
      if ( not udg_SYSTEM_isCri ) and ( HaveSavedReal(udg_hash, handle_u, stringhash) ) and ( GetRandomReal(0.,100.) <= (LoadReal(udg_hash, handle_u, stringhash)-(udg_SysE_INT3[P_e]*.2))*(1.-(udg_SysC_Hits[P_e]*.01)) ) then
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\ReplenishManaCasterOverhead.mdl", u, "overhead"))
        call Bufftt(CreateTextTagUnitBJ("마방 !!", u, -50, 8, 0, 100, 0, 0), 4)
        call EXSetEventDamage(0.)
      else
        set od = od * IsBoss(GetUnitState(u, ConvertUnitState($50)) == 6. )
        
        set stringhash = StringHash("MAC")
        if ( HaveSavedInteger(udg_hash, handle_u, stringhash) ) then
          set od = od - ( od*.005 * LoadInteger(udg_hash, handle_u, stringhash) )       /* 마방 */
        else
          set od = od - ( od*.005 * udg_SysC_ArmorM[GetPlayerId(GetOwningPlayer(u))+1] ) /* 마방아머 */
          set od = od * ( 1.-udg_SysC_AC_R[GetPlayerId(GetOwningPlayer(u))+1] )         /* 호르라마 */
        endif
        
        /* 나르콜리 */
        if ( UnitRemoveAbility(u, 'B00E') ) then
          call SetUnitTimeScale(u, 1)
          call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", u, "overhead"))
          call DmgText_View("M", udg_SYSTEM_isCri, GetWidgetX(u)+33., GetWidgetY(u)-15., R2I(od), .8)
          call EXSetEventDamage(od*2.)
        else
          call EXSetEventDamage(od)
        endif
        if ( udg_SYSTEM_isPot ) then
          call DmgText_View("D", udg_SYSTEM_isCri, GetWidgetX(u), GetWidgetY(u), R2I(od), 1.)
        else
          call DmgText_View("M", udg_SYSTEM_isCri, GetWidgetX(u), GetWidgetY(u), R2I(od), 1.)
        endif
      endif
    
    /* 몹이 공격 */
    else
      set P_e = GetPlayerId(GetOwningPlayer(u))+1
      
      /* 마방 */
      if ( GetRandomReal(0.,100.) <= udg_SysC_MissMagic[P_e] ) then
        call MSG(GetOwningPlayer(u), 2, 5., "|cff46ffff마법 방어 !!|r - |cff9932cc" + udg_SYSTEM_DamgeColor)
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\ReplenishManaCasterOverhead.mdl", u, "overhead"))
        call Bufftt(CreateTextTagUnitBJ("마방 !!", u, -30., 15., 100.00, 0, 50., 20.), 10)
        call EXSetEventDamage(0.)
      
      /* 이모탈, 금강불괴, 완방 */
      elseif ( GetUnitAbilityLevel(u, 'B00W')+GetUnitAbilityLevel(u, 'B00V')+GetUnitAbilityLevel(u, 'B00Y') > 0 ) then
        call MSG(GetOwningPlayer(u), 2, 3., "|cff46ffff마법 면역 !!|r - |cff9932cc" + udg_SYSTEM_DamgeColor)
        call Bufftt(CreateTextTagUnitBJ("Protect", u, -30.00, 12., 0., 75., 50., 20.), 8)
      
      /* 리플렉토 - 반사 */
      elseif ( GetUnitAbilityLevel(u, 'B010') > 0 ) then
        call MSG(GetOwningPlayer(u), 2, 3., "|cff46ffff마법 반사 !!|r - |cff9932cc" + udg_SYSTEM_DamgeColor)
        call Bufftt(CreateTextTagUnitBJ("Reflect !!", u, -30., 12., 0., 75., 50., 20.), 8)
        call EXSetEventDamage(0.)
        
        call DmgTrue(u, e, od*2)
        call DmgText_View("M", false, GetWidgetX(u)+33., GetWidgetY(u)-15., R2I(od*2.), 1.)
      
      else
        
        /* 변이 증폭 */
        set handle_u = GetHandleId(e)
        set stringhash = StringHash("MDmg")
        if ( HaveSavedReal(udg_hash, handle_u, stringhash) ) then
          set od = od * LoadReal(udg_hash, handle_u, stringhash)
        endif
        
        set od = od - ( od*.005 * udg_SysC_ArmorM[GetPlayerId(GetOwningPlayer(u))+1] )  /* 마방아머 */
        set od = od * ( 1.-udg_SysC_AC_R[GetPlayerId(GetOwningPlayer(u))+1] )           /* 호르라마 */
        
        /* 나르콜리 */
        if ( UnitRemoveAbility(u, 'B00E') ) then
          call SetUnitTimeScale(u, 1)
          call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", u, "overhead"))
          call DmgText_View("M", udg_SYSTEM_isCri, GetWidgetX(u)+33., GetWidgetY(u)-15., R2I(od), .8)
          call EXSetEventDamage(od*2.)
        else
          call EXSetEventDamage(od)
        endif
        call DmgText_View("M", udg_SYSTEM_isCri, GetWidgetX(u), GetWidgetY(u), R2I(od), 1.)
      endif
    
    endif
    set udg_SYSTEM_isPot = false
  endfunction
  private function v6_Actions takes nothing returns nothing
    if ( ConvertDamageType(EXGetEventDamageData(4)) == DAMAGE_TYPE_COLD ) then      /* 마법 스킬 피해 */
      call v6_Action1(GetTriggerUnit(), GetEventDamageSource(), GetEventDamage(), isHero(GetEventDamageSource()))
    elseif ( ConvertDamageType(EXGetEventDamageData(4)) == DAMAGE_TYPE_SONIC ) then /* 더미 스킬 피해 */
      call v6_Action3(GetTriggerUnit(), GetEventDamageSource())
    elseif ( ConvertDamageType(EXGetEventDamageData(4)) == DAMAGE_TYPE_FIRE ) then  /* 물리 스킬 피해 */
      call v6_Action4(GetTriggerUnit(), GetEventDamageSource(), GetEventDamage(), isHero(GetEventDamageSource()))
    elseif ( ConvertDamageType(EXGetEventDamageData(4)) == DAMAGE_TYPE_POISON ) then/* 특수 스킬 피해 (독) */
      call v6_Action5(GetTriggerUnit(), GetEventDamageSource(), GetEventDamage())
    elseif ( EXGetEventDamageData(2) != 0 ) and ( ConvertDamageType(EXGetEventDamageData(4)) != DAMAGE_TYPE_DEATH ) then              
    /* is 평타 */
      call v6_Action2(GetTriggerUnit(), GetEventDamageSource(), GetEventDamage(), isHero(GetEventDamageSource()))
    endif
  endfunction
  private function v6_Conditions takes nothing returns boolean
    return ( GetEventDamage() != 0. )
    //and ( ConvertDamageType(EXGetEventDamageData(4)) == DAMAGE_TYPE_NORMAL ) 
  endfunction
  public function Init_v6 takes nothing returns nothing
    set DmgTrigger_v6 = CreateTrigger()
    call TriggerAddCondition(DmgTrigger_v6, Condition(function v6_Conditions))
    call TriggerAddAction(DmgTrigger_v6, function v6_Actions)
  endfunction
endscope//===========================================================================
// Trigger: Sys Create Monster
//
// 25%
// 15%
// 5%
//===========================================================================
function Union takes unit u returns nothing
//조화의던전 조립
local integer i
local string nc1 = "war3mapImported\\DYOG_1R_"
local string nc2 = "war3mapImported\\DYOG_2S_"
local string nc3 = "war3mapImported\\DYOG_3C_"
local string nc4 = "war3mapImported\\DYOG_4D_"
local string array attach
local string array s
local integer t = GetUnitTypeId(u)
  call ShowUnit(u, false)
set attach[4] = "hand left third"
set attach[5] = "hand right third"
set attach[6] = "hand left second"
set attach[7] = "hand right second"
set attach[8] = "hand left first"
set attach[9] = "hand right first"
set attach[10] = "foot left third"
set attach[11] = "foot right third"
set attach[12] = "foot left second"
set attach[13] = "foot right second"
set attach[14] = "foot left first"
set attach[15] = "foot right first"

set s[4] = "4SL.mdx"
set s[5] = "4SR.mdx"
set s[6] = "5AL.mdx"
set s[7] = "5AR.mdx"
set s[8] = "6HL.mdx"
set s[9] = "6HR.mdx"
set s[10] = "7TL.mdx"
set s[11] = "7TR.mdx"
set s[12] = "8AL.mdx"
set s[13] = "8AR.mdx"
set s[14] = "9FL.mdx"
set s[15] = "9FR.mdx"
  
  if ( t == 'n03D' ) then
    call AddSpecialEffectTarget("war3mapImported\\DYOG_1R_1H.mdx", u, "head first")
    call AddSpecialEffectTarget("war3mapImported\\DYOG_1R_2C.mdx", u, "chest first")
    call AddSpecialEffectTarget("war3mapImported\\DYOG_1R_3P.mdx", u, "chest second")
    set i = 2
    loop
      exitwhen i > 15
      set i = i + 1
      if ( GetRandomReal(0,100) <= 90 ) then
        set s[i] = nc1 + s[i]
      else
        set s[i] = nc2 + s[i]
      endif
    endloop
  elseif ( t == 'n03E' ) then
    call AddSpecialEffectTarget("war3mapImported\\DYOG_1R_1H.mdx", u, "head first")
    call AddSpecialEffectTarget("war3mapImported\\DYOG_1R_2C.mdx", u, "chest first")
    call AddSpecialEffectTarget("war3mapImported\\DYOG_1R_3P.mdx", u, "chest second")
    set i = 2
    loop
      set i = i + 1
      exitwhen i > 15
      if ( GetRandomReal(0,100) <= 80 ) then
        set s[i] = nc1 + s[i]
      else
        set s[i] = nc2 + s[i]
      endif      
    endloop
  elseif ( t == 'n03G' ) then
  //원거리 
    call AddSpecialEffectTarget("war3mapImported\\DYOG_2S_1H.mdx", u, "head first")
    call AddSpecialEffectTarget("war3mapImported\\DYOG_1R_2C.mdx", u, "chest first")
    call AddSpecialEffectTarget("war3mapImported\\DYOG_1R_3P.mdx", u, "chest second")
    set i = 2
    loop
      set i = i + 1
      exitwhen i > 15      
      if ( GetRandomReal(0,100) <= 65 ) then
        set s[i] = nc1 + s[i]
      elseif ( GetRandomReal(0,35) <= 30 ) then
        set s[i] = nc2 + s[i]
      else
        set s[i] = nc3 + s[i]
      endif
    endloop
  elseif ( t == 'n03F' ) then
    call AddSpecialEffectTarget("war3mapImported\\DYOG_1R_1H.mdx", u, "head first")
    call AddSpecialEffectTarget("war3mapImported\\DYOG_1R_2C.mdx", u, "chest first")
    call AddSpecialEffectTarget("war3mapImported\\DYOG_1R_3P.mdx", u, "chest second")
    set i = 2
    loop
      set i = i + 1
      exitwhen i > 15
      if ( GetRandomReal(0,100) <= 65 ) then
        set s[i] = nc1 + s[i]
      elseif ( GetRandomReal(0,35) <= 30 ) then
        set s[i] = nc2 + s[i]
      else
        set s[i] = nc3 + s[i]
      endif
    endloop
  elseif ( t == 'n03H' ) then
    call AddSpecialEffectTarget("war3mapImported\\DYOG_2S_1H.mdx", u, "head first")
    call AddSpecialEffectTarget("war3mapImported\\DYOG_2S_2C.mdx", u, "chest first")
    call AddSpecialEffectTarget("war3mapImported\\DYOG_2S_3P.mdx", u, "chest second")
    set i = 0
    loop
      set i = i + 1
      exitwhen i > 15
      if ( GetRandomReal(0,100) <= 30 ) then
        set s[i] = nc1 + s[i]
      elseif ( GetRandomReal(0,70) <= 60 ) then
        set s[i] = nc2 + s[i]
      else
        set s[i] = nc3 + s[i]
      endif
    endloop
  elseif ( t == 'n03I' ) then
    call AddSpecialEffectTarget("war3mapImported\\DYOG_2S_1H.mdx", u, "head first")
    call AddSpecialEffectTarget("war3mapImported\\DYOG_2S_2C.mdx", u, "chest first")
    call AddSpecialEffectTarget("war3mapImported\\DYOG_2S_3P.mdx", u, "chest second")
    set i = 2
    loop
      exitwhen i > 15
      set i = i + 1
      if ( GetRandomReal(0,100) <= 60 ) then
        set s[i] = nc2 + s[i]
      else
        set s[i] = nc3 + s[i]
      endif
    endloop
  elseif ( t == 'n03J' ) then
  //원거리
    call AddSpecialEffectTarget("war3mapImported\\DYOG_3C_1H.mdx", u, "head first")
    call AddSpecialEffectTarget("war3mapImported\\DYOG_2S_2C.mdx", u, "chest first")
    call AddSpecialEffectTarget("war3mapImported\\DYOG_2S_3P.mdx", u, "chest second")
    set i = 2
    loop
      exitwhen i > 15
      set i = i + 1
      if ( GetRandomReal(0,100) <= 50 ) then
        set s[i] = nc2 + s[i]
      elseif ( GetRandomReal(0,50) <= 40 ) then
        set s[i] = nc3 + s[i]
      else
        set s[i] = nc4 + s[i]
      endif
    endloop
  elseif ( t == 'n03K' ) then
    call AddSpecialEffectTarget("war3mapImported\\DYOG_3C_1H.mdx", u, "head first")
    call AddSpecialEffectTarget("war3mapImported\\DYOG_2S_2C.mdx", u, "chest first")
    call AddSpecialEffectTarget("war3mapImported\\DYOG_2S_3P.mdx", u, "chest second")
    set i = 2
    loop
      exitwhen i > 15
      set i = i + 1
      if ( GetRandomReal(0,100) <= 20 ) then
        set s[i] = nc2 + s[i]
      elseif ( GetRandomReal(0,50) <= 70 ) then
        set s[i] = nc3 + s[i]
      else
        set s[i] = nc4 + s[i]
      endif
    endloop  
  elseif ( t == 'n03L' ) then
    call AddSpecialEffectTarget("war3mapImported\\DYOG_4D_1H.mdx", u, "head first")
    call AddSpecialEffectTarget("war3mapImported\\DYOG_4D_2C.mdx", u, "chest first")
    call AddSpecialEffectTarget("war3mapImported\\DYOG_4D_3P.mdx", u, "chest second")
    set i = 2
    loop
    exitwhen i > 15
      set i = i + 1
      if ( GetRandomReal(0,100) <= 20 ) then
        set s[i] = nc3 + s[i]
      else
        set s[i] = nc4 + s[i]
      endif
    endloop      
  endif

  set i = 2
  loop
    set i = i + 1
    call AddSpecialEffectTarget(s[i], u, attach[i])
    exitwhen i > 15
  endloop
  
  call ShowUnit(u, true)
  set u = null
endfunction

constant function RandomAura takes real per, integer lv returns integer
//광산 변이 추가효과
  if ( lv == 0 ) then
    if ( per <= 5. ) then
    //커맨드
    //인듀
    //브릴
    //뱀파
    //언홀리
      return 'ACac'
    elseif ( per <= 10. ) then
      return 'SCae'
    elseif ( per <= 15. ) then
      return 'ACba'
    elseif ( per <= 20. ) then
      return 'AIav'
    elseif ( per <= 25. ) then
      return 'ACua'
    endif
  elseif ( lv <= 2 ) then
    if ( per <= 10. ) then
      return 'ACac'
    elseif ( per <= 20. ) then
      return 'SCae'
    elseif ( per <= 30. ) then
      return 'ACba'
    elseif ( per <= 40. ) then
      return 'AIav'
    elseif ( per <= 50. ) then
      return 'ACua'
    endif
  else
    if ( per <= 20. ) then
      return 'ACac'
    elseif ( per <= 40. ) then
      return 'SCae'
    elseif ( per <= 60. ) then
      return 'ACba'
    elseif ( per <= 80. ) then
      return 'AIav'
    elseif ( per <= 100. ) then
      return 'ACua'
    endif
  endif
  return 0
endfunction
function MineMonster takes unit u, boolean mu returns nothing
//광산 기본효과
 local integer ut = GetUnitTypeId(u)
  //공통
  call SetUS("Hp", bj_lastCreatedUnit, R2I(.7+GetWidgetLife(bj_lastCreatedUnit)*Pow(1.13,I2R(udg_SYSTEM_MineFloor-1))), true)
  call SaveReal(udg_hash, GetHandleId(bj_lastCreatedUnit), StringHash("BonusHP"), (Pow(1.13,I2R(udg_SYSTEM_MineFloor-1))-.4)*8.)
  call SetUS("Dmg", bj_lastCreatedUnit, (300+(udg_SYSTEM_MineFloor*75))*udg_SYSTEM_MineFloor, true)
    
  call SetUS("Armor", bj_lastCreatedUnit, udg_SYSTEM_MineFloor*5, true)
  call SetUS("MAC", bj_lastCreatedUnit, udg_SYSTEM_MineFloor*5, true)
  call SetUS2("mrd2", bj_lastCreatedUnit, .25+(.05*udg_SYSTEM_MineFloor))
  if ( mu ) then
    if ( SubString(GetUnitName(u),1,4) == "헬" ) then
      if ( ut == 'n04L' ) then
        call SetUS("Armor", u, 50, true)
      elseif ( ut == 'n04M' ) then
        call SetUS2("Miss", u, 30.)
      elseif ( ut == 'n04N' ) then
        call IncUnitAbilityLevel(u, 'SCae')
        call SetUS("MAC", u, 30, true)
      elseif ( ut == 'n04O' ) then
        call SetUS("MAC", u, 30, true)
      elseif ( ut == 'n04K' ) then
        call IncUnitAbilityLevel(u, 'ACua')
        call IncUnitAbilityLevel(u, 'AIav')
      endif
    else
      if ( ut == 'n04P' or ut == 'n04Q' or ut == 'n04J' ) then
        //펄버	오크병사,전사,가드
        call IncUnitAbilityLevel(u, 'Awar')
      elseif ( ut == 'n04D' or ut == 'n04E' or ut == 'n04F' or ut == 'n04G' ) then
        //회피	그림록병사,그림록,근위병,퀸
        call SetUS2("Miss", u, 30.)
      
      elseif ( ut == 'n04R' or ut == 'n04S' or ut == 'n04H' ) then
        //크리	광산드워프병사,드워프, 도둑산타
        call IncUnitAbilityLevel(u, 'AOcr')
      elseif ( ut == 'n04I' ) then
        call IncUnitAbilityLevel(u, 'AIll')
      endif
    endif
    
    set ut = RandomAura(GetRandomReal(0.,100.), udg_SysA_MapLevel)
    if ( ut != 0 ) then
      call UnitAddAbility(u, ut)
      call IncUnitAbilityLevel(u, ut)
    endif
  else
    if ( SubString(GetUnitName(u),1,4) == "헬" ) then
      if ( ut == 'n04L' ) then
        call SetUS("Armor", u, 25, true)
      elseif ( ut == 'n04M' ) then
        call SetUS2("Miss", u, 15.)
      elseif ( ut == 'n04N' ) then
        call SetUS("MAC", u, 15, true)
      elseif ( ut == 'n04O' ) then
        call SetUS("MAC", u, 15, true)
      endif
    else
      if ( ut == 'n04D' or ut == 'n04E' or ut == 'n04F' or ut == 'n04G' ) then
        call SetUS2("Miss", u, 15.)
      endif
    endif
  endif
endfunction
constant function FBUFF_BASE takes integer i returns integer
  //호밀밭
  if ( i == 1 ) then
    return 10
    
  //큐르
  elseif ( i == 6 ) then
    return 4
    
  //포테
  elseif ( i == 10 ) or ( i == 11 ) then
    return 5

  //특별(농경지, 솔던)
  elseif ( i == 15 ) or ( i == 47 ) then
    return 12

  //지묘
  elseif ( i >= 16 ) and ( i <= 23 ) then
    return 2

  //사막
  elseif ( i >= 24 ) and ( i <= 26 ) then
    return 11
  
  //우드
  elseif ( i >= 27 ) and ( i <= 36 ) then
    return 9

  //해안가
  elseif ( i >= 37 ) and ( i <= 42 ) then
    return 3

  //조화
  elseif ( i >= 43 ) and ( i <= 46 ) then
    return 6

  //호러
  elseif ( i >= 48 ) and ( i <= 50 ) then
    return 7
  
  //광산
  elseif ( i >= 51 ) and ( i <= 60 ) then
    return 13

  //죽마
  elseif ( i >= 61 ) and ( i <= 66 ) then
    return 14
  else
    return 1
  endif
endfunction
//특성

function ZombieChecekHP100per takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local unit u = LoadUnitHandle(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("ZombieHP"))
 local integer BaseColor = ZombieColor(GetUnitTypeId(u))
  if ( UnitAlive(u) ) and ( GetWidgetLife(u) >= GetUnitState(u, UNIT_STATE_MAX_LIFE)*.99 ) then
    call SetUnitVertexColor(u, BaseColor, BaseColor, 255, 255)
    call TriggerRegisterUnitEvent(gg_trg_Sys_Zombie_Revive, u, EVENT_UNIT_DEATH)
    
  endif
  call UnitRemoveAbility(u, 'A09U')
  call FlushChildHashtable(udg_hash, GetHandleId(t))
  call DestroyTimer(t)
 set t = null
 set u = null
endfunction
function ZombieMonster takes unit u, boolean mu returns nothing
 local integer BaseColor = ZombieColor(GetUnitTypeId(u))

  if ( GetRandomReal(0., 100.) <= 10.+udg_Quest_ClearInt_15_Explosion ) then
  //10%확률로 자폭좀비 추가 (체력 10%) #빨강
    call SetWidgetLife(u, GetUnitState(u, UNIT_STATE_MAX_LIFE)*.1)
    call UnitRemoveAbility(u, 'A09U')
    call SetUnitVertexColor(u, 255, BaseColor, BaseColor, 255)
    call TriggerRegisterUnitEvent(gg_trg_Sys_Zombie_Boom, u, EVENT_UNIT_DEATH)
  else
  //초당 1% 체력회복, 30초 후 체력에 따라 분리 추가
    call SetWidgetLife(u, GetUnitState(u, UNIT_STATE_MAX_LIFE)*.7)
    call UnitAddAbility(u, 'A09U')
    set bj_lastStartedTimer = CreateTimer()
    call SaveUnitHandle(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("ZombieHP"), u)
    call TimerStart(bj_lastStartedTimer, 33., false, function ZombieChecekHP100per)
    if ( mu ) or ( GetUnitTypeId(u) == 'n04C' ) then
    //변이 혹은 마법좀비 : 소환 추가
      call SetUnitVertexColor(u, BaseColor, 255, BaseColor, 255)
      call SaveStr(udg_hash, GetHandleId(u), StringHash("FAI-Set2"), LoadStr(udg_hash, GetHandleId(u), StringHash("FAI-Set2"))+"e")
      call AI_Check(u)
    endif
  endif
endfunction
//죽마 효과

function FCUBuff takes unit u, integer i returns nothing
  if ( i == 2 ) then
    call SetUnitVertexColor(u, GetRandomInt(0,255), GetRandomInt(0,255), GetRandomInt(0,255), 255)
  endif
//debug call BJDebugMsg(GetUnitName(u) + "/필드no" + I2S(i) + "/종류no" + I2S(FBUFF_BASE(i)))
  call UnitAddAbility(u, 'A001')
  call SetUnitAbilityLevel(u, 'A001', FBUFF_BASE(i))
  if ( FBUFF_BASE(i) == 6 ) then
  //조화
    call Union(u)
  elseif ( FBUFF_BASE(i) == 7 ) then
  //호러
    if ( i == 48 ) then
      if ( GetRandomReal(0.,100.) <= 10. ) then
      //10% 강력유닛 + 마공
        call SaveStr(udg_hash, GetHandleId(u), StringHash("FAI-Set2"), LoadStr(udg_hash, GetHandleId(u), StringHash("FAI-Set2"))+"ab#7$")
        call SaveReal(udg_hash, GetHandleId(u), StringHash("BonusHP"), LoadReal(udg_hash, GetHandleId(u), StringHash("BonusHP"))*1.25)
        call SetUnitScale(u, 2., 2., 2.)
        call TriggerRegisterUnitEvent(gg_trg_Item_Drop_3, u, EVENT_UNIT_DEATH)
        if ( udg_SysA_MapLevel >= 3 ) and ( GetRandomReal(0., 100.) <= 33. ) then
          call TriggerRegisterUnitEvent(gg_trg_Item_Drop_3, u, EVENT_UNIT_DEATH)
        endif
      endif
    elseif ( i == 49 ) then
      if ( GetRandomReal(0.,100.) <= 15. ) then
      //10% 강력유닛 + 마공
        call SaveStr(udg_hash, GetHandleId(u), StringHash("FAI-Set2"), LoadStr(udg_hash, GetHandleId(u), StringHash("FAI-Set2"))+"ab#7$")
        call SetUS("Dmg", u, 990, true)
        call SaveReal(udg_hash, GetHandleId(u), StringHash("BonusHP"), LoadReal(udg_hash, GetHandleId(u), StringHash("BonusHP"))*1.5)
        call SetUS("Hp", u, R2I(GetWidgetLife(u)*1.12), true)
        call SetUnitScale(u, 2.12, 2.12, 2.12)
        if ( udg_SysA_MapLevel == 4 ) and ( GetRandomReal(0., 100.) <= 0.05 ) then
          call TriggerRegisterUnitEvent(gg_trg_Item_Drop_4, u, EVENT_UNIT_DEATH)
        elseif ( udg_SysA_MapLevel >= 3 ) then
          call TriggerRegisterUnitEvent(gg_trg_Item_Drop_3, u, EVENT_UNIT_DEATH)
        endif
      endif
    elseif ( i == 50 ) then
      if ( GetRandomReal(0,100) < 10. ) then
        call SetUnitScale(u, 2.25, 2.25, 2.25)
        call SetUS("Dmg", u, 1485, true)
        call SaveReal(udg_hash, GetHandleId(u), StringHash("BonusHP"), LoadReal(udg_hash, GetHandleId(u), StringHash("BonusHP"))*1.8)
        call SetUS("Hp", u, R2I(GetWidgetLife(u)*1.2), true)
        if ( udg_SysA_MapLevel == 4 ) and ( GetRandomReal(0., 100.) <= 0.2 ) then
          call TriggerRegisterUnitEvent(gg_trg_Item_Drop_4, u, EVENT_UNIT_DEATH)
        elseif ( udg_SysA_MapLevel >= 3 ) then
          call TriggerRegisterUnitEvent(gg_trg_Item_Drop_3, u, EVENT_UNIT_DEATH)
        endif
      else
        call SetUnitScale(u, 1.6, 1.6, 1.6)
        call SetUS("Dmg", u, 990, true)
        call SaveReal(udg_hash, GetHandleId(u), StringHash("BonusHP"), LoadReal(udg_hash, GetHandleId(u), StringHash("BonusHP"))*1.5)
        call SetUS("Hp", u, R2I(GetWidgetLife(u)*1.12), true)
      endif
      call SetUS("Armor", u, 10, true)
      call SetUS2("Miss", u, 10)
      call SetUS2("mdf", u, 10.)
      call SetUS("MAC", u, 10, true)
      if ( GetUnitTypeId(u) == 'n03V' ) then
        call SaveStr(udg_hash, GetHandleId(u), StringHash("FAI-Set2"), LoadStr(udg_hash, GetHandleId(u), StringHash("FAI-Set2"))+"ab#7$")
        call SaveReal(udg_hash, GetHandleId(u), StringHash("BonusHP"), LoadReal(udg_hash, GetHandleId(u), StringHash("BonusHP"))*1.5)
      endif
    endif
  elseif ( FBUFF_BASE(i) == 13 ) then
    call SaveBoolean(udg_hash, i, StringHash("Working"), false)
    call MineMonster(u, GetUnitAbilityLevel(u, 'A047')>0)
    call TriggerRegisterUnitEvent(gg_trg_Item_Drop_5, u, EVENT_UNIT_DEATH)
  elseif ( FBUFF_BASE(i) == 14 ) then
  //죽마
    call ZombieMonster(u, GetUnitAbilityLevel(u, 'A047')>0)
  endif
endfunction

constant function Mutation_per2 takes integer level_map returns real
/* 난이도 따라 5~35% 추가 증가 */
  if ( level_map == 0 ) then
    return .05
  elseif ( level_map == 1 ) then
    return .1
  else
    return .25
  endif
endfunction
constant function Mutation_per takes real bonus, integer level_mob, integer level_map returns real
  return (1.+bonus) * ( 5.+ Mutation_per2(level_map)*level_mob )
endfunction
//변이
function Mutation takes unit oldunit, real bonusp, real size returns boolean
  if ( GetRandomReal(0, 100) <= Mutation_per(bonusp, (GetUnitLevel(oldunit)+LoadInteger(udg_hash,GetHandleId(oldunit),StringHash("Level"))), udg_SysA_MapLevel) ) then
    if ( LoadReal(udg_hash, GetHandleId(oldunit), StringHash("BonusHP")) < 1 ) then
      call SaveReal(udg_hash, GetHandleId(oldunit), StringHash("BonusHP"), GetRandomReal(2., 4.) )
    else
      call SaveReal(udg_hash, GetHandleId(oldunit), StringHash("BonusHP"), LoadReal(udg_hash, GetHandleId(oldunit), StringHash("BonusHP"))+GetRandomReal(1.5, 3.5))
    endif
    
    call UnitAddAbility(oldunit, 'A047')
    if ( udg_SysA_MapLevel >= 3 ) and ( GetRandomReal(0.,100.) <= 10. ) then
      call IncUnitAbilityLevel(oldunit, 'A047')
      call BossBar_Apply(GetLocalPlayer(), oldunit)
      set size = size * 1.6
      call SaveReal(udg_hash, GetHandleId(oldunit), StringHash("BonusHP"), LoadReal(udg_hash, GetHandleId(oldunit), StringHash("BonusHP"))*3.)
    endif
    call SetUnitScale( oldunit, size, size, size )
    call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\Darksummoning\\DarkSummonTarget.mdl", oldunit, "origin") )
    if ( GetUnitAbilityLevel(oldunit, 'A08P') == 0 ) then
      call TriggerRegisterUnitEvent(gg_trg_Item_Drop_3, oldunit, EVENT_UNIT_DEATH)
    endif
    call SetUS("mp", oldunit, 2, true)
    
    
    call SetUS2("Miss", oldunit, 25)
    call SetUS2("mdf", oldunit, 25.)
    
    call SetUS("Armor", oldunit, 50, true)
    call SetUS("MAC", oldunit, 50, true)
    
    call SetUS2("Mdmg", oldunit, 1.+.05*(GetUnitLevel(oldunit)+LoadInteger(udg_hash,GetHandleId(oldunit),StringHash("Level"))))
    return true
  endif
  return false
endfunction
//call Mutation(GetLastCreatedUnit(),1,2.5)

function DistanceXY takes real x, real y, real xx, real yy returns real
 return SquareRoot((xx-x) * (xx-x) + (yy-y) * (yy-y))
endfunction

function Ang2 takes widget u, real x, real y returns real
 return bj_RADTODEG * Atan2(y - GetWidgetY(u), x - GetWidgetX(u))
endfunction

function MS1tt takes real x, real y returns boolean
 local real ix = 0.
 local real iy = 0.
 call RemoveItem(udg_MS_item)
 set udg_MS_item = CreateItem('gold',x,y)
 set ix=GetWidgetX(udg_MS_item)
 set iy=GetWidgetY(udg_MS_item)
 call SetItemVisible(udg_MS_item,false)
 return (x-ix)*(x-ix)+(y-iy)*(y-iy) <= 10.
endfunction

function MS2 takes rect r, widget u, integer loopA returns boolean
 local real ix = 0.
 local real iy = 0.
 local real x = GetRandomReal(GetRectMinX(r), GetRectMaxX(r))
 local real y = GetRandomReal(GetRectMinY(r), GetRectMaxY(r))
  call RemoveItem(udg_MS_item)
  set udg_MS_item = CreateItem('gold',x,y)
  loop
    exitwhen loopA <= 0
    set ix=GetWidgetX(udg_MS_item)
    set iy=GetWidgetY(udg_MS_item)
//debug call BJDebugMsg("test "+I2S(loopA)+" X : " + R2SW(GetWidgetX(udg_MS_item),3,1) + " / Y: " + R2SW(GetWidgetY(udg_MS_item),3,1))
    if ( (x-ix)*(x-ix)+(y-iy)*(y-iy) <= 10. ) and ( GetTerrainCliffLevel(GetWidgetX(u),GetWidgetY(u)) != GetTerrainCliffLevel(ix,iy) ) then
      call SetItemVisible(udg_MS_item,false)
      return true
    endif
    
    set x = GetRandomReal(GetRectMinX(r)+((6-loopA)*20.), GetRectMaxX(r)-((6-loopA)*20.))
    set y = GetRandomReal(GetRectMinY(r)+((6-loopA)*60.), GetRectMaxY(r)-((6-loopA)*60.))
    call SetItemPosition(udg_MS_item,x,y)
    set loopA = loopA - 1
  endloop
    set x = GetRandomReal(GetRectMinX(r)+((6-loopA)*20.), GetRectMaxX(r)-((6-loopA)*20.))
    set y = GetRandomReal(GetRectMinY(r)+((6-loopA)*60.), GetRectMaxY(r)-((6-loopA)*60.))
    call SetItemPosition(udg_MS_item,x,y)
    call SetItemVisible(udg_MS_item,false)
  return false
endfunction

constant function MUSIZE takes integer ut returns real
//변이의 크기
  if ( ut == 'n02D' ) then
    return .6
  elseif ( ut == 'n02G' ) then
    return 1.3
  elseif ( ut == 'n02L' ) then
    return .65
  elseif ( ut == 'n02M' ) then
    return .9
  elseif ( ut == 'n02N' ) then
    return 1.1
  elseif ( ut == 'n03N' ) then
    return 1.25
  elseif ( ut == 'n02O' ) then
    return 1.35
  else
    return 1.8
  endif
endfunction
function Res_Condtions takes nothing returns boolean
  return ( GetFilterUnit() == udg_Unit[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] )
endfunction

function FCUTimer takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local integer i = LoadInteger(udg_hash, GetHandleId(t), StringHash("FCU-N"))
 local integer m = 0
 local real r = 0
 local group g = CreateGroup()
 local real x = 0.
 local real y = 0.
 //local integer tr = LoadInteger(udg_hash, i, StringHash("FCU-Special"))
 local real c = 1.+LoadInteger(udg_hash, i, StringHash("FCU-Add1"))
//Step 1 - Set Rect & TargetUnit
  set udg_temp_rc = Hunting_Rect(i)
  if ( udg_temp_rc == null ) then
    call MSGAll(0, true, 1, 2, 3., "시스템 에러! 카페에 신고 해 주세요: [ FCU-rc-null, " + I2S(i) + " ]")
    set udg_temp_rc = bj_mapInitialPlayableArea
  endif
  call GroupEnumUnitsInRect2(g, udg_temp_rc, Condition(function Res_Condtions))
  if ( FBUFF_BASE(i) == 13 ) and ( udg_SYSTEM_MineFloor != 0 ) then
    set i = 50+udg_SYSTEM_MineFloor
    set c = 1.+LoadInteger(udg_hash, i, StringHash("FCU-Add1")) + GetRandomReal(0., 1.+LoadReal(udg_hash, i, StringHash("FCU-Add2")))
  else
    set c = c + GetRandomReal(0., 1.+LoadReal(udg_hash, i, StringHash("FCU-Add2")))
  endif
  loop
    exitwhen c < 1
    set udg_temp_u = GetGRU(g)
    
    if ( udg_temp_u != null ) then
//Step 2 - Set MopCode
      set m = LoadInteger(udg_hash, i, StringHash("FCU-Count"))
      set r = GetRandomReal(0.,LoadReal(udg_hash, i, StringHash("FCU-Per")))
      loop
        exitwhen m < 1
        if ( m > 1 and r > LoadReal(udg_hash, i, StringHash("FCU-Per" + I2S(m-1))) ) then
          set m = LoadInteger(udg_hash, i, StringHash("FCU-Unit" + I2S(m)))
          exitwhen true
        elseif ( m <= 1 ) then
          set m = LoadInteger(udg_hash, i, StringHash("FCU-Unit1"))
          exitwhen true
        endif
        set m = m - 1
      endloop
//Step 3 - Set Location
      if not MS2(udg_temp_rc,udg_temp_u,5 ) then
        //call SetItemPosition(udg_MS_item,PolarX(GetWidgetX(udg_temp_u), DistanceXY(GetWidgetX(udg_temp_u),GetWidgetY(udg_temp_u),GetRectCenterX(udg_temp_rc),GetRectCenterY(udg_temp_rc)), Ang2(udg_temp_u,GetRectCenterX(udg_temp_rc),GetRectCenterY(udg_temp_rc))), PolarY(GetWidgetY(udg_temp_u), DistanceXY(GetWidgetY(udg_temp_u),GetWidgetY(udg_temp_u),GetRectCenterX(udg_temp_rc),GetRectCenterY(udg_temp_rc)), Ang2(udg_temp_u,GetRectCenterX(udg_temp_rc),GetRectCenterY(udg_temp_rc))))
//debug call BJDebugMsg("test X : " + R2SW(GetWidgetX(udg_MS_item),3,1) + " / Y: " + R2SW(GetWidgetY(udg_MS_item),3,1))
        //call SetItemVisible(udg_MS_item,false)
      endif
      
//Step 4 - Create
      set bj_lastCreatedUnit = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), m, GetWidgetX(udg_MS_item), GetWidgetY(udg_MS_item), GetRandomReal(0,360))
//Step 5 - Actions!
//!구역별 설정으로 확인!
      if ( i == 47 ) then
        set m = IMaxBJ(25,GetUnitLevel(udg_temp_u) + R2I(GetRandomReal(-8.,4.)))
        call SaveInteger(udg_hash, GetHandleId(bj_lastCreatedUnit), StringHash("Level"), m)
        call SetUS("Mp", bj_lastCreatedUnit, m-1, true)
        call SetUS("Hp", bj_lastCreatedUnit, R2I((m*2.+50.)*m *(1.+r)), true)
        call SetUS("Dmg", bj_lastCreatedUnit, R2I((((m/15.+1.5)*m)-10) *(1.+r)), true)
        call SaveReal(udg_hash, GetHandleId(bj_lastCreatedUnit), StringHash("BonusHP"), r)
      else
        call SetUS2("Miss", bj_lastCreatedUnit, LoadReal(udg_hash, i, StringHash("FCU-Miss")))
        call SetUS2("CriP", bj_lastCreatedUnit, LoadReal(udg_hash, i, StringHash("FCU-CriP")))
        call SetUS2("CriX", bj_lastCreatedUnit, LoadReal(udg_hash, i, StringHash("FCU-CriX")))
        call SetUS2("Bash", bj_lastCreatedUnit, LoadReal(udg_hash, i, StringHash("FCU-Bash")))
        
        call SetUS2("MDF", bj_lastCreatedUnit, GetUnitLevel(bj_lastCreatedUnit)*.4+LoadReal(udg_hash, i, StringHash("FCU-MDF")))
	    call SetUS("Armor", bj_lastCreatedUnit, GetUnitLevel(bj_lastCreatedUnit)/2+LoadInteger(udg_hash, i, StringHash("FCU-AC")), true)
        call SetUS("MAC", bj_lastCreatedUnit, GetUnitLevel(bj_lastCreatedUnit)/2+LoadInteger(udg_hash, i, StringHash("FCU-MAC")), true)
        set r = GetRandomReal(0,0.3+LoadReal(udg_hash,i,StringHash("FCU-HP2")))+LoadReal(udg_hash,i,StringHash("FCU-HP"))
      endif
      
      
      set r = r * (1.+LoadReal(udg_hash, i, StringHash("FCU-HPx")))
      call SaveReal(udg_hash, GetHandleId(bj_lastCreatedUnit), StringHash("BonusHP"), r)
      if ( Mutation(bj_lastCreatedUnit, 1.+LoadReal(udg_hash, i, StringHash("FCU-Mu")), MUSIZE(GetUnitTypeId(bj_lastCreatedUnit))) ) then
        set r = LoadReal(udg_hash, GetHandleId(bj_lastCreatedUnit), StringHash("BonusHP")) * (1.+LoadReal(udg_hash,i,StringHash("FCU-HP3")))
      else
        set r = r * (1.+LoadReal(udg_hash,i,StringHash("FCU-HP3")))
      endif
      if ( udg_SysA_MapLevel == 3 ) then
        call SetUS("Hp", bj_lastCreatedUnit, R2I(GetWidgetLife(bj_lastCreatedUnit)*r*1.5), true)
        call SetUS("DMG", bj_lastCreatedUnit, R2I(GetUnitState(bj_lastCreatedUnit, ConvertUnitState(0x12))*.5), true)
      elseif ( udg_SysA_MapLevel == 4 ) then
        call SetUS("Hp", bj_lastCreatedUnit, R2I(GetWidgetLife(bj_lastCreatedUnit)*r*2.), true)
        call SetUS("DMG", bj_lastCreatedUnit, R2I(GetUnitState(bj_lastCreatedUnit, ConvertUnitState(0x12))*1.), true)
      else
        call SetUS("Hp", bj_lastCreatedUnit, R2I(GetWidgetLife(bj_lastCreatedUnit)*r), true)
      endif
      
	  if ( i != 1 ) then
        call DestroyEffect( AddSpecialEffect("Abilities\\Spells\\NightElf\\Taunt\\TauntCaster.mdl", GetWidgetX(udg_MS_item), GetWidgetY(udg_MS_item)) )
	  endif
      
      call IssuePointOrder(bj_lastCreatedUnit, "patrol", GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u))
	  call FCUBuff(bj_lastCreatedUnit, i)

    endif
    set c = c - 1.
  endloop
  if ( FirstOfGroup(g) != null ) then
  //Step 6 - Restart & Reset
//debug call BJDebugMsg("R1("+R2SW(LoadReal(udg_hash,i,StringHash("FCU-Time")),1,2)+") R2(0~"+R2SW(LoadReal(udg_hash,i,StringHash("FCU-Time2")),1,2)+") I3("+I2S(bj_groupRandomConsidered)+"="+R2S(Pow(BaseValue(5),I2R(bj_groupRandomConsidered-1)))+")" )
    if ( udg_SysA_MapLevel == 1 ) and ( GetUnitLevel(FirstOfGroup(g)) >= 71 ) then
      set r = (LoadReal(udg_hash,i,StringHash("FCU-Time"))+GetRandomReal(0.,LoadReal(udg_hash,i,StringHash("FCU-Time2")))) / (1.+(BaseValue(5)*(bj_groupRandomConsidered*2-1)))
    elseif ( udg_SysA_MapLevel == 2 ) and ( GetUnitLevel(FirstOfGroup(g)) >= 86 ) then
      set r = (LoadReal(udg_hash,i,StringHash("FCU-Time"))+GetRandomReal(0.,LoadReal(udg_hash,i,StringHash("FCU-Time2")))) / (1.+(BaseValue(5)*(bj_groupRandomConsidered*3-1)))
    else
      set r = (LoadReal(udg_hash,i,StringHash("FCU-Time"))+GetRandomReal(0.,LoadReal(udg_hash,i,StringHash("FCU-Time2")))) / (1.+(BaseValue(5)*(bj_groupRandomConsidered-1)))
    endif
    
    if ( FBUFF_BASE(i) == 14 ) and ( udg_Quest_ClearInt_14_2 > 0 ) then
    //죽마
      set r = r * Pow(.98,  udg_Quest_ClearInt_14_2)
    endif
    
    
    call TimerStart(t,r,false,function FCUTimer)
  else
    call SaveBoolean(udg_hash, i, StringHash("Working"), false)
    call PauseTimer(t)
    call FlushChildHashtable(udg_hash, GetHandleId(t))
    call DestroyTimer(t)
  endif
 call DestroyGroup(g)
 set t = null
 set g = null
endfunction
function SoundCheck takes player p, integer i returns nothing
 local string s = ""
  if ( i == -15 ) then
    set s = gg_snd_24
  elseif ( i == -13 ) then
    set s = gg_snd_40
  elseif ( i == -1 ) then
    set s = gg_snd_15
  elseif ( i == 16 ) then
    set s = gg_snd_45
  elseif ( i == 27 ) then
    set s = gg_snd_67
  elseif ( i == 61 ) and ( i == 64 ) then
    if ( GetRandomReal(0., 100.) <= 50. ) then
      set s = gg_snd_3
    else
      set s = gg_snd_4
    endif
  else
    set s = ""
  endif
  if ( s != "" ) then
    if ( GetLocalPlayer() == p ) then
      call StopMusic(false)
      call PlayMusic(s)
      call ResumeMusic()
    endif
  endif
  set s = null
endfunction
function FCU takes integer i returns nothing
  if ( not(LoadBoolean(udg_hash, i, StringHash("Working"))) and (LoadInteger(udg_hash, i, StringHash("FCU-Count")) > 0) ) then
    set bj_lastStartedTimer = LoadTimerHandle(udg_hash, StringHash("FCU"), i)
    if ( bj_lastStartedTimer == null ) then
      set bj_lastStartedTimer = CreateTimer()
      call SaveTimerHandle(udg_hash, StringHash("FCU"), i, bj_lastStartedTimer)
    endif
    call SaveBoolean(udg_hash, i, StringHash("Working"), true)
    call SaveInteger(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("FCU-N"), i)
    call TimerStart(bj_lastStartedTimer,5.,false,function FCUTimer)
  endif
endfunction

function Trig_Sys_Create_Monster_Conditions takes nothing returns boolean
  return GetTriggerUnit() == udg_Unit[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1]
endfunction
function Trig_Sys_Create_Monster_Actions takes nothing returns nothing
 local integer i = LoadInteger(udg_hash, GetHandleId(GetTriggeringRegion()), StringHash("Rect-i"))
  set udg_OnesPositionN[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1] = i
  if ( FBUFF_BASE(i) == 13 ) then
    call MSG(GetOwningPlayer(GetTriggerUnit()), 5, 7, Hunting_Data(50+udg_SYSTEM_MineFloor))
  else
    call MSG(GetOwningPlayer(GetTriggerUnit()), 5, 7, Hunting_Data(i))
  endif
  if ( i == 47 ) then
    call SetHoldCam(GetOwningPlayer(GetTriggerUnit()), Hunting_Rect(i))
  endif
  call FCU(i)
  call SoundCheck(GetOwningPlayer(GetTriggerUnit()), i)
//debug call BJDebugMsg("no." +I2S(i)+"에 들어왔습니다 :: - "+Hunting_Data(i))
endfunction

//===========================================================================
function InitTrig_Sys_Create_Monster takes nothing returns nothing
  set gg_trg_Sys_Create_Monster = CreateTrigger()
  call TriggerAddCondition(gg_trg_Sys_Create_Monster, Condition(function Trig_Sys_Create_Monster_Conditions))
  call TriggerAddAction(gg_trg_Sys_Create_Monster, function Trig_Sys_Create_Monster_Actions)
endfunction

//===========================================================================
// Trigger: JN Load Complete2
//===========================================================================
function Trig_JN_Load_Complete2_Actions takes nothing returns nothing
  if ( JN_LoaderNow != 0 ) then
    call MSG(GetServerPlayer, 2, 20, "로드 |cffff0000실패! |r - 현재 "+SysStr(2,JN_LoaderNow)+udg_SysB_Name[JN_LoaderNow]+"|r님이 로드하고 있습니다. 잠시 후 다시 시도하세요.")
  else
    set JN_LoaderNow = GetPlayerId(GetServerPlayer)+1
    if ( JN_LoaderSlot[JN_LoaderNow] == 0 ) and ( udg_Unit[JN_LoaderNow] == null ) then
      call FAL_SetMulti0(JN_LoaderNow, 0, 0, 0, IMaxBJ(1,S2I(JNStringSplit(GetServerCode,"|",0))))
      if ( S2I(JNStringSplit(GetServerCode,"|",1)) > 50000 ) then
        call FAL_SetMulti0(JN_LoaderNow, 0, 0, 1, 40000)
      else
        call FAL_SetMulti0(JN_LoaderNow, 0, 0, 1, S2I(JNStringSplit(GetServerCode,"|",1)))
      endif
      call FAL_SetMulti0(JN_LoaderNow, 0, 0, 2, S2I(JNStringSplit(GetServerCode,"|",2)))
      call FAL_SetMulti0(JN_LoaderNow, 0, 0, 3, S2I(JNStringSplit(GetServerCode,"|",3)))
      call FAL_SetMulti0(JN_LoaderNow, 0, 0, 4, S2I(JNStringSplit(GetServerCode,"|",4)))
      set JN_SlotName[JN_LoaderNow] = JNStringSplit(GetServerCode,"|",5)+"|"+JNStringSplit(GetServerCode,"|",6)+"|"+JNStringSplit(GetServerCode,"|",7)+"|"+JNStringSplit(GetServerCode,"|",8)+"|"+JNStringSplit(GetServerCode,"|",9)
      
      set udg_SysB_NameChange[JN_LoaderNow] = JNStringSplit(GetServerCode,"||",1)
      if ( udg_SysB_NameChange[JN_LoaderNow] != "" ) then
        call SetPlayerName(GetServerPlayer, udg_SysB_NameChange[JN_LoaderNow])
      endif
      
      set udg_SysB_Title[JN_LoaderNow] = JNStringSplit(GetServerCode,"||",2)
      if ( udg_SysB_Title[JN_LoaderNow] == "" ) then
        set udg_SysB_Title[JN_LoaderNow] = "000000000000000"
      endif
      
      set udg_SysB_Setting[JN_LoaderNow] = JNStringSplit(GetServerCode,"||",3)
      if ( udg_SysB_Setting[JN_LoaderNow] == "" ) then
        set udg_SysB_Setting[JN_LoaderNow] = "000"
      else
        set udg_SysB_Setting[JN_LoaderNow] = SubString(udg_SysB_Setting[JN_LoaderNow],0,3)
      endif
      
      set udg_SysB_SkinOX[JN_LoaderNow] = JNStringSplit(GetServerCode,"||",4)
      if ( JNStringSplit(udg_SysB_SkinOX[JN_LoaderNow],"|",2) == "" ) or ( StringLength(udg_SysB_SkinOX[JN_LoaderNow]) > 18 ) then
        set udg_SysB_SkinOX[JN_LoaderNow] = "0|1111111111000000"
      endif
      
    elseif ( JN_LoaderSlot[JN_LoaderNow] <= 5 ) and ( udg_Unit[JN_LoaderNow] == null ) then
      set udg_Save_Code[JN_LoaderNow] = JNStringSplit(GetServerCode,"|",1)
      set udg_Save_Code2[JN_LoaderNow] = JNStringSplit(GetServerCode,"|",2)
//debug call BJDebugMsg("##Code1/2: " + I2S(StringLength(udg_Save_Code[JN_LoaderNow]))+ "/"+I2S(StringLength(udg_Save_Code2[JN_LoaderNow])))
      if ( StringLength(udg_Save_Code[JN_LoaderNow]) == 76 ) then
        if ( Load(udg_Save_Code[JN_LoaderNow], JN_LoaderNow) ) then
	      set udg_Save_Count[JN_LoaderNow] = 3
  	      call MSG(Player(JN_LoaderNow-1), 2, 4, "로드 |cff00ff00성공! |r - |cffffdc3c메인 코드가 성공적으로 서버에서 로드되었습니다.")
	      if ( StringLength(udg_Save_Code2[JN_LoaderNow]) == 84 ) then
            if ( Load2(udg_Save_Code2[JN_LoaderNow], JN_LoaderNow) ) then
              set udg_Save_Count[JN_LoaderNow] = 2
	          call MSG(Player(JN_LoaderNow-1), 2, 4, "서브로드 |cff00ff00성공! |r - |cffffdc3c인벤토리가 성공적으로 서버에서 로드되었습니다.")
  	        endif
	      else
    	      call MSG(Player(JN_LoaderNow-1), 2, 20, "로드 |cffff0000실패! |r - "+BaseStr(11)+"서브 코드의 길이가 맞지 않아 로드에 실패 했습니다. (수동 로드 가능, " + I2S(StringLength(udg_Save_Code2[JN_LoaderNow])) +"글자)")
	      endif
        endif
      else
        call MSG(Player(JN_LoaderNow-1), 2, 20, "로드 |cffff0000실패! |r - "+BaseStr(11)+"메인 코드의 길이가 맞지 않아 로드에 실패 했습니다. - (" + I2S(StringLength(udg_Save_Code[JN_LoaderNow])) +"글자)")
      endif
    endif
    set JN_LoaderNow = 0
  endif
endfunction

//===========================================================================
function InitTrig_JN_Load_Complete2 takes nothing returns nothing
    set gg_trg_JN_Load_Complete2 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_JN_Load_Complete2, function Trig_JN_Load_Complete2_Actions )
endfunction

//===========================================================================
// Trigger: Intr Stats
//===========================================================================
constant function STATS2I takes string s returns integer
  if ( s == "-GLA " ) then
    return 1
  elseif ( s == "-힘 " ) then
    return 1
  elseif ( s == "-STR " ) then
    return 1
  elseif ( s == "-EPR " ) then
    return 2
  elseif ( s == "-덱 " ) then
    return 2
  elseif ( s == "-ALS " ) then
    return 2
  elseif ( s == "-민 " ) then
    return 2
  elseif ( s == "-DEX " ) then
    return 2
  elseif ( s == "-INT " ) then
    return 3
  elseif ( s == "-인 " ) then
    return 3
  elseif ( s == "-DLS " ) then
    return 3
  elseif ( s == "-DNL " ) then
    return 4
  elseif ( s == "-위 " ) then
    return 4
  elseif ( s == "-WIS " ) then
    return 4
  elseif ( s == "-CON " ) then
    return 5
  elseif ( s == "-콘 " ) then
    return 5
  elseif ( s == "-ZHS " ) then
    return 5
  else
    return 0
  endif
endfunction
function StatePlus takes integer P, integer loopA, integer add returns nothing
    if ( add > 0 ) and ( add <= 99 ) then
      if ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) < add ) then
        call MSG(Player(P-1), 1, 5, "스텟 포인트가 부족합니다. |c00d962b5" + I2S(add) + "|cffffdc3c이상 필요합니다.")
        return
      elseif ( IsUnitType(udg_Unit[P], UNIT_TYPE_DEAD) ) then
        call MSG(Player(P-1), 1, 5, "현재 영웅이 사망하여 있습니다. 잠시 후 다시 찍어주세요.")
        return
      elseif ( udg_SysE_STR1[P] + udg_SysE_DEX1[P] + udg_SysE_INT1[P] + udg_SysE_WIS1[P] + udg_SysE_CON1[P] + add >= 212 ) then
        call MSG(Player(P-1), 4, 5, "이미 스텟을 모두 찍으셨습니다.")
        return
      elseif ( loopA == 0 ) then
        call MSG(Player(P-1), 4, 5, "목록에 없는 스텟입니다. / " + I2S(loopA) + " = " + I2S(loopA))
        return
      endif
      
      if ( loopA == 1 ) then
        if ( udg_SysE_STR1[P] <= ( SysInt(0,8) - add ) ) then
          call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)-add)
          call AddState(P, "STR", add, true)
          call MSG(Player(P-1), 2, 5, "|c00f2f200Strength|cffffdc3c 스텟이 |c00d962b5" + I2S(add) + " |cffffdc3c상승하였습니다.|r")
          if ( udg_SysE_STR1[P] <= 10 ) or ( GetRandomReal(0,100) < 10 ) then
            call MSG(Player(P-1), 1, 8, "＊참고.\n|c00d1d1d1 힘이 오르면 공격력이 0~30 오릅니다.\n|c00d1d1d1　( 보이지 않습니다. ) 멀티보드에 or 무기를 먹었을때에 표시됩니다.")
          endif
        else
          call MSG(Player(P-1), 2, 5, "|c00ffdc3c이 능력치의 최대값은 "+I2S(SysInt(0,8))+" 입니다. 다른 능력치를 선택해 주세요.|r")
        endif
      elseif ( loopA == 2 ) then
        if ( udg_SysE_DEX1[P] <= ( SysInt(0,8) - add ) ) then
          call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)-add)
          call AddState(P, "DEX", add, true)
          call MSG(Player(P-1), 2, 5, "|c00f2f200Dexterity|cffffdc3c 스텟이 |c00d962b5" + I2S(add) + " |cffffdc3c상승하였습니다.|r")
          if ( udg_SysE_DEX1[P] <= 10 ) or ( GetRandomReal(0,100) < 10 ) then
            call MSG(Player(P-1), 1, 8, "※참고.\n|c00d1d1d1 덱스가 오르면 공격력 15, 명중률이 1% 오릅니다. ( 자신의 명중률에 비례 ) |r\n|c00d1d1d1　( 기본명중률은 70%입니다. 민첩이 오르면 몇몇 스킬의 데미지도 올라갑니다)")
          endif
        else
          call MSG(Player(P-1), 2, 5, "|c00ffdc3c이 능력치의 최대값은 "+I2S(SysInt(0,8))+" 입니다. 다른 능력치를 선택해 주세요.|r")
        endif
      elseif ( loopA == 3 ) then
        if ( udg_SysE_INT1[P] <= ( SysInt(0,8) - add ) ) then
          call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)-add)
          call AddState(P, "INT", add, true)
          call MSG(Player(P-1), 2, 5, "|c00f2f200Intelligence|cffffdc3c 스텟이 |c00d962b5" + I2S(add) + " |cffffdc3c상승하였습니다.|r")
          if ( udg_SysE_INT1[P] <= 10 ) or ( GetRandomReal(0,100) < 10 ) then
            call MSG(Player(P-1), 1, 8, "＊참고.\n|c00d1d1d1 인트가 오르면 마법 방어력과, 마법데미지가 오릅니다. \n|c00d1d1d1　( 인트가 높으면 마법사의 마법이 강하며, 다른직업의 특정 스킬도 강해집니다. )")
          endif
        else
          call MSG(Player(P-1), 2, 5, "|c00ffdc3c이 능력치의 최대값은 "+I2S(SysInt(0,8))+" 입니다. 다른 능력치를 선택해 주세요.|r")
        endif
      elseif ( loopA == 4 ) then
        if ( udg_SysE_WIS1[P] <= ( SysInt(0,8) - add ) ) then
          //선스텟 효과 볼 때
          if ( R2I((udg_SysE_WIS1[P]+add)*BaseValue(20)) > R2I(udg_SysE_WIS1[P]*BaseValue(20)) ) then
            set udg_temp_i = (GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)-2)/2
            set udg_temp_i2 = 2
            if ( udg_temp_i > 0 ) and ( not udg_SysI_Exct[P] ) then
              set loopA = 0
              loop
                set loopA = loopA + (R2I((udg_SysE_WIS1[P]+IMinBJ(add,udg_temp_i2))*BaseValue(20)) - R2I(udg_SysE_WIS1[P]*BaseValue(20)))
                exitwhen udg_temp_i <= 1
                set udg_temp_i2 = udg_temp_i2 + 2
                set udg_temp_i = udg_temp_i - 1
              endloop
            endif
          endif
          call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)-add)
          call AddState(P, "WIS", add, true)
          call MSG(Player(P-1), 2, 5, "|c00f2f200Wisdom|cffffdc3c 스텟이 |c00d962b5" + I2S(add) + " |cffffdc3c상승하였습니다.|r")
          if ( udg_SysE_WIS1[P] <= 10 ) or ( GetRandomReal(0,100) < 10 ) then
            call MSG(Player(P-1), 1, 8, "＊참고.\n|c00d1d1d1 위즈가 오르면 마나 최대치와 마나 회복량이 늘어납니다. \n|c00d1d1d1　( 회복속도는 빨라지지 않습니다. )")
          endif
          if ( loopA > 0 ) then
            call TriggerSleepAction(3.)
            call SetUS("Mp", udg_Unit[P], loopA, true)
            set udg_Save_MP[P] = udg_Save_MP[P]+loopA
            call MSG(Player(P-1), 1, 8, "놓친 선스텟 효과로, |cff0078ffMP|cffffdc3c가 추가로 |cff0078ff"+I2S(loopA)+"|cffffdc3c 상승하였습니다.")
          endif
        else
          call MSG(Player(P-1), 2, 5, "|c00ffdc3c이 능력치의 최대값은 "+I2S(SysInt(0,8))+" 입니다. 다른 능력치를 선택해 주세요.|r")
        endif
      elseif ( loopA == 5 ) then
        if ( udg_SysE_CON1[P] <= ( SysInt(0,8) - add ) ) then
          //선스텟 효과 볼 때
          if ( R2I((udg_SysE_CON1[P]+add)*BaseValue(19)) > R2I(udg_SysE_CON1[P]*BaseValue(19)) ) then
            set udg_temp_i = (GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)-2)/2
            set udg_temp_i2 = 2
            if ( udg_temp_i > 0 ) and ( not udg_SysI_Exct[P] ) then
              set loopA = 0
              loop
                set loopA = loopA + (R2I((udg_SysE_CON1[P]+IMinBJ(add,udg_temp_i2))*BaseValue(19)) - R2I(udg_SysE_CON1[P]*BaseValue(19)))
                exitwhen udg_temp_i <= 1
                set udg_temp_i2 = udg_temp_i2 + 2
                set udg_temp_i = udg_temp_i - 1
              endloop
            endif
          endif
          call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)-add)
          call AddState(P, "CON", add, true)
          call MSG(Player(P-1), 2, 5, "|c00f2f200Constitution|cffffdc3c 스텟이 |c00d962b5" + I2S(add) + " |cffffdc3c상승하였습니다.|r")
          if ( udg_SysE_CON1[P] <= 10 ) or ( GetRandomReal(0,100) < 10 ) then
            call MSG(Player(P-1), 1, 8, "＊참고\n|c00d1d1d1 콘이 오르면 공격력이 5~15, 레벨업시 체력이 많이 오르며, 체력 회복량이 늘어납니다. \n|c00d1d1d1　특정 스킬의 데미지도 향상합니다. (166이상부터 회복속도도 빨라집니다 ) " )
          endif
          if ( loopA > 0 ) then
            call TriggerSleepAction(3.)
            call SetUS("Hp", udg_Unit[P], loopA, true)
            set udg_Save_HP[P] = udg_Save_HP[P]+loopA
            call MSG(Player(P-1), 1, 8, "놓친 선스텟 효과로, |cffff3315HP|cffffdc3c가 추가로 |cff0078ff"+I2S(loopA)+"|cffffdc3c 상승하였습니다.")
          endif
        else
          call MSG(Player(P-1), 2, 5, "|c00ffdc3c이 능력치의 최대값은 "+I2S(SysInt(0,8))+" 입니다. 다른 능력치를 선택해 주세요.|r")
        endif
      endif
      if ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) >= 1 ) then
        call MSG(Player(P-1), 1, 5, "아직 스텟이 |c00d962b5" + I2S(GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)) + "|cffffdc3c 더 남았습니다. 한번에 |c00ffff8099|cffffdc3c개까지 찍을 수 있습니다.")
      endif
    else
      call MSG(Player(P-1), 1, 5, "한 번에 1~99개까지 찍을 수 있습니다.")
    endif
endfunction
function Trig_Stats_3_Up2_Actions takes nothing returns nothing
  call StatePlus(GetPlayerId(GetTriggerPlayer())+1, STATS2I(SubString(StringCase(GetEventPlayerChatString(), true), 0, 5)), S2I(SubString(GetEventPlayerChatString(), 5, 7)))
endfunction

//===========================================================================
function InitTrig_Intr_Stats takes nothing returns nothing
  set gg_trg_Intr_Stats = CreateTrigger(  )
  call TriggerAddAction( gg_trg_Intr_Stats, function Trig_Stats_3_Up2_Actions )
endfunction

//===========================================================================
// Trigger: Import
//
// 악세사리
// 장신구
// 갑옷
// |cff40ffff만능|r
//===========================================================================
/*native JNWriteLog takes string str returns nothing

// import
//! import "JNMemory.j"
//! import "JNString.j"
//! import "DzAPISync.j"
//! import "DzAPIHardware.j"
//! import "DzAPIFrameHandle.j"
// TimeUtility
//! import "JNStopwatch.j"
*/

// 텍스트 매크로
//! textmacro Sync takes Initial
    set trg = CreateTrigger()
    call DzTriggerRegisterSyncData(trg, "$Initial$", false)
    call TriggerAddAction(trg, function Sync$Initial$)
//! endtextmacro

// 전역변수
globals
    string array ClassName /* 부위명 */
    
    // 플레이어마다 다른 값을 가지는 변수
    boolean RightClickEnable = true /* 우클릭 기능 동기화 끝난 뒤 활성화하기 위한 변수 */
endglobals

// 초기지정
scope Init initializer OnInit
private function GameEnd takes nothing returns nothing
    call DzFrameSetUpdateCallback("")
endfunction
private function OnInit takes nothing returns nothing
  set udg_hash = InitHashtable()
    // toc 파일 불러오기
    call DzLoadToc("FDE Import.toc")
    // 부위명 초기 지정
    set ClassName[FMI_MAXMAX_INVENTORY+1] = "|cffff40ff모자"
    set ClassName[FMI_MAXMAX_INVENTORY+2] = "|cffff40ff휘장"
    set ClassName[FMI_MAXMAX_INVENTORY+3] = "|cff40ff40목걸이"
    set ClassName[FMI_MAXMAX_INVENTORY+4] = "|cff40ff40귀걸이"
    set ClassName[FMI_MAXMAX_INVENTORY+5] = "|cff4040ff갑옷"
    set ClassName[FMI_MAXMAX_INVENTORY+6] = "|cffffff40방패"
    set ClassName[FMI_MAXMAX_INVENTORY+7] = "|cffff4040무기"
    set ClassName[FMI_MAXMAX_INVENTORY+8] = "|cffffff40장갑(팔찌)"
    set ClassName[FMI_MAXMAX_INVENTORY+9] = "|cffffff40벨트"
    set ClassName[FMI_MAXMAX_INVENTORY+10] = "|cffffff40각반"
    set ClassName[FMI_MAXMAX_INVENTORY+11] = "|cff40ff40신발"
    set ClassName[FMI_MAXMAX_INVENTORY+12] = "|cff40ff40반지"
    call SetGameEndCallbackByCode(function GameEnd)
endfunction
endscope//===========================================================================
// Trigger: EndGameHook
//===========================================================================
/*
 * EndGameHook (v0.0)
 *
 * 함수:
 *   function SetGameEndCallback takes string func returns nothing
 *     게임이 종료될 때 호출되는 함수를 이름으로 지정합니다.
 *     func: 콜백 함수 이름
 *
 *   function SetGameEndCallbackByCode takes code funcHandle returns nothing
 *     게임이 종료될 때 호출되는 함수를 code 타입으로 지정합니다.
 *     funcHandle: 콜백 함수
 */
library EndGameHook initializer Init requires MemoryLib, Typecast

    globals
        private integer pGameWar3
        private integer pSub_35FDF0
        private integer pTrampoline
        private integer pCallback
        private integer pCallbackCodeIndex
        private integer MemoryBlockOldProtect
        private integer pDummy1
        private integer pDummy2
        private integer array originalSub_35FDF0

        private string userCallbackName = null
        private code userCallbackCode = null
    endglobals


    function SetGameEndCallback takes string func returns nothing
        set userCallbackName = func
        set userCallbackCode = null
    endfunction

    function SetGameEndCallbackByCode takes code funcHandle returns nothing
        set userCallbackName = null
        set userCallbackCode = funcHandle
    endfunction


    //! runtextmacro MemoryLib_DefineMemoryBlock("private", "MemoryBlock", "GameExitHook__MemoryBlock", "400")

    private function GetGameWar3 takes nothing returns Ptr
        return PtrPtr[pGameDll + 0xD305E0]
    endfunction

    private function VirtualProtect takes Ptr lpAddress, integer dwSize, integer flNewProtect, Ptr pflOldProtect returns integer
        local Ptr pFunc = IntPtr[pGameDll + 0xA6B384]
        call SaveStr(JNProc_ht, JNProc_key, 0, "(IIII)I")
        call SaveInteger(JNProc_ht, JNProc_key, 1, lpAddress)
        call SaveInteger(JNProc_ht, JNProc_key, 2, dwSize)
        call SaveInteger(JNProc_ht, JNProc_key, 3, flNewProtect)
        call SaveInteger(JNProc_ht, JNProc_key, 4, pflOldProtect)
        if (JNProcCall(JNProc__stdcall, pFunc, JNProc_ht)) then
            return LoadInteger(JNProc_ht, JNProc_key, 0)
        endif
        return 0
    endfunction

    private function sub_8BED60 takes Ptr this returns Ptr
        local Ptr pFunc = pGameDll + 0x8BED60
        call SaveStr(JNProc_ht, JNProc_key, 0, "(I)I")
        call SaveInteger(JNProc_ht, JNProc_key, 1, this)
        if (JNProcCall(JNProc__thiscall, pFunc, JNProc_ht)) then
            return LoadInteger(JNProc_ht, JNProc_key, 0)
        endif
        return 0
    endfunction

    private function sub_8CB7D0 takes Ptr this, Ptr a2 returns integer
        local Ptr pFunc = pGameDll + 0x8CB7D0
        call SaveStr(JNProc_ht, JNProc_key, 0, "(II)I")
        call SaveInteger(JNProc_ht, JNProc_key, 1, this)
        call SaveInteger(JNProc_ht, JNProc_key, 2, a2)
        if (JNProcCall(JNProc__thiscall, pFunc, JNProc_ht)) then
            return LoadInteger(JNProc_ht, JNProc_key, 0)
        endif
        return 0
    endfunction

    private function GetCodeIndex takes code c returns integer
        local integer pCode = C2I(c)
        local integer v1 = IntPtr[pGameWar3 + 8]
        local integer v2 = sub_8BED60(v1)
        local integer index = sub_8CB7D0(v2, pCode)
        return index
    endfunction

    private function MakeMemoryBlockExecutable takes nothing returns nothing
        call VirtualProtect(MemoryBlock.pHead, MemoryBlock.size, 0x40, MemoryBlock.pHead)
        set MemoryBlockOldProtect = IntPtr[MemoryBlock.pHead]
    endfunction

    private struct AssemblyWriter
        public Ptr pCursor

        public static method create takes Ptr pHead returns thistype
            local thistype this = thistype.allocate()
            set this.pCursor = pHead
            return this
        endmethod

        public method malloc takes integer size returns Ptr
            local Ptr pBlock = this.pCursor
            set this.pCursor = this.pCursor + size
            return pBlock
        endmethod

        public method writePadding takes integer size returns nothing
            local integer i = 0
            loop
                exitwhen i >= size
                set BytePtr[this.pCursor] = 0xCC
                set this.pCursor = this.pCursor + 1
                set i = i + 1
            endloop
        endmethod

        public method writeByte takes integer byteValue returns nothing
            set BytePtr[this.pCursor] = byteValue
            set this.pCursor = this.pCursor + 1
        endmethod

        public method writeInt takes integer intValue returns nothing
            set IntPtr[this.pCursor] = intValue
            set this.pCursor = this.pCursor + 4
        endmethod

        public method writeOffset takes integer address returns nothing
            set IntPtr[this.pCursor] = address - (this.pCursor + 4)
            set this.pCursor = this.pCursor + 4
        endmethod
    endstruct

    private function InitMemoryBlock takes nothing returns nothing
        local AssemblyWriter asm
        local integer headerSize

        call MakeMemoryBlockExecutable()

        set asm = AssemblyWriter.create(MemoryBlock.pHead)

        set pDummy1 = asm.malloc(4)
        set pDummy2 = asm.malloc(4)

        call asm.writePadding(8)

        // [callback function]
        //  void callback() {
        //      int eax;
        //      int ebx;
        //      ebx = 0x00;  // callback code
        //      if (ebx != 0) {
        //          eax = sub_2135F0(pGameWar3)  // Get GameState
        //          eax = sub_2B97A0(eax, ebx)   // Get JassFunc
        //          sub_22ABF0(eax, pDummy1, pDummy2, 1, 0, 0)  // Execute Func
        //          if (*pDummy2) {
        //              sub_8C2260(*pDummy2)
        //          }
        //      }
        //  }
        set pCallback = asm.pCursor
        // Function header
        call asm.writeByte(0x55)        // push ebp
        call asm.writeByte(0x8B)        // mov ebp, esp
        call asm.writeByte(0xEC)        // -
        call asm.writeByte(0x53)        // push ebx
        call asm.writeByte(0x51)        // push ecx
        call asm.writeByte(0x52)        // push edx

        // Check callback is not 0
        set pCallbackCodeIndex = asm.pCursor + 1
        call asm.writeByte(0xBB)        // mov ebx, 0x00000000
        call asm.writeInt(0x00000000)   // -
        call asm.writeByte(0x85)        // test ebx, ebx
        call asm.writeByte(0xDB)        // -
        call asm.writeByte(0x74)        // je +60
        call asm.writeByte(60)          // -

        // Get GameState
        call asm.writeByte(0xB9)        // mov ecx, pGameWar3
        call asm.writeInt(pGameWar3)    // -
        call asm.writeByte(0xE8)        // call sub_2135F0
        call asm.writeOffset(pGameDll + 0x2135F0)   // -

        // Get JassFunc
        call asm.writeByte(0x53)        // push ebx
        call asm.writeByte(0x8B)        // mov ecx, eax
        call asm.writeByte(0xC8)        // -
        call asm.writeByte(0xE8)        // call sub_2B97A0
        call asm.writeOffset(pGameDll + 0x2B97A0)   // -

        // Execute JassFunc
        call asm.writeByte(0x8B)        // mov ecx, eax
        call asm.writeByte(0xC8)        // -
        call asm.writeByte(0x6A)        // push 0
        call asm.writeByte(0x00)        // -
        call asm.writeByte(0x6A)        // push 0
        call asm.writeByte(0x00)        // -
        call asm.writeByte(0x6A)        // push 1
        call asm.writeByte(0x01)        // -
        call asm.writeByte(0x68)        // push pDummy2
        call asm.writeInt(pDummy2)      // -
        call asm.writeByte(0x68)        // push pDummy1
        call asm.writeInt(pDummy1)      // -
        call asm.writeByte(0xE8)        // call sub_22ABF0
        call asm.writeOffset(pGameDll + 0x22ABF0)   // -

        // Check dummy2 is not 0
        call asm.writeByte(0xA1)        // mov eax, [pDummy2]
        call asm.writeInt(pDummy2)      // -
        call asm.writeByte(0x85)        // test eax, eax
        call asm.writeByte(0xC0)        // -
        call asm.writeByte(0x74)        // je +10
        call asm.writeByte(10)          // -

        // Call sub_8C2260(dummy2)
        call asm.writeByte(0xB9)        // mov ecx, [pDummy2]
        call asm.writeInt(pDummy2)      // -
        call asm.writeByte(0xE8)        // call sub_8C2260
        call asm.writeOffset(pGameDll + 0x8C2260)   // -

        // Function footer
        call asm.writeByte(0x5A)        // pop edx
        call asm.writeByte(0x59)        // pop ecx
        call asm.writeByte(0x5B)        // pop ebx

        call asm.writeByte(0x8B)        // mov esp, ebp
        call asm.writeByte(0xE5)        // -
        call asm.writeByte(0x5D)        // pop ebp
        call asm.writeByte(0xC3)        // ret

        call asm.writePadding(8)

        // [trampoline block]
        set pTrampoline = asm.pCursor
        // Function header
        call asm.writeByte(0x55)        // push ebp
        call asm.writeByte(0x8B)        // mov ebp, esp
        call asm.writeByte(0xEC)        // -
        call asm.writeByte(0x83)        // sub esp, 08
        call asm.writeByte(0xEC)        // -
        call asm.writeByte(0x08)        // -

        set headerSize = asm.pCursor - pTrampoline

        call asm.writeByte(0xE8)        // call pCallback
        call asm.writeOffset(pCallback)   // -

        call asm.writeByte(0xE9)        // jmp pReturn
        call asm.writeOffset(pSub_35FDF0 + headerSize)   // -

        call asm.writePadding(8)

        // Initialize globals
        set IntPtr[pDummy1] = 0
        set IntPtr[pDummy2] = 0

        call asm.destroy()
    endfunction

    private function IsHookedAlready takes nothing returns boolean
        return IntPtr[pSub_35FDF0] != 0x83EC8B55
    endfunction

    private function HookEndGame takes nothing returns nothing
        local AssemblyWriter asm

        // Backup sub_35FDF0
        set originalSub_35FDF0[0] = IntPtr(pSub_35FDF0)[0]
        set originalSub_35FDF0[1] = IntPtr(pSub_35FDF0)[1]

        // Inject trampoline into sub_35FDF0
        set asm = AssemblyWriter.create(pSub_35FDF0)
        call asm.writeByte(0xE9)        // jmp pTrampoline
        call asm.writeOffset(pTrampoline)   // -
        call asm.writeByte(0x90)        // nop
        call asm.destroy()
    endfunction

    private function UnhookEndGame takes nothing returns nothing
        // Restore sub_35FDF0
        set IntPtr(pSub_35FDF0)[0] = originalSub_35FDF0[0]
        set IntPtr(pSub_35FDF0)[1] = originalSub_35FDF0[1]
    endfunction

    private function SetEndGameHookCallback takes code func returns nothing
        set IntPtr[pCallbackCodeIndex] = GetCodeIndex(func)
    endfunction

    private function Callback takes nothing returns nothing
        call UnhookEndGame()

        if (userCallbackName != null) then
            call ExecuteFunc(userCallbackName)
        elseif (userCallbackCode != null) then
            call ForForce(GetForceOfPlayer(Player(0)), userCallbackCode)
        endif
    endfunction

    private function InitHook takes nothing returns nothing
        if IsHookedAlready() then
            debug call JNWriteLog("[EndGameHook] The function is hooked already.")
            return
        endif

        call InitMemoryBlock()
        call HookEndGame()
    endfunction

    private function Init takes nothing returns nothing
        set pGameWar3 = GetGameWar3()
        set pSub_35FDF0 = pGameDll + 0x35FDF0
        call InitHook()
        call SetEndGameHookCallback(function Callback)
    endfunction

endlibrary
//===========================================================================
// Trigger: MemoryLib
//===========================================================================
globals
  constant hashtable JNProc_ht = InitHashtable()
  constant integer JNProc_key = StringHash("jass")
  constant integer JNProc__thiscall = 4
  constant integer JNProc__stdcall = 2
endglobals

native JNMemoryGetByte takes integer offset returns integer
native JNMemorySetByte takes integer offset, integer value returns nothing
native JNMemoryGetInteger takes integer offset returns integer
native JNMemoryGetReal takes integer offset returns real
native JNMemorySetReal takes integer offset, real value returns nothing
native JNMemoryGetString takes integer offset, integer length returns string
native JNProcCall takes integer callConv, integer address, hashtable params returns boolean

native DzFrameGetCommandBarButton takes integer row, integer column returns integer

/*
 * MemoryLib (v0.1-alpha)
 * commit: 71944c8 (22)
 */

// source: src/MemoryLib.j

library MemoryLib requires/*
    */ MemoryLibBase, /*
    */ optional MemoryLibCommandButton, /*
    */ optional MemoryLibCommandButtonData, /*
    */ optional MemoryLibGameUI, /*
    */ optional MemoryLibMemoryBlock, /*
    */ optional MemoryLibPrimitiveType, /*
    */ MemoryLibEnd
endlibrary

library MemoryLibBase initializer Init
    globals
        integer pGameDll
    endglobals

    interface Ptr
    endinterface

    private function Init takes nothing returns nothing
        set pGameDll = JNGetModuleHandle("Game.dll")
    endfunction
endlibrary

library MemoryLibEnd
endlibrary
// source: src/MemoryLibCommandButton.j

library MemoryLibCommandButton requires MemoryLibBase, MemoryLibPrimitiveType, MemoryLibCommandButtonData

    struct CommandButton extends Ptr
        public static method getCommandBarButton takes integer x, integer y returns thistype
            return DzFrameGetCommandBarButton(x, y)
        endmethod

        public method operator data takes nothing returns CommandButtonData
            return PtrPtr[this + 0x190]
        endmethod
    endstruct

endlibrary

// source: src/MemoryLibCommandButtonData.j
library MemoryLibCommandButtonData requires MemoryLibBase, MemoryLibPrimitiveType

    struct CommandButtonData extends Ptr
        public method operator abilityId takes nothing returns integer
            return IntPtr[this + 0x4]
        endmethod
        public method operator orderId takes nothing returns integer
            return IntPtr[this + 0x8]
        endmethod
        public method operator targets takes nothing returns integer
            return IntPtr[this + 0x10]
        endmethod
        public method operator tip takes nothing returns string
            return JNMemoryGetString(this + 0x2C, 348)  // 348 is not sure
        endmethod
        public method operator ubertip takes nothing returns string
            return JNMemoryGetString(this + 0x18C, 1024)  // 1024 is not sure
        endmethod
        public method operator cost takes nothing returns integer
            return IntPtr[this + 0x594]
        endmethod
        public method operator buttonPosX takes nothing returns integer
            return IntPtr[this + 0x59C]
        endmethod
        public method operator buttonPosY takes nothing returns integer
            return IntPtr[this + 0x5A0]
        endmethod
        public method operator hotkey takes nothing returns integer
            return IntPtr[this + 0x5AC]
        endmethod
        public method operator art takes nothing returns string
            return JNMemoryGetString(this + 0x5C8, 200)  // 200 is not sure
        endmethod
        public method operator state takes nothing returns integer
            return IntPtr[this + 0x6D0]
        endmethod
    endstruct

endlibrary

// source: src/MemoryLibGameUI.j
library MemoryLibGameUI requires MemoryLibBase, MemoryLibPrimitiveType

    struct GameUI extends Ptr
        public static method getInstance takes nothing returns thistype
            return PtrPtr[pGameDll + 0xD0F600]
        endmethod

        public method operator cursorFrame takes nothing returns Ptr
            return PtrPtr[this + 0x16C]
        endmethod

        public method operator worldFrame takes nothing returns Ptr
            return PtrPtr[this + 0x3BC]
        endmethod

        public method operator currentMode takes nothing returns Ptr
            return PtrPtr[this + 0x1B4]
        endmethod
        public method operator targetMode takes nothing returns Ptr
            return PtrPtr[this + 0x210]
        endmethod
        public method operator selectMode takes nothing returns Ptr
            return PtrPtr[this + 0x214]
        endmethod
        public method operator dragSelectMode takes nothing returns Ptr
            return PtrPtr[this + 0x218]
        endmethod
        public method operator dragScrollMode takes nothing returns Ptr
            return PtrPtr[this + 0x21C]
        endmethod
        public method operator buildMode takes nothing returns Ptr
            return PtrPtr[this + 0x220]
        endmethod
        public method operator signalMode takes nothing returns Ptr
            return PtrPtr[this + 0x224]
        endmethod
        public method operator escMenu takes nothing returns Ptr
            return PtrPtr[this + 0x228]
        endmethod

        public method handleEvent takes Ptr pEvent returns integer
            local Ptr pFunc = pGameDll + 0x3A3190
            call SaveStr(JNProc_ht, JNProc_key, 0, "(II)I")
            call SaveInteger(JNProc_ht, JNProc_key, 1, this)
            call SaveInteger(JNProc_ht, JNProc_key, 2, pEvent)
            if (JNProcCall(JNProc__thiscall, pFunc, JNProc_ht)) then
                return LoadInteger(JNProc_ht, JNProc_key, 0)
            endif
            return 0
        endmethod
    endstruct

endlibrary

// source: src/MemoryLibMemoryBlock.j
/*
 * MemoryLibMemoryBlock
 * 빈 메모리 공간을 할당합니다.
 */
library MemoryLibMemoryBlock requires MemoryLibBase, MemoryLibPrimitiveType

    globals
        /* 최대 할당 크기 */
        constant integer MemoryLib_MAX_MEMORY_BLOCK_SIZE = JASS_MAX_ARRAY_SIZE * 4
    endglobals

    /*
     * //! runtextmacro MemoryLib_DefineGlobalMemoryBlock("accessor", "name", "id", "size")
     * `size`바이트 크기의 전역 메모리 블록을 `name`이라는 이름으로 생성합니다.
     * `accessor`는 접근자이며, {"", "public", "private"} 중 하나만 사용 가능합니다.
     * `id` 값은 유일해야하며, 다른 블록과 겹치면 안됩니다.
     *
     * 메모리 블록은 전역으로 생성되며, 다음과 같은 형태로 참조할 수 있습니다:
     * $name.pHead: 메모리 블록 포인터
     * $name.size : 메모리 블록 크기 (바이트)
     */
    //! textmacro MemoryLib_DefineMemoryBlock takes ACCESSOR, NAME, ID, SIZE

    globals
        integer $ID$_block
        integer array l__$ID$_block
    endglobals

    $ACCESSOR$ struct $NAME$ extends array
        readonly static Ptr pHead
        readonly static integer size

        private static method initSize takes nothing returns nothing
            local integer lastIndex = ($SIZE$ - 1) / 4
            set l__$ID$_block[lastIndex] = 0
        endmethod

        private static method typecast takes nothing returns nothing
            local integer $ID$_block
        endmethod

        //# +nosemanticerror
        private static method onInit takes nothing returns nothing
            call thistype.initSize()
            set thistype.pHead = PtrPtr(l__$ID$_block)[3]
            set thistype.size = $SIZE$
        endmethod
    endstruct
    //! endtextmacro

endlibrary

// source: src/MemoryLibPrimitiveType.j
library MemoryLibPrimitiveType requires MemoryLibBase

    struct BytePtr extends Ptr
        public static method operator [] takes integer address returns integer
            return JNMemoryGetByte(address)
        endmethod

        public static method operator []= takes integer address, integer value returns nothing
            call JNMemorySetByte(address, value)
        endmethod

        public method operator value takes nothing returns integer
            return JNMemoryGetByte(this)
        endmethod

        public method operator value= takes integer value returns nothing
            call JNMemorySetByte(this, value)
        endmethod

        public method operator [] takes integer offset returns integer
            return JNMemoryGetInteger(this + offset)
        endmethod

        public method operator []= takes integer offset, integer value returns nothing
            call JNMemorySetByte(this + offset, value)
        endmethod
    endstruct

    struct IntPtr extends Ptr
        public static method operator [] takes integer address returns integer
            return JNMemoryGetInteger(address)
        endmethod

        public static method operator []= takes integer address, integer value returns nothing
            call JNMemorySetInteger(address, value)
        endmethod

        public method operator value takes nothing returns integer
            return JNMemoryGetInteger(this)
        endmethod

        public method operator value= takes integer value returns nothing
            call JNMemorySetInteger(this, value)
        endmethod

        public method operator [] takes integer offset returns integer
            return JNMemoryGetInteger(this + (offset * 4))
        endmethod

        public method operator []= takes integer offset, integer value returns nothing
            call JNMemorySetInteger(this + (offset * 4), value)
        endmethod
    endstruct

    struct RealPtr extends Ptr
        public static method operator [] takes integer address returns real
            return JNMemoryGetReal(address)
        endmethod

        public static method operator []= takes integer address, real value returns nothing
            call JNMemorySetReal(address, value)
        endmethod

        public method operator value takes nothing returns real
            return JNMemoryGetReal(this)
        endmethod

        public method operator value= takes real value returns nothing
            call JNMemorySetReal(this, value)
        endmethod

        public method operator [] takes integer offset returns real
            return JNMemoryGetReal(this + (offset * 4))
        endmethod

        public method operator []= takes integer offset, real value returns nothing
            call JNMemorySetReal(this + (offset * 4), value)
        endmethod
    endstruct

    struct PtrPtr extends Ptr
        public static method operator [] takes integer address returns Ptr
            return JNMemoryGetInteger(address)
        endmethod

        public static method operator []= takes integer address, integer value returns nothing
            call JNMemorySetInteger(address, value)
        endmethod

        public method operator value takes nothing returns Ptr
            return JNMemoryGetInteger(this)
        endmethod

        public method operator value= takes Ptr value returns nothing
            call JNMemorySetInteger(this, value)
        endmethod

        public method operator [] takes integer offset returns Ptr
            return JNMemoryGetInteger(this + (offset * 4))
        endmethod

        public method operator []= takes integer offset, Ptr value returns nothing
            call JNMemorySetInteger(this + (offset * 4), value)
        endmethod
    endstruct

endlibrary
//===========================================================================
// Trigger: Typecast
//===========================================================================
library Typecast

globals
    //These are not used, they are here just to fool Jasshelper.
    code Code
    integer Int
    string Str
    boolean Bool
 
    //These are the actual ones used for typecasting.
    code l__Code
    integer l__Int
    string l__Str
    boolean l__Bool
endglobals

//The "return" line prevents Jasshelper from inlining these functions
function setCode takes code c returns nothing
    set l__Code = c
    return
endfunction

function setInt takes integer i returns nothing
    set l__Int = i
    return
endfunction

function setStr takes string s returns nothing
    set l__Str = s
    return
endfunction

function setBool takes boolean b returns nothing
    set l__Bool = b
    return
endfunction

//Jasshelper will append an "l__" prefix to all Typecast locals
private function Typecast1 takes nothing returns nothing
    local integer Str   //l__Str
    local string Int    //l__Int
endfunction

//# +nosemanticerror
function SH2I takes string s returns integer
    call setStr(s)
    return l__Str
endfunction

//# +nosemanticerror
function I2SH takes integer i returns string
    call setInt(i)
    return l__Int
endfunction

private function Typecast2 takes nothing returns nothing
    local integer Bool  //l_Bool
    local boolean Int   //l_Int
endfunction

//# +nosemanticerror
function B2I takes boolean b returns integer
    call setBool(b)
    return l__Bool
endfunction

//# +nosemanticerror
function I2B takes integer i returns boolean
    call setInt(i)
    return l__Int
endfunction

private function Typecast3 takes nothing returns nothing
    local integer Code   //l__Code
    local code Int       //l_Int
endfunction

//# +nosemanticerror
function C2I takes code c returns integer
    call setCode(c)
    return l__Code
endfunction

//# +nosemanticerror
function I2C takes integer i returns code
    call setInt(i)
    return l__Int
endfunction

//# +nosemanticerror
function realToIndex takes real r returns integer
    return r
endfunction

function cleanInt takes integer i returns integer
    return i
endfunction

//# +nosemanticerror
function indexToReal takes integer i returns real
    return i
endfunction

function cleanReal takes real r returns real
    return r
endfunction

endlibrary
//===========================================================================
// Trigger: Update Callback
//===========================================================================
native DzGetMouseXRelative takes nothing returns integer
native DzGetMouseYRelative takes nothing returns integer
native DzGetWindowWidth takes nothing returns integer
native DzGetWindowHeight takes nothing returns integer
// 프레임 단위 명령 수행 관리 부분
scope UpdateCallback
function AtEnterFrame takes nothing returns nothing
 local integer P = 0
  if ( GetLocalPlayer() != null ) then
    if ( DzFrameGetAlpha(DzFrameFindByName("ScoreScreenFrame", 0)) != 0 ) then
      call DzFrameSetUpdateCallback(null)
    else
      set P = GetPlayerId(GetLocalPlayer())+1
      if ( udg_SysO_CamDis[P] != 0. ) then
        call SetCameraField(CAMERA_FIELD_TARGET_DISTANCE, udg_SysO_CamDis[P], 0)
        call SetCameraField(CAMERA_FIELD_ANGLE_OF_ATTACK, bj_CAMERA_DEFAULT_AOA, 0)
        call SetCameraField(CAMERA_FIELD_ROTATION, bj_CAMERA_DEFAULT_ROTATION, 0)
      endif
      if ( udg_SysO_CamUnit[P] ) then
        call PanCameraToTimed(GetWidgetX(udg_Unit[P]),GetWidgetY(udg_Unit[P]),0)
      endif
    endif
  endif
endfunction

public function Start takes nothing returns nothing
  // 찝은 아이템 이동 ====================================================================================================
  if Inventory_AreYouPickUp or EquipSlot_AreYouPickUp then
    call DzFrameSetAbsolutePoint(DzFrameFindByName("InVe_MouseItem", 0), JN_FRAMEPOINT_CENTER, (I2R(DzGetMouseXRelative()) / I2R(DzGetWindowWidth()) * 0.8 + 0.0025), (I2R(DzGetWindowHeight() - 42 - DzGetMouseYRelative()) / I2R(DzGetWindowHeight() - 42) * 0.6))
  // Inventory 프레임창 이동 ====================================================================================================
  elseif Inventory_Drag and Inventory_Snap then
    call DzFrameClearAllPoints(DzFrameFindByName("InVe_Back", 0))
    call DzFrameSetAbsolutePoint(DzFrameFindByName("InVe_Back", 0), JN_FRAMEPOINT_TOP, RMaxBJ(.116,RMinBJ(I2R(DzGetMouseXRelative()) / I2R(DzGetWindowWidth()) * 0.8 + 0.0025, 0.684)), RMaxBJ(0.28, RMinBJ(I2R(DzGetWindowHeight() - 42 - DzGetMouseYRelative()) / I2R(DzGetWindowHeight() - 42) * 0.6, 0.44)) + 0.0175)
    
    call DzFrameClearAllPoints(DzFrameFindByName("EqSl_Back", 0))
    call DzFrameSetPoint(DzFrameFindByName("EqSl_Back", 0), JN_FRAMEPOINT_BOTTOM, DzFrameFindByName("InVe_Back", 0), JN_FRAMEPOINT_TOP, 0., 0.)
  elseif EquipSlot_Drag and EquipSlot_Snap then
    call DzFrameClearAllPoints(DzFrameFindByName("EqSl_Back", 0))
    call DzFrameSetAbsolutePoint(DzFrameFindByName("EqSl_Back", 0), JN_FRAMEPOINT_TOP, RMaxBJ(.116,RMinBJ(I2R(DzGetMouseXRelative()) / I2R(DzGetWindowWidth()) * 0.8 + 0.0025, 0.684)), RMaxBJ(0.41, RMinBJ(I2R(DzGetWindowHeight() - 42 - DzGetMouseYRelative()) / I2R(DzGetWindowHeight() - 42) * 0.6, 0.58)) + 0.0175)
    
    call DzFrameClearAllPoints(DzFrameFindByName("InVe_Back", 0))
    call DzFrameSetPoint(DzFrameFindByName("InVe_Back", 0), JN_FRAMEPOINT_TOP, DzFrameFindByName("EqSl_Back", 0), JN_FRAMEPOINT_BOTTOM, 0., 0.)
  else
    //call DzFrameSetUpdateCallback("")
    call DzFrameSetUpdateCallbackByCode(function AtEnterFrame)
  endif
endfunction
endscope//===========================================================================
// Trigger: FMi Scope
//
// local integer no = FMi_IC2B(S2I(SubString(LoadStr(udg_hash, GetItemTypeId(t), StringHash("FMi-Val")),1,3)))
// no - 클릭되어 있는칸
// i 새로 클릭한 칸
//===========================================================================
constant function ScrolRatio2 takes integer lv, boolean same returns real
  if ( same ) then
    return 1.
  else
    return 1./(1+lv)
  endif
endfunction
constant function ScrolRatio takes integer nowlv, integer tolv, boolean same returns real
  if ( tolv == 0 ) then
    return 100.
  elseif ( tolv == 1 ) then
    if ( nowlv == 1 ) then
      return 40.*ScrolRatio2(tolv,same)
    elseif ( nowlv >= 2 ) then
      return 100.*ScrolRatio2(tolv,same)
   endif
  elseif ( tolv == 2 ) then
    if ( nowlv == 1 ) then
      return 8.*ScrolRatio2(tolv,same)
    elseif ( nowlv == 2 ) then
      return 40.*ScrolRatio2(tolv,same)
    elseif ( nowlv >= 3 ) then
      return 100.*ScrolRatio2(tolv,same)
    endif
  elseif ( tolv == 3 ) then
    if ( nowlv == 1 ) then
      return .8*ScrolRatio2(tolv,same)
    elseif ( nowlv == 2 ) then
      return 8.*ScrolRatio2(tolv,same)
    elseif ( nowlv == 3 ) then
      return 40.*ScrolRatio2(tolv,same)
    elseif ( nowlv >= 4 ) then
      return 100.*ScrolRatio2(tolv,same)
    endif
  elseif ( tolv == 4 ) then
    if ( nowlv == 1 ) and ( same ) then
      return .04
    elseif ( nowlv == 2 ) and ( same ) then
      return .8
    elseif ( nowlv == 3 ) then
      return 8.*ScrolRatio2(tolv,same)
    elseif ( nowlv == 4 ) then
      return 40.*ScrolRatio2(tolv,same)
    elseif ( nowlv >= 5 ) then
      return 100.*ScrolRatio2(tolv,same)
    endif
  endif
  return 0.
endfunction

constant function Condition2 takes integer i returns boolean /* 5강엔 제련 불가 조건 */
  return ( i == 0 ) or ( i-(i/5)*5 != 0 )
endfunction

constant function RecallData takes integer it returns integer
//Vileage_Rect 와 연동
  if ( it == 'I00S' ) then
  //밀레스
    return 6
  elseif ( it == 'I00U' ) then
  //루어스 (성)
    return 7
  elseif ( it == 'I00V' ) then
  //호엔
    return 13
  elseif ( it == 'I00W' ) then
  //뤼케시온
    return 14
  elseif ( it == 'I00X' ) then
  //아벨
    return 11
  elseif ( it == 'I08I' ) then
  //피에트
    return 10
  elseif ( it == 'I07Y' ) then
  //여관 리콜
    return 15
  elseif ( it == 'I083' ) then
  //마인
    return 16
  endif
 return 0
endfunction
function Recall takes unit u, integer it, boolean minus returns boolean
 local integer P = GetPlayerId(GetOwningPlayer(u))+1
  if ( RecallData(it) == 0 ) then
    call MSG(Player(P-1), 1, 3, "리콜이 없습니다.")
  elseif ( GetUnitAbilityLevel(u, 'B00M') > 0 ) then
    call MSG(Player(P-1), 1, 4, "코마상태에선 사용이 불가능합니다!")
  //elseif ( RectContainsUnit(gg_rct_SR_Water_0, u) ) then
    //call MSG(Player(P-1), 1, 4, "물 속에서는 사용할 수 없습니다.")
    //call IssueImmediateOrder(u, "stop")
  //elseif ( RectContainsUnit(gg_rct_SR_Dead, u) ) then
    //call MSG(Player(P-1), 1, 4, "알 수 없는 기분 나쁜 기운이 리콜의 사용을 무효화합니다.")
    //call IssueImmediateOrder(u, "stop")
  else
    call MSG(Player(P-1), 2, 4, "|cffffff80" + GetObjectName(it) + BaseStr(11) + "을 사용하셨습니다.")
    call Bufftt(CreateTextTagUnitBJ("|cff8bc7fc" + GetObjectName(it) + "  !!", u, -30., 15., 100., 0., 0., 20.), 4)
    call SelectUnitForPlayerSingle(u, Player(P-1))
    call TriggerSleepAction(1.)
    call SetUnitPosition(u, GetRectCenterX(Vileage_Rect(RecallData(it))), GetRectCenterY(Vileage_Rect(RecallData(it))))
    call PauseUnit(u, false)
    call SetUnitInvulnerable(u, false)
    call ShowUnit(u, true)
    if ( minus ) then
      call MinusItem(P, it, 1)
    endif
    return true
  endif
 return false
endfunction

function FMi_Cam takes player p, boolean on returns nothing
 local integer P = GetPlayerId(p)+1
  if ( on ) then/*
  //트랙커블 켬
    set udg_SysO_Inven[P] = true
    call SaveBoolean(udg_hash, StringHash("FMi_Cam"), P, true)
//call TimeAction(udg_Unit[P], 0., 12) // 0초 뒤 정지
    if ( GetLocalPlayer() == p ) then
      call SetCameraBoundsXY(GetRectCenterX(FMi_Rect(P)), GetRectCenterY(FMi_Rect(P)))
      //call PanCameraTo(GetRectCenterX(FMi_Rect(P)), GetRectCenterY(FMi_Rect(P)))
      call SetCameraField(CAMERA_FIELD_TARGET_DISTANCE, 2500., 0)
      call SetCameraField(CAMERA_FIELD_ANGLE_OF_ATTACK, 270., 0)
      set udg_SysA_AddValue = .7
    endif
    set bj_lastCreatedLeaderboard = LoadLeaderboardHandle(udg_hash, P, StringHash("FMi_Bod"+I2S(P)))
    if ( bj_lastCreatedLeaderboard == null ) then
      call MSG(p, 1, 3., "FMi - 정보창이 없습니다!")
      call DestroyLeaderboard(LoadLeaderboardHandle(udg_hash, P, StringHash("FMi_Bod"+I2S(P))))
      set bj_lastCreatedLeaderboard = CreateLeaderboard()
      call SaveLeaderboardHandle(udg_hash, P, StringHash("FMi_Bod"+I2S(P)), bj_lastCreatedLeaderboard)
    endif
    call LeaderboardSetLabel(bj_lastCreatedLeaderboard, "아이템 이름")
    set bj_forLoopAIndex = 1
    loop
      exitwhen bj_forLoopAIndex > 12
	  call LeaderboardRemovePlayerItem(bj_lastCreatedLeaderboard, Player(bj_forLoopAIndex-1))
      set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    call LeaderboardAddItem(bj_lastCreatedLeaderboard, "아이템을 클릭하세요", 0, Player(0))
    call LeaderboardSetLabelColor(bj_lastCreatedLeaderboard, 255, 255, 255, 255)
    call LeaderboardSetSizeByItemCount(bj_lastCreatedLeaderboard, 1)
    call LocalMtbM(p, bj_lastCreatedMultiboard, true)
    call LocalLdbM(p, bj_lastCreatedLeaderboard, true)*/
  else
  //트랙커블 끔
    
//call PauseUnit(udg_Unit[P], false)
    /*if ( udg_ShareChatMsgOn[P] ) then
      if ( GetLocalPlayer() == p ) then
	    call SetCameraBoundsToRect(FMi_Rect(15))
        call PanCameraToTimed(GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]), 0)
        call SetCameraField(CAMERA_FIELD_TARGET_DISTANCE, LoadInteger(udg_hash, StringHash("FoV"), P), 0)
        call SetCameraField(CAMERA_FIELD_ANGLE_OF_ATTACK, bj_CAMERA_DEFAULT_AOA, 0)
      endif
      call LocalLdbM(Player(P-1), LoadLeaderboardHandle(udg_hash, P, StringHash("FMi_Bod"+I2S(P))), false)
      call LocalLdbM(Player(P-1), udg_ShareChatBoard, true)
    else*/
      if ( RectContainsUnit(Vileage_Rect(15), udg_Unit[P]) ) then
        if ( GetLocalPlayer() == p ) then
	      call SetCameraBoundsToRect(Vileage_Rect(15))
          call PanCameraToTimed(GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]), 0)
          call SetCameraField(CAMERA_FIELD_TARGET_DISTANCE, LoadInteger(udg_hash, StringHash("FoV"), P), 0)
          call SetCameraField(CAMERA_FIELD_ANGLE_OF_ATTACK, bj_CAMERA_DEFAULT_AOA, 0)
          set udg_SysA_AddValue = 0.
        endif
      elseif ( RectContainsUnit(gg_rct_Etc_Rect_01, udg_Unit[P]) ) then
        if ( GetLocalPlayer() == p ) then
	      call SetCameraBoundsToRect(gg_rct_Etc_Rect_01)
          call PanCameraToTimed(GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]), 0)
          call SetCameraField(CAMERA_FIELD_TARGET_DISTANCE, LoadInteger(udg_hash, StringHash("FoV"), P), 0)
          call SetCameraField(CAMERA_FIELD_ANGLE_OF_ATTACK, bj_CAMERA_DEFAULT_AOA, 0)
          set udg_SysA_AddValue = 0.
        endif
      elseif ( RectContainsUnit(gg_rct_Etc_Rect_03, udg_Unit[P]) ) then
        if ( GetLocalPlayer() == p ) then
	      call SetCameraBoundsToRect(gg_rct_Etc_Rect_03)
          call PanCameraToTimed(GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]), 0)
          call SetCameraField(CAMERA_FIELD_TARGET_DISTANCE, LoadInteger(udg_hash, StringHash("FoV"), P), 0)
          call SetCameraField(CAMERA_FIELD_ANGLE_OF_ATTACK, bj_CAMERA_DEFAULT_AOA, 0)
          set udg_SysA_AddValue = 0.
        endif
      elseif ( RectContainsUnit(Hunting_Rect(47), udg_Unit[P]) ) then
        if ( GetLocalPlayer() == p ) then
	      call SetCameraBoundsToRect(Hunting_Rect(47))
          call PanCameraToTimed(GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]), 0)
          call SetCameraField(CAMERA_FIELD_TARGET_DISTANCE, LoadInteger(udg_hash, StringHash("FoV"), P), 0)
          call SetCameraField(CAMERA_FIELD_ANGLE_OF_ATTACK, bj_CAMERA_DEFAULT_AOA, 0)
          set udg_SysA_AddValue = 0.
        endif
      else
        if ( GetLocalPlayer() == p ) then
	      call SetCameraBoundsToRect(FMi_Rect(0))
          call PanCameraToTimed(GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]), 0)
          call SetCameraField(CAMERA_FIELD_TARGET_DISTANCE, LoadInteger(udg_hash, StringHash("FoV"), P), 0)
          call SetCameraField(CAMERA_FIELD_ANGLE_OF_ATTACK, bj_CAMERA_DEFAULT_AOA, 0)
          set udg_SysA_AddValue = 0.
        endif
      endif
      
      if ( not IsMultiboardDisplayed(bj_lastCreatedMultiboard) ) then
        call MultiboardDisplay(bj_lastCreatedMultiboard, true)
      endif
      if ( SubString(udg_SysB_Setting[P],0,1) == "1" ) then
        call LocalMtbM(Player(P-1), bj_lastCreatedMultiboard, true)
      else
        call LocalMtbM(Player(P-1), bj_lastCreatedMultiboard, false)
      endif
      call LocalLdbM(Player(P-1), LoadLeaderboardHandle(udg_hash, P, StringHash("FMi_Bod"+I2S(P))), false)
    endif
  //endif
endfunction

constant function ItemClass takes string s returns string
  if ( s == "01" ) then
    return "한손검"
  elseif ( s == "02" ) then
    return "단검"
  elseif ( s == "03" ) then
    return "표창"
  elseif ( s == "04" ) then
    return "채찍"
  elseif ( s == "05" ) then
    return "클로"
  elseif ( s == "06" ) then
    return "도끼"
  elseif ( s == "07" ) then
    return "양손검"
  elseif ( s == "08" ) then
    return "스태프"
  elseif ( s == "10" ) then
    return "방패"
  elseif ( s == "11" ) then
    return "갑옷"
  elseif ( s == "12" ) then
    return "투구"
  elseif ( s == "13" ) then
    return "목걸이"
  elseif ( s == "14" ) then
    return "귀걸이"
  elseif ( s == "15" ) then
    return "장갑"
  elseif ( s == "16" ) then
    return "팔찌"
  elseif ( s == "17" ) then
    return "벨트"
  elseif ( s == "18" ) then
    return "각반"
  elseif ( s == "19" ) then
    return "신발"
  elseif ( s == "20" ) then
    return "반지"
  elseif ( s == "21" ) then
    return "휘장"
  else
    return ""
  endif
endfunction
constant function ViewClass takes string s returns string
  if ( s == "0" ) then
    return "(공용)"
  elseif ( s == "2" ) then
    return "(전사)"
  elseif ( s == "3" ) then
    return "(도적)"
  elseif ( s == "4" ) then
    return "(마법사)"
  elseif ( s == "5" ) then
    return "(성직자)"
  elseif ( s == "6" ) then
    return "(무도가)"
  elseif ( s == "7" ) then
    return "(무도가 외)"
  else
    return ""
  endif
endfunction
constant function FMi_SaleValue takes string s returns integer
  if ( s == "1" ) then
    return 30
  elseif ( s == "2" ) then
    return 125
  elseif ( s == "3" ) then
    return 375
  elseif ( s == "4" ) then
    return 825
  elseif ( s == "5" ) then
  //56
    return 1250
  elseif ( s == "6" ) then
    return 1875
  elseif ( s == "7" ) then
    return 2800
  elseif ( s == "8" ) then
    return 4200
  else
    return 1
  endif
endfunction
//FMi_SaleValue(SubString(LoadStr(udg_hash, GetItemTypeId(udg_temp_t), StringHash("FMi-Val")),3,4))
constant function SellItemX takes integer level returns integer
  if ( level == 1 ) then
    return 2
  elseif ( level >= 2 ) then
    return 4
  else
    return 1
  endif
endfunction
function SellItem takes integer P, item t returns nothing
 local integer slot
  if ( udg_SysK_SellAdd[P] != 0 ) then
    set slot = R2I(FMi_SaleValue(SubString(LoadStr(udg_hash, GetItemTypeId(t), StringHash("FMi-Val")),3,4)) * ((100+udg_SysK_SellAdd[P])/ 100.) ) * ( SellItemX(isNamed(GetItemCharges(t),false)) )
  else
    set slot = FMi_SaleValue(SubString(LoadStr(udg_hash, GetItemTypeId(t), StringHash("FMi-Val")),3,4)) * ( SellItemX(isNamed(GetItemCharges(t),false)) )
  endif
  call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) + slot)
  call MSG(Player(P-1), 1, 5, GetItemName(t) + "를 판매하여 " + I2S(slot) + "Gold 를 획득했습니다.")
  
  call FlushChildHashtable(udg_hash, GetHandleId(t))
  call RemoveItem(t)
endfunction
//call SellItem(P, t)


constant function ScrolData3 takes integer no, integer no2 returns boolean
  if ( no == FMI_MAXMAX_INVENTORY+11 ) or ( no == FMI_MAXMAX_INVENTORY+13 ) or ( no == FMI_MAXMAX_INVENTORY+14 ) or ( no == FMI_MAXMAX_INVENTORY+12 ) or ( no == FMI_MAXMAX_INVENTORY+2 ) then
  //악세사리 = 신발, 목걸이, 귀걸이, 반지
    return ( no2 == FMI_MAXMAX_INVENTORY+11 ) or ( no2 == FMI_MAXMAX_INVENTORY+3 ) or ( no2 == FMI_MAXMAX_INVENTORY+4 ) or ( no2 == FMI_MAXMAX_INVENTORY+12 ) or ( no2 == FMI_MAXMAX_INVENTORY+2 )
  elseif ( no == FMI_MAXMAX_INVENTORY+6 ) or ( no == FMI_MAXMAX_INVENTORY+10 ) or ( no == FMI_MAXMAX_INVENTORY+8 ) or ( no == FMI_MAXMAX_INVENTORY+9 ) or ( no == FMI_MAXMAX_INVENTORY+1 ) then
  //장신구 = 방패, 각반, 장갑, 벨트
    return ( no2 == FMI_MAXMAX_INVENTORY+6 ) or ( no2 == FMI_MAXMAX_INVENTORY+10 ) or ( no2 == FMI_MAXMAX_INVENTORY+8 ) or ( no2 == FMI_MAXMAX_INVENTORY+9 ) or ( no2 == FMI_MAXMAX_INVENTORY+1 )
  else
    return ( no == no2 )
  endif
endfunction
constant function ScrolData2 takes integer no returns integer
/*31 모자 스크롤
32 미구현
33 목걸이
34 귀걸이
35 갑옷
36 방패
37 무기
38 장갑(팔찌)
39 벨트
40 각반
41 신발
42 반지*/
  if ( no == FMI_MAXMAX_INVENTORY+1 ) then
    return 'pghe'
  elseif ( no == FMI_MAXMAX_INVENTORY+2 ) then
    return 'fgdg'
  elseif ( no == FMI_MAXMAX_INVENTORY+3 ) then
    return 'wlsd'
  elseif ( no == FMI_MAXMAX_INVENTORY+4 ) then
    return 'fgrd'
  elseif ( no == FMI_MAXMAX_INVENTORY+5 ) then
    return 'srrc'
  elseif ( no == FMI_MAXMAX_INVENTORY+6 ) then
    return 'ankh'
  elseif ( no == FMI_MAXMAX_INVENTORY+7 ) then
    return 'mnst'
  elseif ( no == FMI_MAXMAX_INVENTORY+8 ) then
    return 'woms'
  elseif ( no == FMI_MAXMAX_INVENTORY+9 ) then
    return 'sror'
  elseif ( no == FMI_MAXMAX_INVENTORY+10 ) then
    return 'wshs'
  elseif ( no == FMI_MAXMAX_INVENTORY+11 ) then
    return 'fgrg'
  elseif ( no == FMI_MAXMAX_INVENTORY+12 ) then
    return 'fgfh'
  elseif ( no == -1 ) then
    return 'sand'
  endif
 return 0
endfunction
constant function ScrolData takes integer it returns integer
//FCut(FMi_DragData(~,1) 와 연동
/*31 모자
32 휘장
33 목걸이
34 귀걸이
35 갑옷
36 방패
37 무기
38 장갑(팔찌)
39 벨트
40 각반
41 신발
42 반지*/
  if ( it == 'pghe' ) then
    return FMI_MAXMAX_INVENTORY+1
  elseif ( it == 'fgdg' ) then
    return FMI_MAXMAX_INVENTORY+2
  elseif ( it == 'wlsd' ) then
    return FMI_MAXMAX_INVENTORY+3
  elseif ( it == 'fgrd' ) then
    return FMI_MAXMAX_INVENTORY+4
  elseif ( it == 'srrc' ) then
    return FMI_MAXMAX_INVENTORY+5
  elseif ( it == 'ankh' ) then
    return FMI_MAXMAX_INVENTORY+6
  elseif ( it == 'mnst' ) then
    return FMI_MAXMAX_INVENTORY+7
  elseif ( it == 'woms' ) then
    return FMI_MAXMAX_INVENTORY+8
  elseif ( it == 'sror' ) then
    return FMI_MAXMAX_INVENTORY+9
  elseif ( it == 'wshs' ) then
    return FMI_MAXMAX_INVENTORY+10
  elseif ( it == 'fgrg' ) then
    return FMI_MAXMAX_INVENTORY+11
  elseif ( it == 'fgfh' ) then
    return FMI_MAXMAX_INVENTORY+12
  elseif ( it == 'sand' ) then
    return -1
  endif
 return 0
endfunction


function ItemClassTypeLv takes string s returns string
    return "|c00ffff00" + ViewClass(SubString(s,0,1)) + /*
        */ "|c0000ffff ["+ItemClass(SubString(s,1,3))+"] " + /*
        */ "|c00ffff00Lv."+I2S(FMi_ILv(S2I(SubString(s,3,4))))
endfunction
function ItemName takes integer it, integer co, boolean first returns string
  if not ( first ) then
    if ( co == 0 ) then
      return GetObjectName(it)
    elseif ( EXExecuteScript2("item", it, "stockMax") == "8" ) then /* 8스택 = 주문서 */
      if ( it == 'sand' ) then
        return GetNamed1(isNamed(co,false),false) + GetObjectName(it)
      else
        return GetNamed1(isNamed(co,false),false) + GetNamed2(isNamed(co,true)) + GetObjectName(it)
      endif
      
    elseif ( EXExecuteScript2("item", it, "class") == "Miscellaneous" ) then
      return GetObjectName(it) + " |cffffffff("+I2S(co)+"개)"
    
    elseif ( GetItemNamedSpecial(co) != "" ) then /* 5강 장비, 특별 이름 */
      return GetItemNamedSpecial(co) + GetObjectName(it)
    
    else /* 1-4강 장비 */
      return GetNamed1(isNamed(co,false),false) + GetNamed2(isNamed(co,true)) + GetObjectName(it)
    endif
  elseif ( HaveSavedInteger(udg_hash, it, StringHash("FSE_T2I")) ) then
    if ( EXExecuteScript2("item", it, "class") == "Miscellaneous" ) then
      return ""
    else /* 직업, [종류] Lv.00 */
      return ItemClassTypeLv(LoadStr(udg_hash, it, StringHash("FMi-Val")))
    endif
    
  elseif ( EXExecuteScript2("item", it, "class") != "Miscellaneous" ) then
    return ItemClassTypeLv(LoadStr(udg_hash, it, StringHash("FMi-Val"))) + "|cffff0000(※저장 불가)"
    
  else
    return "|cffff0000※저장 불가 아이템입니다 !!"
  endif
endfunction
//call GiveItem(P, 'I084', 3)

function GetItemGoInven_Conditions takes nothing returns boolean
  return isHero(GetTriggerUnit()) and GetItemLevel(GetManipulatedItem()) != 1 and GetItemLevel(GetManipulatedItem()) != 7 and not udg_SysA_Item and ( GetManipulatedItem() != null )
endfunction
native JNPublicMapServerLog takes string MapId, string SecretKey, string Version, string Loging returns string
native JNSetLogUseType takes string MapId, string UserId, string SecretKey, string Character, string Version, string Loging, string LogType returns string

function CongraItem takes integer P, item t returns nothing
  call SaveBoolean(udg_hash, StringHash("LoadItem"), GetHandleId(t), not udg_SysA_ReloadEnd)
  call MSG(Player(P-1), 1, 7., "축하합니다! |c00ffff00" + GetItemNamed(t) + BaseStr(11) + "를 획득했습니다!")
  call MSGAll(-P, true, 1, 1, 7., "축하해주세요! " + SysStr(2,P) + GetPlayerName(Player(P-1)) + BaseStr(11) + "님이 |c00ffff00" + GetItemNamed(t) + BaseStr(11) + "를 획득했습니다!")
  if ( isNamed(GetItemCharges(t),false) >= 3 ) then
    if ( GetLocalPlayer() == Player(P-1) ) then
      call JNPublicMapServerLog(JN_MAPID, JN_SECRETKEY, BaseStr(9), "["+BaseStr(9)+"] "+ udg_SysB_Name[P]+"("+GetUnitName(udg_Unit[P])+")님이 "+GetItemNamed(t)+"을(를) 획득했습니다!")
      call JNSetLogUseType(JN_MAPID, udg_SysB_Name[P], JN_SECRETKEY, "0_0", BaseStr(9), GetItemNamed(t)+"을(를) 획득했습니다!", "Item")
    endif
  endif
endfunction
function FMi_GetItem_Action takes unit u, item t returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(u))+1
 local integer i = FMi_GetEmpty(P)
 local integer j = 0
 local integer itid = GetItemTypeId(t)
  if ( i >= 1 ) then
    if ( GetItemUserData(t) != 0 and GetItemUserData(t) != P ) then
      if ( GetItemType(t) != ITEM_TYPE_UNKNOWN ) and ( GetItemCharges(t) > 0 ) then
        call MSG(Player(P-1), 2, 8., "|cffDFFB4F" + GetItemNamed(t) + "|cffffdc3c은(는) " + SysStr(2,GetItemUserData(t)) + GetPlayerName(Player(GetItemUserData(t)-1)) + "|cffffdc3c님의 아이템입니다.")
      else
        call MSG(Player(P-1), 2, 8., "|cffDFFB4F" + GetItemName(t) + "|cffffdc3c은(는) " + SysStr(2,GetItemUserData(t)) + GetPlayerName(Player(GetItemUserData(t)-1)) + "|cffffdc3c님의 아이템입니다.")
      endif
      call SetItemPosition(t, GetUnitX(udg_Unit[P]), GetUnitY(udg_Unit[P]))
      set t = null
      return
    else
      if ( GetItemType(t) == ITEM_TYPE_UNKNOWN ) and ( ScrolData(GetItemTypeId(t)) == 0 ) then
        //기타 아이템, 중첩시킴.
        set i = StringHash("FMi_Item"+I2S(P))
        loop
          exitwhen j >= SysInt(0,15)
          if ( GetItemTypeId(LoadItemHandle(udg_hash, i, j)) == itid ) then
            set t = LoadItemHandle(udg_hash, i, j)
            exitwhen true
          endif
          set j = j + 1
        endloop
      endif
    
      if ( t != GetManipulatedItem() ) then
        if ( GetItemUserData(t) != 0 or GetItemUserData(GetManipulatedItem()) != 0 ) then
          call SetItemUserData(t, P)
        endif
        if ( GetItemTypeId(t) == 'I084' ) then
          call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Flare\\FlareCaster.mdl", u, "origin"))
          call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIlm\\AIlmTarget.mdl", u, "origin"))
        endif
        call SetItemCharges(t, GetItemCharges(t)+GetItemCharges(GetManipulatedItem()))
        call RemoveItem(GetManipulatedItem())
        call MSG(GetOwningPlayer(u), 2, 3, "|c00ffff00" + GetItemName(t) + "|r [" + I2S(GetItemCharges(t)) + "]")
      else
        call ForceGiveItem(P, FMi_GetEmpty(P), t, -1)
        
        if ( GetItemType(t) == ITEM_TYPE_UNKNOWN ) then
//          call SaveDestructableHandle(udg_hash, StringHash("FMi_Doo"+I2S(P)), i, CreateDestructable(FMi_I2D(S2I(SubString(LoadStr(udg_hash, GetItemTypeId(t), StringHash("FMi-Val")),0,3))), LoadReal(udg_hash, GetHandleId(udg_temp_tr), StringHash("tr-x")), LoadReal(udg_hash, GetHandleId(udg_temp_tr), StringHash("tr-y")), 0., 1., 0))
          if ( GetItemCharges(GetManipulatedItem()) >= 1 ) then
            if ( ScrolData(GetItemTypeId(t)) != 0 ) then
            //스크롤
              if ( ScrolData(GetItemTypeId(t)) == -1 ) then
                call MSG(GetOwningPlayer(u), 1, 4, "|c00ffff00" + GetItemName(t) + "|r (모든 특성)" + BaseStr(11) + " 획득")
              else
                call MSG(GetOwningPlayer(u), 1, 4, "|c00ffff00" + GetItemName(t) + "|r (" + GetNamed2(isNamed(GetItemCharges(t),true)) + "특성)" + BaseStr(11) + " 획득")
              endif
            else
              call MSG(GetOwningPlayer(u), 1, 4, "|c00ffff00" + GetItemName(t) + "|r (" + I2S(GetItemCharges(GetManipulatedItem())) + "개)" + BaseStr(11) + " 획득")
            endif
          else
            call MSG(GetOwningPlayer(u), 1, 4, "|c00ffff00" + GetItemName(t) + BaseStr(11) + " 획득")
          endif
        else
        //장비 아이템
//          call SaveDestructableHandle(udg_hash, StringHash("FMi_Doo"+I2S(P)), i, CreateDestructable(FMi_I2D(S2I(SubString(FCut(LoadStr(udg_hash, GetItemTypeId(t), StringHash("FMi-Val")),1),7,10))), LoadReal(udg_hash, GetHandleId(udg_temp_tr), StringHash("tr-x")), LoadReal(udg_hash, GetHandleId(udg_temp_tr), StringHash("tr-y")), 0., 1., 0))
          //장비 아이템일 경우, named 적용
          if ( GetItemUserData(t) == 0 ) and ( isNamed(GetItemCharges(t),false) >= 2 ) then
            call SetItemUserData(t, P)
            
            call CongraItem(P, t)
          else
            call MSG(GetOwningPlayer(u), 1, 6, "|c00ffff00" + GetItemNamed(t) + BaseStr(11) + " 획득")
          endif
        endif
        
        if ( FMi_GetEmpty(P) == -1 ) then
          call MSG(Player(P-1), 1, 3., "인벤토리가 막 가득 찼습니다.")
        endif
      endif
    endif
  else
    call UnitRemoveItem(u, t)
    call MSG(Player(P-1), 1, 3., "인벤토리가 가득 찬 상태입니다.")
  endif
endfunction
function GiveItem takes integer P, integer ic, integer v returns nothing
  set bj_lastCreatedItem = CreateItem(ic, GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]))
  call SetItemCharges(bj_lastCreatedItem, v)
  if ( not UnitAddItem(udg_Unit[P], bj_lastCreatedItem) ) then
    call FMi_GetItem_Action(udg_Unit[P], bj_lastCreatedItem)
  endif
endfunction
// 아이템 습득 ====================================================================================================
function Trig_FMi_GetItemGoInven_Actions takes nothing returns nothing
 call FMi_GetItem_Action(GetTriggerUnit(), GetManipulatedItem())
endfunction//===========================================================================
// Trigger: Quest 00 Note
//
// |cffc3dbff　└목표 : |cffffdc3c
// -사람-|cffc3dbff-내용-|cff9f9f9f-장소-|cffc3dbff-내용-|cffff3315-유닛-
// "+BaseStr(14)+"
// call MSG(Player(P-1), 11, 8, BaseStr(14) + "사냥/퀘스트를 통하여 레벨 6을 달성하세요.")
// (도움말: \"|r-지도" + BaseStr(14) + "\")
// \n　　"+BaseStr(11)+"※참고: 
//===========================================================================
constant function NOTEVALUE takes integer c returns integer
  if ( c <= 2 ) then
    return 1
  elseif ( c == 3 ) then
    return 4
  elseif ( c == 4 ) then
    return 6
  elseif ( c == 5 ) then
    return 8
  elseif ( c == 6 ) then
    return 10
  elseif ( c == 7 ) then
    return 12
  elseif ( c == 8 ) then
    return 14
  elseif ( c == 9 ) then
    return 16
  elseif ( c == 10 ) then
    return 18
  elseif ( c == 11 ) then
    return 20
  elseif ( c == 12 ) then
    return 22
  elseif ( c == 13 ) then
    return 24
  elseif ( c == 14 ) then
    return 26
  elseif ( c == 15 ) then
    return 28
  elseif ( c == 16 ) then
    return 30
  elseif ( c == 17 ) then
    return 32
  elseif ( c == 18 ) then
    return 34
  elseif ( c == 19 ) then
    return 36
  elseif ( c == 20 ) then
    return 38
  elseif ( c == 21 ) then
    return 40
  elseif ( c == 22 ) then
    return 42
  elseif ( c == 23 ) then
    return 44
  elseif ( c == 24 ) then
    return 46
  elseif ( c == 25 ) then
    return 48
  elseif ( c == 26 ) then
    return 50
  elseif ( c == 27 ) then
    return 52
  elseif ( c == 28 ) then
    return 54
  elseif ( c == 29 ) then
    return 56
  elseif ( c == 30 ) then
    return 58
  elseif ( c == 31 ) then
    return 60
  elseif ( c == 32 ) then
    return 62
  elseif ( c == 33 ) then
    return 64
  elseif ( c == 34 ) then
    return 66
  elseif ( c == 35 ) then
    return 68
  endif
  return 0
endfunction
function Quest_Note2 takes integer P returns nothing
 local integer c = CountItem(P, 'I09V')
  call MSG(Player(P-1), 10, 4, I2S(c))
  if ( udg_Quest_00_Note[P] == -1 ) then
    call MinusItem(P, 'I09V', 999)
    call MSG(Player(P-1), 1, 4, "퀘스트 완료 - 당신은 이제 초보자가 아닙니다!")
  elseif ( udg_Quest_00_Note[P] == 0 ) then
    if ( c > 1 ) then
      call MSG(Player(P-1), 1, 4, "재설정중입니다..")
      if ( udg_SysB_Level[P] > 98 and c < 35 ) then
        set c = 35
      elseif ( udg_SysB_Level[P] > 71 and c < 33 ) then
        set c = 33
      elseif ( udg_SysB_Level[P] > 56 and c < 30 ) then
        set c = 30
      elseif ( udg_SysB_Level[P] > 41 and c < 26 ) then
        set c = 26
      elseif ( udg_SysB_Level[P] > 26 and c < 23 ) then
        set c = 23
      endif
      set udg_Quest_00_Note[P] = NOTEVALUE(c)
      if ( CountItem(P, 'I09V') > c ) then
        call MinusItem(P, 'I09V', CountItem(P, 'I09V')-c)
      else
        call GiveItem (P, 'I09V', c-CountItem(P, 'I09V'))
      endif
      
      call MSG(Player(P-1), 1, 4, "레벨 하이패스!" + I2S(c) + "단계까지 스킵되었습니다. 다시 Z를 눌러주세요.")
    else
      if ( GetUnitLevel(GetTriggerUnit()) < 6 ) and ( Quest_Level(P, 1) == 0 ) then
        call MSG(Player(P-1), 11, 8, "노비스 마을"+BaseStr(14)+"에 있는 |cffffdc3c농부"+BaseStr(14)+"에게 말을 걸고 (우클릭 혹은 A-클릭) 퀘스트를 받으세요.")
      else
        set udg_Quest_00_Note[P] = 1
        call MSG(Player(P-1), 2, 4, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└50골드를 받았습니다! 다시 클릭하면 연계 퀘스트를 받을 수 있습니다.")
        set c = 2
        call MakeTestt(P, true, 50)
      endif
    endif
  elseif ( udg_Quest_00_Note[P] == 1 ) then
    call MSG(Player(P-1), 11, 8, BaseStr(14) + "명령어 \"|r-초보자" + BaseStr(14) + "\"를 입력 한 후, 5초 뒤 클릭하면 퀘스트가 완료됩니다.")
  elseif ( udg_Quest_00_Note[P] == 2 ) then
    call MSG(Player(P-1), 1, 4, "5초간 기다려 주세요.")
  elseif ( udg_Quest_00_Note[P] == 3 ) then
    call MSG(Player(P-1), 2, 4, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└60골드를 받았습니다!")
    set c = 3
    set udg_Quest_00_Note[P] = 4
    call MakeTestt(P, true, 60)
  elseif ( udg_Quest_00_Note[P] == 4 ) then
    call MSG(Player(P-1), 11, 8, BaseStr(14) + "파티를 만들거나 파티에 참여 하십시오. \n    숫자패드 4 - 7 혹은 명령어 \"|r-파티생성 (파티이름)" + BaseStr(14) + "\"을 이용해 파티를 만들 수 있습니다.")
    set udg_Quest_00_Note[P] = 5
  elseif ( udg_Quest_00_Note[P] == 5 ) then
    if ( udg_PartyNumber_ThisP[P] != 0 ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└70골드와 코마디움을 2개 받았습니다!\n"+BaseStr(11)+"　　"+BaseStr(11)+"※참고: 파티장이 \"|r-파티성향"+BaseStr(11)+"\" 명령어를 이용하여 경험치 획득률을 조정할 수 있습니다!")
      set c = 4
      set udg_Quest_00_Note[P] = 6
      call GiveItem(P, 'I08V', 2)
      call MakeTestt(P, true, 70)
    else
      call MSG(Player(P-1), 11, 8, BaseStr(14) + "파티가 없다면 \"|r-파티생성 (파티이름)" + BaseStr(14) + "\"명령어를 이용해 파티를 만들 수 있습니다. \n　　"+BaseStr(11)+"※참고: 다른 사람의 파티에 참여하고 싶다면 \"|r-파티목록" + BaseStr(11) + "\"명령어를 이용하세요.")
    endif
  elseif ( udg_Quest_00_Note[P] == 6 ) then
    call MSG(Player(P-1), 11, 8, BaseStr(14) + "12칸의 장비 인벤토리가 있습니다. 인벤토리를 열고, 아이템을 장착해보세요. (단축키 i)")
    set udg_Quest_00_Note[P] = 7
  elseif ( udg_Quest_00_Note[P] == 7 ) then
    if ( LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), FMI_MAXMAX_INVENTORY+7) != null ) or ( LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), FMI_MAXMAX_INVENTORY+5) != null ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└80골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 인벤토리의 아이템도 모두 세이브됩니다.")
      set c = 5
      call MakeTestt(P, true, 80)
      set udg_Quest_00_Note[P] = 8
    else
      call MSG(Player(P-1), 11, 8, BaseStr(14) + "인벤토리(단축키 i)에서 장비 아이템을 더블클릭/우클릭하여 장착할 수 있습니다.\n　　"+BaseStr(11)+"※참고: 장비는 농부 퀘스트를 깨고 얻을 수 있습니다.")
    endif
  elseif ( udg_Quest_00_Note[P] == 8 ) then
    call MSG(Player(P-1), 11, 8, "노비스 마을 밖"+BaseStr(14)+"에 있는 |cffffdc3c아이"+BaseStr(14)+"에게서 퀘스트를 받고, 완수하세요.")
    set udg_Quest_00_Note[P] = 9
  elseif ( udg_Quest_00_Note[P] == 9 ) then
    if ( Quest_Level(P, 3) != 0 ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└90골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 일부 퀘스트는 여러번 클리어시 추가 보상이 있습니다.")
      set c = 6
      call MakeTestt(P, true, 90)
      set udg_Quest_00_Note[P] = 10
    elseif  ( GetHeroLevel(GetTriggerUnit()) > 9 ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!! (레벨 스킵)")
      set c = 6
      set udg_Quest_00_Note[P] = 10
    else
      call MSG(Player(P-1), 11, 8, "노비스 마을 밖"+BaseStr(14)+"에 있는 |cffffdc3c아이"+BaseStr(14)+"에게서 퀘스트를 받고, 완수하세요.")
    endif
  elseif ( udg_Quest_00_Note[P] == 10 ) then
    call MSG(Player(P-1), 11, 8, BaseStr(14) + "레벨 6을 달성한 후, |cff9f9f9f밀레스 마을"+BaseStr(14)+"로 이동하세요. \n  Tip: 리콜 사용(단축키8-8) 혹은 마을 이동(O-R) 사용 후 2번을 타이핑하여 갈 수 있습니다.")
    call Ping(Player(P-1), GetRectCenterX(gg_rct_Villeage_06), GetRectCenterY(gg_rct_Villeage_06), 4.)
    set udg_Quest_00_Note[P] = 11
  elseif ( udg_Quest_00_Note[P] == 11 ) then
    if ( GetHeroLevel(GetTriggerUnit()) >= 6 ) then
      if ( udg_OnesPositionN[P] == -6 ) then
        call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└100골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 마을 위치를 잘 외워 두시는게 좋습니다.")
        call MakeTestt(P, true, 100)
        if ( GetUnitTypeId(GetTriggerUnit()) == SysInt(1,1) ) then
          set c = 7
          set udg_Quest_00_Note[P] = 12
        else
          set c = 8
          set udg_Quest_00_Note[P] = 14
        endif
      else
        call MSG(Player(P-1), 11, 8, "밀레스 마을"+BaseStr(14)+"안으로 이동 후 다시 사용하세요. \n  Tip: 리콜 사용(단축키8-8) 혹은 마을 이동(O-R) 사용 후 2번을 타이핑하여 갈 수 있습니다.")
      endif
    else
      call MSG(Player(P-1), 11, 8, BaseStr(14) + "사냥/퀘스트를 통하여 레벨 6을 달성하세요.")
    endif
  elseif ( udg_Quest_00_Note[P] == 12 ) then
    call MSG(Player(P-1), 11, 8, "밀레스 신전"+BaseStr(14)+"으로 이동한 후, 다른 직업으로 전직을 하세요.")
    set udg_Quest_00_Note[P] = 13
  elseif ( udg_Quest_00_Note[P] == 13 ) then
    if ( GetUnitTypeId(GetTriggerUnit()) != SysInt(1,1) ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└125골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 40레벨 이전에 신전에서 스텟 초기화가 가능합니다.\n　　　※참고2: 그 후 스텟은 99 이전까지 되돌릴 수 없으니 신중히 찍으세요.")
      set c = 8
      call MakeTestt(P, true, 125)
      set udg_Quest_00_Note[P] = 14
    else
      call MSG(Player(P-1), 11, 8, "밀레스 마을"+BaseStr(14)+"에 있는 |c009f9f9f밀레스 신전"+BaseStr(14)+"에서 전직을 하세요.")
      call Ping(Player(P-1), GetRectCenterX(gg_rct_Effect_07), GetRectCenterY(gg_rct_Effect_07), 4.)
    endif
  elseif ( udg_Quest_00_Note[P] == 14 ) then
    call MSG(Player(P-1), 11, 8, "밀레스 마을"+BaseStr(14)+"에서 장비를 구입하고 스킬을 배워 보세요.")
    set udg_Quest_00_Note[P] = 15
  elseif ( udg_Quest_00_Note[P] == 15 ) then
    if ( GetUnitAbilityLevel(GetTriggerUnit(), udg_FSE_Skill[1])+GetUnitAbilityLevel(GetTriggerUnit(), udg_FSE_Skill[2])+GetUnitAbilityLevel(GetTriggerUnit(), udg_FSE_Skill[16])+GetUnitAbilityLevel(GetTriggerUnit(), udg_FSE_Skill[27])+GetUnitAbilityLevel(GetTriggerUnit(), udg_FSE_Skill[63])+GetUnitAbilityLevel(GetTriggerUnit(), 'A03G') > 0 ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└150골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 스킬은 사용할 수록 숙련도가 오르며, 효율이 좋아집니다.")
      set c = 9
      call MakeTestt(P, true, 150)
      set udg_Quest_00_Note[P] = 16
    else
      call MSG(Player(P-1), 11, 8, "밀레스 마을"+BaseStr(14)+"에서 장비를 구입하고 스킬을 배워 보세요.")
      call Ping(Player(P-1), 3552., -16864., 4.)
    endif
  elseif ( udg_Quest_00_Note[P] == 16 ) then
    call MSG(Player(P-1), 11, 8, "스킬 배우는 곳"+BaseStr(14)+"으로 이동해보세요. (단축키 O - E (5초 캐스팅))")
    set udg_Quest_00_Note[P] = 17
  elseif ( udg_Quest_00_Note[P] == 17 ) then
    if ( RectContainsUnit(gg_rct_Etc_Rect_01, udg_Unit[P]) ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└175골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 스킬 요구치가 되면 해당 구역에서 스킬을 배울 수 있습니다.")
      set c = 10
      call MakeTestt(P, true, 175)
      set udg_Quest_00_Note[P] = 18
    else
      call MSG(Player(P-1), 11, 8, "스킬 배우는 곳"+BaseStr(14)+"으로 이동해보세요. (단축키 O - E (5초 캐스팅))")
    endif
  elseif ( udg_Quest_00_Note[P] == 18 ) then
    call MSG(Player(P-1), 11, 8, "최근 마을로 귀환"+BaseStr(14)+"을 사용해보세요. (단축키 8 - 7 (5초 캐스팅))")
  elseif ( udg_Quest_00_Note[P] == 19 ) then
    call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└200골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 전투 중에도 사용할 수 있으나, 5초 캐스팅이 필요합니다.")
    set c = 11
    call MakeTestt(P, true, 200)
    set udg_Quest_00_Note[P] = 20
  elseif ( udg_Quest_00_Note[P] == 20 ) then
    call MSG(Player(P-1), 11, 8, "밀레스 마을"+BaseStr(14)+" 오른쪽에 아래에 있는 |cffffdc3cNPC 푸잎"+BaseStr(14)+"에게서 버프를 받아 보세요.")
    set udg_Quest_00_Note[P] = 21
  elseif ( udg_Quest_00_Note[P] == 21 ) then
    if ( TimerGetRemaining(LoadTimerHandle(udg_hash,P,StringHash("Buff1"))) > 0. ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└250골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 버프를 받으면 보다 쉽게 사냥이 가능합니다.")
      set c = 12
      call MakeTestt(P, true, 250)
      set udg_Quest_00_Note[P] = 22
    else
      call MSG(Player(P-1), 11, 8, "밀레스 마을"+BaseStr(14)+" 오른쪽에 아래에 있는 |cffffdc3cNPC 푸잎"+BaseStr(14)+"에게서 버프를 받아 보세요.")
      call Ping(Player(P-1), GetWidgetX(gg_unit_e019_0374), GetWidgetY(gg_unit_e019_0374), 4.)
    endif
  elseif ( udg_Quest_00_Note[P] == 22 ) then
    call MSG(Player(P-1), 11, 8, "지하묘지 앞"+BaseStr(14)+"에 있는 |cffffdc3c쓰러진 사람"+BaseStr(14)+"에게서 퀘스트를 받으세요")
    set udg_Quest_00_Note[P] = 23
  elseif ( udg_Quest_00_Note[P] == 23 ) then
    if ( Quest_Level(P, 2) != 0 ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└밀레스 리콜 2개를 받았습니다!\n　　"+BaseStr(11)+"※참고: 리콜은 8-8 혹은 인벤토리에서 더블클릭하여 사용할 수 있습니다.")
      set c = 13
      call GiveItem(P, 'I00S', 2)
      set udg_Quest_00_Note[P] = 24
    elseif  ( GetHeroLevel(GetTriggerUnit()) > 9 ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!! (레벨 스킵)")
      set c = 13
      set udg_Quest_00_Note[P] = 24
    else  
      call MSG(Player(P-1), 11, 8, "지하묘지 앞"+BaseStr(14)+"에 있는 |cffffdc3c쓰러진 사람"+BaseStr(14)+"에게서 퀘스트를 받으세요")
      call Ping(Player(P-1), GetWidgetX(I2QU(2)), GetWidgetY(I2QU(2)), 4.)
    endif
  elseif ( udg_Quest_00_Note[P] == 24 ) then
    call MSG(Player(P-1), 11, 8, "명령어, |cffC1FFC1\"푸잎님 사랑해요\""+BaseStr(14)+"를 쳐보세요.")
    set udg_Quest_00_Note[P] = 25
  elseif ( udg_Quest_00_Note[P] == 25 ) then
    if ( LoadBoolean(udg_hash, StringHash("lvf"), P) ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└300골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 구애를 통해 효율적인 성장이 가능합니다.")
      set c = 14
      call MakeTestt(P, true, 300)
      set udg_Quest_00_Note[P] = 26
    else
      call MSG(Player(P-1), 11, 8, "명령어, |cffC1FFC1\"푸잎님 사랑해요\""+BaseStr(14)+"를 쳐보세요.")
    endif
  elseif ( udg_Quest_00_Note[P] == 26 ) then
    call MSG(Player(P-1), 11, 8, "밀레스 마을"+BaseStr(14)+"에 있는 |cffffdc3c아이 엄마"+BaseStr(14)+"에게서 퀘스트를 받고, 완수하세요 (참고 대답: 1번 후 3번)")
    set udg_Quest_00_Note[P] = 27
  elseif ( udg_Quest_00_Note[P] == 27 ) then
    if ( Quest_Level(P, 9) != 0 ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└400골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 일부 퀘스트는 선택지가 있고, 반복이 가능합니다.")
      set c = 15
      call MakeTestt(P, true, 400)
      set udg_Quest_00_Note[P] = 28
      
      if ( TitleGet(P, 7) < 1 ) then
        if ( udg_SysB_TitleNow[P] == 7 ) then
          call Title_Reset(P)
        endif
        call TitleSet(P, 7, 1)
        call MSG(Player(P-1), 1, 8, "칭호, |cff46ffff"+FCut(TITLEVALUE(7,1),1)+"|cffffdc3c을(를) 받았습니다. (기존 칭호 사라짐)")
      endif
    elseif  ( GetHeroLevel(GetTriggerUnit()) > 30 ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!! (레벨 스킵)")
      set c = 15
      set udg_Quest_00_Note[P] = 28
    else
      call MSG(Player(P-1), 11, 8, "밀레스 마을"+BaseStr(14)+"에 있는 |cffffdc3c아이 엄마"+BaseStr(14)+"에게서 퀘스트를 받고, 완수하세요 (참고 대답: 1번 후 3번)")
      call Ping(Player(P-1), GetWidgetX(I2QU(9)), GetWidgetY(I2QU(9)), 4.)
    endif
  elseif ( udg_Quest_00_Note[P] == 28 ) then
    call MSG(Player(P-1), 11, 8, "밀레스 마을"+BaseStr(14)+"에 있는 |cffffdc3c촌장"+BaseStr(14)+"에게서 퀘스트를 받고, 완수하세요 (참고: 2회 반복시 추가보상)")
    set udg_Quest_00_Note[P] = 29
  elseif ( udg_Quest_00_Note[P] == 29 ) then
    if ( Quest_Level(P, 6) != 0 ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└코마디움 3개를 받았습니다!\n　　"+BaseStr(11)+"※참고: 코마디움은 대상이 코마(빈사)상태일때 구해줄 수 있습니다.")
      call GiveItem(P, 'I08V', 3)
      call PushCancle(udg_Unit[P])
      set c = 16
      set udg_Quest_00_Note[P] = 30
    elseif  ( GetHeroLevel(GetTriggerUnit()) > 40 ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!! (레벨 스킵)")
      set c = 16
      set udg_Quest_00_Note[P] = 30
    else
      call MSG(Player(P-1), 11, 8, "밀레스 마을"+BaseStr(14)+"에 있는 |cffffdc3c촌장"+BaseStr(14)+"에게서 퀘스트를 받고, 완수하세요 (참고: 2회 반복시 추가보상)")
      call Ping(Player(P-1), GetWidgetX(I2QU(6)), GetWidgetY(I2QU(6)), 4.)
    endif
  elseif ( udg_Quest_00_Note[P] == 30 ) then
    call MSG(Player(P-1), 11, 8, BaseStr(14) + "파티를 한 상태로 죽으면 코마 상태가 됩니다. 코마상태에 빠져 보고, 코마 상태를 구해 보세요.")
    call TriggerSleepAction(.2)
    if ( udg_PartyNumber_ThisP[P] == 0 ) or ( udg_PartyNumber_pP[udg_PartyNumber_ThisP[P]] < 2 ) then
      call MSG(Player(P-1), 1, 8, "파티원이 적어, 퀘스트가 스킵되었습니다.")
      set udg_Quest_00_Note[P] = 34
    else
      call TriggerSleepAction(.2)
      call MSG(Player(P-1), 11, 8, BaseStr(14) + "한번 더 클릭하면 코마상태가 됩니다. 주변에 파티원이 있을때 진행하세요.")
      set udg_Quest_00_Note[P] = 31
    endif
  elseif ( udg_Quest_00_Note[P] == 31 ) then
    call Coma(udg_Unit[P], 15., 1)
    call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└코마디움 2개를 받았습니다!\n　　"+BaseStr(11)+"※참고: 코마디움은 대상이 코마(빈사)상태일때 구해줄 수 있습니다.")
    call GiveItem(P, 'I08V', 2)
    call PushCancle(udg_Unit[P])
    set c = 17
    set udg_Quest_00_Note[P] = 32
  elseif ( udg_Quest_00_Note[P] == 32 ) then
    if ( udg_PartyNumber_ThisP[P] == 0 ) or ( udg_PartyNumber_pP[udg_PartyNumber_ThisP[P]] < 2 ) then
      call MSG(Player(P-1), 1, 8, "파티원이 적어, 퀘스트가 스킵되었습니다.")
      set udg_Quest_00_Note[P] = 34
    else
      call MSG(Player(P-1), 11, 8, BaseStr(14) + "코마디움 아이템을 이용하여 코마 상태를 회복시켜 보세요.")
    endif
  elseif ( udg_Quest_00_Note[P] == 33 ) then
    call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└500골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 코마디움은 각 마을 리콜상인에게서 구입할 수 있습니다.")
    call MakeTestt(P, true, 500)
    set c = 18
    set udg_Quest_00_Note[P] = 34
  elseif ( udg_Quest_00_Note[P] == 34 ) then
    call MSG(Player(P-1), 11, 8, BaseStr(14) + "자동 세이브를 활성화해보세요. (단축키 O - S)")
  elseif ( udg_Quest_00_Note[P] == 35 ) then
    call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└600골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 자동저장 위치: 워크래프트 폴더 - CustomMapData - LoDSave 폴더의 \n          |r"+udg_SysB_Name[P]+".txt")
    call MakeTestt(P, true, 600)
    call PushCancle(udg_Unit[P])
    set c = 19
    set udg_Quest_00_Note[P] = 36
  elseif ( udg_Quest_00_Note[P] == 36 ) then
    call MSG(Player(P-1), 11, 8, BaseStr(14) + "퀘스트 목록을 확인하세요. (단축키 7 - 7 혹은 명령어 -퀘스트")
  elseif ( udg_Quest_00_Note[P] == 37 ) then
    call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└700골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 많은 퀘스트가 있으니 놓치지마세요!")
    call MakeTestt(P, true, 700)
    set c = 20
    set udg_Quest_00_Note[P] = 38
    if ( TitleGet(P, 7) < 2 ) then
      if ( udg_SysB_TitleNow[P] == 7 ) then
        call Title_Reset(P)
      endif
      call TitleSet(P, 7, 2)
      call MSG(Player(P-1), 1, 8, "칭호, |cff46ffff"+FCut(TITLEVALUE(7,2),1)+"|cffffdc3c을(를) 받았습니다. (기존 칭호 사라짐)")
    endif
  elseif ( udg_Quest_00_Note[P] == 38 ) then  
    call MSG(Player(P-1), 11, 8, "밀레스 마을"+BaseStr(14)+"에 있는 |cffffdc3c부자 노인"+BaseStr(14)+"에게서 퀘스트를 받고, 완수하세요. (3회 반복)")
    set udg_Quest_00_Note[P] = 39
  elseif ( udg_Quest_00_Note[P] == 39 ) then
    if ( Quest_Level(P, 4) == -1 ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└800골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 해당 퀘스드를 포함해 일부 퀘스트는 리방을 해도 클리어가 불가능합니다.")
      call MakeTestt(P, true, 800)
      set c = 21
      set udg_Quest_00_Note[P] = 40
    elseif  ( GetHeroLevel(GetTriggerUnit()) > 40 ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!! (레벨 스킵)")
      set c = 21
      set udg_Quest_00_Note[P] = 40
    else
      call MSG(Player(P-1), 11, 8, "밀레스 마을"+BaseStr(14)+"에 있는 |cffffdc3c부자 노인"+BaseStr(14)+"에게서 퀘스트를 받고, 완수하세요. (3회 반복)")
      call Ping(Player(P-1), GetWidgetX(I2QU(4)), GetWidgetY(I2QU(4)), 4.)
    endif
  elseif ( udg_Quest_00_Note[P] == 40 ) then
    call MSG(Player(P-1), 11, 8, BaseStr(14) + "배울 수 있는 스킬 목록을 확인하세요. (단축키 5 - 4 혹은 O - W)")
  elseif ( udg_Quest_00_Note[P] == 41 ) then
    call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└900골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 조건을 확인한 후, O-E로 스킬을 배우러 갈 수 있습니다.")
    call MakeTestt(P, true, 900)
    set c = 22
    set udg_Quest_00_Note[P] = 42
  elseif ( udg_Quest_00_Note[P] == 42 ) then
    call MSG(Player(P-1), 11, 8, BaseStr(14) + "레벨 26을 달성하세요.")
    set udg_Quest_00_Note[P] = 43
  elseif ( udg_Quest_00_Note[P] == 43 ) then
    if ( GetHeroLevel(GetTriggerUnit()) >= 26 ) then
      if  ( GetHeroLevel(GetTriggerUnit()) > 40 ) then
        call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!! (레벨 스킵)")
        set c = 23
        set udg_Quest_00_Note[P] = 44
      else
      if ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "2" ) or ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "3" ) then
        call GiveItem(P, 'I072', 0)
        call GiveItem(P, 'I057', 0)
        call GiveItem(P, 'I06B', GetRandomInt(0,SysInt(0,29))*5+1)
        call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└격수용 각종 아이템을 받았습니다. (인벤토리)")
      elseif ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "4" ) or ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "5" ) then
        call GiveItem(P, 'I071', 0)
        call GiveItem(P, 'I057', 0)
        call GiveItem(P, 'I069', GetRandomInt(0,SysInt(0,29))*5+1)
        call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└비격수용 각종 아이템을 받았습니다. (인벤토리)")
      else
        call GiveItem(P, 'I072', 0)
        call GiveItem(P, 'I001', 0)
        call GiveItem(P, 'I06B', GetRandomInt(0,SysInt(0,29))*5+1)
        call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└무도가용 각종 아이템을 받았습니다. (인벤토리)")
      endif
      set c = 23
      set udg_Quest_00_Note[P] = 44
      
      call MSGAll(0, true, 1, 2, 7., "|c00ff8000NPC 푸잎|r : "+SysStr(2,P) + GetPlayerName(Player(P-1)) + "|cffffff00의 초보자 탈출을 축하, 축하!")
      call BuffTimerAdd(P, "Bella", -9999.)
      call BuffTimerAdd(P, "Ena", -9999.)
      call BuffTimerAdd(P, "Colla", -9999.)
      call BuffTimerAdd(P, "Horr", -9999.)
      call TriggerSleepAction(.2)
      call SetBuff(udg_Unit[P], "ENA", 1800., 20)
      call SetBuff(udg_Unit[P], "BELLA", 1800., 25)
      call SetBuff(udg_Unit[P], "COLLA", 1800., 10)
      call SetBuff(udg_Unit[P], "HORR", 1800., 50)
      call MSG(Player(P-1), 2, 4, "└보상으로 30분 지속 버프를 얻었습니다!")
      call TriggerSleepAction(.5)
      call MSG(Player(P-1), 2, 4, "|cffffdc3c푸잎의 축복으로...\n(30분동안 |cff46ffff받는 데미지|cffffdc3c가 |cff9932cc50% |cffffdc3c감소합니다.)\n(60분동안 |cff55ff55Dam|cffffdc3c이 |cff9932cc20 |cffffdc3c상승합니다.)\n(60분동안 |cff55ff55Hit|cffffdc3c이 |cff9932cc25 |cffffdc3c상승합니다.)\n(60분동안 |cff46ffff방어력|cffffdc3c이 |cff9932cc10 |cffffdc3c상승합니다.)\n")
    endif
    else
      call MSG(Player(P-1), 11, 8, BaseStr(14) + "레벨 26을 달성하세요.")
    endif
  elseif ( udg_Quest_00_Note[P] == 44 ) then
    call MSG(Player(P-1), 11, 8, BaseStr(14) + "마을 이동을 통해 피에트로 이동하세요. (단축키 O - R 후 4번)")
  elseif ( udg_Quest_00_Note[P] == 45 ) then
    call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└240골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 해당 기능을 통해 편리한 이동이 가능합니다.")
    call MakeTestt(P, true, 240)
    set c = 24
    set udg_Quest_00_Note[P] = 46
  elseif ( udg_Quest_00_Note[P] == 46 ) then
    call MSG(Player(P-1), 11, 8, "포테의 숲"+BaseStr(14)+"에서 몬스터를 30마리 사냥하세요.")
    set udg_Quest_00_Note[P] = 47
  elseif ( udg_Quest_00_Note[P] == 47 ) then
    if ( udg_Quest_ClearInt_00_47[P] >= 30 ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└경험치를 "+I2S(Lv_Exp(26)*15)+" 얻었습니다!\n　　"+BaseStr(11)+"※참고: 수오미의 촌장 퀘스트를 통해 희귀한 아이템을 획득할 수 있습니다.")
      call MakeTestt(P, false, Lv_Exp(26)*15)
      set c = 25
      set udg_Quest_00_Note[P] = 48
      
      if ( TitleGet(P, 7) < 3 ) then
        if ( udg_SysB_TitleNow[P] == 7 ) then
          call Title_Reset(P)
        endif
        call TitleSet(P, 7, 3)
        call MSG(Player(P-1), 1, 8, "칭호, |cff46ffff"+FCut(TITLEVALUE(7,3),1)+"|cffffdc3c을(를) 받았습니다. (기존 칭호 사라짐)")
      endif
    else
      call MSG(Player(P-1), 11, 8, "포테의 숲"+BaseStr(14)+"에서 몬스터를 30마리 사냥하세요.")
      call MSG(Player(P-1), 1, 8., "　　└현재 잡은 몬스터 수 : [ |cff46ffff" + I2S(udg_Quest_ClearInt_00_47[P]) + "|cffffdc3c / |cff9932cc30|cffffdc3c ]마리")
    endif
    
  elseif ( udg_Quest_00_Note[P] == 48 ) then
    call MSG(Player(P-1), 11, 8, BaseStr(14) + "레벨 41을 달성하세요.")
    set udg_Quest_00_Note[P] = 49
  elseif ( udg_Quest_00_Note[P] == 49 ) then
    if ( GetHeroLevel(GetTriggerUnit()) >= 41 ) then
      if  ( GetHeroLevel(GetTriggerUnit()) > 55 ) then
        call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!! (레벨 스킵)")
        set c = 26
        set udg_Quest_00_Note[P] = 50
      else
      if ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "2" ) then
        call GiveItem(P, 'I01E', GetRandomInt(0,SysInt(0,29))*5+1)
      elseif ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "3" ) then
        call GiveItem(P, 'I02G', GetRandomInt(0,SysInt(0,29))*5+1)
      elseif ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "4" ) then
        call GiveItem(P, 'I03L', GetRandomInt(0,SysInt(0,29))*5+1)
      elseif ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "5" ) then
        call GiveItem(P, 'I03D', GetRandomInt(0,SysInt(0,29))*5+1)
      else
        call GiveItem(P, 'I001', GetRandomInt(0,SysInt(0,29))*5+1)
      endif
      set c = 26
      set udg_Quest_00_Note[P] = 50
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n무작위 옵션(빛바랜)의 무기 아이템을 받았습니다!")
      endif
    else
      call MSG(Player(P-1), 11, 8, BaseStr(14) + "레벨 41을 달성하세요.")
    endif
  elseif ( udg_Quest_00_Note[P] == 50 ) then
    call MSG(Player(P-1), 11, 8, "명령어, |cffC1FFC1\"-오픈채팅\""+BaseStr(14)+"을 쳐보세요.")
  elseif ( udg_Quest_00_Note[P] == 51 ) then
    call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└1000골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 해당 채팅방에서 파티를 구하기 쉽습니다. 채널은 FLoD 입니다.")
    call MakeTestt(P, true, 1000)
    set c = 27
    set udg_Quest_00_Note[P] = 52
  elseif ( udg_Quest_00_Note[P] == 52 ) then
    call MSG(Player(P-1), 11, 8, "뤼케시온"+BaseStr(14)+" 중앙에 있는 |cffffdc3c촌장"+BaseStr(14)+"에게 퀘스트를 받으세요.")
    set udg_Quest_00_Note[P] = 53
  elseif ( udg_Quest_00_Note[P] == 53 ) then
    if ( Quest_Level(P, 7) != 0 ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└1500골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 해당 퀘스트는 연게 퀘스트입니다.")
      call MakeTestt(P, true, 1500)
      set c = 28
      set udg_Quest_00_Note[P] = 54
    elseif  ( GetHeroLevel(GetTriggerUnit()) > 70 ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!! (레벨 스킵)")
      set c = 29
      set udg_Quest_00_Note[P] = 56
    else
      call MSG(Player(P-1), 11, 8, "뤼케시온"+BaseStr(14)+" 중앙에 있는 |cffffdc3c촌장"+BaseStr(14)+"에게 퀘스트를 받으세요.")
    endif
  elseif ( udg_Quest_00_Note[P] == 54 ) then
    call MSG(Player(P-1), 11, 8, BaseStr(14)+"해당 퀘스트, |cffffdc3c해안가의 위협"+BaseStr(14)+"퀘스트를 완료하세요.")
    set udg_Quest_00_Note[P] = 55
  elseif ( udg_Quest_00_Note[P] == 55 ) then
    if ( Quest_Level(P, 7) != -1 ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└경험치를 "+I2S(Lv_Exp(56)*25)+" 얻었습니다!")
      call MakeTestt(P, false, Lv_Exp(56)*25)
      set c = 29
      set udg_Quest_00_Note[P] = 56
    else
      call MSG(Player(P-1), 11, 8, BaseStr(14)+"해당 퀘스트, |cffffdc3c해안가의 위협"+BaseStr(14)+"퀘스트를 완료하세요.")
      call MSG(Player(P-1), 1, 6., "|cff0080ff" + FCut(QuestName(7),1)+"|cffc3dbff의 진행도 : |cffffdc3c" + I2S(Quest_Level(P, 7)) + "|r / |cff0078ff" + FCut(QuestName(7),2) + "|cffc3dbff입니다.")
    endif
  elseif ( udg_Quest_00_Note[P] == 56 ) then
    call MSG(Player(P-1), 11, 8, BaseStr(14) + "레벨 56을 달성하세요.")
    set udg_Quest_00_Note[P] = 57
  elseif ( udg_Quest_00_Note[P] == 57 ) then
    if ( GetHeroLevel(GetTriggerUnit()) >= 56 ) then
      if  ( GetHeroLevel(GetTriggerUnit()) > 70 ) then
        call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!! (레벨 스킵)")
        set c = 30
        set udg_Quest_00_Note[P] = 58
      else
      if ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "2" ) then
        call GiveItem(P, 'I01E', GetRandomInt(0,SysInt(0,29))*5+2)
      elseif ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "3" ) then
        call GiveItem(P, 'I02G', GetRandomInt(0,SysInt(0,29))*5+2)
      elseif ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "4" ) then
        call GiveItem(P, 'I03L', GetRandomInt(0,SysInt(0,29))*5+2)
      elseif ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "5" ) then
        call GiveItem(P, 'I03D', GetRandomInt(0,SysInt(0,29))*5+2)
      else
        call GiveItem(P, 'I001', GetRandomInt(0,SysInt(0,29))*5+2)
      endif
      set c = 30
      set udg_Quest_00_Note[P] = 58
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n무작위 옵션(신비)의 무기 아이템을 받았습니다!")
      
      call MSGAll(0, true, 1, 2, 7., "|c00ff8000NPC 푸잎|r : "+SysStr(2,P) + GetPlayerName(Player(P-1)) + "|cffffff00의 입단은 언제나 환영이라구!")
      call BuffTimerAdd(P, "Bella", -9999.)
      call BuffTimerAdd(P, "Ena", -9999.)
      call BuffTimerAdd(P, "Colla", -9999.)
      call BuffTimerAdd(P, "Horr", -9999.)
      call TriggerSleepAction(.2)
      call SetBuff(udg_Unit[P], "ENA", 1800., 20)
      call SetBuff(udg_Unit[P], "BELLA", 1800., 25)
      call SetBuff(udg_Unit[P], "COLLA", 1800., 10)
      call SetBuff(udg_Unit[P], "HORR", 1800., 50)
      call MSG(Player(P-1), 2, 4, "└보상으로 30분 지속 버프를 얻었습니다!")
      call TriggerSleepAction(.5)
      call MSG(Player(P-1), 2, 4, "|cffffdc3c푸잎의 축복으로...\n(30분동안 |cff46ffff받는 데미지|cffffdc3c가 |cff9932cc50% |cffffdc3c감소합니다.)\n(60분동안 |cff55ff55Dam|cffffdc3c이 |cff9932cc20 |cffffdc3c상승합니다.)\n(60분동안 |cff55ff55Hit|cffffdc3c이 |cff9932cc25 |cffffdc3c상승합니다.)\n(60분동안 |cff46ffff방어력|cffffdc3c이 |cff9932cc10 |cffffdc3c상승합니다.)\n")
      if ( TitleGet(P, 7) < 4 ) then
        if ( udg_SysB_TitleNow[P] == 7 ) then
          call Title_Reset(P)
        endif
        call TitleSet(P, 7, 4)
        call MSG(Player(P-1), 1, 8, "칭호, |cff46ffff"+FCut(TITLEVALUE(7,4),1)+"|cffffdc3c을(를) 받았습니다. (기존 칭호 사라짐)")
      endif
      endif
    else
      call MSG(Player(P-1), 11, 8, BaseStr(14) + "레벨 56을 달성하세요.")
    endif
  elseif ( udg_Quest_00_Note[P] == 58 ) then
    call MSG(Player(P-1), 11, 8, BaseStr(14) + "여관으로 이동하세요 (단축키 8 - 4)")
    set udg_Quest_00_Note[P] = 59
  elseif ( udg_Quest_00_Note[P] == 59 ) then
    if ( RectContainsUnit(Vileage_Rect(15), udg_Unit[P]) ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└2000골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 여관은 재생력이 3배입니다.")
      call MakeTestt(P, true, 2000)
      set c = 31
      set udg_Quest_00_Note[P] = 60
    else
      call MSG(Player(P-1), 11, 8, BaseStr(14) + "여관으로 이동하세요 (단축키 8 - 4)")
    endif
  elseif ( udg_Quest_00_Note[P] == 60 ) then
    call MSG(Player(P-1), 11, 8, "우드랜드"+BaseStr(14)+"에 있는 |cffffdc3c지키미"+BaseStr(14)+"에게 퀘스트를 받으세요.\n　　"+BaseStr(11)+"※참고: 여관 우측 위로 나가면 우드랜드입니다.")
    set udg_Quest_00_Note[P] = 61
  elseif ( udg_Quest_00_Note[P] == 61 ) then
    if ( Quest_Level(P, 8) != 0 ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└경험치를 "+I2S(Lv_Exp(70)*20)+" 얻었습니다!")
      call MakeTestt(P, false, Lv_Exp(70)*20)
      set c = 32
      set udg_Quest_00_Note[P] = 62
    elseif  ( GetHeroLevel(GetTriggerUnit()) > 80 ) then
        call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!! (레벨 스킵)")
        set c = 32
        set udg_Quest_00_Note[P] = 62
      else
      call MSG(Player(P-1), 11, 8, "우드랜드"+BaseStr(14)+"에 있는 |cffffdc3c지키미"+BaseStr(14)+"에게 퀘스트를 받으세요.\n　　"+BaseStr(11)+"※참고: 여관 우측 위로 나가면 우드랜드입니다.")
    endif
  elseif ( udg_Quest_00_Note[P] == 62 ) then
    call MSG(Player(P-1), 11, 8, BaseStr(14) + "레벨 71을 달성하세요.")
    set udg_Quest_00_Note[P] = 63
  elseif ( udg_Quest_00_Note[P] == 63 ) then
    if ( GetHeroLevel(GetTriggerUnit()) >= 71 ) then
      if  ( GetHeroLevel(GetTriggerUnit()) > 85 ) then
        call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!! (레벨 스킵)")
        set c = 33
        set udg_Quest_00_Note[P] = 64
      else
      if ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "2" ) then
        call GiveItem(P, 'I01H', GetRandomInt(0,SysInt(0,29))*5+1)
      elseif ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "3" ) then
        call GiveItem(P, 'I02I', GetRandomInt(0,SysInt(0,29))*5+1)
      elseif ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "4" ) then
        call GiveItem(P, 'I03I', GetRandomInt(0,SysInt(0,29))*5+1)
      elseif ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "5" ) then
        call GiveItem(P, 'I039', GetRandomInt(0,SysInt(0,29))*5+1)
      else
        call GiveItem(P, 'I080', GetRandomInt(0,SysInt(0,29))*5+1)
      endif
      set c = 33
      set udg_Quest_00_Note[P] = 64
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n무작위 옵션(빛바랜)의 무기 아이템을 받았습니다!")
      call MSGAll(0, true, 1, 2, 7., "|c00ff8000NPC 푸잎|r : "+SysStr(2,P) + GetPlayerName(Player(P-1)) + "|cffffff00가 제법 열심인걸? 축하해!")
      call BuffTimerAdd(P, "Bella", -9999.)
      call BuffTimerAdd(P, "Ena", -9999.)
      call BuffTimerAdd(P, "Colla", -9999.)
      call BuffTimerAdd(P, "Horr", -9999.)
      call TriggerSleepAction(.2)
      call SetBuff(udg_Unit[P], "ENA", 1800., 20)
      call SetBuff(udg_Unit[P], "BELLA", 1800., 25)
      call SetBuff(udg_Unit[P], "COLLA", 1800., 10)
      call SetBuff(udg_Unit[P], "HORR", 1800., 50)
      call MSG(Player(P-1), 2, 4, "└보상으로 30분 지속 버프를 얻었습니다!")
      call TriggerSleepAction(.5)
      call MSG(Player(P-1), 2, 4, "|cffffdc3c푸잎의 축복으로...\n(30분동안 |cff46ffff받는 데미지|cffffdc3c가 |cff9932cc50% |cffffdc3c감소합니다.)\n(60분동안 |cff55ff55Dam|cffffdc3c이 |cff9932cc20 |cffffdc3c상승합니다.)\n(60분동안 |cff55ff55Hit|cffffdc3c이 |cff9932cc25 |cffffdc3c상승합니다.)\n(60분동안 |cff46ffff방어력|cffffdc3c이 |cff9932cc10 |cffffdc3c상승합니다.)\n")
      endif
    else
      call MSG(Player(P-1), 11, 8, BaseStr(14) + "레벨 71을 달성하세요.\n　　"+BaseStr(11)+"※추천 사냥터: 해안가, 우드랜드 VII 부근, 지하묘지 4층 부근")
    endif
  elseif ( udg_Quest_00_Note[P] == 64 ) then
    call MSG(Player(P-1), 11, 8, "호엔 - 조화의던전"+BaseStr(14)+"의 입구에 가서 입장 조건을 확인하세요.")
  elseif ( udg_Quest_00_Note[P] == 65 ) then
    call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n└3000골드를 받았습니다!\n　　"+BaseStr(11)+"※참고: 해당 던전은 파티 던전으로, 강력한 드랍템을 드랍합니다.\n　　　"+BaseStr(11)+"※참고2: 파티원은 명령어, |cffC1FFC1\"-오픈채팅\""+BaseStr(14)+"에서 쉽게 구할 수 있습니다.")
    call MakeTestt(P, true, 3000)
    set c = 34
    set udg_Quest_00_Note[P] = 66
  elseif ( udg_Quest_00_Note[P] == 66 ) then
    call MSG(Player(P-1), 11, 8, BaseStr(14) + "레벨 98을 달성하세요.")
    set udg_Quest_00_Note[P] = 67
  elseif ( udg_Quest_00_Note[P] == 67 ) then
    if ( GetHeroLevel(GetTriggerUnit()) >= 98 ) then
      if  ( GetHeroLevel(GetTriggerUnit()) > 98 ) then
        call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!! (레벨 스킵)")
        set c = 35
        set udg_Quest_00_Note[P] = 68
      else
      if ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "2" ) then
        call GiveItem(P, 'I01H', GetRandomInt(0,SysInt(0,29))*5+2)
      elseif ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "3" ) then
        call GiveItem(P, 'I02I', GetRandomInt(0,SysInt(0,29))*5+2)
      elseif ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "4" ) then
        call GiveItem(P, 'I03I', GetRandomInt(0,SysInt(0,29))*5+2)
      elseif ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "5" ) then
        call GiveItem(P, 'I039', GetRandomInt(0,SysInt(0,29))*5+2)
      else
        call GiveItem(P, 'I080', GetRandomInt(0,SysInt(0,29))*5+2)
      endif
      set c = 35
      set udg_Quest_00_Note[P] = 68
      call MakeTestt(P, false, 1000000)
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!|r\n무작위 옵션(신비한)의 무기 아이템과 경험치를 1M(백만) 받았습니다!")
      endif
    else
      call MSG(Player(P-1), 11, 8, BaseStr(14) + "레벨 98을 달성하세요.\n　　"+BaseStr(11)+"※추천 사냥터: 조화의던전, 우드랜드(오두막) 부근, 해안가, 지하묘지 4.5~5층 부근")
    endif
  elseif ( udg_Quest_00_Note[P] == 68 ) then
    call MSG(Player(P-1), 11, 8, BaseStr(14) + "99를 달성하고 호러캐슬로 이동하세요.")
    set udg_Quest_00_Note[P] = 69
  elseif ( udg_Quest_00_Note[P] == 69 ) then
    if ( RectContainsUnit(Vileage_Rect(2), udg_Unit[P]) ) then
      call MSG(Player(P-1), 2, 12, "|cffff8040" + I2S(c)+ BaseStr(11) + "번째 퀘스트 완료!!")
      call TriggerSleepAction(1.)
      call MSGAll(0, true, 1, 2, 7., "|c00ff8000NPC 푸잎|r : "+SysStr(2,P) + GetPlayerName(Player(P-1)) + "|cffffff00의 초보자 탈출을 축하, 축하!")
      call BuffTimerAdd(P, "Bella", -9999.)
      call BuffTimerAdd(P, "Ena", -9999.)
      call BuffTimerAdd(P, "Colla", -9999.)
      call BuffTimerAdd(P, "Horr", -9999.)
      call TriggerSleepAction( 0.20 )
      call SetBuff(udg_Unit[P], "ENA", 1800., 20)
      call SetBuff(udg_Unit[P], "BELLA", 1800., 25)
      call SetBuff(udg_Unit[P], "COLLA", 1800., 10)
      call SetBuff(udg_Unit[P], "HORR", 1800., 50)
      call MSG(Player(P-1), 2, 4, "└보상으로 30분 지속 버프를 얻었습니다!")
      call TriggerSleepAction(.5)
      call MSG(Player(P-1), 2, 4, "|cffffdc3c푸잎의 축복으로...\n(30분동안 |cff46ffff받는 데미지|cffffdc3c가 |cff9932cc50% |cffffdc3c감소합니다.)\n(60분동안 |cff55ff55Dam|cffffdc3c이 |cff9932cc20 |cffffdc3c상승합니다.)\n(60분동안 |cff55ff55Hit|cffffdc3c이 |cff9932cc25 |cffffdc3c상승합니다.)\n(60분동안 |cff46ffff방어력|cffffdc3c이 |cff9932cc10 |cffffdc3c상승합니다.)\n")
      if ( TitleGet(P, 7) < 5 ) then
        if ( udg_SysB_TitleNow[P] == 7 ) then
          call Title_Reset(P)
        endif
        call TitleSet(P, 7, 5)
        call MSG(Player(P-1), 1, 8, "칭호, |cff46ffff"+FCut(TITLEVALUE(7,5),1)+"|cffffdc3c을(를) 받았습니다. (기존 칭호 사라짐)")
      endif
      set c = -1
      set udg_Quest_00_Note[P] = -1
      
      call UnitRemoveAbility(udg_Unit[P], 'A03Q')
    else
      call MSG(Player(P-1), 11, 8, BaseStr(14) + "99를 달성하고 호러캐슬로 이동하세요.")
    endif
  else
    call MSG(Player(P-1), -1, 8, "지침서 / " + I2S(udg_Quest_00_Note[P]) )
  endif
  if ( c < 0 ) or ( udg_Quest_00_Note[P] < 0 )then
    call MinusItem(P, 'I09V', 999)
  else
    call MinusItem(P, 'I09V', CountItem(P, 'I09V')-c)
    call SaveInteger(udg_hash, StringHash("QLevel0"), P, c)
  endif
endfunction

function Quest_Note takes nothing returns nothing
  call Quest_Note2(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1)
endfunction

//===========================================================================
function InitTrig_Quest_00_Note takes nothing returns nothing
  set gg_trg_Quest_00_Note = CreateTrigger()
  call TriggerAddAction(gg_trg_Quest_00_Note, function Quest_Note)
endfunction

//===========================================================================
// Trigger: Inventory
//
//                   set LastSelected = -1
//                   set AreYouPickUp = false
//                   call DzFrameShow(f2, false)
//                   call DzFrameShow(f3, false)
//     // 버튼 다시 활성화
//     if GetLocalPlayer() == p then
//       call DzFrameSetEnable(DzFrameFindByName("InVe_Slot", fid), true)
//       set RightClickEnable = true
//     endif
//===========================================================================
native DzFrameShow takes integer frame, boolean enable returns nothing
native DzGetGameUI takes nothing returns integer

native JNStringLength takes string str returns integer
native DzGetMouseXRelative takes nothing returns integer
native DzTriggerRegisterKeyEventByCode takes trigger trig, integer key, integer status, boolean sync, code funcHandle returns nothing
native DzGetTriggerKeyPlayer takes nothing returns player
native DzTriggerRegisterMouseEventByCode takes trigger trig, integer btn, integer status, boolean sync, code funcHandle returns nothing

native DzFrameSetTexture takes integer frame, string texture, integer flag returns nothing
native DzFrameSetModel takes integer frame, string modelFile, integer modelType, integer flag returns nothing
native DzFrameGetText takes integer frame returns string


globals
constant integer JN_OSKEY_I = 0x49
constant integer JN_MOUSE_BUTTON_TYPE_LEFT = 0x1
constant integer JN_MOUSE_BUTTON_TYPE_MIDDLE = 0x2
constant integer FMI_MAX_INVENTORY = 28
         integer array FMI_add_Inventory
constant integer FMI_MAXMAX_INVENTORY = 56 /* 이 번호부터 장비 취급 */
trigger gg_trg_FMi_GetItem = CreateTrigger()
constant integer JN_FRAMEPOINT_BOTTOMRIGHT = 8
constant integer JN_FRAMEPOINT_TOPLEFT = 0
constant integer JN_FRAMEPOINT_BOTTOMLEFT = 6
constant integer JN_FRAMEEVENT_MOUSE_ENTER = 2
constant integer JN_FRAMEEVENT_MOUSE_LEAVE = 3
endglobals

static if false then
  #추후 아이템도 수정한다면...
  - 아이템 강화 수치 용그처럼 별달아주기
  - 아이템 등급에 따른 테두리
  - 인벤토리에 소모품 더블클릭 사용?
  - 인벤토리에 갯수중첩되는 템 중첩수 표기, 습득 시 자동 중첩?
endif
scope Inventory initializer OnInit
// 변수 선언 ====================================================================================================
globals
  // 플레이어마다 다른 값을 가지는 변수들
  public boolean Visility = false /* 프레임 보임/안보임 논리값 :: EquipSlot 연동 */
  public boolean AreYouPickUp = false /* 아이템을 현재 쥐고 있는지 논리값 :: EquipSlot 연동 */
  public boolean Drag = false /* 좌클릭중인지/아닌지 논리값 :: MouseInCommon 연동 */
  public boolean Snap = false /* 스냅용 공간에 마우스 들어감 :: MouseInCommon 연동 */
  public integer MouseMode = 0 /* 미니 아이콘 - 버리기 활성화/비활성화 논리값 :: MouseInCommon */
  /* 0 - 기본, 1 - 제련취소, 2 - 제련, 3 - 버리기, 4 - 판매 */
  public boolean array FrameIn /* 해당 칸 안에 마우스 들어감 (우클릭 감지용) :: MouseInCommon 연동 */
  public integer LastSelected = -1 /* 마지막으로 찝은 인벤토리 칸 번호 */
  
  public item temp_item /* 공통 변수 */
endglobals

private function DataUp takes string s returns string
 local string s_return = ""
 local string s_short = ""
 local integer loopA = 1

  loop
    set s_short = JNStringSplit(s,"|",loopA)
    exitwhen s_short == "" or s_short == null
    if ( s_return == "" ) then
      set s_return = IData(SubString(s_short,0,1)) + " " + SubString(s_short,1,StringLength(s_short))
    else
      set s_return = s_return + "\n" + IData(SubString(s_short,0,1)) + " " + SubString(s_short,1,StringLength(s_short))
    endif
    set loopA = loopA + 1
  endloop
  
  return s_return
endfunction
private function DataUpScrol takes boolean all, integer itco returns string
  local string s_return = ""
  if ( all ) then
    set s_return = "|cff0078ff강화 성공 확률(|cff55ff55"+"모든 종류|cff0078ff)|r:"
    set s_return = s_return + "\n+0에서 +1: |cff55ff55"+I2S(R2I(ScrolRatio(isNamed(itco,false),0,true)))+"% (랜덤 옵션)"
    set s_return = s_return + "\n+1에서 +2: |cff55ff55"+I2S(R2I(ScrolRatio(isNamed(itco,false),1,true)))+"%"
    set s_return = s_return + "\n+2에서 +3: |cff55ff55"+I2S(R2I(ScrolRatio(isNamed(itco,false),2,true)))+"%"
    set s_return = s_return + "\n+4에서 +5: |cff55ff55"+R2SW(ScrolRatio(isNamed(itco,false),4,true),2,2)+"%"
  else
    set s_return = "|cff0078ff강화 성공 확률(|cff55ff55"+JNStringTrim(GetNamed2(isNamed(itco,true)))+"|r/|cff87f264다른|cff0078ff)|r:"
    set s_return = s_return + "\n+0에서 +1: |cff55ff55"+I2S(R2I(ScrolRatio(isNamed(itco,false),0,true)))+"%|r/|cff87f264"+R2SW(ScrolRatio(isNamed(itco,false),0,false),2,1)+"%"
    set s_return = s_return + "\n+1에서 +2: |cff55ff55"+I2S(R2I(ScrolRatio(isNamed(itco,false),1,true)))+"%|r/|cff87f264"+R2SW(ScrolRatio(isNamed(itco,false),1,false),2,1)+"%"
    set s_return = s_return + "\n+2에서 +3: |cff55ff55"+I2S(R2I(ScrolRatio(isNamed(itco,false),2,true)))+"%|r/|cff87f264"+R2SW(ScrolRatio(isNamed(itco,false),2,false),2,1)+"%"
    set s_return = s_return + "\n+3에서 +4: |cff55ff55"+R2SW(ScrolRatio(isNamed(itco,false),3,true),2,1)+"%|r/|cff87f264"+R2SW(ScrolRatio(isNamed(itco,false),3,false),2,2)+"%"
    set s_return = s_return + "\n+4에서 +5: |cff55ff55"+R2SW(ScrolRatio(isNamed(itco,false),4,true),2,2)+"%|r/|cff87f264"+R2SW(ScrolRatio(isNamed(itco,false),4,false),2,2)+"%"
  endif
  return s_return
endfunction
private function DataDown takes integer itid, integer co returns string
 local string s = ""
 local string s_return = ""
 local string s_short = ""
 local integer loopA = 1
  if ( EXExecuteScript2("item", itid, "class") == "Miscellaneous" ) then
    return EXExecuteScript2("item", itid, "Description")
  elseif ( co == 0 ) then
    return EXExecuteScript2("item", itid, "Ubertip")
  else
    set s_return = EXExecuteScript2("item", itid, "Ubertip")
    if ( s_return != "" ) then
      set s_return = s_return + "\n"
    endif
    set s_return = s_return + "|cff0078ff" + GetNamed1(isNamed(co,false),true) + GetNamed2(isNamed(co,true)) + "힘|r: "
    
    set s = GetNamed5(co)
  endif
 
  loop
    set s_short = JNStringSplit(s,"|",loopA)
    exitwhen s_short == "" or s_short == null
    
    if ( SubString(s_short,0,1) == "o" ) then
      set loopA = loopA + 1
      set s_short = JNStringSplit(s,"|",loopA)
      set s_return = s_return + "\n|cff8080ff" + SubString(s_short,1,StringLength(s_short))
    else
      set s_return = s_return + "\n" + IData(SubString(s_short,0,1)) + " " + SubString(s_short,1,StringLength(s_short))
    endif
    set loopA = loopA + 1
  endloop
  
  return s_return
endfunction

// 아이템 설명 새로고침 :: EquipSlot 연동 ====================================================================================================
public function RefreshItemDes takes integer P, integer itid, integer f, boolean bol returns nothing
  local integer f2 = DzFrameFindByName("InVe_DesBack", 0)
  local integer f3
  local integer temp
  local integer i
  local integer lv = Inventory_IC2B(S2I(EXExecuteScript2("item", itid, "oldLevel")))
  local integer fid = LoadInteger(udg_hash, f, StringHash("number"))
  local integer itco = GetItemCharges(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid))

if ( GetLocalPlayer() == Player(P-1) ) then
  // 아이템 설명 이동
  call DzFrameSetPoint(f2, JN_FRAMEPOINT_TOPLEFT, f, JN_FRAMEPOINT_TOPRIGHT, 0.01, 0.022)

  // 아이템 설명 갱신
  call DzFrameSetTexture(DzFrameFindByName("InVe_DesIcon", 0), EXExecuteScript2("item", itid, "Art"), 0)
  call DzFrameSetText(DzFrameFindByName("InVe_DesClass", 0), ItemName(itid, itco, true)) /* 직업, [종류] Lv.00 */
  if ( EXExecuteScript2("item", itid, "stockMax") == "8" ) then
    call DzFrameSetText(DzFrameFindByName("InVe_DesOpt", 0), DataUpScrol(ScrolData(itid)==-1, itco))
  else
    call DzFrameSetText(DzFrameFindByName("InVe_DesOpt", 0), DataUp(LoadStr(udg_hash, itid, StringHash("FMi-Val"))))
  endif
  if ( fid > FMI_MAXMAX_INVENTORY ) then
    /* 장비에 마우스 댔을때 */
    set itco = LoadInteger(udg_hash, P, StringHash("Sitco") + fid)
    call DzFrameSetText(DzFrameFindByName("InVe_DesName", 0), ItemName(itid, itco, false))
    call DzFrameSetText(DzFrameFindByName("InVe_DesInf", 0), DataDown(itid, itco))
  else
    call DzFrameSetText(DzFrameFindByName("InVe_DesName", 0), ItemName(itid, itco, false))
    call DzFrameSetText(DzFrameFindByName("InVe_DesInf", 0), DataDown(itid, itco))
  endif
  call DzFrameSetSize(f2, 0.09, 0.12 + (JNStringCount(DzFrameGetText(DzFrameFindByName("InVe_DesOpt", 0))+DzFrameGetText(DzFrameFindByName("InVe_DesInf", 0)), "\n")) * 0.009)
  call DzFrameShow(f2, true)
  
  // EquipSlot연동 :: 아이템칸에 마우스 갖다댈 시 대응 부위 표시용 이펙트, if 조건은 장착칸인지 인벤토리인지 비교
  if bol then
    set f3 = DzFrameFindByName("EqSl_Active", 0) /* EquipSlot 연동 */
    call DzFrameShow(f3, true)
    call DzFrameSetPoint(f3, JN_FRAMEPOINT_CENTER, DzFrameFindByName("EqSl_Slot", lv), JN_FRAMEPOINT_CENTER, 0, 0)
  
    // 현재 보고있는 인벤토리 내 장비와 같은 부위의 장비를 착용중일 시, 해당 장비의 설명을 불러옴
    if LoadBoolean(udg_hash, P, StringHash("Sbol") + lv) then
      set f3 = DzFrameFindByName("EqSl_DesBack", 0)
      call DzFrameShow(f3, true)
      call DzFrameSetPoint(f3, JN_FRAMEPOINT_LEFT, f2, JN_FRAMEPOINT_RIGHT, 0.01, 0)
      set itid = LoadInteger(udg_hash, P, StringHash("Sitid") + lv)
      set itco = LoadInteger(udg_hash, P, StringHash("Sitco") + lv)
      // 아이템 설명 갱신
      call DzFrameSetTexture(DzFrameFindByName("EqSl_DesIcon", 0), EXExecuteScript2("item", itid, "Art"), 0)
      call DzFrameSetText(DzFrameFindByName("EqSl_DesName", 0), ItemName(itid, itco, false))
      call DzFrameSetText(DzFrameFindByName("EqSl_DesClass", 0), ItemName(itid, itco, true)) /* 직업, [종류] Lv.00 */

      call DzFrameSetText(DzFrameFindByName("EqSl_DesOpt", 0), DataUp(LoadStr(udg_hash, itid, StringHash("FMi-Val"))))
      call DzFrameSetText(DzFrameFindByName("EqSl_DesInf", 0), DataDown(itid, itco))
      
      call DzFrameSetSize(f3, 0.09, 0.12 + (JNStringCount(DzFrameGetText(DzFrameFindByName("EqSl_DesOpt", 0))+DzFrameGetText(DzFrameFindByName("EqSl_DesInf", 0)), "\n")) * 0.009)
    endif
  endif
endif
endfunction

// 마우스 들어감 ====================================================================================================
private function MouseEnter takes nothing returns nothing
  local integer P = GetPlayerId(DzGetTriggerUIEventPlayer())+1
  local integer f = DzGetTriggerUIEventFrame()
  local integer fid = LoadInteger(udg_hash, f, StringHash("number"))
  local integer itid = LoadInteger(udg_hash, P, StringHash("itid") + fid)
  
  // 들어옴 논리값 true
  set FrameIn[fid] = true
  
  if LoadBoolean(udg_hash, P, StringHash("bol") + fid) and not AreYouPickUp then
  // 아이템 설명 보임, 이동
    call RefreshItemDes(P, itid, f, (EXExecuteScript2("item", itid, "class") != "Miscellaneous"))
  endif
endfunction

// 마우스 나감 ====================================================================================================
private function MouseLeave takes nothing returns nothing
  local integer i
  call DzFrameShow(DzFrameFindByName("InVe_DesBack", 0), false)
  call DzFrameShow(DzFrameFindByName("EqSl_DesBack", 0), false)
  set FrameIn[LoadInteger(udg_hash, DzGetTriggerUIEventFrame(), StringHash("number"))] = false
  // EquipSlot연동 :: 아이템칸에 마우스 갖다댈 시 대응 부위 표시용 이펙트
  if not AreYouPickUp then
    call DzFrameShow(DzFrameFindByName("EqSl_Active", 0), false)
  endif
endfunction

// 동기화 :: 아이템을 찝은 채 다른 칸을 눌러 자리 교체 ====================================================================================================
private function SyncMLCI takes nothing returns nothing
  local integer P = GetPlayerId(DzGetTriggerSyncPlayer())+1
  local string data = DzGetTriggerSyncData()
  local integer last = S2I(JNStringSplit(data, "/", 0)) /* 이전 번호 - 주문서 */
  local integer fid = S2I(JNStringSplit(data, "/", 1))  /* 현재 번호 - 아이템 */
  local integer temp = S2I(JNStringSplit(data, "/", 2)) /* 현재 아이템 itid */
  local integer itid_last = LoadInteger(udg_hash, P, StringHash("itid") + last)
  local integer co_last = isNamed(GetItemCharges(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last)),false)
  
  set temp_item = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid)
  if not ( LoadBoolean(udg_hash, StringHash("LoadItem"), GetHandleId(temp_item)) and LoadBoolean(udg_hash, StringHash("LoadItem"), GetHandleId(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last))) ) then
    if ( ScrolData(itid_last) == -1 ) and ( GetRandomReal(0.,100.) <= ScrolRatio(isNamed(co_last,false),isNamed(GetItemCharges(temp_item),false),true) ) then
    call MSG(Player(P-1),2,5,"+"+I2S(isNamed(GetItemCharges(temp_item),false))+" |c00ffff00" + GetItemName(temp_item) + BaseStr(11) + "가 한 순간 파랗게 빛납니다.")
      if ( GetItemCharges(temp_item) == 0 ) then
        call SetItemCharges(temp_item, (GetRandomInt(0,SysInt(0,29))*5)+isNamed(co_last,false))
      else
        call SetItemCharges(temp_item, GetItemCharges(temp_item)+IMaxBJ(1,isNamed(co_last,false)-isNamed(co_last,false)))
      endif
      call CongraItem(P, temp_item)
    elseif ( GetRandomReal(0.,100.) <= ScrolRatio(isNamed(co_last,false),isNamed(GetItemCharges(temp_item),false),isNamed(co_last,true)==isNamed(GetItemCharges(temp_item),true)) ) then
      call MSG(Player(P-1),2,5,"+"+I2S(isNamed(GetItemCharges(temp_item),false))+" |c00ffff00" + GetItemName(temp_item) + BaseStr(11) + "가 한 순간 파랗게 빛납니다.")
      if ( GetItemCharges(temp_item) == 0 ) then
        call SetItemCharges(temp_item, co_last)
      else
        call SetItemCharges(temp_item, GetItemCharges(temp_item)+IMaxBJ(1,isNamed(co_last,false)-isNamed(GetItemCharges(temp_item),false)))
      endif
      call CongraItem(P, temp_item)
    else
      call MSG(Player(P-1),2,5,"+"+I2S(isNamed(GetItemCharges(temp_item),false))+" |c00ffff00" + GetItemName(temp_item) + BaseStr(11) + "가 강렬하게 파랗게 빛났지만 주문서만 증발 하였습니다.")
      call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl", LoadReal(udg_hash, udg_temp_i, StringHash("tr-x")), LoadReal(udg_hash, udg_temp_i, StringHash("tr-y"))))
    endif
    call RemoveItem(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last))
    call InvenClear(P, last)
    
    call SaveInteger(udg_hash, P, StringHash("itco") + fid, GetItemCharges(temp_item))
    call RefreshItemDes(P, temp, DzFrameFindByName("InVe_Slot", fid), (EXExecuteScript2("item", temp, "class") != "Miscellaneous"))
  else
    call MSG(Player(P-1),1,5,"세이브하지 않았거나(장비), 세이브되지 않은(주문서)로만 제련이 가능합니다.")
    if ( LoadBoolean(udg_hash, StringHash("LoadItem"), GetHandleId(temp_item)) ) then
      call MSG(Player(P-1),1,5,"로드된 아이템입니다. 새로 습득한 장비를 주문서로 만들어 제련할 수 있습니다.")
    elseif ( LoadBoolean(udg_hash, StringHash("LoadItem"), GetHandleId(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last))) ) then
      call MSG(Player(P-1),1,5,"로드된 장비로 만든 주문서입니다. 새로 습득한 장비에만 제련할 수 있습니다.")
    else
      set temp_item = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last)
      call RemoveItem(temp_item)
      call InvenClear(P, last)
    endif
  endif
  
endfunction

// 동기화 :: 아이템을 찝은 채 다른 칸을 눌러 자리 교체 ====================================================================================================
private function SyncMCEA takes nothing returns nothing
  local integer P = GetPlayerId(DzGetTriggerSyncPlayer())+1
  local string data = DzGetTriggerSyncData()
  local integer last = S2I(JNStringSplit(data, "/", 0))
  local integer fid = S2I(JNStringSplit(data, "/", 1))
  local integer temp = S2I(JNStringSplit(data, "/", 2))
  set temp_item = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid)
  call SaveInteger(udg_hash, P, StringHash("itid") + fid, LoadInteger(udg_hash, P, StringHash("itid") + last))
  call SaveInteger(udg_hash, P, StringHash("itco") + fid, LoadInteger(udg_hash, P, StringHash("itco") + last))
  //call SaveStr(udg_hash, P, StringHash("itname") + fid, LoadStr(udg_hash, P, StringHash("itname") + last))
  call SaveItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid, LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last))
  call SaveInteger(udg_hash, P, StringHash("itid") + last, temp)
  call SaveInteger(udg_hash, P, StringHash("itco") + last, GetItemCharges(temp_item))
  //call SaveStr(udg_hash, P, StringHash("itname") + last, ItemName(temp, GetItemCharges(temp_item), true))
  call SaveItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid, temp_item)

  call RefreshItemDes(P, temp, DzFrameFindByName("InVe_Slot", fid), (EXExecuteScript2("item", temp, "class") != "Miscellaneous"))
endfunction
// 동기화 :: 버리기 모드 중 눌러서 버리기 ====================================================================================================
private function SyncMCT takes nothing returns nothing
  local player p = DzGetTriggerSyncPlayer()
  local integer P = GetPlayerId(p)+1
  local integer fid = S2I(DzGetTriggerSyncData())
  set temp_item = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid)

  // 템 생성해 소유주 넣고 버리기
  //call SetItemPlayer(CreateItem(LoadInteger(udg_hash, P, StringHash("itid") + fid), GetUnitX(udg_Unit[pid]), GetUnitY(udg_Unit[pid])), p, false)
  call SetItemPosition(temp_item, GetUnitX(udg_Unit[P]), GetUnitY(udg_Unit[P]))
  call SetItemVisible(temp_item, true)
        
  // 해쉬 비우기
  call RemoveSavedBoolean(udg_hash, P, StringHash("bol") + fid)
  call RemoveSavedInteger(udg_hash, P, StringHash("itid") + fid)
  call RemoveSavedInteger(udg_hash, P, StringHash("itco") + fid)
  //call RemoveSavedString(udg_hash, P, StringHash("itname") + fid)
  call RemoveSavedHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid)
  
  set p = null
endfunction
// 동기화 :: 아이템 자리 옮기기 ====================================================================================================
private function SyncMCM takes nothing returns nothing
  local integer P = GetPlayerId(DzGetTriggerSyncPlayer())+1
  local string data = DzGetTriggerSyncData()
  local integer fid = S2I(JNStringSplit(data, "/", 0))
  local integer last = S2I(JNStringSplit(data, "/", 1))
  call SaveBoolean(udg_hash, P, StringHash("bol") + fid, true)
  call SaveInteger(udg_hash, P, StringHash("itid") + fid, LoadInteger(udg_hash, P, StringHash("itid") + last))
  call SaveInteger(udg_hash, P, StringHash("itco") + fid, LoadInteger(udg_hash, P, StringHash("itco") + last))
  
  set temp_item = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last)
  //call SaveStr(udg_hash, P, StringHash("itname") + last, ItemName(LoadInteger(udg_hash, P, StringHash("itid") + last), GetItemCharges(temp_item), true))
  call SaveItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid, temp_item)
  
  call RefreshItemDes(P, LoadInteger(udg_hash, P, StringHash("itid") + last), DzFrameFindByName("InVe_Slot", fid), (EXExecuteScript2("item", LoadInteger(udg_hash, P, StringHash("itid") + last), "class") != "Miscellaneous"))
  
  call RemoveSavedBoolean(udg_hash, P, StringHash("bol") + last)
  call RemoveSavedInteger(udg_hash, P, StringHash("itid") + last)
  call RemoveSavedInteger(udg_hash, P, StringHash("itco") + last)
  //call RemoveSavedString(udg_hash, P, StringHash("itname") + last)
  call RemoveSavedHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last)
endfunction

private constant function ILv takes string s returns integer
//아이템 데이터
  if ( s == "1" ) then
    return 1
  elseif ( s == "2" ) then
    return 11
  elseif ( s == "3" ) then
    return 26
  elseif ( s == "4" ) then
    return 41
  elseif ( s == "5" ) then
    return 56
  elseif ( s == "6" ) then
    return 71
  elseif ( s == "7" ) then
    return 86
  elseif ( s == "8" ) then
    return 99
  else
    return 999
  endif
endfunction
private constant function ClassCheck takes integer my, integer itcs, integer precs returns boolean
  return not ( ( itcs == 0 ) or ( itcs == my ) or ( itcs == precs ) or ( ( itcs == 7 and my != 6 ) ) )
endfunction
private constant function ItemClassName takes string I returns string
  if ( I == "2" ) then
    return "전사의 "
  elseif ( I == "3" ) then
    return "도적의 "
  elseif ( I == "4" ) then
    return "마법사의 "
  elseif ( I == "5" ) then
    return "성직자의 "
  elseif ( I == "6" ) then
    return "무도가의 "
  elseif ( I == "7" ) then
    return "무도가는 착용할 수 없는 "
  else
    return ""
  endif
endfunction

public function EquipCheck takes integer itid, integer P, integer itco returns boolean
  /* 클래스가 기타 아이템, 장착 불가 */
if ( GetLocalPlayer() == Player(P-1) ) then
  if ( EXExecuteScript2("item", itid, "class") == "Miscellaneous" ) then
    call MSG(Player(P-1), 1, 3, "장비가 아닙니다.")
    
  /* 직업 비교 (이전직업 포함) */
  elseif ( ClassCheck(udg_SysI_NowJob[P], S2I(SubString(LoadStr(udg_hash, itid, StringHash("FMi-Val")),0,1)), udg_SysI_PreJob[P]) ) then
    call MSG(Player(P-1),1,6,"직업이 맞지 않습니다. "+ItemClassName(SubString(LoadStr(udg_hash, itid, StringHash("FMi-Val")),0,1))+"아이템입니다.")
  
  /* 레벨 비교 */
  elseif ( udg_SysB_Level[P] < ILv(SubString(LoadStr(udg_hash, itid, StringHash("FMi-Val")),3,4)) ) and ( udg_SysI_PreJob[P] < 0 ) then
    call MSG(Player(P-1), 1, 3, "레벨이 부족합니다. (|c00ffff00Lv."+I2S(ILv(SubString(LoadStr(udg_hash, itid, StringHash("FMi-Val")),3,4)))+BaseStr(11)+" 이상)|r")
  
  /* 양손무기 장착시, 방패가 있을때 */
  elseif ( ISTWOHAND(EXExecuteScript2("item", itid, "oldLevel")) ) and ( LoadBoolean(udg_hash, P, StringHash("Sbol") + 6 + FMI_MAXMAX_INVENTORY) ) then
    call MSG(Player(P-1), 1, 3, "양손무기 장착을 위해서, 방패를 먼저 장착 해제해주세요.")
  
  /* 방패 장착시, 양손무기가 있을때 */
  elseif ( EXExecuteScript2("item", itid, "oldLevel") == "10" ) and ( LoadBoolean(udg_hash, StringHash("FMi_2Hand"), P) ) then
    call MSG(Player(P-1), 1, 3, "방패 장착을 위해서, 양손무기를 먼저 장착 해제해주세요.")
  
  /*/* 중복 장착 체크 */ - 즉시 스왑으로 인해 사용 안함.
  elseif ( LoadBoolean(udg_hash, P-1, StringHash("Sbol") + Inventory_IC2B(S2I(EXExecuteScript2("item", itid, "oldLevel"))) + FMI_MAXMAX_INVENTORY) ) then
    call MSG(Player(P-1), 1, 3, "이미 장착하고 있는 부위입니다.")
  */
  
  /* 클래스 미등록 아이템 */
  elseif ( Inventory_IC2B(S2I(EXExecuteScript2("item", itid, "oldLevel"))) == 0 ) then
    call MSG(Player(P-1), 1, 3, "설정 미스: 착용할 수 있는 아이템 종류가 아닙니다.")
  
  /* 네임드 아이템 중복 체크 /* 3강까지 중첩 가능 */ */
  elseif ( LoadInteger(udg_hash, P, StringHash("itnad") + isNamed(itco, true)) > 0 ) and ( LoadInteger(udg_hash, P, StringHash("itnad") + isNamed(itco, true)) + isNamed(itco, false) > 3 ) then
    call MSG(Player(P-1), 1, 3, "강화 아이템은 단일 5강, 중복 총합 3강까지만 착용할 수 있습니다.")
  
  /* 조건이 모두 맞을때 */
  else
    /* 무기 설정 : NowJob - 별도 처리 */
    return true
  endif
endif
  
  /* else의 else 즉 조건이 하나라도 안맞으면, false */
  return false
endfunction
//EquipCheck(LoadInteger(udg_hash, pid, StringHash("itid") + fid), P, LoadInteger(udg_hash, pid, StringHash("itco") + fid))
// 마우스 클릭 ====================================================================================================
public function MouseClick takes nothing returns nothing
  local integer P = GetPlayerId(DzGetTriggerUIEventPlayer())+1
  local integer f = DzGetTriggerUIEventFrame()
  local integer f2 = DzFrameFindByName("InVe_SelectedBack", 0)
  local integer f3 = DzFrameFindByName("InVe_MouseItem", 0)
  local integer f4 = DzFrameFindByName("EqSl_Active", 0) /* EquipSlot 연동 */
  local integer fid = LoadInteger(udg_hash, f, StringHash("number"))
  local integer itid
  local integer temp
  local real r1
  local real r2

  // EquipSlot 연동 :: 장착창에서 템을 찝은 상태가 아닐 시
  if not EquipSlot_AreYouPickUp then
    // 빈 칸을 누른 게 아닐 경우
    if LoadBoolean(udg_hash, P, StringHash("bol") + fid) then
      // 같은 칸을 재선택했을 경우
      if fid == LastSelected then
        set LastSelected = -1
        set AreYouPickUp = false
        call DzFrameShow(f2, false)
        call DzFrameShow(f3, false)
        
        // 다른 칸을 선택했을 경우
      else
        // 아이템을 찝은 채일 경우
        if AreYouPickUp then
          set temp = LoadInteger(udg_hash, P, StringHash("itid") + fid)          /* 현재 itid */
          // 바꾸려는 칸으로 데이터 이동
          set itid = LoadInteger(udg_hash, P, StringHash("itid") + LastSelected) /* 이전 itid */
          
          /* 주문서일 경우, 제련 */
          if ( EXExecuteScript2("item", itid, "stockMax") == "8" ) and ( ScrolData(itid) != 0 ) then /* 8스택 = 주문서 */
            /* 장비류 및 5강이 아님 */
            if ( EXExecuteScript2("item", temp, "class") != "Miscellaneous" ) and ( Condition2(LoadInteger(udg_hash, P, StringHash("itco") + fid)) ) then
            
              /* 세이브 아이템 더블체크
              if not ( LoadBoolean(udg_hash, StringHash("LoadItem"), GetHandleId(udg_temp_t)) and LoadBoolean(udg_hash, StringHash("LoadItem"), GetHandleId(t)) ) then
              else
              //call MSG(Player(P-1),1,5,"세이브하지 않았거나(장비), 세이브되지 않은(주문서)로만 제련이 가능합니다.")
                if ( LoadBoolean(udg_hash, StringHash("LoadItem"), GetHandleId(udg_temp_t)) ) then
                  call MSG(Player(P-1),1,5,"로드된 아이템입니다. 새로 습득한 장비를 주문서로 만들어 제련할 수 있습니다.")
                elseif ( LoadBoolean(udg_hash, StringHash("LoadItem"), GetHandleId(t)) ) then
                  call MSG(Player(P-1),1,5,"로드된 장비로 만든 주문서입니다. 새로 습득한 장비에만 제련할 수 있습니다.")
                endif
              endif
               */
              if ( ScrolData(itid) == -1 ) or ( ScrolData3( Inventory_IC2B(S2I(SubString(LoadStr(udg_hash, temp, StringHash("FMi-Val")),1,3))), ScrolData(itid) ) ) then
                if ( udg_SysA_ReloadEnd ) then
                  // * Sync Mouse Click Move
                  call DzSyncData("MLCI", I2S(LastSelected) + "/" + I2S(fid) + "/" + I2S(temp))
                  // 값 초기화, 프레임 숨기기
                  set LastSelected = -1
                  set AreYouPickUp = false
                  call DzFrameShow(f2, false)
                  call DzFrameShow(f3, false)
                  call RefreshItemDes(P, itid, DzFrameFindByName("InVe_SlotA", fid), (EXExecuteScript2("item", itid, "class") != "Miscellaneous"))
                else
                  call MSG(Player(P-1), 1, 5, "10분 이후 진행해주세요.")
                endif
              else
                call MSG(Player(P-1),1,5,"종류가 맞지 않습니다. 해당 주문서는 |cff00ffff["+ItemClass(SubString(LoadStr(udg_hash, fid, StringHash("FMi-Val")),1,3))+"]"+BaseStr(11)+"가 아닌 |cff00ffff["+JNStringSplit(GetObjectName(itid), " ", 0)+"]"+BaseStr(11)+"에 사용해주세요.")
              endif
            else
              call MSG(Player(P-1), 1, 5, "강화할 수 없는 아이템입니다.")
            endif
          else
            call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", fid), EXExecuteScript2("item", itid, "Art"), 0)
            call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", fid), EXExecuteScript2("item", itid, "Art"), 0)
            // 바꿈받은 데이터 기존 칸으로 이동
            call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", LastSelected), EXExecuteScript2("item", temp, "Art"), 0)
            call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", LastSelected), EXExecuteScript2("item", temp, "Art"), 0)
            // * Sync Mouse Click Emtpy A
            call DzSyncData("MCEA", I2S(LastSelected) + "/" + I2S(fid) + "/" + I2S(temp))
            // 값 초기화, 프레임 숨기기
            set LastSelected = -1
            set AreYouPickUp = false
            call DzFrameShow(f2, false)
            call DzFrameShow(f3, false)
            call RefreshItemDes(P, itid, DzFrameFindByName("InVe_Slot", fid), (EXExecuteScript2("item", itid, "class") != "Miscellaneous"))
          endif
        else
          set LastSelected = fid
          set AreYouPickUp = true
          call DzFrameSetUpdateCallbackByCode(function UpdateCallback_Start)
          call DzFrameShow(f2, true)
          call DzFrameShow(f3, true)
          call DzFrameSetPoint(f2, JN_FRAMEPOINT_CENTER, f, JN_FRAMEPOINT_CENTER, 0, 0)
          call DzFrameSetTexture(f3, EXExecuteScript2("item", LoadInteger(udg_hash, P, StringHash("itid") + fid), "Art"), 0)
          // 좌표 바로 한 번 갱신하기
          set r1 = I2R(DzGetMouseXRelative()) / I2R(DzGetWindowWidth()) * 0.8 + 0.0025
          set r2 = I2R(DzGetWindowHeight() - 42 - DzGetMouseYRelative()) / I2R(DzGetWindowHeight() - 42) * 0.6
          call DzFrameSetAbsolutePoint(f3, JN_FRAMEPOINT_CENTER, r1, r2)
        endif
      endif
      
      // 빈 칸을 누름 + 들고 있음
    elseif AreYouPickUp then
      // 새로운 칸으로 데이터 이동
      set itid = LoadInteger(udg_hash, P, StringHash("itid") + LastSelected)
      call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", fid), EXExecuteScript2("item", itid, "Art"), 0)
      call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", fid), EXExecuteScript2("item", itid, "Art"), 0)
      // 기존 데이터 조져놓기
      call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", LastSelected), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
      call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", LastSelected), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
      // * Sync Mouse Click Move
      call DzSyncData("MCM", I2S(fid) + "/" + I2S(LastSelected))
      // 값 초기화, 프레임 숨기기
      set LastSelected = -1
      set AreYouPickUp = false
      call DzFrameShow(f2, false)
      call DzFrameShow(f3, false)
      call RefreshItemDes(P, itid, DzFrameFindByName("InVe_SlotA", fid), (EXExecuteScript2("item", itid, "class") != "Miscellaneous"))
    endif
    // EquipSlot 연동 :: 장착창에서 템을 찝은 상태일 시
  else
    // 빈 칸을 누른 게 아닐 경우
    if LoadBoolean(udg_hash, P, StringHash("bol") + fid) then
      set itid = LoadInteger(udg_hash, P, StringHash("Sitid") + EquipSlot_LastSelected)
      set temp = LoadInteger(udg_hash, P, StringHash("itid") + fid)
      
      if ( Inventory_IC2B(S2I(EXExecuteScript2("item", itid, "oldLevel"))) == Inventory_IC2B(S2I(EXExecuteScript2("item", temp, "oldLevel"))) ) then
        //조건 검사
        if ( Inventory_EquipCheck(temp, P, LoadInteger(udg_hash, P, StringHash("itco") + fid)) ) then
          // 바꾸려는 칸으로 데이터 이동
          call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", fid), EXExecuteScript2("item", itid, "Art"), 0)
          call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", fid), EXExecuteScript2("item", itid, "Art"), 0)
          // 바꿈받은 데이터 기존 칸으로 이동
          call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotA", EquipSlot_LastSelected), EXExecuteScript2("item", temp, "Art"), 0)
          call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotB", EquipSlot_LastSelected), EXExecuteScript2("item", temp, "Art"), 0)
          // * Sync Equip Click Change
          call DzSyncData("ECC", I2S(EquipSlot_LastSelected) + "/" + I2S(fid) + "/" + I2S(temp))
        
          // 값 초기화, 프레임 숨기기
          call DzFrameShow(DzFrameFindByName("EqSl_SlotBlackBox", EquipSlot_LastSelected), false)
          set EquipSlot_LastSelected = -1
          set EquipSlot_AreYouPickUp = false
          call DzFrameShow(f3, false)
          call RefreshItemDes(P, itid, DzFrameFindByName("InVe_SlotA", fid), (EXExecuteScript2("item", itid, "class") != "Miscellaneous"))
        endif
      endif
    else
      // 새로운 칸으로 데이터 이동
      set itid = LoadInteger(udg_hash, P, StringHash("Sitid") + EquipSlot_LastSelected)
      call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", fid), EXExecuteScript2("item", itid, "Art"), 0)
      call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", fid), EXExecuteScript2("item", itid, "Art"), 0)
      // 기존 데이터 조져놓기
      call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotA", EquipSlot_LastSelected), "UI\\Console\\Human\\human-transport-slot.blp", 0)
      call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotB", EquipSlot_LastSelected), "UI\\Console\\Human\\human-transport-slot.blp", 0)
      // * Sync Equip Click Empty
      call DzSyncData("ECE", I2S(fid) + "/" + I2S(EquipSlot_LastSelected))
      
      // 값 초기화, 프레임 숨기기
      call DzFrameShow(DzFrameFindByName("EqSl_SlotBlackBox", EquipSlot_LastSelected), false)
      set EquipSlot_LastSelected = -1
      set EquipSlot_AreYouPickUp = false
      call DzFrameShow(f3, false)
      call RefreshItemDes(P, itid, DzFrameFindByName("InVe_SlotA", fid), false)
    endif
  endif
endfunction

// 동기화 :: 우클릭 장착하기 ====================================================================================================
private function SyncRCE takes nothing returns nothing
  local integer P = GetPlayerId(DzGetTriggerSyncPlayer())+1
  local integer last = S2I(DzGetTriggerSyncData())
  local integer itid = LoadInteger(udg_hash, P, StringHash("itid") + last)
  local integer slot = Inventory_IC2B(S2I(EXExecuteScript2("item", itid, "oldLevel")))
  local integer temp
  
  /* 조건은 이전에 체크했음. */
  // 장착창 빈 칸에 장착 시 바로 장착
  if not LoadBoolean(udg_hash, P, StringHash("Sbol") + slot) then
    call SaveBoolean(udg_hash, P, StringHash("Sbol") + slot, true)
    call SaveInteger(udg_hash, P, StringHash("Sitid") + slot, itid)
    set temp_item = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last)
    call SaveInteger(udg_hash, P, StringHash("Sitco") + slot, GetItemCharges(temp_item))
    //call SaveStr(udg_hash, P, StringHash("Sitname") + slot, ItemName(itid, GetItemCharges(temp_item), true))
    call SaveItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), slot, temp_item)
    call ItemEquip(P, temp_item, true, true)

    // 해쉬 비우기
    call RemoveSavedBoolean(udg_hash, P, StringHash("bol") + last)
    call RemoveSavedInteger(udg_hash, P, StringHash("itid") + last)
    call RemoveSavedInteger(udg_hash, P, StringHash("itco") + last)
    //call RemoveSavedString(udg_hash, P, StringHash("itname") + last)
    call RemoveSavedHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last)
    
    // 장착창 이미 템이 있는 칸에 장착 시 자리 교체
  else
    set temp = LoadInteger(udg_hash, P, StringHash("Sitid") + slot)
    set temp_item = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), slot)
    call SaveInteger(udg_hash, P, StringHash("Sitid") + slot, itid)
    call SaveInteger(udg_hash, P, StringHash("Sitco") + slot, GetItemCharges(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last)))
    //call SaveStr(udg_hash, P, StringHash("Sitname") + slot, LoadStr(udg_hash, P, StringHash("itname") + last))
    call SaveItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), slot, LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last))
    
    call ItemEquip(P, temp_item, true, false)
    call ItemEquip(P, LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last), true, true)
    
    call SaveInteger(udg_hash, P, StringHash("itid") + last, temp)
    call SaveInteger(udg_hash, P, StringHash("itco") + last, GetItemCharges(temp_item))
    //call SaveStr(udg_hash, P, StringHash("itname") + last, ItemName(temp, GetItemCharges(temp_item), true))
    call SaveItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last, temp_item)
  endif
  
  // 버튼 다시 활성화
  if GetLocalPlayer() == DzGetTriggerSyncPlayer() then
    call DzFrameSetEnable(DzFrameFindByName("InVe_Slot", last), true)
    set RightClickEnable = true
  endif
endfunction
// 동기화 :: 우클릭 제련취소 ====================================================================================================
private function SyncRCR takes nothing returns nothing
  local integer P = GetPlayerId(DzGetTriggerSyncPlayer())+1
  local integer fid = S2I(DzGetTriggerSyncData())
    
  call SetItemCharges(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid), 0)
  call RefreshItemDes(P, GetItemTypeId(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid)), fid, true)
  
  // 버튼 다시 활성화
  if ( GetLocalPlayer() == Player(P-1) ) then
    call DzFrameSetEnable(DzFrameFindByName("InVe_Slot", fid), true)
    set RightClickEnable = true
    
    call DzFrameShow(DzFrameFindByName("InVe_DesBack", 0), false)
  endif
endfunction
// 동기화 :: 우클릭 사용아이템 ====================================================================================================
private function SyncRCU takes nothing returns nothing
  local integer P = GetPlayerId(DzGetTriggerSyncPlayer())+1
  local integer fid = S2I(DzGetTriggerSyncData())
  local integer itid = LoadInteger(udg_hash, P, StringHash("itid") + fid)
  if ( RecallData(itid) > 0 ) then
    call Recall(GetTriggerUnit(), itid, true)
  elseif ( itid == 'wild' ) then
    if ( MinusItem(P, 'wild', 1) ) then
      if ( udg_SysB_Level[P] >= 41 ) and ( udg_SysB_Level[P] <= 98 ) then
        call MSG(Player(P-1), 1, 7, "레벨이 너무 높습니다.")
      else
        call TriggerSleepAction(2.)
        if ( MinusItem(P, 'wild', 1) ) then
          call ResetStat(P, "스탯 초기화(강제)")
        else
          call ResetStat(P, "스탯 초기화(물약)")
        endif
      endif
    else
      call MSG(GetTriggerPlayer(), 1, 7, "초기화 물약이 없습니다.")
    endif
  elseif ( itid == 'I09V' ) then
    call Quest_Note2(P)
  endif
  // 버튼 다시 활성화
  if ( GetLocalPlayer() == DzGetTriggerSyncPlayer() ) then
    call DzFrameSetEnable(DzFrameFindByName("InVe_Slot", fid), true)
    set RightClickEnable = true
    
    call DzFrameShow(DzFrameFindByName("InVe_DesBack", 0), false)
  endif
endfunction

// 동기화 :: 우클릭 분해 ====================================================================================================
private function SyncRCI takes nothing returns nothing
  local player p = DzGetTriggerSyncPlayer()
  local integer P = GetPlayerId(p)+1
  local integer fid = S2I(DzGetTriggerSyncData())
  
    if ( fid == -1 ) then /* 전체분해 */
      set fid = 1
      loop
        exitwhen fid >= FMI_MAXMAX_INVENTORY
        /* 프레임 관리 각플 */
        if ( LoadBoolean(udg_hash, P, StringHash("bol") + fid) ) then
          set temp_item = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid)
          if ( GetItemType(temp_item) != ITEM_TYPE_UNKNOWN ) and ( isNamed(GetItemCharges(temp_item),false) >= 1 ) and ( HaveSavedInteger(udg_hash,GetItemTypeId(temp_item),StringHash("FSE_T2I")) ) then
            if ( isNamed(GetItemCharges(temp_item),false) < 5 ) and ( GetRandomReal(0.,100.) <= (udg_SysC_Hits[P]-(udg_SysE_DEX3[P]*BaseValue(1)))*.3+10. ) then
              call GiveItem(P, ScrolData2(-1), isNamed(GetItemCharges(temp_item),false)-1)
              call MSG(Player(P-1),1,5,"장비 |cffDFFB4F" + GetItemNamed(temp_item) + "이(가) 눈부시게 빛나, "+"|c00ffff00" + GetItemName(bj_lastCreatedItem) + "|r (모든 특성)" + BaseStr(11) + "가 되었습니다 !!")
            else
              call GiveItem(P, ScrolData2(Inventory_IC2B(S2I(EXExecuteScript2("item", GetItemTypeId(temp_item), "oldLevel")))), GetItemCharges(temp_item)-1)
              call MSG(Player(P-1),1,5,"장비 |cffDFFB4F" + GetItemNamed(temp_item) + "이(가) 선명하게 빛나, "+"|c00ffff00" + GetItemName(bj_lastCreatedItem) + "|r (" + GetNamed2(isNamed(GetItemCharges(bj_lastCreatedItem),true)) + "특성)" + BaseStr(11) + "가 되었습니다.")
            endif
            call SetItemUserData(bj_lastCreatedItem, GetItemUserData(temp_item))
            call SaveBoolean(udg_hash, StringHash("LoadItem"), GetHandleId(bj_lastCreatedItem), LoadBoolean(udg_hash, StringHash("LoadItem"), GetHandleId(temp_item)))
            call FlushChildHashtable(udg_hash, GetHandleId(temp_item))
            call RemoveItem(temp_item)
            call InvenClear(P, fid) /* 해쉬 비우기 */
            if ( GetLocalPlayer() == p ) then
              call DzFrameShow(DzFrameFindByName("InVe_DesBack", 0), false)
              call DzFrameShow(DzFrameFindByName("EqSl_DesBack", 0), false) /* EquipSlot 연동 */
          
              // 버튼 되돌리기
              call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", fid), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
              call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", fid), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
            endif
            
            if ( isNamed(GetItemCharges(bj_lastCreatedItem),false) < 3 ) and ( GetRandomReal(0.,100.) <= (udg_SysC_Hits[P]-(udg_SysE_DEX3[P]*BaseValue(1)))*.1+5. ) then
              //Hit /2 확률로 추가주문서 지급
              call GiveItem(P, GetItemTypeId(bj_lastCreatedItem), GetItemCharges(bj_lastCreatedItem))
              call SetItemUserData(bj_lastCreatedItem, GetItemUserData(bj_lastCreatedItem))
              call MSG(Player(P-1),1,5,"높은 행운으로, 추가 주문서를 획득했습니다 !!")
            endif
          endif
        endif
        set fid = fid + 1
      endloop
    else
      set temp_item = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid)
      if ( GetItemType(temp_item) != ITEM_TYPE_UNKNOWN ) and ( isNamed(GetItemCharges(temp_item),false) >= 1 ) then
        if ( HaveSavedInteger(udg_hash,GetItemTypeId(temp_item),StringHash("FSE_T2I")) ) then
          if ( isNamed(GetItemCharges(temp_item),false) < 5 ) and ( GetRandomReal(0.,100.) <= (udg_SysC_Hits[P]-(udg_SysE_DEX3[P]*BaseValue(1)))*.3+10. ) then
            call GiveItem(P, ScrolData2(-1), isNamed(GetItemCharges(temp_item),false)-1)
            call MSG(Player(P-1),1,5,"장비 |cffDFFB4F" + GetItemNamed(temp_item) + "이(가) 눈부시게 빛나, "+"|c00ffff00" + GetItemName(bj_lastCreatedItem) + "|r (모든 특성)" + BaseStr(11) + "가 되었습니다 !!")
          else
            call GiveItem(P, ScrolData2(Inventory_IC2B(S2I(EXExecuteScript2("item", GetItemTypeId(temp_item), "oldLevel")))), GetItemCharges(temp_item)-1)
            call MSG(Player(P-1),1,5,"장비 |cffDFFB4F" + GetItemNamed(temp_item) + "이(가) 선명하게 빛나, "+"|c00ffff00" + GetItemName(bj_lastCreatedItem) + "|r (" + GetNamed2(isNamed(GetItemCharges(bj_lastCreatedItem),true)) + "특성)" + BaseStr(11) + "가 되었습니다.")
          endif
          call SetItemUserData(bj_lastCreatedItem, GetItemUserData(temp_item))
          call SaveBoolean(udg_hash, StringHash("LoadItem"), GetHandleId(bj_lastCreatedItem), LoadBoolean(udg_hash, StringHash("LoadItem"), GetHandleId(temp_item)))
          call FlushChildHashtable(udg_hash, GetHandleId(temp_item))
          call RemoveItem(temp_item)
          call InvenClear(P, fid) /* 해쉬 비우기 */
            
          if ( isNamed(GetItemCharges(bj_lastCreatedItem),false) < 3 ) and ( GetRandomReal(0.,100.) <= (udg_SysC_Hits[P]-(udg_SysE_DEX3[P]*BaseValue(1)))*.1+5. ) then
            //Hit /2 확률로 추가주문서 지급
            call GiveItem(P, GetItemTypeId(bj_lastCreatedItem), GetItemCharges(bj_lastCreatedItem))
            call SetItemUserData(bj_lastCreatedItem, GetItemUserData(bj_lastCreatedItem))
            call MSG(Player(P-1),1,5,"높은 행운으로, 추가 주문서를 획득했습니다 !!")
          endif
        else
          call MSG(Player(P-1),1,5,"세이브 가능한 아이템만 주문서로 만들 수 있습니다.")
        endif
      else
        call MSG(Player(P-1),1,5,"빛바랜 등 네임드 아이템을 선택해주세요.")
      endif
    endif
  set p = null
endfunction


// 동기화 :: 우클릭 버리기 ====================================================================================================
private function SyncRCT takes nothing returns nothing
  local player p = DzGetTriggerSyncPlayer()
  local integer P = GetPlayerId(p)+1
  local integer fid = S2I(DzGetTriggerSyncData())
  
  if ( fid == -1 ) then /* 전체버리기 */
    set fid = 1
    if ( GetLocalPlayer() == p ) then
      call DzFrameShow(DzFrameFindByName("InVe_DesBack", 0), false)
      call DzFrameShow(DzFrameFindByName("EqSl_DesBack", 0), false) /* EquipSlot 연동 */
    endif
    loop
      exitwhen fid >= FMI_MAXMAX_INVENTORY
      /* 프레임 관리 각플 */
      if ( LoadBoolean(udg_hash, P, StringHash("bol") + fid) ) then
        set temp_item = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid)
        if ( GetItemUserData(temp_item) == 0 ) then
          if ( GetLocalPlayer() == p ) then
            // 버튼 되돌리기
            call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", fid), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
            call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", fid), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
          endif
          call SetItemPosition(temp_item, GetUnitX(udg_Unit[P]), GetUnitY(udg_Unit[P]))
          call SetItemVisible(temp_item, true)
          // 해쉬 비우기
          call RemoveSavedBoolean(udg_hash, P, StringHash("bol") + fid)
          call RemoveSavedInteger(udg_hash, P, StringHash("itid") + fid)
          call RemoveSavedInteger(udg_hash, P, StringHash("itco") + fid)
          //call RemoveSavedString(udg_hash, P, StringHash("itname") + fid)
          call RemoveSavedHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid)
        endif
      endif
      set fid = fid + 1
    endloop
        
  else
    set temp_item = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid)
    call SetItemPosition(temp_item, GetUnitX(udg_Unit[P]), GetUnitY(udg_Unit[P]))
    call SetItemVisible(temp_item, true)
    // 해쉬 비우기
    call RemoveSavedBoolean(udg_hash, P, StringHash("bol") + fid)
    call RemoveSavedInteger(udg_hash, P, StringHash("itid") + fid)
    call RemoveSavedInteger(udg_hash, P, StringHash("itco") + fid)
    //call RemoveSavedString(udg_hash, P, StringHash("itname") + fid)
    call RemoveSavedHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid)
  
    // 버튼 다시 활성화
    if GetLocalPlayer() == p then
      call DzFrameSetEnable(DzFrameFindByName("InVe_Slot", fid), true)
      set RightClickEnable = true
    endif
  endif
  
  set p = null
endfunction
// 동기화 :: 우클릭 판매 ====================================================================================================
private function SyncRCS takes nothing returns nothing
  local player p = DzGetTriggerSyncPlayer()
  local integer P = GetPlayerId(p)+1
  local integer fid = S2I(DzGetTriggerSyncData())
  
  if ( fid == -1 ) then /* 전체판매 */
    set fid = 1
    loop
      exitwhen fid >= FMI_MAXMAX_INVENTORY
      if ( LoadBoolean(udg_hash, P, StringHash("bol") + fid) ) then
        set temp_item = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid)
        if ( EXExecuteScript2("item", LoadInteger(udg_hash, P, StringHash("itid") + fid), "class") != "Miscellaneous" ) and ( GetItemUserData(temp_item) == 0 ) then
          if ( GetLocalPlayer() == p ) then /* 프레임 관리 각플 */
            call DzFrameShow(DzFrameFindByName("InVe_DesBack", 0), false)
            call DzFrameShow(DzFrameFindByName("EqSl_DesBack", 0), false) /* EquipSlot 연동 */
          
            // 버튼 되돌리기
            call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", fid), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
            call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", fid), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
          endif
          call SellItem(P, temp_item)
          
          // 해쉬 비우기
          call RemoveSavedBoolean(udg_hash, P, StringHash("bol") + fid)
          call RemoveSavedInteger(udg_hash, P, StringHash("itid") + fid)
          call RemoveSavedInteger(udg_hash, P, StringHash("itco") + fid)
          //call RemoveSavedString(udg_hash, P, StringHash("itname") + fid)
          call RemoveSavedHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid)
        endif
      endif
      set fid = fid + 1
    endloop
  else
    call SellItem(P, LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid))
    // 해쉬 비우기
    call RemoveSavedBoolean(udg_hash, P, StringHash("bol") + fid)
    call RemoveSavedInteger(udg_hash, P, StringHash("itid") + fid)
    call RemoveSavedInteger(udg_hash, P, StringHash("itco") + fid)
    //call RemoveSavedString(udg_hash, P, StringHash("itname") + fid)
    call RemoveSavedHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid)

    // 버튼 다시 활성화
    if GetLocalPlayer() == p then
      call DzFrameSetEnable(DzFrameFindByName("InVe_Slot", fid), true)
      set RightClickEnable = true
    endif
  endif
  
  set p = null
endfunction


// 스냅 들어감 ====================================================================================================
private function SnapEnter_Inven takes nothing returns nothing
  set Snap = true
endfunction

// 스냅 나감 ====================================================================================================
private function SnapLeave_Inven takes nothing returns nothing
  if not Drag then
    set Snap = false
  endif
endfunction
// 스냅 들어감 ====================================================================================================
private function SnapEnter_Equip takes nothing returns nothing
  set EquipSlot_Snap = true
endfunction

// 스냅 나감 ====================================================================================================
private function SnapLeave_Equip takes nothing returns nothing
  if not EquipSlot_Drag then
    set EquipSlot_Snap = false
  endif
endfunction

private function MiniToActive takes integer num returns nothing
/* 버튼에 따라 대상 아이템들 강조 표시 */
 local integer P = GetPlayerId(DzGetTriggerUIEventPlayer())+1
 local integer i = 1
  //local integer fid = LoadInteger(udg_hash, f, StringHash("number"))
  loop
    exitwhen i >= FMI_MAXMAX_INVENTORY
    if ( num == 1 ) or ( num == 2 ) or ( num == 5 ) then /* 제련취소, 제련 : 장비 & 수량 > 0 */
      if ( EXExecuteScript2("item", LoadInteger(udg_hash, P, StringHash("itid") + i), "class") != "Miscellaneous" ) and ( LoadInteger(udg_hash, P, StringHash("itco") + i) > 0 ) then
        call DzFrameShow(DzFrameFindByName("InVe_SlotS", i), true)
        call DzFrameShow(DzFrameFindByName("InVe_SlotBlack", i), false)
      else
        call DzFrameShow(DzFrameFindByName("InVe_SlotBlack", i), true)
      endif
    elseif ( num == 3 ) or ( num == 6 ) then /* 버리기 ON : 있기만 하면 */
      if ( LoadBoolean(udg_hash, P, StringHash("bol") + i) ) then
        call DzFrameShow(DzFrameFindByName("InVe_SlotS", i), true)
        call DzFrameShow(DzFrameFindByName("InVe_SlotBlack", i), false)
      else
        call DzFrameShow(DzFrameFindByName("InVe_SlotBlack", i), true)
      endif
    elseif ( num == 4 ) or ( num == 7 ) then /* 판매 ON 장비기만 하면 */
      if ( LoadBoolean(udg_hash, P, StringHash("bol") + i) ) and ( EXExecuteScript2("item", LoadInteger(udg_hash, P, StringHash("itid") + i), "class") != "Miscellaneous" ) then
        call DzFrameShow(DzFrameFindByName("InVe_SlotS", i), true)
        call DzFrameShow(DzFrameFindByName("InVe_SlotBlack", i), false)
      else
        call DzFrameShow(DzFrameFindByName("InVe_SlotBlack", i), true)
      endif
    else
      call DzFrameShow(DzFrameFindByName("InVe_SlotS", i), false)
      call DzFrameShow(DzFrameFindByName("InVe_SlotBlack", i), false)
    endif
    
    set i = i + 1
  endloop
  
endfunction
// 프레임 보임/안보임 :: EquipSlot 연동
public function FrameShow takes boolean bol returns nothing
  local integer f = DzFrameFindByName("EqSl_IconTriangle", 0)
  call DzFrameShow(DzFrameFindByName("EqSl_Back", 0), bol)
  call DzFrameShow(DzFrameFindByName("EqSl_IconDisable", 0), bol)
  
  set f = DzFrameFindByName("InVe_IconTriangle", 0)
  call DzFrameShow(DzFrameFindByName("InVe_Back", 0), bol)
  call DzFrameShow(DzFrameFindByName("InVe_IconDisable", 0), bol)
  
  if ( bol ) then
    set udg_SysA_AddValue = .3
    call DzFrameShow(DzFrameFindByName("InVe_Back", 0), true)
    call DzFrameSetText(DzFrameFindByName("InVe_IconName", 0), "|CFFBF9900인벤(I)")
    call DzFrameSetTexture(f, "UI\\Widgets\\Glues\\SinglePlayerSkirmish-ScrollBarDownButton.blp", 0)
    call DzFrameSetPoint(f, JN_FRAMEPOINT_TOPRIGHT, DzFrameFindByName("InVe_Icon", 0), JN_FRAMEPOINT_TOPRIGHT, -0.0015, -0.0014)
  else
    set udg_SysA_AddValue = 0.
    call DzFrameSetText(DzFrameFindByName("InVe_IconName", 0), "|CFFFFCC00인벤(I)")
    call DzFrameSetTexture(f, "UI\\Widgets\\Glues\\SinglePlayerSkirmish-ScrollBarUpButton.blp", 0)
    call DzFrameSetPoint(f, JN_FRAMEPOINT_TOPRIGHT, DzFrameFindByName("InVe_Icon", 0), JN_FRAMEPOINT_TOPRIGHT, -0.0015, -0.002)
  endif
  
  //버튼 활성화
  set RightClickEnable = true
  call DzFrameSetEnable(DzFrameFindByName("InVe_Slot", LastSelected), true)
  call DzFrameSetEnable(DzFrameFindByName("EqSl_Slot", EquipSlot_LastSelected), true)
  
  // 들고 있는 아이템 조지기
  set LastSelected = -1
  set AreYouPickUp = false
  call DzFrameShow(DzFrameFindByName("InVe_SelectedBack", 0), false)
  call DzFrameShow(DzFrameFindByName("InVe_MouseItem", 0), false)
  // EquopSlot 연동 :: 같이 조지기
  if ( EquipSlot_AreYouPickUp ) then
    call DzFrameShow(DzFrameFindByName("EqSl_SlotBlackBox", EquipSlot_LastSelected), false)
    set EquipSlot_LastSelected = -1
    set EquipSlot_AreYouPickUp = false
  endif
    
  //미니 아이콘 조지기
  call DzFrameShow(DzFrameFindByName("InVe_MiniIconNameBack", 0), false)
  set MouseMode = 0
  call MiniToActive(0)
  call DzFrameShow(DzFrameFindByName("InVe_MiniIconActive", 0), false)
  call MSG(GetLocalPlayer(), 2, 1., " ")
endfunction



// 키보드 I ====================================================================================================
private function KeyI takes nothing returns nothing
  if ( JNMemoryGetByte(JNGetModuleHandle("Game.dll") + 0xD04FEC) == 0 ) then
    set Visility = not Visility
    call FrameShow(Visility)
  endif
endfunction
// 키보드 ESC ====================================================================================================
private function ESC takes nothing returns nothing
  if Visility then
    set Visility = false
    call FrameShow(Visility)
  endif
endfunction

// 미니 아이콘 - 들어옴/나감 ====================================================================================================
private function MiniButtonEnter takes nothing returns nothing
  local integer f = DzFrameFindByName("InVe_MiniIconNameBack", 0)
  local integer f2 = DzGetTriggerUIEventFrame()
  call DzFrameShow(f, true)
  call DzFrameSetPoint(f, JN_FRAMEPOINT_BOTTOM, f2, JN_FRAMEPOINT_TOP, 0, -0.0005)
  if f2 == DzFrameFindByName("InVe_MiniIconInchantOff", 0) then
    call DzFrameSetText(DzFrameFindByName("InVe_MiniIconNameText", 0), "|CFFFFCC00제련 취소")
  elseif f2 == DzFrameFindByName("InVe_MiniIconInchant", 0) then
    call DzFrameSetText(DzFrameFindByName("InVe_MiniIconNameText", 0), "|CFFFFCC00분해 ON")
  elseif f2 == DzFrameFindByName("InVe_MiniIconInchantAll", 0) then
    call DzFrameSetText(DzFrameFindByName("InVe_MiniIconNameText", 0), "|CFFFFCC00전체 분해")
  elseif f2 == DzFrameFindByName("InVe_MiniIconThrow", 0) then
    call DzFrameSetText(DzFrameFindByName("InVe_MiniIconNameText", 0), "|CFFFFCC00버리기 ON")
  elseif f2 == DzFrameFindByName("InVe_MiniIconThrowAll", 0) then
    call DzFrameSetText(DzFrameFindByName("InVe_MiniIconNameText", 0), "|CFFFFCC00전체 버리기")
  elseif f2 == DzFrameFindByName("InVe_MiniIconSell", 0) then
    call DzFrameSetText(DzFrameFindByName("InVe_MiniIconNameText", 0), "|CFFFFCC00판매 ON")
  elseif f2 == DzFrameFindByName("InVe_MiniIconSellAll", 0) then
    call DzFrameSetText(DzFrameFindByName("InVe_MiniIconNameText", 0), "|CFFFFCC00전체 판매")
  endif
  call MiniToActive(LoadInteger(udg_hash, f2, StringHash("number2")))
endfunction
private function MiniButtonLeave takes nothing returns nothing
  call DzFrameShow(DzFrameFindByName("InVe_MiniIconNameBack", 0), false)
  call MiniToActive(0)
endfunction

// 미니 아이콘 7종 ====================================================================================================
private function MiniIconClick takes nothing returns nothing
  local integer f = DzFrameFindByName("InVe_MiniIconActive", 0)
  local integer num = LoadInteger(udg_hash, DzGetTriggerUIEventFrame(), StringHash("number2"))
  local integer i = 0
  if ( MouseMode != num ) then
    set MouseMode = num
    if ( num >= 5 ) then /* all */
      call DzFrameSetText(DzFrameFindByName("InVe_MiniIconNameText", 0), "|CFFFFCC00한번 더 클릭하여 진행합니다.\n세이브 아이템은 대상에서 제외됩니다.")
      call DzFrameShow(DzFrameFindByName("InVe_MiniIconNameBack", 0), true)
      
      if ( num == 5 ) then     /* 전체 분해 */
        call DzSyncData("RCI", "-1")
      elseif ( num == 6 ) then /* 전체 버리기 */
        call DzSyncData("RCT", "-1")
      elseif ( num == 7 ) then /* 전체 판매 */
        call DzSyncData("RCS", "-1")
      endif
    endif
  else
    set MouseMode = 0
    call DzFrameShow(DzFrameFindByName("InVe_MiniIconNameBack", 0), false)
    
    set i = 1
    loop
    exitwhen i >= FMI_MAXMAX_INVENTORY
      call DzFrameShow(DzFrameFindByName("InVe_SlotS", i), false)
      call DzFrameShow(DzFrameFindByName("InVe_SlotBlack", i), false)
      set i = i + 1
    endloop
  endif
  
  call DzFrameShow(f, MouseMode == num)
  call DzFrameSetPoint(f, JN_FRAMEPOINT_CENTER, DzGetTriggerUIEventFrame(), JN_FRAMEPOINT_CENTER, 0, 0)
  // 템 들고있으면 취소하기
  set LastSelected = -1
  set AreYouPickUp = false
  call DzFrameShow(DzFrameFindByName("InVe_SelectedBack", 0), false)
  call DzFrameShow(DzFrameFindByName("InVe_MouseItem", 0), false)
endfunction

native DzFrameGetName takes integer frame returns string
// 아이콘 클릭 ====================================================================================================
public function IconClick takes nothing returns nothing
  set Visility = not Visility
  call FrameShow(Visility)
endfunction

private constant function MiniIcon takes integer i returns string
  if ( i == 1 ) then
    return "InVe_MiniIconInchantOff"
  elseif ( i == 2 ) then
    return "InVe_MiniIconInchant"
  elseif ( i == 3 ) then
    return "InVe_MiniIconThrow"
  elseif ( i == 4 ) then
    return "InVe_MiniIconSell"
  elseif ( i == 5 ) then
    return "InVe_MiniIconInchantAll"
  elseif ( i == 6 ) then
    return "InVe_MiniIconThrowAll"
  elseif ( i == 7 ) then
    return "InVe_MiniIconSellAll"
  else
    return ""
  endif
endfunction
// 지연 초기화 ====================================================================================================
private function DelayedInit_Inven takes nothing returns nothing
  local integer UI = DzGetGameUI()
  local integer Main
  local integer loopA
  local integer loopB
  local integer temp
  local integer f
  local real offset = 0.032
  call PauseTimer(GetExpiredTimer())
  call DestroyTimer(GetExpiredTimer())
  
  // 아이콘
  set f = DzCreateFrame("InVe_Icon", UI, 0)
  call DzFrameSetAbsolutePoint(f, JN_FRAMEPOINT_CENTER, 0.21, 0.15)
  call DzFrameShow(DzFrameFindByName("InVe_IconDisable", 0), false)
  call DzFrameSetScriptByCode(DzFrameFindByName("InVe_Icon", 0), JN_FRAMEEVENT_CONTROL_CLICK, function IconClick, false)
  
  // 메인 백드롭
  set Main = DzCreateFrame("InVe_Back", UI, 0)
  call DzFrameSetPoint(Main, JN_FRAMEPOINT_TOP, DzFrameFindByName("EqSl_Back", 0), JN_FRAMEPOINT_BOTTOM, 0., 0.)
  //call DzFrameSetAbsolutePoint(Main, JN_FRAMEPOINT_CENTER, 0.15, 0.3)
  call DzFrameShow(Main, false)
  call DzFrameSetScriptByCode(DzFrameFindByName("InVe_Snap", 0), JN_FRAMEEVENT_MOUSE_ENTER, function SnapEnter_Inven, false)
  call DzFrameSetScriptByCode(DzFrameFindByName("InVe_Snap", 0), JN_FRAMEEVENT_MOUSE_LEAVE, function SnapLeave_Inven, false)
  
  set loopA = 1
  loop
    set f = DzFrameFindByName(MiniIcon(loopA), 0)
    call DzFrameSetScriptByCode(f, JN_FRAMEEVENT_MOUSE_ENTER, function MiniButtonEnter, false)
    call DzFrameSetScriptByCode(f, JN_FRAMEEVENT_MOUSE_LEAVE, function MiniButtonLeave, false)
    call DzFrameSetScriptByCode(f, JN_FRAMEEVENT_CONTROL_CLICK, function MiniIconClick, false)
    call SaveInteger(udg_hash, f, StringHash("number2"), loopA)
    exitwhen loopA >= 7
    set loopA = loopA + 1
  endloop

  // 각 칸
  set loopA = 0
  loop
    exitwhen loopA > 7
    set loopB = 0
    loop
      exitwhen loopB > 6
      set temp = loopB + loopA * 7 + 1
      set f = DzCreateFrame("InVe_Slot", Main, temp)
      call DzFrameSetPoint(f, JN_FRAMEPOINT_TOPLEFT, Main, JN_FRAMEPOINT_TOPLEFT, 0.005 + loopB * offset, - 0.037 - loopA * offset)
      call DzFrameSetScriptByCode(f, JN_FRAMEEVENT_MOUSE_ENTER, function MouseEnter, false)
      call DzFrameSetScriptByCode(f, JN_FRAMEEVENT_MOUSE_LEAVE, function MouseLeave, false)
      if ( temp <= FMI_MAX_INVENTORY ) then
        call DzFrameSetScriptByCode(f, JN_FRAMEEVENT_CONTROL_CLICK, function MouseClick, false)
      else
        call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", temp), "UI\\Widgets\\Console\\Human\\human-inventory-slotfiller.blp", 0)
        call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", temp), "UI\\Widgets\\Console\\Human\\human-inventory-slotfiller.blp", 0)
      endif
      call SaveInteger(udg_hash, f, StringHash("number"), temp)
      call DzFrameShow(DzFrameFindByName("InVe_SlotBlack", temp), false)
      set f = DzFrameFindByName("InVe_SlotS", temp)
      call DzFrameSetModel(f, "UI-ModalButtonOn2.mdx", 0, 0)
      call DzFrameShow(f, false)
      set loopB = loopB + 1
    endloop
    set loopA = loopA + 1
  endloop
  
  // 선택된 프레임
  call DzFrameShow(DzCreateFrame("InVe_SelectedBack", Main, 0), false)
  
  // 메인에 딸린 버튼 이름용 툴팁
  call DzCreateFrame("InVe_MiniIconNameBack", Main, 0)
  
  // 미니 아이콘 활성화 이펙트
  set f = DzCreateFrameByTagName("SPRITE", "InVe_MiniIconActive", Main, "", 0)
  call DzFrameSetModel(f, "UI-ModalButtonOn.mdx", 0, 0)
  call DzFrameShow(f, false)

  // 아이템 설명용 툴팁
  call DzCreateFrame("InVe_DesBack", UI, 0)
  
  // 아이템 설명용 툴팁 :: EquipSlot 연동, 우선순위 때문에 여기서 선언함
  call DzCreateFrame("EqSl_DesBack", UI, 0)
  
  // 마우스로 찝은 아이템
  call DzCreateFrame("InVe_MouseItem", Main, 0)  
endfunction

// 초기화 ====================================================================================================
private function OnInit takes nothing returns nothing
  local trigger trg
  // 아이템 습득
  call TriggerAddCondition(gg_trg_FMi_GetItem, Condition( function GetItemGoInven_Conditions ) )
  call TriggerAddAction(gg_trg_FMi_GetItem, function Trig_FMi_GetItemGoInven_Actions)

  // * Sync Mouse Click Emtpy A
  //! runtextmacro Sync("MCEA")
  
  // * Sync Mouse Left Click Inchent
  //! runtextmacro Sync("MLCI")
  
  // * Sync Mouse Click Throw
  //! runtextmacro Sync("MCT")
  // * Sync Mouse Click Move
  //! runtextmacro Sync("MCM")
  // * Sync Right Click Equip :: EquipSlot 연동
  //! runtextmacro Sync("RCE")
  
  // * Sync Right Click Throw
  //! runtextmacro Sync("RCT")
  
  // * Sync Right Click Inchant
  //! runtextmacro Sync("RCI")
  // * Sync Right Click Reset
  //! runtextmacro Sync("RCR")
  // * Sync Right Click Sell
  //! runtextmacro Sync("RCS")
  // * Sync Right Click UsableItem
  //! runtextmacro Sync("RCU")
  
  // ESC로 장비창 닫기
  set trg = CreateTrigger()
  call TriggerRegisterPlayerEvent(trg, Player(0), EVENT_PLAYER_END_CINEMATIC)
  call TriggerRegisterPlayerEvent(trg, Player(1), EVENT_PLAYER_END_CINEMATIC)
  call TriggerRegisterPlayerEvent(trg, Player(2), EVENT_PLAYER_END_CINEMATIC)
  call TriggerRegisterPlayerEvent(trg, Player(3), EVENT_PLAYER_END_CINEMATIC)
  call TriggerRegisterPlayerEvent(trg, Player(4), EVENT_PLAYER_END_CINEMATIC)
  call TriggerRegisterPlayerEvent(trg, Player(5), EVENT_PLAYER_END_CINEMATIC)
  call TriggerRegisterPlayerEvent(trg, Player(6), EVENT_PLAYER_END_CINEMATIC)
  call TriggerRegisterPlayerEvent(trg, Player(7), EVENT_PLAYER_END_CINEMATIC)
  call TriggerRegisterPlayerEvent(trg, Player(8), EVENT_PLAYER_END_CINEMATIC)
  call TriggerRegisterPlayerEvent(trg, Player(9), EVENT_PLAYER_END_CINEMATIC)
  call TriggerRegisterPlayerEvent(trg, Player(10), EVENT_PLAYER_END_CINEMATIC)
  call TriggerRegisterPlayerEvent(trg, Player(11), EVENT_PLAYER_END_CINEMATIC)
  call TriggerAddAction(trg, function ESC)
    
  // i로 장비창 열기
  set trg = CreateTrigger()
  call DzTriggerRegisterKeyEventByCode(trg, JN_OSKEY_I, 0, false, function KeyI)
  
  // 지연 초기화 (아이템 툴팁이 장비창(EquipSlot)보다 위에 나와야하기 때문에 장비창보다 늦게 초기화)
  call TimerStart(CreateTimer(), 0.01, false, function DelayedInit_Inven)
  
  set trg = null
endfunction
endscope//===========================================================================
// Trigger: EquipSlot
//===========================================================================
scope EquipSlot initializer OnInit

// 변수 선언 ====================================================================================================
globals
  // 플레이어마다 다른 값을 가지는 변수들
  public boolean AreYouPickUp = false /* 아이템을 현재 쥐고 있는지 논리값 :: Inventory 연동 */
  public boolean Drag = false /* 좌클릭중인지/아닌지 논리값 :: MouseInCommon 연동 */
  public boolean Snap = false /* 스냅용 공간에 마우스 들어감 :: MouseInCommon 연동 */
  public boolean array FrameIn /* 해당 칸 안에 마우스 들어감 (우클릭 감지용) */
  public integer LastSelected = -1 /* 마지막으로 찝은 인벤토리 칸 번호 */
endglobals

// 마우스 들어감 ====================================================================================================
private function MouseEnter takes nothing returns nothing
  local integer P = GetPlayerId(DzGetTriggerUIEventPlayer())+1
  local integer f = DzGetTriggerUIEventFrame()
  local integer fid = LoadInteger(udg_hash, f, StringHash("number"))
  local integer itid = LoadInteger(udg_hash, P, StringHash("Sitid") + fid)
  local integer i
  local integer Lv
  
  // 들어옴 논리값 true
  set FrameIn[fid] = true
  
  if LoadBoolean(udg_hash, P, StringHash("Sbol") + fid) then
    // Inventroy 연동 :: 아이템 설명 보임, 이동
    call Inventory_RefreshItemDes(P, itid, f, false)
  endif
    
  // Inventory 연동 :: 인벤토리 내 장착할 수 있는 아이템 표시
  set i = 0
  loop
  exitwhen i >= FMI_MAXMAX_INVENTORY
    set Lv = Inventory_IC2B(S2I(EXExecuteScript2("item", LoadInteger(udg_hash, P, StringHash("itid") + i), "oldLevel")))
    if Lv != 0 and Lv == fid then
      call DzFrameShow(DzFrameFindByName("InVe_SlotS", i), true)
      call DzFrameShow(DzFrameFindByName("InVe_SlotBlack", i), false)
    else
      call DzFrameShow(DzFrameFindByName("InVe_SlotBlack", i), true)
    endif
    set i = i + 1
  endloop
endfunction

// 마우스 나감 ====================================================================================================
private function MouseLeave takes nothing returns nothing
  local integer i
  call DzFrameShow(DzFrameFindByName("InVe_DesBack", 0), false) /* Inventory 연동 */
  call DzFrameShow(DzFrameFindByName("EqSl_DesBack", 0), false)
  set FrameIn[LoadInteger(udg_hash, DzGetTriggerUIEventFrame(), StringHash("number"))] = false
  
  set i = 0
  loop
  exitwhen i >= FMI_MAXMAX_INVENTORY
    call DzFrameShow(DzFrameFindByName("InVe_SlotS", i), false)
    call DzFrameShow(DzFrameFindByName("InVe_SlotBlack", i), false)
    set i = i + 1
  endloop
endfunction
// 동기화 :: 아이템을 찝은 채 다른 칸을 눌러 자리 교체 ====================================================================================================
private function SyncECC takes nothing returns nothing
/* ECC(장착창 템 찍은 번호(1), 찍은 itid(2), 현재itid(3) */
  local integer P = GetPlayerId(DzGetTriggerSyncPlayer())+1
  local string data = DzGetTriggerSyncData()
  local integer last = S2I(JNStringSplit(data, "/", 0))
  local integer fid = S2I(JNStringSplit(data, "/", 1))
  // Inventory 연동 :: 자리 교체
  set Inventory_temp_item = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid)
  call SaveInteger(udg_hash, P, StringHash("itid") + fid, LoadInteger(udg_hash, P, StringHash("Sitid") + last))
  call SaveInteger(udg_hash, P, StringHash("itco") + fid, LoadInteger(udg_hash, P, StringHash("Sitco") + last))
  //call SaveStr(udg_hash, P, StringHash("itname") + fid, LoadStr(udg_hash, P, StringHash("Sitname") + last))
  call SaveItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid, LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last))
  
  call ItemEquip(P, Inventory_temp_item, true, false)
  call ItemEquip(P, LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last), true, true)
  
  call SaveInteger(udg_hash, P, StringHash("Sitid") + last, S2I(JNStringSplit(data, "/", 2)))
  call SaveInteger(udg_hash, P, StringHash("Sitco") + last, GetItemCharges(Inventory_temp_item))
  //call SaveStr(udg_hash, P, StringHash("Sitname") + last, ItemName(S2I(JNStringSplit(data, "/", 2)), GetItemCharges(Inventory_temp_item), true))
  call SaveItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last, Inventory_temp_item)
endfunction
  
// 동기화 :: 장비창의 아이템 인벤토리로 옮기기 ====================================================================================================
private function SyncECE takes nothing returns nothing
  local integer P = GetPlayerId(DzGetTriggerSyncPlayer())+1
  local string data = DzGetTriggerSyncData()
  local integer fid = S2I(JNStringSplit(data, "/", 0))
  local integer last = S2I(JNStringSplit(data, "/", 1))
  // Inventory 연동 :: 인벤토리에 아이템 넣기
  call SaveBoolean(udg_hash, P, StringHash("bol") + fid, true)
  call SaveInteger(udg_hash, P, StringHash("itid") + fid, LoadInteger(udg_hash, P, StringHash("Sitid") + last))
  call SaveInteger(udg_hash, P, StringHash("itco") + fid, LoadInteger(udg_hash, P, StringHash("Sitco") + last))
  //call SaveStr(udg_hash, P, StringHash("itname") + fid, LoadStr(udg_hash, P, StringHash("Sitname") + last))
  call SaveItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid, LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last))
  call ItemEquip(P, LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last), true, false)
  // 장비창 내용 소거
  call RemoveSavedBoolean(udg_hash, P, StringHash("Sbol") + last)
  call RemoveSavedInteger(udg_hash, P, StringHash("Sitid") + last)
  call RemoveSavedInteger(udg_hash, P, StringHash("Sitco") + last)
  //call RemoveSavedString(udg_hash, P, StringHash("Sitname") + last)
  call RemoveSavedHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), last)
endfunction
// 동기화 :: 장착칸 우클릭 탈착하기 :: EquipSlot 연동 ====================================================================================================
private function SyncECR takes nothing returns nothing
  local player p = DzGetTriggerSyncPlayer()
  local integer P = GetPlayerId(p)+1
  local string data = DzGetTriggerSyncData()
  local integer slot = S2I(JNStringSplit(data, "/", 0))
  local integer fid = S2I(JNStringSplit(data, "/", 1))
  local integer itid = S2I(JNStringSplit(data, "/", 2))
  
  // Inventory 연동 :: 인벤토리 빈칸에 데이터 넣기
  call SaveBoolean(udg_hash, P, StringHash("bol") + fid, true)
  call SaveInteger(udg_hash, P, StringHash("itid") + fid, itid)
  call SaveInteger(udg_hash, P, StringHash("itco") + fid, GetItemCharges(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), slot)))
  //call SaveStr(udg_hash, P, StringHash("itname") + fid, LoadStr(udg_hash, P, StringHash("Sitname") + slot))
  call SaveItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), fid, LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), slot))
  call ItemEquip(P, LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), slot), true, false)
  
  // 해쉬 비우기
  call RemoveSavedBoolean(udg_hash, P, StringHash("Sbol") + slot)
  call RemoveSavedInteger(udg_hash, P, StringHash("Sitid") + slot)
  call RemoveSavedInteger(udg_hash, P, StringHash("Sitco") + slot)
  //call RemoveSavedString(udg_hash, P, StringHash("Sitname") + slot)
  call RemoveSavedHandle(udg_hash, StringHash("FMi_Item"+I2S(P)), slot)
  
  // 버튼 다시 활성화
  if GetLocalPlayer() == p then
    call DzFrameSetEnable(DzFrameFindByName("EqSl_Slot", slot), true)
    set RightClickEnable = true
  endif
  
  set p = null
endfunction

// 마우스 클릭 ====================================================================================================
private function MouseClick takes nothing returns nothing
  local integer P = GetPlayerId(DzGetTriggerKeyPlayer())+1
  local integer f = DzGetTriggerUIEventFrame()
  local integer f2 = DzFrameFindByName("InVe_MouseItem", 0) /* Inventory 연동 :: 인벤토리에서 쓰던 프레임 재활용;; */
  local integer fid = LoadInteger(udg_hash, f, StringHash("number"))
  local integer last
  local integer itid
  local real r1
  local real r2
  
  // Inventory 연동 :: 인벤토리 장비를 안찝고 있을 경우
  if not Inventory_AreYouPickUp then
    // 빈칸을 누른 게 아닐 시
    if LoadBoolean(udg_hash, P, StringHash("Sbol") + fid) then
      // 같은 칸을 재선택했을 경우
      if fid == LastSelected then
        set LastSelected = -1
        set AreYouPickUp = false
        call DzFrameShow(DzFrameFindByName("EqSl_SlotBlackBox", fid), false)
        call DzFrameShow(f2, false)
      // 다른 칸을 선택했을 경우
      else
        // 아이템을 안찝은 채일 경우, 인벤토리가 열려있을 경우
        if not AreYouPickUp then
          // Inventroy 연동 :: 인벤토리 즉시 열기
          set Inventory_Visility = true
          call Inventory_FrameShow(Inventory_Visility)
          
          set LastSelected = fid
          set AreYouPickUp = true
          call DzFrameSetUpdateCallbackByCode(function UpdateCallback_Start)
          call DzFrameShow(DzFrameFindByName("EqSl_SlotBlackBox", fid), true)
          call DzFrameShow(f2, true)
          call DzFrameSetTexture(f2, EXExecuteScript2("item", LoadInteger(udg_hash, P, StringHash("Sitid") + fid), "Art"), 0)
          // 좌표 바로 한 번 갱신하기
          set r1 = I2R(DzGetMouseXRelative()) / I2R(DzGetWindowWidth()) * 0.8 + 0.0025
          set r2 = I2R(DzGetWindowHeight() - 42 - DzGetMouseYRelative()) / I2R(DzGetWindowHeight() - 42) * 0.6
          call DzFrameSetAbsolutePoint(f2, JN_FRAMEPOINT_CENTER, r1, r2)
        endif
      endif
    endif
  
  // Inventory 연동 :: 인벤토리 장비를 찝고 있을 경우
  else
    set last = Inventory_LastSelected
    set itid = LoadInteger(udg_hash, P, StringHash("itid") + last)
    // 찝은 장비의 부위와 장착하려는 장착칸의 부위가 같을 경우
    if ( Inventory_IC2B(S2I(EXExecuteScript2("item", itid, "oldLevel"))) == fid ) then
      // 들고 있던 거 조지기
      set Inventory_LastSelected = -1
      set Inventory_AreYouPickUp = false
      call DzFrameShow(DzFrameFindByName("InVe_SelectedBack", 0), false)
      call DzFrameShow(DzFrameFindByName("InVe_MouseItem", 0), false)
      
      //조건 검사
      if ( Inventory_EquipCheck(itid, P, LoadInteger(udg_hash, P, StringHash("itco") + last)) ) then
      
        // 해당 장착칸이 빈 칸일 경우
        if not LoadBoolean(udg_hash, P, StringHash("Sbol") + fid) then
          call DzFrameShow(DzFrameFindByName("InVe_DesBack", 0), false)
          call DzFrameShow(DzFrameFindByName("EqSl_DesBack", 0), false)
          call DzFrameShow(DzFrameFindByName("EqSl_Active", 0), false)
          call DzFrameShow(DzFrameFindByName("EqSl_SlotBlackBox", fid), false)
          call DzFrameShow(DzFrameFindByName("InVe_SlotS", last), false)
          call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotA", fid), EXExecuteScript2("item", itid, "Art"), 0)
          call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotB", fid), EXExecuteScript2("item", itid, "Art"), 0)
          call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", last), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
          call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", last), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
          call Inventory_RefreshItemDes(P, itid, f, false)
        // 해당 장착칸이 빈 칸이 아닐 경우
        else
          // Inventory 연동 :: 텍스쳐 교체
          call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotA", fid), EXExecuteScript2("item", itid, "Art"), 0)
          call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotB", fid), EXExecuteScript2("item", itid, "Art"), 0)
          call Inventory_RefreshItemDes(P, itid, f, false)
          set itid = LoadInteger(udg_hash, P, StringHash("Sitid") + Inventory_IC2B(S2I(EXExecuteScript2("item", itid, "oldLevel"))))
          call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", last), EXExecuteScript2("item", itid, "Art"), 0)
          call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", last), EXExecuteScript2("item", itid, "Art"), 0)
        endif
        // * Sync Right Click Equip
        call DzSyncData("RCE", I2S(last))
      
      endif
    endif
  endif
endfunction

// 스냅 들어감 ====================================================================================================
private function SnapEnter takes nothing returns nothing
  set Snap = true
endfunction

// 스냅 나감 ====================================================================================================
private function SnapLeave takes nothing returns nothing
  if not Drag then
    set Snap = false
  endif
endfunction

// 키보드 V ====================================================================================================
private function KeyV takes nothing returns nothing
  if JNMemoryGetByte(JNGetModuleHandle("Game.dll") + 0xD04FEC) == 0 then
    set Inventory_Visility = not Inventory_Visility
    call Inventory_FrameShow(Inventory_Visility)
  endif
endfunction

// 키보드 ESC ====================================================================================================
private function ESC takes nothing returns nothing
  if Inventory_Visility then
    set Inventory_Visility = false
    call Inventory_FrameShow(Inventory_Visility)
  endif
endfunction

// 지연 초기화 ====================================================================================================
private function DelayedInit takes nothing returns nothing
  local integer UI = DzGetGameUI()
  local integer Main
  local integer loopA
  local integer loopB
  local integer temp
  local integer f

  // 메인 백드롭
  set Main = DzCreateFrame("EqSl_Back", UI, 0)
  call DzFrameSetAbsolutePoint(Main, JN_FRAMEPOINT_BOTTOM, 0.15, 0.43)
  call DzFrameShow(Main, false)
  call DzFrameSetScriptByCode(DzFrameFindByName("EqSl_Snap", 0), JN_FRAMEEVENT_MOUSE_ENTER, function SnapEnter, false)
  call DzFrameSetScriptByCode(DzFrameFindByName("EqSl_Snap", 0), JN_FRAMEEVENT_MOUSE_LEAVE, function SnapLeave, false)
  
  call DzFrameSetScriptByCode(DzFrameFindByName("EqSl_Close", 0), JN_FRAMEEVENT_CONTROL_CLICK, function Inventory_IconClick, false)
  
  // 각 칸
  set loopA = 0
  loop
  exitwhen loopA > 1
    set loopB = 0
    loop
    exitwhen loopB > 5
      set temp = loopB + loopA * 6 + FMI_MAXMAX_INVENTORY+1 /* 인벤토리는 0부터 시작했지만, 장착칸은 1부터 시작. 고멘 */ /* 57~69 */
      set f = DzCreateFrame("EqSl_Slot", Main, temp)
      call DzFrameSetPoint(f, JN_FRAMEPOINT_TOPLEFT, Main, JN_FRAMEPOINT_TOPLEFT, 0.0052 + loopB * 0.0385, - 0.037 - loopA * 0.05)
      call DzFrameSetScriptByCode(f, JN_FRAMEEVENT_MOUSE_ENTER, function MouseEnter, false)
      call DzFrameSetScriptByCode(f, JN_FRAMEEVENT_MOUSE_LEAVE, function MouseLeave, false)
      call DzFrameSetScriptByCode(f, JN_FRAMEEVENT_CONTROL_CLICK, function MouseClick, false)
      call SaveInteger(udg_hash, f, StringHash("number"), temp)
      
      if loopA == 0 then
        call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotClassBack", temp), "UI\\Widgets\\EscMenu\\Orc\\orc-options-button-highlight.blp", 0)
      else
        call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotClassBack", temp), "UI\\Widgets\\EscMenu\\Human\\human-options-button-highlight.blp", 0)
      endif
      call DzFrameSetText(DzFrameFindByName("EqSl_SlotClassName", temp), ClassName[temp])
      set loopB = loopB + 1
    endloop
    set loopA = loopA + 1
  endloop
  
  // Inventory연동 :: Inventory에서 아이템칸에 마우스 갖다댈 시 대응 부위 표시용 이펙트
  set f = DzCreateFrameByTagName("SPRITE", "EqSl_Active", Main, "", 0)
  call DzFrameSetModel(f, "UI-ModalButtonOn2.mdx", 0, 0)
  call DzFrameShow(f, false)
endfunction
  
// 초기화 ====================================================================================================
private function OnInit takes nothing returns nothing
  local trigger trg
  
  // * Sync Equip Click Change
  //! runtextmacro Sync("ECC")
  // * Sync Equip Click Empty
  //! runtextmacro Sync("ECE")
  // * Sync Equip Click Right
  //! runtextmacro Sync("ECR")
  
  // 지연 초기화
  call TimerStart(CreateTimer(), 0, false, function DelayedInit)
  set trg = null
endfunction

endscope//===========================================================================
// Trigger: Mouse In Common
//===========================================================================
// 마우스 관련 함수 한 곳에 모아 관리
scope MouseInCommon initializer OnInit

// 마우스 좌클릭 ====================================================================================================
private function MouseLeftClick takes nothing returns nothing
  if not Inventory_AreYouPickUp and Inventory_Snap and not Inventory_Drag then
    set Inventory_Drag = true
    call DzFrameSetUpdateCallbackByCode(function UpdateCallback_Start)
  elseif not EquipSlot_AreYouPickUp and EquipSlot_Snap and not EquipSlot_Drag then
    set EquipSlot_Drag = true
    call DzFrameSetUpdateCallbackByCode(function UpdateCallback_Start)
  endif
endfunction
private function MouseLeftDetach takes nothing returns nothing
  if Inventory_Drag then
    set Inventory_Drag = false
  endif
  if EquipSlot_Drag then
    set EquipSlot_Drag = false
  endif
endfunction





// 마우스 우클릭 ====================================================================================================
private function MouseRightClick takes nothing returns nothing
  local integer P = GetPlayerId(DzGetTriggerKeyPlayer())+1
  local integer i
  local integer itid
  local integer temp
  
  // 우클릭 기능이 동기화중이 아닐 시
  if RightClickEnable then
    // EquipSlot 연동 :: 템을 찝은 상태일 경우 찝기 해제
    if Inventory_AreYouPickUp or EquipSlot_AreYouPickUp then
      // 값 초기화, 프레임 숨기기
      set Inventory_LastSelected = -1
      set Inventory_AreYouPickUp = false
      call DzFrameShow(DzFrameFindByName("InVe_SelectedBack", 0), false)
      call DzFrameShow(DzFrameFindByName("InVe_MouseItem", 0), false)
      // EquipSlot 연동 :: 장착창에 장착 가능 칸 표시 숨김
      if EquipSlot_AreYouPickUp then
        call DzFrameShow(DzFrameFindByName("EqSl_SlotBlackBox", EquipSlot_LastSelected), false)
        set EquipSlot_LastSelected = -1
        set EquipSlot_AreYouPickUp = false
      endif
      call DzFrameShow(DzFrameFindByName("EqSl_Active", 0), false)
    // 템을 안찝은 상태일 경우 우클릭 메뉴 보이기
    else
      set i = 1
      loop
      exitwhen i >= FMI_MAXMAX_INVENTORY
        if Inventory_FrameIn[i] then
          exitwhen true
        endif
        set i = i + 1
      endloop
      if LoadBoolean(udg_hash, P, StringHash("bol") + i) then
        // 버리기 모드가 아닐 시
        if ( Inventory_MouseMode == 0 ) then
          // EquipSlot 연동 :: 텍스쳐 변경
          set itid = LoadInteger(udg_hash, P, StringHash("itid") + i)
          set temp = Inventory_IC2B(S2I(EXExecuteScript2("item", itid, "oldLevel")))
          
          //조건 검사
          if ( Inventory_EquipCheck(itid, P, LoadInteger(udg_hash, P, StringHash("itco") + i)) ) then
      
            // 해당 장착칸이 빈 칸일 경우
            if not LoadBoolean(udg_hash, P, StringHash("Sbol") + temp) then
              call DzFrameShow(DzFrameFindByName("InVe_DesBack", 0), false)
              call DzFrameShow(DzFrameFindByName("EqSl_DesBack", 0), false)
              call DzFrameShow(DzFrameFindByName("EqSl_Active", 0), false)
              call DzFrameShow(DzFrameFindByName("EqSl_SlotBlackBox", temp), false)
              call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotA", temp), EXExecuteScript2("item", itid, "Art"), 0)
              call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotB", temp), EXExecuteScript2("item", itid, "Art"), 0)
              call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", i), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
              call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", i), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
            // 해당 장착칸이 빈 칸이 아닐 경우
            else
              // EquipSlot 연동 :: 텍스쳐 교체
              call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotA", temp), EXExecuteScript2("item", itid, "Art"), 0)
              call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotB", temp), EXExecuteScript2("item", itid, "Art"), 0)
              set itid = LoadInteger(udg_hash, P, StringHash("Sitid") + temp)
              call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", i), EXExecuteScript2("item", itid, "Art"), 0)
              call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", i), EXExecuteScript2("item", itid, "Art"), 0)
              call Inventory_RefreshItemDes(P, itid, DzFrameFindByName("InVe_Slot", i), false)
            endif
            // 버튼 잠시 비활성화
            call DzFrameSetEnable(DzFrameFindByName("InVe_Slot", i), false)
            set RightClickEnable = false
            // * Sync Right Click Equip
            call DzSyncData("RCE", I2S(i))
            call DzFrameShow(DzFrameFindByName("EqSl_Back", 0), true)
          elseif ( EXExecuteScript2("item", itid, "stockMax") == "9" ) then /* 9스택 = 사용 가능한 아이템(리콜 등) */
            // 버튼 잠시 비활성화
            call DzFrameSetEnable(DzFrameFindByName("InVe_Slot", i), false)
            set RightClickEnable = false
            // * Sync Right Click UsableItem
            call DzSyncData("RCU", I2S(i))
            call DzFrameShow(DzFrameFindByName("EqSl_Back", 0), true)
          endif
        elseif ( Inventory_MouseMode == 1 ) then /* 제련취소 모드 - 단일 */
          set i = 1
          loop
            exitwhen i >= FMI_MAXMAX_INVENTORY
            if Inventory_FrameIn[i] then
              exitwhen true
            endif
            set i = i + 1
          endloop
          if ( LoadBoolean(udg_hash, P, StringHash("bol") + i) ) then
            if ( EXExecuteScript2("item", itid, "class") != "Miscellaneous" ) and ( LoadInteger(udg_hash, P, StringHash("itco") + i) > 0 ) then
              if ( HaveSavedInteger(udg_hash, itid, StringHash("FSE_T2I")) ) then
                // 버튼 잠시 비활성화
                call DzFrameSetEnable(DzFrameFindByName("InVe_Slot", i), false)
                set RightClickEnable = false
                // * Sync Right Click Reset
                call DzSyncData("RCR", I2S(i))
              else
                call MSG(Player(P-1),1,5,"세이브 가능한 아이템만 제련을 취소할 수 있습니다.")
              endif
            else
              call MSG(Player(P-1),1,5,"빛바랜 등 네임드 아이템을 선택해주세요.")
            endif
          endif
        elseif ( Inventory_MouseMode == 2 ) then /* 분해모드 - 단일 */
          set i = 1
          loop
            exitwhen i >= FMI_MAXMAX_INVENTORY
            if Inventory_FrameIn[i] then
              exitwhen true
            endif
            set i = i + 1
          endloop

          if ( LoadBoolean(udg_hash, P, StringHash("bol") + i) ) then
            if ( udg_SysA_ReloadEnd ) then
              //프레임 숨기기
              call DzFrameShow(DzFrameFindByName("InVe_DesBack", 0), false)
              call DzFrameShow(DzFrameFindByName("EqSl_DesBack", 0), false) /* EquipSlot 연동 */
              // 버튼 되돌리기
              call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", i), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
              call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", i), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
              // 버튼 잠시 비활성화
              call DzFrameSetEnable(DzFrameFindByName("InVe_Slot", i), false)
              set RightClickEnable = false
              // * Sync Right Click Throw
              call DzSyncData("RCI", I2S(i))
            else
              call MSG(Player(P-1),1,5,"10분 이후 진행해주세요.")
            endif
          endif
        elseif ( Inventory_MouseMode == 3 ) then /* 버리기 모드 - 단일 */
          set i = 1
          loop
            exitwhen i >= FMI_MAXMAX_INVENTORY
            if Inventory_FrameIn[i] then
              exitwhen true
            endif
            set i = i + 1
          endloop
          if ( LoadBoolean(udg_hash, P, StringHash("bol") + i) ) then
            //프레임 숨기기
            call DzFrameShow(DzFrameFindByName("InVe_DesBack", 0), false)
            call DzFrameShow(DzFrameFindByName("EqSl_DesBack", 0), false) /* EquipSlot 연동 */
            // 버튼 되돌리기
            call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", i), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
            call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", i), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
            // 버튼 잠시 비활성화
            call DzFrameSetEnable(DzFrameFindByName("InVe_Slot", i), false)
            set RightClickEnable = false
            // * Sync Right Click Throw
            call DzSyncData("RCT", I2S(i))
          endif
        elseif ( Inventory_MouseMode == 4 ) then /* 판매 모드 - 단일 */
          set i = 1
          loop
            exitwhen i >= FMI_MAXMAX_INVENTORY
            if Inventory_FrameIn[i] then
              exitwhen true
            endif
            set i = i + 1
          endloop

          if ( LoadBoolean(udg_hash, P, StringHash("bol") + i) ) then
            if ( EXExecuteScript2("item", LoadInteger(udg_hash, P, StringHash("itid") + i), "class") != "Miscellaneous" ) then
              //프레임 숨기기
              call DzFrameShow(DzFrameFindByName("InVe_DesBack", 0), false)
              call DzFrameShow(DzFrameFindByName("EqSl_DesBack", 0), false) /* EquipSlot 연동 */
              // 버튼 되돌리기
              call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", i), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
              call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", i), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
              // 버튼 잠시 비활성화
              call DzFrameSetEnable(DzFrameFindByName("InVe_Slot", i), false)
              set RightClickEnable = false
              // * Sync Right Click Throw
              call DzSyncData("RCS", I2S(i))
            else
              call MSG(Player(P-1), 1, 3, "장비류만 판매 가능합니다.")
            endif
          endif
        endif
      // EquipSlot 연동 :: 인벤토리 어느 칸도 작동이 안됐을 경우
      else
        set i = FMI_MAXMAX_INVENTORY+1
        loop
        exitwhen i > FMI_MAXMAX_INVENTORY+12
          if EquipSlot_FrameIn[i] then
            exitwhen true
          endif
          set i = i + 1
        endloop
        // 해당 장착칸에 템이 있을 경우
        if LoadBoolean(udg_hash, P, StringHash("Sbol") + i) then
          set temp = i
          set itid = LoadInteger(udg_hash, P, StringHash("Sitid") + temp)
          
          // 빈칸 찾기
          set i = 1
          loop
          exitwhen i >= FMI_MAX_INVENTORY+FMI_add_Inventory[P]
            if not LoadBoolean(udg_hash, P, StringHash("bol") + i) then
              exitwhen true
            endif
            set i = i + 1
          endloop
          
          if i < FMI_MAXMAX_INVENTORY then
            call DzFrameShow(DzFrameFindByName("InVe_DesBack", 0), false)
            call DzFrameShow(DzFrameFindByName("EqSl_DesBack", 0), false)
            call DzFrameShow(DzFrameFindByName("EqSl_Active", 0), false)
            call DzFrameShow(DzFrameFindByName("EqSl_SlotBlackBox", temp), false)
            call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotA", temp), "UI\\Console\\Human\\human-transport-slot.blp", 0)
            call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotB", temp), "UI\\Console\\Human\\human-transport-slot.blp", 0)
            call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", i), EXExecuteScript2("item", itid, "Art"), 0)
            call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", i), EXExecuteScript2("item", itid, "Art"), 0)
            
            // 버튼 잠시 비활성화
            call DzFrameSetEnable(DzFrameFindByName("EqSl_Slot", temp), false)
            set RightClickEnable = false
            // * Sync Equip Click Right
            call DzSyncData("ECR", I2S(temp) + "/" + I2S(i) + "/" + I2S(itid))
          endif
        endif
      endif
    endif
  endif
endfunction

// 초기화 ====================================================================================================
private function OnInit takes nothing returns nothing
  // 좌클릭
  local trigger trg = CreateTrigger()
  call DzTriggerRegisterMouseEventByCode(trg, JN_MOUSE_BUTTON_TYPE_LEFT, 1, false, function MouseLeftClick)
  // 좌클릭 떼기
  set trg = CreateTrigger()
  call DzTriggerRegisterMouseEventByCode(trg, JN_MOUSE_BUTTON_TYPE_LEFT, 0, false, function MouseLeftDetach)
  // 우클릭
  set trg = CreateTrigger()
  call DzTriggerRegisterMouseEventByCode(trg, JN_MOUSE_BUTTON_TYPE_MIDDLE, 0, false, function MouseRightClick)
  set trg = null
endfunction

endscope//===========================================================================
// Trigger: Level UP
//===========================================================================
constant function AUTO_STAT takes integer lv returns string
  //1노비스 2전사 3도적 4마법사 5성직자 6무도가
  if ( lv == 1 ) then
    return "003003003003003|003003003003003|003003003003003|003003003003003|003003003003003"
  elseif ( lv == 2 ) then
    return "003003003003005|003005003003003|003003005003003|003003003005003|005003003003003"
  elseif ( lv == 3 ) then
    return "004003003003006|003007003003003|003003007003003|003003003007003|007003003003003"
  elseif ( lv == 4 ) then
    return "006003003003006|003009003003003|003003009003003|003003003009003|009003003003003"
  elseif ( lv == 5 ) then
    return "008003003003006|003011003003003|003003011003003|003003003011003|011003003003003"
  elseif ( lv == 6 ) then
    return "010003003003006|004012003003003|003003013003003|003003004012003|013003003003003"
  elseif ( lv == 7 ) then
    return "012003003003006|006012003003003|003003015003003|003003006012003|015003003003003"
  elseif ( lv == 8 ) then
    return "014003003003006|008012003003003|003003017003003|003003008012003|016003003003004"
  elseif ( lv == 9 ) then
    return "016003003003006|010012003003003|003003017005003|003003010012003|016003003003006"
  elseif ( lv == 10 ) then
    return "016003003003008|012012003003003|003003017007003|003003012012003|016003003003008"
  elseif ( lv == 11 ) then
    return "016003003003010|014012003003003|003003017009003|003003014012003|016003003003010"
  elseif ( lv == 12 ) then
    return "018003003003010|016012003003003|003003019009003|003003016012003|016003003003012"
  elseif ( lv == 13 ) then
    return "020003003003010|018012003003003|003003021009003|003003017013003|016003003003014"
  elseif ( lv == 14 ) then
    return "022003003003010|018014003003003|003003023009003|003003017015003|018003003003014"
  elseif ( lv == 15 ) then
    return "024003003003010|018016003003003|003003025009003|003003017017003|020003003003014"
  elseif ( lv == 16 ) then
    return "026003003003010|018018003003003|003003025011003|003003017019003|020003003003016"
  elseif ( lv == 17 ) then
    return "028003003003010|020018003003003|003003025013003|003003017021003|020003003004017"
  elseif ( lv == 18 ) then
    return "030003003003010|020018003005003|003003025015003|003003017023003|020003003006017"
  elseif ( lv == 19 ) then
    return "032003003003010|020018003007003|003003025017003|003003017025003|020003003008017"
  elseif ( lv == 20 ) then
    return "032003003003012|020018003009003|003003027017003|003003017027003|020003003010017"
  elseif ( lv == 21 ) then
    return "032003003003014|020018004010003|003003029017003|003003018028003|020003005010017"
  elseif ( lv == 22 ) then
    return "032003003003016|020018006010003|003003031017003|003003020028003|020003007010017"
  elseif ( lv == 23 ) then
    return "032003003003018|020018008010003|003003033017003|003003022028003|020003009010017"
  elseif ( lv == 24 ) then
    return "032003003003020|020018010010003|003003035017003|003003024028003|020003011010017"
  elseif ( lv == 25 ) then
    return "032003003003022|020018012010003|003003037017003|003003026028003|020003013010017"
  elseif ( lv == 26 ) then
    return "032003003003024|020018014010003|003003039017003|003003028028003|022003013010017"
  elseif ( lv == 27 ) then
    return "034003003003024|020018015011003|003003041017003|003003030028003|024003013010017"
  elseif ( lv == 28 ) then
    return "036003003003024|020018016012003|003003043017003|003003032028003|025003013010018"
  elseif ( lv == 29 ) then
    return "038003003003024|020018018012003|003003045017003|003003034028003|025003013010020"
  elseif ( lv == 30 ) then
    return "040003003003024|020020018012003|003003047017003|003003035029003|025003013010022"
  elseif ( lv == 31 ) then
    return "042003003003024|020022018012003|003003049017003|003003035031003|025003013012022"
  elseif ( lv == 32 ) then
    return "044003003003024|020024018012003|003003049019003|003003035033003|025003013014022"
  elseif ( lv == 33 ) then
    return "046003003003024|020026018012003|003003049021003|003003035035003|025003013016022"
  elseif ( lv == 34 ) then
    return "046003003003026|020028018012003|003003049023003|003003035037003|025003013018022"
  elseif ( lv == 35 ) then
    return "046003003003028|020030018012003|003003049025003|003003035039003|025003013020022"
  elseif ( lv == 36 ) then
    return "046003003003030|020032018012003|003003049027003|003003035041003|025003013022022"
  elseif ( lv == 37 ) then
    return "046003003003032|020034018012003|003003049029003|003003037041003|025003013024022"
  elseif ( lv == 38 ) then
    return "046003003003034|020036018012003|003003049031003|003003039041003|025003013026022"
  elseif ( lv == 39 ) then
    return "046003003003036|020038018012003|003003049033003|003003041041003|025003015026022"
  elseif ( lv == 40 ) then
    return "046003003003038|020040018012003|003003049035003|003003043041003|025003017026022"
  elseif ( lv == 41 ) then
    return "046003003003040|020042018012003|003003049037003|003003045041003|025003019026022"
  elseif ( lv == 42 ) then
    return "048003003003040|020044018012003|003003051037003|003003045043003|025003021026022"
  elseif ( lv == 43 ) then
    return "050003003003040|020046018012003|003003053037003|003003046044003|025003023026022"
  elseif ( lv == 44 ) then
    return "052003003003040|020048018012003|003003055037003|003003048044003|025003025026022"
  elseif ( lv == 45 ) then
    return "054003003003040|020050018012003|003003057037003|003003050044003|025003027026022"
  elseif ( lv == 46 ) then
    return "056003003003040|020052018012003|003003057039003|003003052044003|025003029026022"
  elseif ( lv == 47 ) then
    return "058003003003040|020054018012003|003003057041003|003003053045003|025003030026022"
  elseif ( lv == 48 ) then
    return "060003003003040|020056018012003|003003057043003|003003053047003|027003030026022"
  elseif ( lv == 49 ) then
    return "062003003003040|020058018012003|003003057045003|003003053049003|029003030026022"
  elseif ( lv == 50 ) then
    return "062003003003042|020060018012003|003003057047003|003003054050003|031003030026022"
  elseif ( lv == 51 ) then
    return "062003003003044|020062018012003|003003057049003|003003056050003|033003030026022"
  elseif ( lv == 52 ) then
    return "062003003003046|020064018012003|003003059049003|003003058050003|035003030026022"
  elseif ( lv == 53 ) then
    return "062003003003048|020066018012003|003003061049003|003003058052003|037003030026022"
  elseif ( lv == 54 ) then
    return "062003003003050|020068018012003|003003063049003|003003058054003|039003030026022"
  elseif ( lv == 55 ) then
    return "062003003003052|020070018012003|003003065049003|003003059055003|041003030026022"
  elseif ( lv == 56 ) then
    return "062003003003054|020072018012003|003003067049003|003003061055003|043003030026022"
  elseif ( lv == 57 ) then
    return "064003003003054|022072018012003|003003069049003|003003063055003|044003030026023"
  elseif ( lv == 58 ) then
    return "066003003003054|024072018012003|003003071049003|003003065055003|044003030026025"
  elseif ( lv == 59 ) then
    return "068003003003054|026072018012003|003003073049003|003003067055003|044003030026027"
  elseif ( lv == 60 ) then
    return "070003003003054|028072018012003|003003075049003|003003069055003|044003030026029"
  elseif ( lv == 61 ) then
    return "071003003003055|030072018012003|003003077049003|003003069057003|044003030026031"
  elseif ( lv == 62 ) then
    return "071003003003057|032072018012003|003003079049003|003003069059003|044003030026033"
  elseif ( lv == 63 ) then
    return "072003003003058|034072018012003|003003081049003|003003070060003|044003030026035"
  elseif ( lv == 64 ) then
    return "074003003003058|036072018012003|003003083049003|003003070062003|044003030028035"
  elseif ( lv == 65 ) then
    return "076003003003058|038072018012003|003003083051003|003003070064003|044003030030035"
  elseif ( lv == 66 ) then
    return "078003003003058|040072018012003|003003083053003|003003070066003|044003031031035"
  elseif ( lv == 67 ) then
    return "080003003003058|042072018012003|003003083055003|003003071067003|044003033031035"
  elseif ( lv == 68 ) then
    return "082003003003058|044072018012003|003003083057003|003003073067003|044003035031035"
  elseif ( lv == 69 ) then
    return "084003003003058|046072018012003|003003083059003|003003075067003|044003037031035"
  elseif ( lv == 70 ) then
    return "086003003003058|046072018014003|003003083061003|003003077067003|044003039031035"
  elseif ( lv == 71 ) then
    return "086003003003060|046072020014003|003003083063003|003003079067003|044003042031035"
  elseif ( lv == 72 ) then
    return "088003003003060|046074020014003|003003085063003|003003080068003|046003042031035"
  elseif ( lv == 73 ) then
    return "090003003003060|046076020014003|003003087063003|003003082068003|048003042031035"
  elseif ( lv == 74 ) then
    return "092003003003060|046078020014003|003003089063003|003003084068003|050003042031035"
  elseif ( lv == 75 ) then
    return "093003003003061|046080020014003|003003089065003|003003086068003|052003042031035"
  elseif ( lv == 76 ) then
    return "093003003003063|046082020014003|003003089067003|003003087069003|054003042031035"
  elseif ( lv == 77 ) then
    return "093003003003065|046084020014003|003003089069003|003003087071003|056003042031035"
  elseif ( lv == 78 ) then
    return "093003003003067|046086020014003|003003091069003|003003087073003|058003042031035"
  elseif ( lv == 79 ) then
    return "095003003003067|046088020014003|003003092070003|003003089073003|060003042031035"
  elseif ( lv == 80 ) then
    return "097003003003067|046090020014003|003003093071003|003003091073003|062003042031035"
  elseif ( lv == 81 ) then
    return "099003003003067|046092020014003|003003095071003|003003093073003|064003042031035"
  elseif ( lv == 82 ) then
    return "101003003003067|046094020014003|003003097071003|003003093075003|066003042031035"
  elseif ( lv == 83 ) then
    return "103003003003067|048094020014003|003003099071003|003003095075003|068003042031035"
  elseif ( lv == 84 ) then
    return "105003003003067|050094020014003|003003101071003|003003096076003|070003042031035"
  elseif ( lv == 85 ) then
    return "107003003003067|052094020014003|003003103071003|003003096078003|072003042031035"
  elseif ( lv == 86 ) then
    return "109003003003067|054094020014003|003003105071003|003003096080003|074003042031035"
  elseif ( lv == 87 ) then
    return "111003003003067|056094020014003|003003107071003|003003096082003|076003042031035"
  elseif ( lv == 88 ) then
    return "113003003003067|058094020014003|003003109071003|003003096084003|078003042031035"
  elseif ( lv == 89 ) then
    return "115003003003067|060094020014003|003003111071003|003003096086003|079003042031036"
  elseif ( lv == 90 ) then
    return "117003003003067|062094020014003|003003113071003|003003096088003|079003042031038"
  elseif ( lv == 91 ) then
    return "119003003003067|064094020014003|003003115071003|003003096090003|079003043031039"
  elseif ( lv == 92 ) then
    return "121003003003067|066094020014003|003003117071003|003003096092003|079003045031039"
  elseif ( lv == 93 ) then
    return "123003003003067|068094020014003|003003119071003|003003096094003|079003047031039"
  elseif ( lv == 94 ) then
    return "125003003003067|070094020014003|003003121071003|003003096096003|079003049031039"
  elseif ( lv == 95 ) then
    return "127003003003067|072094020014003|003003123071003|003003096098003|079003051031039"
  elseif ( lv == 96 ) then
    return "129003003003067|074094020014003|003003125071003|003003096100003|079003053031039"
  elseif ( lv == 97 ) then
    return "129003003003069|076094020014003|003003125073003|003003098100003|079003053033039"
  elseif ( lv == 98 ) then
    return "129003003003071|078094020014003|003003125075003|003003100100003|079003053035039"
  elseif ( lv == 99 ) then
    return "129003003003073|080094020014003|003003125077003|003003102100003|079003053037039"
  endif
  return ""
endfunction
function AutoStat takes integer P, integer lv returns nothing
 local string s = FCut(AUTO_STAT(lv), S2I(SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2))-1)
 local integer i = 0
  if ( s != "" ) then
    if ( udg_SysE_STR1[P] < S2I(SubString(s,0,3)) ) then
      call StatePlus(P, 1, IMinBJ(S2I(SubString(s,0,3))-udg_SysE_STR1[P], GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)))
    endif
    if ( udg_SysE_DEX1[P] < S2I(SubString(s,3,6)) ) then
      call StatePlus(P, 2, IMinBJ(S2I(SubString(s,3,6))-udg_SysE_DEX1[P], GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)))
    endif
    if ( udg_SysE_INT1[P] < S2I(SubString(s,6,9)) ) then
      call StatePlus(P, 3, IMinBJ(S2I(SubString(s,6,9))-udg_SysE_INT1[P], GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)))
    endif
    if ( udg_SysE_WIS1[P] < S2I(SubString(s,9,12)) ) then
      call StatePlus(P, 4, IMinBJ(S2I(SubString(s,9,12))-udg_SysE_WIS1[P], GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)))
    endif
    if ( udg_SysE_CON1[P] < S2I(SubString(s,12,15)) ) then
      call StatePlus(P, 5, IMinBJ(S2I(SubString(s,12,15))-udg_SysE_CON1[P], GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)))
    endif
  endif
endfunction
function Trig_Level_UP_Conditions takes nothing returns boolean
 return ( isHero(GetTriggerUnit()) and not udg_SysA_Item )
endfunction

function PingPlayer takes player p, rect r, real duration returns nothing
  if ( GetLocalPlayer() == p ) then
    call PingMinimap(GetRectCenterX(r), GetRectCenterY(r), duration)
  endif
endfunction

function CongraPlayer takes integer P, integer lv returns nothing
 //local string s = PlayerNames(P)
 //local string s2 = "Lv"+I2S(lv)+"/"+udg_SysB_Name[P]+"_"+I2S(GetRandomInt(10,99))
  if ( GetLocalPlayer() == Player(P-1) ) then
    //call JNSetSaveCode(JN_MAPID, "Log_Items", JN_SECRETKEY, s2, s)
    call JNPublicMapServerLog(JN_MAPID, JN_SECRETKEY, BaseStr(9), "["+BaseStr(9)+"] "+ udg_SysB_Name[P]+"("+GetUnitName(udg_Unit[P])+")님이 "+I2S(lv)+"레벨을 달성했습니다.")
    call JNSetLogUseType(JN_MAPID, udg_SysB_Name[P], JN_SECRETKEY, "0_0", BaseStr(9), "["+BaseStr(9)+"] "+ udg_SysB_Name[P]+"("+GetUnitName(udg_Unit[P])+")님이 "+I2S(lv)+"레벨을 달성했습니다.", "Lv")
  endif
endfunction
function Trig_Level_UP_Actions takes nothing returns nothing
 local unit u = GetTriggerUnit()
 local integer P = GetPlayerId(GetOwningPlayer(u))+1
 local integer i = GetUnitLevel(u)
  if ( i < 100 ) then
    // 레벨업, 2포인트
    call MSG(GetOwningPlayer(u), 2, 8, I2S(i)+" |c008000ffL|c00750bffe|c006a16ffv|c005f21ffe|c00542cffl|c004937ff |c003e42ffU|c00334dffP|c002858ff!|c001d63ff!|c000080ff |r")
    if ( udg_SysB_Level[P] == 0 ) then
      call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)+2*i)
    else
      set i = i-udg_SysB_Level[P]
//debug call BJDebugMsg("LvUP: 체마 상승량: " + I2S(i*(53+R2I(udg_SysE_CON1[P]*BaseValue(19)))) + " / " + I2S(i*(53+R2I(udg_SysE_WIS1[P]*BaseValue(19)))))
      set udg_Save_HP[P] = udg_Save_HP[P] + i*R2I(udg_SysE_CON1[P]*BaseValue(19))
      call SetUS("Hp", u, i*(SysInt(0,17)+R2I(udg_SysE_CON1[P]*BaseValue(19))), true)
      set udg_Save_MP[P] = udg_Save_MP[P] + i*R2I(udg_SysE_WIS1[P]*BaseValue(20))
      call SetUS("Mp", u, i*(SysInt(0,18)+R2I(udg_SysE_WIS1[P]*BaseValue(20))), true)
      set udg_SysB_Level[P] = GetUnitLevel(u)

      call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)+2*i)
      call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\newlevelup.mdx", u, "origin"))
      if ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) > 15 ) and ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) <= 24 ) then
        call TriggerSleepAction(2.)
        call MSG(GetOwningPlayer(u), 2, 15, "|c00ff0000※주의! 포인트(나무)가 25 이상이 되면 게임에서 추방됩니다. 현재 포인트: |r"+I2S(GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER))+")")
      elseif ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) >= 25 ) then
        call MSG(GetOwningPlayer(u), 2, 3, "|c00ffff00※게임에서 추방됩니다.|r")
        call OnlineGame(Player(P-1), 7, "")
      endif
      
      if ( not LoadBoolean(udg_hash, StringHash("NoAutoStat"), P) ) then
        call AutoStat(P, udg_SysB_Level[P])
        call MSG(Player(P-1), 1, 4, "자동스텟을 찍었습니다.")
      else
        call MSG(Player(P-1), 1, 8, "사용가능한 능력치가 생겼습니다. 현재 '|c00d962b5" + I2S(GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)) + "|cffffdc3c'개 있습니다.")
        if ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) >= 7 ) then
          call MSG(Player(P-1), 1, 3, "   스텟이 7개 이상입니다. 스텟을 찍어 주세요.")
          call SelectUnitForPlayerSingle(udg_Unit[P], Player(P-1))
        elseif ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) >= 3 ) then
          call MSG(Player(P-1), 1, 8, "   \"-힘 1~10\" 같은 방식으로 스텟을 찍어 주세요. 힘/덱/인/위/콘")
        endif
      endif
    endif
    
    // 기본 아머 설정
    if ( udg_SysC_Armor_B[P] < i / 3 ) then
      set udg_SysC_Armor[P] = ( udg_SysC_Armor[P] - udg_SysC_Armor_B[P] )
      set udg_SysC_Armor_B[P] = i / 3
      call SetUS("Armor", u, udg_SysC_Armor_B[P], true)
      call MSG(GetOwningPlayer(u), 2, 8, "|cffd1d1d1기본아머가 |cff46ffff1|cffd1d1d1 상승하였습니다. ( |cffffdc3c현재 기본AC|r : |cff9932cc"+I2S(udg_SysC_Armor_B[P])+"|cffd1d1d1 )")
    endif
    // 공격력 증가
    call SetUS("Dmg", u, SysInt(0,16)*i, true)
    // 레벨별 이벤트
    if ( udg_SysB_Level[P] == 6 ) and ( GetUnitTypeId(u) == 'H000' ) then
      call TriggerSleepAction(3.)
      call MSG(GetOwningPlayer(u), 2, 35, "|c00ffff00전직 가능한 레벨이 되었습니다. 지금, 밀레스에 있는 신전으로 가셔셔 전직을 하시길 바랍니다.|r")
      call UnitAddItemByIdSwapped('I00S', u)
      call PingPlayer(Player(P-1), gg_rct_Effect_07, 6.)
    elseif ( udg_SysB_Level[P] == 11 ) then
      if ( udg_SysB_TitleNow[P] == 1 ) then
        call Title_Reset(P)
      endif
      call TitleSet(P, 1, 2)
      call MSG(Player(P-1), 1, 8, "칭호, |cff46ffff2서클|cffffdc3c을 받았습니다. (유저 칭호 사라짐)")
      
      call MSGAll(0, true, 1, 1, 20., "축하합니다! "+SysStr(2,P)+GetPlayerName(Player(P-1))+"|cffffdc3c("+SysStr(2,P)+GetUnitName(u)+"|cffffdc3c)님이 |c00d962b52|cffffdc3c서클이 되었습니다.")
      call MSG(Player(P-1), 1, 20, "축하합니다! |c00d962b52|cffffdc3c서클에 달성하였습니다. 관련 마을 : |c00d962b5《루어스》")
      call UnitAddItemByIdSwapped('I00U', u)
    elseif ( udg_SysB_Level[P] == 40 ) then
      call TriggerSleepAction(3.)
      call UnitAddItemByIdSwapped('wild', u)
      call MSG(Player(P-1), 2, 10, "|c00ffff0040레벨 달성 보상으로, 초기화 물약이 지급되었습니다.")
    elseif ( udg_SysB_Level[P] == 41 ) then
      call MSGAll(0, true, 1, 1, 20., "축하합니다! "+SysStr(2,P)+GetPlayerName(Player(P-1))+"|cffffdc3c("+SysStr(2,P)+GetUnitName(u)+"|cffffdc3c)님이 |c00d962b53|cffffdc3c서클이 되었습니다.")
      call MSG(Player(P-1), 1, 20, "축하합니다! |c00d962b53|cffffdc3c서클에 달성하였습니다. 관련 마을 : |c00d962b5《아벨》")
      call UnitAddItemByIdSwapped('I00X', u)
      call TriggerSleepAction(5.)
      call MSG(GetTriggerPlayer(), 2, 8, BaseStr(10))
      
      call TriggerSleepAction(5.)
      if ( udg_SysB_TitleNow[P] == 1 ) then
        call Title_Reset(P)
      endif
      call TitleSet(P, 1, 3)
      call MSG(Player(P-1), 1, 8, "칭호, |cff46ffff3서클|cffffdc3c을 받았습니다. (2서클 칭호 사라짐)")
      call TriggerSleepAction(5.)
      call CongraPlayer(P, 41)
      if ( udg_SysA_COUNT > 0 ) then
        call TriggerSleepAction(5.)
        call MSG(Player(P-1), 1, 8, "같이한 사람이 있다면, 카페 가입 후 |cff46ffff사제|cffffdc3c 칭호를 받을 수 있습니다. \"|cffc3dbff-카페|cffffdc3c\"를 입력하세요.")
      endif
    elseif ( udg_SysB_Level[P] == 71 ) then
      call MSGAll(0, true, 1, 1, 20., "축하합니다! "+SysStr(2,P)+GetPlayerName(Player(P-1))+"|cffffdc3c("+SysStr(2,P)+GetUnitName(u)+"|cffffdc3c)님이 |c00d962b54|cffffdc4c서클이 되었습니다.")
      call MSG(Player(P-1), 1, 20, "축하합니다! |c00d962b54|cffffdc3c서클에 달성하였습니다. 관련 마을 : |c00d962b5《뤼케시온》")
      call UnitAddItemByIdSwapped('I00W', u)
      call TriggerSleepAction(5.)
      call MSG(GetTriggerPlayer(), 2, 8, BaseStr(10))
      call TriggerSleepAction(5.)
      if ( udg_SysB_TitleNow[P] == 1 ) then
        call Title_Reset(P)
      endif
      call TitleSet(P, 1, 4)
      call MSG(Player(P-1), 1, 8, "칭호, |cff46ffff4서클|cffffdc3c을 받았습니다. (3서클 칭호 사라짐)")
      call TriggerSleepAction(5.)
      call CongraPlayer(P, 71)
    elseif ( udg_SysB_Level[P] == 86 ) then
      call CongraPlayer(P, 86)
    elseif ( udg_SysB_Level[P] == 99 ) then
      call MSGAll(0, true, 1, 1, 20., "축하합니다! "+SysStr(2,P)+GetPlayerName(Player(P-1))+"|cffffdc3c("+SysStr(2,P)+GetUnitName(u)+"|cffffdc3c)님이 |c00d962b55|cffffdc5c서클이 되었습니다.")
      call MSG(Player(P-1), 1, 20, "축하합니다! |c00d962b55|cffffdc3c서클에 달성하였습니다. 관련 마을 : |c00d962b5《마인》")
      if ( udg_SysB_TitleNow[P] == 1 ) then
        call Title_Reset(P)
      endif
      call TitleSet(P, 1, 5)
      call MSG(Player(P-1), 1, 8, "칭호, |cff46ffff5서클|cffffdc3c을 받았습니다. (4서클 칭호 사라짐)")
      call TriggerSleepAction(5.)
      call CongraPlayer(P, 99)
    elseif ( ModuloInteger(udg_SysB_Level[P], 17) == 0 ) then
      call TriggerSleepAction(5.)
      call MSG(GetTriggerPlayer(), 2, 8, BaseStr(10))
    endif
    if ( udg_SysI_Exct[P] ) then
      call TriggerSleepAction(60.)
      set udg_SysI_Exct[P] = false
    endif
  else
    // 99→100, 포인트 2 획득 및 경험치 저장
    set udg_temp_i = GetHeroXP(u) - LoadInteger(udg_hash, 100, StringHash("Exp1"))
    
    call UnitStripHeroLevel(u, 1)
    call SaveInteger(udg_hash, P, StringHash("Exp"), LoadInteger(udg_hash, P, StringHash("Exp"))-LoadInteger(udg_hash, 100, StringHash("Exp2")))
    call AddHeroXP(u, udg_temp_i, false)
    call DestroyEffect( AddSpecialEffectTarget("war3mapImported\\newlevelup.mdx", u, "origin") )
    call MSG(GetOwningPlayer(u), 1, 3, "경험치를 모아, 포인트를 2 획득하였습니다.")
    call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)+2)
  endif
 set u = null
endfunction

//===========================================================================
function InitTrig_Level_UP takes nothing returns nothing
    set gg_trg_Level_UP = CreateTrigger(  )
    call TriggerAddCondition( gg_trg_Level_UP, Condition( function Trig_Level_UP_Conditions ) )
    call TriggerAddAction( gg_trg_Level_UP, function Trig_Level_UP_Actions )
endfunction

//===========================================================================
// Trigger: Select Novice
//===========================================================================
constant function SelectUnitOX takes unit u returns integer
  if ( u == gg_unit_e00A_0041 ) then
    return 1
  elseif ( u == gg_unit_H017_0002 ) then
    return 'H000'
  elseif ( u == gg_unit_H019_0113 ) then
    return 'H002'
  elseif ( u == gg_unit_H01A_0107 ) then
    return 'H003'
  elseif ( u == gg_unit_H01D_0110 ) then
    return 'H006'
  elseif ( u == gg_unit_H01C_0109 ) then
    return 'H004'
  elseif ( u == gg_unit_H01B_0111 ) then
    return 'H005'
  elseif ( u == gg_unit_nbse_0176 ) then
    return 2
  elseif ( u == gg_unit_nbse_0182 ) then
    return 3
  elseif ( u == gg_unit_nbse_0180 ) then
    return 4
  elseif ( u == gg_unit_nbse_0183 ) then
    return 5
  elseif ( u == gg_unit_nbse_0181 ) then
    return 6
  elseif ( u == gg_unit_nbsw_0179 ) then
    return 7
  elseif ( u == gg_unit_nbsw_0186 ) then
    return 7
  elseif ( u == gg_unit_nbsw_0184 ) then
    return 7
  elseif ( u == gg_unit_nbsw_0187 ) then
    return 7
  elseif ( u == gg_unit_nbsw_0185 ) then
    return 7
  else
    return 0
  endif
endfunction
function Trig_Select_Novice_Conditions takes nothing returns boolean
  return ( udg_Save_Count[GetPlayerId(GetTriggerPlayer())+1] <= 0 ) and ( SelectUnitOX(GetTriggerUnit()) > 0 )
endfunction
function Trig_Select_Novice_Actions takes nothing returns nothing
  local integer P = GetPlayerId(GetTriggerPlayer())+1
  local integer select = SelectUnitOX(GetTriggerUnit())

  if ( select == 1 ) then
    call SetUnitAnimationByIndex(GetTriggerUnit(), 1 )
    call TriggerExecute( gg_trg_FAL_Load1 )
  elseif ( select <= 7 ) then
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagText(bj_lastCreatedTextTag, "|cffffdc3c"+FCut(GetPathS(select-1),1), 0.023)
    call SetTextTagPos(bj_lastCreatedTextTag, GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), 100.)
    call SetTextTagColor(bj_lastCreatedTextTag, 255, 255, 255, 255)
    call Bufftt(bj_lastCreatedTextTag, 0)
    if ( select == 7 ) then
      call SetTextTagText(bj_lastCreatedTextTag, "|c0055ff55"+udg_SysB_Name[P], 0.019)
    else
      call SetTextTagText(bj_lastCreatedTextTag, "|c0055ff55"+FCut(GetPathS(select-1),2), 0.019)
    endif
    call SetTextTagPos(bj_lastCreatedTextTag, GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), 30.)
    call SetTextTagColor(bj_lastCreatedTextTag, 255, 255, 255, 255)
    call Bufftt(bj_lastCreatedTextTag, 0)
    
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagText(bj_lastCreatedTextTag, "|cff46ffff"+FCut(GetPathS(select-1),3), 0.019)
    call SetTextTagPos(bj_lastCreatedTextTag, GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), -20.)
    call SetTextTagColor(bj_lastCreatedTextTag, 255, 255, 255, 255)
    call Bufftt(bj_lastCreatedTextTag, 0)
    
    if ( StringLength(FCut(GetPathS(select-1),4)) > 0 ) then
      set bj_lastCreatedTextTag = CreateTextTag()
      call SetTextTagText(bj_lastCreatedTextTag, "|cffc3dbff"+FCut(GetPathS(select-1),4), 0.019)
      call SetTextTagPos(bj_lastCreatedTextTag, GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), -70.)
      call SetTextTagColor(bj_lastCreatedTextTag, 255, 255, 255, 255)
      call Bufftt(bj_lastCreatedTextTag, 0)
    endif
  elseif ( select > 0 ) then
    if ( select != -udg_Save_Count[P] ) then
      set udg_Save_Count[P] = -select
      call MSG(GetTriggerPlayer(), 1, 6, "한번 더 클릭하여 시작합니다.")
    elseif ( select == -udg_Save_Count[P] ) then
      //싱글방지
      if ( not JNUse() ) then
        if ( not JNUse() ) then
          call OnlineGame(Player(P-1), 2, "")
        endif
      endif
      
      if ( GetLocalPlayer() == GetTriggerPlayer() ) then
        call SetCameraQuickPosition(GetRectCenterX(gg_rct_Setting_Start), GetRectCenterY(gg_rct_Setting_Start))
      endif
      if ( select == 'H000' ) then
        if ( GetRandomReal(0., 100.) <= 20. ) then
          set select = 'H002'
        elseif ( GetRandomReal(0., 80.) <= 20. ) then
          set select = 'H003'
        elseif ( GetRandomReal(0., 60.) <= 20. ) then
          set select = 'H006'
        elseif ( GetRandomReal(0., 40.) <= 20. ) then
          set select = 'H004'
        else
          set select = 'H005'
        endif
      endif
      set udg_Unit[P] = CreateUnit(Player(P-1), select, GetRectCenterX(gg_rct_Setting_Start), GetRectCenterY(gg_rct_Setting_Start), GetRandomReal(0,360))
      call SelectUnitForPlayerSingle( udg_Unit[P], GetTriggerPlayer() )
      set udg_SysB_Level[P] = 1
      set udg_Save_Count[P] = 1
      set udg_SysE_STR1[P] = 3
      set udg_SysE_DEX1[P] = 3
      set udg_SysE_INT1[P] = 3
      set udg_SysE_WIS1[P] = 3
      set udg_SysE_CON1[P] = 3
      set udg_SysE_STR3[P] = udg_SysE_STR1[P] + udg_SysE_STR2[P]
      set udg_SysE_DEX3[P] = udg_SysE_DEX1[P] + udg_SysE_DEX2[P]
      set udg_SysE_INT3[P] = udg_SysE_INT1[P] + udg_SysE_INT2[P]
      set udg_SysE_WIS3[P] = udg_SysE_WIS1[P] + udg_SysE_WIS2[P]
      set udg_SysE_CON3[P] = udg_SysE_CON1[P] + udg_SysE_CON2[P]
      call SetHeroStr(udg_Unit[P], 3, true)
      call SetHeroAgi(udg_Unit[P], 3, true)
      call SetHeroInt(udg_Unit[P], 3, true)
      set udg_SysC_DmgNow[P] = "최근: 0"
      call UnitAddItem(udg_Unit[P], CreateItem('I09V', 0, 0))
      call TriggerSleepAction(5.)
      call MSG(GetTriggerPlayer(), 1, 6, "초보자 지침서(단축키 Z)를 클릭해 보세요.")
      call TriggerSleepAction( 60.00 )
      if ( udg_Quest_00_Note[P] == 0 ) then
        call MSG(GetTriggerPlayer(), 1, 6, "초보자 지침서(단축키 Z)를 클릭해 보세요.")
      endif
    endif
  endif
endfunction

//===========================================================================
function InitTrig_Select_Novice takes nothing returns nothing
    set gg_trg_Select_Novice = CreateTrigger(  )
    call TriggerAddCondition( gg_trg_Select_Novice, Condition( function Trig_Select_Novice_Conditions ) )
    call TriggerAddAction( gg_trg_Select_Novice, function Trig_Select_Novice_Actions )
endfunction

//===========================================================================
// Trigger: Selcet N TD
//===========================================================================
function Trig_Selcet_N_TD_Actions takes nothing returns nothing
    call DestroyTimerDialog(LoadTimerDialogHandle(udg_hash, StringHash("Select Timer"), StringHash("TEMP")))
    call MSGAll(0, true, 1, 1, 15., "캐릭터 선택/로드 후 10분이 지났습니다. 이제부터 제련이 가능하며, 리로드시 다시 10분 후 가능합니다.")
    set udg_SysA_ReloadEnd = true
endfunction

//===========================================================================
function InitTrig_Selcet_N_TD takes nothing returns nothing
    set gg_trg_Selcet_N_TD = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Selcet_N_TD, function Trig_Selcet_N_TD_Actions )
endfunction

//===========================================================================
// Trigger: Select Skin
//
// 0. 변경용 모델 생성 (노비스 이용?)
// 1. 유닛 선택하면 캐릭터 변경
// 2. -스킨 입력하면 화면 이동, 선택 가능하면서 트리거 활성화 / esc 눌러서 다시 취소
//  └ 한번에 한명씩, 플레이어 변수로 추가, 이전 트리거 제거
// 3. 모델데이터 - 변경될모델 | 직업데이터 | 가격데이터?
// 4. 시작시 FCut,"0_0",4 해서 가져오기, 설정값, 모델값 - 구매한 모델이면 1, 아니면 0 표시 (인코딩?)
//===========================================================================
constant function JOBNAME3 takes integer No returns string
  if ( No == 2 ) then
    return "전사"
  elseif ( No == 3 ) then
    return "도적"
  elseif ( No == 4 ) then
    return "마법사"
  elseif ( No == 5 ) then
    return "성직자"
  elseif ( No == 6 ) then
    return "무도가"
  else
    return ""
  endif
endfunction

function ChangeModel takes integer P, string data returns nothing
debug call BJDebugMsg("P/D - "+I2S(P) +"/"+ data)
  call DzSetUnitModel(udg_Unit[P], FCut(data,3))
  call DzSetUnitModel(LoadUnitHandle(udg_hash, P, StringHash("FMi-Model")), FCut(data,3))
endfunction
function Trig_Select_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetTriggerPlayer())+1
    //직업 비교
  if ( SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2) == FCut(FCM_U2D(GetTriggerUnit()),2) ) then
    if ( SubString(FCut(udg_SysB_SkinOX[P],2),S2I(FCut(FCM_U2D(GetTriggerUnit()),1))-1,S2I(FCut(FCM_U2D(GetTriggerUnit()),1))) == "1" ) then
      call ChangeModel(P, FCM_U2D(GetTriggerUnit()))
      call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", GetWidgetX(GetTriggerUnit()), GetWidgetX(GetTriggerUnit())) )
      call MSG(Player(P-1), 1, 6, JOBNAME3(S2I(SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2)))+"의 스킨을 변경하였습니다.")
      call TriggerSleepAction(.5)
      call ForceUICancelBJ(Player(P-1))
      set udg_SysB_SkinOX[P] = FCut(FCM_U2D(GetTriggerUnit()),1)+"|"+FCut(udg_SysB_SkinOX[P],2)
    else
      call MSG(Player(P-1), 1, 6, "해당스킨은 별도 신청이 필요합니다. -오픈채팅에서 문의해주세요.")
    endif
  else
    call MSG(Player(P-1), 1, 6, "직업에 맞는 스킨을 골라주세요. " + JOBNAME3(S2I(FCut(FCM_U2D(GetTriggerUnit()),2))) + "(이)가 아닌, "+JOBNAME3(S2I(SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2)))+"의 스킨만 선택 가능합니다.")
  endif
endfunction


//===========================================================================
function InitTrig_Select_Skin takes nothing returns nothing
  set gg_trg_Select_Skin = CreateTrigger()
  call TriggerAddAction( gg_trg_Select_Skin, function Trig_Select_Actions )
endfunction

//===========================================================================
// Trigger: Auto Setting 1
//
// 퀘스트레벨 != 9
// 마지막 아이템 - 취소/돌아가기 아니거나
// 빈 아이템이면
//===========================================================================
function Trig_Auto_Setting_Start_Conditions takes nothing returns boolean
 return ( GetUnitAbilityLevel(GetTriggerUnit(), 'A013') == 0 ) and ( isHero(GetTriggerUnit()) )
endfunction

function Regen takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local integer P = LoadInteger(udg_hash, GetHandleId(t), StringHash("Regen-P"))
 local boolean HP = LoadBoolean(udg_hash, GetHandleId(t), StringHash("Regen-Type"))
 local real r = 25.
  if ( isPlaying(Player(P-1)) ) then
    if ( HP ) then
    //HP 리젠
      if ( udg_SysE_CON3[P] >= 166 ) then
        if ( udg_SysE_CON3[P] >= 211 ) then
          set r = RMaxBJ(1.,r-I2R((udg_SysE_CON3[P]-151)/3))
        else
          set r = r-I2R(((udg_SysE_CON3[P]-151)/15)*5)
        endif
      endif
      call TimerStart(t, r, false, function Regen)
	  if ( UnitAlive(udg_Unit[P]) ) then
	    //CON(아이템 포함)이 레벨보다 높을 때, 콘당 1% 추가회복 (최대 10%)
        set r = (10.+RMinBJ(10,RMaxBJ(0,I2R(udg_SysE_CON3[P]-IMinBJ(99,udg_SysB_Level[P]))))) * ((100+udg_SysC_Regen[P])/100.)
	    if ( not IsUnitPaused(udg_Unit[P]) ) then
          if ( GetRandomReal(0,100) < 5 ) then
            call SaveStr(udg_hash, P, StringHash("Regen-View"), " " + BaseStr(5) + R2SW(r,2,1) + "％ |r/ 회 ")
            call Bufftt(CreateTextTagUnitBJ("Hp +" + R2SW(r,2,1) + "％", udg_Unit[P], 30., 9., 100., 0., 0., 0), 1)
            set r = GetUnitState(udg_Unit[P], UNIT_STATE_MAX_LIFE) * r/100
          else
            set r = GetUnitState(udg_Unit[P], UNIT_STATE_MAX_LIFE) * r/100
            if ( r > 999 ) then
              if ( r > 9999 ) and ( TimerGetTimeout(t) > 9.9 ) then
                call SaveStr(udg_hash, P, StringHash("Regen-View"), BaseStr(5) + I2S(R2I(r)) + "|r/"+ I2S(R2I(TimerGetTimeout(t))) +"s")
              else
                call SaveStr(udg_hash, P, StringHash("Regen-View"), " " + BaseStr(5) + I2S(R2I(r)) + "|r/"+ I2S(R2I(TimerGetTimeout(t))) +"s ")
              endif
            else
              call SaveStr(udg_hash, P, StringHash("Regen-View"), " " + BaseStr(5) + I2S(R2I(r)) + "|r / "+ I2S(R2I(TimerGetTimeout(t))) +"s ")
            endif
            call Bufftt(CreateTextTagUnitBJ("Hp +" + I2S(R2I(r)), udg_Unit[P], 30., 9., 100., 0., 0., 0), 1)
          endif
          call SetWidgetLife(udg_Unit[P], GetWidgetLife(udg_Unit[P])+r)
	    else
		  call TimerStart(t, 1., false, function Regen)
		endif
	  endif
    else
    //MP 리젠
	  call TimerStart(t, 25, false, function Regen)
	  if ( UnitAlive(udg_Unit[P]) ) then
        if ( udg_SysE_WIS3[P] >= 110 ) and ( GetRandomReal(0.,100.) <= (udg_SysE_WIS3[P]-100)/5. ) then
          set r = (10.+RMinBJ(10,RMaxBJ(0,I2R(udg_SysE_WIS3[P]-IMinBJ(99,udg_SysB_Level[P]))))) * ((100+udg_SysC_Regen[P])/100.) * udg_SysC_CriX[P]
        else
          set r = (10.+RMinBJ(10,RMaxBJ(0,I2R(udg_SysE_WIS3[P]-IMinBJ(99,udg_SysB_Level[P]))))) * ((100+udg_SysC_Regen[P])/100.)
        endif
        if ( not IsUnitPaused(udg_Unit[P]) ) then
          if ( GetRandomReal(0,100) < 5 ) then
            call SaveStr(udg_hash, P, StringHash("Regen-View"), " " + BaseStr(5) + R2SW(r,2,1) + "％ |r/ 회 ")
            call Bufftt(CreateTextTagUnitBJ( "Mp +" + I2S(R2I(r)) + "％", udg_Unit[P], -30., 9., 0., 0., 100., 0 ), 1)
            set r = GetUnitState(udg_Unit[P], UNIT_STATE_MAX_MANA) * r/100
          else
            set r = GetUnitState(udg_Unit[P], UNIT_STATE_MAX_MANA) * r/100
            if ( r > 999 ) then
              if ( r > 9999 ) and ( TimerGetTimeout(t) > 9.9 ) then
                call SaveStr(udg_hash, P, StringHash("Regen-View"), BaseStr(4) + I2S(R2I(r)) + "|r/"+ I2S(R2I(TimerGetTimeout(t))) +"s")
              else
                call SaveStr(udg_hash, P, StringHash("Regen-View"), " " + BaseStr(4) + I2S(R2I(r)) + "|r/"+ I2S(R2I(TimerGetTimeout(t))) +"s ")
              endif
            else
              call SaveStr(udg_hash, P, StringHash("Regen-View"), " " + BaseStr(4) + I2S(R2I(r)) + "|r / "+ I2S(R2I(TimerGetTimeout(t))) +"s ")
            endif
            call Bufftt(CreateTextTagUnitBJ( "Mp +" + I2S(R2I(r)), udg_Unit[P], -30., 9., 0., 0., 100., 0 ), 1)
          endif
          call SetUnitState(udg_Unit[P], UNIT_STATE_MANA, RMaxBJ(0,GetUnitState(udg_Unit[P], UNIT_STATE_MANA)+r))
        endif
	  endif
    endif  
  else
    call PauseTimer(t)
    call FlushChildHashtable(udg_hash, GetHandleId(t))
    call DestroyTimer(t)
  endif
 set t = null
endfunction
constant function BugData takes integer i returns integer
  if ( i == 1 ) then
  //레벨
    return 10
  elseif ( i == 2 ) then
  //경험치
    return 1500000
  elseif ( i == 3 ) then
  //스텟들
    return 27
  elseif ( i == 4 ) then
  //아머 제한
    return 201
  elseif ( i == 5 ) then
  //마방 제한
    return 150
  elseif ( i == 6 ) then
  //평타 데미지 제한
    return 7000
  elseif ( i == 7 ) then
  //크리 확률 제한
    return 150
  elseif ( i == 8 ) then
  //크리 배율 제한 // 소숫점 직접 설정
    return 5
  elseif ( i == 9 ) then
  //보조스텟 - DAM 제한
    return 200
  elseif ( i == 10 ) then
  //보조스텟 - REGEN 제한
    return 500
  elseif ( i == 11 ) then
  //보조스텟 - 명중률 제한
    return 200
  elseif ( i == 12 ) then
  //추가스텟 총합 제한
    return 75
  elseif ( i == 13 ) then
  //추가 드랍률/경험치%/골드 제한
    return 390
  elseif ( i == 14 ) then
  //포인트(나무)
    return 30
  elseif ( i == 15 ) then
  //추가체력
    return 350000
  else
    return -1
  endif
endfunction
constant function S2S takes string s returns string
  if ( s == "8A" ) then
    return "레벨"
  elseif ( s == "8B" ) then
    return "경험치"
  elseif ( s == "8C" ) then
    return "스텟A"
  elseif ( s == "8D" ) then
    return "스텟B"
  elseif ( s == "8E" ) then
    return "스텟C"
  elseif ( s == "8F" ) then
    return "스텟D"
  elseif ( s == "8G" ) then
    return "스텟E"
  elseif ( s == "8H" ) then
    return "방어"
  elseif ( s == "8I" ) then
    return "마방"
  elseif ( s == "8J" ) then
    return "평타"
  elseif ( s == "8K" ) then
    return "크리%"
  elseif ( s == "8L" ) then
    return "크리x"
  elseif ( s == "8M" ) then
    return "뎀"
  elseif ( s == "8N" ) then
    return "재생"
  elseif ( s == "8O" ) then
    return "힛"
  elseif ( s == "8P" ) then
    return "스텟+"
  elseif ( s == "8Q" ) then
    return "Exp2"
  elseif ( s == "8R" ) then
    return "Drop2"
  elseif ( s == "8S" ) then
    return "Wood2"
  elseif ( s == "8T" ) then
    return "HP BUG"
  elseif ( s == "8U" ) then
    return "HP ADD"
  else
    return "알 수 없음"
  endif
endfunction
native JNMapServerLogUseType takes string MapId, string SecretKey, string Version, string Loging, string LogType returns string
function LogPlayer takes integer P, string ss, integer val returns nothing
  if ( GetLocalPlayer() == Player(P-1) ) then
    call JNMapServerLog(JN_MAPID, JN_SECRETKEY, BaseStr(9), "["+BaseStr(9)+"] " + udg_SysB_Name[P]+"("+GetUnitName(udg_Unit[P])+") #"+I2S(udg_OnesPositionN[P]) + "."+Hunting_Data(udg_OnesPositionN[P])+" "+ ss + " - " + I2S(val))
    call JNMapServerLogUseType(JN_MAPID, JN_SECRETKEY, BaseStr(9), "["+BaseStr(9)+"] " + udg_SysB_Name[P]+"("+GetUnitName(udg_Unit[P])+") #"+I2S(udg_OnesPositionN[P]) + "."+Hunting_Data(udg_OnesPositionN[P])+" "+ ss + " - " + I2S(val), ss)
  endif
endfunction
constant function Except takes string s returns boolean
  return ( s == "8A" ) or ( s == "8B" ) or ( s == "8S" )
endfunction
function CheckBugPlayer takes nothing returns nothing
  local integer P = LoadInteger(udg_hash, GetHandleId(GetExpiredTimer()), StringHash("Regen-P"))
  if ( isPlaying(Player(P-1)) ) then
    if ( udg_SysL_Level[P] == 0 ) or ( udg_SysB_Level[P] == 0 ) then
      set udg_SysL_Level[P] = GetHeroLevel(udg_Unit[P])
      set udg_SysL_Wood[P] = GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)
      set udg_SysL_Exp[P] = GetHeroXP(udg_Unit[P])
      set udg_SysL_STR[P] = udg_SysE_STR1[P]
      set udg_SysL_DEX[P] = udg_SysE_DEX1[P]
      set udg_SysL_INT[P] = udg_SysE_INT1[P]
      set udg_SysL_WIS[P] = udg_SysE_WIS1[P]
      set udg_SysL_CON[P] = udg_SysE_CON1[P]
    elseif ( not ExctTest[P] ) then
      set udg_temp_s = ""
      if ( UnitAlive(udg_Unit[P]) ) then
        if ( GetHeroLevel(udg_Unit[P]) > udg_SysL_Level[P]+BugData(1) ) then
		  set udg_temp_s = "8A_"+I2S(GetHeroLevel(udg_Unit[P])-udg_SysL_Level[P])
		elseif ( GetHeroLevel(udg_Unit[P]) < 99 ) and ( GetHeroXP(udg_Unit[P]) > udg_SysL_Exp[P]+BugData(2) ) then
          set udg_temp_s = "8B_"+I2S(GetHeroXP(udg_Unit[P])-udg_SysL_Exp[P])
		elseif ( udg_SysE_STR1[P] > udg_SysL_STR[P]+BugData(3) ) then
		  set udg_temp_s = "8C_"+I2S(udg_SysE_STR1[P]-udg_SysL_STR[P])
		elseif ( udg_SysE_DEX1[P] > udg_SysL_DEX[P]+BugData(3) ) then
		  set udg_temp_s = "8D_"+I2S(udg_SysE_DEX1[P]-udg_SysL_DEX[P])
		elseif ( udg_SysE_INT1[P] > udg_SysL_INT[P]+BugData(3) ) then
		  set udg_temp_s = "8E_"+I2S(udg_SysE_INT1[P]-udg_SysL_INT[P])
		elseif ( udg_SysE_WIS1[P] > udg_SysL_WIS[P]+BugData(3) ) then
		  set udg_temp_s = "8F_"+I2S(udg_SysE_WIS1[P]-udg_SysL_WIS[P])
		elseif ( udg_SysE_CON1[P] > udg_SysL_CON[P]+BugData(3) ) then
		  set udg_temp_s = "8G_"+I2S(udg_SysE_CON1[P]-udg_SysL_CON[P])
		elseif ( udg_SysC_Armor[P] > BugData(4) ) then
		  set udg_temp_s = "8H_"+I2S(udg_SysC_Armor[P])
		elseif ( udg_SysC_MissMagic[P] > BugData(5) ) then
		  set udg_temp_s = "8I_"+I2S(R2I(udg_SysC_MissMagic[P]))
		elseif ( udg_SysC_DmgAttack[P] > BugData(6) ) then
		  set udg_temp_s = "8J_"+I2S(udg_SysC_DmgAttack[P])
		elseif ( udg_SysC_CriP[P] > BugData(7) ) and ( udg_SysI_Xtical[P] == 0 ) then
		  set udg_temp_s = "8K_"+I2S(R2I(udg_SysC_CriP[P]))
		elseif ( udg_SysC_CriX[P] > 4.5 ) and ( udg_SysI_Xtical[P] == 0 ) then
		  set udg_temp_s = "8L_"+R2SW(udg_SysC_CriX[P],1,2)
		elseif ( udg_SysC_Dam[P] > BugData(9) ) then
		  set udg_temp_s = "8M_"+I2S(udg_SysC_Dam[P])
		elseif ( udg_SysC_Regen[P] > BugData(10) ) then
		  set udg_temp_s = "8N_"+I2S(udg_SysC_Regen[P])
		elseif ( udg_SysC_Hits[P] > BugData(11) ) then
		  set udg_temp_s = "8O_"+I2S(R2I(udg_SysC_Hits[P]))
		elseif ( udg_SysE_STR2[P]+udg_SysE_DEX2[P]+udg_SysE_INT2[P]+udg_SysE_WIS2[P]+udg_SysE_CON2[P] > BugData(12) ) then
		  set udg_temp_s = "8P_"+I2S(udg_SysE_STR2[P]+udg_SysE_DEX2[P]+udg_SysE_INT2[P]+udg_SysE_WIS2[P]+udg_SysE_CON2[P])
		elseif ( udg_SysK_ExpAdd[P] > BugData(13) ) then
		  set udg_temp_s = "8Q_"+I2S(udg_SysK_ExpAdd[P])
		elseif ( udg_SysK_DropAdd[P] > BugData(13) ) then
		  set udg_temp_s = "8R_"+I2S(udg_SysK_DropAdd[P])
		elseif ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) > udg_SysL_Wood[P]+BugData(14) ) then
		  set udg_temp_s = "8S_"
        elseif ( GetUnitState(udg_Unit[P], UNIT_STATE_MAX_LIFE) < 0. ) then
          set udg_temp_s = "8T_"+I2S(R2I(GetUnitState(udg_Unit[P], UNIT_STATE_MAX_LIFE)))
        elseif ( GetUnitState(udg_Unit[P], UNIT_STATE_MAX_LIFE) > BugData(15) ) then
          set udg_temp_s = "8U_"+I2S(R2I(GetUnitState(udg_Unit[P], UNIT_STATE_MAX_LIFE)))
	    endif
        if ( udg_temp_s != "" ) and ( udg_SysI_Exct[P] != true ) then
          call MSGAll(-P, true, 1, 12, 20., S2S(SubString(udg_temp_s,0,2))+SubString(udg_temp_s,2,StringLength(udg_temp_s)))
          if ( Except(SubString(udg_temp_s,0,2)) ) then /* 레벨, 경험치, 나무 폭업 = 기록만, 팅김X */
            call LogPlayer(P, S2S(SubString(udg_temp_s,0,2)), S2I(SubString(udg_temp_s,3,StringLength(udg_temp_s))))
          else
            call OnlineGame(Player(P-1), 12, S2S(SubString(udg_temp_s,0,2))+SubString(udg_temp_s,2,StringLength(udg_temp_s)))
          endif
        endif
      endif
      set udg_SysL_Level[P] = GetHeroLevel(udg_Unit[P])
      set udg_SysL_Exp[P] = GetHeroXP(udg_Unit[P])
      set udg_SysL_STR[P] = udg_SysE_STR1[P]
      set udg_SysL_DEX[P] = udg_SysE_DEX1[P]
      set udg_SysL_INT[P] = udg_SysE_INT1[P]
      set udg_SysL_WIS[P] = udg_SysE_WIS1[P]
      set udg_SysL_CON[P] = udg_SysE_CON1[P]
      set udg_SysL_Wood[P] = GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)
    endif
  else
    call PauseTimer(GetExpiredTimer())
    call FlushChildHashtable(udg_hash, GetHandleId(GetExpiredTimer()))
    call DestroyTimer(GetExpiredTimer())
  endif
 set P = 0
endfunction

function Trig_Auto_Setting_Start_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
 local integer Value = 0
  if ( GetLocalPlayer() == Player(P-1) ) then
	call SetCameraBoundsToRect(FMi_Rect(0))
  endif

  call SetCameraXY(Player(P-1), GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]))
  set udg_SysA_Item = true
  call UnitAddItem(udg_Unit[P], CreateItem(FMi_Inven(0,1), 0, 0))
  call UnitAddItem(udg_Unit[P], CreateItem(FMi_Inven(0,2), 0, 0))
  call UnitAddItem(udg_Unit[P], CreateItem(FMi_Inven(0,3), 0, 0))
  call UnitAddItem(udg_Unit[P], CreateItem(FMi_Inven(0,4), 0, 0))
  if ( CountItem(P, FMi_Inven(0,5)) > 0 ) then
    call UnitAddItem(udg_Unit[P], CreateItem(FMi_Inven(0,5), 0, 0))
    call SetItemCharges(UnitItemInSlot(udg_Unit[P], 4), CountItem(P, FMi_Inven(0,5)))
  endif
  call UnitAddAbility(udg_Unit[P], 'A013')
  set udg_SysA_Item = false
  call TriggerSleepAction(.1)
  
  set udg_SysB_Level[P] = GetHeroLevel(udg_Unit[P])
debug call BJDebugMsg("v1, v2: " + I2S(udg_SysC_DmgAttack[P]) + ", " + I2S(udg_SysC_DmgAttackAdd[P]))
  set udg_SysC_DmgAttack[P] = udg_SysC_DmgAttack[P] + SysInt(0,11)+(udg_SysB_Level[P]*SysInt(0,16))+udg_SysE_STR3[P]*SysInt(0,12)+udg_SysE_DEX3[P]*SysInt(0,13)+udg_SysE_CON3[P]*SysInt(0,14)
  set udg_SysC_DmgAttackAdd[P] = udg_SysC_DmgAttackAdd[P]+ SysInt(0,22)+udg_SysE_STR3[P]*SysInt(0,19)+udg_SysE_DEX3[P]*SysInt(0,20)+udg_SysE_CON3[P]*SysInt(0,21)
  call SetDmg(udg_Unit[P])
debug call BJDebugMsg("v3, v4: " + I2S(udg_SysC_DmgAttack[P]) + ", " + I2S(udg_SysC_DmgAttackAdd[P]))
  
  if ( not LoadBoolean(udg_hash, StringHash("Regen"), P) ) then
    call SaveBoolean(udg_hash, StringHash("Regen"), P, true)
    set bj_lastStartedTimer = CreateTimer()
    call SaveInteger(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("Regen-P"), P)
    call SaveBoolean(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("Regen-Type"), true)
    call TimerStart(bj_lastStartedTimer, 22.5, false, function Regen)
    set bj_lastStartedTimer = CreateTimer()
    call SaveInteger(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("Regen-P"), P)
    call SaveBoolean(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("Regen-Type"), false)
    call TimerStart(bj_lastStartedTimer, 15., false, function Regen)
    set bj_lastStartedTimer = CreateTimer()
    call SaveInteger(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("Regen-P"), P)
    call TimerStart(bj_lastStartedTimer, 72., true, function CheckBugPlayer)
  endif
  set udg_SysL_Exp[P] = GetHeroXP(udg_Unit[P])
  if ( udg_SysL_Exp[P] == 0 ) then
  //새로 시작
    call MSGAll(0, true, 1, 1, 10., "새로운 모험가, "+SysStr(2,P)+GetPlayerName(Player(P-1))+"|cffffdc3c님께서 |cffed89d9"+GetUnitName(udg_Unit[P])+"|cffffdc3c(으)로 길을 개척합니다.")  
	call MSG(Player(P-1), 1, 3., "모험을 시작합니다.")
    call TriggerRegisterUnitEvent(gg_trg_Level_UP, udg_Unit[P], EVENT_UNIT_HERO_LEVEL)
    call TriggerRegisterUnitEvent(gg_trg_ReviveHero, udg_Unit[P], EVENT_UNIT_DEATH)
    call SetUnitPosition(GetTriggerUnit(), GetRectCenterX(Vileage_Rect(1)), GetRectCenterY(Vileage_Rect(1)))
    call FAL_SetMulti0(P, 0, 0, 2, 0)
    call FAL_SetMulti0(P, 0, 0, 3, 0)
  else
    call MSGAll(0, true, 1, 1, 10., "숙련된 모험가, "+SysStr(2,P)+GetPlayerName(Player(P-1))+"|cffffdc3c님께서 |cffed89d9"+GetUnitName(udg_Unit[P])+"|c00ffff00Lv. "+I2S(GetUnitLevel(GetTriggerUnit()))+"|cffffdc3c(으)로 길을 이어갑니다.")  
    if ( IndexGet(FAL_GetMulti0(P, 0, 0, 2),1) > 0 ) then
      set udg_SysA_Revive[P] = Location(GetRectCenterX(Vileage_Rect(IndexGet(FAL_GetMulti0(P, 0, 0, 2), 1))), GetRectCenterY(Vileage_Rect(IndexGet(FAL_GetMulti0(P, 0, 0, 2), 1))))
    endif
    call SetUnitPosition(GetTriggerUnit(), 29504., -29728.)
    if ( GetLocalPlayer() == Player(P-1) ) then
      call SetCameraBoundsToRect(FMi_Rect(0))
    endif
    if ( not udg_SysK_TEST ) then
      if ( ReloadGameCachesFromDisk() ) then
        call OnlineGame(Player(P-1), 1, "")
	  elseif ( not JNUse() ) then
        call TriggerSleepAction(1.)
        if ( not JNUse() ) then
          call OnlineGame(Player(P-1), 2, "")
        endif
      elseif ( udg_SysB_Level[P] >= FMi_ILv(8) ) then  /* 99 싱글 체크 */
        if ( CountPlayersInForceBJ(udg_temp_pg) <= 1 ) then
          //call TimeAction(udg_Unit[P], 20., 17)
          call JNMapServerLog(JN_MAPID, JN_SECRETKEY, BaseStr(9), udg_SysB_Name[P]+"/Check99\n"+PlayerNames(P))
        endif
      endif
      
            
    endif
  endif
  
  set udg_SysC_CriP[P] = udg_SysC_CriP[P] + BaseValue(15)+BaseValue(13)*udg_SysE_DEX3[P]
  set udg_SysC_CriX[P] = udg_SysC_CriX[P] + BaseValue(16)+(BaseValue(14)*(udg_SysE_STR3[P]+udg_SysE_INT3[P]))
  set udg_SysC_Hits[P] = udg_SysC_Hits[P] + BaseValue(18)+(BaseValue(1)*udg_SysE_DEX3[P])
  
  set udg_SysK_Exp[P] = udg_SysA_COUNT*SysInt(0,30)
  set udg_SysK_Drop[P] = udg_SysA_COUNT*SysInt(0,31)
  set udg_SysK_Gold[P] = udg_SysA_COUNT*SysInt(0,32)
  
  if ( udg_SysA_MapLevel != 0 ) then
    if ( udg_SysA_MapLevel == 1 ) then
      set udg_SysK_ExpAdd[P] = udg_SysK_ExpAdd[P] + 10
      set udg_SysK_DropAdd[P] = udg_SysK_DropAdd[P] - 50
    elseif ( udg_SysA_MapLevel == 2 ) then
      set udg_SysK_ExpAdd[P] = udg_SysK_ExpAdd[P] + 15
      set udg_SysK_DropAdd[P] = udg_SysK_DropAdd[P] - 100
    elseif ( udg_SysA_MapLevel == 3 ) then
      set udg_SysK_ExpAdd[P] = udg_SysK_ExpAdd[P] + 50
      set udg_SysK_DropAdd[P] = udg_SysK_DropAdd[P] + 50
      set udg_SysK_GoldAdd[P] = udg_SysK_GoldAdd[P] + 50
    elseif ( udg_SysA_MapLevel == 4 ) then
      set udg_SysK_ExpAdd[P] = udg_SysK_ExpAdd[P] + 100
      set udg_SysK_DropAdd[P] = udg_SysK_DropAdd[P] + 100
      set udg_SysK_GoldAdd[P] = udg_SysK_GoldAdd[P] + 100
    endif
  endif
      
  call TriggerSleepAction(.1)
  call SetItemCharges(UnitItemInSlot(udg_Unit[P], 4), CountItem(P, FMi_Inven(0,5)))
  call TriggerRegisterUnitEvent(gg_trg_FMi_Click, udg_Unit[P], EVENT_UNIT_SPELL_EFFECT)
  
  set udg_SysL_STR[P] = udg_SysE_STR1[P]
  set udg_SysL_DEX[P] = udg_SysE_DEX1[P]
  set udg_SysL_INT[P] = udg_SysE_INT1[P]
  set udg_SysL_WIS[P] = udg_SysE_WIS1[P]
  set udg_SysL_CON[P] = udg_SysE_CON1[P]
  
  //격수 외 기본공속 -1
  if ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) != "2" ) and ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) != "3" ) and ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) != "6" ) then
    set udg_SysC_AtkSpdAdd[P] = udg_SysC_AtkSpdAdd[P] - 1
  endif
  if ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "3" ) then
    set udg_SysC_CriX[P] = udg_SysC_CriX[P] + BaseValue(21)
    call SetUS2("Miss", udg_Unit[P], BaseValue(8))
  elseif ( SubString(SysStr(1,GetUnitTypeId(udg_Unit[P])),1,2) == "5" ) then
    set udg_SysK_ExpAdd[P] = udg_SysK_ExpAdd[P] + SysInt(0,26)
  endif
      
  //세팅1: 멀티보드 최소화
  if ( SubString(udg_SysB_Setting[P],0,1) == "1" ) then
    call LocalMtbM(Player(P-1), bj_lastCreatedMultiboard, true)
  else
    call LocalMtbM(Player(P-1), bj_lastCreatedMultiboard, false)
  endif
  
  //세팅4: 현재 직업과 이전 직업
  set udg_SysI_NowJob[P] = SysInt(4, GetUnitTypeId(udg_Unit[P]))
  set udg_SysI_PreJob[P] = SysInt(5, GetUnitTypeId(udg_Unit[P]))
  
  call TriggerSleepAction(5.)
  
  if ( CountItem(P, 'I09V') > 0 ) and ( SysInt(3, GetUnitTypeId(udg_Unit[P])) < 17 ) then
    call UnitAddAbility(udg_Unit[P], 'A03Q')
  endif
  if ( IndexGet(GetPlayerId(GetTriggerPlayer())+1, 4) == 0 ) then
    call SaveBoolean(udg_hash, P, StringHash("ViewTip"), true)
    call MSG(Player(P-1), 1, 60., "처음하시거나 도움이 필요하신 분은 |cffc3dbff\"-초보자\"|cffffdc3c를 입력하거나, 스킬 중 옵션(O)을 참고하세요.")
    call TriggerSleepAction(8.)
  endif
  call TriggerSleepAction(1.)
  
  set udg_temp_s = FCut(AUTO_STAT(udg_SysB_Level[P]), S2I(SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2))-1)
  if ( udg_SysB_Level[P] < 99 ) and ( udg_temp_s != "" ) then
    if ( SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),0,1) == "1" ) and ( udg_SysE_STR1[P] == S2I(SubString(udg_temp_s,0,3)) ) and ( udg_SysE_DEX1[P] == S2I(SubString(udg_temp_s,3,6)) ) and ( udg_SysE_INT1[P] == S2I(SubString(udg_temp_s,6,9)) ) and ( udg_SysE_WIS1[P] == S2I(SubString(udg_temp_s,9,12)) ) and ( udg_SysE_CON1[P] == S2I(SubString(udg_temp_s,12,15)) ) then
      call MSG(Player(P-1), 1, 7, "자동스텟이 설정되었습니다. 직접 찍으려면 |cffc3dbff\"-수동스텟\"|cffffdc3c을 입력하세요.")
    else
      call MSG(Player(P-1), 1, 7, "수동스텟이 설정되었습니다. 자동으로 찍으려면 |cffc3dbff\"-자동스텟\"|cffffdc3c을 입력하세요.")
      call SaveBoolean(udg_hash, StringHash("NoAutoStat"), P, true)
    endif
  endif
  
  //세팅2: 자동저장
  if ( SubString(udg_SysB_Setting[P],1,2) == "1" ) then
    call SaveBoolean(udg_hash, P, StringHash("AutoSave"), false)
    call IssueImmediateOrder(GetTriggerUnit(), "frenzy")
    call TriggerSleepAction(1.)
  endif
  
  //세팅3: 자동습득
  if ( SubString(udg_SysB_Setting[P],2,3) == "1" ) then
    call SaveBoolean(udg_hash, P, StringHash("AutoItem"), false)
    call IssueImmediateOrder(GetTriggerUnit(), "replenishlife")
    call TriggerSleepAction(1.)
  endif
  
  //세팅5: 스킨
  if ( S2I(FCut(udg_SysB_SkinOX[P],1)) > 0 ) then
    if ( SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2) == FCut(udg_SysB_SkinOX[P],1) ) then
      call ChangeModel(P, FCut(udg_SysB_SkinOX[P],1))
      call MSG(Player(P-1), 1, 7, "마지막으로 적용한 스킨으로 변경되었습니다.")
    endif
  endif
      
  
  /*if ( HaveSavedString(udg_hash, StringHash(udg_SysB_Name[P]), StringHash("Title1")) ) then
    call MSG(Player(P-1), 1, 7., "당신은 받을 칭호가 있습니다. |cffc3dbff\"-칭호\"|cffffdc3c를 입력하여 받을 수 있습니다.")  
  else
    if ( udg_SysL_Level[P] > FMi_ILv(8) ) then
	  call SaveStr(udg_hash, StringHash(udg_SysB_Name[P]), StringHash("Title1"), "5서클")
    elseif ( udg_SysL_Level[P] > FMi_ILv(6) ) then
	  call SaveStr(udg_hash, StringHash(udg_SysB_Name[P]), StringHash("Title1"), "4서클")
    elseif ( udg_SysL_Level[P] > FMi_ILv(4) ) then
	  call SaveStr(udg_hash, StringHash(udg_SysB_Name[P]), StringHash("Title1"), "3서클")
    elseif ( udg_SysL_Level[P] > FMi_ILv(2) ) then
	  call SaveStr(udg_hash, StringHash(udg_SysB_Name[P]), StringHash("Title1"), "2서클")
	else
	  call SaveStr(udg_hash, StringHash(udg_SysB_Name[P]), StringHash("Title1"), "유저")
	endif
	call MSG(Player(P-1), 1, 8, "서클 칭호, |cffc3dbff\""+LoadStr(udg_hash, StringHash(udg_SysB_Name[P]), StringHash("Title1"))+"\"|cffffdc3c를 받았습니다.")
  endif
  */
  call TriggerSleepAction(15.)
  if ( HaveSavedString(udg_hash, StringHash(udg_SysB_Name[P]), StringHash("P/W")) ) and ( not LoadBoolean(udg_hash, P, StringHash("OK")) ) then
    call MSG(Player(P-1), 2, 60, "※경고! |cffffdc3c10초 내에 인증 코드를 입력하지 않으면 패배합니다.")
	call TriggerSleepAction(10.)
    if ( HaveSavedString(udg_hash, StringHash(udg_SysB_Name[P]), StringHash("P/W")) ) and ( not LoadBoolean(udg_hash, P, StringHash("OK")) ) then
	  call MSGAll(0, true, 1, 1, 10., SysStr(2,P)+udg_SysB_Name[P]+"|cffffdc3c님은 본인확인이 되지 않아, 제외되었습니다.")
	  call KP(Player(P-1))  
	endif
  else
    call TriggerSleepAction(15.)
    if ( IndexGet(GetPlayerId(GetTriggerPlayer())+1, 4) == 0 ) then
      call MSG(Player(P-1), 1, 60, "처음하시거나 도움이 필요하신 분은 |cffc3dbff\"-초보자\"|cffffdc3c를 입력하세요.")
    endif
  endif
endfunction

//===========================================================================
function InitTrig_Auto_Setting_1 takes nothing returns nothing
  set gg_trg_Auto_Setting_1 = CreateTrigger(  )
  call TriggerRegisterEnterRectSimple( gg_trg_Auto_Setting_1, gg_rct_Setting_Start )
  call TriggerAddCondition( gg_trg_Auto_Setting_1, Condition( function Trig_Auto_Setting_Start_Conditions ) )
  call TriggerAddAction( gg_trg_Auto_Setting_1, function Trig_Auto_Setting_Start_Actions )
endfunction

//===========================================================================
// Trigger: Sys Gold Drop
//
// 100레벨 몬스터 - 1~2500 (평균 1250)
// 50레벨 몬스터 - 1~800 (평균 400)
// 100레벨: 100~400
// 50레벨: 50~150
// 돌연변이는 5배 많은 골드를 줍니다.
// Lv~Lv^1.3
//===========================================================================
function AddGoldDrop takes real x, real y, integer lv, real bonus returns nothing
  //60~15%
  if ( GetRandomReal(0, 100) <= 61.-(lv*0.45) ) then
    if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A047') == 0 ) then
      set lv = R2I(RMinBJ(1000.,GetRandomReal(lv,Pow(lv,1.4)))*bonus)
    else
      set lv = R2I(RMinBJ(2000.,GetRandomReal(lv,Pow(lv,1.6)))*bonus)
    endif
    call SetItemCharges(CreateItem('gold', x, y), lv)
    if ( GetRandomReal(0.,100.) <= 15. ) then
      if ( GetRandomReal(0.,100.) <= 15. ) then
        call TriggerSleepAction(.15)
        call SetItemCharges(CreateItem('gol2', x, y), lv*2)
        call TriggerSleepAction(.15)
        call SetItemCharges(CreateItem('gol3', x, y), lv*3)
      else
        call TriggerSleepAction(.2)
        call SetItemCharges(CreateItem('gol2', x, y), lv*2)
      endif
    endif
  endif
endfunction

function Sys_Gold_Drop_Actions takes nothing returns nothing
  if ( SysInt(4, GetUnitTypeId(GetKillingUnit())) == 4 ) then
    call AddGoldDrop(GetWidgetX(GetKillingUnit()), GetWidgetY(GetKillingUnit()), GetUnitLevel(GetTriggerUnit()), (100+udg_SysK_Gold[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1]+udg_SysK_GoldAdd[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1])/100.)
  else
    call AddGoldDrop(GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), GetUnitLevel(GetTriggerUnit()), (100+udg_SysK_Gold[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1]+udg_SysK_GoldAdd[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1])/100.)
  endif
endfunction

//===========================================================================
function InitTrig_Sys_Gold_Drop takes nothing returns nothing
  set gg_trg_Sys_Gold_Drop = CreateTrigger()
  call TriggerAddAction(gg_trg_Sys_Gold_Drop, function Sys_Gold_Drop_Actions)
endfunction

//===========================================================================
// Trigger: Sys Gold Get
//===========================================================================
function PartyGold takes nothing returns nothing
  if ( GetEnumUnit() != GetTriggerUnit() ) and ( SubString(SysStr(1,GetUnitTypeId(GetEnumUnit())),1,2) != "4" ) and ( SubString(SysStr(1,GetUnitTypeId(GetEnumUnit())),1,2) != "5" ) then
    call CreateTextTagUnitBJ("+ "+I2S(bj_groupCountUnits) + "Gold", GetEnumUnit(), -30.00, 8.+ bj_groupCountUnits/200., 100., 85., 0., 0.)
    call SetPlayerState(GetOwningPlayer(GetEnumUnit()), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(GetOwningPlayer(GetEnumUnit()), PLAYER_STATE_RESOURCE_GOLD) + bj_groupCountUnits)
  else
    call CreateTextTagUnitBJ("+ "+I2S(R2I(bj_groupCountUnits*1.1)) + "Gold", GetEnumUnit(), -30.00, 9.+ bj_groupCountUnits/200., 100., 85., 0., 0.)
    call SetPlayerState(GetOwningPlayer(GetEnumUnit()), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(GetOwningPlayer(GetEnumUnit()), PLAYER_STATE_RESOURCE_GOLD) + R2I(bj_groupCountUnits*1.1))
  endif
  call ShowTextTagPlayer(GetOwningPlayer(GetEnumUnit()), bj_lastCreatedTextTag)
  call Bufftt(bj_lastCreatedTextTag, 2)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\ResourceItems\\ResourceEffectTarget.mdl", GetEnumUnit(), "origin"))
endfunction
function Cond_NearParty takes nothing returns boolean
 return ( GetFilterUnit() == udg_Unit[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] ) and ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] == udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1] )
endfunction
function Trig_Sys_Gold_Get_Actions takes nothing returns nothing
 set udg_temp_g = AI_Group(CreateGroup(), GetTriggerUnit(), 50., Condition(function Cond_NearParty))
  set bj_groupCountUnits = 0
  call ForGroup(udg_temp_g, function CountUnitsInGroupEnum)
  if ( bj_groupCountUnits >= 2 ) and ( udg_PartyNumber_pP[udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1]] >= 2 ) then
    set bj_groupCountUnits = IMaxBJ(1,R2I(GetItemCharges(GetManipulatedItem()) / I2R(bj_groupCountUnits)))
    call ForGroup(udg_temp_g, function PartyGold)
  else
    set bj_groupCountUnits = GetItemCharges(GetManipulatedItem())
    call CreateTextTagUnitBJ("+"+I2S(bj_groupCountUnits) + " Gold", GetTriggerUnit(), -30.00, 10.+ bj_groupCountUnits/200., 100., 85., 0., 0.)
	call SetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD) + bj_groupCountUnits)
    call Bufftt(bj_lastCreatedTextTag, 11)
  endif
 call RemoveItem(GetManipulatedItem())
 call DestroyGroup(udg_temp_g)
endfunction

//===========================================================================
function InitTrig_Sys_Gold_Get takes nothing returns nothing
    set gg_trg_Sys_Gold_Get = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Sys_Gold_Get, function Trig_Sys_Gold_Get_Actions )
endfunction

//===========================================================================
// Trigger: Item Drop 3
//===========================================================================
//돌연변이 유닛 아이템 드랍 Pool
constant function DropPool takes integer no1, integer no2 returns integer
  //드랍풀 1: 1렙 장비
  if ( no1 == 1 ) then
    if ( no2 == 0 ) then
      //1번 아이템세트의 개수: 13개
      return 13
    elseif ( no2 == 1 ) then
      return 'I013'
    elseif ( no2 == 2 ) then
      return 'I014'
    elseif ( no2 == 3 ) then
      return 'I015'
    elseif ( no2 == 4 ) then
      return 'I020'
    elseif ( no2 == 5 ) then
      return 'I02D'
    elseif ( no2 == 6 ) then
      return 'I00P'
    elseif ( no2 == 7 ) then
      return 'I03P'
    elseif ( no2 == 8 ) then
      return 'I03Z'
    elseif ( no2 == 9 ) then
      return 'I03X'
    elseif ( no2 == 10 ) then
      return 'I04A'
    elseif ( no2 == 11 ) then
      return 'I04G'
    elseif ( no2 == 12 ) then
      return 'I05J'
    elseif ( no2 == 13 ) then
      return 'I063'
    endif
    
  //2번 드랍풀: 11렙 장비
  elseif ( no1 == 2 ) then
    if ( no2 == 0 ) then
      return 15
    elseif ( no2 == 1 ) then
      return 'I016'
    elseif ( no2 == 2 ) then
      return 'I021'
    elseif ( no2 == 3 ) then
      return 'I02E'
    elseif ( no2 == 4 ) then
      return 'I03F'
    elseif ( no2 == 5 ) then
      return 'I036'
    elseif ( no2 == 6 ) then
      return 'I03Q'
    elseif ( no2 == 7 ) then
      return 'I040'
    elseif ( no2 == 8 ) then
      return 'I045'
    elseif ( no2 == 9 ) then
      return 'I04B'
    elseif ( no2 == 10 ) then
      return 'I04H'
    elseif ( no2 == 11 ) then
      return 'I065'
    elseif ( no2 == 12 ) then
      return 'I064'
    elseif ( no2 == 13 ) then
      return 'I068'
    elseif ( no2 == 14 ) then
      return 'I066'
    elseif ( no2 == 15 ) then
      return 'I067'
    endif
    
  //3번 드랍풀: 26렙 장비
  elseif ( no1 == 3 ) then
    if ( no2 == 0 ) then
      return 7
    elseif ( no2 == 1 ) then
      return 'I019'
    elseif ( no2 == 2 ) then
      return 'I022'
    elseif ( no2 == 3 ) then
      return 'I02F'
    elseif ( no2 == 4 ) then
      return 'I001'
    elseif ( no2 == 5 ) then
      return 'I03R'
    elseif ( no2 == 6 ) then
      return 'I05L'
    elseif ( no2 == 7 ) then
      return 'I057'
    endif

  //4번 드랍풀: 41렙 장비
  elseif ( no1 == 4 ) then
    if ( no2 == 0 ) then
      return 17
    elseif ( no2 == 1 ) then
      return 'I01B'
    elseif ( no2 == 2 ) then
      return 'I023'
    elseif ( no2 == 3 ) then
      return 'I02G'
    elseif ( no2 == 4 ) then
      return 'I03H'
    elseif ( no2 == 5 ) then
      return 'I039'
    elseif ( no2 == 6 ) then
      return 'I03S'
    elseif ( no2 == 7 ) then
      return 'I041'
    elseif ( no2 == 8 ) then
      return 'I04C'
    elseif ( no2 == 9 ) then
      return 'I046'
    elseif ( no2 == 10 ) then
      return 'I04I'
    elseif ( no2 == 11 ) then
      return 'I06B'
    elseif ( no2 == 12 ) then
      return 'I069'
    elseif ( no2 == 13 ) then
      return 'I06C'
    elseif ( no2 == 14 ) then
      return 'I06Z'
    elseif ( no2 == 15 ) then
      return 'I072'
    elseif ( no2 == 16 ) then
      return 'I070'
    elseif ( no2 == 17 ) then
      return 'I071'
    endif

  //5번 드랍풀: 56렙 장비
  elseif ( no1 == 5 ) then
    if ( no2 == 0 ) then
      return 5
    elseif ( no2 == 1 ) then
      return 'I024'
    elseif ( no2 == 2 ) then
      return 'I02H'
    elseif ( no2 == 3 ) then
      return 'I03T'
    elseif ( no2 == 4 ) then
      return 'I05P'
    elseif ( no2 == 5 ) then
      return 'I059'
    endif
    
  //6번 드랍풀: 56렙 악세사리*
  elseif ( no1 == 6 ) then
    if ( no2 == 0 ) then
      return 2
    elseif ( no2 == 1 ) then
      return 'I074'
    elseif ( no2 == 2 ) then
      return 'I06W'
    endif
    
  //7번 드랍풀: 71렙 장비
  elseif ( no1 == 7 ) then
    if ( no2 == 0 ) then
      return 14
    elseif ( no2 == 1 ) then
      return 'I01H'
    elseif ( no2 == 2 ) then
      return 'I02I'
    elseif ( no2 == 3 ) then
      return 'I025'
    elseif ( no2 == 4 ) then
      return 'I03U'
    elseif ( no2 == 5 ) then
      return 'I042'
    elseif ( no2 == 6 ) then
      return 'I04D'
    elseif ( no2 == 7 ) then
      return 'I047'
    elseif ( no2 == 8 ) then
      return 'I04J'
    elseif ( no2 == 9 ) then
      return 'I05Q'
    elseif ( no2 == 10 ) then
      return 'I076'
    elseif ( no2 == 11 ) then
      return 'I05A'
    elseif ( no2 == 12 ) then
      return 'I05H'
    elseif ( no2 == 13 ) then
      return 'I06S'
    elseif ( no2 == 14 ) then
      return 'I06M'
    endif
    
  //8번 드랍풀: 71렙 악세사리*
  elseif ( no1 == 8 ) then
    if ( no2 == 0 ) then
      return 3
    elseif ( no2 == 1 ) then
      return 'I075'
    elseif ( no2 == 2 ) then
      return 'I05V'
    elseif ( no2 == 3 ) then
      return 'I06X'
    endif
    
  //9번 드랍풀: 86렙 장비
  elseif ( no1 == 9 ) then
    if ( no2 == 0 ) then
      return 8 // 10
    elseif ( no2 == 1 ) then
      return 'I01L'
    elseif ( no2 == 2 ) then
      return 'I01J'
    elseif ( no2 == 3 ) then
      return 'I02J'
    elseif ( no2 == 4 ) then
      return 'I01N'
    elseif ( no2 == 5 ) then
      return 'I026'
    elseif ( no2 == 6 ) then
      return 'I01K'
    elseif ( no2 == 7 ) then
      return 'I027'
    elseif ( no2 == 8 ) then
      return 'I03V'
    //elseif ( no2 == 9 ) then
      //return 'I03N' - 매직세페우스
    //elseif ( no2 == 10 ) then
      //return 'I03O' - 아리펄스탭
    endif
  elseif ( no1 == 10 ) then
    if ( no2 == 0 ) then
      return 14
    elseif ( no2 == 1 ) then
      return 'I01M'
    elseif ( no2 == 2 ) then
      return 'I02K'
    elseif ( no2 == 3 ) then
      return 'I02A'
    elseif ( no2 == 4 ) then
      return 'I082'
    elseif ( no2 == 5 ) then
      return 'I03K'
    elseif ( no2 == 6 ) then
      return 'I03C'
    elseif ( no2 == 7 ) then
      return 'I03W'
    elseif ( no2 == 8 ) then
      return 'I04E'
    elseif ( no2 == 9 ) then
      return 'I048'
    elseif ( no2 == 10 ) then
      return 'I043'
    elseif ( no2 == 11) then
      return 'I04K'
    elseif ( no2 == 12 ) then
      return 'I05I'
    elseif ( no2 == 13 ) then
      return 'I06T'
    elseif ( no2 == 14 ) then
      return 'I06N'
    endif
  endif
  return -1
endfunction

// 기본 드랍률 40~10% → 60~20%(64-Lv/2.5) + 드랍률 적용
// ★드랍률(기본): 60~20% + 드랍률 적용
// ☆드랍률2: 기본의 30%
// ◎드랍률3(악세) 기본의 25%
// ▣드랍률4(악세) ◎의 50%
constant function DropPer takes integer no1, integer Lv returns real
  if ( no1 == 1 ) then
    return 60. - (Lv*.4)
  elseif ( no1 == 2 ) then
    return 18. - (Lv*.13)
  elseif ( no1 == 3 ) then
    return 15. - (Lv*.1)
  elseif ( no1 == 4 ) then
    return 7.5 - (Lv*.05)
  else
    return 100.
  endif
endfunction

//레벨을 받아 어느 아이템 Pool인지 반환
//input(lv, 0) = 2개 반환(개수)
//input(lv, 1) = 1번째 테이블 반환
constant function DropOX takes integer Lv, integer no1 returns integer
  if ( Lv <= 10 ) then
    //몇개의 드랍 풀을 갖고 있는가
    if ( no1 == 0 ) then
      return 2
    
    //메인 테이블은 몇번 드랍풀인가
    elseif ( no1 == 1 ) then
      return 1
      
    //메인 테이블은 어떤 퍼센트를 적용하는가
    elseif ( no1 == -1 ) then
      return 1
    
    elseif ( no1 == 2 ) then
      return 2
    elseif ( no1 == -2 ) then
      return 2
    endif
  
  elseif ( Lv <= 25 ) then
    if ( no1 == 0 ) then
      return 2
    elseif ( no1 == 1 ) then
      return 2
    elseif ( no1 == -1 ) then
      return 1
    elseif ( no1 == 2 ) then
      return 3
    elseif ( no1 == -2 ) then
      return 2
    endif
    
  elseif ( Lv <= 40 ) then
    if ( no1 == 0 ) then
      return 2
    elseif ( no1 == 1 ) then
      return 3
    elseif ( no1 == -1 ) then
      return 1
    elseif ( no1 == 2 ) then
      return 4
    elseif ( no1 == -2 ) then
      return 2
    endif
    
  elseif ( Lv <= 55 ) then
    if ( no1 == 0 ) then
      return 2
    elseif ( no1 == 1 ) then
      return 4
    elseif ( no1 == -1 ) then
      return 1
    elseif ( no1 == 2 ) then
      return 5
    elseif ( no1 == -2 ) then
      return 2
    endif
    
  elseif ( Lv <= 70 ) then
    if ( no1 == 0 ) then
      return 3
    elseif ( no1 == 1 ) then
      return 5
    elseif ( no1 == -1 ) then
      return 1
    elseif ( no1 == 2 ) then
      return 7
    elseif ( no1 == -2 ) then
      return 2
    elseif ( no1 == 3 ) then
      return 6
    elseif ( no1 == -3 ) then
      return 3
    endif
    
  elseif ( Lv <= 85 ) then
    if ( no1 == 0 ) then
      return 4
    elseif ( no1 == 1 ) then
      return 7
    elseif ( no1 == -1 ) then
      return 1
    elseif ( no1 == 2 ) then
      return 9
    elseif ( no1 == -2 ) then
      return 2
    elseif ( no1 == 3 ) then
      return 9
    elseif ( no1 == -3 ) then
      return 3
    elseif ( no1 == 4 ) then
      return 8
    elseif ( no1 == -4 ) then
      return 4
    endif
    
  elseif ( Lv <= 98 ) then
    if ( no1 == 0 ) then
      return 4
    elseif ( no1 == 1 ) then
      return 9
    elseif ( no1 == -1 ) then
      return 1
    elseif ( no1 == 2 ) then
      return 10
    elseif ( no1 == -2 ) then
      return 2
    elseif ( no1 == 3 ) then
      return 6
    elseif ( no1 == -3 ) then
      return 3
    elseif ( no1 == 4 ) then
      return 8
    elseif ( no1 == -4 ) then
      return 4
    endif
    
  elseif ( Lv >= 99 ) then
    if ( no1 == 0 ) then
      return 2
    elseif ( no1 == 1 ) then
      return 10
    elseif ( no1 == -1 ) then
      return 1
    elseif ( no1 == 2 ) then
      return 8
    elseif ( no1 == -2 ) then
      return 3
    endif
  endif
  
  return -1
endfunction
constant function ItemDropRatio takes real r returns integer
//50% 1강 / 16% 2강 / 4% 3강
  if ( r <= 8. ) then
    return 3
  elseif ( r <= 41.3 ) then
    return 2
  else
    return 1
  endif
endfunction
function Trig_Item_Drop_3_Actions takes nothing returns nothing
 local integer lv = GetUnitLevel(GetTriggerUnit())
 local integer i = DropOX(lv, 0)
  loop
    if ( GetRandomReal(0.,100.) <= DropPer(DropOX(lv, -i), IMaxBJ(udg_SysB_Level[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1],lv)) ) then
      set bj_lastCreatedItem = CreateItem(DropPool(DropOX(lv,i), GetRandomInt(1,DropPool(DropOX(lv,i),0))), GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()))
      if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A047') == 2 ) then
        call SetItemCharges(bj_lastCreatedItem, (GetRandomInt(0,SysInt(0,29))*5)+ItemDropRatio(GetRandomReal(0.,100.)))
        call SetItemPosition(bj_lastCreatedItem, GetWidgetX(GetKillingUnit()), GetWidgetY(GetKillingUnit()))
        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl", GetWidgetX(bj_lastCreatedItem), GetWidgetY(bj_lastCreatedItem)))
        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIda\\AIdaCaster.mdl,Abilities\\Spells\\Other\\Andt\\Andt.mdl", GetWidgetX(bj_lastCreatedItem), GetWidgetY(bj_lastCreatedItem)))
        if ( GetItemCharges(bj_lastCreatedItem) >= 1 ) then
          
          call SetItemPosition(bj_lastCreatedItem, GetWidgetX(GetKillingUnit()), GetWidgetY(GetKillingUnit()))
          call ED(AddSpecialEffect("Units\\NightElf\\Owl\\Owl.mdl", GetWidgetX(bj_lastCreatedItem), GetWidgetY(bj_lastCreatedItem)), 3.)
          call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\Starfall\\StarfallTarget.mdl", GetWidgetX(bj_lastCreatedItem), GetWidgetY(bj_lastCreatedItem)))
          call AttachSoundToUnit(gg_snd_ItemDrop01, GetKillingUnit())
          call StartSound(gg_snd_ItemDrop01)
    
          set bj_lastCreatedTextTag = CreateTextTag()
          call SetTextTagText(bj_lastCreatedTextTag, "|cffDFFB4F" + GetItemNamed(bj_lastCreatedItem), 0.015)
          call SetTextTagPos(bj_lastCreatedTextTag, GetWidgetX(bj_lastCreatedItem)-80., GetWidgetY(bj_lastCreatedItem), -50.)
          call SetTextTagColor(bj_lastCreatedTextTag, 255, 255, 255, 255)
          call Bufftt(bj_lastCreatedTextTag, 18)
        endif
      else
        if ( GetRandomReal(0.,100.) <= 40. * ((100+udg_SysK_Drop[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1]+udg_SysK_DropAdd[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1])/100.) ) then
          //60% 일반, 네임드 40%
          call SetItemCharges(bj_lastCreatedItem, (GetRandomInt(0,SysInt(0,29))*5)+1)
          call SetItemPosition(bj_lastCreatedItem, GetWidgetX(GetKillingUnit()), GetWidgetY(GetKillingUnit()))
          call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl", GetWidgetX(bj_lastCreatedItem), GetWidgetY(bj_lastCreatedItem)))
          call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIda\\AIdaCaster.mdl,Abilities\\Spells\\Other\\Andt\\Andt.mdl", GetWidgetX(bj_lastCreatedItem), GetWidgetY(bj_lastCreatedItem)))
        
          call ItemDropEffect(bj_lastCreatedItem, udg_SysK_Drop[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1]+udg_SysK_DropAdd[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1])
        endif
      endif
      call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl", GetWidgetX(bj_lastCreatedItem), GetWidgetY(bj_lastCreatedItem)))
      call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\ReplenishHealth\\ReplenishHealthCasterOverhead.mdl", GetWidgetX(bj_lastCreatedItem), GetWidgetY(bj_lastCreatedItem)))
    endif
    set i = i - 1
    exitwhen i == 0
  endloop
endfunction

//===========================================================================
function InitTrig_Item_Drop_3 takes nothing returns nothing
  set gg_trg_Item_Drop_3 = CreateTrigger()
  call TriggerAddAction( gg_trg_Item_Drop_3, function Trig_Item_Drop_3_Actions )
endfunction

//===========================================================================
// Trigger: Item Drop 4
//
// call SaveStr(udg_hash, 'lgdh', StringHash("FMi-Val"), "050|cffffdc3c전직서|직자로 전직할 수 있는 전직서입니다.|신전으로 갖고가면 조건을 무시하고 전직할 수 있습니다.")
//   call SaveStr(udg_hash, 'ssil', StringHash("FMi-Val"), "050|cffffdc3c전직서|법사로 전직할 수 있는 전직서입니다.|신전으로 갖고가면 조건을 무시하고 전직할 수 있습니다.")
//   call SaveStr(udg_hash, 'dsum', StringHash("FMi-Val"), "050|cffffdc3c전직서|도적으로 전직할 수 있는 전직서입니다.|신전으로 갖고가면 조건을 무시하고 전직할 수 있습니다.")
//   call SaveStr(udg_hash, 'rwiz', StringHash("FMi-Val"), "050|cffffdc3c전직서|전사로 전직할 수 있는 전직서입니다.|신전으로 갖고가면 조건을 무시하고 전직할 수 있습니다.")
//   call SaveStr(udg_hash, 'clsd', StringHash("FMi-Val"), "050|cffffdc3c전직서|순수 전직(무도가 포함)으로 전직할 수 있는 전직서입니다.|신전으로 갖고가면 조건을 무시하고 전직할 수 있습니다.")
//===========================================================================
constant function ChangeJobBook takes integer i returns integer
  if ( i == 5 ) then
    return 'lgdh'
  elseif ( i == 4 ) then
    return 'ssil'
  elseif ( i == 3 ) then
    return 'dsum'
  elseif ( i == 2 ) then
    return 'rwiz'
  else
    return 'clsd'
  endif
endfunction 
function Trig_Item_Drop_4_Actions takes nothing returns nothing
  if ( udg_SysA_MapLevel == 4 ) then
    set bj_lastCreatedItem = CreateItem(ChangeJobBook(GetRandomInt(1,5)), GetWidgetX(GetKillingUnit()), GetWidgetY(GetKillingUnit()))
    call ED(AddSpecialEffect("Units\\NightElf\\Owl\\Owl.mdl", GetWidgetX(bj_lastCreatedItem), GetWidgetY(bj_lastCreatedItem)), 3.)
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl", GetWidgetX(bj_lastCreatedItem), GetWidgetY(bj_lastCreatedItem)))
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIda\\AIdaCaster.mdl,Abilities\\Spells\\Other\\Andt\\Andt.mdl", GetWidgetX(bj_lastCreatedItem), GetWidgetY(bj_lastCreatedItem)))
    call AttachSoundToUnit(gg_snd_ItemDrop01, GetKillingUnit())
  endif
endfunction

//===========================================================================
function InitTrig_Item_Drop_4 takes nothing returns nothing
    set gg_trg_Item_Drop_4 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item_Drop_4, function Trig_Item_Drop_4_Actions )
endfunction

//===========================================================================
// Trigger: Item Drop 5
//===========================================================================
constant function MineLevelBonus takes integer level returns real
  if ( level <= 1 ) then
    return 1.
  elseif ( level == 2 ) then
    return 1.45
  elseif ( level == 3 ) then
    return 1.9
  elseif ( level == 4 ) then
    return 2.35
  elseif ( level == 5 ) then
    return 2.8
  elseif ( level == 6 ) then
    return 3.25
  elseif ( level == 7 ) then
    return 3.7
  elseif ( level == 8 ) then
    return 4.15
  elseif ( level == 9 ) then
    return 4.6
  elseif ( level == 10 ) then
    return 5.05
  else
    return 0.
  endif
endfunction
constant function MineMuBonus takes integer level returns real
  if ( level == 1 ) then
    return 4.
  elseif ( level == 2 ) then
    return 16.
  else
    return 1.
  endif
endfunction
constant function MineDropPer takes integer i returns real
  if ( i == 1 ) then
    return 25.
  elseif ( i == 2 ) then
    return 10.
  elseif ( i == 3 ) then
    return 2.
  else
    return 0.01
  endif
endfunction
constant function MineDropItem takes integer i returns integer
  if ( i == 4 ) then
    return 'I09R'
  elseif ( i == 3 ) then
    return 'I09S'
  elseif ( i == 2 ) then
    return 'infs'
  else
    return 'rin1'
  endif
endfunction
function Trig_Item_Drop_5_Actions takes nothing returns nothing
 local unit u = GetTriggerUnit()
 local real r = 0.
 local real r2 = 0.
 local integer loopA = 0
  
  //광산
    set r = MineMuBonus(GetUnitAbilityLevel(u, 'A096')) * MineLevelBonus(udg_SYSTEM_MineFloor)
    set loopA = 1
    loop
      set r2 = MineDropPer(loopA) * r
      if ( r2 < 100. ) then
        if ( GetRandomReal(0., 100.) <= r2 ) then
          call CreateItem(MineDropItem(loopA), GetWidgetX(GetKillingUnit()), GetWidgetY(GetKillingUnit()))
        endif
      else
        call SetItemCharges(CreateItem(MineDropItem(loopA), GetWidgetX(GetKillingUnit()), GetWidgetY(GetKillingUnit())), R2I((r2+GetRandomReal(0., 100.))/100.))
      endif
      exitwhen loopA >= 4
      set loopA = loopA + 1
    endloop
endfunction

//===========================================================================
function InitTrig_Item_Drop_5 takes nothing returns nothing
    set gg_trg_Item_Drop_5 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item_Drop_5, function Trig_Item_Drop_5_Actions )
endfunction

//===========================================================================
// Trigger: Sys NPC No Attack
//===========================================================================
function DestroyTriggerTime takes trigger t, real time returns nothing
  call TriggerSleepAction(time)
  call DestroyTrigger(t)
endfunction
function Solo_Condi takes nothing returns boolean
  return IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and ( GetWidgetLife(GetFilterUnit()) > 0. )
endfunction
function GoSolo takes nothing returns nothing
  if ( GetUnitLevel(udg_Unit[GetPlayerId(GetTriggerPlayer())+1]) == 99 ) then
    set udg_temp_i = 100000
  else
    set udg_temp_i = GetUnitLevel(udg_Unit[GetPlayerId(GetTriggerPlayer())+1])*GetUnitLevel(udg_Unit[GetPlayerId(GetTriggerPlayer())+1])*3
  endif
  if ( GetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD) >= udg_temp_i ) then
    call SetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD) - udg_temp_i)
    call SetUnitPosition(udg_Unit[GetPlayerId(GetTriggerPlayer())+1], GetRectCenterX(Hunting_Rect(47)), GetRectCenterY(Hunting_Rect(47)))
    call SetCameraXY(GetTriggerPlayer(), GetRectCenterX(Hunting_Rect(47)), GetRectCenterY(Hunting_Rect(47)))
    call SaveReal(udg_hash, 47, StringHash("FCU-Time"), 15.)
    call SaveReal(udg_hash, 47, StringHash("FCU-Time2"), 7.5)
  else
    call MSG(GetOwningPlayer(GetAttacker()), 1, 4., "돈이 부족합니다!! 솔로던전의 입장금액은 최소 |c00ffff00"+I2S(udg_temp_i)+"G |cffffdc3c입니다.")
  endif
  call DestroyTrigger(GetTriggeringTrigger())
endfunction
function GoSpa takes nothing returns nothing
  if ( GetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD) >= 100 ) then
    call SetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD) - IMaxBJ(100,GetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD) / 50))
    call SetUnitPosition(udg_Unit[GetPlayerId(GetTriggerPlayer())+1], 28032, -27840)
  else
    call MSG(GetOwningPlayer(GetAttacker()), 1, 4., "돈이 부족합니다!! 여관의 입장금액은 최소 |c00ffff00100G |cffffdc3c입니다.")
  endif
  call DestroyTrigger(GetTriggeringTrigger())
endfunction
function Trig_Sys_NPC_No_Attack_Actions takes nothing returns nothing
  call IssueImmediateOrder(GetAttacker(), "stop")
  //여관주인
  if ( GetUnitTypeId(GetTriggerUnit()) == 'h00B' ) then
    call PauseUnit(GetAttacker(), true)
    call MSG(GetOwningPlayer(GetAttacker()), 1, 4., "|cffffdc3c여관에 가려면 |c00ffff00" + I2S(IMaxBJ(100, GetPlayerState(GetOwningPlayer(GetAttacker()), PLAYER_STATE_RESOURCE_GOLD) / 50 )) + "G|cffffdc3c가 필요합니다.|r")
    call TriggerSleepAction(.5)
    set udg_temp_trg = CreateTrigger()
    set udg_temp_d = DialogCreate()
    call PauseUnit(GetAttacker(), false)
    call DialogSetMessage(udg_temp_d, "|cffffdc3c이동하시겠습니까?|r")
    call TriggerRegisterDialogButtonEvent(udg_temp_trg, DialogAddButton(udg_temp_d, "예, 입장합니다 (|cffffffffY|r)", 81))
    call TriggerAddAction(udg_temp_trg, function GoSpa)
    call DialogAddButton(udg_temp_d, "취소 (|cffffffffC|r)", 67)
    call DialogDisplay(GetOwningPlayer(GetAttacker()), udg_temp_d, true)
    call DialogClose(GetOwningPlayer(GetAttacker()), udg_temp_d, 7.)
    call DestroyTriggerTime(udg_temp_trg, 7.)
  elseif ( GetUnitTypeId(GetTriggerUnit()) == 'enec' ) then
    if ( GetUnitLevel(GetAttacker()) >= 30 ) and ( GetUnitLevel(GetAttacker()) <= 99 ) then
      call IssueImmediateOrder(GetAttacker(), "stop")
      call PauseUnit(GetAttacker(), true)
      set udg_temp_g = GroupEnumUnitsInRect2(CreateGroup(), gg_rct_Hunting_47, Condition(function Solo_Condi))
      if ( CountUnitsInGroup(udg_temp_g) == 0 ) then
        call DestroyGroup( udg_temp_g )
        if ( GetUnitLevel(GetAttacker()) == 99 ) then
          set udg_temp_i = 100000
        else
          set udg_temp_i = GetUnitLevel(GetAttacker()) * GetUnitLevel(GetAttacker()) * 3
        endif
        if ( GetPlayerState(GetOwningPlayer(GetAttacker()), PLAYER_STATE_RESOURCE_GOLD) >= udg_temp_i ) then
          call MSG(GetOwningPlayer(GetAttacker()), 1, 4., "|cffffdc3c입장료는 |cffffff00" + I2S(udg_temp_i) + "G|cffffdc3c가 필요합니다.|r" )
          call PauseUnit(GetAttacker(), true)
          call TriggerSleepAction(.5)
          set udg_temp_trg = CreateTrigger()
          set udg_temp_d = DialogCreate()
          call PauseUnit(GetAttacker(), false)
          call DialogSetMessage(udg_temp_d, "|cffffdc3c이동하시겠습니까?|r")
          call TriggerRegisterDialogButtonEvent(udg_temp_trg, DialogAddButton(udg_temp_d, "예, 입장합니다 (|cffffffffY|r)", 81))
          call TriggerAddAction(udg_temp_trg, function GoSolo)
          call DialogAddButton(udg_temp_d, "취소 (|cffffffffC|r)", 67)
          call DialogDisplay(GetOwningPlayer(GetAttacker()), udg_temp_d, true)
          call DialogClose(GetOwningPlayer(GetAttacker()), udg_temp_d, 7.)
          call DestroyTriggerTime(udg_temp_trg, 7.)
        else
          call MSG(GetOwningPlayer(GetAttacker()), 1, 4., "|cffffdc3c입장료가 부족합니다. |cffffff00" + I2S(udg_temp_i) + "G|cffffdc3c 이상 필요합니다." )
          call PauseUnitBJ( false, GetAttacker() )
          set udg_temp_i = 0
        endif
      else
        call MSG(GetOwningPlayer(GetAttacker()), 1, 4., "현재 사용중인 유저가 있습니다.")
      endif
    else
      call MSG(GetOwningPlayer(GetAttacker()), 1, 4., "레벨제한이 맞지 않습니다. 30~98까지 이용 가능합니다.")
    endif
  endif
endfunction

//===========================================================================
function InitTrig_Sys_NPC_No_Attack takes nothing returns nothing
  set gg_trg_Sys_NPC_No_Attack = CreateTrigger(  )
  call TriggerAddAction( gg_trg_Sys_NPC_No_Attack, function Trig_Sys_NPC_No_Attack_Actions )
endfunction

//===========================================================================
// Trigger: Sys F9 Setup
//
//   call AddQuest("", "", "", false)
//===========================================================================
function Trig_Sys_F9_Setup_Actions takes nothing returns nothing
    set bj_lastCreatedQuest = CreateQuest()
    call QuestSetTitle(bj_lastCreatedQuest, "명령어")
    call QuestSetDescription(bj_lastCreatedQuest, "내용")
    call QuestSetIconPath(bj_lastCreatedQuest, "ReplaceableTextures\\CommandButtons\\BTNAmbush.blp")
    call QuestSetRequired(bj_lastCreatedQuest, true)
    call QuestSetDiscovered(bj_lastCreatedQuest, true)
    call QuestSetCompleted(bj_lastCreatedQuest, false)
    call QuestItemSetDescription(QuestCreateItem(bj_lastCreatedQuest), "")
    call QuestSetEnabled(bj_lastCreatedQuest, true)
endfunction

//===========================================================================
function InitTrig_Sys_F9_Setup takes nothing returns nothing
    set gg_trg_Sys_F9_Setup = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Sys_F9_Setup, function Trig_Sys_F9_Setup_Actions )
endfunction

//===========================================================================
// Trigger: Sys F9 Set
//===========================================================================
function AddQuest takes string title, string title2, string description, boolean left returns quest
  set bj_lastCreatedQuest = CreateQuest()
  call QuestSetTitle(bj_lastCreatedQuest, title)
  if ( title2 != "" ) then
    call QuestItemSetDescription(QuestCreateItem(bj_lastCreatedQuest), title2)
  endif
  call QuestSetDescription(bj_lastCreatedQuest, description)
  call QuestSetIconPath(bj_lastCreatedQuest, "ReplaceableTextures\\CommandButtons\\BTNAmbush.blp")
  
  call QuestSetRequired(bj_lastCreatedQuest, left)
  call QuestSetEnabled(bj_lastCreatedQuest, true)
 return bj_lastCreatedQuest
endfunction
function Trig_Sys_F9_Set_Actions takes nothing returns nothing
  call AddQuest("명령어", "\"-카페\" / \"-오픈채팅\" (링크 직접 열림)", "\"-시야 |cffc3dbff50~220|r\" / 시야 |cffc3dbff50~220|r
\"-load1\" (서버 로드 혹은 리로드)
\"-|cffc3dbff(스텟) 1~99|r\" (힘/덱(민)/인/위/콘)
\"-초보자\" / \"-팁 끄기\" (기초 도움말이 있습니다, 필독!)
\"-리콜\" (50레벨 이하 초보자 마을로 귀환)
\"-전직\" / \"-스텟\" (직업 관련 기본 정보를 줍니다)
\"-체력\" / \"-마력\" (선스텟으로 인한 상승량 확인 가능)
\"-사냥터\" (레벨별 사냥터 정보 표시)
\"-정보\" (현재 사냥터 정보 표시)
\"-경험치\" (경험치 관련 정보 표시)
\"-써클\" / \"-주사위\" / \"-리플레이\" / \"-칭호\" / \"-인벤토리\" / \"-버전\" / \"-퀘스트\" / (혹은 \"-쾌스트\")
\"-이펙트\" (렉이 심할 때)
\"-스킨\" (스킨 변경)
\"-난이도\" (5단계구분, 시작&로드 10분내)", true)


  call AddQuest("세이브 / 로드", "서버방식 + 컴터 저장 + (수동)코드 방식 콤비네이션 사용!","자동저장 (O - S) 기능을 통해, 5분에 한번씩 컴퓨터에 저장할 수 있습니다.

세이브 : -save
로드 : -load, -load2, -load1

-save는 일반적인 워크폴더 안에 세입파일이 생성되는 세이브방식.
이후 자동으로 서버 저장 유무를 묻습니다.

-load, -load2는 영웅과 창고를 코드를 복사/붙여넣기하는 로드방식.
-load1은 -save1로 저장한 세입을 불러오는 로드방식. (-load 이전 사용 가능)", true)


  call AddQuest("자주 묻는 질문", "", "-퀘스트는 NPC를 우클릭 혹은 강제 공격(A)하여 받습니다.
- 스킬은 기술/마법교관에게서 골드를 내고 배울 수 있습니다.
- 1써클: Lv 1~10 | 2써: 11~40 | 3써: ~70 | 4써: ~98 | 5써: 99
- 파티를 만들면 사냥을 최대 150%까지 효율적으로 할 수 있습니다.
- 레벨 99때, 스킬을 유지한 채 같은직업/다른직업으로 전직 가능합니다.", true)


  call AddQuest("직업 간략 소개", "직업을 가진채 시작합니다.", "총 5종류의 직업이 있습니다:
전사 - 가장 안정적인 직업이며, 체력 및 방어력 증가로 탱커의 역할을 합니다.
도적 - 날렵한 직업으로, 더블 크리티컬(엑스티컬)시 확률/배율/받는뎀지 증가
법사 - 원거리 마법 특화, 크리티컬(슈퍼캐스팅)시 체력 감소 5~15%(단일~전체)
직자 - 솔플 불가, 동료들을 치료하며 사냥하는 보조 특화 직업, 경험치 보너스 10%
도가 - 무기/신발/장갑 착용 불가, 팔찌 착용 가능. 가장 다양한 스킬/마법을 갖고 있음.

\"-자동스텟\" 명령어를 통해 렙업시 각 직업 추천 스텟을 찍습니다. (기본: ON)", true)

call TriggerSleepAction(.1)
//이하 오른쪽
  call AddQuest("각 직업 특성 소개", "타전직시 나중 직업 특성만 남습니다.", "각 직업별로 특성이 있습니다.
전사: X의 의지(방어 특화+어그로) / 마방감소
도적: 엑스티컬(데미지 특화) / 받뎀증가
마법사: 슈퍼캐스팅(마법 크리) / 발동시 체력감소
직자: (아이디어 수집중)
도가: 콤보(스킬 쿨초 등) / 손가락 피로 증가", false)


  call AddQuest("99 전직 간략 소개", "밀레스 신전 제단에서 진행", "다른 직업으로 전직을 하기 위해선 이전 직업의 모든 기술/마법을 배운 상태여야 합니다.

전직 전 직업별 필요 HP/MP (*순수전직으로)
전사 : 13000(*10000) / 4500
도적 : 8500(*6500) / 6000(*5000)
마법사 : 6500 / 11000(*9500)
성직자 : 6500 / 12000(*10500)
무도가 : 9000(*7000) / 9000(*8000)

ex. 도적이 법사로 전직하려면 체마가 8500/6000이 되어야하며, 도적이 도적으로 전직하려면 6500/5000이 필요합니다.
무도가는 순수전직만 가능합니다.

밀레스 승급 신전 입장시 엑쿠 8병, 체/마 구매시마다 엑쿠 3병 소모됩니다.
전직시, 10포인트와 엑쿠 20병이 추가로 필요합니다.", true)

  call AddQuest("승급 간략 소개", "밀레스 신전 제단에서 진행", "전직과 동일하나, 더 높은 요구조건이 필요합니다.
다른 직업의 스킬을 포함하여, 체력, 마력이 모두 계승됩니다.

직업별 필요 HP/MP
전사 : 23000 / 7000
도적 : 17500 / 9000
마법사 : 11500 / 16000
성직자 : 11500 / 17000
무도가 : 17000 / 12500

각 직업 체마조건 + 직업스킬 + 100포인트 + 엑쿠 200병 + 승급재료 100개
승급스킬 필요재료: |cffffff0030만 Gold+엑쿠 50병 + 승급재료30 + 좀비심장10|r
순수 승급스킬 재료: |cffffff0090만 Gold+엑쿠 200병 + 승급재료 100 + 좀비심장30 + 아크심장2|r
", true)

  call AddQuest("테스터/카페", "|c0052ff09S|c0064ff12p|c0077ff1be|c0089ff25c|c009bff2ei|c00adff37a|c00c0ff40l|c00d2ff49 |r|c00e4ff52T|c00f6ff5be|c00ffff65s|c00ffff6et|c00ffff77e|c00ffff80r : |cff7dbef0han1547|r", "테스터들:
J님 (따해카페 모델들)
현재 플레이하시는 모든분들.", false)



  call AddQuest("인벤토리", "|cff9932cc인벤토리 창에서 ESC를 누르면 다시 원래 화면으로 돌아옵니다.", "아이템을 먹으면 가상 인벤토리로 자동 이동됩니다.
인벤토리(단축키 i) 아이템을 클릭하면 가상 인벤토리 화면으로 넘어가집니다.

가상 인벤토리에서 아이템을 장착하면 아이템 옵션이 적용됩니다.
아이템은 12개를 장착하고 28개를 소지하여 총 40개를 이용할 수 있으며, 저장 됩니다.", false)


  call AddQuest("퀘스트 명령어", "", "\"-퀘스트\" :: 퀘스트 확인가능 및 도움말
\"-퀘속도 |cffc3dbff1~3|r\" :: 퀘스트 대화 속도 조절. (3이 빠름)
\"-스킵\"    :: 퀘스트 대화 메시지 1회 빠르게 넘김.", false)


  call AddQuest("파티 명령어", "※파티 생성시에 센스있는 파티명을 정할 수 있습니다!", "\"-파티생성 |cffc3dbff(파티명)\"|r
　└ex) -파티생성 안녕하세요
\"-파티해체\" / \"-파티탈퇴\"
\"-파티목록\"
\"-파티원\" / \"-파티정보\" / \"-파티원정보\"
\"-파티초대\" / \"-파티초대 ALL\"
\"-파티성향\"
\"-파티장변경\"", false)


//  call AddQuest("", "", "", false)
//  call AddQuest("", "", "", false)
  call TriggerExecute( gg_trg_Sys_Tip_Loop )
endfunction

//===========================================================================
function InitTrig_Sys_F9_Set takes nothing returns nothing
    set gg_trg_Sys_F9_Set = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Sys_F9_Set, function Trig_Sys_F9_Set_Actions )
endfunction

//===========================================================================
// Trigger: Sys Tip Loop
//===========================================================================
constant function QuestData takes integer i returns string
  if ( i == 1 ) then
    return "                    |c000080ff  매너게임합시다~\n                      심심하지않게 이야기도하며~"
  elseif ( i == 2 ) then
    return "                    |c000080ff  양보하는 멋진 모습을~"
  elseif ( i == 3 ) then
    return "                    |c000080ff 아이템은 사이좋게~"
  elseif ( i == 4 ) then
    return "                    |c000080ff ***** 캐릭터는 또 다른 나입니다 ****"  
  elseif ( i == 5 ) then
    return "                    |c000080ff※참고 :: 비디오설정(Alt+O→V)-입자 설정을 중간/높음으로 하시면 날씨효과를 보실 수 있습니다."
  elseif ( i == 6 ) then
    return "                    |c000080ff 현재 버전 및 정보가 궁금하다구요? |cffc3dbff-버전 |c000080ff을 입력!~"
  elseif ( i == 7 ) then
    return "                    |c000080ff 퀘스트가 어렵다구요? |cffc3dbff-퀘스트 |c000080ff를 입력!~"
  elseif ( i == 8 ) then
    return "                    |c000080ffF9 [도움말] 보시기 바랍니다."
  elseif ( i == 9 ) then
    return "                    |c000080ff플레이에 감사드립니다."
  else
    return ""
  endif
endfunction
constant function QuestData2 takes integer a returns string
  if ( a < 1 ) then
    return "여관에 들어가려면 여관 주인을 어택하여야 합니다."
  elseif ( a < 2 ) then
    return "일부 퀘스트는 여러번 클리어시 추가 보상이 있습니다."
  //elseif ( a < 3 ) then
//    return "마린 퀘스트 - 마린의 위치는 매 방마다 바뀝니다. (일정한 규칙성이 있습니다)"
//  elseif ( a < 4 ) then
    //return "레벨업이 힘들다면 퀘스트를 하여 레벨업을 보다 수월하게 하세요."
  //elseif ( a < 5 ) then
//    return "\"-칭호\"를 입력하여 자신이 가지고 있는 칭호를 달 수 있습니다!"
  elseif ( a < 6 ) then
    return "세이브 후, -load (해당 CODE)를 입력하여 틀린 부분을 확인할 수 있습니다."
  elseif ( a < 7 ) then
    return "써클의 레벨이 궁금하세요? 1써클: 1~10 / 2써클: 11~40 / 3써클: 41~70 / 4써클: 71~98 / 5써클: 99 입니다."
  elseif ( a < 8 ) then
    return "파티원이 없다면 아벨에 위치한 솔로 던전을 이용하세요."
  elseif ( a < 9 ) then
    return "매 몬스터는 체력이 다르며, 체력이 높을수록 경험치를 많이 줍니다."
  elseif ( a < 10 ) then
    return "돌연변이 몬스터! 낮은 확률로 등장하는 돌연변이 몬스터는 매우 강력하지만, 많은 경험치와 특별 아이템을 줍니다."
  //elseif ( a < 11 ) then
    //return "고기는 여관에서 구울 수 있으며, 잘 구울수록 효과가 좋은 고기가 됩니다."
  elseif ( a < 12 ) then
    return "민첩(DEX): 데미지가 15, 크리티컬 확률과 배율이, 그리고 20당 공격속도가 상승합니다."
  elseif ( a < 13 ) then
    //return "98 이후 플레이를 하려면 리플레이 등록은 필수! 관련 도움말: -리플레이"
    return "좋은 아이템을 획득했다면 스크린샷 혹은 리플레이를 카페에 올려주세요."
  elseif ( a < 14 ) then
    return "여관에서 각 마을로 텔레포트를 할 수 있습니다. (약간 비쌉니다)"
  elseif ( a < 15 ) then
    return "창고에 리콜이 있으면 창고스킬C로 리콜을 사용할 수 있습니다. 자리가 부족할 때 사용하세요."
  elseif ( a < 16 ) then
    return "레벨업시에 존재하는 순수 CON에 따라 체력이 더 많이 오르며, 순수 WIS에 따라 마나가 더 많이 오릅니다."
  elseif ( a < 17 ) then
    return "회복속도 - 마나 회복속도는 25초 고정입니다."
  elseif ( a < 18 ) then
    return "재생력 - 재생력 1당 회복량이 1%증가합니다. 재생력 100이면 회복량이 2배입니다."
  elseif ( a < 19 ) then
    return "AC - 방어력. 1당 데미지가 1% 감소합니다. (기본 감소률 -100%, AC 200일시 물리공격에 무적)"
  elseif ( a < 20 ) then
    return "스탯 정보! STR - 힘. 공격력 향상, 최대공격력 향상(보이지 않음, 무기를 먹었을 때 표시됨). 체력은 오르지 않습니다."
  elseif ( a < 21 ) then
    return "스탯 정보! DEX - 민첩. 명중률 향상, 크리티컬 확률과 배율이 향상됨. 공격속도는 빨라지지 않습니다."
  elseif ( a < 22 ) then
    return "스탯 정보! INT - 지식. 기본적인 마법 공격력 증가, 마법 방어력 증가."
  elseif ( a < 23 ) then
    return "스탯 정보! WIS - 지혜. 최대마나 증가, 마나 회복량% 증가, 레벨업시 상승하는 마나 증가."
  elseif ( a < 24 ) then
    return "스탯 정보! CON - 지구력. 체력 최대치가 오르진 않지만 레벨업시 증가하는 체력 증가, 체력 회복속도 증가, 일부 스킬 데미지 증가"
  elseif ( a < 25 ) then
    return "\"-리콜\"을 입력하여 여관으로 이동이 가능합니다. (50 이하)"
  elseif ( a < 26 ) then
    return "현재 맵에 어떤 유닛이 리스폰되는지 궁금한가요? 명령어 \"-정보\"를 입력해  보세요."
  elseif ( a < 27 ) then
    return "\"-경험치\"를 입력하여 자신이 경험치를 얼마나 올렸나 확인해보세요."
  elseif ( a < 28 ) then
    return "스텟을 잘못 찍으셨다구요? 걱정 마세요! 신전에서 스텟 초기화가 가능합니다! (3서클 미만(~40) 전용)"
  elseif ( a < 29 ) then
    return "돈에 욕심내지 마세요! 돈은 습득시 자동으로 주변 파티원들과 분배됩니다."
  elseif ( a < 30 ) then
    return "독거미알은 파티원이 많을수록, 더 강한 독거미를 잡을수록 더 잘 나옵니다."
  elseif ( a < 31 ) then
    return "\"-스텟\"을 입력하여 각 직업 추천 스텟을 확인 해 보세요!"
  else
    return "카페에 가입시 원하는 정보를 쉽게 얻을 수 있습니다. \n　　　　　카페 주소 - http://cafe.naver.com/w3Lod"
  endif
endfunction
function QuestLoop takes nothing returns nothing
  call StartSound(gg_snd_QuestNew)
  call MSGAll(0, true, 2, 2, 15., QuestData(R2I(GetRandomReal(1.,9.99))))
endfunction
function QuestLoop2 takes nothing returns nothing
  set bj_forLoopAIndex = 1
  set bj_forLoopAIndexEnd = R2I(GetRandomReal(0., 32.))
  loop
    exitwhen bj_forLoopAIndex > 12
    if ( LoadBoolean(udg_hash, bj_forLoopAIndex, StringHash("Tip")) ) then
      call MSG(Player(bj_forLoopAIndex-1), 9, 20., I2S(R2I(bj_forLoopAIndexEnd))+": "+QuestData2(bj_forLoopAIndexEnd))
	endif
	set bj_forLoopAIndex = bj_forLoopAIndex + 1
  endloop
  call StartSound(gg_snd_GoodJob)
  call FlashQuestDialogButton()
endfunction
function Trig_Sys_Tip_Loop_Actions takes nothing returns nothing
  call DestroyTrigger(GetTriggeringTrigger())
  call TimerStart(CreateTimer(), GetRandomReal(360,480), true, function QuestLoop)
  call TimerStart(CreateTimer(), GetRandomReal(360,480), true, function QuestLoop2)
endfunction

//===========================================================================
function InitTrig_Sys_Tip_Loop takes nothing returns nothing
    set gg_trg_Sys_Tip_Loop = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Sys_Tip_Loop, function Trig_Sys_Tip_Loop_Actions )
endfunction

//===========================================================================
// Trigger: Sys Player Left
//===========================================================================
function Trig_Sys_Player_Left_Func010A takes nothing returns nothing
    call RemoveUnit( GetEnumUnit() )
endfunction

function Trig_Sys_Player_Left_Actions takes nothing returns nothing
    if ( IsPlayerInForce(GetTriggerPlayer(), udg_temp_pg) ) then
    call ForceRemovePlayerSimple( GetTriggerPlayer(), udg_temp_pg )
    endif
    call MSGAll(0, true, 1, 2, 10., SysStr(2,GetPlayerId(GetTriggerPlayer())+1)+udg_SysB_Name[GetPlayerId(GetTriggerPlayer())+1]+"|cffffdc3c님이 결국 버티지 못하고 나갔습니다.")
    call PartyLeft(GetPlayerId(GetTriggerPlayer())+1)
    call TriggerSleepAction( 0.10 )
    call MSGAll(0, true, 1, 2, 10., SysStr(2,GetPlayerId(GetTriggerPlayer())+1)+udg_SysB_Name[GetPlayerId(GetTriggerPlayer())+1]+"|cffffdc3c님의 유닛이 제거되었습니다.")
    call SetPlayerName( GetTriggerPlayer(), ( "[나감]" + GetPlayerName(GetTriggerPlayer()) ) )
    set udg_temp_g = GetUnitsOfPlayerAll(GetTriggerPlayer())
    call ForGroupBJ( udg_temp_g, function Trig_Sys_Player_Left_Func010A )
    call DestroyGroup( udg_temp_g )
    if ( GetTriggerPlayer() == udg_SysA_Host ) then
    call TriggerSleepAction( 0.10 )
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = bj_MAX_PLAYERS
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        if ( isPlaying(Player(bj_forLoopAIndex-1)) ) then
          call MSGAll(0, true, 1, 2, 10., SysStr(2,bj_forLoopAIndex)+udg_SysB_Name[bj_forLoopAIndex]+"|cffffdc3c님이 호스트 \"권한\"을 받았습니다.")
          set udg_SysA_Host = Player(bj_forLoopAIndex-1)
          exitwhen true
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    endif
endfunction

//===========================================================================
function InitTrig_Sys_Player_Left takes nothing returns nothing
    set gg_trg_Sys_Player_Left = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Sys_Player_Left, function Trig_Sys_Player_Left_Actions )
endfunction

//===========================================================================
// Trigger: Sys NoPatroll
//===========================================================================
function Trig_Sys_NoPatroll_Conditions takes nothing returns boolean
    if ( not ( GetIssuedOrderIdBJ() == String2OrderIdBJ("holdposition") ) ) then
        return false
    endif
    return true
endfunction

function Trig_Sys_NoPatroll_Actions takes nothing returns nothing
    call IssueImmediateOrderBJ( GetTriggerUnit(), "stop" )
endfunction

//===========================================================================
function InitTrig_Sys_NoPatroll takes nothing returns nothing
    set gg_trg_Sys_NoPatroll = CreateTrigger(  )
    call TriggerAddCondition( gg_trg_Sys_NoPatroll, Condition( function Trig_Sys_NoPatroll_Conditions ) )
    call TriggerAddAction( gg_trg_Sys_NoPatroll, function Trig_Sys_NoPatroll_Actions )
endfunction

//===========================================================================
// Trigger: Sys NoTeamKill
//===========================================================================
function Trig_Sys_NoTeamKill_Conditions takes nothing returns boolean
 return ( isHero(GetAttacker()) ) and ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetAttacker()))+1] == 0 ) or ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetAttacker()))+1] != udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1] )
endfunction
function Trig_Sys_NoTeamKill_Actions takes nothing returns nothing
  call IssueImmediateOrder(GetAttacker(), "stop")
  call MSG(GetOwningPlayer(GetAttacker()), 1, 3., "파티원이 아닌자를 공격할 수 없습니다.")
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", GetAttacker(), "overhead"))
endfunction

//===========================================================================
function InitTrig_Sys_NoTeamKill takes nothing returns nothing
  set gg_trg_Sys_NoTeamKill = CreateTrigger()
  call TriggerAddCondition( gg_trg_Sys_NoTeamKill, Condition( function Trig_Sys_NoTeamKill_Conditions ) )
  call TriggerAddAction( gg_trg_Sys_NoTeamKill, function Trig_Sys_NoTeamKill_Actions )
endfunction

//===========================================================================
// Trigger: Sys Clear Items
//
// 아이템 청소
//===========================================================================
function Trig_ItemClaer_Func001A takes nothing returns nothing
  if ( GetItemTypeId(GetEnumItem()) == udg_FSE_it[1] ) then
    call OnlineGame(GetLocalPlayer(), 13, "")
  elseif ( GetEnumItem() != udg_MS_item ) then
    if ( GetItemType(GetEnumItem()) == ITEM_TYPE_CHARGED or GetItemType(GetEnumItem()) == ITEM_TYPE_UNKNOWN ) and ( GetItemLevel(GetEnumItem()) == 1 or GetItemLevel(GetEnumItem()) == 7 ) then
      call FlushChildHashtable(udg_hash, GetHandleId(GetEnumItem()))
      call RemoveItem(GetEnumItem())
    elseif ( LoadInteger(udg_hash, GetHandleId(GetEnumItem()), 3) == 0 ) then
      call SaveInteger(udg_hash, GetHandleId(GetEnumItem()), 3, 10)
    elseif ( LoadInteger(udg_hash, GetHandleId(GetEnumItem()), 3) <= 1 ) then
      call RemoveItem(GetEnumItem())
      call FlushChildHashtable(udg_hash, GetHandleId(GetEnumItem()))
    else
      call SaveInteger(udg_hash, GetHandleId(GetEnumItem()), 3, LoadInteger(udg_hash, GetHandleId(GetEnumItem()), 3)-1)
      set bj_lastCreatedTextTag = CreateTextTag()
      call SetTextTagTextBJ(bj_lastCreatedTextTag, I2S(LoadInteger(udg_hash, GetHandleId(GetEnumItem()), 3)), 8)
      call SetTextTagPos(bj_lastCreatedTextTag, GetWidgetX(GetEnumItem()), GetWidgetY(GetEnumItem()), 30)
      call SetTextTagColor(bj_lastCreatedTextTag, 255, 255, 255, 204)
      call Bufftt(bj_lastCreatedTextTag, 17)
    endif
  endif
endfunction

function Trig_ItemClaer_Actions takes nothing returns nothing
  call EnumItemsInRect(FMi_Rect(0), null, function Trig_ItemClaer_Func001A)
endfunction

//===========================================================================
function InitTrig_Sys_Clear_Items takes nothing returns nothing
  set gg_trg_Sys_Clear_Items = CreateTrigger(  )
  call TriggerRegisterTimerEvent(gg_trg_Sys_Clear_Items, 10.01, true)
  call TriggerAddAction( gg_trg_Sys_Clear_Items, function Trig_ItemClaer_Actions )
endfunction

//===========================================================================
// Trigger: Sys Clear Units
//
// 유닛 청소
//===========================================================================
function ClearUnitCondi takes nothing returns boolean
 return ( UnitAlive(GetFilterUnit()) ) and ( GetUnitUserData(GetFilterUnit()) != -1 ) and ( GetWidgetLife(GetFilterUnit()) > LoadReal(udg_hash, GetHandleId(GetFilterUnit()), StringHash("ClearUnit")) )
endfunction

function GetGroupPlayer takes group g, player whichPlayer, boolexpr filter returns group
  set g = CreateGroup()
  call GroupEnumUnitsOfPlayer(g, whichPlayer, filter)
  //call DestroyBoolExpr(filter)
  return g
endfunction

function Trig_Sys_Clear_Units_Func002A takes nothing returns nothing
 local integer id = GetHandleId(GetEnumUnit())
  if ( HaveSavedInteger(udg_hash, id, StringHash("ClearCount")) ) then
    if ( LoadInteger(udg_hash, id, StringHash("ClearCount")) == 0 ) then
      call Bufftt(CreateTextTagUnitBJ("Remove", GetEnumUnit(), 30.00, 8.00, 100, 100, 100, 20.00 ), 17)
      call FlushChildHashtable(udg_hash, id)
      call RemoveUnit(GetEnumUnit())
    else
      call SaveInteger(udg_hash, id, StringHash("ClearCount"), LoadInteger(udg_hash, id, StringHash("ClearCount")) -1)
      call SaveReal(udg_hash, id, StringHash("ClearUnit"), GetWidgetLife(GetEnumUnit()))
    endif
  else
    call SaveInteger(udg_hash, id, StringHash("ClearCount"), 12)
    call SaveReal(udg_hash, id, StringHash("ClearUnit"), GetWidgetLife(GetEnumUnit()))
  endif
endfunction

function Trig_Sys_Clear_Units_Actions takes nothing returns nothing
  set udg_temp_g = GetGroupPlayer(udg_temp_g, Player(PLAYER_NEUTRAL_AGGRESSIVE), Condition(function ClearUnitCondi))
  call ForGroup(udg_temp_g, function Trig_Sys_Clear_Units_Func002A)
  call DestroyGroup( udg_temp_g )
endfunction

//===========================================================================
function InitTrig_Sys_Clear_Units takes nothing returns nothing
  set gg_trg_Sys_Clear_Units = CreateTrigger(  )
  call TriggerRegisterTimerEvent(gg_trg_Sys_Clear_Units, 9.99, true)
  call TriggerAddAction( gg_trg_Sys_Clear_Units, function Trig_Sys_Clear_Units_Actions )
endfunction

//===========================================================================
// Trigger: Sys Enter Villeage
//===========================================================================
function Trig_Sys_Enter_Villeage_Conditions takes nothing returns boolean
 return ( isHero(GetTriggerUnit()) )
endfunction
function VilleageAction takes integer P, integer i returns nothing
  set udg_OnesPositionN[P] = -i
//debug call MSG(Player(P-1), 1, 4., "위치 설정: " + I2S(udg_OnesPositionN[P]) + ", " + Hunting_Data(udg_OnesPositionN[P]))
  call MSG(Player(P-1), 5, 7, Hunting_Data(-i))
  if ( i == 15 ) then
  //여관
    set udg_SysC_Regen[P] = udg_SysC_Regen[P] + 300
    call Bufftt(CreateTextTagUnitBJ("Regen +300", udg_Unit[P], 60., 7.5, 0., 100., 0., 0) ,1)
    call SetHoldCam(Player(P-1), Vileage_Rect(15))
    //set udg_ShareChatMsgOn[P] = true
    //call LocalLdbM(Player(P-1), udg_ShareChatBoard, true)
    //set udg_ShareChatMember = udg_ShareChatMember + 1
    call SoundCheck(Player(P-1), -15)
  else
    set udg_SysC_Regen[P] = udg_SysC_Regen[P] + 100
    call Bufftt(CreateTextTagUnitBJ("Regen +100", udg_Unit[P], 60., 7.5, 0., 100., 0., 0) ,1)
    call SoundCheck(Player(P-1), -1)
    if ( i != 2 ) then
      set udg_SysA_Revive[P] = Location(GetRectCenterX(Vileage_Rect(i)), GetRectCenterY(Vileage_Rect(i)))
    endif
  endif
  call SetCameraXY(Player(P-1), GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]))
  if ( IndexGet(FAL_GetMulti0(P, 0, 0, 2), 3) == 1 ) then
    call SetCameraTargetControllerNoZForPlayer(Player(P-1), udg_Unit[P], 0, 0, false)
  endif
  
  call TriggerSleepAction(1.)
  if ( udg_SysC_Regen[P] >= 300 ) then
    call SetHoldCam(Player(P-1), Vileage_Rect(15))
    call TriggerSleepAction(4.)
    call MSG(Player(P-1), 1, 4., "여관에 들어와 편안함을 느낍니다.")
  elseif ( udg_SysC_Regen[P] >= 100 ) then
    call TriggerSleepAction(4.)
    call MSG(Player(P-1), 1, 4., "마을에 들어와 편안함을 느낍니다.")
    call IndexSet(P, 1, i)
  endif
endfunction
function Trig_Sys_Enter_Villeage_Actions takes nothing returns nothing
  call VilleageAction(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, LoadInteger(udg_hash, GetHandleId(GetTriggeringRegion()), StringHash("Rect-i")))
endfunction

//===========================================================================
function InitTrig_Sys_Enter_Villeage takes nothing returns nothing
  set gg_trg_Sys_Enter_Villeage = CreateTrigger()
  call TriggerAddCondition( gg_trg_Sys_Enter_Villeage, Condition( function Trig_Sys_Enter_Villeage_Conditions ) )
  call TriggerAddAction( gg_trg_Sys_Enter_Villeage, function Trig_Sys_Enter_Villeage_Actions )
endfunction

//===========================================================================
// Trigger: Sys Exit Villeage
//===========================================================================
function Trig_Sys_Exit_Villeage_Conditions takes nothing returns boolean
 return ( isHero(GetTriggerUnit()) )
endfunction

function Trig_Sys_Exit_Villeage_Actions takes nothing returns nothing
  if ( LoadInteger(udg_hash, GetHandleId(GetTriggeringRegion()), StringHash("Rect-i")) == 15 ) then
  //여관
    set udg_SysC_Regen[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1] = udg_SysC_Regen[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1] - 300
    call Bufftt(CreateTextTagUnitBJ("Regen -300", GetTriggerUnit(), 0., 7.5, 100., 0., 0., 0), 1)
    call SetHoldCam(GetOwningPlayer(GetTriggerUnit()), FMi_Rect(0))
    call SetCameraXY(GetOwningPlayer(GetTriggerUnit()), GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()))
    //set udg_ShareChatMsgOn[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1] = false
    //call LocalLdbM(GetOwningPlayer(GetTriggerUnit()), udg_ShareChatBoard, false)
    //set udg_ShareChatMember = udg_ShareChatMember - 1
  else
    set udg_SysC_Regen[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1] = udg_SysC_Regen[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1] - 100
    call Bufftt(CreateTextTagUnitBJ("Regen -100", GetTriggerUnit(), 0., 7.5, 100., 0., 0., 0), 1)
  endif
endfunction

//===========================================================================
function InitTrig_Sys_Exit_Villeage takes nothing returns nothing
    set gg_trg_Sys_Exit_Villeage = CreateTrigger(  )
    call TriggerAddCondition( gg_trg_Sys_Exit_Villeage, Condition( function Trig_Sys_Exit_Villeage_Conditions ) )
    call TriggerAddAction( gg_trg_Sys_Exit_Villeage, function Trig_Sys_Exit_Villeage_Actions )
endfunction

//===========================================================================
// Trigger: Sys Moving
//===========================================================================
constant function MovingLvHpMpAnd takes integer i returns string
  if ( i == 5 ) then
    return "41|99"
  elseif ( i == 11 ) then
    return "86|99"
  elseif ( i == 14 ) then
    return "99|99|800|700|X|O"
  elseif ( i == 18 ) then
    return "99|99|1000|900|X|O"
  endif
  return ""
endfunction
function CheckHpMp takes integer P, integer HP, integer MP, string isAnd, string pure returns boolean
  if ( pure == "O" ) then
    set HP = GetHPMP(P, true) -HP
    
    set MP = GetHPMP(P, false) -MP
    set pure = "(순수)"
  else
    set HP = R2I(GetUnitState(udg_Unit[P], UNIT_STATE_MAX_LIFE)) -HP
    set MP = R2I(GetUnitState(udg_Unit[P], UNIT_STATE_MAX_MANA)) -MP
    set pure = ""
  endif
  
  if ( isAnd == "O" ) then
    if ( HP < 0 or MP < 0 ) then
      if ( HP < 0 ) then
        call MSG(Player(P-1), 1, 3, BaseStr(5) + "HP" + pure + BaseStr(11) + " 부족! " + BaseStr(5) + I2S(HP))
      endif
      if ( MP < 0 ) then
        call MSG(Player(P-1), 1, 3, BaseStr(4) + "MP" + pure + BaseStr(11) + " 부족! " + BaseStr(5) + I2S(MP))
      endif
      return false
    endif
    return true
  elseif ( HP < 0 and MP < 0 ) then
    call MSG(Player(P-1), 1, 3, BaseStr(5) + "HP" + pure + BaseStr(11) + " 부족! " + BaseStr(5) + I2S(HP))
    call MSG(Player(P-1), 1, 3, BaseStr(4) + "MP" + pure + BaseStr(11) + " 부족! " + BaseStr(5) + I2S(MP))
    return false
  else
    return true
  endif
endfunction
//if ( CHM(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1,20000,15000, true, true) ) then

function Moving takes integer i returns nothing
  if ( i == 0 ) then
    call SetUnitPositionLoc(GetTriggerUnit(), udg_SysA_Revive[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1])
    call SetCameraXY(GetOwningPlayer(GetTriggerUnit()), GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()))
  elseif ( i == 16 ) then
    call SetUnitPositionLoc(GetTriggerUnit(), LoadLocationHandle(udg_hash, GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, StringHash("A01ELoc")))
    call RemoveLocation(LoadLocationHandle(udg_hash, GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, StringHash("A01ELoc")))
    call SetHoldCam(GetOwningPlayer(GetTriggerUnit()), FMi_Rect(0))
  elseif ( i == 19 ) then
    call SetUnitPosition(GetTriggerUnit(), MovingXY(i, true), MovingXY(i, false))
    call SetHoldCam(GetOwningPlayer(GetTriggerUnit()), FMi_Rect(0))
  elseif ( MovingLvHpMpAnd(i) == "" ) then
    call SetUnitPosition(GetTriggerUnit(), MovingXY(i, true), MovingXY(i, false))
    call SetCameraXY(GetOwningPlayer(GetTriggerUnit()), MovingXY(i, true), MovingXY(i, false))
  elseif ( GetUnitLevel(GetTriggerUnit()) >= S2I(FCut(MovingLvHpMpAnd(i),1)) ) and ( GetUnitLevel(GetTriggerUnit()) <= S2I(FCut(MovingLvHpMpAnd(i),2)) ) then
    if ( CheckHpMp(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, S2I(FCut(MovingLvHpMpAnd(i),3)), S2I(FCut(MovingLvHpMpAnd(i),4)), FCut(MovingLvHpMpAnd(i),5), FCut(MovingLvHpMpAnd(i),6) ) ) then
      call SetUnitPosition(GetTriggerUnit(), MovingXY(i, true), MovingXY(i, false))
      call SetCameraXY(GetOwningPlayer(GetTriggerUnit()), MovingXY(i, true), MovingXY(i, false))
    else
      call MSG(GetOwningPlayer(GetTriggerUnit()), 1, 4., "체/마력이 부족합니다.")
    endif
  else
    call MSG(GetOwningPlayer(GetTriggerUnit()), 1, 4., "레벨이 적절하지 않습니다. 레벨제한: " + I2S(S2I(FCut(MovingLvHpMpAnd(i),1))) + "~" + I2S(S2I(FCut(MovingLvHpMpAnd(i),2))))
  endif
  if ( IndexGet(FAL_GetMulti0(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 0, 0, 2), 3) == 1 ) then
    call SetCameraTargetControllerNoZForPlayer(GetOwningPlayer(GetTriggerUnit()), GetTriggerUnit(), 0, 0, false)
  endif
endfunction
function Trig_Sys_Moving_Actions takes nothing returns nothing
  if ( isHero(GetTriggerUnit()) ) then
    call Moving(LoadInteger(udg_hash, GetHandleId(GetTriggeringRegion()), StringHash("Rect-i")))
  endif
endfunction

//===========================================================================
function InitTrig_Sys_Moving takes nothing returns nothing
    set gg_trg_Sys_Moving = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Sys_Moving, function Trig_Sys_Moving_Actions )
endfunction

//===========================================================================
// Trigger: Sys Dummy Attacked
//===========================================================================
function Trig_Sys_DummyAttacked_Conditions takes nothing returns boolean
 return ( GetEventDamage() >= 2. )
endfunction

function DummyDmg takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local real d = LoadReal(udg_hash, GetHandleId(t), StringHash("Dummy-Dmg"))
 local real time = RMaxBJ(1., LoadReal(udg_hash, GetHandleId(t), StringHash("Dummy-Time")) + TimerGetElapsed(t))
 
  if ( time <= 1.1 ) then
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagText(bj_lastCreatedTextTag, "|cff9932cc데미지|r/|cffDFFB4F초|r: |cff9932cc" +I2S(R2I(d)) + "|r/|cffDFFB4Fs", 0.015)
    call SetTextTagPos(bj_lastCreatedTextTag, LoadReal(udg_hash, GetHandleId(t), StringHash("Dummy-X")), LoadReal(udg_hash, GetHandleId(t), StringHash("Dummy-Y")), 0.)
    call SetTextTagColor(bj_lastCreatedTextTag, 255, 255, 255, 255)
    call Bufftt(bj_lastCreatedTextTag, 18)
  else
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagText(bj_lastCreatedTextTag, "|cff9932cc데미지|r/"+R2SW(time,2,1)+"|cffDFFB4F초|r: |cff9932cc" +I2S(R2I(d)) + "|r/"+R2SW(time,2,1)+"|cffDFFB4Fs", 0.015)
    call SetTextTagPos(bj_lastCreatedTextTag, LoadReal(udg_hash, GetHandleId(t), StringHash("Dummy-X")), LoadReal(udg_hash, GetHandleId(t), StringHash("Dummy-Y")), 0.)
    call SetTextTagColor(bj_lastCreatedTextTag, 255, 255, 255, 255)
    call Bufftt(bj_lastCreatedTextTag, 18)
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagText(bj_lastCreatedTextTag, "|cff9932ccDPS|r: |cffed89d9" +I2S(R2I(d/time)) + "|r/|cffDFFB4Fs", 0.015)
    call SetTextTagPos(bj_lastCreatedTextTag, LoadReal(udg_hash, GetHandleId(t), StringHash("Dummy-X")), LoadReal(udg_hash, GetHandleId(t), StringHash("Dummy-Y")), -50.)
    call SetTextTagColor(bj_lastCreatedTextTag, 255, 255, 255, 255)
    call Bufftt(bj_lastCreatedTextTag, 18)
  endif
 call FlushChildHashtable(udg_hash, GetHandleId(t))
 call DestroyTimer(t)
 set t = null
endfunction
function Trig_Sys_DummyAttacked_Actions takes nothing returns nothing
 local unit u = GetTriggerUnit()
 local timer t = LoadTimerHandle(udg_hash, GetHandleId(u), StringHash("Dummy-Timer"))
  if ( TimerGetRemaining(t) > 0. ) then
    call SaveReal(udg_hash, GetHandleId(t), StringHash("Dummy-Time"), LoadReal(udg_hash, GetHandleId(t), StringHash("Dummy-Time")) + TimerGetElapsed(t))
  else
    set t = CreateTimer()
    call SaveTimerHandle(udg_hash, GetHandleId(u), StringHash("Dummy-Timer"), t)
    call SaveReal(udg_hash, GetHandleId(t), StringHash("Dummy-X"), GetWidgetX(u))
    call SaveReal(udg_hash, GetHandleId(t), StringHash("Dummy-Y"), GetWidgetY(u))
  endif
  call SaveReal(udg_hash, GetHandleId(t), StringHash("Dummy-Dmg"), LoadReal(udg_hash, GetHandleId(t), StringHash("Dummy-Dmg")) + GetEventDamage())
  if ( GetWidgetLife(u)-GetEventDamage() > .4 ) then
    call TimerStart(t, 2., false, function DummyDmg)
  else
    call TimerStart(t, 0., false, function DummyDmg)
  endif
  
  call SetUnitVertexColor(u, GetRandomInt(0,255), GetRandomInt(0,255), GetRandomInt(0,255), 255)
  if ( GetRandomInt(1, 3) <= 1 ) then
    call SetUnitAnimationByIndex(u, 2)
    call TriggerSleepAction(1.4)
  elseif ( GetRandomInt(1, 2) <= 1 ) then
    call SetUnitAnimationByIndex(u, 3)
    call TriggerSleepAction(.4)
  else
    call SetUnitAnimationByIndex(u, 1)
    call TriggerSleepAction(.4)
  endif
  call TriggerSleepAction(.2)
  call SetUnitAnimation(u, "stand")
  call SetUnitVertexColor(u, 255, 255, 255, 255)
  call SetUnitFacingTimed(u, GetRandomReal(0, 360), 0)
 set u = null
 set t = null
endfunction

//===========================================================================
function InitTrig_Sys_Dummy_Attacked takes nothing returns nothing
    set gg_trg_Sys_Dummy_Attacked = CreateTrigger(  )
    call TriggerAddCondition( gg_trg_Sys_Dummy_Attacked, Condition( function Trig_Sys_DummyAttacked_Conditions ) )
    call TriggerAddAction( gg_trg_Sys_Dummy_Attacked, function Trig_Sys_DummyAttacked_Actions )
endfunction

//===========================================================================
// Trigger: Sys Dummy Rev
//
// 몹 간단 부활. (허수아비)
//===========================================================================
function Trig_ReviveMob_Actions takes nothing returns nothing
 local real r = GetHandleId(GetDyingUnit())
 local unit u = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'o001', LoadReal(udg_hash, R2I(r), StringHash("Rev-LocX")), LoadReal(udg_hash, R2I(r), StringHash("Rev-LocY")), GetRandomReal(0, 360))
  call SaveReal(udg_hash, GetHandleId(u), StringHash("Rev-LocX"), LoadReal(udg_hash, R2I(r), StringHash("Rev-LocX")))
  call SaveReal(udg_hash, GetHandleId(u), StringHash("Rev-LocY"), LoadReal(udg_hash, R2I(r), StringHash("Rev-LocY")))
  call SetUS("Hp", u, R2I(GetUnitState(GetDyingUnit(),UNIT_STATE_MAX_LIFE))*2, true)
  //call TriggerRegisterUnitEvent(gg_trg_Sys_Dummy_Rev, u, EVENT_UNIT_DEATH)
  call SetUnitUserData(u, -1)
 set u = null
endfunction

//===========================================================================
function InitTrig_Sys_Dummy_Rev takes nothing returns nothing
  set gg_trg_Sys_Dummy_Rev = CreateTrigger()
  call TriggerAddAction( gg_trg_Sys_Dummy_Rev, function Trig_ReviveMob_Actions )
endfunction

//===========================================================================
// Trigger: Sys Elk
//===========================================================================
function Trig_Sys_Elk_Actions takes nothing returns nothing
  local unit a = GetDyingUnit()
  local integer i = LoadInteger(udg_hash, 0, StringHash("Elk"))+1
  call SaveInteger(udg_hash, 0, StringHash("Elk"), i)
  if ( GetRandomReal(0.,100.) <= 7. ) then
    set bj_lastCreatedUnit = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'nder', GetWidgetX(a), GetWidgetY(a), GetRandomDirectionDeg())
    call SetUS("hp", bj_lastCreatedUnit, IMinBJ(123456, R2I(Pow(2,i)*100))-15, true)
    call SetUS2("Miss", bj_lastCreatedUnit, 50.)
    call SetUS2("Mdf", bj_lastCreatedUnit, 50.)
    call TriggerRegisterUnitEvent(gg_trg_Sys_Elk_2, bj_lastCreatedUnit, EVENT_UNIT_DEATH)
    call AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", bj_lastCreatedUnit, "overhead")
    call TimeAction(bj_lastCreatedUnit, GetRandomReal(7.5, 15.), 19)
    call SetUnitUserData(bj_lastCreatedUnit, -1)
  endif
  set bj_lastCreatedUnit = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'nder', GetWidgetX(a), GetWidgetY(a), GetRandomDirectionDeg())
  call Bufftt(CreateTextTagUnitBJ("|cff46ffff" + I2S(i), a, 0., 7.5, 100., 100., 100., 0), 15)
  call FlushChildHashtable(udg_hash, GetHandleId(a))
  call RemoveUnit(a)
  set a = bj_lastCreatedUnit
  call SetUS("hp", a, IMinBJ(123441, R2I(Pow(2,i)*100))-15, true)
  call SetUnitUserData(a, -1)
  if ( i >= 7 ) then
    call TriggerRegisterUnitEvent(gg_trg_Sys_Elk_2, a, EVENT_UNIT_DEATH)
    call SetUS2("Miss", a, 25.)
    call SetUS2("Mdf", a, 25.)
    call AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", a, "overhead")
  else
    call SetUS2("Miss", a, 15.)
    call TriggerRegisterUnitEvent(gg_trg_Sys_Elk, a, EVENT_UNIT_DEATH)
  endif
  call TimeAction(a, GetRandomReal(7.5, 15.), 19)
  set a = null
endfunction

//===========================================================================
function InitTrig_Sys_Elk takes nothing returns nothing
    set gg_trg_Sys_Elk = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Sys_Elk, function Trig_Sys_Elk_Actions )
endfunction

//===========================================================================
// Trigger: Sys Elk 2
//===========================================================================
function Trig_Sys_Elk_2_Actions takes nothing returns nothing
  local integer P = bj_MAX_PLAYERS
  local integer i = LoadInteger(udg_hash, StringHash("elk"), 55)+1
  call SaveInteger(udg_hash, StringHash("elk"), 55, i)
  loop
    if ( UnitAlive(udg_Unit[P]) ) then
      if ( i <= 5 ) then
        call SetUS("Hp", udg_Unit[P], 400, false)
        call SetUS("Mp", udg_Unit[P], 400, false)
        call SaveInteger(udg_hash, StringHash("foo"), 55, LoadInteger(udg_hash, StringHash("foo"), 55)+i)
        set udg_SysK_ExpAdd[P] = udg_SysK_ExpAdd[P]+i
        set udg_SysK_DropAdd[P] = udg_SysK_DropAdd[P]+i
        set udg_SysK_GoldAdd[P] = udg_SysK_GoldAdd[P]+i
        call MSG(Player(P-1), 1, 12, "엘크의 희생으로...\n(현재 방에서(만) |cffff3315체력|cffffdc3c이 영구적으로 |cff55ff55400|cffffdc3c 증가합니다.)\n(현재 방에서(만) |cff0078ff마력|cffffdc3c이 영구적으로 |cff55ff55400|cffffdc3c 증가합니다.)\n경험치 획득률과 드랍률(아이템/골드)이 "+I2S(i)+"% 상승합니다.")
      else
        call MSG(Player(P-1), 1, 8., "엘크의 희생으로...")
      endif
      
      if ( ModuloInteger(i,4) == 1 ) then
        call SetBuff(udg_Unit[P], "BELLA", 3000., 25)
        call MSG(Player(P-1), 1, 12, "(50분동안 |cff55ff55Hit|cffffdc3c이 |cff9932cc25 |cffffdc3c상승합니다.)")
      elseif ( ModuloInteger(i,4) == 2 ) then
        call SetBuff(udg_Unit[P], "ENA", 3000., 20)
        call MSG(Player(P-1), 1, 12, "(50분동안 |cff55ff55Dam|cffffdc3c이 |cff9932cc20 |cffffdc3c상승합니다.)")
      elseif ( ModuloInteger(i,4) == 3 ) then
        call SetBuff(udg_Unit[P], "COLLA", 3000, 10)
        call MSG(Player(P-1), 1, 12, "(50분동안 |cff46ffff방어력|cffffdc3c이 |cff9932cc10 |cffffdc3c상승합니다.)")
      elseif ( ModuloInteger(i,4) == 0 ) then
        call SetBuff(udg_Unit[P], "HORR", 3000, 50)
        call MSG(Player(P-1), 1, 12, "(50분동안 |cff46ffff받는 데미지|cffffdc3c가 |cff9932cc50% |cffffdc3c감소합니다.)")
      endif
    endif
    exitwhen P <= 1
    set P = P - 1
  endloop
endfunction

//===========================================================================
function InitTrig_Sys_Elk_2 takes nothing returns nothing
    set gg_trg_Sys_Elk_2 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Sys_Elk_2, function Trig_Sys_Elk_2_Actions )
endfunction

//===========================================================================
// Trigger: Sys Novis Cow
//===========================================================================
function Trig_Nobis_Cow_Conditions takes nothing returns boolean
  //새끼 젖소, 소, 젖소
  return ( GetUnitTypeId(GetTriggerUnit()) == 'n050' ) or ( GetUnitTypeId(GetTriggerUnit()) == 'n04Y' ) or ( GetUnitTypeId(GetTriggerUnit()) == 'n04Z' )
endfunction

function Trig_Nobis_Cow_Actions takes nothing returns nothing
  call IssuePointOrder(GetTriggerUnit(), "move", GetRandomReal(GetRectMinX(gg_rct_Villeage_01), GetRectMaxX(gg_rct_Villeage_01)), GetRandomReal(GetRectMinY(gg_rct_Villeage_01), GetRectMaxY(gg_rct_Villeage_01)))
endfunction

//===========================================================================
function InitTrig_Sys_Novis_Cow takes nothing returns nothing
  set gg_trg_Sys_Novis_Cow = CreateTrigger(  )
  call TriggerRegisterLeaveRectSimple( gg_trg_Sys_Novis_Cow, gg_rct_Villeage_01 )
  call TriggerAddCondition( gg_trg_Sys_Novis_Cow, Condition( function Trig_Nobis_Cow_Conditions ) )
  call TriggerAddAction( gg_trg_Sys_Novis_Cow, function Trig_Nobis_Cow_Actions )
endfunction

//===========================================================================
// Trigger: Sys After 10m
//===========================================================================
function Trig_Sys_After_10m_Actions takes nothing returns nothing
endfunction

//===========================================================================
function InitTrig_Sys_After_10m takes nothing returns nothing
    set gg_trg_Sys_After_10m = CreateTrigger(  )
    call TriggerRegisterTimerEventSingle( gg_trg_Sys_After_10m, 600.00 )
    call TriggerAddAction( gg_trg_Sys_After_10m, function Trig_Sys_After_10m_Actions )
endfunction

//===========================================================================
// Trigger: Sys Boss1 Phase2
//===========================================================================
function BossSkill1_2Loop takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local unit u = LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("B.S2-U"))
 local real hp = GetWidgetLife(u)/GetUnitState(u,UNIT_STATE_MAX_LIFE)
 local integer lv = R2I((75.-hp)/5.)
  if ( hp < .25 ) then
    call SetUnitAbilityLevel(u, 'A05Y', 10)
    call SetUnitAbilityLevel(u, 'A062', 10)
    
    call SetUS("Armor", u, (lv-LoadInteger(udg_hash, GetHandleId(t), StringHash("B.S2-i")))*-3, false)
    call SetUS("MAC", u, (lv-LoadInteger(udg_hash, GetHandleId(t), StringHash("B.S2-i")))*-3, false)
    
    call FlushChildHashtable(udg_hash, GetHandleId(t))
    call DestroyTimer(t)
  elseif ( UnitAlive(u) ) and ( hp <= .7 ) and ( lv > LoadInteger(udg_hash, GetHandleId(t), StringHash("B.S2-i")) ) then
    //로어 이펙트, 레벨설정, 방어설정, 변수설정
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl", u, "origin"))
    call SetUnitAbilityLevel(u, 'A05Y', lv)
    call SetUnitAbilityLevel(u, 'A062', lv)
    
    call SetUS("Armor", u, (lv-LoadInteger(udg_hash, GetHandleId(t), StringHash("B.S2-i")))*-3, false)
    call SetUS("MAC", u, (lv-LoadInteger(udg_hash, GetHandleId(t), StringHash("B.S2-i")))*-3, false)
    
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("B.S2-i"), lv)
  endif
  set t = null
  set u = null
endfunction

function BossPhase takes unit u, integer phase returns nothing
 local integer BossNo = ISBOSS(GetUnitTypeId(u))
debug call BJDebugMsg("Phase Set:" + I2S(BossNo) + ":" + I2S(phase))
  call SaveInteger(udg_hash, GetHandleId(u), StringHash("FAI-Phase"), phase)
  if ( BossNo == 1 ) then
    //이펙트
    call ED(AddSpecialEffectTarget("war3mapImported\\PinkEcho.mdx", u, "origin"), 1.5)
    
    if ( phase == 2 ) then
      set bj_lastStartedTimer = CreateTimer()
      call SaveUnitHandle(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("B.S2-U"), u)
      call SaveInteger(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("B.S2-i"), 0)
      call TimerStart(bj_lastStartedTimer, .5, true, function BossSkill1_2Loop)
      set bj_lastStartedTimer = null
  
      call UnitAddAbility(u, 'A05Y')
      call UnitAddAbility(u, 'A062')
    
      call SetWidgetLife(u, GetUnitState(u, UNIT_STATE_MAX_LIFE)*.75)
      call TimeAction(u, 3., 1)
      call SetUnitInvulnerable(u, true)
      call TriggerSleepAction(3.)
      call SetUnitInvulnerable(u, false)
    elseif ( phase == 3 ) then
      //5초 무적,
      //스킬화
      /*3페이즈 (HP 40%)
      5초 무적, 위스프 5+5+5마리 생성
      위습 A *5마리 : HP 10만, 5초 캐스팅 힐 5% 시전
      4초 후, 위습 B *5마리 : HP 10만, 5초 캐스팅 타겟 디버프 시전
      4초 후, 위습 C *5마리 : HP 10만, 5초간 무작위 이동 + 광역(300Range) 디버프 시전*/
      
      set udg_temp_AI_u = u
      call SetWidgetLife(u, GetUnitState(u, UNIT_STATE_MAX_LIFE)*.45)
      call TimeAction(u, 5., 1)
      call SetUnitInvulnerable(u, true)
      call TriggerSleepAction(5.)
      call SetUnitInvulnerable(u, false)
      
    elseif ( phase == 4 ) then
      set udg_temp_AI_u = u
      call SetWidgetLife(u, GetUnitState(u, UNIT_STATE_MAX_LIFE)*.15)
      call TimeAction(u, 25., 1)
      call SetUnitInvulnerable(u, true)
      call TriggerSleepAction(25.)
      call SetUnitInvulnerable(u, false)
    endif
  endif
endfunction

function Trig_Sys_Boss1_Phase2_Actions takes nothing returns nothing
 local unit u = GetTriggerUnit()
debug call BJDebugMsg("P2 - " + I2S(LoadInteger(udg_hash, GetHandleId(u), StringHash("FAI-Phase"))))
  if ( LoadInteger(udg_hash, GetHandleId(u), StringHash("FAI-Phase")) < 2 ) then
    call SaveInteger(udg_hash, GetHandleId(u), StringHash("FAI-Phase"), 2)
    call BossPhase(u, 2)
  endif
  set u = null
endfunction

//===========================================================================
function InitTrig_Sys_Boss1_Phase2 takes nothing returns nothing
    set gg_trg_Sys_Boss1_Phase2 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Sys_Boss1_Phase2, function Trig_Sys_Boss1_Phase2_Actions )
endfunction

//===========================================================================
// Trigger: Sys Boss1 Phase3
//===========================================================================
function Trig_Sys_Boss1_Phase3_Actions takes nothing returns nothing
 local unit u = GetTriggerUnit()
 //위습 생성 개수
 local integer number = 5
 //무작위 각도
 local real angle = GetRandomReal(0., 360./number)
debug call BJDebugMsg("P3 - " + I2S(LoadInteger(udg_hash, GetHandleId(u), StringHash("FAI-Phase"))))
  if ( LoadInteger(udg_hash, GetHandleId(u), StringHash("FAI-Phase")) < 3 ) then
    call SaveInteger(udg_hash, GetHandleId(u), StringHash("FAI-Phase"), 3)
    call BossPhase(u, 3)
  //위습A 5마리 생성
  loop
    //위습A 생성, 힐링웨이브 연결
    set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(u), 'e01M', PolarX(GetWidgetX(u), 200., 72.*number+angle), PolarY(GetWidgetY(u), 200., 72.*number+angle), bj_UNIT_FACING)
    
    call SaveLightningHandle(udg_hash, GetHandleId(u), StringHash("Lning"), AddLightningEx("HWPB", true, GetWidgetX(bj_lastCreatedUnit), GetWidgetY(bj_lastCreatedUnit), 30., GetWidgetX(u), GetWidgetY(u), 30.))
    
    //마공 c: 회복의구슬: 회복 - 5~7초(수동) + Stuck면역
    call AI_Guege(bj_lastCreatedUnit, "c", R2I((.5*number+5.)*4.), 999., true)
    call UnitApplyTimedLife(bj_lastCreatedUnit, 'BHwe', R2I((.5*number+5.)*4.)/4.+.1)
    call UnitAddAbility(bj_lastCreatedUnit, 'A02S')
    
    //사망시 정리 트리거
    call TriggerRegisterUnitEvent(gg_trg_Sys_Bead_Dead, bj_lastCreatedUnit, EVENT_UNIT_DEATH)
    
    exitwhen number <= 1
    set number = number - 1
  endloop
  
  call TriggerSleepAction(4.)
  set number = 5
  set angle = GetRandomReal(0., 360./number)
  //위습B 5마리 생성
  loop
    //위습B 생성, 스킬 b 사용
    set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(u), 'e01N', PolarX(GetWidgetX(u), 300., 72.*number+angle), PolarY(GetWidgetY(u), 300., 72.*number+angle), bj_UNIT_FACING)
    
    //마공 b: 파괴의구슬 - 5~7초(수동) + Stuck면역
    //LEVEL 8단계 스킬 사용을 위한.
    call SaveInteger(udg_hash, GetHandleId(bj_lastCreatedUnit), StringHash("Level"), 110)
    call AI_Guege(bj_lastCreatedUnit, "b", R2I((.5*number+5.)*4.), 999., true)
    call UnitAddAbility(bj_lastCreatedUnit, 'A02S')
    call UnitApplyTimedLife(bj_lastCreatedUnit, 'BHwe', R2I((.5*number+5.)*4.)/4.+.1)
    
    //사망시 정리 트리거
    call TriggerRegisterUnitEvent(gg_trg_Sys_Bead_Dead, bj_lastCreatedUnit, EVENT_UNIT_DEATH)
    
    exitwhen number <= 1
    set number = number - 1
  endloop
  
  call TriggerSleepAction(4.)
  set number = 5
  set angle = GetRandomReal(0., 360./number)
  //위습C 5마리 생성
  loop
    //위습C 생성, 스킬 d 사용
    set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(u), 'e01O', PolarX(GetWidgetX(u), 300., 72.*number+angle), PolarY(GetWidgetY(u), 300., 72.*number+angle), bj_UNIT_FACING)
    
    //마공 d: 폭발의구슬 - 5~7초(수동) + Stuck면역
    //LEVEL 8단계 스킬 사용을 위한.
    call AI_Guege(bj_lastCreatedUnit, "d", R2I((.5*number+5.)*4.), 999., true)
    call UnitApplyTimedLife(bj_lastCreatedUnit, 'BHwe', R2I((.5*number+5.)*4.)/4.+.1)
    call UnitAddAbility(bj_lastCreatedUnit, 'A02S')
    
    call IssuePointOrder(bj_lastCreatedUnit, "move", GetRandomReal(GetRectMinX(BOSSRECT(1)), GetRectMaxX(BOSSRECT(1))), GetRandomReal(GetRectMinY(BOSSRECT(1)), GetRectMaxY(BOSSRECT(1))))
    
    //사망시 정리 트리거
    call TriggerRegisterUnitEvent(gg_trg_Sys_Bead_Dead, bj_lastCreatedUnit, EVENT_UNIT_DEATH)
    
    exitwhen number <= 1
    set number = number - 1
  endloop
  endif
 set u = null
endfunction

//===========================================================================
function InitTrig_Sys_Boss1_Phase3 takes nothing returns nothing
  set gg_trg_Sys_Boss1_Phase3 = CreateTrigger(  )
  call TriggerAddAction( gg_trg_Sys_Boss1_Phase3, function Trig_Sys_Boss1_Phase3_Actions )
endfunction

//===========================================================================
// Trigger: Sys Boss1 Phase4
//===========================================================================
function Skill_B1P4_3 takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local unit Caster = LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("t_Caster"))
 local integer Count = LoadInteger(udg_hash, GetHandleId(t), StringHash("t_Count"))
 local group g = AI_Group(CreateGroup(),Caster,0,Condition(function AI_Condi_2))
 local unit Target = FirstOfGroup(g)
  if ( Count <= 0 ) then
    call FlushChildHashtable(udg_hash, GetHandleId(t))
    call DestroyTimer(t)
  else
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("t_Count"), Count -1)
    set udg_temp_rc = LoadRectHandle(udg_hash, GetHandleId(Caster), StringHash("FAI-Rect"))
    loop
      exitwhen Target == null
      call GroupRemoveUnit(g, Target)
    
      set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(Caster), 'e018', GetWidgetX(Target), GetWidgetY(Target), bj_UNIT_FACING)
      call UnitApplyTimedLife(bj_lastCreatedUnit, 'BHwe', 1.5)
      call ED(AddSpecialEffect("Abilities\\Spells\\Other\\Aneu\\AneuCaster.mdl", GetWidgetX(bj_lastCreatedUnit), GetWidgetY(bj_lastCreatedUnit)), 1.5)
      call SaveReal(udg_hash, GetHandleId(bj_lastCreatedUnit), StringHash("dummy_Range"), LoadReal(udg_hash, GetHandleId(t), StringHash("t_Range")))
      call TriggerRegisterUnitEvent(gg_trg_Sys_Boss1_Phase4n2, bj_lastCreatedUnit, EVENT_UNIT_DEATH)
      set Target = FirstOfGroup(g)
    endloop
  endif
  call DestroyGroup(g)
  set g = null
  set Caster = null
  set Target = null
endfunction
function Skill_B1P4_2 takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local unit Caster = LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("t_Caster"))
 local integer Count = LoadInteger(udg_hash, GetHandleId(t), StringHash("t_Count"))
  if ( Count <= 0 ) then
    call SetUnitInvulnerable(Caster, false)
    call FlushChildHashtable(udg_hash, GetHandleId(t))
    call DestroyTimer(t)
  else
    call SaveInteger(udg_hash, GetHandleId(t), StringHash("t_Count"), Count -1)
    
    //무작위 위치에 생성
    set udg_temp_rc = LoadRectHandle(udg_hash, GetHandleId(Caster), StringHash("FAI-Rect"))
    set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(Caster), 'e018', GetRandomReal(GetRectMinX(udg_temp_rc), GetRectMaxX(udg_temp_rc)), GetRandomReal(GetRectMinY(udg_temp_rc), GetRectMaxY(udg_temp_rc)), bj_UNIT_FACING)
    call UnitApplyTimedLife(bj_lastCreatedUnit, 'BHwe', 1.5)
    call ED(AddSpecialEffect("Abilities\\Spells\\Other\\Aneu\\AneuCaster.mdl", GetWidgetX(bj_lastCreatedUnit), GetWidgetY(bj_lastCreatedUnit)), 1.5)
    call SaveReal(udg_hash, GetHandleId(bj_lastCreatedUnit), StringHash("dummy_Range"), LoadReal(udg_hash, GetHandleId(t), StringHash("t_Range")))
    call TriggerRegisterUnitEvent(gg_trg_Sys_Boss1_Phase4n2, bj_lastCreatedUnit, EVENT_UNIT_DEATH)
  endif
  set t = null
  set Caster = null
endfunction

function Skill_B1P4 takes unit Caster, real TimerLoop, integer Count, real Range, boolean Random returns nothing
 local timer t = CreateTimer()
  call SaveUnitHandle(udg_hash, GetHandleId(t), StringHash("t_Caster"), Caster)
  call SaveReal(udg_hash, GetHandleId(t), StringHash("t_Range"), Range)
  call SaveInteger(udg_hash, GetHandleId(t), StringHash("t_Count"), Count)
  if ( Random ) then
    call TimerStart(t, TimerLoop, true, function Skill_B1P4_2)
  else
    call TimerStart(t, TimerLoop, true, function Skill_B1P4_3)
  endif
 set t = null
endfunction
function Trig_Sys_Boss1_Phase4_Actions takes nothing returns nothing
 local unit u = GetTriggerUnit()
debug call BJDebugMsg("P4 - " + I2S(LoadInteger(udg_hash, GetHandleId(u), StringHash("FAI-Phase"))))
  if ( LoadInteger(udg_hash, GetHandleId(u), StringHash("FAI-Phase")) < 4 ) then
    call SaveInteger(udg_hash, GetHandleId(u), StringHash("FAI-Phase"), 4)
    call BossPhase(u, 4)
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagPosUnit(bj_lastCreatedTextTag, u, 0)
    call SetTextTagText(bj_lastCreatedTextTag, "Blizzard !", .035)
    call Skill_B1P4(u, .0625, 320, 100., true) // 무작위 위치
    call Skill_B1P4(u, 1, 20, 100., false) // 챔피언 위치
  endif
 set u = null
endfunction

//===========================================================================
function InitTrig_Sys_Boss1_Phase4 takes nothing returns nothing
    set gg_trg_Sys_Boss1_Phase4 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Sys_Boss1_Phase4, function Trig_Sys_Boss1_Phase4_Actions )
endfunction

//===========================================================================
// Trigger: Sys Boss1 Phase4n2
//===========================================================================
function Trig_Sys_Boss1_Phase4n2_Actions takes nothing returns nothing
 local unit u = GetTriggerUnit()
 local group g
 local unit Target
  set udg_temp_AI_u = u
  set g = AI_Group(CreateGroup(),u,-650.+LoadReal(udg_hash, GetHandleId(u), StringHash("dummy_Range")),Condition(function AI_Condi_2))
  loop
    set Target = FirstOfGroup(g)
    exitwhen Target == null
    call GroupRemoveUnit(g, Target)
    
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl", GetWidgetX(Target), GetWidgetY(Target)))
    call DmgTrue(u, Target, 50000.)
  endloop
  set u = null
  call DestroyGroup(g)
  set g = null
endfunction

//===========================================================================
function InitTrig_Sys_Boss1_Phase4n2 takes nothing returns nothing
    set gg_trg_Sys_Boss1_Phase4n2 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Sys_Boss1_Phase4n2, function Trig_Sys_Boss1_Phase4n2_Actions )
endfunction

//===========================================================================
// Trigger: Sys Boss1 Dead
//===========================================================================
function Trig_Sys_Boss1_Dead_Actions takes nothing returns nothing
 local integer loopA = 1
  call SaveBoolean(udg_hash, StringHash("Boss1"), 0, true)
  loop
    if ( UnitAlive(udg_Unit[loopA]) ) then
      call SetUS("Hp", udg_Unit[loopA], 400, false)
      call SetUS("Mp", udg_Unit[loopA], 400, false)
      set udg_SysK_ExpAdd[loopA] = udg_SysK_ExpAdd[loopA]+6
      set udg_SysK_DropAdd[loopA] = udg_SysK_DropAdd[loopA]+6
      set udg_SysK_GoldAdd[loopA] = udg_SysK_GoldAdd[loopA]+6
      call MSG(Player(loopA-1), 1, 12, "보스를 잡음으로.. \n(현재 방에서(만) |cffff3315체력|cffffdc3c이 영구적으로 |cff55ff55400|cffffdc3c 증가합니다.)\n(현재 방에서(만) |cff0078ff마력|cffffdc3c이 영구적으로 |cff55ff55400|cffffdc3c 증가합니다.)\n경험치 획득률과 드랍률(아이템/골드)이 "+I2S(6)+"% 상승합니다.")
    endif
    exitwhen loopA > bj_MAX_PLAYERS
    set loopA = loopA + 1
  endloop
  
  set loopA = R2I(5. + LoadReal(udg_hash, GetHandleId(GetTriggerUnit()), StringHash("BonusHP")))
  loop
    exitwhen loopA <= 0
    call TriggerExecute(gg_trg_Item_Drop_3)
    
    if ( GetRandomReal(0., 100.) <= 33. ) then
      if ( GetRandomReal(0., 100.) <= 15. ) then
        call SetItemCharges(CreateItem(ScrolData2(-1), GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit())), 1)
      else
        call SetItemCharges(CreateItem(ScrolData2(GetRandomInt(33,42)), GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit())), (GetRandomInt(0,SysInt(0,29))*5+1)+1)
      endif
    endif
    set loopA = loopA - 1
  endloop
endfunction

//===========================================================================
function InitTrig_Sys_Boss1_Dead takes nothing returns nothing
    set gg_trg_Sys_Boss1_Dead = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Sys_Boss1_Dead, function Trig_Sys_Boss1_Dead_Actions )
endfunction

//===========================================================================
// Trigger: Sys Bead Dead
//
// 구슬 죽으면 체인 연결 제거
//===========================================================================
function Trig_Sys_Bead_Dead_Actions takes nothing returns nothing
 local unit u = GetTriggerUnit()
  call DestroyLightning(LoadLightningHandle(udg_hash, GetHandleId(u), StringHash("Lning")))

 call FlushChildHashtable(udg_hash, GetHandleId(u))
 set u = null
endfunction

//===========================================================================
function InitTrig_Sys_Bead_Dead takes nothing returns nothing
    set gg_trg_Sys_Bead_Dead = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Sys_Bead_Dead, function Trig_Sys_Bead_Dead_Actions )
endfunction

//===========================================================================
// Trigger: Sys Zombie Boom
//===========================================================================
function SetAI_u takes unit u returns unit
 set udg_temp_AI_u = u
 return u
endfunction
function Trig_Sys_Zombie_Boom_Actions takes nothing returns nothing
 local unit u = SetAI_u(GetTriggerUnit())
 local group g = AI_Group(CreateGroup(),u,-750.,Condition(function AI_Condi_2))
 local unit Target = null
  //폭발 이펙트 (자신, 이펙트)
  
  call SetUnitAnimation(u, "death" )
  if ( not udg_SysA_EffectSimple ) then
    call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Demon\\DemonLargeDeathExplode\\DemonLargeDeathExplode.mdl", GetWidgetX(u), GetWidgetY(u)) )
  endif
  
  loop
  //범위 데미지
    set Target = FirstOfGroup(g)
    exitwhen Target == null
    call GroupRemoveUnit(g, Target)
    
    if ( GetUnitAbilityLevel(u, 'A047') > 0 ) then
      //변이
      call DmgTrue(u, Target, RMaxBJ(5000., GetUnitState(Target, UNIT_STATE_MAX_LIFE)*.25))
    else
     //일반
      call DmgTrue(u, Target, RMaxBJ(3333., GetUnitState(Target, UNIT_STATE_MAX_LIFE)*.167))
    endif
  endloop
  
  set u = null
  call DestroyGroup(g)
  set g = null
endfunction

//===========================================================================
function InitTrig_Sys_Zombie_Boom takes nothing returns nothing
    set gg_trg_Sys_Zombie_Boom = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Sys_Zombie_Boom, function Trig_Sys_Zombie_Boom_Actions )
endfunction

//===========================================================================
// Trigger: Sys Zombie Revive
//===========================================================================
function Trig_Sys_Zombie_Revive_Actions takes nothing returns nothing
 local unit u = GetTriggerUnit()
 local real bonus = (LoadReal(udg_hash, GetHandleId(u), StringHash("BonusHP"))-1.) / 2.
 local unit newunit = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), GetUnitTypeId(u), GetWidgetX(u), GetWidgetY(u), GetRandomReal(0, 360))
  call SaveReal(udg_hash, GetHandleId(newunit), StringHash("BonusHP"), bonus)
  if ( GetUnitAbilityLevel(u, 'A047')>0 ) then
  //변이
    call SetUnitScale(newunit, 1.45, 1.45, 1.45)
  else
    call SetUnitScale(newunit, .9, .9, .9)
  endif
  call SetUnitVertexColor(newunit, ZombieColor(GetUnitTypeId(u)), ZombieColor(GetUnitTypeId(u)), ZombieColor(GetUnitTypeId(u)), 255)
  call SetUnitState(newunit, UNIT_STATE_MAX_LIFE, GetUnitState(u, UNIT_STATE_MAX_LIFE))
  call SetWidgetLife(newunit, GetUnitState(newunit, UNIT_STATE_MAX_LIFE)*.5)
  
  //한마리 더 생성
  set newunit = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), GetUnitTypeId(u), GetWidgetX(u), GetWidgetY(u), GetRandomReal(0, 360))
  call SaveReal(udg_hash, GetHandleId(newunit), StringHash("BonusHP"), bonus)
  if ( GetUnitAbilityLevel(u, 'A047')>0 ) then
  //변이
    call SetUnitScale(newunit, 1.45, 1.45, 1.45)
  else
    call SetUnitScale(newunit, .9, .9, .9)
  endif
  call SetUnitVertexColor(newunit, ZombieColor(GetUnitTypeId(u)), ZombieColor(GetUnitTypeId(u)), ZombieColor(GetUnitTypeId(u)), 255)
  call SetUnitState(newunit, UNIT_STATE_MAX_LIFE, GetUnitState(u, UNIT_STATE_MAX_LIFE))
  call SetWidgetLife(newunit, GetUnitState(newunit, UNIT_STATE_MAX_LIFE)*.5)
  
 set u = null
 set newunit = null
endfunction

//===========================================================================
function InitTrig_Sys_Zombie_Revive takes nothing returns nothing
    set gg_trg_Sys_Zombie_Revive = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Sys_Zombie_Revive, function Trig_Sys_Zombie_Revive_Actions )
endfunction

//===========================================================================
// Trigger: Ct 6 Load Error
//===========================================================================
function Trig_Ct_6_Load_Error_Actions takes nothing returns nothing
    call MSGAll(0, true, 1, 2, 15., BaseStr(7)+BaseStr(12)+"|cffffdc3c게"+"임"+"에"+"서"+" 패"+"배"+"합"+"니"+"다.|r ("+"6)")
    call OnlineGame(GetLocalPlayer(), 4, "")
endfunction

//===========================================================================
function InitTrig_Ct_6_Load_Error takes nothing returns nothing
    set gg_trg_Ct_6_Load_Error = CreateTrigger(  )
    call TriggerRegisterGameLoadedEventBJ( gg_trg_Ct_6_Load_Error )
    call TriggerAddAction( gg_trg_Ct_6_Load_Error, function Trig_Ct_6_Load_Error_Actions )
endfunction

//===========================================================================
// Trigger: FCS Start Cst
//
// SkillData - 1_캐스팅시간|2_스킬단축기|3_종류
// 추가 - 도중 취소 / 재사용 / 캐스팅 바
//===========================================================================
function Trig_FCS_Start_Cst_Conditions takes nothing returns boolean
 return ( GetSpellAbilityId() != 'cst0' ) and ( SubString(LoadStr(udg_hash, GetSpellAbilityId(), 67),0,1) == "M" ) and ( GetUnitAbilityLevel(GetTriggerUnit(), 'cst0') != 1 )
endfunction

function CulCstSpd takes unit u, real cast, string typ returns real
//Calculate Casting Speed 캐스팅 속도 계산
 local string s = LoadStr(udg_hash, GetHandleId(u), StringHash("FCS_"+typ))
 local integer i = 1
 local string S2 = FCut(s, i)
//debug call BJDebugMsg("FCS_시간계산 - 종류/시간 - "+typ+"/"+R2S(cast) + "/" + s)
  if ( SubString(s,0,1) == "|" ) then
    set s = SubString(s,1,StringLength(s))
  endif
  if ( cast == 9. ) then
    set cast = 20.
  endif
  loop
    set S2 = FCut(s, i)
    exitwhen S2 == ""
    if ( SubString(S2,0,1) == "+" ) then
      set cast = cast + S2R(SubString(S2,1,StringLength(S2)))
    elseif ( SubString(S2,0,1) == "-" ) then
      set cast = cast - S2R(SubString(S2,1,StringLength(S2)))
    elseif ( SubString(S2,0,1) == "=" ) then
      set cast = S2R(SubString(S2,1,StringLength(S2)))
    elseif ( SubString(S2,0,1) == "*" ) then
      set cast = cast * S2R(SubString(S2,1,StringLength(S2)))
    endif
    set i = i + 1
  endloop

  set s = LoadStr(udg_hash, GetHandleId(u), StringHash("FCS_Z"))
  set i = 1
  set S2 = FCut(s, i)
//debug call BJDebugMsg("FCS_시간계산 - 종류/시간 - Z/"+R2S(cast) + "/" + s)
  if ( SubString(s,0,1) == "|" ) then
    set s = SubString(s,1,StringLength(s))
  endif
  loop
    set S2 = FCut(s, i)
    exitwhen S2 == ""
    if ( SubString(S2,0,1) == "+" ) then
      set cast = cast + S2R(SubString(S2,1,StringLength(S2)))
    elseif ( SubString(S2,0,1) == "-" ) then
      set cast = cast - S2R(SubString(S2,1,StringLength(S2)))
    elseif ( SubString(S2,0,1) == "=" ) then
      set cast = S2R(SubString(S2,1,StringLength(S2)))
    elseif ( SubString(S2,0,1) == "*" ) then
      set cast = cast * S2R(SubString(S2,1,StringLength(S2)))
    endif
    set i = i + 1
  endloop
 set s = null
//debug call BJDebugMsg("FCS_시간계산(완료) - 종류/시간 - "+typ+"/"+R2S(cast))
 return RMaxBJ(0.,cast)
endfunction
//call SaveStr(udg_hash, GetHandleId(u), StringHash("FCS_Curse"), "-1.0") // 저주 1초 감소
//call SaveStr(udg_hash, GetHandleId(u), StringHash("FCS_Z"), "*0.5") // 추가 캐스팅 속도 2배

function FCS_clearTimer takes timer t returns nothing
  if ( t != null ) then
//debug call BJDebugMsg("FCS CLEAR - " + GetUnitName(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("FCst_User"))))
    call UnitRemoveAbility(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("FCst_User")), 'cst0')
    call RemoveUnit(LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("FCst_Bar")))
    call FlushChildHashtable(udg_hash, GetHandleId(t))
    call PauseTimer(t)
    call DestroyTimer(t)
  endif
 set t = null
endfunction

native EXGetAbilityDataInteger takes ability abil, integer level, integer data_type returns integer
function FCS_USE takes unit u, integer ab, integer state, unit target, real x, real y, boolean casting returns nothing
  set udg_temp_u = u
  set udg_temp_ab = ab
  set udg_temp_i = GetPlayerId(GetOwningPlayer(udg_temp_u))+1
  call UnitRemoveAbility(udg_temp_u, 'cst0')
//debug call BJDebugMsg("FCS END - Ability: " + GetObjectName(udg_temp_ab) + "/" + I2S(state))
  if ( state == 0 ) then
  //즉발, 대상없음 (스킬)
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagText(bj_lastCreatedTextTag, GetObjectName(udg_temp_ab), 0.0253)
    call SetTextTagPosUnit(bj_lastCreatedTextTag, udg_temp_u, 0)
    call SetTextTagColor(bj_lastCreatedTextTag, 139, 199, 252, 230)
    call SetTextTagVelocityBJ(bj_lastCreatedTextTag,15.,90.)
    call SetTextTagPermanent(bj_lastCreatedTextTag, false)
    call SetTextTagLifespan(bj_lastCreatedTextTag, 2.2)
    call SetTextTagFadepoint(bj_lastCreatedTextTag,.4)
  else
    //마법 사용 + 마나 소모
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagText(bj_lastCreatedTextTag, GetObjectName(udg_temp_ab), 0.0276)
    call SetTextTagPosUnit(bj_lastCreatedTextTag, udg_temp_u, 0)
    call SetTextTagColor(bj_lastCreatedTextTag, 139, 199, 252, 255)
    call SetTextTagVelocityBJ(bj_lastCreatedTextTag,15.,90.)
    call SetTextTagPermanent(bj_lastCreatedTextTag, false)
    call SetTextTagLifespan(bj_lastCreatedTextTag, 2.8)
    call SetTextTagFadepoint(bj_lastCreatedTextTag,.4)
    if ( state == 1 ) then
    //즉발, 대상없음 (마법)
    elseif ( state == 2 ) then
      set udg_temp_u2 = target
    //유닛 대상
    elseif ( state == 3 ) then
      set udg_temp_l = Location(x, y)
    //지점 대상
    endif
    if ( casting ) then
//debug call BJDebugMsg("FCS_마나1 - " + R2SW(GetUnitState(udg_temp_u, UNIT_STATE_MANA),5,1) + "-" + I2S(EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), ABILITY_DATA_COST)))
      call SetUnitState(udg_temp_u, UNIT_STATE_MANA, GetUnitState(udg_temp_u, UNIT_STATE_MANA)-EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), ABILITY_DATA_COST))
//debug call BJDebugMsg("FCS_마나2 - " + R2SW(GetUnitState(udg_temp_u, UNIT_STATE_MANA),5,1))
    endif
    call SetUnitAnimation(udg_temp_u, "stand")
  endif
  if ( HaveSavedHandle(udg_hash, udg_temp_ab, StringHash("PSkill")) ) then
//debug call BJDebugMsg("FCS_스킬 시전! " + GetObjectName(udg_temp_ab))
    call TriggerExecute(LoadTriggerHandle(udg_hash, udg_temp_ab, StringHash("PSkill")))
    call TimeAction(udg_temp_u, 0., 24)
    
    if ( SubString(LoadStr(udg_hash, udg_temp_ab, 67),5,6) == "O" ) then
      call EnableTrigger(gg_trg_Exp_Exception)
    endif
  endif
endfunction
//call FCS_USE(GetTriggerUnit(), GetSpellAbilityId(), 0~3)
function FCS_onCasted takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local unit u = LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("FCst_User"))
 local integer state = LoadInteger(udg_hash, GetHandleId(t), StringHash("FCst_State"))
 local integer ab = LoadInteger(udg_hash, GetHandleId(t), StringHash("FCst_Skill"))
  if ( GetUnitCurrentOrder(u) == 852046 ) then
  //load : 852046
    call SetUnitAbilityLevel(u, 'cst0', 1)
	if ( HaveSavedHandle(udg_hash, ab, StringHash("PSkill")) ) then
      call FCS_USE(u, ab, state, LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("FCst_Target")), LoadReal(udg_hash, GetHandleId(t), StringHash("FCst_TargetX")), LoadReal(udg_hash, GetHandleId(t), StringHash("FCst_TargetY")), TimerGetElapsed(t)>0.)
	else
debug call BJDebugMsg("FCS 에러_연동된 트리거 없음. - " + GetObjectName(ab))
	endif
  endif
 call FCS_clearTimer(t)
 set u = null
 set t = null
endfunction
function Trig_FCS_Start_Actions takes nothing returns nothing
 local integer ab = GetSpellAbilityId()
 local unit u = GetTriggerUnit()
 local real castTime = CulCstSpd(u,S2I(SubString(LoadStr(udg_hash, ab, 67),3,4)),SubString(LoadStr(udg_hash, ab, 67),4,5))
  //더블 캐스팅 방지
  call FCS_clearTimer(LoadTimerHandle(udg_hash, GetHandleId(u), StringHash("FCst_Timer")))
  if ( castTime > 0. ) then
    set bj_lastStartedTimer = CreateTimer()
    call SaveTimerHandle(udg_hash, GetHandleId(u), StringHash("FCst_Timer"), bj_lastStartedTimer)
    call SaveUnitHandle(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("FCst_User"), u)
	call SaveInteger(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("FCst_Skill"), ab)
    
    //캐스팅 바
    set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(u), 'cst1', GetWidgetX(u), GetWidgetY(u), bj_UNIT_FACING)
    call SetUnitTimeScale(bj_lastCreatedUnit, (100./castTime) * 0.01)
    call SaveUnitHandle(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("FCst_Bar"), bj_lastCreatedUnit)
    
    if ( GetSpellTargetUnit() != null ) then
      call SaveUnitHandle(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("FCst_Target"), GetSpellTargetUnit())
      call SaveInteger(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("FCst_State"), 2)
//debug call BJDebugMsg("FCS_캐스팅_예정#2: " + GetUnitName(LoadUnitHandle(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("FCst_User")))+"가 "+GetUnitName(LoadUnitHandle(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("FCst_Target")))+"에게, "+GetObjectName(ab)+"를 시전할 예정")
    elseif ( GetSpellTargetX() != 0. ) then
      call SaveReal(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("FCst_TargetX"), GetSpellTargetX())
      call SaveReal(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("FCst_TargetY"), GetSpellTargetY())
      call SaveInteger(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("FCst_State"), 3)
//debug call BJDebugMsg("지점 스킬 확인1 - X: " + R2S(LoadReal(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("FCst_TargetX"))))
    else
      call SaveInteger(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("FCst_State"), 1)
//debug call BJDebugMsg("FCS_캐스팅_예정#3: " + GetUnitName(LoadUnitHandle(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("FCst_User")))+"가 "+GetUnitName(LoadUnitHandle(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("FCst_Target")))+"에게, "+GetObjectName(ab)+"를 시전할 예정 (즉발)")
    endif
    if ( GetUnitAbilityLevel(u, 'cst0') == 0 ) then
      call UnitAddAbility(u, 'cst0')
    endif
	call TimeAction(u, 0., 13)
    //캐스팅 중 표시 - 2레벨일때 다른명령 하면 중지
    call SetUnitAbilityLevel(u, 'cst0', 2)
    call PauseUnit(u, true)
    call PauseUnit(u, false)
    call IssueImmediateOrderById(u, 851972) // stop
    call IssueImmediateOrder(u, "load")
    
    call TimerStart(bj_lastStartedTimer, castTime, false, function FCS_onCasted)
    set bj_lastStartedTimer = null
  endif
 set u = null
endfunction

//===========================================================================
function InitTrig_FCS_Start_Cst takes nothing returns nothing
    set gg_trg_FCS_Start_Cst = CreateTrigger()
    call TriggerAddCondition( gg_trg_FCS_Start_Cst, Condition( function Trig_FCS_Start_Cst_Conditions ) )
    call TriggerAddAction( gg_trg_FCS_Start_Cst, function Trig_FCS_Start_Actions )
endfunction

//===========================================================================
// Trigger: FCS Stop Cst
//===========================================================================
function Trig_FCS_Stop_Cst_Conditions takes nothing returns boolean
  return ( GetSpellAbilityId() == 'cst0' ) and ( GetUnitAbilityLevel(GetTriggerUnit(), 'cst0') == 2 ) and ( OrderId2String(GetUnitCurrentOrder(GetTriggerUnit())) == "load" )
endfunction

function Trig_FCS_Stop_Cst_Actions takes nothing returns nothing
  call FCS_clearTimer(LoadTimerHandle(udg_hash, GetHandleId(GetTriggerUnit()), StringHash("FCst_Timer")))
  call UnitRemoveAbility(GetTriggerUnit(), 'cst0')
endfunction

//===========================================================================
function InitTrig_FCS_Stop_Cst takes nothing returns nothing
    set gg_trg_FCS_Stop_Cst = CreateTrigger(  )
    call TriggerAddCondition( gg_trg_FCS_Stop_Cst, Condition( function Trig_FCS_Stop_Cst_Conditions ) )
    call TriggerAddAction( gg_trg_FCS_Stop_Cst, function Trig_FCS_Stop_Cst_Actions )
endfunction

//===========================================================================
// Trigger: FCS End Cst
//===========================================================================
function Trig_FCS_End_Cst_Conditions takes nothing returns boolean
  return ( GetSpellAbilityId() != 'cst0' ) and ( GetUnitAbilityLevel(GetTriggerUnit(), 'cst0') != 2 ) and ( isHero(GetTriggerUnit()) )
endfunction
function Trig_FCS_End_Cst_Actions takes nothing returns nothing
  if ( SubString(LoadStr(udg_hash, GetSpellAbilityId(), 67),0,1) == "M" ) then
    if ( GetSpellTargetUnit() != null ) then
      call FCS_USE(GetTriggerUnit(), GetSpellAbilityId(), 2, GetSpellTargetUnit(), GetSpellTargetX(), GetSpellTargetY(), false)
    else
      call FCS_USE(GetTriggerUnit(), GetSpellAbilityId(), 1, null, 0., 0., false)
    endif
  else
    call FCS_USE(GetTriggerUnit(), GetSpellAbilityId(), 0, null, 0., 0., false)
  endif
endfunction

//===========================================================================
function InitTrig_FCS_End_Cst takes nothing returns nothing
  set gg_trg_FCS_End_Cst = CreateTrigger()
  call TriggerAddCondition( gg_trg_FCS_End_Cst, Condition( function Trig_FCS_End_Cst_Conditions ) )
  call TriggerAddAction( gg_trg_FCS_End_Cst, function Trig_FCS_End_Cst_Actions )
endfunction

//===========================================================================
// Trigger: Exp Exception
//===========================================================================
function Trig_Exp_Exception_Actions takes nothing returns nothing
  /* 빵 후속처리 경험치제외 */
  set bj_forLoopAIndex = 1
  loop
    set udg_SysL_Wood[bj_forLoopAIndex] = GetPlayerState(Player(bj_forLoopAIndex-1), PLAYER_STATE_RESOURCE_LUMBER)
    exitwhen bj_forLoopAIndex >= bj_MAX_PLAYERS
    set bj_forLoopAIndex = bj_forLoopAIndex + 1
  endloop
  call DisableTrigger(gg_trg_Exp_Exception)
endfunction

//===========================================================================
function InitTrig_Exp_Exception takes nothing returns nothing
  set gg_trg_Exp_Exception = CreateTrigger(  )
  call DisableTrigger(gg_trg_Exp_Exception)
  call TriggerRegisterTimerEvent(gg_trg_Exp_Exception, 1., true)
  call TriggerAddAction(gg_trg_Exp_Exception, function Trig_Exp_Exception_Actions)
endfunction

//===========================================================================
// Trigger: SignBar Drag
//===========================================================================
function Trig_P_Drag_Actions takes nothing returns nothing
 local integer no = LoadInteger(udg_hash, GetHandleId(GetTriggeringTrackable()), StringHash("tr-n"))
  set bj_lastCreatedTextTag = CreateTextTag()
  call SetTextTagText(bj_lastCreatedTextTag, GetPString(no), 0.019)
  call SetTextTagPos(bj_lastCreatedTextTag, GetPath(no, true)-30., GetPath(no, false), 50.)
  call SetTextTagColor(bj_lastCreatedTextTag, GetRandomInt(128,255), GetRandomInt(128,255), GetRandomInt(128,255), 255)
  call Bufftt(bj_lastCreatedTextTag, 0)
  call ShowTextTagPlayer(LoadPlayerHandle(udg_hash, GetHandleId(GetTriggeringTrackable()), StringHash("tr-p")), bj_lastCreatedTextTag)
endfunction

//===========================================================================
function InitTrig_SignBar_Drag takes nothing returns nothing
    set gg_trg_SignBar_Drag = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SignBar_Drag, function Trig_P_Drag_Actions )
endfunction

//===========================================================================
// Trigger: SignBar Drag2
//===========================================================================
function Trig_P_Drag2_Actions takes nothing returns nothing
 local integer no = LoadInteger(udg_hash, GetHandleId(GetTriggeringTrackable()), StringHash("tr-n"))
debug call BJDebugMsg("P Drag2 "+ I2S(no))
  set bj_lastCreatedTextTag = CreateTextTag()
  call SetTextTagText(bj_lastCreatedTextTag, "|cffffdc3c" + FCut(GetPathS(no),1) + "(Click)", 0.023)
  call SetTextTagPos(bj_lastCreatedTextTag, GetPathX(no), GetPathY(no), 100.)
  if ( no == 6 ) then
    call SetTextTagColor(bj_lastCreatedTextTag, 196, 196, 196, 196)
  else
    call SetTextTagColor(bj_lastCreatedTextTag, 255, 255, 255, 255)
  endif
  call Bufftt(bj_lastCreatedTextTag, 0)
endfunction

//===========================================================================
function InitTrig_SignBar_Drag2 takes nothing returns nothing
    set gg_trg_SignBar_Drag2 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SignBar_Drag2, function Trig_P_Drag2_Actions )
endfunction

//===========================================================================
// Trigger: SignBar Hit
//===========================================================================
function Trig_SignBar_Hit_Actions takes nothing returns nothing
 local integer no = LoadInteger(udg_hash, GetHandleId(GetTriggeringTrackable()), StringHash("tr-n"))
 local string s = GetPathS(no)
debug call BJDebugMsg("P Drag3 "+ I2S(no))
  set bj_lastCreatedTextTag = CreateTextTag()
  call SetTextTagText(bj_lastCreatedTextTag, "|cffffdc3c"+FCut(GetPathS(no),1), 0.023)
  call SetTextTagPos(bj_lastCreatedTextTag, GetPathX(no), GetPathY(no), 100.)
  call SetTextTagColor(bj_lastCreatedTextTag, 255, 255, 255, 255)
  call Bufftt(bj_lastCreatedTextTag, 0)
  
  set bj_lastCreatedTextTag = CreateTextTag()
  if ( no == 6 ) then
    call SetTextTagText(bj_lastCreatedTextTag, "|c0055ff55"+udg_SysB_Name[GetPlayerId(GetLocalPlayer())+1], 0.019)
  else
    call SetTextTagText(bj_lastCreatedTextTag, "|c0055ff55"+FCut(GetPathS(no),2), 0.019)
  endif
  call SetTextTagPos(bj_lastCreatedTextTag, GetPathX(no), GetPathY(no), 30.)
  call SetTextTagColor(bj_lastCreatedTextTag, 255, 255, 255, 255)
  call Bufftt(bj_lastCreatedTextTag, 0)
  
  set bj_lastCreatedTextTag = CreateTextTag()
  call SetTextTagText(bj_lastCreatedTextTag, "|cff46ffff"+FCut(GetPathS(no),3), 0.019)
  call SetTextTagPos(bj_lastCreatedTextTag, GetPathX(no), GetPathY(no), -20.)
  call SetTextTagColor(bj_lastCreatedTextTag, 255, 255, 255, 255)
  call Bufftt(bj_lastCreatedTextTag, 0)
  
  if ( StringLength(FCut(GetPathS(no),4)) > 0 ) then
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagText(bj_lastCreatedTextTag, "|cffc3dbff"+FCut(GetPathS(no),4), 0.019)
    call SetTextTagPos(bj_lastCreatedTextTag, GetPathX(no), GetPathY(no), -70.)
    call SetTextTagColor(bj_lastCreatedTextTag, 255, 255, 255, 255)
    call Bufftt(bj_lastCreatedTextTag, 0)
  endif
endfunction

//===========================================================================
function InitTrig_SignBar_Hit takes nothing returns nothing
    set gg_trg_SignBar_Hit = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SignBar_Hit, function Trig_SignBar_Hit_Actions )
endfunction

//===========================================================================
// Trigger: Solo Add skrt
//
// call TriggerPutItem2(gg_trg_Solo_C_Add, 'skrt')
//===========================================================================
function Trig_Solo_Add_Actions takes nothing returns nothing
  call RemoveItem( GetManipulatedItem() )
  call TimerStart(LoadTimerHandle(udg_hash, StringHash("FCU"), 190),0.,false,function FCUTimer)
  call SaveReal(udg_hash, 47, StringHash("FCU-Time"), LoadReal(udg_hash, 47, StringHash("FCU-Time"))*.95)
  call SaveReal(udg_hash, 47, StringHash("FCU-Time2"), LoadReal(udg_hash, 47, StringHash("FCU-Time2"))*.95)
  call TriggerSleepAction(GetRandomReal(1., 10.))
  call TimerStart(LoadTimerHandle(udg_hash, StringHash("FCU"), 190),0.,false,function FCUTimer)
endfunction

//===========================================================================
function InitTrig_Solo_Add_skrt takes nothing returns nothing
    set gg_trg_Solo_Add_skrt = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Solo_Add_skrt, function Trig_Solo_Add_Actions )
endfunction

//===========================================================================
// Trigger: Solo Exit sorf
//===========================================================================
function Trig_Solo_Exit_sorf_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
  call RemoveItem( GetManipulatedItem() )
  call SetUnitPosition(udg_Unit[P], GetLocationX(udg_SysA_Revive[P]), GetLocationY(udg_SysA_Revive[P]))
endfunction

//===========================================================================
function InitTrig_Solo_Exit_sorf takes nothing returns nothing
    set gg_trg_Solo_Exit_sorf = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Solo_Exit_sorf, function Trig_Solo_Exit_sorf_Actions )
endfunction

//===========================================================================
// Trigger: Event Buff
//===========================================================================
constant function BuffMsg takes string name returns string
  if ( name == "roolove2090" ) or ( name == "roolove2091" ) then
    return "나의 찬란했던 시즌 1의 영광이여."
  elseif ( name == "roolove2099" )  then
    return "신규유저 버스타실분 문의주세요."
  elseif ( name == "fooiff" ) then
    return "즐거운 사냥 되시고 득템하세요."
  elseif ( name == "hidoda1" ) or ( name == "hidoda2" ) or ( name == "hidoda3" ) then
    return "행운을 빕니다."
  endif
  return "얍"
endfunction
function Trig_E_takes_ii_Actions takes nothing returns nothing
  local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
  local integer lv = S2I(SubString(udg_SysB_Title[P],16-1,16))-1
  local integer loopA = 1
  
  if ( LoadBoolean(udg_hash, StringHash("EventBuff"), P) ) then
    call MSG(Player(P-1), 1, 3., "이미 축복을 내렸습니다.")
  elseif ( lv <= 0 ) then
    call MSG(Player(P-1), 1, 3., "내릴 축복이 없습니다.")
  else
    call SaveBoolean(udg_hash, StringHash("EventBuff"), P, true) /* 잠수가능 */
    call DestroyTimer(LoadTimerHandle(udg_hash, P, StringHash("zzZ-t")))
    
    set lv = lv * 5
    set loopA = 1
    loop
      if ( udg_SysB_Level[loopA] > 0 ) then
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", udg_Unit[loopA], "origin"))
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", udg_Unit[loopA], "origin"))
        if ( udg_SysB_Level[loopA] < 99 ) then
          set udg_SysK_ExpAdd[loopA] = udg_SysK_ExpAdd[loopA] + lv*2
          set udg_SysK_DropAdd[loopA] = udg_SysK_DropAdd[loopA] + lv*2
          set udg_SysK_GoldAdd[loopA] = udg_SysK_GoldAdd[loopA] + lv*2
          call MSG(Player(loopA-1), 1, 15., SysStr(2, P) + GetPlayerName(Player(P-1)) + "|r : |c00ffff00"+BuffMsg(StringCase(udg_SysB_Name[P],false)))
          call MSG(Player(loopA-1), 1, 11., SysStr(2, P) + GetPlayerName(Player(P-1)) + "|c00ffff00님이 축복을 내려, 현재 캐릭터에 경험치 획득률/드랍률/골드 드랍률이 영구적으로 "+I2S(lv)+"% 상승하였습니다.")
          call MSG(Player(loopA-1), 2, 7., SysStr(2, P) + GetPlayerName(Player(P-1)) + "|cffffdc3c님에게 존경의 눈빛을 보내, 축복을 두배("+I2S(lv*2)+"%)로 받았습니다. (리로드시에는 1배로 적용)")
        else
          set udg_SysK_ExpAdd[loopA] = udg_SysK_ExpAdd[loopA] + lv
          set udg_SysK_DropAdd[loopA] = udg_SysK_DropAdd[loopA] + lv
          set udg_SysK_GoldAdd[loopA] = udg_SysK_GoldAdd[loopA] + lv
          call MSG(Player(loopA-1), 1, 15., SysStr(2, P) + GetPlayerName(Player(P-1)) + "|r : |c00ffff00"+BuffMsg(StringCase(udg_SysB_Name[P],false)))
          call MSG(Player(loopA-1), 1, 11., SysStr(2, P) + GetPlayerName(Player(P-1)) + "|c00ffff00님이 축복을 내려, 현재 캐릭터에 경험치 획득률/드랍률/골드 드랍률이 영구적으로 "+I2S(lv)+"% 상승하였습니다.")
        endif
      endif
      exitwhen loopA >= bj_MAX_PLAYERS
      set loopA = loopA + 1
    endloop
  endif
endfunction

//===========================================================================
function InitTrig_Event_Buff takes nothing returns nothing
  set gg_trg_Event_Buff = CreateTrigger(  )
  call TriggerAddAction(gg_trg_Event_Buff, function Trig_E_takes_ii_Actions )
endfunction

//===========================================================================
// Trigger: Event Buff2
//===========================================================================
function Trig_Event_EventCheck_Actions takes nothing returns nothing
 call JNEventCheck(GetOwningPlayer(GetTriggerUnit()))
endfunction

//===========================================================================
function InitTrig_Event_Buff2 takes nothing returns nothing
  set gg_trg_Event_Buff2 = CreateTrigger(  )
  call TriggerAddAction(gg_trg_Event_Buff2, function Trig_Event_EventCheck_Actions )
endfunction

//===========================================================================
// Trigger: Event Buff22
//===========================================================================
native JNUseUserRoleItemInfo takes string MapId, string SecretKey, string UserId, string ItemName returns string
native JNStringCount takes string str, string sub returns integer

function from_str takes string oid returns integer
  // '0' = 48 .. '9' = 57,
  // 'A' = 65 .. 'Z' = 90
  // 'a' = 97 .. 'z' = 122
  //
  // index(<chr>):
  // '0' = 0; chr(0 + 48) = '0' = 48
  // 'A' = 17; chr(17 + 48) = 'A' = 65
  // 'a' = 49; chr(49 + 48) = 'a' = 97
  //
 local string chars = "0123456789.......ABCDEFGHIJKLMNOPQRSTUVWXYZ......abcdefghijklmnopqrstuvwxyz"
 local integer This = 0
 local integer i
 local integer j
 local integer ordinal
 local string chr
 local integer pow_256 = 1
  
  set i = 3
  loop
    exitwhen i < 0
    set chr = SubString(oid, i, i + 1)
    
    set j = 0
    loop
      exitwhen j >= 75
      
      if chr == SubString(chars, j, j + 1) then
        set This = This + (j + 48) * pow_256
        set pow_256 = pow_256 * 256
        exitwhen true
      endif
      
      set j = j + 1
    endloop

    set i = i - 1
  endloop
  
 return This
endfunction
function Trig_E_Buff_ii_Actions takes nothing returns nothing
  local integer P = GetPlayerId(GetServerPlayer)+1
  local string s = GetServerCode
  local string s2 = ""
  local integer itemcode = 0
  local integer loopA = 0
  if ( JNStringCount(s,"니다.") == 0 ) then
    loop
      set s2 = JNStringSplit(s,"||",loopA)
      exitwhen s2 == null or s2 == ""
      set loopA = loopA + 1
    endloop
    call MSG(Player(P-1), 1, 7., "총 " + I2S(loopA) +" 개의 아이템을 받습니다.")
    loop
      set loopA = loopA - 1
      set s2 = JNStringSplit(s,"||",loopA)
      set itemcode = from_str(JNStringSplit(s2,"|",0))
      
      if ( itemcode == 'SKLL' ) then
        set itemcode = 1
        loop
          call SetUnitAbilityLevel(udg_Unit[P], LoadInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(itemcode))), 10)
          exitwhen itemcode >= 7
          set itemcode = itemcode + 1
        endloop
        call MSG(Player(P-1), 1, 7., "특별 아이템, '숙련도 상승'을(를) 받았습니다!" )
      else
        if ( S2I(JNStringSplit(s2,"|",1)) < 0 ) then
          call GiveItem(P, itemcode, (GetRandomInt(0,SysInt(0,29))*5)-S2I(JNStringSplit(s2,"|",1)))
        else
          call GiveItem(P, itemcode, S2I(JNStringSplit(s2,"|",1)))
        endif
        call SetItemUserData(bj_lastCreatedItem, P)
        call MSG(Player(P-1), 1, 7., "특별 아이템, " +GetObjectName(itemcode)+ "을(를) 받았습니다!" )
      endif
      
      exitwhen loopA <= 0
      call TriggerSleepAction(.1)
    endloop
  else
    call MSG(Player(P-1), 1, 7., "받을 아이템이 없습니다: |r" + s)
  endif
endfunction

//===========================================================================
function InitTrig_Event_Buff22 takes nothing returns nothing
  set gg_trg_Event_Buff22 = CreateTrigger(  )
  call TriggerAddAction(gg_trg_Event_Buff22, function Trig_E_Buff_ii_Actions )
endfunction

//===========================================================================
// Trigger: Event DailyCheck bzbe
//===========================================================================
function Trig_Event_DailyCheck_Actions takes nothing returns nothing
 call JNDailyCheck(GetOwningPlayer(GetTriggerUnit()))
endfunction

//===========================================================================
function InitTrig_Event_DailyCheck_bzbe takes nothing returns nothing
  set gg_trg_Event_DailyCheck_bzbe = CreateTrigger(  )
  call TriggerAddAction(gg_trg_Event_DailyCheck_bzbe, function Trig_Event_DailyCheck_Actions )
endfunction

//===========================================================================
// Trigger: Event DailyCheck2
//===========================================================================
function RandScrol takes nothing returns integer
  return GetRandomInt(3,12)+FMI_MAXMAX_INVENTORY
endfunction
function Trig_Event_DailyCheck2_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetServerPlayer)+1
 local integer rand = 0
 local integer DayCount = 0
 local boolean double = udg_SysB_Level[P] >= 86
 local integer rand2 = 0
//debug set GetServerCode = "0|7"
  if ( FCut(GetServerCode,1) == "0" ) then
    call ED(AddSpecialEffectTarget("war3mapImported\\Present_Item.mdx", udg_Unit[P], "overhead"), 3.)
    set DayCount = S2I(FCut(GetServerCode,2))
    set rand = RandScrol()
    
    if ( double ) then
      set rand2 = (GetRandomInt(0,SysInt(0,29))*5+1)+1
      call GiveItem(P, ScrolData2(rand), rand2)
      call GiveItem(P, ScrolData2(rand), rand2)
    else
      call GiveItem(P, ScrolData2(rand), (GetRandomInt(0,SysInt(0,29))*5+1)+1)
    endif
    
    if ( DayCount >= 2 ) then
      if ( double ) then
        call GiveItem(P, 'I084', 6)
        call GiveItem(P, 'I085', 6)
      else
        call GiveItem(P, 'I084', 3)
        call GiveItem(P, 'I085', 3)
      endif
    endif
    if ( DayCount >= 3 ) then
      set rand = RandScrol()
      if ( double ) then
        set rand2 = (GetRandomInt(0,SysInt(0,29))*5+1)+1
        call GiveItem(P, ScrolData2(rand), rand2)
        call GiveItem(P, ScrolData2(rand), rand2)
      else
        call GiveItem(P, ScrolData2(rand), (GetRandomInt(0,SysInt(0,29))*5+1)+1)
      endif
    endif
    if ( DayCount >= 5 ) then
      call GiveItem(P, ScrolData2(-1), 1)
      if ( double ) then
        call GiveItem(P, ScrolData2(-1), 1)
      endif
    endif
    if ( DayCount >= 7 ) then
      call GiveItem(P, ScrolData2(-1), 2)
      if ( double ) then
        call GiveItem(P, ScrolData2(-1), 2)
      endif
    endif
    
    set rand = GetRandomInt(1,100)
    if ( rand <= 40 ) then
      set rand = RandScrol()
      if ( double ) then
        set rand2 = (GetRandomInt(0,SysInt(0,29))*5+1)+1
        call GiveItem(P, ScrolData2(rand), rand2)
        call GiveItem(P, ScrolData2(rand), rand2)
      else
        call GiveItem(P, ScrolData2(rand), (GetRandomInt(0,SysInt(0,29))*5+1)+1)
      endif
    elseif ( rand <= 70 ) then
      set rand = RandScrol()
      if ( double ) then
        set rand2 = (GetRandomInt(0,SysInt(0,29))*5+1)+2
        call GiveItem(P, ScrolData2(rand), rand2)
        call GiveItem(P, ScrolData2(rand), rand2)
      else
        call GiveItem(P, ScrolData2(rand), (GetRandomInt(0,SysInt(0,29))*5+1)+2)
      endif
    elseif ( rand <= 90 ) then
      call GiveItem(P, ScrolData2(-1), 1)
      if ( double ) then
        call GiveItem(P, ScrolData2(-1), 1)
      endif
    else
      if ( double ) then
        set rand2 = (GetRandomInt(0,SysInt(0,29))*5+1)+3
        call GiveItem(P, ScrolData2(rand), rand2)
        call GiveItem(P, ScrolData2(rand), rand2)
      else
        call GiveItem(P, ScrolData2(rand), (GetRandomInt(0,SysInt(0,29))*5+1)+3)
      endif
    endif
    
    set rand = GetRandomInt(1,100)
    if ( rand <= 50 ) then
    //꽝
      call MSG(GetServerPlayer, 1, 3., "보너스: 꽝!")
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilMissile.mdl", udg_Unit[P], "origin"))
    elseif ( rand <= 74 ) then
      call MSG(GetServerPlayer, 1, 3., "보너스: 골드!")
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\ResourceItems\\ResourceEffectTarget.mdl", udg_Unit[P], "origin"))
      if ( double ) then
        call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD)+200000)
      else
        call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD)+100000)
      endif
    elseif ( rand <= 89 ) then
    //엑쿠 10병
      call MSG(GetServerPlayer, 1, 3., "보너스: 엑쿠!")
      if ( double ) then
        call GiveItem(P, 'I084', 20)
      else
        call GiveItem(P, 'I084', 10)
      endif
    elseif ( rand <= 99 ) then
    //만능 2강
      call MSG(GetServerPlayer, 1, 3., "보너스: 만능(2강)!")
      call GiveItem(P, ScrolData2(-1), 2)
      if ( double ) then
        call GiveItem(P, ScrolData2(-1), 2)
      endif
    else
    //만능 3강
      call MSG(GetServerPlayer, 1, 3., "보너스: 만능(3강)!")
      call GiveItem(P, ScrolData2(-1), 3)
      if ( double ) then
        call GiveItem(P, ScrolData2(-1), 3)
      endif
    endif
    
    call MSG(GetServerPlayer, 1, 3., "오늘자 출석 랜덤박스를 열었습니다!")
    
    if Save(GetPlayerId(GetTriggerPlayer())+1, false) then
      call Save2(GetPlayerId(GetTriggerPlayer())+1)
      call MSG(GetTriggerPlayer(), 2, 4, "자동 저장 |cff00ff00완료! |r - |cffffdc3c주문서류는 저장이 되지 않음에 주의하세요!")
    endif
  else
    call DisplayTimedTextToPlayer(GetServerPlayer, .5, 0, 4., "|cffffdc3c" + "이미 출석 체크를 하였습니다." + "|r")
  endif
endfunction

//===========================================================================
function InitTrig_Event_DailyCheck2 takes nothing returns nothing
    set gg_trg_Event_DailyCheck2 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Event_DailyCheck2, function Trig_Event_DailyCheck2_Actions )
endfunction

//===========================================================================
// Trigger: Event DailyCheckState mlst
//===========================================================================
function Trig_Event_DailyCheckStste_Actions takes nothing returns nothing
 call JNDailyCheck_State(GetOwningPlayer(GetTriggerUnit()))
endfunction

//===========================================================================
function InitTrig_Event_DailyCheckState_mlst takes nothing returns nothing
  set gg_trg_Event_DailyCheckState_mlst = CreateTrigger(  )
  call TriggerAddAction(gg_trg_Event_DailyCheckState_mlst, function Trig_Event_DailyCheckStste_Actions )
endfunction

//===========================================================================
// Trigger: Event DailyCheckState2
//===========================================================================
constant function MaxStat takes integer classno, integer statno returns integer
  if ( classno == 2 ) then
    if ( statno == 1 ) then
      return 215
    elseif ( statno == 2 ) then
      return 150
    elseif ( statno == 3 ) then
      return 100
    elseif ( statno == 4 ) then
      return 100
    elseif ( statno == 5 ) then
      return 180
    endif
  elseif ( classno == 3 ) then
    if ( statno == 1 ) then
      return 180
    elseif ( statno == 2 ) then
      return 215
    elseif ( statno == 3 ) then
      return 100
    elseif ( statno == 4 ) then
      return 100
    elseif ( statno == 5 ) then
      return 150
    endif
  elseif ( classno == 4 ) then
    if ( statno == 1 ) then
      return 100
    elseif ( statno == 2 ) then
      return 100
    elseif ( statno == 3 ) then
      return 215
    elseif ( statno == 4 ) then
      return 180
    elseif ( statno == 5 ) then
      return 150
    endif
  elseif ( classno == 5 ) then
    if ( statno == 1 ) then
      return 100
    elseif ( statno == 2 ) then
      return 100
    elseif ( statno == 3 ) then
      return 180
    elseif ( statno == 4 ) then
      return 215
    elseif ( statno == 5 ) then
      return 150
    endif
  elseif ( classno == 6 ) then
    if ( statno == 1 ) then
      return 180
    elseif ( statno == 2 ) then
      return 100
    elseif ( statno == 3 ) then
      return 150
    elseif ( statno == 4 ) then
      return 100
    elseif ( statno == 5 ) then
      return 215
    endif
  endif
  return 0
endfunction
//MaxStat(S2I(SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2)), 1)

function Trig_Event_DailyStateCheck2_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetServerPlayer)+1
 local integer double = 0
 local integer ClassNo = S2I(SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2))
 local integer StatNo = 0
 local integer StatValue = 0
//debug set GetServerCode = "0|7"
  if ( FCut(GetServerCode,1) == "0" ) then
    if ( SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),0,1) == "3" ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIlm\\AIlmTarget.mdl", udg_Unit[P], "origin"))
      if ( FCut(GetServerCode,2) == "7" ) then
        call MSG(GetServerPlayer, 1, 3., "7일 개근 보너스!")
        set double = double + 1
      endif
      if ( JNServerTime("dd") == "01" ) then
        call MSG(GetServerPlayer, 1, 3., "첫달 보너스!")
        set double = double + 1
      elseif ( JNServerTime("u") == "3" ) then
        if ( S2I(JNServerTime("dd")) >= 8 ) and ( S2I(JNServerTime("dd")) <= 14 ) then
          call MSG(GetServerPlayer, 1, 3., "둘째 수요일 보너스!")
          set double = double + 1
        elseif ( S2I(JNServerTime("dd")) >= 22 ) and ( S2I(JNServerTime("dd")) <= 28 ) then
          call MSG(GetServerPlayer, 1, 3., "넷째 수요일 보너스!")
          set double = double + 1
        endif
      endif
      call TriggerSleepAction(.1)
      
      loop
        if ( udg_SysE_STR1[P] < MaxStat(ClassNo, 1) ) then
          set StatNo = 1
          set StatValue = udg_SysE_STR1[P]
        endif
        if ( udg_SysE_DEX1[P] < MaxStat(ClassNo, 2) ) and ( udg_SysE_DEX1[P] > StatValue ) then
          set StatNo = 2
          set StatValue = udg_SysE_DEX1[P]
        endif
        if ( udg_SysE_INT1[P] < MaxStat(ClassNo, 3) ) and ( udg_SysE_INT1[P] > StatValue ) then
          set StatNo = 3
          set StatValue = udg_SysE_INT1[P]
        endif
        if ( udg_SysE_WIS1[P] < MaxStat(ClassNo, 4) ) and ( udg_SysE_WIS1[P] > StatValue ) then
          set StatNo = 4
          set StatValue = udg_SysE_WIS1[P]
        endif
        if ( udg_SysE_CON1[P] < MaxStat(ClassNo, 5) ) and ( udg_SysE_CON1[P] > StatValue ) then
          set StatNo = 5
          set StatValue = udg_SysE_CON1[P]
        endif
        if ( StatNo == 0 ) then
          call MSG(GetServerPlayer, 1, 4., "최대스텟에 도달했습니다. 엑스쿠라눔 10병을 획득합니다.")
          call GiveItem(P, 'I084', 10)
        else
          if ( StatNo == 1 ) then
            call AddState(P, "STR", 1, true)
            call MSG(GetServerPlayer, 1, 3., "출석 보상으로, STR이 올랐습니다.")
          elseif ( StatNo == 2 ) then
            call AddState(P, "DEX", 1, true)
            call MSG(GetServerPlayer, 1, 3., "출석 보상으로, DEX가 올랐습니다.")
          elseif ( StatNo == 3 ) then
            call AddState(P, "INT", 1, true)
            call MSG(GetServerPlayer, 1, 3., "출석 보상으로, INT가 올랐습니다.")
          elseif ( StatNo == 4 ) then
            call AddState(P, "WIS", 1, true)
            call MSG(GetServerPlayer, 1, 3., "출석 보상으로, WIS가 올랐습니다.")
          elseif ( StatNo == 5 ) then
            call AddState(P, "CON", 1, true)
            call MSG(GetServerPlayer, 1, 3., "출석 보상으로, CON이 올랐습니다.")
          else
            call MSG(GetServerPlayer, -1, 3., "출석 보상 에러")
          endif
        endif
        exitwhen double <= 0
        set double = double - 1
        set StatNo = 0
      endloop
    elseif ( udg_SysB_Level[P] == 99 ) then
      call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\newlevelup.mdx", udg_Unit[P], "origin"))
      call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)+10)
    else
      set bj_lastCreatedItem = CreateItem('rre2', GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]))
      call UnitAddItem(udg_Unit[P], bj_lastCreatedItem)
      call RemoveItem(bj_lastCreatedItem)
    endif
    call MSG(GetServerPlayer, 1, 3., "오늘자 출석체크:성장을 하였습니다!")
  else
    call MSG(GetServerPlayer, 1, 4., "이미 성장 지원을 받았습니다.")
  endif
endfunction

//===========================================================================
function InitTrig_Event_DailyCheckState2 takes nothing returns nothing
    set gg_trg_Event_DailyCheckState2 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Event_DailyCheckState2, function Trig_Event_DailyStateCheck2_Actions )
endfunction

//===========================================================================
// Trigger: Item Buy Orens
//===========================================================================
constant function OrenItemData takes integer ic, boolean xcu returns integer
  if ( ic == 'ofro') then
    if ( xcu ) then
      return 30
    else
      return 'I01K'
    endif
  elseif ( ic == 'ckng') then
    if ( xcu ) then
      return 60
    else
      return 'I01M'
    endif
  elseif ( ic == 'ratf') then
    if ( xcu ) then
      return 50
    else
      return 'I02K'
    endif
  elseif ( ic == 'tst2') then
    if ( xcu ) then
      return 50
    else
      return 'I02A'
    endif
  elseif ( ic == 'desc') then
    if ( xcu ) then
      return 50
    else
      return 'I082'
    endif
  elseif ( ic == 'modt') then
    if ( xcu ) then
      return 50
    else
      return 'I03K'
    endif
  elseif ( ic == 'tstr') then
    if ( xcu ) then
      return 50
    else
      return 'I03C'
    endif
  
  elseif ( ic == 'moon') then
    if ( xcu ) then
      return 21
    else
      return 'I075'
    endif
  elseif ( ic == 'rhe2') then
    if ( xcu ) then
      return 21
    else
      return 'I074'
    endif
  elseif ( ic == 'rde4') then
    if ( xcu ) then
      return 24
    else
      return 'I05V'
    endif
  elseif ( ic == 'manh') then
    if ( xcu ) then
      return 27
    else
      return 'I06P'
    endif
  elseif ( ic == 'rwat') then
    if ( xcu ) then
      return 27
    else
      return 'I06X'
    endif
  elseif ( ic == 'shas') then
    if ( xcu ) then
      return 250
    else
      return 'I09U'
    endif
  endif
  return 0
endfunction
function Trig_Item_Buy_Orens_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
 local integer itid = GetItemTypeId(GetManipulatedItem())
  if ( CountItem(P, 'I084') >= OrenItemData(itid,true) ) then
    call MinusItem(P, 'I084', OrenItemData(itid,true))
    if ( itid == 'shas' ) then
      call GiveItem(P, OrenItemData(itid,false), 1)
    else
      call GiveItem(P, OrenItemData(itid,false), 0)
    endif
    call SetItemUserData(bj_lastCreatedItem, P)
    call MSG(Player(P-1), 1, 6., "엑스쿠라눔 "+I2S(OrenItemData(GetItemTypeId(GetManipulatedItem()),true))+"병으로, " + GetItemName(bj_lastCreatedItem) + "을(를) 구입했습니다.")
  else
    call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) + 100000)
    call MSG(Player(P-1), 1, 6., "엑스쿠라눔이 "+I2S(OrenItemData(GetItemTypeId(GetManipulatedItem()),true))+"병 이상 필요합니다.")
  endif
endfunction

//===========================================================================
function InitTrig_Item_Buy_Orens takes nothing returns nothing
    set gg_trg_Item_Buy_Orens = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item_Buy_Orens, function Trig_Item_Buy_Orens_Actions )
endfunction

//===========================================================================
// Trigger: Move Mine Elevator
//===========================================================================
constant function MineElevatorData takes integer ic returns integer
  if ( ic == 'rsps') then
    return 1
  elseif ( ic == 'rreb') then
    return 5
  elseif ( ic == 'tdex') then
    return 9
  endif
  return 0
endfunction

function Trig_Move_Mine_Elevator_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
 local integer floor = MineElevatorData(GetItemTypeId(GetManipulatedItem()))
  if ( CountItem(P, 'I084') >= floor ) then
    call MinusItem(P, 'I084', floor)
    
    call MSGAll(P, false, 99, 1, 8, "엘리베이터를 타고 "+I2S(floor)+"층으로 이동합니다.")
    set udg_SYSTEM_MineFloor = floor
    call TriggerSleepAction(1.)
    
    set bj_forLoopAIndex = 1
    loop
      exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
      if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) then
        if ( RectContainsUnit(gg_rct_Rect_168_Mine, udg_Unit[bj_forLoopAIndex]) ) then
          call SetUnitPosition(udg_Unit[bj_forLoopAIndex], GetRandomReal(18016., 18304.), GetRandomReal(-16800., -16576.))
          set udg_OnesPositionN[bj_forLoopAIndex] = 50+floor
          call ClearTextMessagesBJ(GetForceOfPlayer(Player(bj_forLoopAIndex-1)))
          call MSG(Player(bj_forLoopAIndex-1), 5, 7, "광산 " + I2S(udg_SYSTEM_MineFloor) + "층")
          call SetCameraXY(Player(bj_forLoopAIndex-1), GetWidgetX(udg_Unit[bj_forLoopAIndex]), GetWidgetY(udg_Unit[bj_forLoopAIndex]))
          call TimeAction(udg_Unit[bj_forLoopAIndex], GetRandomReal(3.,5.), 3)
          call CinematicFilterGenericForPlayer(Player(bj_forLoopAIndex-1), 5., BLEND_MODE_BLEND, "ReplaceableTextures\\CameraMasks\\Black_mask.blp", 120, 120, 120, 0.00, 100, 100, 100, 100 )
        endif
      endif
      set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
  else
    call MSG(Player(P-1), 1, 6., "엑스쿠라눔이 "+I2S(floor)+"병 이상 필요합니다.")
  endif
endfunction

//===========================================================================
function InitTrig_Move_Mine_Elevator takes nothing returns nothing
    set gg_trg_Move_Mine_Elevator = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Move_Mine_Elevator, function Trig_Move_Mine_Elevator_Actions )
endfunction

//===========================================================================
// Trigger: Mine Trade Items crdt wneu wneg
//===========================================================================
constant function MineTradeData takes integer ic returns integer
  if ( ic == 'rsps') then
    return 1
  elseif ( ic == 'rreb') then
    return 5
  elseif ( ic == 'tdex') then
    return 9
  endif
  return 0
endfunction

function Trig_Mine_Trade_Items_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
 local integer count = 0
  if ( GetItemTypeId(GetManipulatedItem()) == 'wneg' ) then
 //승급재료 교환
    set count = CountItem(P, 'rin1') + CountItem(P, 'infs')*3 + CountItem(P, 'I09S')*9
    if ( count > 0 ) then
      call MinusItem(P, 'rin1', 999)
      call MinusItem(P, 'infs', 999)
      call MinusItem(P, 'I09S', 999)
      call GiveItem(P, 'I09T', count)
    elseif ( CountItem(P, 'I09R') > 0 ) then
      call MinusItem(P, 'I09R', 1)
      call GiveItem(P, 'I09T', 27)
    else
      call MSG(Player(bj_forLoopAIndex-1), 1, 4, "교환할 광물이 없습니다.")
    endif
  elseif ( GetItemTypeId(GetManipulatedItem()) == 'wneu' ) then
    set count = CountItem(P, 'rin1')/9
    if ( count > 0 ) then
      call GiveItem(P, 'I09R', count)
      call MinusItem(P, 'infs', count*9)
    endif
    
    set count = CountItem(P, 'infs')/3
    if ( count > 0 ) then
      call GiveItem(P, 'I09S', count)
      call MinusItem(P, 'infs', count*3)
    endif
    
  elseif ( GetItemTypeId(GetManipulatedItem()) == 'crdt' ) then
    set count = CountItem(P, 'rin1')/27
    if ( count > 0 ) then
      call GiveItem(P, 'I09R', count)
      call MinusItem(P, 'rin1', count*27)
    endif
    
    set count = CountItem(P, 'infs')/9
    if ( count > 0 ) then
      call GiveItem(P, 'I09S', count)
      call MinusItem(P, 'infs', count*9)
    endif
    
    set count = CountItem(P, 'I09S')/3
    if ( count > 0 ) then
      call GiveItem(P, 'I09R', count)
      call MinusItem(P, 'I09S', count*3)
    endif
  endif
endfunction

//===========================================================================
function InitTrig_Mine_Trade_Items_crdt_wneu_wneg takes nothing returns nothing
    set gg_trg_Mine_Trade_Items_crdt_wneu_wneg = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Mine_Trade_Items_crdt_wneu_wneg, function Trig_Mine_Trade_Items_Actions )
endfunction

//===========================================================================
// Trigger: ReviveHero
//===========================================================================
function Trig_ReviveHero_Actions takes nothing returns nothing
  call TriggerSleepAction(.5)
  if ( GetUnitAbilityLevel(GetTriggerUnit(), 'B00M') == 0 ) and ( LoadTimerHandle(udg_hash, GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, StringHash("Rev-Timer")) == null ) then
    
    //call Revive(GetTriggerUnit())
    call Coma(GetTriggerUnit(), 15, .5)
    call MSGAll(1, false, 1, -1, 8, "사망 버그!")
  endif

endfunction

//===========================================================================
function InitTrig_ReviveHero takes nothing returns nothing
    set gg_trg_ReviveHero = CreateTrigger(  )
    call TriggerAddAction( gg_trg_ReviveHero, function Trig_ReviveHero_Actions )
endfunction

//===========================================================================
// Trigger: Give Level Up rre2
//===========================================================================
function Trig_Give_Level_Up_rre2_Actions takes nothing returns nothing
endfunction

//===========================================================================
function InitTrig_Give_Level_Up_rre2 takes nothing returns nothing
    set gg_trg_Give_Level_Up_rre2 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Give_Level_Up_rre2, function Trig_Give_Level_Up_rre2_Actions )
endfunction

//===========================================================================
// Trigger: Give Wood engs
//===========================================================================
function Trig_Give_Wood_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
 local integer wood = GetItemCharges(GetManipulatedItem())
  call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)+wood)
  set udg_SysL_Wood[P] = GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)
  call MSG(Player(P-1), 1, 3., "포인트를 "+I2S(wood)+"P 받았습니다 !")
 call RemoveItem(GetManipulatedItem())
endfunction

//===========================================================================
function InitTrig_Give_Wood_engs takes nothing returns nothing
    set gg_trg_Give_Wood_engs = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Give_Wood_engs, function Trig_Give_Wood_Actions )
endfunction

//===========================================================================
// Trigger: Give SkillMax sbch
//===========================================================================
function SkillAdd takes unit u, integer SkillId, integer add returns nothing
  if ( GetUnitAbilityLevel(u, SkillId) < 10 ) then
    call SetUnitAbilityLevel(u, SkillId, IMinBJ(GetUnitAbilityLevel(u, SkillId)+add,10))
    call MSG(GetOwningPlayer(u), 1, 7., "Skill Lv up x"+I2S(add)+":" + GetObjectName(SkillId))
  endif
endfunction

function Trig_Give_SkillMax_sbch_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
 local integer i = 1
 local integer add = GetItemCharges(GetManipulatedItem())
  loop
    call SkillAdd(GetTriggerUnit(), LoadInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(i))), add)
    exitwhen i >= 7
    set i = i + 1
  endloop
  
  call MSG(Player(P-1), 1, 3., "스킬 숙련도가 "+I2S(add*10)+" 올랐습니다 !")
endfunction

//===========================================================================
function InitTrig_Give_SkillMax_sbch takes nothing returns nothing
    set gg_trg_Give_SkillMax_sbch = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Give_SkillMax_sbch, function Trig_Give_SkillMax_sbch_Actions )
endfunction

//===========================================================================
// Trigger: BossBar
//===========================================================================
library BossBar initializer OnInit

globals
  private integer Bar /* 체력바 프레임 */
  private boolean Bol = false /* 체력바 보여줄지 논리값 */
  private unit Boss = null /* 체력바 대상 보스 유닛 */
  private timer Tme = null /* 체력 갱신 타이머 */
  private trigger Trg = CreateTrigger()
endglobals

private function BossDead takes nothing returns nothing
  set Bol = false
  set Boss = null
  
  call DzFrameShow(Bar, false)
  call PauseTimer(Tme)
  call DestroyTimer(Tme)
  set Tme = null
endfunction
public function End takes player p returns nothing
  local integer P = GetPlayerId(p)+1
  set Bol = false
  set Boss = null
  if GetLocalPlayer() == p then
    call DzFrameShow(Bar, false)
  endif
endfunction

private function R2SS takes real exp returns string
  if ( exp >= 10000000. ) then
    return R2SW(exp/1000000.,2,1) + "M"
  elseif ( exp >= 1000000. ) then
    return R2SW(exp/1000000.,2,2) + "M"
  elseif ( exp >= 100000. ) then
    return I2S(R2I(exp)/1000) + "K"
  elseif ( exp >= 10000. ) then
    return R2SW(exp/1000.,2,1) + "K"
  else
    return I2S(R2I(exp))
  endif
endfunction
private function Refresh takes nothing returns nothing
  local integer P = 1
  local real temp
  local real temp2
  local real temp3
  if Bol then
    set temp = GetWidgetLife(Boss)
    set temp2 = GetUnitState(Boss, UNIT_STATE_MAX_LIFE)
    set temp3 = temp / temp2
    call DzFrameSetAnimateOffset(Bar, RMinBJ(0.999, temp3))
    call DzFrameSetText(DzFrameFindByName("BsBa_Text", 0), "|CFFFFCC00" + R2SS(temp) + " / " + R2SS(temp2) + "  |CFF8080FF(" + I2S(R2I(temp3 * 100)) + "%)")
  else
    call PauseTimer(Tme)
    call DestroyTimer(Tme)
    set Tme = null
  endif
endfunction

public function Apply takes player p, unit boss returns nothing
  local integer P = GetPlayerId(p)+1
  if GetLocalPlayer() == p then
    call DzFrameShow(Bar, true)
  endif
  set Bol = true
  set Boss = boss
  if Tme == null then
    set Tme = CreateTimer()
    call TimerStart(Tme, 0.03125, true, function Refresh)
    call TriggerRegisterUnitEvent(Trg, boss, EVENT_UNIT_DEATH)
  endif
endfunction

private function DelayedInit takes nothing returns nothing
  call PauseTimer(GetExpiredTimer())
  call DestroyTimer(GetExpiredTimer())
  
  call DzLoadToc("FDE Import.toc")
  set Bar = DzCreateFrame("BsBa_Bar", DzGetGameUI(), 0)
  call DzFrameSetModel(Bar, "Etc_HP_Bar.mdx", 0, 0)
  call DzFrameSetAbsolutePoint(Bar, JN_FRAMEPOINT_BOTTOMLEFT, 0.4, 0.52)
  call DzFrameSetAnimate(Bar, 0, false)
  call DzFrameShow(Bar, false)
  call TriggerAddAction(Trg, function BossDead)
endfunction

private function OnInit takes nothing returns nothing
  call TimerStart(CreateTimer(), 0.5, false, function DelayedInit)
endfunction

endlibrary//===========================================================================
// Trigger: Sys ChangJob A ALL
//
// |c008bc7fc
// 전사     세토아
// 도적     셔스
// 법사     로오
// 직자     이아
// 도가     메투스
//===========================================================================
constant function JOBNAME2 takes integer No returns string
  if ( No == 2 ) then
    return "전사"
  elseif ( No == 3 ) then
    return "도적"
  elseif ( No == 4 ) then
    return "마법사"
  elseif ( No == 5 ) then
    return "성직자"
  elseif ( No == 6 ) then
    return "무도가"
  else
    return ""
  endif
endfunction
constant function JOBNAME takes integer No returns string
  if ( No == 2 ) then
    return "세토아"
  elseif ( No == 3 ) then
    return "셔스"
  elseif ( No == 4 ) then
    return "로오"
  elseif ( No == 5 ) then
    return "이아"
  elseif ( No == 6 ) then
    return "메투스"
  else
    return ""
  endif
endfunction
//call ChangeJob(GetPlayerId(GetTriggerPlayer())+1, SysInt(3, GetUnitTypeId(udg_Unit[P])), 2)

constant function JOB_U2I takes unit u returns integer
  if ( u == gg_unit_H002_0322 ) then
    return 2
  elseif ( u == gg_unit_H003_0323 ) then
    return 3
  elseif ( u == gg_unit_H004_0324 ) then
    return 4
  elseif ( u == gg_unit_H005_0325 ) then
    return 5
  elseif ( u == gg_unit_H006_0326 ) then
    return 6
  endif
  return 0
endfunction

//승급 체크
function CheckChangeJob2 takes integer P, integer NPCNo returns boolean
 return ( NPCNo == S2I(SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2)) )
 // and ( ( SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),0,1) == "2" ) or ( ( SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),0,1) == "1" ) and ( GetHPMP(P,true) >= JOBHPMP(NPCNo,true) ) and ( GetHPMP(P,false) >= JOBHPMP(NPCNo,false) ) ) )
endfunction

function Trig_Sys_ChangJob_ALL_Actions takes nothing returns nothing
 local integer NPCNo = JOB_U2I(GetTriggerUnit())
 local integer P = GetPlayerId(GetOwningPlayer(GetAttacker())) + 1
  call IssueImmediateOrder(GetAttacker(), "stop")
  call PauseUnit(GetAttacker(), true)
  call TriggerSleepAction(.2)
  call MSG(GetOwningPlayer(GetAttacker()), 6, 4., JOBNAME(NPCNo)+"|r : |c00ffff00"+JOBNAME2(NPCNo)+"의 길을 걷겠는가?")
  call TriggerSleepAction(.6)
  call DialogDestroy(udg_temp_d)
  set udg_temp_d = DialogCreate()
  call DialogSetMessage(udg_temp_d, JOBNAME2(NPCNo)+"의 길을..")
  if ( SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),0,1) == "1" ) then
    set udg_SysM_Button[P] = DialogAddButton(udg_temp_d, "네, 새로 걷겠습니다. (Y)", 89)
    call SaveInteger(udg_hash, GetHandleId(udg_SysM_Button[P]), StringHash("temp"), NPCNo)
  endif
  if ( CheckChangeJob2(P, NPCNo) ) and ( SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),0,1) != "3" ) then
    set udg_SysM_Button3[P] = DialogAddButton(udg_temp_d, "네, 더 걷겠습니다. (W)", 87)
    call SaveInteger(udg_hash, GetHandleId(udg_SysM_Button3[P]), StringHash("temp"), NPCNo)
  endif
  //if ( 승급 조건 됨 ) then
    //버튼 추가
  //endif
  call DialogAddButton(udg_temp_d, "생각 좀 더 해보겠습니다. (N)", 78)
  call DialogClose(GetOwningPlayer(GetAttacker()), udg_temp_d, 5.)
  call TriggerRegisterDialogEvent(gg_trg_Sys_ChangJob_B_ALL, udg_temp_d)
  call PauseUnit(GetAttacker(), false)
endfunction

//===========================================================================
function InitTrig_Sys_ChangJob_A_ALL takes nothing returns nothing
    set gg_trg_Sys_ChangJob_A_ALL = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Sys_ChangJob_A_ALL, function Trig_Sys_ChangJob_ALL_Actions )
endfunction

//===========================================================================
// Trigger: Sys ChangJob B ALL
//===========================================================================
constant function JOBHPMP takes integer No, boolean hp, boolean same returns integer
  if ( No == 2 ) then
    if ( hp ) then
      if ( same ) then
        return 10000
      else
        return 13000
      endif
    else
      return 4500
    endif
  elseif ( No == 3 ) then
    if ( hp ) then
      if ( same ) then
        return 6500
      else
        return 8500
      endif
    else
      if ( same ) then
        return 5000
      else
        return 6000
      endif
    endif
  elseif ( No == 4 ) then
    if ( hp ) then
      return 6500
    else
      if ( same ) then
        return 9500
      else
        return 11000
      endif
    endif
  elseif ( No == 5 ) then
    if ( hp ) then
      return 6500
    else
      if ( same ) then
        return 10500
      else
        return 12000
      endif
    endif
  elseif ( No == 6 ) then
    if ( hp ) then
      if ( same ) then
        return 7000
      else
        return 9000
      endif
    else
      if ( same ) then
        return 8000
      else
        return 9000
      endif
    endif
  else
    return 111111
  endif
endfunction
constant function JOBHPMP2 takes integer No, boolean hp returns integer
  if ( No == 2 ) then
    if ( hp ) then
      return 23000
    else
      return 7000
    endif
  elseif ( No == 3 ) then
    if ( hp ) then
      return 17500
    else
      return 9000
    endif
  elseif ( No == 4 ) then
    if ( hp ) then
      return 11500
    else
      return 16000
    endif
  elseif ( No == 5 ) then
    if ( hp ) then
      return 11500
    else
      return 17000
    endif
  elseif ( No == 6 ) then
    if ( hp ) then
      return 17000
    else
      return 12500
    endif
  else
    return 111111
  endif
endfunction

function ChangeJob takes integer P, integer NoNow, integer NoTo returns boolean
  if ( NoNow == NoTo ) then
    if ( NoNow == 6 ) then
      call MSG(Player(P-1), 6, 6, JOBNAME(NoTo)+"|r : |c00ffff00환골탈태 의식을 치루기 위해 왔나요?")
    else
      call MSG(Player(P-1), 6, 6, JOBNAME(NoTo)+"|r : |c00ffff00순수전직 의식을 치루기 위해 왔나요?")
    endif
  elseif ( NoNow != 6 ) then
    call MSG(Player(P-1), 6, 6, JOBNAME(NoTo)+"|r : |c00ffff00새로운 전직 의식을 치루기 위해 오셨나요?")
  else
    if ( NoTo == 6 ) then
      call MSG(Player(P-1), 1, 4., "메투스의 길은 무도가만이 걸을 수 있습니다.")
    elseif ( NoNow == 6 ) then
      call MSG(Player(P-1), 1, 4., "무도가는 메투스의 길을 걸어야 합니다.")
    endif
    return false
  endif
  call TriggerSleepAction(2.)
  call MSG(Player(P-1), 6, 6, JOBNAME(NoTo)+"|r : |c00ffff00전직 의식을 치루기 위해 왔나요?")
  call TriggerSleepAction(2.)
  call MSG(Player(P-1), 6, 4, JOBNAME(NoTo)+"|r : |c00ffff00약간 까다로운 조건이 필요해요.")
  call TriggerSleepAction(2.)
  if ( NoNow != NoTo ) then
    call MSG(Player(P-1), 6, 4, JOBNAME(NoTo)+"|r : |c00ffff00"+JOBNAME2(NoNow)+"의 기술/마법을 모두 배운 상태여야 하며..")
  endif
  call TriggerSleepAction(2.)
  call MSG(Player(P-1), 6, 4, JOBNAME(NoTo)+"|r : |c00ffff00전직서를 소유하고 있거나..")  
  call TriggerSleepAction(2.)
  call MSG(Player(P-1), 6, 4, JOBNAME(NoTo)+"|r : |c00ffff00체력과 마력이 "+FSE_Rest(JOBHPMP(NoNow,true,NoTo==NoNow))+"/"+FSE_Rest(JOBHPMP(NoNow,false,NoTo==NoNow))+" 이상 되어야 하며..")
  call TriggerSleepAction(2.)
  call MSG(Player(P-1), 6, 4, JOBNAME(NoTo)+"|r : |c00ffff00경험치의 대가인 10포인트(나무)가 들며..")
  call TriggerSleepAction(2.)
  call MSG(Player(P-1), 6, 4, JOBNAME(NoTo)+"|r : |c00ffff00마지막으로 엑스쿠라눔을 20병 신전에 기부하셔야 합니다.")
  call TriggerSleepAction(5.)
  call MSG(Player(P-1), 6, 6, JOBNAME(NoTo)+"|r : |c00ffff00"+JOBNAME(NoTo)+"의 길을 새로 걷게 되면...")
  call TriggerSleepAction(2.)
  call MSG(Player(P-1), 6, 4, JOBNAME(NoTo)+"|r : |c00ffff00모든 골드와 포인트(나무)가 사라지며,")
  call TriggerSleepAction(2.)
  if ( NoNow == NoTo ) then
    call MSG(Player(P-1), 6, 4, JOBNAME(NoTo)+"|r : |c00ffff00남은 스킬들은 숙련도가 10이 됩니다.")
    call TriggerSleepAction(2.)
  endif
  call MSG(Player(P-1), 6, 4, JOBNAME(NoTo)+"|r : |c00ffff00체력과 마력이 레벨 1과 같은 상태가 되며,")
  call TriggerSleepAction(2.)
  call MSG(Player(P-1), 6, 4, JOBNAME(NoTo)+"|r : |c00ffff00모든 아이템은 바닥에 떨어집니다.")
  call TriggerSleepAction(5.)
  call MSG(Player(P-1), 6, 6, JOBNAME(NoTo)+"|r : |c00ffff00정말, 의식을 치루시겠습니까?")
  call TriggerSleepAction(1.)
  
  if ( NoNow == NoTo ) then
    set udg_temp_b = CountItem(P, ChangeJobBook(1)) > 0
  else
    set udg_temp_b = CountItem(P, ChangeJobBook(NoTo)) > 0
  endif
  if ( GetHPMP(P,true) < JOBHPMP(NoNow,true,NoTo==NoNow) ) or ( udg_temp_b ) then
    call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r1 - 체력치가 순수값으로 |cffff3315"+FSE_Rest(JOBHPMP(NoNow,true,NoTo==NoNow)) + BaseStr(11) + "(|cffff3315" + I2S(GetHPMP(P,true)-JOBHPMP(NoNow,true,NoTo==NoNow)) + BaseStr(11) + ") 되셔야 합니다.")
  elseif ( GetHPMP(P,false) < JOBHPMP(NoNow,false,NoTo==NoNow) ) or ( udg_temp_b ) then
    call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r2 - 마력치가 순수값으로 |cff218def"+FSE_Rest(JOBHPMP(NoNow,false,NoTo==NoNow)) + BaseStr(11) + "(|cffff3315" + I2S(GetHPMP(P,false)-JOBHPMP(NoNow,false,NoTo==NoNow)) + BaseStr(11) + ") 되셔야 합니다.")
  elseif ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) < 10 ) or ( udg_temp_b ) then
    call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r3 - 포인트가 부족합니다.")
  elseif ( CountItem(P, 'I084') < 20 ) or ( udg_temp_b ) then
    call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r4 - 엑스쿠라눔이 부족합니다.")
  elseif ( SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),0,1) != "1" ) then
    call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r5 - 기본 직업군이 아닙니다.")
  else
    if ( NoNow != NoTo ) then
      if ( NoNow == 2 ) then
        if ( GetUnitAbilityLevel(udg_Unit[P], 'A03D') == 0 ) then
          call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r6 - 직업 스킬이 미숙합니다 (크래셔)")
          return false
        endif
      elseif ( NoNow == 3 ) then
        if ( GetUnitAbilityLevel(udg_Unit[P], 'A04T') == 0 ) or ( GetUnitAbilityLevel(udg_Unit[P], 'A04J') == 0 ) then
          call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r6 - 직업 스킬이 미숙합니다 (센서스, 암살격)")
          return false
        endif
      elseif ( NoNow == 4 ) then
        if ( GetUnitAbilityLevel(udg_Unit[P], 'A07R') == 0 ) or ( GetUnitAbilityLevel(udg_Unit[P], 'A01P') == 0 ) then
          call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r6 - 직업 스킬이 미숙합니다 (데스, 라그나로크)")
          return false
        endif
      elseif ( NoNow == 5 ) then
        if ( GetUnitAbilityLevel(udg_Unit[P], 'A08W') == 0 ) then
          call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r6 - 직업 스킬이 미숙합니다 (코마디아)")
          return false
        endif
      endif
    endif
    call TriggerSleepAction(1.)
    call MSG(Player(P-1), 2, 8, "|c00fd8505어떻게 하시겠습니까?\n\n|c00d962b51. |c00f2f200아니오. 생각을 좀 더 해 보겠습니다.\n\n|c00d962b5"+I2S(NoTo)+". |c00f2f200예. "+JOBNAME2(NoTo)+" 의식을 치뤄 주세요.\n|r(채팅창에 1번이나 "+I2S(NoTo)+"번을 입력하세요. 제한시간 10초.)")
    call SaveBoolean(udg_hash, getIndex(P,36,100), 31, true)
    set udg_Quest_00_NumberAt[P] = 36
    call TriggerSleepAction(10.)
    if ( LoadBoolean(udg_hash, getIndex(P,36,100), 31) ) and ( udg_Quest_Boolean_B[P] == false ) then
      call SaveBoolean(udg_hash, getIndex(P,36,100), 31, false)
      call MSG(Player(P-1), 1, 4, "시간이 모두 지났습니다.")
    else
      set udg_Quest_Boolean_B[P] = false
    endif
  endif
  return false
endfunction

constant function InheritJob takes integer oldut returns integer
  if ( oldut == 'H002' ) then
    return 'H00U'
  elseif ( oldut == 'H003' ) then
    return 'H00V'
  elseif ( oldut == 'H004' ) then
    return 'H00W'
  elseif ( oldut == 'H005' ) then
    return 'H00T'
  elseif ( oldut == 'H006' ) then
    return 'H00X'
  elseif ( oldut == 'H010' ) then
    return 'H00U'
  elseif ( oldut == 'H011' ) then
    return 'H00V'
  elseif ( oldut == 'H012' ) then
    return 'H00W'
  elseif ( oldut == 'H013' ) then
    return 'H00T'
  elseif ( oldut == 'H00Y' ) then
    return 'H00X'
    
  elseif ( oldut == 'H014' ) then
    return 'H01N'
  elseif ( oldut == 'H015' ) then
    return 'H01O'
  elseif ( oldut == 'H016' ) then
    return 'H01P'
  elseif ( oldut == 'H01E' ) then
    return 'H01Q'
  elseif ( oldut == 'H01F' ) then
    return 'H01R'
  elseif ( oldut == 'H01G' ) then
    return 'H01S'
  elseif ( oldut == 'H01H' ) then
    return 'H01T'
  elseif ( oldut == 'H01I' ) then
    return 'H01U'
  elseif ( oldut == 'H01J' ) then
    return 'H01V'
  elseif ( oldut == 'H01K' ) then
    return 'H01W'
  elseif ( oldut == 'H01L' ) then
    return 'H01X'
  elseif ( oldut == 'H01M' ) then
    return 'H01Y'
  endif
  return 0
endfunction
function ChangeJob2 takes integer P, integer MyNo, integer NPCNo returns boolean
  if ( MyNo != NPCNo ) then
    call MSG(Player(P-1), 1, 4., JOBNAME(NPCNo)+"의 길은 "+JOBNAME2(NPCNo)+"만이 걸을 수 있습니다." + JOBNAME(MyNo)+"는 "+JOBNAME2(MyNo)+"의 길을 걸어야 합니다.")
    return false
  endif
  call TriggerSleepAction(2.)
  call MSG(Player(P-1), 6, 6, JOBNAME(NPCNo)+"|r : |c00ffff00승급 의식을 치루기 위해 왔나요?")
  call TriggerSleepAction(2.)
  call MSG(Player(P-1), 6, 4, JOBNAME(NPCNo)+"|r : |c00ffff00약간 까다로운 조건이 필요해요.")
  call TriggerSleepAction(2.)
  call MSG(Player(P-1), 6, 4, JOBNAME(NPCNo)+"|r : |c00ffff00체력과 마력이 "+FSE_Rest(JOBHPMP2(MyNo,true))+"/"+FSE_Rest(JOBHPMP2(MyNo,false))+" 이상 되어야 하며..")
  call TriggerSleepAction(2.)
  call MSG(Player(P-1), 6, 4, JOBNAME(NPCNo)+"|r : |c00ffff00경험치의 대가인 100포인트(나무)가 들며..")
  call TriggerSleepAction(2.)
  call MSG(Player(P-1), 6, 4, JOBNAME(NPCNo)+"|r : |c00ffff00마지막으로 엑스쿠라눔을 200병과 승급재료 100개를 신전에 기부하셔야 합니다.")
  call TriggerSleepAction(5.)
  call MSG(Player(P-1), 6, 6, JOBNAME(NPCNo)+"|r : |c00ffff00"+JOBNAME(NPCNo)+"의 길을 한걸음 더 걷게 되면...")
  call TriggerSleepAction(2.)
  call MSG(Player(P-1), 6, 6, JOBNAME(NPCNo)+"|r : |c00ffff00전직을 하였을 경우, 해당 스킬은 계속 갖고 있으며..")
  call TriggerSleepAction(2.)
  call MSG(Player(P-1), 6, 6, JOBNAME(NPCNo)+"|r : |c00ffff00체력과 마력 또한 계승됩니다.")
  call TriggerSleepAction(2.)
  call MSG(Player(P-1), 6, 6, JOBNAME(NPCNo)+"|r : |c00ffff00정말, 의식을 치루시겠습니까?")
  call TriggerSleepAction(1.)
  if ( GetHPMP(P,true) < JOBHPMP2(MyNo,true) ) then
    call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r1 - 체력치가 순수값으로 |cffff3315"+FSE_Rest(JOBHPMP2(MyNo,true)) + BaseStr(11) + "(|cffff3315" + I2S(GetHPMP(P,true)-JOBHPMP2(MyNo,true)) + BaseStr(11) + ") 되셔야 합니다.")
  elseif ( GetHPMP(P,false) < JOBHPMP2(MyNo,false) ) then
    call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r2 - 마력치가 순수값으로 |cff218def"+FSE_Rest(JOBHPMP2(MyNo,false)) + BaseStr(11) + "(|cffff3315" + I2S(GetHPMP(P,false)-JOBHPMP2(MyNo,false)) + BaseStr(11) + ") 되셔야 합니다.")
  elseif ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) < 100 ) then
    call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r3 - 포인트가 부족합니다.")
  elseif ( CountItem(P, 'I084') < 200 ) then
    call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r4 - 엑스쿠라눔이 부족합니다.")
  elseif ( InheritJob(GetUnitTypeId(udg_Unit[P])) == 0 ) then
    call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r5 - 이미 승급했거나, 가능한 직업군이 아닙니다.")
  elseif ( CountItem(P,'I09T') < 100 ) then
    call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r6 - 승급재료가 부족합니다.")
  else
    call TriggerSleepAction(1.)
    call MSG(Player(P-1), 2, 8, "|c00fd8505어떻게 하시겠습니까?\n\n|c00d962b51. |c00f2f200아니오. 생각을 좀 더 해 보겠습니다.\n\n|c00d962b5"+I2S(NPCNo)+". |c00f2f200예. "+JOBNAME2(NPCNo)+" 의식을 치뤄 주세요.\n|r(채팅창에 1번이나 "+I2S(NPCNo)+"번을 입력하세요. 제한시간 10초.)")
    call SaveBoolean(udg_hash, getIndex(P,40,100), 31, true)
    set udg_Quest_00_NumberAt[P] = 40
    call TriggerSleepAction(10.)
    if ( LoadBoolean(udg_hash, getIndex(P,40,100), 31) ) and ( udg_Quest_Boolean_B[P] == false ) then
      call SaveBoolean(udg_hash, getIndex(P,40,100), 31, false)
      call MSG(Player(P-1), 1, 4, "시간이 모두 지났습니다.")
    else
      set udg_Quest_Boolean_B[P] = false
    endif
  endif
  return false
endfunction
function Trig_Sys_ChangJob_1B_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetTriggerPlayer())+1
  if ( GetClickedButton() == udg_SysM_Button[P] ) then
    if ( not ChangeJob(P, SysInt(3, GetUnitTypeId(udg_Unit[P])), LoadInteger(udg_hash, GetHandleId(GetClickedButton()), StringHash("temp") )) ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ThornsAura\\ThornsAuraDamage.mdl", udg_Unit[P], "head"))
    endif
    call FlushChildHashtable(udg_hash, GetHandleId(GetClickedButton()))
    
    call TriggerSleepAction(.4)
    call MSG(Player(P-1), 1, 8, "밀레스 신전의 전직장소에 들어왔습니다.\n\n  마을 귀환은 단축키 O - R을 이용해주세요.")
  elseif ( GetClickedButton() == udg_SysM_Button3[P] ) then
    if ( not ChangeJob2(P, SysInt(4, GetUnitTypeId(udg_Unit[P])), LoadInteger(udg_hash, GetHandleId(GetClickedButton()), StringHash("temp") )) ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ThornsAura\\ThornsAuraDamage.mdl", udg_Unit[P], "head"))
    endif
    call FlushChildHashtable(udg_hash, GetHandleId(GetClickedButton()))
    
    call TriggerSleepAction(.4)
    call MSG(Player(P-1), 1, 8, "밀레스 신전의 승급장소에 들어왔습니다.\n\n  마을 귀환은 단축키 O - R을 이용해주세요.")
  endif
  call DialogDestroy(GetClickedDialog())
endfunction

//===========================================================================
function InitTrig_Sys_ChangJob_B_ALL takes nothing returns nothing
  set gg_trg_Sys_ChangJob_B_ALL = CreateTrigger(  )
  call TriggerAddAction( gg_trg_Sys_ChangJob_B_ALL, function Trig_Sys_ChangJob_1B_Actions )
endfunction

//===========================================================================
// Trigger: Dialog Miles Temple
//===========================================================================
function Trig_Dialog_Miles_Temple_Conditions takes nothing returns boolean
    if ( not                                        ( isHero(GetTriggerUnit()) ) ) then
        return false
    endif
    return true
endfunction

function Trig_Dialog_Miles_Temple_Actions takes nothing returns nothing
    call IssueImmediateOrderBJ( GetTriggerUnit(), "stop" )
    call PauseUnitBJ( true, GetTriggerUnit() )
    call TriggerSleepAction( 0.20 )
    call MSG(GetOwningPlayer(GetTriggerUnit()), 6, 4., "선진|r : |c00ffff00어떻게 오셨나요?")
    call TriggerSleepAction( 0.50 )
    call DialogDestroy(udg_temp_d)
    set udg_temp_d = DialogCreate()
    call DialogSetMessageBJ( udg_temp_d, "TRIGSTR_8671" )
    set udg_SysM_Button2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] =           (DialogAddButton(udg_temp_d, "<   신   전   > |cffffffff(엑쿠 8병)", 259))
    call DialogAddButton( udg_temp_d, "취소 (C)", 67 )
    call DialogClose(GetOwningPlayer(GetTriggerUnit()), udg_temp_d, 5.)
    call TriggerRegisterDialogEventBJ( gg_trg_Dialog_Miles_Temple_2, udg_temp_d )
    call TriggerSleepAction( 0.20 )
    call PauseUnitBJ( false, GetTriggerUnit() )
endfunction

//===========================================================================
function InitTrig_Dialog_Miles_Temple takes nothing returns nothing
    set gg_trg_Dialog_Miles_Temple = CreateTrigger(  )
    call TriggerRegisterEnterRectSimple( gg_trg_Dialog_Miles_Temple, gg_rct_Effect_07 )
    call TriggerAddCondition( gg_trg_Dialog_Miles_Temple, Condition( function Trig_Dialog_Miles_Temple_Conditions ) )
    call TriggerAddAction( gg_trg_Dialog_Miles_Temple, function Trig_Dialog_Miles_Temple_Actions )
endfunction

//===========================================================================
// Trigger: Dialog Miles Temple 2
//
// 
//     call MSG(GetTriggerPlayer(), 1, 8, "밀레스 신전의 승급장소에 들어왔습니다.\n\n  관련 명령어: |cffed89d9은총|r, |cffed89d9승급|r, |cffed89d9환골탈태|r, |cffed89d9순수전직|r, |cffed89d9스텟 초기화|r")
// |c00ff8000신전 도우미|r : |c00ffff00신전의 기운에 압도되어 들어갈 수 없습니다. |r (|c00ffff00레벨제한 |c00d962b511|r)
//===========================================================================
function Trig_Dialog_Miles_Temple_2_Actions takes nothing returns nothing
  local integer P = GetPlayerId(GetTriggerPlayer())+1
  local unit u = udg_Unit[P]
  call PauseUnit(u, true)
  if ( GetClickedButton() == udg_SysM_Button2[P] ) then
    if ( GetHeroLevel(u) >= 99 ) then
     if ( udg_SysE_STR1[P] + udg_SysE_DEX1[P] + udg_SysE_INT1[P] + udg_SysE_WIS1[P] + udg_SysE_CON1[P] >= 211 ) then
      call TriggerSleepAction(.4)
      call MSG(Player(P-1), 6, 4., "선진|r : |c00ffff00승급장소로 보내드리겠습니다. 엑스쿠라눔을 8병 기부하셔야 합니다.")
      call TriggerSleepAction(.4)
      if ( MinusItem(P, 'I084', 8) ) then
        call MSG(Player(P-1), 1, 3, "엑스쿠라눔 8병을 신전에 기부하였습니다.")
        call SetUnitPosition(u, 25728, -23424)
        call ClearTextMessagesBJ(GetForceOfPlayer(Player(P-1)) )
        call SetCameraBoundsToRectForPlayerBJ(Player(P-1), null )
        call MSG(Player(P-1), 5, 5, "밀레스 신전 - 승급장소")
        call SetHoldCam(GetOwningPlayer(u), gg_rct_Etc_Rect_03)
        call SetCameraXY(Player(P-1), GetWidgetX(u), GetWidgetY(u))
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", u, "origin") )
        call MSG(Player(P-1), 1, 8, "밀레스 신전의 승급장소에 들어왔습니다.\n\n  관련 명령어(제단 앞에서): |cffed89d9체력|r, |cffed89d9마력|r, |cffed89d9전직|r, |cffed89d9환골탈태|r, |cffed89d9승급|r, |cffed89d9스텟|r\n    |cffffdc3c※참고) |cffed89d9체력 all |cffffdc3c혹은 |cffed89d9힘 all |cffffdc3c등을 치면 모든 포인트를 반복해서 소모합니다.")
        call TriggerSleepAction(.4)
      else
        call MSG(Player(P-1), 1, 4, "엑스쿠라눔이 8병 이상 필요합니다.")
      endif
     else
       call MSG(Player(P-1), 1, 6, "능력치를 모두 분배한 후 이동하실 수 있습니다. 아직 분배하지 않은 능력치가 남아 있습니다.")
     endif
    else
      call TriggerSleepAction(.2)
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ThornsAura\\ThornsAuraDamage.mdl", u, "head") )
      call MSG(Player(P-1), 6, 4., "선진|r : |c00ffff00그곳은 아무나 갈 수 있는곳이 아니에요.|r (|c00ffff00레벨제한 |c00d962b599|r)")
      call TriggerSleepAction(.4)
    endif
  else
    call TriggerSleepAction(.2)
    call SetCameraXY(Player(P-1), GetWidgetX(u), GetWidgetY(u))
  endif
  call PauseUnit(u, false)
  set u = null
endfunction

//===========================================================================
function InitTrig_Dialog_Miles_Temple_2 takes nothing returns nothing
    set gg_trg_Dialog_Miles_Temple_2 = CreateTrigger( )
    call TriggerAddAction(gg_trg_Dialog_Miles_Temple_2, function Trig_Dialog_Miles_Temple_2_Actions )
endfunction

//===========================================================================
// Trigger: Buy Skills All
//
// |cffc3dbff 회색
// |c0087F264 연두 연함
// |cffffdc3c 연노
// |cffff0000 빨강
// |c0000ff00 초록
// |c00ffff00 노랑
// |cffc3dbff 그리고 선풍각의 숙련도가 90, 소수신공의 숙련도가 60 이상 되어야 합니다. |r
//===========================================================================
constant function SK2I takes string s returns integer
  if ( s == "D" ) then
    return 1
  elseif ( s == "F" ) then
    return 2
  elseif ( s == "Q" ) then
    return 3
  elseif ( s == "W" ) then
    return 4
  elseif ( s == "E" ) then
    return 5
  elseif ( s == "R" ) then
    return 6
  elseif ( s == "T" ) then
    return 7
  else
    return 0
  endif
endfunction
constant function SK2G takes integer c returns integer
  if ( c == 1 ) then
    return 100
  elseif ( c == 2 ) then
    return 500
  elseif ( c == 3 ) then
    return 2500
  elseif ( c == 4 ) then
    return 10000
  elseif ( c == 5 ) then
    return 25000
  elseif ( c == 6 ) then
    return 300000
  else
    return 1000001
  endif
endfunction
function Trig_Buy_Skills_All_Conditions takes nothing returns boolean
  return GetWidgetLife(GetManipulatedItem()) == 102. and GetItemLevel(GetManipulatedItem()) == 1 and IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO)
endfunction

function PreSkillCheck takes unit u, integer SkId, integer SkLv returns boolean
  if ( GetUnitAbilityLevel(u, SkId) < SkLv ) then
    set udg_temp_s = "\n  |cffffdc3c"+GetObjectName(SkId)+"의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(u, SkId)*10) + "|cffffdc3c/"+I2S(SkLv*10)+" 이상 되어야 합니다."
    return true
  else
    return false
  endif
endfunction
function Trig_Buy_Skills_All_Actions takes nothing returns nothing
  local string s = GetItemName(GetManipulatedItem())
  local integer i = S2I(SubString(s, 0, 3))
  local integer c = 0
  local integer check = 0
  local string msg = "|c0087F264" + SubString(s, 4, StringLength(s)) + "|cffffdc3c을(를) 배우기에..."
  set s = LoadStr(udg_hash, i, 60)
  // 0. 기본 비교
  if ( i != 0 ) and ( StringLength(s) >= 20 ) then
    // 1. 직업 비교
    set c = S2I(SubString(s, 0, 1))
    if ( c >= 1 ) then
      if ( c != S2I(SubString(SysStr(1,GetUnitTypeId(GetTriggerUnit())),1,2)) ) then
        set check = check + 1
        set msg = msg + "\n  |cffffdc3c직업이 "
        if ( c == 2 ) then
          set msg = msg + "전사가 "
        elseif ( c == 3 ) then
          set msg = msg + "도적이 "
        elseif ( c == 4 ) then
          set msg = msg + "마법사가 "
        elseif ( c == 5 ) then
          set msg = msg + "성직자가 "
        elseif ( c == 6 ) then
          set msg = msg + "무도가가 "
        endif
        set msg = msg + "아닙니다."
      endif
    endif
    // 2. 레벨 비교
    set c = S2I(SubString(s, 1, 2))
    if ( c == 1 ) then
      set i = 1
    elseif ( c == 2 ) then
      set i = 11
    elseif ( c == 3 ) then
      set i = 41
    elseif ( c == 4 ) then
      set i = 71
    elseif ( c == 5 ) then
      set i = 99
    elseif ( c == 6 ) then
      set i = 100
    else
      set i = 110
    endif
    
    if ( c == 6 ) then
      if ( S2I(SubString(SysStr(1,GetUnitTypeId(GetTriggerUnit())),0,1)) < 3 ) then
        set check = check + 1
        set msg = msg + "\n  |cffffdc3c승급을 하여야합니다."
      endif
    elseif ( GetHeroLevel(GetTriggerUnit()) < i ) then
      set check = check + 1
      set msg = msg + "\n  |cffffdc3c레벨이 " + I2S(i) + " 이상 되어야 합니다. ( |cffff0000" + I2S(i-GetHeroLevel(GetTriggerUnit())) + " |cffffdc3c부족 )"
    endif
    // 3. 골드 비교
    if ( SubString(s, 19, 20) == "2" ) then
      set i = 900000
    else
      set i = SK2G(S2I(SubString(s, 1, 2)))
    endif
    if ( GetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD) < i ) then
      set check = check + 1
      set msg = msg + "\n  |cffffdc3c골드가 |c00ffff00" + I2S(i) + "G |cffffdc3c이상 필요합니다. ( |c00ffff00" + I2S(GetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD)-i) + "G |cffffdc3c )"
    endif
    
    // 5. 중복 비교
    set i = GetUnitAbilityLevel(GetTriggerUnit(), udg_FSE_Skill[S2I(SubString(GetItemName(GetManipulatedItem()), 0, 3))])
    if ( i >= 1 ) then
      set check = check + 1
      set msg = msg + "\n  |cffffdc3c이미 배운 스킬입니다."
    endif
    // 6. 스탯 비교
    set i = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
    if ( udg_SysE_STR3[i] < S2I(SubString(s, 2, 5)) ) or ( udg_SysE_DEX3[i] < S2I(SubString(s, 5, 8)) ) or ( udg_SysE_INT3[i] < S2I(SubString(s, 8, 11)) ) then
      set c = 0
    elseif ( udg_SysE_WIS3[i] < S2I(SubString(s, 11, 14)) ) or ( udg_SysE_CON3[i] < S2I(SubString(s, 14, 17)) ) then
      set c = 0
    else
      set c = 1
    endif
    if ( c == 0 ) then
      set check = check + 1
      set msg = msg + "\n  |cffffdc3c능력치가 부족합니다. [ "
      // 6-1. 힘
      set c = S2I(SubString(s, 2, 5))
      if ( udg_SysE_STR3[i] < c ) then
        set msg = msg + "|cffff0000" + I2S(c)
      else
        set msg = msg + "|c0000ff00" + I2S(c)
      endif
      set msg = msg + "|r / "
      // 6-2. 덱
      set c = S2I(SubString(s, 5, 8))
      if ( udg_SysE_DEX3[i] < c ) then
        set msg = msg + "|cffff0000" + I2S(c)
      else
        set msg = msg + "|c0000ff00" + I2S(c)
      endif
      set msg = msg + "|r / "
      // 6-3. 인
      set c = S2I(SubString(s, 8, 11))
      if ( udg_SysE_INT3[i] < c ) then
        set msg = msg + "|cffff0000" + I2S(c)
      else
        set msg = msg + "|c0000ff00" + I2S(c)
      endif
      set msg = msg + "|r / "
      // 6-4. 위
      set c = S2I(SubString(s, 11, 14))
      if ( udg_SysE_WIS3[i] < c ) then
        set msg = msg + "|cffff0000" + I2S(c)
      else
        set msg = msg + "|c0000ff00" + I2S(c)
      endif
      set msg = msg + "|r / "
      // 6-5. 콘
      set c = S2I(SubString(s, 14, 17))
      if ( udg_SysE_CON3[i] < c ) then
        set msg = msg + "|cffff0000" + I2S(c)
      else
        set msg = msg + "|c0000ff00" + I2S(c)
      endif
      set msg = msg + "|cffffdc3c ]"
    endif
    // 7. 선행스킬 비교
    set c = S2I(SubString(s, 18, 19))
    if ( c >= 1 ) then
      set i = GetItemTypeId(GetManipulatedItem())
      //       //전사
      if ( i == 'gvsm' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02F') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c숏블레이드의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02F')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'nspi' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A01H') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c더블어택의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A01H')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'shen' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A00A') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c윈드블레이드의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A00A')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'envl' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A007') < 10 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c레스큐의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A007')*10) + "|cffffdc3c/100 이상 되어야 합니다."
        endif
      elseif ( i == 'sbok' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02L') < 8 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c트리플어택의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02L')*10) + "|cffffdc3c/75 이상 되어야 합니다."
        endif
      elseif ( i == 'ccmd' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02P') < 8 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c메가블레이드의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02P')*10) + "|cffffdc3c/75 이상 되어야 합니다."
        endif
      elseif ( i == 'tmmt' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02P') < 9 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02L') < 9 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A04O') < 6 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02P') < 9 ) then
            set msg = msg + "\n  |cffffdc3c메가블레이드의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02P')*10) + "|cffffdc3c/90 이상, "
          else
            set msg = msg + "\n  |cffffdc3c메가블레이드의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02P')*10) + "|cffffdc3c/90 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02L') < 9 ) then
            set msg = msg + "트리플어택의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02L')*10) + "|cffffdc3c/90 이상, "
          else
            set msg = msg + "트리플어택의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02L')*10) + "|cffffdc3c/90 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A04O') < 6 ) then
            set msg = msg + "투핸드어택의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A04O')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          else
            set msg = msg + "투핸드어택의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A04O')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'ledg' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A04P') < 10 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A03R') < 9 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A04P') < 10 ) then
            set msg = msg + "\n  |cffffdc3c드래곤모드의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A04P')*10) + "|cffffdc3c/100 이상, "
          else
            set msg = msg + "\n  |cffffdc3c드래곤모드의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A04P')*10) + "|cffffdc3c/100 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A03R') < 9 ) then
            set msg = msg + "적무기쳐내기의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A03R')*10) + "|cffffdc3c/90 이상 되어야 합니다."
          else
            set msg = msg + "적무기쳐내기의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A03R')*10) + "|cffffdc3c/90 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'sman' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A06E') < 10 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02P') < 10 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A06E') < 10 ) then
            set msg = msg + "\n  |cffffdc3c완전방어의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A06E')*10) + "|cffffdc3c/100 이상, "
          else
            set msg = msg + "\n  |cffffdc3c완전방어의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A06E')*10) + "|cffffdc3c/100 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02P') < 10 ) then
            set msg = msg + "메가블레이드의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02P')*10) + "|cffffdc3c/100 이상 되어야 합니다."
          else
            set msg = msg + "메가블레이드의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02P')*10) + "|cffffdc3c/100 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'rhe3' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A03D') < 10 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c크래셔의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A03D')*10) + "|cffffdc3c/100 이상 되어야 합니다."
        endif
      
      elseif ( i == 'tint' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02L') < 10 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c트리플어택의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02L')*10) + "|cffffdc3c/100 이상 되어야 합니다."
        endif
      elseif ( i == 'tdx2' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A01W') < 3 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c메가어택의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A01W')*10) + "|cffffdc3c/30 이상 되어야 합니다."
        endif
      elseif ( i == 'olig' ) then
        if ( PreSkillCheck(GetTriggerUnit(), 'A02N', 10) ) then
          set check = check + 1
          set msg = msg + udg_temp_s
        endif
      elseif ( i == 'silk' ) then
        if ( PreSkillCheck(GetTriggerUnit(), 'A00A', 10) ) then
          set check = check + 1
          set msg = msg + udg_temp_s
        endif
      elseif ( i == 'kymn' ) then
        if ( PreSkillCheck(GetTriggerUnit(), 'A02P', 10) ) then
          set check = check + 1
          set msg = msg + udg_temp_s
        endif
      elseif ( i == 'rhe3' ) then
        if ( PreSkillCheck(GetTriggerUnit(), 'A03D', 10) ) then
          set check = check + 1
          set msg = msg + udg_temp_s
        endif
      elseif ( i == 'tkno' ) then
        if ( PreSkillCheck(GetTriggerUnit(), 'A0A1', 10) ) then
          set check = check + 1
          set msg = msg + udg_temp_s
        endif
      elseif ( i == 'rdis' ) then
        if ( PreSkillCheck(GetTriggerUnit(), 'A0A4', 10) ) then
          set check = check + 1
          set msg = msg + udg_temp_s
        endif
      elseif ( i == 'pman' ) then
        if ( PreSkillCheck(GetTriggerUnit(), 'A06L', 8) ) then
          set check = check + 1
          set msg = msg + udg_temp_s
        endif
        
        //       //도적
      elseif ( i == 'shhn' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A01J') < 1 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c표창날리기의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A01J')*10) + "|cffffdc3c/10 이상 되어야 합니다."
        endif
      elseif ( i == 'lure' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A01J') < 5 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c표창날리기의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A01J')*10) + "|cffffdc3c/50 이상 되어야 합니다."
        endif
      elseif ( i == 'vddl' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A049') < 5 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c라이트닝무브의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A049')*10) + "|cffffdc3c/50 이상 되어야 합니다."
        endif
      elseif ( i == 'ofir' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A01I') < 8 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A009') < 6 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A01I') < 8 ) then
            set msg = msg + "\n  |cffffdc3c더블어택의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A01I')*10) + "|cffffdc3c/75 이상, "
          else
            set msg = msg + "\n  |cffffdc3c더블어택의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A01I')*10) + "|cffffdc3c/75 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A009') < 6 ) then
            set msg = msg + "찔러휘비기의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A009')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          else
            set msg = msg + "찔러휘비기의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A009')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'bfhr' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A009') < 8 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A00F') < 3 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A009') < 8 ) then
            set msg = msg + "\n  |cffffdc3c찔러휘비기의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A009')*10) + "|cffffdc3c/75 이상, "
          else
            set msg = msg + "\n  |cffffdc3c찔러휘비기의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A009')*10) + "|cffffdc3c/75 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A00F') < 3 ) then
            set msg = msg + "두번찌르기의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A00F')*10) + "|cffffdc3c/30 이상 되어야 합니다."
          else
            set msg = msg + "두번찌르기의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A00F')*10) + "|cffffdc3c/30 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'blba' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A04L') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c하이드의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A04L')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'shcw' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A03O') < 9 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c습격의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A03O')*10) + "|cffffdc3c/90 이상 되어야 합니다."
        endif
        
      elseif ( i == 'gfor' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A03O') < 10 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c습격의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A03O')*10) + "|cffffdc3c/100 이상 되어야 합니다."
        endif
      elseif ( i == 'rres' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A04T') < 10 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c센서스의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A04T')*10) + "|cffffdc3c/100 이상 되어야 합니다."
        endif
        //       //법사
      elseif ( i == 'kgal' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A008') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c마레노의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A008')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'btst' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A020') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c테라미코의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A020')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'tbsm' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A021') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c아듀로의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A021')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'tfar' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A022') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c플라모의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A022')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'tbar' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A01O') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c렌토의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A01O')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'tbak' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A008') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c마레노의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A008')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'gldo' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A020') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c테라미코의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A020')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'gemt' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A021') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c아듀로의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A021')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'uflg' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A022') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c플라모의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A022')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'cosl' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A029') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c베노미의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A029')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'sfog' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A025') < 8 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02Q') < 5 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A025') < 8 ) then
            set msg = msg + "\n  |cffffdc3c수페라마레나의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A025')*10) + "|cffffdc3c/75 이상, "
          else
            set msg = msg + "\n  |cffffdc3c수페라마레나의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A025')*10) + "|cffffdc3c/75 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02Q') < 5 ) then
            set msg = msg + "마레누스의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02Q')*10) + "|cffffdc3c/45 이상 되어야 합니다."
          else
            set msg = msg + "마레누스의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02Q')*10) + "|cffffdc3c/45 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'ocor' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A026') < 8 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02W') < 5 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A026') < 8 ) then
            set msg = msg + "\n  |cffffdc3c수페라테라미카의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A026')*10) + "|cffffdc3c/75 이상, "
          else
            set msg = msg + "\n  |cffffdc3c수페라테라미카의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A026')*10) + "|cffffdc3c/75 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02W') < 5 ) then
            set msg = msg + "테라미쿠스의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02W')*10) + "|cffffdc3c/45 이상 되어야 합니다."
          else
            set msg = msg + "테라미쿠스의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02W')*10) + "|cffffdc3c/45 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'frhg' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A027') < 8 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02X') < 5 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A027') < 8 ) then
            set msg = msg + "\n  |cffffdc3c수페라아듀라의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A027')*10) + "|cffffdc3c/75 이상, "
          else
            set msg = msg + "\n  |cffffdc3c수페라아듀라의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A027')*10) + "|cffffdc3c/75 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02X') < 5 ) then
            set msg = msg + "아듀로스의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02X')*10) + "|cffffdc3c/45 이상 되어야 합니다."
          else
            set msg = msg + "아듀로스의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02X')*10) + "|cffffdc3c/45 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'spre' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A028') < 8 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02Y') < 5 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A028') < 8 ) then
            set msg = msg + "\n  |cffffdc3c수페라플라미카의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A028')*10) + "|cffffdc3c/75 이상, "
          else
            set msg = msg + "\n  |cffffdc3c수페라플라미카의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A028')*10) + "|cffffdc3c/75 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02Y') < 5 ) then
            set msg = msg + "플라무스의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02Y')*10) + "|cffffdc3c/45 이상 되어야 합니다."
          else
            set msg = msg + "플라무스의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02Y')*10) + "|cffffdc3c/45 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'oflg' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A01V') < 8 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c바르도의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A01V')*10) + "|cffffdc3c/75 이상 되어야 합니다."
        endif
      elseif ( i == 'rde0' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02Q') < 8 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c마레누스의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02Q')*10) + "|cffffdc3c/75 이상 되어야 합니다."
        endif
      elseif ( i == 'scul' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02W') < 8 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c테라미쿠스의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02W')*10) + "|cffffdc3c/75 이상 되어야 합니다."
        endif
      elseif ( i == 'fwss' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02X') < 8 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c아듀로스의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02X')*10) + "|cffffdc3c/75 이상 되어야 합니다."
        endif
      elseif ( i == 'jdrn' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02Y') < 8 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c플라무스의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02Y')*10) + "|cffffdc3c/75 이상 되어야 합니다."
        endif
      elseif ( i == 'rat3' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A029') < 8 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c베노미의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A029')*10) + "|cffffdc3c/80 이상 되어야 합니다."
        endif
      elseif ( i == 'gmfr' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A043') < 9 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A03J') < 6 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A043') < 9 ) then
            set msg = msg + "\n  |cffffdc3c엑스마레나의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A043')*10) + "|cffffdc3c/90 이상, "
          else
            set msg = msg + "\n  |cffffdc3c엑스마레나의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A043')*10) + "|cffffdc3c/90 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A03J') < 6 ) then
            set msg = msg + "마레네라의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A03J')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          else
            set msg = msg + "마레네라의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A03J')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'ches' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A044') < 9 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A03L') < 6 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A044') < 9 ) then
            set msg = msg + "\n  |cffffdc3c엑스테라미카의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A044')*10) + "|cffffdc3c/90 이상, "
          else
            set msg = msg + "\n  |cffffdc3c엑스테라미카의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A044')*10) + "|cffffdc3c/90 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A03L') < 6 ) then
            set msg = msg + "테라미에라의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A03L')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          else
            set msg = msg + "테라미에라의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A03L')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'kysn' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A045') < 9 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A03M') < 6 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A045') < 9 ) then
            set msg = msg + "\n  |cffffdc3c엑스아듀라의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A045')*10) + "|cffffdc3c/90 이상, "
          else
            set msg = msg + "\n  |cffffdc3c엑스아듀라의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A045')*10) + "|cffffdc3c/90 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A03M') < 6 ) then
            set msg = msg + "아듀레나의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A03M')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          else
            set msg = msg + "아듀레나의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A03M')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'ktrm' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A046') < 9 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A03N') < 6 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A046') < 9 ) then
            set msg = msg + "\n  |cffffdc3c엑스플라미카의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A046')*10) + "|cffffdc3c/90 이상, "
          else
            set msg = msg + "\n  |cffffdc3c엑스플라미카의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A046')*10) + "|cffffdc3c/90 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A03N') < 6 ) then
            set msg = msg + "플라메라의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A03N')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          else
            set msg = msg + "플라메라의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A03N')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'frgd' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A00J') < 9 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c데프레코의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A00J')*10) + "|cffffdc3c/90 이상 되어야 합니다."
        endif
      elseif ( i == 'spro' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A00Z') < 9 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A07O') < 6 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A00Z') < 9 ) then
            set msg = msg + "\n  |cffffdc3c프라보의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A00Z')*10) + "|cffffdc3c/90 이상, "
          else
            set msg = msg + "\n  |cffffdc3c프라보의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A00Z')*10) + "|cffffdc3c/90 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A07O') < 6 ) then
            set msg = msg + "소루마의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A07O')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          else
            set msg = msg + "소루마의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A07O')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'tgrh' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A076') < 3 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c세멜리아의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A076')*10) + "|cffffdc3c/30 이상 되어야 합니다."
        endif
      elseif ( i == 'stwp' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A076') < 6 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A077') < 3 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A076') < 6 ) then
            set msg = msg + "\n  |cffffdc3c세멜리아의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A076')*10) + "|cffffdc3c/60 이상, "
          else
            set msg = msg + "\n  |cffffdc3c세멜리아의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A076')*10) + "|cffffdc3c/60 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A077') < 3 ) then
            set msg = msg + "아마게돈의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A077')*10) + "|cffffdc3c/30 이상 되어야 합니다."
          else
            set msg = msg + "아마게돈의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A077')*10) + "|cffffdc3c/30 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'pclr' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A076') < 9 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A078') < 6 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A076') < 9 ) then
            set msg = msg + "\n  |cffffdc3c세멜리아의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A076')*10) + "|cffffdc3c/90 이상, "
          else
            set msg = msg + "\n  |cffffdc3c세멜리아의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A076')*10) + "|cffffdc3c/90 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A078') < 6 ) then
            set msg = msg + "숨마스텔라의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A078')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          else
            set msg = msg + "숨마스텔라의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A078')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'rspd' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A01P') < 10 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c라그나로크의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A01P')*10) + "|cffffdc3c/100 이상 되어야 합니다."
        endif
        //       //직자
      elseif ( i == 'sprn' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A00V') < 3 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c쿠로의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A00V')*10) + "|cffffdc3c/30 이상 되어야 합니다."
        endif
      elseif ( i == 'pspd' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A024') < 3 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c디렌토의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A024')*10) + "|cffffdc3c/30 이상 되어야 합니다."
        endif
      elseif ( i == 'oslo' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A01Y') < 3 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c쿠라노의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A01Y')*10) + "|cffffdc3c/30 이상 되어야 합니다."
        endif
      elseif ( i == 'srbd' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A01Y') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c쿠라노의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A01Y')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'horl' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02D') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c디바르도의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02D')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'thdm' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A01X') < 6 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A030') < 3 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A01X') < 6 ) then
            set msg = msg + "\n  |cffffdc3c쿠러스의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A01X')*10) + "|cffffdc3c/60 이상, "
          else
            set msg = msg + "\n  |cffffdc3c쿠러스의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A01X')*10) + "|cffffdc3c/60 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A030') < 3 ) then
            set msg = msg + "쿠라노소의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A030')*10) + "|cffffdc3c/30 이상 되어야 합니다."
          else
            set msg = msg + "쿠라노소의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A030')*10) + "|cffffdc3c/30 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'rots' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A030') < 5 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A031') < 1 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A030') < 5 ) then
            set msg = msg + "\n  |cffffdc3c쿠라노소의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A030')*10) + "|cffffdc3c/45 이상, "
          else
            set msg = msg + "\n  |cffffdc3c쿠라노소의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A030')*10) + "|cffffdc3c/45 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A031') < 1 ) then
            set msg = msg + "쿠라누스의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A031')*10) + "|cffffdc3c/5 이상 되어야 합니다."
          else
            set msg = msg + "쿠라누스의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A031')*10) + "|cffffdc3c/5 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'iwbr' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02Z') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c에나르마의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02Z')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'esaz' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A048') < 5 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c쿠랄툼의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A048')*10) + "|cffffdc3c/50 이상 되어야 합니다."
        endif
      elseif ( i == 'ram4' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A01N') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c벨라르모의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A01N')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'ram2' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A058') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c콜라마의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A058')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'pams' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A030') < 8 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c쿠라노소의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A030')*10) + "|cffffdc3c/75 이상 되어야 합니다."
        endif
      elseif ( i == 'ram1' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A04G') < 8 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c디데프레카의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A04G')*10) + "|cffffdc3c/75 이상 되어야 합니다."
        endif
      elseif ( i == 'arsh' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A05C') < 5 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A032') < 6 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A05C') < 5 ) then
            set msg = msg + "\n  |cffffdc3c로카메아의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A05C')*10) + "|cffffdc3c/50 이상, "
          else
            set msg = msg + "\n  |cffffdc3c로카메아의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A05C')*10) + "|cffffdc3c/50 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A032') < 6 ) then
            set msg = msg + "홀리볼트의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A032')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          else
            set msg = msg + "홀리볼트의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A032')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'axas' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A031') < 8 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A05D') < 6 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A031') < 8 ) then
            set msg = msg + "\n  |cffffdc3c쿠라누스의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A031')*10) + "|cffffdc3c/75 이상, "
          else
            set msg = msg + "\n  |cffffdc3c쿠라누스의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A031')*10) + "|cffffdc3c/75 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A05D') < 6 ) then
            set msg = msg + "수페라쿠라노의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A05D')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          else
            set msg = msg + "수페라쿠라노의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A05D')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'asbl' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A05F') < 5 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c리치마나의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A05F')*10) + "|cffffdc3c/50 이상 되어야 합니다."
        endif
      elseif ( i == 'brag' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A05M') < 5 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c호르라마의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A05M')*10) + "|cffffdc3c/50 이상 되어야 합니다."
        endif
      elseif ( i == 'hslv' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A05D') < 9 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c수페라쿠라노의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A05D')*10) + "|cffffdc3c/90 이상 되어야 합니다."
        endif
      elseif ( i == 'vamp' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A05H') < 9 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A074') < 8 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A05H') < 9 ) then
            set msg = msg + "\n  |cffffdc3c쿠라네라의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A05H')*10) + "|cffffdc3c/90 이상, "
          else
            set msg = msg + "\n  |cffffdc3c쿠라네라의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A05H')*10) + "|cffffdc3c/90 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A074') < 8 ) then
            set msg = msg + "엑스쿠라노의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A074')*10) + "|cffffdc3c/75 이상 되어야 합니다."
          else
            set msg = msg + "엑스쿠라노의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A074')*10) + "|cffffdc3c/75 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'sreg' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A05P') < 9 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c이모탈의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A05P')*10) + "|cffffdc3c/90 이상 되어야 합니다."
        endif
      elseif ( i == 'gomn' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A074') < 10 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c엑스쿠라노의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A074')*10) + "|cffffdc3c/100 이상 되어야 합니다."
        endif
      elseif ( i == 'rspl' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A032') < 10 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c홀리볼트의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A032')*10) + "|cffffdc3c/100 이상 되어야 합니다."
        endif
      elseif ( i == 'rhe1' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A04H') < 9 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A07E') < 9 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A04H') < 9 ) then
            set msg = msg + "\n  |cffffdc3c디프라바의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A04H')*10) + "|cffffdc3c/90 이상, "
          else
            set msg = msg + "\n  |cffffdc3c디프라바의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A04H')*10) + "|cffffdc3c/90 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A07E') < 9 ) then
            set msg = msg + "리플렉토의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A07E')*10) + "|cffffdc3c/90 이상 되어야 합니다."
          else
            set msg = msg + "리플렉토의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A07E')*10) + "|cffffdc3c/90 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'rre1' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A074') < 10 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A07T') < 10 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A074') < 10 ) then
            set msg = msg + "\n  |cffffdc3c엑스쿠라노의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A074')*10) + "|cffffdc3c/100 이상, "
          else
            set msg = msg + "\n  |cffffdc3c엑스쿠라노의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A074')*10) + "|cffffdc3c/100 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A07T') < 10 ) then
            set msg = msg + "리베라토의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A07T')*10) + "|cffffdc3c/100 이상 되어야 합니다."
          else
            set msg = msg + "리베라토의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A07T')*10) + "|cffffdc3c/100 이상 되어야 합니다."
          endif
        endif
        //       //도가
      elseif ( i == 'gsou' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A01K') < 5 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c통배권의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A01K')*10) + "|cffffdc3c/50 이상 되어야 합니다."
        endif
      elseif ( i == 'rej5' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A010') < 3 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c쿠로토의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A010')*10) + "|cffffdc3c/30 이상 되어야 합니다."
        endif
      elseif ( i == 'rej2' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A00X') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c단각의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A00X')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'sor1' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A00X') < 8 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A07X') < 5 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A00X') < 8 ) then
            set msg = msg + "\n  |cffffdc3c단각의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A00X')*10) + "|cffffdc3c/75 이상, "
          else
            set msg = msg + "\n  |cffffdc3c단각의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A00X')*10) + "|cffffdc3c/75 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A07X') < 5 ) then
            set msg = msg + "양의신권의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A07X')*10) + "|cffffdc3c/45 이상 되어야 합니다."
          else
            set msg = msg + "양의신권의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A07X')*10) + "|cffffdc3c/45 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'sora' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A03F') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c미증보법의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A03F')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'sor2' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A03H') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c경신공의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A03H')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'sor3' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A034') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c쿠랄툼의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A034')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'sor4' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A01L') < 8 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c붕각의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A01L')*10) + "|cffffdc3c/75 이상 되어야 합니다."
        endif
      elseif ( i == 'sor5' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A07X') < 10 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c양의신권의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A07X')*10) + "|cffffdc3c/100 이상 되어야 합니다."
        endif
      elseif ( i == 'sor6' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02M') < 8 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A080') < 5 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A02M') < 8 ) then
            set msg = msg + "\n  |cffffdc3c백보신권의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02M')*10) + "|cffffdc3c/75 이상, "
          else
            set msg = msg + "\n  |cffffdc3c백보신권의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A02M')*10) + "|cffffdc3c/75 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A080') < 5 ) then
            set msg = msg + "발경의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A080')*10) + "|cffffdc3c/50 이상 되어야 합니다."
          else
            set msg = msg + "발경의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A080')*10) + "|cffffdc3c/50 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'sor7' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A04B') < 6 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c철포삼의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A04B')*10) + "|cffffdc3c/60 이상 되어야 합니다."
        endif
      elseif ( i == 'sor8' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A04Y') < 5 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c장풍의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A04Y')*10) + "|cffffdc3c/50 이상 되어야 합니다."
        endif
      elseif ( i == 'sor9' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A04Z') < 5 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c금강불괴의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A04Z')*10) + "|cffffdc3c/50 이상 되어야 합니다."
        endif
      elseif ( i == 'jpnt' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A050') < 8 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c쿠라노토의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A050')*10) + "|cffffdc3c/80 이상 되어야 합니다."
        endif
      elseif ( i == 'tret' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A069') < 9 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c반탄신공의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A069')*10) + "|cffffdc3c/90 이상 되어야 합니다."
        endif
      elseif ( i == 'pnvl' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A035') < 9 ) or ( GetUnitAbilityLevel(GetTriggerUnit(), 'A083') < 6 ) then
          set check = check + 1
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A035') < 9 ) then
            set msg = msg + "\n  |cffffdc3c선풍각의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A035')*10) + "|cffffdc3c/90 이상, "
          else
            set msg = msg + "\n  |cffffdc3c선풍각의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A035')*10) + "|cffffdc3c/90 이상, "
          endif
          if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A083') < 6 ) then
            set msg = msg + "소수신공의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A083')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          else
            set msg = msg + "소수신공의 숙련도가 |c0000ff00" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A083')*10) + "|cffffdc3c/60 이상 되어야 합니다."
          endif
        endif
      elseif ( i == 'ssan' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A084') < 5 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c달마신공 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A04Y')*10) + "|cffffdc3c/50 이상 되어야 합니다."
        endif
      elseif ( i == 'texp' ) then
        if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A00Y') < 10 ) then
          set check = check + 1
          set msg = msg + "\n  |cffffdc3c이형환위의 숙련도가 |cffff0000" + I2S(GetUnitAbilityLevel(GetTriggerUnit(), 'A00Y')*10) + "|cffffdc3c/100 이상 되어야 합니다."
        endif
      else
        set check = check + 1
        set msg = msg + "\n  |cffff0000에러!! |r⑥|cffffdc3c설정 미스입니다. 카페에 신고해 주세요. [ " + SubString(GetItemName(GetManipulatedItem()), 0, 3) + " ]"
      endif
    endif
    // 8. 순수스킬 비교
    if ( SubString(s, 19, 20) == "2" ) then
      if ( SysInt(5, GetUnitTypeId(GetTriggerUnit())) > 0 ) then
        set check = check + 1
        set msg = msg + "\n  |cffffdc3c이 스킬은 |cffff0000순수직업|cffffdc3c만 배울 수 있습니다. ( 현재 당신의 전직직업: |c0087F264" + JOBNAME3(SysInt(5, GetUnitTypeId(GetTriggerUnit()))) + "|cffffdc3c )"
      endif
      if ( CountItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1,'I09T') < 100 ) then
        set check = check + 1
        set msg = msg + "\n  |cffffdc3c승급재료가 |cff9932cc100|cffffdc3c개 이상 필요합니다. ( |cffff0000" + I2S(100-CountItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1,'I09T')) + "|cffffdc3c병 부족 )"
      endif
      if ( CountItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1,'I09Q') < 30 ) then
        set check = check + 1
        set msg = msg + "\n  |cffffdc3c좀비심장이 |cff9932cc30|cffffdc3c개 이상 필요합니다. ( |cffff0000" + I2S(30-CountItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1,'I09Q')) + "|cffffdc3c병 부족 )"
      endif
      if ( CountItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1,'I09U') < 2 ) then
        set check = check + 1
        set msg = msg + "\n  |cffffdc3c킹아크퍼스의 심장이 |cff9932cc2|cffffdc3c개 이상 필요합니다. ( |cffff0000" + I2S(2-CountItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1,'I09U')) + "|cffffdc3c병 부족 )"
      endif
      if ( CountItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1,'I084') < 200 ) then
        set check = check + 1
        set msg = msg + "\n  |cffffdc3c엑스쿠라눔이 |cff9932cc200|cffffdc3c병 이상 필요합니다. ( |cffff0000" + I2S(200-CountItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1,'I084')) + "|cffffdc3c병 부족 )"
      endif
    elseif ( SubString(s, 19, 20) == "1" ) then
      if ( CountItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1,'I09T') < 30 ) then
        set check = check + 1
        set msg = msg + "\n  |cffffdc3c승급재료가 |cff9932cc30|cffffdc3c개 이상 필요합니다. ( |cffff0000" + I2S(30-CountItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1,'I09T')) + "|cffffdc3c개 부족 )"
      endif
      if ( CountItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1,'I09Q') < 10 ) then
        set check = check + 1
        set msg = msg + "\n  |cffffdc3c좀비심장이 |cff9932cc10|cffffdc3c개 이상 필요합니다. ( |cffff0000" + I2S(10-CountItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1,'I09Q')) + "|cffffdc3c개 부족 )"
      endif
      if ( CountItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1,'I084') < 50 ) then
        set check = check + 1
        set msg = msg + "\n  |cffffdc3c엑스쿠라눔이 |cff9932cc50|cffffdc3c병 이상 필요합니다. ( |cffff0000" + I2S(50-CountItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1,'I084')) + "|cffffdc3c병 부족 )"
      endif
    endif
    
    // 성공/실패 뷰
  else
    set check = check + 1
    set msg = msg + "\n  |cffff0000에러!! |rⓞ|cffffdc3c설정 미스입니다. 카페에 신고해 주세요. [ " + I2S(i) + " / " + s + " ]"
  endif
  if ( check == 0 ) then
    
    if ( SubString(s, 1, 2) == "6" ) then
      // 8. 순수스킬 비교
      if ( SubString(s, 19, 20) == "2" ) then
        call MinusItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 'I09T', 100)
        call MinusItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 'I09Q', 30)
        call MinusItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 'I09U', 2)
        call MinusItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 'I084', 200)
        call SetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD) -900000)
      elseif ( SubString(s, 19, 20) == "1" ) then
        call MinusItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 'I09T', 30)
        call MinusItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 'I09Q', 10)
        call MinusItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 'I084', 50)
        call SetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD) -SK2G(S2I(SubString(s, 1, 2))))
      endif
    else
      call SetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD) -SK2G(S2I(SubString(s, 1, 2))))
    endif
    set i = GetItemTypeId(GetManipulatedItem())
    if ( i == 'fgun' ) or ( i == 'dust' ) or ( i == 'flag' ) or ( i == 'klmm' ) then
      set i = GetUnitAbilityLevel(GetTriggerUnit(),'A008') + GetUnitAbilityLevel(GetTriggerUnit(),'A020') + GetUnitAbilityLevel(GetTriggerUnit(),'A021') + GetUnitAbilityLevel(GetTriggerUnit(),'A022')
    else
      set i = 0
    endif
	if ( LoadInteger(udg_hash, StringHash("Player"+I2S(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1)), StringHash("Skill_"+I2S(SK2I(SubString(s, 17, 18))))) != 0 ) and not( UnitRemoveAbility(GetTriggerUnit(), LoadInteger(udg_hash, StringHash("Player"+I2S(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1)), StringHash("Skill_"+I2S(SK2I(SubString(s, 17, 18)))))) ) then
	  call MSG(GetOwningPlayer(GetTriggerUnit()), 2, 8, "|cffff0000에러!! |rⓐ|cffffdc3c설정 미스입니다. 카페에 신고해 주세요. [ " + SubString(GetItemName(GetManipulatedItem()), 0, 3) + " / " + SubString(s, 17, 18) + " ]")
	endif
    call TriggerSleepAction(.1)
    if ( check == 0 ) then
      set c = S2I(SubString(GetItemName(GetManipulatedItem()), 0, 3))
      call UnitAddAbility(GetTriggerUnit(), udg_FSE_Skill[c])
      call MSG(GetOwningPlayer(GetTriggerUnit()), 1, 3, SubString(GetItemName(GetManipulatedItem()), 4, StringLength(GetItemName(GetManipulatedItem()))) + "을(를) 배웠습니다.")
      if ( i >= 2 ) then
        call SetUnitAbilityLevel(GetTriggerUnit(), udg_FSE_Skill[c], i)
      endif
	  //해쉬에 저장(이 값을 나중에 불러와 저장한다)  
	  call SaveInteger(udg_hash, StringHash("Player"+I2S(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1)), StringHash("Skill_"+I2S(SK2I(SubString(s, 17, 18)))), udg_FSE_Skill[c])
    endif
  else
    call MSG(GetOwningPlayer(GetTriggerUnit()), 2, 8, msg)
  endif
  call RemoveItem(GetManipulatedItem())
  set s = ""
  set i = 0
  set c = 0
  set check = 0
  set msg = ""
endfunction

//===========================================================================
function InitTrig_Buy_Skills_All takes nothing returns nothing
  set gg_trg_Buy_Skills_All = CreateTrigger(  )
  call TriggerRegisterAnyUnitEventBJ( gg_trg_Buy_Skills_All, EVENT_PLAYER_UNIT_PICKUP_ITEM )
  call TriggerAddCondition( gg_trg_Buy_Skills_All, Condition( function Trig_Buy_Skills_All_Conditions ) )
  call TriggerAddAction( gg_trg_Buy_Skills_All, function Trig_Buy_Skills_All_Actions )
endfunction

//===========================================================================
// Trigger: AutoReaction iii
//===========================================================================
function RangeAdd takes real r, integer id returns real
  return r * RMaxBJ(1., SquareRoot(udg_SysE_INT3[id]/100))
endfunction

function GetHPLimit takes boolean solo returns real
  if ( solo ) then
    return GetUnitState(udg_temp_u, UNIT_STATE_MAX_LIFE)*2.5 * (100+udg_SysC_HealAdd[udg_temp_i])/100.
  else
    return GetUnitState(udg_temp_u, UNIT_STATE_MAX_LIFE)*1.25 * (100+udg_SysC_HealAdd[udg_temp_i])/100.
  endif
endfunction
//GetHPLimit(true)
//전체공격 추가마나소모
function RangeMana takes unit u, real mp returns boolean
  if ( udg_temp_b ) then
    return false
  elseif ( GetUnitState(u, UNIT_STATE_MANA) > mp ) then
    call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA) - mp)
    return true
  else
    set udg_temp_b = true
    return false
  endif
endfunction
//if ( RangeMana(udg_temp_u) ) then

//ㅌ속성 마나회복
function TeraMana takes unit u, integer P returns boolean
  if ( GetRandomReal(0,100) <=  SkillPer(u, P, 0.25, 3) ) then
    call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA) + (EXGetAbilityDataInteger(EXGetUnitAbility(u, udg_temp_ab), GetUnitAbilityLevel(u, udg_temp_ab), ABILITY_DATA_COST) * BaseValue(22) * udg_SysC_CriX[P] ))
    
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl", u, "origin"))
    return true
  endif
  return false
endfunction
//call TeraMana(udg_temp_u, udg_temp_i)

//ㅍ속성 스턴
function AduroStun takes unit t, integer P returns nothing
  if ( GetRandomReal(0,100) <=  SkillPer(null, P, 0.25, 3) ) then
    //이펙트
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Monsoon\\MonsoonBoltTarget.mdl", t, "origin"))
    call TimeAction(t, 1., 8)
    if ( ISBOSS(GetUnitTypeId(t)) == 0 ) then
      call Dummier(Player(P-1),t,-1,'A011',"banish")
    endif
  endif
endfunction
//call TeraMana(udg_temp_u, udg_temp_i)

//ㅎ속성 딜뻥
function FlamoAdd takes integer P, real dmg, integer r_type, integer e_lv returns real
  if ( GetRandomReal(0,100) <=  SkillPer(null, P, 0.17, 3) ) then
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ControlMagic\\ControlMagicTarget.mdl", udg_Unit[P], "origin"))
    call ED(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Doom\\DoomTarget.mdl", udg_Unit[P], "origin"), 2.)
    if ( GetRandomReal(0,100) <= udg_SysC_CriP[P] ) then
    //Xuper Casting
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Demon\\ReviveDemon\\ReviveDemon.mdl", udg_Unit[P], "origin"))
      call Bufftt(CreateTextTagUnitBJ("Xuper Casting !!", udg_Unit[P], 20, 12, 30, 100, 30, 0 ), 6)
      set dmg = dmg * (1.+udg_SysC_CriX[P])
      if ( r_type == 1 ) then
        call SetWidgetLife(udg_Unit[P], GetWidgetLife(udg_Unit[P])*.9)
      elseif ( r_type == 2 ) then
        call SetWidgetLife(udg_Unit[P], GetWidgetLife(udg_Unit[P])*.8)
      elseif ( r_type == 3 ) then
        call SetWidgetLife(udg_Unit[P], GetWidgetLife(udg_Unit[P])*.7)
      endif
      if ( e_lv != 0 ) then
        call GetEffectUnit(udg_temp_u2, 4, e_lv+2)
      endif
    else
      call Bufftt(CreateTextTagUnitBJ("Super Casting !!", udg_Unit[P], 20, 10, 30, 100, 30, 0 ), 6)
      set dmg = dmg * udg_SysC_CriX[P]
      if ( r_type == 1 ) then
        call SetWidgetLife(udg_Unit[P], GetWidgetLife(udg_Unit[P])*.95)
      elseif ( r_type == 2 ) then
        call SetWidgetLife(udg_Unit[P], GetWidgetLife(udg_Unit[P])*.9)
      elseif ( r_type == 3 ) then
        call SetWidgetLife(udg_Unit[P], GetWidgetLife(udg_Unit[P])*.85)
      endif
      if ( e_lv != 0 ) then
        call GetEffectUnit(udg_temp_u2, 4, e_lv+1)
      endif
    endif
  elseif ( GetRandomReal(0,100) <= udg_SysC_CriP[P] ) then
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ControlMagic\\ControlMagicTarget.mdl", udg_Unit[P], "origin"))
    call ED(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Doom\\DoomTarget.mdl", udg_Unit[P], "origin"), 2.)
    call Bufftt(CreateTextTagUnitBJ("Super Casting !!", udg_Unit[P], 20, 10, 30, 100, 30, 0 ), 6)
    set dmg = dmg * udg_SysC_CriX[P]
    if ( r_type == 1 ) then
      call SetWidgetLife(udg_Unit[P], GetWidgetLife(udg_Unit[P])*.95)
    elseif ( r_type == 2 ) then
      call SetWidgetLife(udg_Unit[P], GetWidgetLife(udg_Unit[P])*.9)
    elseif ( r_type == 3 ) then
      call SetWidgetLife(udg_Unit[P], GetWidgetLife(udg_Unit[P])*.85)
    endif
    if ( e_lv != 0 ) then
      call GetEffectUnit(udg_temp_u2, 4, e_lv+1)
    endif
  else
    if ( e_lv != 0 ) then
      call GetEffectUnit(udg_temp_u2, 4, e_lv)
    endif
  endif
  return dmg
endfunction
//call DmgMagic(udg_temp_u, udg_temp_u2, FlamoAdd(udg_temp_i, MakeValue("150|In=*50|Se.*0.8", udg_temp_i) * MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A022'),udg_temp_i,1), 1, 1))
//set udg_temp_r = FlamoAdd(udg_temp_i, MakeValue("300|In=*50|Se.*0.8", udg_temp_i) * MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A028'),udg_temp_i,1), 2, 0)


function AR3_Condi takes nothing returns boolean
  return ( GetPlayerController(GetOwningPlayer(GetFilterUnit())) == MAP_CONTROL_USER )
endfunction

function Trig_AutoReaction_ii_Actions takes nothing returns nothing
  set udg_temp_g = GetGroupEnemy(CreateGroup(), udg_temp_u2, 750., Condition(function AR3_Condi))
  set bj_groupCountUnits = 0
  call ForGroup(udg_temp_g, function CountUnitsInGroupEnum)
  if ( bj_groupCountUnits > 0 ) then
    call IssuePointOrder(udg_temp_u2, "patrol", GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u))
  endif
  call DestroyGroup(udg_temp_g)
endfunction

//===========================================================================
function InitTrig_AutoReaction_iii takes nothing returns nothing
  set gg_trg_AutoReaction_iii = CreateTrigger()
  call DisableTrigger(gg_trg_AutoReaction_iii)
  call TriggerAddAction(gg_trg_AutoReaction_iii, function Trig_AutoReaction_ii_Actions)
endfunction

function Range_Condi takes nothing returns boolean
  return ( GetWidgetLife(GetFilterUnit()) > .4 ) and ( IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(udg_temp_u)) ) and ( not IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) )
endfunction
function Range_Condi_Trap takes nothing returns boolean
  return ( GetWidgetLife(GetFilterUnit()) > .4 ) and ( IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(udg_temp_u)) ) and ( GetUnitAbilityLevel(GetFilterUnit(), 'Apiv') > 0 )
endfunction//===========================================================================
// Trigger: SQResqueDA007
//===========================================================================
function Trig_SQResqueDA007_Func003002003001 takes nothing returns boolean
    return ( GetUnitStateSwap(UNIT_STATE_LIFE, GetFilterUnit()) > 0.00 )
endfunction

function Trig_SQResqueDA007_Func003002003002001 takes nothing returns boolean
    return ( IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(udg_temp_u)) == true )
endfunction

function Trig_SQResqueDA007_Func003002003002002 takes nothing returns boolean
    return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) != true )
endfunction

function Trig_SQResqueDA007_Func003002003002 takes nothing returns boolean
    return GetBooleanAnd( Trig_SQResqueDA007_Func003002003002001(), Trig_SQResqueDA007_Func003002003002002() )
endfunction

function Trig_SQResqueDA007_Func003002003 takes nothing returns boolean
    return GetBooleanAnd( Trig_SQResqueDA007_Func003002003001(), Trig_SQResqueDA007_Func003002003002() )
endfunction

function Trig_SQResqueDA007_Func007A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    set udg_temp_i = ( udg_temp_i + 1 )
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl", udg_temp_u2, "overhead") )
    call IssueTargetOrder(udg_temp_u2, "attack", udg_temp_u)
    call Attack(udg_temp_u2, udg_temp_u, 0.5, 5)
    call TimeAction(udg_temp_u2, 1, 8)
endfunction

function Trig_SQResqueDA007_Actions takes nothing returns nothing
    if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A007', 0.9, 2) ) then
    set udg_temp_l = GetUnitLoc(udg_temp_u)
    set udg_temp_g = GetUnitsInRangeOfLocMatching(250.00, udg_temp_l, Condition(function Trig_SQResqueDA007_Func003002003))
    call RemoveLocation( udg_temp_l )
    set udg_temp_r = RMaxBJ(15.00, ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_temp_u) / 100.00 ))
    set udg_temp_i = 0
    call ForGroupBJ( udg_temp_g, function Trig_SQResqueDA007_Func007A )
    call DestroyGroup( udg_temp_g )
      if ( udg_temp_i >= 1 ) then
        call TimeAction(udg_temp_u, 7., 22)
      endif
        call SkillUp(udg_temp_u, 'A007', 18)
        call CreateDummy(udg_temp_u, 'e00G')
    else
      call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
    endif
endfunction

//===========================================================================
function InitTrig_SQResqueDA007 takes nothing returns nothing
    set gg_trg_SQResqueDA007 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SQResqueDA007, function Trig_SQResqueDA007_Actions )
endfunction

//===========================================================================
// Trigger: SWShortBlacdeA02F
//===========================================================================
function Trig_SWShortBlacdeA02F_Actions takes nothing returns nothing
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A02F', 0.9, 2) ) then
        call SkillUp(udg_temp_u, 'A02F', 25)
        call CreateDummy2(udg_temp_u, 'e000', 5)
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
endfunction

//===========================================================================
function InitTrig_SWShortBlacdeA02F takes nothing returns nothing
    set gg_trg_SWShortBlacdeA02F = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SWShortBlacdeA02F, function Trig_SWShortBlacdeA02F_Actions )
endfunction

//===========================================================================
// Trigger: SW2WindBladeA00A
//===========================================================================
function Trig_SW2WindBladeA00A_Actions takes nothing returns nothing
    if ( udg_temp_ab == 'A00A' ) then
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A00A', 0.9, 1) ) then
        call SkillUp(udg_temp_u, 'A00A', 0)
        call CreateDummy2(udg_temp_u, 'e00U', 4)
    call SetUnitManaBJ( GetLastCreatedUnit(),                        (DummyActionNo('e00U', udg_temp_u, null, udg_temp_i, 0)) )
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
    else
      call CreateDummy2(udg_temp_u, 'e00U', 3)
    call SetUnitManaBJ( GetLastCreatedUnit(),                        (DummyActionNo('e00U', udg_temp_u, null, udg_temp_i, 3)) )
    endif
endfunction

//===========================================================================
function InitTrig_SW2WindBladeA00A takes nothing returns nothing
    set gg_trg_SW2WindBladeA00A = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SW2WindBladeA00A, function Trig_SW2WindBladeA00A_Actions )
endfunction

//===========================================================================
// Trigger: SEMegaBladeA02P
//
// call IssuePointOrder(bj_lastCreatedUnit, "carrionswarm", PolarX(udg_temp_u, 33., GetUnitFacing(udg_temp_u)+bj_forLoopBIndex*90.), PolarY(udg_temp_u, 33., GetUnitFacing(udg_temp_u)+bj_forLoopBIndex*90.))
// CreateDummy2(udg_temp_u, 'e01
//   call CreateDummy2(udg_temp_u, 'e01Q', 3)
//===========================================================================
function Trig_SEMegaBladeA02P_Func011A takes nothing returns nothing
    call DmgSkill(udg_temp_u, GetEnumUnit(), udg_temp_r)
endfunction

function Trig_SEMegaBladeA02P_Func018A takes nothing returns nothing
    call DmgSkill(udg_temp_u, GetEnumUnit(), udg_temp_r)
endfunction

function Trig_SEMegaBladeA02P_Actions takes nothing returns nothing
    set udg_temp_g =                                    (GetGroupEnemy(CreateGroup(), udg_temp_u, 240., Condition(function Range_Condi)))
    set bj_groupCountUnits = 0
    call ForGroup(udg_temp_g, function CountUnitsInGroupEnum)
    set udg_temp_i2 = bj_groupCountUnits
    if ( udg_temp_i2 != 0 ) then
      if ( udg_temp_ab == 'A02P' ) then
        if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A02P', 0.9, 1) ) then
      call SkillUp(udg_temp_u, 'A02P', -5)
    set bj_forLoopBIndex = 1
    set bj_forLoopBIndexEnd = 4
    loop
        exitwhen bj_forLoopBIndex > bj_forLoopBIndexEnd
        set bj_lastCreatedUnit = CreateUnit(Player(udg_temp_i-1), 'e015', GetWidgetX(udg_Unit[udg_temp_i]), GetWidgetY(udg_Unit[udg_temp_i]), bj_UNIT_FACING)
        call UnitAddAbility(bj_lastCreatedUnit, 'A0AC')
        call UnitApplyTimedLifeBJ( 1.50, 'BHwe', GetLastCreatedUnit() )
        call IssuePointOrder(bj_lastCreatedUnit, "carrionswarm", PolarX(GetWidgetX(udg_temp_u), 33., GetUnitFacing(udg_temp_u)+bj_forLoopBIndex*90.), PolarY(GetWidgetY(udg_temp_u), 33., GetUnitFacing(udg_temp_u)+bj_forLoopBIndex*90.))
        set bj_forLoopBIndex = bj_forLoopBIndex + 1
    endloop
    set udg_temp_r =                        (DummyActionNo('e00T', udg_temp_u, null, udg_temp_i, 0))
    call ForGroupBJ( udg_temp_g, function Trig_SEMegaBladeA02P_Func011A )
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
    else
    set bj_forLoopBIndex = 1
    set bj_forLoopBIndexEnd = 4
    loop
        exitwhen bj_forLoopBIndex > bj_forLoopBIndexEnd
        set bj_lastCreatedUnit = CreateUnit(Player(udg_temp_i-1), 'e015', GetWidgetX(udg_Unit[udg_temp_i]), GetWidgetY(udg_Unit[udg_temp_i]), bj_UNIT_FACING)
        call UnitAddAbility(bj_lastCreatedUnit, 'A0AC')
        call SetUnitUserData(bj_lastCreatedUnit, 'e00T')
        call IssuePointOrder(bj_lastCreatedUnit, "carrionswarm", PolarX(GetWidgetX(udg_temp_u), 33., GetUnitFacing(udg_temp_u)+bj_forLoopBIndex*90.), PolarY(GetWidgetY(udg_temp_u), 33., GetUnitFacing(udg_temp_u)+bj_forLoopBIndex*90.))
        call UnitApplyTimedLifeBJ( 1.50, 'BHwe', GetLastCreatedUnit() )
        call SetUnitManaBJ( GetLastCreatedUnit(),                        (DummyActionNo('e00T', udg_temp_u, null, udg_temp_i, 3)) )
        set bj_forLoopBIndex = bj_forLoopBIndex + 1
    endloop
    set udg_temp_r =                        (DummyActionNo('e00T', udg_temp_u, null, udg_temp_i, 3))
    call ForGroupBJ( udg_temp_g, function Trig_SEMegaBladeA02P_Func018A )
    endif
    else
      call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다. (적이 없습니다)")
    endif
    call DestroyGroup( udg_temp_g )
endfunction

//===========================================================================
function InitTrig_SEMegaBladeA02P takes nothing returns nothing
    set gg_trg_SEMegaBladeA02P = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SEMegaBladeA02P, function Trig_SEMegaBladeA02P_Actions )
endfunction

//===========================================================================
// Trigger: SQ2BatuDA02N
//===========================================================================
function Trig_SQ2BatuDA02N_Func007002003001 takes nothing returns boolean
    return ( GetUnitStateSwap(UNIT_STATE_LIFE, GetFilterUnit()) > 0.00 )
endfunction

function Trig_SQ2BatuDA02N_Func007002003002001 takes nothing returns boolean
    return ( IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(udg_temp_u)) == true )
endfunction

function Trig_SQ2BatuDA02N_Func007002003002002 takes nothing returns boolean
    return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) != true )
endfunction

function Trig_SQ2BatuDA02N_Func007002003002 takes nothing returns boolean
    return GetBooleanAnd( Trig_SQ2BatuDA02N_Func007002003002001(), Trig_SQ2BatuDA02N_Func007002003002002() )
endfunction

function Trig_SQ2BatuDA02N_Func007002003 takes nothing returns boolean
    return GetBooleanAnd( Trig_SQ2BatuDA02N_Func007002003001(), Trig_SQ2BatuDA02N_Func007002003002() )
endfunction

function Trig_SQ2BatuDA02N_Func010A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    set udg_temp_i = ( udg_temp_i + 1 )
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl", udg_temp_u2, "overhead") )
    call IssueTargetOrder(udg_temp_u2, "attack", udg_temp_u)
    call Attack(udg_temp_u2, udg_temp_u, 0.5, 5)
    call TimeAction(udg_temp_u2, 1, 8)
endfunction

function Trig_SQ2BatuDA02N_Func022002003001 takes nothing returns boolean
    return ( GetUnitStateSwap(UNIT_STATE_LIFE, GetFilterUnit()) > 0.00 )
endfunction

function Trig_SQ2BatuDA02N_Func022002003002001 takes nothing returns boolean
    return ( IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(udg_temp_u)) == true )
endfunction

function Trig_SQ2BatuDA02N_Func022002003002002 takes nothing returns boolean
    return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) != true )
endfunction

function Trig_SQ2BatuDA02N_Func022002003002 takes nothing returns boolean
    return GetBooleanAnd( Trig_SQ2BatuDA02N_Func022002003002001(), Trig_SQ2BatuDA02N_Func022002003002002() )
endfunction

function Trig_SQ2BatuDA02N_Func022002003 takes nothing returns boolean
    return GetBooleanAnd( Trig_SQ2BatuDA02N_Func022002003001(), Trig_SQ2BatuDA02N_Func022002003002() )
endfunction

function Trig_SQ2BatuDA02N_Func025A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    set udg_temp_i = ( udg_temp_i + 1 )
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl", udg_temp_u2, "overhead") )
    call IssueTargetOrder(udg_temp_u2, "attack", udg_temp_u)
    call Attack(udg_temp_u2, udg_temp_u, 0.5, 5)
    call TimeAction(udg_temp_u2, 1, 8)
endfunction

function Trig_SQ2BatuDA02N_Actions takes nothing returns nothing
    local integer i = 0
    local real r = 0
    local unit u = null
    if ( udg_temp_ab == 'A02N' ) then
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A02N', 0.9, 1) ) then
    set udg_temp_l = GetUnitLoc(udg_temp_u)
    set udg_temp_g = GetUnitsInRangeOfLocMatching(250.00, udg_temp_l, Condition(function Trig_SQ2BatuDA02N_Func007002003))
    call RemoveLocation( udg_temp_l )
    set udg_temp_i = 0
    call ForGroupBJ( udg_temp_g, function Trig_SQ2BatuDA02N_Func010A )
    call DestroyGroup( udg_temp_g )
        if ( udg_temp_i >= 1 ) then
          call TimeAction(udg_temp_u, 10., 22)
        endif
          call CreateDummy(udg_temp_u, 'e00J')
          call SkillUp(udg_temp_u, 'A02N', 0)
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
    else
    set udg_temp_l = GetUnitLoc(udg_temp_u)
    set udg_temp_g = GetUnitsInRangeOfLocMatching(250.00, udg_temp_l, Condition(function Trig_SQ2BatuDA02N_Func022002003))
    call RemoveLocation( udg_temp_l )
    set udg_temp_i = 0
    call ForGroupBJ( udg_temp_g, function Trig_SQ2BatuDA02N_Func025A )
    call DestroyGroup( udg_temp_g )
        if ( udg_temp_i >= 1 ) then
          call TimeAction(udg_temp_u, 10., 22)
        endif
      call CreateDummy2(udg_temp_u, 'e00J', 1)
    endif
    set u = null
    set i = 0
    set r = 0
endfunction

//===========================================================================
function InitTrig_SQ2BatuDA02N takes nothing returns nothing
    set gg_trg_SQ2BatuDA02N = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SQ2BatuDA02N, function Trig_SQ2BatuDA02N_Actions )
endfunction

//===========================================================================
// Trigger: SRHitarmsDA03R
//===========================================================================
function Trig_SRHitarmsDA03R_Actions takes nothing returns nothing
    if ( udg_temp_ab == 'A03R' ) then
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A03R', 0.9, 1) ) then
          call CreateDummy(udg_temp_u, 'e00K')
          call SkillUp(udg_temp_u, 'A03R', 0)
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
    else
      call CreateDummy2(udg_temp_u, 'e00K', 1)
    endif
endfunction

//===========================================================================
function InitTrig_SRHitarmsDA03R takes nothing returns nothing
    set gg_trg_SRHitarmsDA03R = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SRHitarmsDA03R, function Trig_SRHitarmsDA03R_Actions )
endfunction

//===========================================================================
// Trigger: STRushA02A
//===========================================================================
function Trig_STRushA02A_Actions takes nothing returns nothing
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A02A', 0.9, 1) ) then
        call CreateDummy2(udg_temp_u, 'e017', 3)
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
endfunction

//===========================================================================
function InitTrig_STRushA02A takes nothing returns nothing
    set gg_trg_STRushA02A = CreateTrigger(  )
    call TriggerAddAction( gg_trg_STRushA02A, function Trig_STRushA02A_Actions )
endfunction

//===========================================================================
// Trigger: SQ3PyohoA09X
//
//     //
//===========================================================================
function Trig_SQ3PyohoA09X_Func007A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl", udg_temp_u2, "overhead") )
    call IssueTargetOrder(udg_temp_u2, "attack", udg_temp_u)
    call Attack(udg_temp_u2, udg_temp_u, 0.5, 5)
    call TimeAction(udg_temp_u2, 1, 8)
    set bj_lastCreatedUnit = CreateUnit(Player(udg_temp_i-1), 'e000', GetWidgetX(udg_temp_u2), GetWidgetY(udg_temp_u2), bj_UNIT_FACING)
    call SetUnitAbilityLevel(bj_lastCreatedUnit, 'A023', 2)
    call IssueTargetOrder(bj_lastCreatedUnit, "slow", udg_temp_u2)
    call RemoveUnit(bj_lastCreatedUnit)
endfunction

function Trig_SQ3PyohoA09X_Actions takes nothing returns nothing
    set udg_temp_g =                                    (GetGroupEnemy(CreateGroup(), udg_temp_u, 900., Condition(function Range_Condi)))
    set bj_groupCountUnits = 0
    call ForGroup(udg_temp_g, function CountUnitsInGroupEnum)
    set udg_temp_i2 = bj_groupCountUnits
    if ( udg_temp_i2 != 0 ) then
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A09X', 0.7, 1) ) then
    call ForGroupBJ( udg_temp_g, function Trig_SQ3PyohoA09X_Func007A )
        call TimeAction(udg_temp_u, 20., 22)
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
    else
      call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다. (적이 없습니다)")
    endif
    call DestroyGroup( udg_temp_g )
endfunction

//===========================================================================
function InitTrig_SQ3PyohoA09X takes nothing returns nothing
    set gg_trg_SQ3PyohoA09X = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SQ3PyohoA09X, function Trig_SQ3PyohoA09X_Actions )
endfunction

//===========================================================================
// Trigger: SW3RuneBladeA09Y
//===========================================================================
function Trig_SW3RuneBladeA09Y_Actions takes nothing returns nothing
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A09Y', 0.7, 1) ) then
        call SkillUp(udg_temp_u, 'A09Y', -29.5)
        call CreateDummy2(udg_temp_u, 'e01Q', 4)
    call SetUnitManaBJ( GetLastCreatedUnit(),                        (DummyActionNo('e01Q', udg_temp_u, null, udg_temp_i, 3)) )
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
endfunction

//===========================================================================
function InitTrig_SW3RuneBladeA09Y takes nothing returns nothing
    set gg_trg_SW3RuneBladeA09Y = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SW3RuneBladeA09Y, function Trig_SW3RuneBladeA09Y_Actions )
endfunction

//===========================================================================
// Trigger: SE2StomeBladeA09Z
//
// call IssuePointOrder(bj_lastCreatedUnit, "carrionswarm", PolarX(udg_temp_u, 33., GetUnitFacing(udg_temp_u)+bj_forLoopBIndex*90.), PolarY(udg_temp_u, 33., GetUnitFacing(udg_temp_u)+bj_forLoopBIndex*90.))
//===========================================================================
function Trig_SE2StomeBladeA09Z_Func010A takes nothing returns nothing
    call DmgSkill(udg_temp_u, GetEnumUnit(), udg_temp_r)
endfunction

function Trig_SE2StomeBladeA09Z_Actions takes nothing returns nothing
    set udg_temp_g =                                    (GetGroupEnemy(CreateGroup(), udg_temp_u, 240., Condition(function Range_Condi)))
    set bj_groupCountUnits = 0
    call ForGroup(udg_temp_g, function CountUnitsInGroupEnum)
    set udg_temp_i2 = bj_groupCountUnits
    if ( udg_temp_i2 != 0 ) then
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A09Z', 0.7, 1) ) then
        call SkillUp(udg_temp_u, 'A09Z', -29.5)
    set bj_forLoopBIndex = 1
    set bj_forLoopBIndexEnd = 4
    loop
        exitwhen bj_forLoopBIndex > bj_forLoopBIndexEnd
        set bj_lastCreatedUnit = CreateUnit(Player(udg_temp_i-1), 'e015', GetWidgetX(udg_Unit[udg_temp_i]), GetWidgetY(udg_Unit[udg_temp_i]), bj_UNIT_FACING)
        call UnitAddAbility(bj_lastCreatedUnit, 'A0AC')
        call IssuePointOrder(bj_lastCreatedUnit, "carrionswarm", PolarX(GetWidgetX(udg_temp_u), 33., GetUnitFacing(udg_temp_u)+bj_forLoopBIndex*90.), PolarY(GetWidgetY(udg_temp_u), 33., GetUnitFacing(udg_temp_u)+bj_forLoopBIndex*90.))
        call UnitApplyTimedLifeBJ( 1.50, 'BHwe', GetLastCreatedUnit() )
        set bj_forLoopBIndex = bj_forLoopBIndex + 1
    endloop
    set udg_temp_r =                        (DummyActionNo('e01P', udg_temp_u, null, udg_temp_i, 3))
    call ForGroupBJ( udg_temp_g, function Trig_SE2StomeBladeA09Z_Func010A )
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
    else
      call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다. (적이 없습니다)")
    endif
    call DestroyGroup( udg_temp_g )
endfunction

//===========================================================================
function InitTrig_SE2StomeBladeA09Z takes nothing returns nothing
    set gg_trg_SE2StomeBladeA09Z = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SE2StomeBladeA09Z, function Trig_SE2StomeBladeA09Z_Actions )
endfunction

//===========================================================================
// Trigger: SQSPierceDA02H
//===========================================================================
constant function TheifSkill takes integer i, boolean upgrade returns integer
  if ( upgrade ) then
    if ( i == 0 ) then
      return 4
    elseif ( i == 1 ) then
      return 'A06T'
    elseif ( i == 2 ) then
      return 'A070'
    elseif ( i == 3 ) then
      return 'A073'
    elseif ( i == 4 ) then
      return 'A071'
    endif
  else
    if ( i == 0 ) then
      return 7
    elseif ( i == 1 ) then
      return 'A02H'
    elseif ( i == 2 ) then
      return 'A009'
    elseif ( i == 3 ) then
      return 'A01J'
    elseif ( i == 4 ) then
      return 'A00F'
    elseif ( i == 5 ) then
      return 'A03O'
    elseif ( i == 6 ) then
      return 'A04J'
    elseif ( i == 7 ) then
      return 'A02U'
    endif
  endif
 return 0
endfunction
//call EXSetAbilityState(EXGetUnitAbility(u, ab), ABILITY_STATE_COOLDOWN, .01)
//call Bufftt(CreateTextTagUnitBJ("      콤보: 초기화", u, 20, 11, 100, 50, 100, 0 ),6)
function LuckeyHit takes unit u, real bonus, boolean upgrade returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(u))+1
 local integer loopA = 1
  if ( GetRandomReal(0,100) <=  10.+((udg_SysC_Hits[P]/5.)*bonus) ) then
    loop
      call EXSetAbilityState(EXGetUnitAbility(u, TheifSkill(loopA,upgrade)), ABILITY_STATE_COOLDOWN, 0.)
      exitwhen loopA >= TheifSkill(0,upgrade)
      set loopA = loopA + 1
    endloop
    if ( bonus < 2. ) then
      call TriggerSleepAction(.01)
      call EXSetAbilityState(EXGetUnitAbility(u, udg_temp_ab), ABILITY_STATE_COOLDOWN, .01)
    endif
    
    if ( not udg_SysA_EffectSimple ) then
      call CinematicFilterGenericForPlayer( GetOwningPlayer(u), 0.30, BLEND_MODE_BLEND, "ReplaceableTextures\\CameraMasks\\White_mask.blp", 100, 100, 0.00, 30.00, 100, 100, 0.00, 100 )
    endif
    call MSG(GetOwningPlayer(u), 1, .3, "Lucky Hit!")
  endif
endfunction
function Trig_SQSPierceDA02H_Actions takes nothing returns nothing
  if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A02H', 0.8, 2) ) then
    call SkillUp(udg_temp_u, 'A02H', 14)
    call CreateDummy(udg_temp_u, 'e00L')
    call LuckeyHit(udg_temp_u, 1., false)
  else
    call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
  endif
endfunction

//===========================================================================
function InitTrig_SQSPierceDA02H takes nothing returns nothing
  set gg_trg_SQSPierceDA02H = CreateTrigger(  )
  call TriggerAddAction( gg_trg_SQSPierceDA02H, function Trig_SQSPierceDA02H_Actions )
endfunction

//===========================================================================
// Trigger: SQPierceDA009
//===========================================================================
function Trig_SQPierceDA009_Actions takes nothing returns nothing
    if ( udg_temp_ab == 'A009' ) then
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A009', 0.8, 2) ) then
        call SkillUp(udg_temp_u, 'A009', 0)
        call CreateDummy(udg_temp_u, 'e00M')
        call LuckeyHit(udg_temp_u, 1., false)
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
    else
      call CreateDummy2(udg_temp_u, 'e00M', 1)
    call SetUnitManaBJ( GetLastCreatedUnit(),                        (DummyActionNo('e00M', udg_temp_u, null, udg_temp_i, 1)) )
      call LuckeyHit(udg_temp_u, 1., true)
    endif
endfunction

//===========================================================================
function InitTrig_SQPierceDA009 takes nothing returns nothing
    set gg_trg_SQPierceDA009 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SQPierceDA009, function Trig_SQPierceDA009_Actions )
endfunction

//===========================================================================
// Trigger: SRAmunejiaDA00C
//
// 타겟12 아무네지아
//===========================================================================
function Trig_SRAmunejiaDA00C_Actions takes nothing returns nothing
    if ( udg_temp_ab == 'A00C' ) then
      call SkillUp(udg_temp_u, 'A00C', 0)
      call CreateDummy(udg_temp_u, 'e00H')
    else
      call CreateDummy2(udg_temp_u, 'e00H', 1)
    endif
endfunction

//===========================================================================
function InitTrig_SRAmunejiaDA00C takes nothing returns nothing
    set gg_trg_SRAmunejiaDA00C = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SRAmunejiaDA00C, function Trig_SRAmunejiaDA00C_Actions )
endfunction

//===========================================================================
// Trigger: SWDartThrowDA01J
//===========================================================================
function Trig_SWDartThrowDA01J_Actions takes nothing returns nothing
    if ( SubString(LoadStr(udg_hash, GetItemTypeId(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(udg_temp_i)), FMI_MAXMAX_INVENTORY+7)), StringHash("FMi-Val")),1,3) == "03" ) then
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A01J', 0.9, 2) ) then
        call SkillUp(udg_temp_u, 'A01J', 8)
        call CreateDummy(udg_temp_u, 'e00D')
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
    else
      call IssueImmediateOrderBJ( udg_temp_u, "stop" )
      call MSG(GetOwningPlayer(udg_temp_u), 1, 4, "|cffffdc3c무기가 표창이 아닙니다 !! ("+SysStr(4,S2I(SubString(LoadStr(udg_hash, GetItemTypeId(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(udg_temp_i)), 37)), StringHash("FMi-Val")),1,3)))+"|cffffdc3c)")
    endif
endfunction

//===========================================================================
function InitTrig_SWDartThrowDA01J takes nothing returns nothing
    set gg_trg_SWDartThrowDA01J = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SWDartThrowDA01J, function Trig_SWDartThrowDA01J_Actions )
endfunction

//===========================================================================
// Trigger: SEPierce2DA00F
//===========================================================================
function Trig_SEPierce2DA00F_Actions takes nothing returns nothing
    if ( udg_temp_ab == 'A00F' ) then
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A00F', 0.85, 1) ) then
        call SkillUp(udg_temp_u, 'A00F', 0)
        call CreateDummy(udg_temp_u, 'e00N')
        call LuckeyHit(udg_temp_u, 2., false)
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
    else
      call CreateDummy2(udg_temp_u, 'e00N', 1)
    call SetUnitManaBJ( GetLastCreatedUnit(),                        (DummyActionNo('e00N', udg_temp_u, null, udg_temp_i, 1)) )
      call LuckeyHit(udg_temp_u, 2., true)
    endif
endfunction

//===========================================================================
function InitTrig_SEPierce2DA00F takes nothing returns nothing
    set gg_trg_SEPierce2DA00F = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SEPierce2DA00F, function Trig_SEPierce2DA00F_Actions )
endfunction

//===========================================================================
// Trigger: STAssaultDA03O
//
// 확률 0.7
// 21~70
//===========================================================================
function Trig_STAssaultDA03O_Func006002003001 takes nothing returns boolean
    return ( GetUnitStateSwap(UNIT_STATE_LIFE, GetFilterUnit()) > 0.00 )
endfunction

function Trig_STAssaultDA03O_Func006002003002001 takes nothing returns boolean
    return ( IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(udg_temp_u)) == true )
endfunction

function Trig_STAssaultDA03O_Func006002003002002 takes nothing returns boolean
    return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) != true )
endfunction

function Trig_STAssaultDA03O_Func006002003002 takes nothing returns boolean
    return GetBooleanAnd( Trig_STAssaultDA03O_Func006002003002001(), Trig_STAssaultDA03O_Func006002003002002() )
endfunction

function Trig_STAssaultDA03O_Func006002003 takes nothing returns boolean
    return GetBooleanAnd( Trig_STAssaultDA03O_Func006002003001(), Trig_STAssaultDA03O_Func006002003002() )
endfunction

function Trig_STAssaultDA03O_Func008A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    call TimeAction(udg_temp_u2, 1, 8)
endfunction

function Trig_STAssaultDA03O_Func017002003001 takes nothing returns boolean
    return ( GetUnitStateSwap(UNIT_STATE_LIFE, GetFilterUnit()) > 0.00 )
endfunction

function Trig_STAssaultDA03O_Func017002003002001 takes nothing returns boolean
    return ( IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(udg_temp_u)) == true )
endfunction

function Trig_STAssaultDA03O_Func017002003002002 takes nothing returns boolean
    return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) != true )
endfunction

function Trig_STAssaultDA03O_Func017002003002 takes nothing returns boolean
    return GetBooleanAnd( Trig_STAssaultDA03O_Func017002003002001(), Trig_STAssaultDA03O_Func017002003002002() )
endfunction

function Trig_STAssaultDA03O_Func017002003 takes nothing returns boolean
    return GetBooleanAnd( Trig_STAssaultDA03O_Func017002003001(), Trig_STAssaultDA03O_Func017002003002() )
endfunction

function Trig_STAssaultDA03O_Func019A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    call TimeAction(udg_temp_u2, 1, 8)
endfunction

function Trig_STAssaultDA03O_Actions takes nothing returns nothing
    if ( udg_temp_ab == 'A03O' ) then
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A03O', 0.75, 1) ) then
        call SkillUp(udg_temp_u, 'A03O', 0)
        call CreateDummy(udg_temp_u, 'e00O')
    set udg_temp_l = GetUnitLoc(udg_temp_u)
    set udg_temp_g = GetUnitsInRangeOfLocMatching(175.00, udg_temp_l, Condition(function Trig_STAssaultDA03O_Func006002003))
    call RemoveLocation( udg_temp_l )
    call ForGroupBJ( udg_temp_g, function Trig_STAssaultDA03O_Func008A )
    call DestroyGroup( udg_temp_g )
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
    else
      call CreateDummy2(udg_temp_u, 'e00O', 1)
    call SetUnitManaBJ( GetLastCreatedUnit(),                        (DummyActionNo('e00O', udg_temp_u, null, udg_temp_i, 1)) )
    set udg_temp_l = GetUnitLoc(udg_temp_u)
    set udg_temp_g = GetUnitsInRangeOfLocMatching(175.00, udg_temp_l, Condition(function Trig_STAssaultDA03O_Func017002003))
    call RemoveLocation( udg_temp_l )
    call ForGroupBJ( udg_temp_g, function Trig_STAssaultDA03O_Func019A )
    call DestroyGroup( udg_temp_g )
    endif
endfunction

//===========================================================================
function InitTrig_STAssaultDA03O takes nothing returns nothing
    set gg_trg_STAssaultDA03O = CreateTrigger(  )
    call TriggerAddAction( gg_trg_STAssaultDA03O, function Trig_STAssaultDA03O_Actions )
endfunction

//===========================================================================
// Trigger: SWAssassinateDA04J
//
// 확률 0.6
// 18~60%
// 뎀지: 감소체력 x 0.5 ~ 2.0 랜덤데미지
//===========================================================================
function Trig_SWAssassinateDA04J_Actions takes nothing returns nothing
    if ( udg_temp_ab == 'A04J' ) then
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A03O', 0.8, 1) ) then
        call SkillUp(udg_temp_u, 'A04J', 0)
        call CreateDummy(udg_temp_u, 'e00Y')
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
    else
      if ( GetRandomReal(0,100) <= SkillPer(udg_temp_u,0,.8,1) ) then
        call CreateDummy2(udg_temp_u, 'e00Y', 1)
    call SetUnitManaBJ( GetLastCreatedUnit(),                        (DummyActionNo('e00Y', udg_temp_u, null, udg_temp_i, 1)) )
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
    endif
endfunction

//===========================================================================
function InitTrig_SWAssassinateDA04J takes nothing returns nothing
    set gg_trg_SWAssassinateDA04J = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SWAssassinateDA04J, function Trig_SWAssassinateDA04J_Actions )
endfunction

//===========================================================================
// Trigger: SR2RaidDA02U
//
// 타겟12 아무네지아
//===========================================================================
function Trig_SR2RaidDA02U_Actions takes nothing returns nothing
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A02U', 0.70, 1) ) then
        call SkillUp(udg_temp_u, 'A02U', -28)
        call CreateDummy(udg_temp_u, 'e016')
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
endfunction

//===========================================================================
function InitTrig_SR2RaidDA02U takes nothing returns nothing
    set gg_trg_SR2RaidDA02U = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SR2RaidDA02U, function Trig_SR2RaidDA02U_Actions )
endfunction

//===========================================================================
// Trigger: MQ1MTAPA008A020A021A022
//
// //마레노 스킬넘버 : 1,2,3
// // 마레노 데미지 : ((1000+(인트* (45/6))) * (0.3+ (0.07*스킬레벨)))* 기타배수(나르콜리 등)
// dmg = 
// MCri(, udg_temp_i, 1, 4)
//       
//===========================================================================
function Trig_MQ1MTAPA008A020A021A022_Actions takes nothing returns nothing
    call ConditionalTriggerExecute( gg_trg_AutoReaction_iii )
      if ( udg_temp_ab == 'A008' ) then
        call DmgMagic(udg_temp_u, udg_temp_u2, MCri(MakeValue("150|In=*50", udg_temp_i) * MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A008'),udg_temp_i,1), udg_temp_i, 1, 1))
        call GetEffectUnit(udg_temp_u2, 1, 1)
        call SkillUp(udg_temp_u, 'A008', 0)
      elseif ( udg_temp_ab == 'A020' ) then
        call DmgMagic(udg_temp_u, udg_temp_u2, MCri(MakeValue("150|In=*50|Se.*0.8", udg_temp_i) * MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A020'),udg_temp_i,1), udg_temp_i, 1, 2))
        call GetEffectLoc(udg_temp_u2, 2, 3)
        call TeraMana(udg_temp_u, udg_temp_i)
        call SkillUp(udg_temp_u, 'A020', 0)
      elseif ( udg_temp_ab == 'A021' ) then
        call DmgMagic(udg_temp_u, udg_temp_u2, MCri(MakeValue("150|In=*50|Se.*0.8", udg_temp_i) * MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A021'),udg_temp_i,1), udg_temp_i, 1, 3))
        call AduroStun(udg_temp_u2, udg_temp_i)
        call GetEffectUnit(udg_temp_u2, 3, 1)
        call SkillUp(udg_temp_u, 'A021', 0)
      elseif ( udg_temp_ab == 'A022' ) then
        call DmgMagic(udg_temp_u, udg_temp_u2, FlamoAdd(udg_temp_i, MakeValue("150|In=*50|Se.*0.8", udg_temp_i) * MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A022'),udg_temp_i,1), 1, 1))
        call SkillUp(udg_temp_u, 'A022', 0)
      endif
endfunction

//===========================================================================
function InitTrig_MQ1MTAPA008A020A021A022 takes nothing returns nothing
    set gg_trg_MQ1MTAPA008A020A021A022 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MQ1MTAPA008A020A021A022, function Trig_MQ1MTAPA008A020A021A022_Actions )
endfunction

//===========================================================================
// Trigger: MW1RentoA01O
//
// 0.2를 3, 타겟 에 저장시킴.
// 20% 더받는다는 말임.
// 그리고 저주 있음없음 ON/OFF 용도 하나 더
// 30~100%
// 60~130
//===========================================================================
function Trig_MW1RentoA01O_Actions takes nothing returns nothing
    call Curse(udg_temp_u, udg_temp_u2, (52.+(8.*I2R(GetUnitAbilityLevel(udg_temp_u,'A01O')))),1)
    call SkillUp(udg_temp_u, 'A01O', 15)
endfunction

//===========================================================================
function InitTrig_MW1RentoA01O takes nothing returns nothing
    set gg_trg_MW1RentoA01O = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MW1RentoA01O, function Trig_MW1RentoA01O_Actions )
endfunction

//===========================================================================
// Trigger: ME1SuperaA025A026A027A028
//
//     call DmgMagic(udg_temp_u, udg_temp_u2, )
// MCri(, udg_temp_i, 2, 4)
// EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) * BaseValue(25)
//===========================================================================
function Trig_ME1SuperaA025A026A027A028_Func006A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u, udg_temp_u2) > 360. ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
      call GetEffectUnit(udg_temp_u2, 1, 1)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(28)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
      call GetEffectUnit(udg_temp_u2, 1, 1)
      call SkillUp(udg_temp_u, 'A025', -20)
    call TriggerExecute( gg_trg_AutoReaction_iii )
    endif
endfunction

function Trig_ME1SuperaA025A026A027A028_Func012A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u, udg_temp_u2) > 360. ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
      call GetEffectUnit(udg_temp_u2, 2, 3)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(28)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
        call GetEffectLoc(udg_temp_u2, 2, 3)
        call SkillUp(udg_temp_u, 'A026', -20)
    call TriggerExecute( gg_trg_AutoReaction_iii )
    endif
endfunction

function Trig_ME1SuperaA025A026A027A028_Func015A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u, udg_temp_u2) > 360. ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
      call GetEffectUnit(udg_temp_u2, 3, 1)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(28)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
        call AduroStun(udg_temp_u2, udg_temp_i)
      call GetEffectUnit(udg_temp_u2, 3, 1)
        call SkillUp(udg_temp_u, 'A027', -20)
    call TriggerExecute( gg_trg_AutoReaction_iii )
    endif
endfunction

function Trig_ME1SuperaA025A026A027A028_Func018A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u, udg_temp_u2) > 360. ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
      call GetEffectUnit(udg_temp_u2, 4, 1)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(28)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
      call GetEffectUnit(udg_temp_u2, 4, 1)
        call SkillUp(udg_temp_u, 'A028', -20)
    call TriggerExecute( gg_trg_AutoReaction_iii )
    endif
endfunction

function Trig_ME1SuperaA025A026A027A028_Actions takes nothing returns nothing
    set udg_temp_g =                                    (GetGroupEnemy(CreateGroup(), udg_temp_u, RangeAdd(360.,udg_temp_i), Condition(function Range_Condi)))
    set udg_temp_b = false
    set udg_temp_r2 =                        (EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) * BaseValue(25))
      if ( udg_temp_ab == 'A025' ) then
    set udg_temp_r =                        (MCri(MakeValue("300|In=*50", udg_temp_i) * MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A025'),udg_temp_i,1), udg_temp_i, 2, 1))
    call ForGroupBJ( udg_temp_g, function Trig_ME1SuperaA025A026A027A028_Func006A )
      elseif ( udg_temp_ab == 'A026' ) then
        if ( TeraMana(udg_temp_u, udg_temp_i) ) then
    set udg_temp_r2 = ( udg_temp_r2 * ( 1 -                        (BaseValue(22)*udg_SysC_CriX[udg_temp_i]) ) )
        endif
    set udg_temp_r =                        (MCri(MakeValue("300|In=*50|Se.*0.8", udg_temp_i) * MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A026'),udg_temp_i,1), udg_temp_i, 2, 2))
    call ForGroupBJ( udg_temp_g, function Trig_ME1SuperaA025A026A027A028_Func012A )
      elseif ( udg_temp_ab == 'A027' ) then
    set udg_temp_r =                        (MCri(MakeValue("300|In=*50|Se.*0.8", udg_temp_i) * MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A027'),udg_temp_i,1), udg_temp_i, 2, 3))
    call ForGroupBJ( udg_temp_g, function Trig_ME1SuperaA025A026A027A028_Func015A )
      elseif ( udg_temp_ab == 'A028' ) then
    set udg_temp_r =                        (FlamoAdd(udg_temp_i, MakeValue("300|In=*50|Se.*0.8", udg_temp_i) * MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A028'),udg_temp_i,1), 2, 0))
    call ForGroupBJ( udg_temp_g, function Trig_ME1SuperaA025A026A027A028_Func018A )
      endif
    call DestroyGroup( udg_temp_g )
endfunction

//===========================================================================
function InitTrig_ME1SuperaA025A026A027A028 takes nothing returns nothing
    set gg_trg_ME1SuperaA025A026A027A028 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_ME1SuperaA025A026A027A028, function Trig_ME1SuperaA025A026A027A028_Actions )
endfunction

//===========================================================================
// Trigger: MF1VenomiA029
//===========================================================================
function Trig_MF1VenomiA029_Actions takes nothing returns nothing
    set udg_temp_i = GetConvertedPlayerId(GetOwningPlayer(udg_temp_u))
    if ( GetUnitAbilityLevel(udg_temp_u2, 'A08V') == 0 ) then
        if ( GetUnitAbilityLevel(udg_temp_u2, 'B007') > 0 ) then
    set udg_temp_r = 0.20
        else
    set udg_temp_r = 0.00
        endif
      if ( udg_temp_ab == 'A029' ) then
      call SkillUp(udg_temp_u, 'A029', 0)
        if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A029', 0.5+udg_temp_r, 1) ) then
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\Darksummoning\\DarkSummonTarget.mdl", udg_temp_u2, "origin") )
          call Fdmg(udg_temp_u, udg_temp_u2, MCri(MakeValue("100|In=^2|Se./5", udg_temp_i), udg_temp_i, 4, 5), .8, 15)
          set bj_lastCreatedUnit = CreateUnit(Player(udg_temp_i-1), 'e000', GetUnitX(udg_temp_u2), GetUnitY(udg_temp_u2), bj_UNIT_FACING)
    call SetUnitAbilityLevelSwapped( 'A01M', GetLastCreatedUnit(), 2 )
    call IssueTargetOrderById( GetLastCreatedUnit(), String2OrderIdBJ("cripple"), udg_temp_u2 )
        elseif ( GetRandomReal(0,100) <= SkillPer(udg_temp_u,udg_temp_i,0.5,3) ) then
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\Darksummoning\\DarkSummonTarget.mdl", udg_temp_u2, "origin") )
        call Fdmg(udg_temp_u, udg_temp_u2, MCri(MakeValue("100|In=^2|Se./5", udg_temp_i), udg_temp_i, 4, 5), .8, 15)
        set bj_lastCreatedUnit = CreateUnit(Player(udg_temp_i-1), 'e000', GetUnitX(udg_temp_u2), GetUnitY(udg_temp_u2), bj_UNIT_FACING)
    call SetUnitAbilityLevelSwapped( 'A01M', GetLastCreatedUnit(), 2 )
    call IssueTargetOrderById( GetLastCreatedUnit(), String2OrderIdBJ("cripple"), udg_temp_u2 )
        else
          call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
          call Bufftt(CreateTextTagUnitBJ("|cffff0080Miss !!|r", udg_temp_u2, -50., 12., 100., 100., 100., 20.), 10)
        endif
      else
        if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 0, 0.5+udg_temp_r, 3) ) then
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\Darksummoning\\DarkSummonTarget.mdl", udg_temp_u2, "origin") )
          call Fdmg(udg_temp_u, udg_temp_u2, MCri(MakeValue("100|In=^2|Se./5", udg_temp_i), udg_temp_i, 4, 5), .8, 15)
          set bj_lastCreatedUnit = CreateUnit(Player(udg_temp_i-1), 'e000', GetUnitX(udg_temp_u2), GetUnitY(udg_temp_u2), bj_UNIT_FACING)
    call SetUnitAbilityLevelSwapped( 'A01M', GetLastCreatedUnit(), 2 )
    call IssueTargetOrderById( GetLastCreatedUnit(), String2OrderIdBJ("cripple"), udg_temp_u2 )
        elseif ( GetRandomReal(0,100) <= SkillPer(udg_temp_u,udg_temp_i,0.5,3) ) then
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\Darksummoning\\DarkSummonTarget.mdl", udg_temp_u2, "origin") )
        call Fdmg(udg_temp_u, udg_temp_u2, MCri(MakeValue("100|In=^2|Se./5", udg_temp_i), udg_temp_i, 4, 5), .8, 15)
        set bj_lastCreatedUnit = CreateUnit(Player(udg_temp_i-1), 'e000', GetUnitX(udg_temp_u2), GetUnitY(udg_temp_u2), bj_UNIT_FACING)
    call SetUnitAbilityLevelSwapped( 'A01M', GetLastCreatedUnit(), 2 )
    call IssueTargetOrderById( GetLastCreatedUnit(), String2OrderIdBJ("cripple"), udg_temp_u2 )
        else
          call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
          call Bufftt(CreateTextTagUnitBJ("|cffff0080Miss !!|r", udg_temp_u2, -50., 12., 100., 100., 100., 20.), 10)
        endif
      endif
    else
      call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "해당 유닛은 면역입니다.")
      call Bufftt(CreateTextTagUnitBJ("|c00ff0080Immune !!|r", udg_temp_u2, -50., 12., 100., 100., 100., 20.), 10)
    endif
endfunction

//===========================================================================
function InitTrig_MF1VenomiA029 takes nothing returns nothing
    set gg_trg_MF1VenomiA029 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MF1VenomiA029, function Trig_MF1VenomiA029_Actions )
endfunction

//===========================================================================
// Trigger: MW2BardoA01V
//===========================================================================
function Trig_MW2BardoA01V_Actions takes nothing returns nothing
    call Curse(udg_temp_u, udg_temp_u2, (52.+(8.*I2R(GetUnitAbilityLevel(udg_temp_u,'A02A')))),2)
    call SkillUp(udg_temp_u, 'A01V', 10)
endfunction

//===========================================================================
function InitTrig_MW2BardoA01V takes nothing returns nothing
    set gg_trg_MW2BardoA01V = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MW2BardoA01V, function Trig_MW2BardoA01V_Actions )
endfunction

//===========================================================================
// Trigger: MQ2MTAPA02QA02WA02XA02Y
//===========================================================================
function Trig_MQ2MTAPA02QA02WA02XA02Y_Actions takes nothing returns nothing
    call ConditionalTriggerExecute( gg_trg_AutoReaction_iii )
      if ( udg_temp_ab == 'A02Q' ) then
        call DmgMagic(udg_temp_u, udg_temp_u2, MCri(MakeValue("1000|In=*100", udg_temp_i) * MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A02Q'),udg_temp_i,1), udg_temp_i, 1, 1))
        call GetEffectUnit(udg_temp_u2, 1, 2)
        call SkillUp(udg_temp_u, 'A02Q', 0)
      elseif ( udg_temp_ab == 'A02W' ) then
        call DmgMagic(udg_temp_u, udg_temp_u2, MCri(MakeValue("1000|In=*100|Set*0.8", udg_temp_i) * MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A02W'),udg_temp_i,1), udg_temp_i, 1, 2))
        call GetEffectLoc(udg_temp_u2, 2, 5)
        call TeraMana(udg_temp_u, udg_temp_i)
        call SkillUp(udg_temp_u, 'A02W', 0)
      elseif ( udg_temp_ab == 'A02X' ) then
        call DmgMagic(udg_temp_u, udg_temp_u2, MCri(MakeValue("1000|In=*100|Set*0.8", udg_temp_i) * MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A02X'),udg_temp_i,1), udg_temp_i, 1, 3))
        call AduroStun(udg_temp_u2, udg_temp_i)
        call GetEffectUnit(udg_temp_u2, 3, 1)
        call SkillUp(udg_temp_u, 'A02X', 0)
      elseif ( udg_temp_ab == 'A02Y' ) then
        call DmgMagic(udg_temp_u, udg_temp_u2, FlamoAdd(udg_temp_i, MakeValue("1000|In=*100|Set*0.8", udg_temp_i) * MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A02Y'),udg_temp_i,1), 1, 1))
        call SkillUp(udg_temp_u, 'A02Y', 0)
      endif
endfunction

//===========================================================================
function InitTrig_MQ2MTAPA02QA02WA02XA02Y takes nothing returns nothing
    set gg_trg_MQ2MTAPA02QA02WA02XA02Y = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MQ2MTAPA02QA02WA02XA02Y, function Trig_MQ2MTAPA02QA02WA02XA02Y_Actions )
endfunction

//===========================================================================
// Trigger: MRNarcolyA02T
//
// takes unit u, unit t
// 지속시간 10초 고정
//===========================================================================
function Trig_MRNarcolyA02T_Actions takes nothing returns nothing
    if ( udg_temp_ab == 'A02T' ) then
      call SkillUp(udg_temp_u, 'A02T', 0)
      call Narcoly(udg_temp_u, udg_temp_u2, 10.)
    else
      call Narcoly(udg_temp_u, udg_temp_u2, 10.)
    endif
endfunction

//===========================================================================
function InitTrig_MRNarcolyA02T takes nothing returns nothing
    set gg_trg_MRNarcolyA02T = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MRNarcolyA02T, function Trig_MRNarcolyA02T_Actions )
endfunction

//===========================================================================
// Trigger: ME2XTAPA043A044A045A046
//===========================================================================
function Trig_ME2XTAPA043A044A045A046_Func006A takes nothing returns nothing
    if ( Dis(udg_temp_u2, GetEnumUnit()) > 360. ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(28)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    endif
    call SkillUp(udg_temp_u, 'A043', -22.5)
    call GetEffectUnit(GetEnumUnit(), 1, 2)
endfunction

function Trig_ME2XTAPA043A044A045A046_Func012A takes nothing returns nothing
    if ( Dis(udg_temp_u2, GetEnumUnit()) > 360. ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(28)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    endif
    call SkillUp(udg_temp_u, 'A044', -22.5)
    call GetEffectLoc(GetEnumUnit(), 2, 2)
endfunction

function Trig_ME2XTAPA043A044A045A046_Func015A takes nothing returns nothing
    if ( Dis(udg_temp_u2, GetEnumUnit()) > 360. ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(28)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    endif
    call AduroStun(GetEnumUnit(), udg_temp_i)
    call SkillUp(udg_temp_u, 'A045', -22.5)
    call GetEffectUnit(GetEnumUnit(), 3, 2)
endfunction

function Trig_ME2XTAPA043A044A045A046_Func018A takes nothing returns nothing
    if ( Dis(udg_temp_u2, GetEnumUnit()) > 360. ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(28)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    endif
    call SkillUp(udg_temp_u, 'A046', -22.5)
    call GetEffectUnit(GetEnumUnit(), 4, 2)
endfunction

function Trig_ME2XTAPA043A044A045A046_Actions takes nothing returns nothing
    set udg_temp_g =                                    (GetGroupEnemy(CreateGroup(), udg_temp_u2, RangeAdd(360.,udg_temp_i), Condition(function Range_Condi)))
    set udg_temp_b = false
    set udg_temp_r2 =                        (EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) * BaseValue(25))
      if ( udg_temp_ab == 'A043' ) then
    set udg_temp_r =                        (MCri(MakeValue("1000|In=*100",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A043'),udg_temp_i,1), udg_temp_i, 2, 1))
    call ForGroupBJ( udg_temp_g, function Trig_ME2XTAPA043A044A045A046_Func006A )
    elseif ( udg_temp_ab == 'A044' ) then
        if ( TeraMana(udg_temp_u, udg_temp_i) ) then
    set udg_temp_r2 = ( udg_temp_r2 * ( 1 -                        (BaseValue(22)*udg_SysC_CriX[udg_temp_i]) ) )
        endif
    set udg_temp_r =                        (MCri(MakeValue("1000|In=*100|Set*0.8",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A044'),udg_temp_i,1), udg_temp_i, 2, 2))
    call ForGroupBJ( udg_temp_g, function Trig_ME2XTAPA043A044A045A046_Func012A )
      elseif ( udg_temp_ab == 'A045' ) then
    set udg_temp_r =                        (MCri(MakeValue("1000|In=*100|Set*0.8",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A045'),udg_temp_i,1), udg_temp_i, 2, 3))
    call ForGroupBJ( udg_temp_g, function Trig_ME2XTAPA043A044A045A046_Func015A )
      elseif ( udg_temp_ab == 'A046' ) then
    set udg_temp_r =                        (FlamoAdd(udg_temp_i, MakeValue("1000|In=*100|Set*0.8",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A046'),udg_temp_i,1), 2, 0))
    call ForGroupBJ( udg_temp_g, function Trig_ME2XTAPA043A044A045A046_Func018A )
      endif
    call TriggerExecute( gg_trg_AutoReaction_iii )
    call DestroyGroup( udg_temp_g )
endfunction

//===========================================================================
function InitTrig_ME2XTAPA043A044A045A046 takes nothing returns nothing
    set gg_trg_ME2XTAPA043A044A045A046 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_ME2XTAPA043A044A045A046, function Trig_ME2XTAPA043A044A045A046_Actions )
endfunction

//===========================================================================
// Trigger: MW3DeprecoA00J
//===========================================================================
function Trig_MW3DeprecoA00J_Actions takes nothing returns nothing
    call Curse(udg_temp_u, udg_temp_u2, (52.+(8.*I2R(GetUnitAbilityLevel(udg_temp_u,'A03I')))),3)
    call SkillUp(udg_temp_u, 'A00J', 5)
endfunction

//===========================================================================
function InitTrig_MW3DeprecoA00J takes nothing returns nothing
    set gg_trg_MW3DeprecoA00J = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MW3DeprecoA00J, function Trig_MW3DeprecoA00J_Actions )
endfunction

//===========================================================================
// Trigger: MQ3MTAPA03JA03LA03MA03N
//===========================================================================
function Trig_MQ3MTAPA03JA03LA03MA03N_Actions takes nothing returns nothing
    call ConditionalTriggerExecute( gg_trg_AutoReaction_iii )
      if ( udg_temp_ab == 'A03J' ) then
        call DmgMagic(udg_temp_u, udg_temp_u2, MCri(MakeValue("2000|In=*150",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A03J'),udg_temp_i,1), udg_temp_i, 1, 1))
        call GetEffectUnit(udg_temp_u2, 1, 3)
        call SkillUp(udg_temp_u, 'A03J', 0)
      elseif ( udg_temp_ab == 'A03L' ) then
        call DmgMagic(udg_temp_u, udg_temp_u2, MCri(MakeValue("2000|In=*150|Se *0.8",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A03L'),udg_temp_i,1), udg_temp_i, 1, 2))
        call GetEffectLoc(udg_temp_u2, 2, 6)
        call TeraMana(udg_temp_u, udg_temp_i)
        call SkillUp(udg_temp_u, 'A03L', 0)
      elseif ( udg_temp_ab == 'A03M' ) then
        call DmgMagic(udg_temp_u, udg_temp_u2, MCri(MakeValue("2000|In=*150|Se *0.8",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A03M'),udg_temp_i,1), udg_temp_i, 1, 3))
        call AduroStun(udg_temp_u2, udg_temp_i)
        call GetEffectUnit(udg_temp_u2, 3, 2)
        call SkillUp(udg_temp_u, 'A03M', 0)
      elseif ( udg_temp_ab == 'A03N' ) then
        call DmgMagic(udg_temp_u, udg_temp_u2, FlamoAdd(udg_temp_i, MakeValue("2000|In=*150|Se *0.8",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A03N'),udg_temp_i,1), 1, 2))
        call SkillUp(udg_temp_u, 'A03N', 0)
      endif
endfunction

//===========================================================================
function InitTrig_MQ3MTAPA03JA03LA03MA03N takes nothing returns nothing
    set gg_trg_MQ3MTAPA03JA03LA03MA03N = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MQ3MTAPA03JA03LA03MA03N, function Trig_MQ3MTAPA03JA03LA03MA03N_Actions )
endfunction

//===========================================================================
// Trigger: MF2WISorumaDA07M
//===========================================================================
function Trig_MF2WISorumaDA07M_Actions takes nothing returns nothing
    if ( GetUnitAbilityLevel(udg_temp_u2, 'A08V') == 0 ) then
      if ( udg_temp_ab == 'A07M' ) then
      call SkillUp(udg_temp_u, 'A07O', 0)
        if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A07O', 0.7, 1) ) then
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\Darksummoning\\DarkSummonTarget.mdl", udg_temp_u2, "origin") )
          if ( ISBOSS(GetUnitTypeId(udg_temp_u2)) > 0 ) then
            call Dummier(Player(udg_temp_i-1),udg_temp_u2,-1,'A004',"thunderbolt")
          else
            call Dummier(Player(udg_temp_i-1),udg_temp_u2,-1,'A01Q',"thunderbolt")
          endif
          call TimeAction(udg_temp_u2, 2, 8)
        endif
      elseif ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, udg_temp_i, 0.7, 3) ) then
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\Darksummoning\\DarkSummonTarget.mdl", udg_temp_u2, "origin") )
        call Dummier(Player(udg_temp_i-1),udg_temp_u2,-1,'A01Q',"thunderbolt")
        call TimeAction(udg_temp_u2, 2, 8)
      else
        call MSG(Player(udg_temp_i-1), 1, 2, "실패했습니다.")
        call Bufftt(CreateTextTagUnitBJ("|c00ff0080Miss !!|r", udg_temp_u2, -50., 12., 100., 100., 100., 20.), 10)
      endif
    else
      call MSG(Player(udg_temp_i-1), 1, 2, "해당 유닛은 결빙에 면역입니다.")
      call Bufftt(CreateTextTagUnitBJ("|c00ff0080면역 !!|r", udg_temp_u2, -50., 12., 100., 100., 100., 20.), 10)
    endif
endfunction

//===========================================================================
function InitTrig_MF2WISorumaDA07M takes nothing returns nothing
    set gg_trg_MF2WISorumaDA07M = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MF2WISorumaDA07M, function Trig_MF2WISorumaDA07M_Actions )
endfunction

//===========================================================================
// Trigger: MT1TAPA063A066A067A068
//
// 9.375% 강화
//===========================================================================
function Trig_MT1TAPA063A066A067A068_Func006A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u, udg_temp_u2) > 720. ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
      call GetEffectUnit(udg_temp_u2, 1, 2)
      call GetEffectUnit(udg_temp_u2, 1, 1)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(3)) )
      call GetEffectUnit(udg_temp_u2, 1, 2)
      call GetEffectLoc(udg_temp_u2, 1, 1)
      call SkillUp(udg_temp_u, 'A063', -20)
    call TriggerExecute( gg_trg_AutoReaction_iii )
    endif
endfunction

function Trig_MT1TAPA063A066A067A068_Func012A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u, udg_temp_u2) > 720. ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
      call GetEffectLoc(udg_temp_u2, 2, 3)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(3)) )
        call GetEffectLoc(udg_temp_u2, 2, 3)
        call SkillUp(udg_temp_u, 'A066', -20)
    call TriggerExecute( gg_trg_AutoReaction_iii )
    endif
endfunction

function Trig_MT1TAPA063A066A067A068_Func015A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u, udg_temp_u2) > 720. ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
        call GetEffectUnit(udg_temp_u2, 3, 2)
        call GetEffectLoc(udg_temp_u2, 3, 1)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(3)) )
        call AduroStun(udg_temp_u2, udg_temp_i)
        call GetEffectUnit(udg_temp_u2, 3, 2)
        call GetEffectLoc(udg_temp_u2, 3, 1)
        call SkillUp(udg_temp_u, 'A067', -20)
    call TriggerExecute( gg_trg_AutoReaction_iii )
    endif
endfunction

function Trig_MT1TAPA063A066A067A068_Func018A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u, udg_temp_u2) > 720. ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
        call GetEffectUnit(udg_temp_u2, 4, 3)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(3)) )
        call GetEffectUnit(udg_temp_u2, 4, 3)
        call SkillUp(udg_temp_u, 'A068', -20)
    call TriggerExecute( gg_trg_AutoReaction_iii )
    endif
endfunction

function Trig_MT1TAPA063A066A067A068_Actions takes nothing returns nothing
    set udg_temp_g =                                    (GetGroupEnemy(CreateGroup(), udg_temp_u, RangeAdd(720.,udg_temp_i), Condition(function Range_Condi)))
    set udg_temp_b = false
    set udg_temp_r2 =                        (EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) * BaseValue(25))
      if ( udg_temp_ab == 'A063' ) then
    set udg_temp_r =                        (MCri(MakeValue("2000|In=*150",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A063'),udg_temp_i,1), udg_temp_i, 3, 1))
    call ForGroupBJ( udg_temp_g, function Trig_MT1TAPA063A066A067A068_Func006A )
      elseif ( udg_temp_ab == 'A066' ) then
        if ( TeraMana(udg_temp_u, udg_temp_i) ) then
    set udg_temp_r2 = ( udg_temp_r2 * ( 1 -                        (BaseValue(22)*udg_SysC_CriX[udg_temp_i]) ) )
        endif
    set udg_temp_r =                        (MCri(MakeValue("2000|In=*150|Se *0.8",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A066'),udg_temp_i,1), udg_temp_i, 3, 2))
    call ForGroupBJ( udg_temp_g, function Trig_MT1TAPA063A066A067A068_Func012A )
      elseif ( udg_temp_ab == 'A067' ) then
    set udg_temp_r =                        (MCri(MakeValue("2000|In=*150|Se *0.8",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A067'),udg_temp_i,1), udg_temp_i, 3, 3))
    call ForGroupBJ( udg_temp_g, function Trig_MT1TAPA063A066A067A068_Func015A )
      elseif ( udg_temp_ab == 'A068' ) then
    set udg_temp_r =                        (FlamoAdd(udg_temp_i, MakeValue("2000|In=*150|Se *0.8",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A068'),udg_temp_i,1), 3, 0))
    call ForGroupBJ( udg_temp_g, function Trig_MT1TAPA063A066A067A068_Func018A )
      endif
    call DestroyGroup( udg_temp_g )
    set udg_temp_u2 = null
endfunction

//===========================================================================
function InitTrig_MT1TAPA063A066A067A068 takes nothing returns nothing
    set gg_trg_MT1TAPA063A066A067A068 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MT1TAPA063A066A067A068, function Trig_MT1TAPA063A066A067A068_Actions )
endfunction

//===========================================================================
// Trigger: MW4PraboA00ZA098
//
// udg_temp_u
//===========================================================================
function Trig_MW4PraboA00ZA098_Actions takes nothing returns nothing
    if ( udg_temp_ab == 'A00Z' ) then
      call Curse(udg_temp_u, udg_temp_u2, (52.+(8.*I2R(GetUnitAbilityLevel(udg_temp_u,'A04F')))),4)
      call SkillUp(udg_temp_u, 'A00Z', 0)
    else
      call Curse(udg_temp_u, udg_temp_u2, 130., 4)
    endif
endfunction

//===========================================================================
function InitTrig_MW4PraboA00ZA098 takes nothing returns nothing
    set gg_trg_MW4PraboA00ZA098 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MW4PraboA00ZA098, function Trig_MW4PraboA00ZA098_Actions )
endfunction

//===========================================================================
// Trigger: MF3DeathA07Q
//===========================================================================
function Trig_MF3DeathA07Q_Actions takes nothing returns nothing
      if ( GetItemTypeId(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(udg_temp_i)), 1)) == 'I084' ) then
    set udg_temp_r = 4.00
      elseif ( GetItemTypeId(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(udg_temp_i)), 1)) == 'I085' ) then
    set udg_temp_r = 4.00
      else
    set udg_temp_r = 1.00
      endif
        if ( GetUnitAbilityLevel(udg_temp_u2, 'B007') > 0 ) then
    set udg_temp_r = ( udg_temp_r * 1.40 )
        endif
    if ( udg_temp_ab == 'A07Q' ) then
      call SkillUp(udg_temp_u, 'A07R', -15)
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A07R', .04*udg_temp_r, 1) ) then
        if ( GetItemTypeId(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(udg_temp_i)), 1)) == 'I084' ) then
          call MSG(Player(udg_temp_i-1), 1, 4, "데스의 제물로 엑스쿠라눔이 소모되었습니다.")
          call MinusItem(udg_temp_i, 'I084', 1)
        elseif ( GetItemTypeId(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(udg_temp_i)), 1)) == 'I085' ) then
          if ( GetRandomReal(0.,100.) <= 33. ) then
            call MSG(Player(udg_temp_i-1), 1, 4, "데스의 제물로 알 수 없는 액체가 소모되었습니다.")
            call MinusItem(udg_temp_i, 'I085', 1)
          else
            call MSG(Player(udg_temp_i-1), 1, 4, "알 수 없는 액체가 빛이 납니다.")
          endif
        endif
    // [ 상대 체력값 * 0~(마나/25000) ] * 4회 // 크리 뜰 수 있음.
    call Fdmg( udg_temp_u, udg_temp_u2,                        (MCri( GetWidgetLife(udg_temp_u2)*GetRandomReal(.1, GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u)/35000.), udg_temp_i, 1, 5)), 4.00, 4 )
        set bj_lastCreatedUnit = CreateUnit(Player(udg_temp_i-1), 'e000', GetWidgetX(udg_temp_u2), GetWidgetY(udg_temp_u2), bj_UNIT_FACING)
    call SetUnitAbilityLevelSwapped( 'A01M', GetLastCreatedUnit(), 3 )
    call IssueTargetOrderById( GetLastCreatedUnit(), String2OrderIdBJ("cripple"), udg_temp_u2 )
        set bj_lastCreatedUnit = CreateUnit(Player(udg_temp_i-1), 'e00Z', GetWidgetX(udg_temp_u2), GetWidgetY(udg_temp_u2), bj_UNIT_FACING)
    call SetUnitFlyHeightBJ( GetLastCreatedUnit(), -200.00, 200.00 )
      else
        call MSG(Player(udg_temp_i-1), 1, 2, "실패했습니다.")
        call Bufftt(CreateTextTagUnitBJ("|c00ff0080Miss !!|r", udg_temp_u2, -50., 12., 100., 100., 100., 20.), 10)
      endif
    elseif ( GetRandomReal(0,100) <=  SkillPer(null, udg_temp_i, .04*udg_temp_r, 3) ) then
      if ( GetItemTypeId(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(udg_temp_i)), 1)) == 'I084' ) then
        call MSG(Player(udg_temp_i-1), 1, 4, "데스의 제물로 엑스쿠라눔이 소모되었습니다.")
        call MinusItem(udg_temp_i, 'I084', 1)
      elseif ( GetItemTypeId(LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(udg_temp_i)), 1)) == 'I085' ) then
        if ( GetRandomReal(0.,100.) <= 33. ) then
          call MSG(Player(udg_temp_i-1), 1, 4, "데스의 제물로 알 수 없는 액체가 소모되었습니다.")
          call MinusItem(udg_temp_i, 'I085', 1)
        else
          call MSG(Player(udg_temp_i-1), 1, 4, "알 수 없는 액체가 빛이 납니다.")
        endif
      endif
    // [ 상대 체력값 * 0~(마나/25000) ] * 4회 // 크리 뜰 수 있음.
    call Fdmg( udg_temp_u, udg_temp_u2,                        (MCri( GetWidgetLife(udg_temp_u2)*GetRandomReal(.1, GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u)/35000.), udg_temp_i, 1, 5)), 4.00, 4 )
      set bj_lastCreatedUnit = CreateUnit(Player(udg_temp_i-1), 'e000', GetWidgetX(udg_temp_u2), GetWidgetY(udg_temp_u2), bj_UNIT_FACING)
    call SetUnitAbilityLevelSwapped( 'A01M', GetLastCreatedUnit(), 3 )
    call IssueTargetOrderById( GetLastCreatedUnit(), String2OrderIdBJ("cripple"), udg_temp_u2 )
      set bj_lastCreatedUnit = CreateUnit(Player(udg_temp_i-1), 'e00Z', GetWidgetX(udg_temp_u2), GetWidgetY(udg_temp_u2), bj_UNIT_FACING)
    call SetUnitFlyHeightBJ( GetLastCreatedUnit(), -200.00, 200.00 )
    else
      call MSG(Player(udg_temp_i-1), 1, 2, "실패했습니다.")
      call Bufftt(CreateTextTagUnitBJ("|c00ff0080Miss !!|r", udg_temp_u2, -50., 12., 100., 100., 100., 20.), 10)
    endif
endfunction

//===========================================================================
function InitTrig_MF3DeathA07Q takes nothing returns nothing
    set gg_trg_MF3DeathA07Q = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MF3DeathA07Q, function Trig_MF3DeathA07Q_Actions )
endfunction

//===========================================================================
// Trigger: MQ4QWERA07AA08IA08JA08K
//
//     call DmgMagic(udg_temp_u, udg_temp_u2, MCri(MakeValue("-6000|In=*300|Se *1.25",udg_temp_i), udg_temp_i, 1, 1))
//===========================================================================
function Trig_MQ4QWERA07AA08IA08JA08K_Actions takes nothing returns nothing
    call ConditionalTriggerExecute( gg_trg_AutoReaction_iii )
      if  ( udg_temp_ab == 'A08I' ) then
        call DmgMagic(udg_temp_u, udg_temp_u2, MCri(MakeValue("3000|In=*200",udg_temp_i), udg_temp_i, 1, 2))
        call GetEffectLoc(udg_temp_u2, 2, 5)
        call TeraMana(udg_temp_u, udg_temp_i)
      elseif  ( udg_temp_ab == 'A08J' ) then
        call DmgMagic(udg_temp_u, udg_temp_u2, MCri(MakeValue("3000|In=*200",udg_temp_i), udg_temp_i, 1, 3))
        call AduroStun(udg_temp_u2, udg_temp_i)
        call GetEffectUnit(udg_temp_u2, 3, 3)
      elseif  ( udg_temp_ab == 'A08K' ) then
        call DmgMagic(udg_temp_u, udg_temp_u2, FlamoAdd(udg_temp_i, MakeValue("3000|In=*200",udg_temp_i), 1, 2))
      else
        call DmgMagic(udg_temp_u, udg_temp_u2, MCri(MakeValue("3000|In=*200|Se *1.25",udg_temp_i), udg_temp_i, 1, 1))
        call GetEffectUnit(udg_temp_u2, 1, 3)
      endif
endfunction

//===========================================================================
function InitTrig_MQ4QWERA07AA08IA08JA08K takes nothing returns nothing
    set gg_trg_MQ4QWERA07AA08IA08JA08K = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MQ4QWERA07AA08IA08JA08K, function Trig_MQ4QWERA07AA08IA08JA08K_Actions )
endfunction

//===========================================================================
// Trigger: MQ4ASemeliaA079
//===========================================================================
function Trig_MQ4ASemeliaA079_Actions takes nothing returns nothing
    if ( udg_temp_ab == 'A079' ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, MCri(MakeValue("-50500|Mp-*20|In=*500|Po-",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A076'),udg_temp_i,1), udg_temp_i, 1, 6))
    call SetUnitManaBJ( udg_temp_u, 0 )
      call GetEffectLoc(udg_temp_u2, 7, 3)
    call ConditionalTriggerExecute( gg_trg_AutoReaction_iii )
      call SkillUp(udg_temp_u, 'A076', -10)
      call TimeAction(udg_temp_u2, 0, 8)
    else
      call DmgMagic(udg_temp_u, udg_temp_u2, MCri(MakeValue("-50500|Mp-*20|In=*500|Po-",udg_temp_i)*MakeValue2(0,udg_temp_i,2), udg_temp_i, 1, 6))
    call SetUnitManaBJ( udg_temp_u, 0 )
      call GetEffectLoc(udg_temp_u2, 7, 3)
    call ConditionalTriggerExecute( gg_trg_AutoReaction_iii )
      call TimeAction(udg_temp_u2, 0, 8)
    endif
endfunction

//===========================================================================
function InitTrig_MQ4ASemeliaA079 takes nothing returns nothing
    set gg_trg_MQ4ASemeliaA079 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MQ4ASemeliaA079, function Trig_MQ4ASemeliaA079_Actions )
endfunction

//===========================================================================
// Trigger: ME3QWERA08BA08CA08DA08E
//===========================================================================
function Trig_ME3QWERA08BA08CA08DA08E_Func009A takes nothing returns nothing
    if ( Dis(udg_temp_u2, GetEnumUnit()) > 360. ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(28)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    endif
    call GetEffectLoc(GetEnumUnit(), 2, 3)
endfunction

function Trig_ME3QWERA08BA08CA08DA08E_Func012A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u2, GetEnumUnit()) > 360. ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(28)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    endif
    call AduroStun(GetEnumUnit(), udg_temp_i)
    call GetEffectUnit(GetEnumUnit(), 3, 3)
    call GetEffectLoc(GetEnumUnit(), 3, 1)
endfunction

function Trig_ME3QWERA08BA08CA08DA08E_Func015A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u2, GetEnumUnit()) > 360. ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(28)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    call TriggerExecute( gg_trg_AutoReaction_iii )
    endif
    call GetEffectUnit(GetEnumUnit(), 4, 3)
endfunction

function Trig_ME3QWERA08BA08CA08DA08E_Func018A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u2, GetEnumUnit()) > 360. ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(28)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    endif
    call GetEffectUnit(GetEnumUnit(), 1, 3)
    call GetEffectUnit(GetEnumUnit(), 1, 1)
endfunction

function Trig_ME3QWERA08BA08CA08DA08E_Actions takes nothing returns nothing
    set udg_temp_g =                                    (GetGroupEnemy(CreateGroup(), udg_temp_u2, RangeAdd(360.,udg_temp_i), Condition(function Range_Condi)))
    set udg_temp_b = false
    set udg_temp_r2 =                        (EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) * BaseValue(25))
      if ( udg_temp_ab == 'A08C' ) then
        if ( TeraMana(udg_temp_u, udg_temp_i) ) then
    set udg_temp_r2 = ( udg_temp_r2 * ( 1 -                        (BaseValue(22)*udg_SysC_CriX[udg_temp_i]) ) )
        endif
    set udg_temp_r =                        (MCri(MakeValue("1000|In=*100",udg_temp_i), udg_temp_i, 2, 2))
    call ForGroupBJ( udg_temp_g, function Trig_ME3QWERA08BA08CA08DA08E_Func009A )
      elseif ( udg_temp_ab == 'A08D' ) then
    set udg_temp_r =                        (MCri(MakeValue("1000|In=*100",udg_temp_i), udg_temp_i, 2, 3))
    call ForGroupBJ( udg_temp_g, function Trig_ME3QWERA08BA08CA08DA08E_Func012A )
      elseif ( udg_temp_ab == 'A08E' ) then
    set udg_temp_r =                        (FlamoAdd(udg_temp_i, MakeValue("1000|In=*100",udg_temp_i), 2, 0))
    call ForGroupBJ( udg_temp_g, function Trig_ME3QWERA08BA08CA08DA08E_Func015A )
      else
    set udg_temp_r =                        (MCri(MakeValue("1000|In=*100|Se *1.25",udg_temp_i), udg_temp_i, 2, 1))
    call ForGroupBJ( udg_temp_g, function Trig_ME3QWERA08BA08CA08DA08E_Func018A )
      endif
    call TriggerExecute( gg_trg_AutoReaction_iii )
    call DestroyGroup( udg_temp_g )
endfunction

//===========================================================================
function InitTrig_ME3QWERA08BA08CA08DA08E takes nothing returns nothing
    set gg_trg_ME3QWERA08BA08CA08DA08E = CreateTrigger(  )
    call TriggerAddAction( gg_trg_ME3QWERA08BA08CA08DA08E, function Trig_ME3QWERA08BA08CA08DA08E_Actions )
endfunction

//===========================================================================
// Trigger: ME3AIAmagetdonA08F
//===========================================================================
function Trig_ME3AIAmagetdonA08F_Func006A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u, udg_temp_u2) > 360. ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
      call GetEffectLoc(udg_temp_u2, 7, 3)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(28)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
      call GetEffectLoc(udg_temp_u2, 7, 3)
    call TriggerExecute( gg_trg_AutoReaction_iii )
    endif
    call SkillUp(udg_temp_u, 'A077', -26)
endfunction

function Trig_ME3AIAmagetdonA08F_Func009A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u, udg_temp_u2) > 360. ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
      call GetEffectLoc(udg_temp_u2, 7, 3)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(28)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
      call GetEffectLoc(udg_temp_u2, 7, 3)
    call TriggerExecute( gg_trg_AutoReaction_iii )
    endif
endfunction

function Trig_ME3AIAmagetdonA08F_Actions takes nothing returns nothing
    set udg_temp_g =                                    (GetGroupEnemy(CreateGroup(), udg_temp_u, RangeAdd(360.,udg_temp_i), Condition(function Range_Condi)))
    set udg_temp_b = false
    set udg_temp_r2 =                        (EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) * BaseValue(25))
    if ( udg_temp_ab == 'A08F' ) then
    set udg_temp_r =                        (RMaxBJ(100, MCri(MakeValue("-20400|Mp-*15|In=*200|Po+",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A077'),udg_temp_i,1), udg_temp_i, 2, 6)))
    call ForGroupBJ( udg_temp_g, function Trig_ME3AIAmagetdonA08F_Func006A )
    else
    set udg_temp_r =                        (RMaxBJ(100, MCri(MakeValue("-20400|Mp-*15|In=*200|Po+",udg_temp_i), udg_temp_i, 2, 6)))
    call ForGroupBJ( udg_temp_g, function Trig_ME3AIAmagetdonA08F_Func009A )
    endif
    call SetUnitManaBJ( udg_temp_u, 0.00 )
    call DestroyGroup( udg_temp_g )
endfunction

//===========================================================================
function InitTrig_ME3AIAmagetdonA08F takes nothing returns nothing
    set gg_trg_ME3AIAmagetdonA08F = CreateTrigger(  )
    call TriggerAddAction( gg_trg_ME3AIAmagetdonA08F, function Trig_ME3AIAmagetdonA08F_Actions )
endfunction

//===========================================================================
// Trigger: ME4SSoommastellaA08G
//
// udg_temp_u2 = 
//===========================================================================
function Trig_ME4SSoommastellaA08G_Func006A takes nothing returns nothing
    if ( Dis(udg_temp_u2, GetEnumUnit()) > 360. ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(28)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    endif
    call GetEffectLoc(GetEnumUnit(), 7, 3)
    call SkillUp(udg_temp_u, 'A078', -28.75)
endfunction

function Trig_ME4SSoommastellaA08G_Func010A takes nothing returns nothing
    if ( Dis(udg_temp_u2, GetEnumUnit()) > 360. ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(28)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, GetEnumUnit(), udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    endif
    call GetEffectLoc(GetEnumUnit(), 7, 3)
endfunction

function Trig_ME4SSoommastellaA08G_Actions takes nothing returns nothing
    set udg_temp_g =                                    (GetGroupEnemy(CreateGroup(), udg_temp_u2, RangeAdd(360.,udg_temp_i), Condition(function Range_Condi)))
    set udg_temp_b = false
    if ( udg_temp_ab == 'A08G' ) then
    set udg_temp_r =                        (RMaxBJ(100, MCri(MakeValue("-20600|Mp-*15|In=*200|Po+",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A078'),udg_temp_i,1), udg_temp_i, 2, 6)))
    set udg_temp_r2 =                        (EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) * BaseValue(25))
    call ForGroupBJ( udg_temp_g, function Trig_ME4SSoommastellaA08G_Func006A )
    else
    set udg_temp_r =                        (RMaxBJ(100, MCri(MakeValue("-20600|Mp-*15|In=*200|Po+",udg_temp_i)*MakeValue2(0,udg_temp_i,2), udg_temp_i, 2, 6)))
    set udg_temp_r2 =                        (EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) * BaseValue(25))
    call ForGroupBJ( udg_temp_g, function Trig_ME4SSoommastellaA08G_Func010A )
    endif
    call TriggerExecute( gg_trg_AutoReaction_iii )
    call SetUnitManaBJ( udg_temp_u, 0.00 )
    call DestroyGroup( udg_temp_g )
endfunction

//===========================================================================
function InitTrig_ME4SSoommastellaA08G takes nothing returns nothing
    set gg_trg_ME4SSoommastellaA08G = CreateTrigger(  )
    call TriggerAddAction( gg_trg_ME4SSoommastellaA08G, function Trig_ME4SSoommastellaA08G_Actions )
endfunction

//===========================================================================
// Trigger: MT2QWERA086A087A088A089
//===========================================================================
function Trig_MT2QWERA086A087A088A089_Func009A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u, udg_temp_u2) > 720. ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
      call GetEffectLoc(udg_temp_u2, 2, 4)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
      call GetEffectLoc(udg_temp_u2, 2, 4)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(3)) )
    call TriggerExecute( gg_trg_AutoReaction_iii )
    endif
endfunction

function Trig_MT2QWERA086A087A088A089_Func012A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u, udg_temp_u2) > 720. ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
        call GetEffectUnit(udg_temp_u2, 3, 2)
        call GetEffectLoc(udg_temp_u2, 3, 1)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(3)) )
        call AduroStun(udg_temp_u2, udg_temp_i)
        call GetEffectUnit(udg_temp_u2, 3, 2)
        call GetEffectLoc(udg_temp_u2, 3, 1)
    call TriggerExecute( gg_trg_AutoReaction_iii )
    endif
endfunction

function Trig_MT2QWERA086A087A088A089_Func015A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u, udg_temp_u2) > 720. ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
      call GetEffectUnit(udg_temp_u2, 4, 3)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(3)) )
      call GetEffectUnit(udg_temp_u2, 4, 3)
    call TriggerExecute( gg_trg_AutoReaction_iii )
    endif
endfunction

function Trig_MT2QWERA086A087A088A089_Func018A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u, udg_temp_u2) > 720. ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
        call GetEffectUnit(udg_temp_u2, 1, 3)
        call GetEffectLoc(udg_temp_u2, 1, 1)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(3)) )
        call GetEffectUnit(udg_temp_u2, 1, 3)
        call GetEffectLoc(udg_temp_u2, 1, 1)
    call TriggerExecute( gg_trg_AutoReaction_iii )
    endif
endfunction

function Trig_MT2QWERA086A087A088A089_Actions takes nothing returns nothing
    set udg_temp_g =                                    (GetGroupEnemy(CreateGroup(), udg_temp_u, RangeAdd(720.,udg_temp_i), Condition(function Range_Condi)))
    set udg_temp_b = false
    set udg_temp_r2 =                        (EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) * BaseValue(25))
      if ( udg_temp_ab == 'A087' ) then
        if ( TeraMana(udg_temp_u, udg_temp_i) ) then
    set udg_temp_r2 = ( udg_temp_r2 * ( 1 -                        (BaseValue(22)*udg_SysC_CriX[udg_temp_i]) ) )
        endif
    set udg_temp_r =                        (MCri(MakeValue("3000|In=*200",udg_temp_i), udg_temp_i, 3, 2))
    call ForGroupBJ( udg_temp_g, function Trig_MT2QWERA086A087A088A089_Func009A )
      elseif ( udg_temp_ab == 'A088' ) then
    set udg_temp_r =                        (MCri(MakeValue("3000|In=*200",udg_temp_i), udg_temp_i, 3, 3))
    call ForGroupBJ( udg_temp_g, function Trig_MT2QWERA086A087A088A089_Func012A )
      elseif ( udg_temp_ab == 'A089' ) then
    set udg_temp_r =                        (FlamoAdd(udg_temp_i, MakeValue("3000|In=*200",udg_temp_i), 3, 0))
    call ForGroupBJ( udg_temp_g, function Trig_MT2QWERA086A087A088A089_Func015A )
      else
    set udg_temp_r =                        (MCri(MakeValue("3000|In=*200|Se *1.25",udg_temp_i), udg_temp_i, 3, 1))
    call ForGroupBJ( udg_temp_g, function Trig_MT2QWERA086A087A088A089_Func018A )
      endif
    call DestroyGroup( udg_temp_g )
endfunction

//===========================================================================
function InitTrig_MT2QWERA086A087A088A089 takes nothing returns nothing
    set gg_trg_MT2QWERA086A087A088A089 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MT2QWERA086A087A088A089, function Trig_MT2QWERA086A087A088A089_Actions )
endfunction

//===========================================================================
// Trigger: MT2AIRagnarokA08A A09E A03I
//
// RMaxBJ(100, MCri(MakeValue("-78000|Mp-*15|Po+",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A01P'),udg_temp_i,1), udg_temp_i, 3, 6))
//===========================================================================
function Trig_MT2AIRagnarokA08A_A09E_A03I_Func006A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u, udg_temp_u2) > 720. ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
      call GetEffectLoc(udg_temp_u2, 7, 3)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(3)) )
      call GetEffectLoc(udg_temp_u2, 7, 3)
    call TriggerExecute( gg_trg_AutoReaction_iii )
    endif
    call SkillUp(udg_temp_u, 'A01P', -29.5)
endfunction

function Trig_MT2AIRagnarokA08A_A09E_A03I_Func010A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u, udg_temp_u2) > 720. ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
      call GetEffectLoc(udg_temp_u2, 7, 3)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(3)) )
      call GetEffectLoc(udg_temp_u2, 7, 3)
    call TriggerExecute( gg_trg_AutoReaction_iii )
    endif
endfunction

function Trig_MT2AIRagnarokA08A_A09E_A03I_Actions takes nothing returns nothing
    set udg_temp_g =                                    (GetGroupEnemy(CreateGroup(), udg_temp_u, RangeAdd(720.,udg_temp_i), Condition(function Range_Condi)))
    set udg_temp_b = false
    if ( udg_temp_ab == 'A08A' ) then
    set udg_temp_r =                        (RMaxBJ(100, MCri(MakeValue("-3000|Mp-*15|Po+",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A01P'),udg_temp_i,1), udg_temp_i, 3, 6)))
    set udg_temp_r2 =                        (EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) * BaseValue(25))
    call ForGroupBJ( udg_temp_g, function Trig_MT2AIRagnarokA08A_A09E_A03I_Func006A )
    else
    set udg_temp_r =                        (RMaxBJ(100, MCri(MakeValue("-3000|Mp-*15|Po+",udg_temp_i)*MakeValue2(0,udg_temp_i,2), udg_temp_i, 3, 6)))
    set udg_temp_r2 =                        (EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) * BaseValue(25))
    call ForGroupBJ( udg_temp_g, function Trig_MT2AIRagnarokA08A_A09E_A03I_Func010A )
    endif
    call SetUnitManaBJ( udg_temp_u, 0.00 )
    call DestroyGroup( udg_temp_g )
endfunction

//===========================================================================
function InitTrig_MT2AIRagnarokA08A_A09E_A03I takes nothing returns nothing
    set gg_trg_MT2AIRagnarokA08A_A09E_A03I = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MT2AIRagnarokA08A_A09E_A03I, function Trig_MT2AIRagnarokA08A_A09E_A03I_Actions )
endfunction

//===========================================================================
// Trigger: MT3SIMeteorA05T
//===========================================================================
function Trig_MT3SIMeteorA05T_Func006A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u, udg_temp_u2) > 720. ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
      call GetEffectLoc(udg_temp_u2, 6, 1)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(3)) )
      call GetEffectLoc(udg_temp_u2, 6, 1)
      call SkillUp(udg_temp_u, 'A04F', -29.5)
    call TriggerExecute( gg_trg_AutoReaction_iii )
    endif
endfunction

function Trig_MT3SIMeteorA05T_Actions takes nothing returns nothing
    set udg_temp_g =                                    (GetGroupEnemy(CreateGroup(), udg_temp_u, RangeAdd(720.,udg_temp_i), Condition(function Range_Condi)))
    set udg_temp_b = false
    set udg_temp_r =                        (RMaxBJ(100, MCri(MakeValue("-5000|Mp-*20|Po+",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A04F'),udg_temp_i,1), udg_temp_i, 3, 6)))
    set udg_temp_r2 =                        (EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) * BaseValue(25))
    call TimeAction(udg_temp_u, 30., 25)
    call ForGroupBJ( udg_temp_g, function Trig_MT3SIMeteorA05T_Func006A )
    call SetUnitManaBJ( udg_temp_u, 0.00 )
    call DestroyGroup( udg_temp_g )
endfunction

//===========================================================================
function InitTrig_MT3SIMeteorA05T takes nothing returns nothing
    set gg_trg_MT3SIMeteorA05T = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MT3SIMeteorA05T, function Trig_MT3SIMeteorA05T_Actions )
endfunction

//===========================================================================
// Trigger: MQCuroA00V
//===========================================================================
function Trig_MQCuroA00V_Actions takes nothing returns nothing
    set udg_temp_i = GetConvertedPlayerId(GetOwningPlayer(udg_temp_u))
    set udg_temp_r =                        (RMinBJ(GetHPLimit(true), MakeValue("150|Wi=*5|Mp+*0.05|He-",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A00V'),udg_temp_i,5)))
    call GetEffectUnit(udg_temp_u2, 5, GetRandomInt(1,2))
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) *                        (BaseValue(23)) ) ) )
    call SetUnitLifeBJ( udg_temp_u2, ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_temp_u2) + udg_temp_r ) )
    call DmgText_View("H", false, GetWidgetX(udg_temp_u2), GetWidgetY(udg_temp_u2), R2I(udg_temp_r), .9)
        call SkillUp(udg_temp_u, 'A00V', 0)
endfunction

//===========================================================================
function InitTrig_MQCuroA00V takes nothing returns nothing
    set gg_trg_MQCuroA00V = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MQCuroA00V, function Trig_MQCuroA00V_Actions )
endfunction

//===========================================================================
// Trigger: MWDeRentoA024
//
// RMinBJ(17.00, ( 3.00 + ( Pow(udg_temp_r, 0.90) / 16.00 ) ))
//===========================================================================
function Trig_MWDeRentoA024_Actions takes nothing returns nothing
    call Curse(udg_temp_u, udg_temp_u2, 0, 1)
    call SkillUp(udg_temp_u, 'A024', 10)
endfunction

//===========================================================================
function InitTrig_MWDeRentoA024 takes nothing returns nothing
    set gg_trg_MWDeRentoA024 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MWDeRentoA024, function Trig_MWDeRentoA024_Actions )
endfunction

//===========================================================================
// Trigger: MEBellaA01N
//===========================================================================
function GetGroupRange takes group g, real x, real y, real radius, boolexpr filter returns group
  set g = CreateGroup()
  call GroupEnumUnitsInRange(g, x, y, radius, filter)
  //call DestroyBoolExpr(filter)
  return g
endfunction
  
function PartyBuff_Condi takes nothing returns boolean
  return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) ) and ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] == udg_PartyNumber_ThisP[udg_temp_i] ) and ( udg_temp_u != GetFilterUnit() )
endfunction

function Trig_MEBellaA01N_Actions takes nothing returns nothing
  call SkillUp(udg_temp_u, 'A01N', 30)
  call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) / 100.00 ) ) )
  call SetBuff(udg_temp_u2, "BELLA", SkillPer(udg_temp_u, udg_temp_ab, 0, 4), 15)
  if ( udg_temp_u == udg_temp_u2 ) and ( udg_PartyNumber_pP[udg_PartyNumber_ThisP[udg_temp_i]] >= 2 ) then
    set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u), 900., Condition(function PartyBuff_Condi))
    loop
      set udg_temp_u2 = FirstOfGroup(udg_temp_g)
      exitwhen udg_temp_u2 == null
      call GroupRemoveUnit(udg_temp_g, udg_temp_u2)
      
      call SetUnitState(udg_temp_u, UNIT_STATE_MANA, GetUnitState(udg_temp_u, UNIT_STATE_MANA) - EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) - GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA)/100.)
      call SetBuff(udg_temp_u2, "BELLA", SkillPer(udg_temp_u, udg_temp_ab, 0, 4), 15)
    endloop
    call DestroyGroup(udg_temp_g)
  endif
endfunction

//===========================================================================
function InitTrig_MEBellaA01N takes nothing returns nothing
    set gg_trg_MEBellaA01N = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MEBellaA01N, function Trig_MEBellaA01N_Actions )
endfunction

//===========================================================================
// Trigger: MW2DeBardoA02D
//===========================================================================
function Trig_MW2DeBardoA02D_Actions takes nothing returns nothing
    call Curse(udg_temp_u, udg_temp_u2, 0, 2)
    call SkillUp(udg_temp_u, 'A02D', 5)
endfunction

//===========================================================================
function InitTrig_MW2DeBardoA02D takes nothing returns nothing
    set gg_trg_MW2DeBardoA02D = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MW2DeBardoA02D, function Trig_MW2DeBardoA02D_Actions )
endfunction

//===========================================================================
// Trigger: MQ2CuranoA01Y
//===========================================================================
function Trig_MQ2CuranoA01Y_Actions takes nothing returns nothing
    set udg_temp_r =                        (RMinBJ(GetHPLimit(true), RMaxBJ(400,MakeValue("-150|Wi=*10|Mp+*0.05|He-",udg_temp_i))*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A01Y'),udg_temp_i,5)))
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) *                        (BaseValue(23)*2.) ) ) )
    call SetUnitLifeBJ( udg_temp_u2, ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_temp_u2) + udg_temp_r ) )
        call GetEffectUnit(udg_temp_u2, 5, GetRandomInt(1,3))
    call DmgText_View("H", false, GetWidgetX(udg_temp_u2), GetWidgetY(udg_temp_u2), R2I(udg_temp_r), .9)
        call SkillUp(udg_temp_u, 'A01Y', 0)
endfunction

//===========================================================================
function InitTrig_MQ2CuranoA01Y takes nothing returns nothing
    set gg_trg_MQ2CuranoA01Y = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MQ2CuranoA01Y, function Trig_MQ2CuranoA01Y_Actions )
endfunction

//===========================================================================
// Trigger: MFCureceA01X
//===========================================================================
function PartyHeal_Condi takes nothing returns boolean
debug call BJDebugMsg(GetUnitName(GetFilterUnit()) + "_" + I2S(udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1]) + "_" + I2S(udg_PartyNumber_ThisP[udg_temp_i]) +"_" + I2S(udg_temp_i))
debug call BJDebugMsg(GetUnitName(GetFilterUnit()) + "HP_" + R2S(GetWidgetLife(GetFilterUnit())) + "_" + R2S(GetUnitState(GetFilterUnit(), UNIT_STATE_MAX_LIFE)) + "_" + R2S(GetWidgetLife(GetFilterUnit()) / GetUnitState(GetFilterUnit(), UNIT_STATE_MAX_LIFE)))
  return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) ) and ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] == udg_PartyNumber_ThisP[udg_temp_i] ) and ( GetWidgetLife(GetFilterUnit()) > 0. ) and ( GetWidgetLife(GetFilterUnit()) / GetUnitState(GetFilterUnit(), UNIT_STATE_MAX_LIFE) < .9 )
endfunction

function Trig_MFCureceA01X_Func006A takes nothing returns nothing
  set udg_temp_u2 = GetEnumUnit()
  call SetWidgetLife(udg_temp_u2, GetWidgetLife(udg_temp_u2) + udg_temp_r)
  call GetEffectUnit(udg_temp_u2, 5, udg_temp_i2)
  call SetUnitState(udg_temp_u, UNIT_STATE_MANA, GetUnitState(udg_temp_u, UNIT_STATE_MANA) - (GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA) * BaseValue(24)))
  call DmgText_View("H", false, GetWidgetX(udg_temp_u2), GetWidgetY(udg_temp_u2), R2I(udg_temp_r), .95)
endfunction

function Trig_MFCureceA01X_Actions takes nothing returns nothing
  if ( udg_PartyNumber_ThisP[udg_temp_i] != 0 ) then
    set udg_temp_r = RMinBJ(GetHPLimit(false), MakeValue("150|Wi=*5|Mp+*0.03|He+",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A01X'),udg_temp_i,5))
    set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u), 700., Condition(function PartyHeal_Condi))
    call GetEffectUnit(udg_temp_u, 5, 8)
    set udg_temp_i2 = GetRandomInt(1,2)
    call ForGroup(udg_temp_g, function Trig_MFCureceA01X_Func006A)
    call DestroyGroup(udg_temp_g)
    call SkillUp(udg_temp_u, 'A01X', 0)
  else
    call MSG(Player(udg_temp_i-1), 1, 3, "파티가 필요합니다.")
  endif
endfunction

//===========================================================================
function InitTrig_MFCureceA01X takes nothing returns nothing
    set gg_trg_MFCureceA01X = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MFCureceA01X, function Trig_MFCureceA01X_Actions )
endfunction

//===========================================================================
// Trigger: MREnarmaA02Z
//
// 60 + 0.5x 스킬레벨 지속
// Dam + 10
//===========================================================================
function Trig_MREnarmaA02Z_Actions takes nothing returns nothing
  call SkillUp(udg_temp_u, 'A02Z', 30)
  call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) / 100.00 ) ) )
  call SetBuff(udg_temp_u2, "ENA", SkillPer(udg_temp_u, udg_temp_ab, 0, 4), 20)
        
        
  if ( udg_temp_u == udg_temp_u2 ) and ( udg_PartyNumber_pP[udg_PartyNumber_ThisP[udg_temp_i]] >= 2 ) then
    set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u), 900., Condition(function PartyBuff_Condi))
    loop
      set udg_temp_u2 = FirstOfGroup(udg_temp_g)
      exitwhen udg_temp_u2 == null
      call GroupRemoveUnit(udg_temp_g, udg_temp_u2)
      
      call SetUnitState(udg_temp_u, UNIT_STATE_MANA, GetUnitState(udg_temp_u, UNIT_STATE_MANA) - EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) - GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA)/100.)
      call SetBuff(udg_temp_u2, "ENA", SkillPer(udg_temp_u, udg_temp_ab, 0, 4), 20)
    endloop
    call DestroyGroup(udg_temp_g)
  endif
endfunction

//===========================================================================
function InitTrig_MREnarmaA02Z takes nothing returns nothing
    set gg_trg_MREnarmaA02Z = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MREnarmaA02Z, function Trig_MREnarmaA02Z_Actions )
endfunction

//===========================================================================
// Trigger: MQ3CuranosoA030
//===========================================================================
function Trig_MQ3CuranosoA030_Actions takes nothing returns nothing
    set udg_temp_r =                        (RMinBJ(GetHPLimit(true), RMaxBJ(1000,MakeValue("-1000|Wi=*60|Lv+*-25|Mp+*0.07|He-",udg_temp_i))*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A030'),udg_temp_i,5)))
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) *                        (BaseValue(23)*3.) ) ) )
    call SetUnitLifeBJ( udg_temp_u2, ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_temp_u2) + udg_temp_r ) )
        call GetEffectUnit(udg_temp_u2, 5, GetRandomInt(1,4))
    call DmgText_View("H", false, GetWidgetX(udg_temp_u2), GetWidgetY(udg_temp_u2), R2I(udg_temp_r), .9)
      call SkillUp(udg_temp_u, 'A030', 0)
endfunction

//===========================================================================
function InitTrig_MQ3CuranosoA030 takes nothing returns nothing
    set gg_trg_MQ3CuranosoA030 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MQ3CuranosoA030, function Trig_MQ3CuranosoA030_Actions )
endfunction

//===========================================================================
// Trigger: MW3DeDeprecaA04G
//===========================================================================
function Trig_MW3DeDeprecaA04G_Actions takes nothing returns nothing
    call Curse(udg_temp_u, udg_temp_u2, 0, 3)
    call SkillUp(udg_temp_u, 'A04G', 0)
endfunction

//===========================================================================
function InitTrig_MW3DeDeprecaA04G takes nothing returns nothing
    set gg_trg_MW3DeDeprecaA04G = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MW3DeDeprecaA04G, function Trig_MW3DeDeprecaA04G_Actions )
endfunction

//===========================================================================
// Trigger: MF2CuranuceA031
//===========================================================================
function Trig_MF2CuranuceA031_Func006A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    call SetUnitLifeBJ( udg_temp_u2, ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_temp_u2) + udg_temp_r ) )
    call GetEffectUnit(udg_temp_u2, 5, udg_temp_i2)
    call SetUnitState(udg_temp_u, UNIT_STATE_MANA, GetUnitState(udg_temp_u, UNIT_STATE_MANA) - (GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA) * (BaseValue(24)*2.)))
    call DmgText_View("H", false, GetWidgetX(udg_temp_u2), GetWidgetY(udg_temp_u2), R2I(udg_temp_r), .9)
endfunction

function Trig_MF2CuranuceA031_Actions takes nothing returns nothing
      if ( udg_PartyNumber_ThisP[udg_temp_i] != 0 ) then
    set udg_temp_r =                        (RMinBJ(GetHPLimit(false), RMaxBJ(400,MakeValue("-150|Wi=*12|Mp+*0.03|He+",udg_temp_i))*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A031'),udg_temp_i,5)))
    call GetEffectUnit(udg_temp_u, 5, 8)
    set udg_temp_i2 = GetRandomInt(1, 3)
    set udg_temp_g =                                    (GetGroupRange(udg_temp_g, GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u), 700., Condition(function PartyHeal_Condi)))
    call ForGroupBJ( udg_temp_g, function Trig_MF2CuranuceA031_Func006A )
    call DestroyGroup( udg_temp_g )
        call SkillUp(udg_temp_u, 'A031', 0)
    set udg_temp_r = 0.00
      else
        call MSG(Player(udg_temp_i-1), 1, 3, "파티가 필요합니다.")
      endif
endfunction

//===========================================================================
function InitTrig_MF2CuranuceA031 takes nothing returns nothing
    set gg_trg_MF2CuranuceA031 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MF2CuranuceA031, function Trig_MF2CuranuceA031_Actions )
endfunction

//===========================================================================
// Trigger: MT1HolyShotA05V
//===========================================================================
function Trig_MT1HolyShotA05V_Actions takes nothing returns nothing
 local real DmgPer = .45
  if ( GetUnitAbilityLevel(udg_temp_u2,'A00O') == 1 ) then
    call DmgMagic(udg_temp_u, udg_temp_u2, 1)
  else
    if ( GetUnitAbilityLevel(udg_temp_u2,'A047') == 1 ) then
      set DmgPer = DmgPer * .5
    endif
    if ( udg_PartyNumber_pP[udg_PartyNumber_ThisP[udg_temp_i]] >= 2 ) then
      set DmgPer = DmgPer * .2
    endif
    if ( LoadReal(udg_hash,GetHandleId(udg_temp_u2),StringHash("MRD2")) != 0. ) then
      set DmgPer = DmgPer * (1.-LoadReal(udg_hash,GetHandleId(udg_temp_u2),StringHash("MRD2")))
    endif
    
    call DmgMagic(udg_temp_u, udg_temp_u2, MCri(GetUnitState(udg_temp_u2, UNIT_STATE_MAX_LIFE)*DmgPer*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A05V'),udg_temp_i,1), udg_temp_i, 1, 5))
  endif
  call TriggerExecute( gg_trg_AutoReaction_iii )
  call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", udg_temp_u2, "origin") )
  call SkillUp(udg_temp_u, 'A05V', 0)
endfunction

//===========================================================================
function InitTrig_MT1HolyShotA05V takes nothing returns nothing
    set gg_trg_MT1HolyShotA05V = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MT1HolyShotA05V, function Trig_MT1HolyShotA05V_Actions )
endfunction

//===========================================================================
// Trigger: MT2HolyBoltA032
//===========================================================================
function Trig_MT2HolyBoltA032_Actions takes nothing returns nothing
 local real DmgPer = .6
  if ( GetUnitAbilityLevel(udg_temp_u2,'A00O') == 1 ) then
    call DmgMagic(udg_temp_u, udg_temp_u2, 1)
  else
    if ( GetUnitAbilityLevel(udg_temp_u2,'A047') == 1 ) then
      set DmgPer = DmgPer * .5
    endif
    if ( udg_PartyNumber_pP[udg_PartyNumber_ThisP[udg_temp_i]] >= 2 ) then
      set DmgPer = DmgPer * .2
    endif
    if ( LoadReal(udg_hash,GetHandleId(udg_temp_u2),StringHash("MRD2")) != 0. ) then
      set DmgPer = DmgPer * (1.-LoadReal(udg_hash,GetHandleId(udg_temp_u2),StringHash("MRD2")))
    endif
    
    call DmgMagic(udg_temp_u, udg_temp_u2, MCri(GetUnitState(udg_temp_u2, UNIT_STATE_MAX_LIFE)*DmgPer*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A032'),udg_temp_i,1), udg_temp_i, 1, 5))
  endif
  call TriggerExecute( gg_trg_AutoReaction_iii )
  call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", udg_temp_u2, "origin") )
  call SkillUp(udg_temp_u, 'A032', 0)
  call TimeAction(udg_temp_u2, 1, 8)
endfunction

//===========================================================================
function InitTrig_MT2HolyBoltA032 takes nothing returns nothing
    set gg_trg_MT2HolyBoltA032 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MT2HolyBoltA032, function Trig_MT2HolyBoltA032_Actions )
endfunction

//===========================================================================
// Trigger: MW4DePrabaA04H
//===========================================================================
function Trig_MW4DePrabaA04H_Actions takes nothing returns nothing
//저주 제거
    call Curse(udg_temp_u, udg_temp_u2, 0, 4)
    if ( udg_temp_ab == 'A04H' ) then
      call SkillUp(udg_temp_u, 'A04H', 0)
    endif

  //일루메니 제거
  if ( GetLocalPlayer() == GetOwningPlayer(udg_temp_u2) ) then
    call DisplayCineFilter(false)
  endif
  
//소루마 제거
  call UnitRemoveAbility(udg_temp_u2, 'B00I')
//나르콜리 제거
  if ( UnitRemoveAbility(udg_temp_u2, 'B00E') ) then
    call SetUnitTimeScale(udg_temp_u2, 1)
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", udg_temp_u2, "overhead"))
    call PauseUnit(udg_temp_u2, false)
  endif
endfunction

//===========================================================================
function InitTrig_MW4DePrabaA04H takes nothing returns nothing
    set gg_trg_MW4DePrabaA04H = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MW4DePrabaA04H, function Trig_MW4DePrabaA04H_Actions )
endfunction

//===========================================================================
// Trigger: ME2SuBellaA059
//
// 지속 90~ 210
// Hit + 25
//===========================================================================
function Trig_ME2SuBellaA059_Actions takes nothing returns nothing
        call SkillUp(udg_temp_u, 'A059', 30)
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) / 100.00 ) ) )
        call SetBuff(udg_temp_u2, "BELLA", SkillPer(udg_temp_u, udg_temp_ab, 0, 4), 25)
        
  if ( udg_temp_u == udg_temp_u2 ) and ( udg_PartyNumber_pP[udg_PartyNumber_ThisP[udg_temp_i]] >= 2 ) then
    set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u), 900., Condition(function PartyBuff_Condi))
    loop
      set udg_temp_u2 = FirstOfGroup(udg_temp_g)
      exitwhen udg_temp_u2 == null
      call GroupRemoveUnit(udg_temp_g, udg_temp_u2)
      
      call SetUnitState(udg_temp_u, UNIT_STATE_MANA, GetUnitState(udg_temp_u, UNIT_STATE_MANA) - EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) - GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA)/100.)
      call SetBuff(udg_temp_u2, "BELLA", SkillPer(udg_temp_u, udg_temp_ab, 0, 4), 25)
    endloop
    call DestroyGroup(udg_temp_g)
  endif
endfunction

//===========================================================================
function InitTrig_ME2SuBellaA059 takes nothing returns nothing
    set gg_trg_ME2SuBellaA059 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_ME2SuBellaA059, function Trig_ME2SuBellaA059_Actions )
endfunction

//===========================================================================
// Trigger: MZESmallBuffA09K
//===========================================================================
function Trig_MZESmallBuffA09K_Actions takes nothing returns nothing
  set udg_temp_r = GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA)*.08
  call SetUnitState(udg_temp_u, UNIT_STATE_MANA, GetUnitState(udg_temp_u, UNIT_STATE_MANA) - udg_temp_r)
  call SetBuff(udg_temp_u2, "ENA", 130., 20)
  call SetBuff(udg_temp_u2, "BELLA", 130., 25)
  call SetBuff(udg_temp_u2, "COLLA", 130., 10)
  call SetBuff(udg_temp_u2, "HORR", 130., 50)
  if ( udg_temp_u == udg_temp_u2 ) and ( udg_PartyNumber_pP[udg_PartyNumber_ThisP[udg_temp_i]] >= 2 ) then
    set udg_temp_r = udg_temp_r + EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104)
    set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u), 900., Condition(function PartyBuff_Condi))
    loop
      set udg_temp_u2 = FirstOfGroup(udg_temp_g)
      exitwhen udg_temp_u2 == null
      call GroupRemoveUnit(udg_temp_g, udg_temp_u2)
      if ( GetUnitState(udg_temp_u, UNIT_STATE_MANA) >= udg_temp_r ) then
        call SetUnitState(udg_temp_u, UNIT_STATE_MANA, GetUnitState(udg_temp_u, UNIT_STATE_MANA) - udg_temp_r)
        call SetBuff(udg_temp_u2, "ENA", 130., 20)
        call SetBuff(udg_temp_u2, "BELLA", 130., 25)
        call SetBuff(udg_temp_u2, "COLLA", 130., 10)
        call SetBuff(udg_temp_u2, "HORR", 130., 50)
      else
        call MSG(Player(udg_temp_i-1), 1, 3, "마나가 부족합니다. " +I2S(R2I(udg_temp_r))+ "이상 필요합니다.")
        exitwhen true
      endif
    endloop
    call DestroyGroup(udg_temp_g)
  endif
endfunction

//===========================================================================
function InitTrig_MZESmallBuffA09K takes nothing returns nothing
    set gg_trg_MZESmallBuffA09K = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MZESmallBuffA09K, function Trig_MZESmallBuffA09K_Actions )
endfunction

//===========================================================================
// Trigger: MQ4SuCuranoA05D
//===========================================================================
function Trig_MQ4SuCuranoA05D_Actions takes nothing returns nothing
    set udg_temp_r =                        (RMinBJ(GetHPLimit(true), RMaxBJ(2500,MakeValue("-3000|Wi=*90|Mp+*0.05|He-",udg_temp_i))*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A05D'),udg_temp_i,5)))
    call SetUnitLifeBJ( udg_temp_u2, ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_temp_u2) + udg_temp_r ) )
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) *                        (BaseValue(23)*4.) ) ) )
        call GetEffectUnit(udg_temp_u2, 5, GetRandomInt(1,5))
    call DmgText_View("H", false, GetWidgetX(udg_temp_u2), GetWidgetY(udg_temp_u2), R2I(udg_temp_r), .9)
      call SkillUp(udg_temp_u, 'A05D', 0)
endfunction

//===========================================================================
function InitTrig_MQ4SuCuranoA05D takes nothing returns nothing
    set gg_trg_MQ4SuCuranoA05D = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MQ4SuCuranoA05D, function Trig_MQ4SuCuranoA05D_Actions )
endfunction

//===========================================================================
// Trigger: MF3CuraneraA05H
//===========================================================================
function Trig_MF3CuraneraA05H_Func006A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    call SetUnitLifeBJ( udg_temp_u2, ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_temp_u2) + udg_temp_r ) )
    call GetEffectUnit(udg_temp_u2, 5, udg_temp_i2)
    call SetUnitState(udg_temp_u, UNIT_STATE_MANA, GetUnitState(udg_temp_u, UNIT_STATE_MANA) - (GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA) * (BaseValue(24)*3.)))
    call DmgText_View("H", false, GetWidgetX(udg_temp_u2), GetWidgetY(udg_temp_u2), R2I(udg_temp_r), .9)
endfunction

function Trig_MF3CuraneraA05H_Actions takes nothing returns nothing
      if ( udg_PartyNumber_ThisP[udg_temp_i] != 0 ) then
    set udg_temp_r =                        (RMinBJ(GetHPLimit(false), RMaxBJ(1000,MakeValue("-500|Wi=*30|Mp+*0.03|He+",udg_temp_i))*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A05H'),udg_temp_i,5)))
    set udg_temp_g =                                    (GetGroupRange(udg_temp_g, GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u), 700., Condition(function PartyHeal_Condi)))
    set udg_temp_i2 = GetRandomInt(1, 4)
    call GetEffectUnit(udg_temp_u, 5, GetRandomInt(8,9))
    call ForGroupBJ( udg_temp_g, function Trig_MF3CuraneraA05H_Func006A )
    call DestroyGroup( udg_temp_g )
        call SkillUp(udg_temp_u, 'A05H', 0)
      else
        call MSG(Player(udg_temp_i-1), 1, 3, "파티가 필요합니다.")
      endif
endfunction

//===========================================================================
function InitTrig_MF3CuraneraA05H takes nothing returns nothing
    set gg_trg_MF3CuraneraA05H = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MF3CuraneraA05H, function Trig_MF3CuraneraA05H_Actions )
endfunction

//===========================================================================
// Trigger: MQ5XCuranoA074
//
// RMinBJ(GetUnitState(udg_temp_u, UNIT_STATE_MAX_LIFE)*2, RMaxBJ(6000,MakeValue("-15000|Wi=*400|Lv+*-200|Mp+*0.05",udg_temp_i))*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A074'),udg_temp_i,5))
// RMinBJ(GetUnitState(udg_temp_u, UNIT_STATE_MAX_LIFE)*2, RMaxBJ(2500,MakeValue("-6000|Wi=*180|Lv+*-80|Mp+*0.04",udg_temp_i))*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A05D'),udg_temp_i,5))
// 25 80 150
//===========================================================================
function Trig_MQ5XCuranoA074_Actions takes nothing returns nothing
    if ( udg_temp_ab == 'A074' ) then
    set udg_temp_r =                        (RMinBJ(GetHPLimit(true), RMaxBJ(6000,MakeValue("-7500|Wi=*200|Mp+*0.05|He-",udg_temp_i))*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A074'),udg_temp_i,5)))
    call SetUnitLifeBJ( udg_temp_u2, ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_temp_u2) + udg_temp_r ) )
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) *                        (BaseValue(23)*5.) ) ) )
        call GetEffectUnit(udg_temp_u2, 5, GetRandomInt(1,6))
    call DmgText_View("H", false, GetWidgetX(udg_temp_u2), GetWidgetY(udg_temp_u2)-50., R2I(udg_temp_r), .9)
      call SkillUp(udg_temp_u, 'A074', -5)
    else
    set udg_temp_r =                        (RMinBJ(GetHPLimit(true), RMaxBJ(6000,MakeValue("-7500|Wi=*200|Mp+*0.05|He-",udg_temp_i))))
    call SetUnitLifeBJ( udg_temp_u2, ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_temp_u2) + udg_temp_r ) )
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) *                        (BaseValue(23)*5.) ) ) )
        call GetEffectUnit(udg_temp_u2, 5, GetRandomInt(1,6))
    call DmgText_View("H", false, GetWidgetX(udg_temp_u2), GetWidgetY(udg_temp_u2)-50., R2I(udg_temp_r), .9)
    endif
endfunction

//===========================================================================
function InitTrig_MQ5XCuranoA074 takes nothing returns nothing
    set gg_trg_MQ5XCuranoA074 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MQ5XCuranoA074, function Trig_MQ5XCuranoA074_Actions )
endfunction

//===========================================================================
// Trigger: MF4XCuraneraA075
//===========================================================================
function Trig_MF4XCuraneraA075_Func011A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    call SetUnitLifeBJ( udg_temp_u2, ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_temp_u2) + udg_temp_r ) )
    call GetEffectUnit(udg_temp_u2, 5, udg_temp_i2)
    call SetUnitState(udg_temp_u, UNIT_STATE_MANA, GetUnitState(udg_temp_u, UNIT_STATE_MANA) - (GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA) * (BaseValue(24)*4.)))
    call DmgText_View("H", false, GetWidgetX(udg_temp_u2), GetWidgetY(udg_temp_u2)-50., R2I(udg_temp_r), .9)
endfunction

function Trig_MF4XCuraneraA075_Actions takes nothing returns nothing
      if ( udg_PartyNumber_ThisP[udg_temp_i] != 0 ) then
    set udg_temp_g =                                    (GetGroupRange(udg_temp_g, GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u), 700., Condition(function PartyHeal_Condi)))
        if ( udg_temp_ab == 'A075' ) then
    set udg_temp_r =                        (RMinBJ(GetHPLimit(false), RMaxBJ(2500,MakeValue("-3000|Wi=*90|Mp+*0.03|He+",udg_temp_i))*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A075'),udg_temp_i,5)))
        call SkillUp(udg_temp_u, 'A075', 0)
        else
    set udg_temp_r =                        (RMinBJ(GetHPLimit(false), RMaxBJ(2500,MakeValue("-3000|Wi=*90|Mp+*0.03|He+",udg_temp_i))))
        endif
    set udg_temp_i2 = GetRandomInt(1, 5)
    call GetEffectUnit(udg_temp_u, 5, GetRandomInt(8,10))
    call ForGroupBJ( udg_temp_g, function Trig_MF4XCuraneraA075_Func011A )
    call DestroyGroup( udg_temp_g )
      else
        call MSG(Player(udg_temp_i-1), 1, 3, "파티가 필요합니다.")
      endif
endfunction

//===========================================================================
function InitTrig_MF4XCuraneraA075 takes nothing returns nothing
    set gg_trg_MF4XCuraneraA075 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MF4XCuraneraA075, function Trig_MF4XCuraneraA075_Actions )
endfunction

//===========================================================================
// Trigger: MQ6HCuranoA002
//===========================================================================
function Trig_MQ6HCuranoA002_Actions takes nothing returns nothing
    set udg_temp_r =                        (RMinBJ(GetHPLimit(true), RMaxBJ(7500,MakeValue("-22500|Wi=*500|Mp+*0.05|He-",udg_temp_i))*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A002'),udg_temp_i,5)))
    call SetUnitLifeBJ( udg_temp_u2, ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_temp_u2) + udg_temp_r ) )
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) *                        (BaseValue(23)*6.) ) ) )
        call GetEffectUnit(udg_temp_u2, 5, GetRandomInt(1,7))
    call DmgText_View("H", false, GetWidgetX(udg_temp_u2), GetWidgetY(udg_temp_u2)-50., R2I(udg_temp_r), .9)
        call SkillUp(udg_temp_u, 'A002', -28)
endfunction

//===========================================================================
function InitTrig_MQ6HCuranoA002 takes nothing returns nothing
    set gg_trg_MQ6HCuranoA002 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MQ6HCuranoA002, function Trig_MQ6HCuranoA002_Actions )
endfunction

//===========================================================================
// Trigger: MT2HdragonA01U
//===========================================================================
function Trig_MT2HdragonA01U_Func007A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    if ( Dis(udg_temp_u, udg_temp_u2) > 720. ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
      call GetEffectUnit(udg_temp_u2, 1, 1)
      call RangeMana(udg_temp_u, udg_temp_r2*BaseValue(27))
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(4)) )
    elseif ( RangeMana(udg_temp_u, udg_temp_r2) ) then
      call DmgMagic(udg_temp_u, udg_temp_u2, udg_temp_r)
    set udg_temp_r = ( udg_temp_r *                        (BaseValue(3)) )
    set bj_lastCreatedUnit = CreateUnit(Player(12), 'e015', GetWidgetX(udg_temp_u2), GetWidgetY(udg_temp_u2), bj_UNIT_FACING)
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", GetLastCreatedUnit(), "origin") )
    call SetUnitScalePercent( GetLastCreatedUnit(), 200.00, 200.00, 200.00 )
        call SkillUp(udg_temp_u, 'A01U', -29.5)
    call TriggerExecute( gg_trg_AutoReaction_iii )
    endif
endfunction

function Trig_MT2HdragonA01U_Actions takes nothing returns nothing
    set udg_temp_g =                                    (GetGroupEnemy(CreateGroup(), udg_temp_u, RangeAdd(720.,udg_temp_i), Condition(function Range_Condi)))
    set udg_temp_b = false
    set udg_temp_r =                        (RMaxBJ(100, MCri(MakeValue("-5000|Mp-*24|Po+",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A01U'),udg_temp_i,1), udg_temp_i, 3, 6)))
    set udg_temp_r2 =                        (EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) * BaseValue(25))
    call TimeAction(udg_temp_u, 30., 25)
    call ED( AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", udg_temp_u, "origin"), 3.00 )
    call ForGroupBJ( udg_temp_g, function Trig_MT2HdragonA01U_Func007A )
    call SetUnitManaBJ( udg_temp_u, 0.00 )
    call DestroyGroup( udg_temp_g )
endfunction

//===========================================================================
function InitTrig_MT2HdragonA01U takes nothing returns nothing
    set gg_trg_MT2HdragonA01U = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MT2HdragonA01U, function Trig_MT2HdragonA01U_Actions )
endfunction

//===========================================================================
// Trigger: SQDangakDA00X
//===========================================================================
function Combo takes unit u, integer ab, integer ut returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(u))+1
  
  if ( LoadBoolean(udg_hash, P, StringHash("C-ing2")) ) then
  //자동시전
    if ( GetRandomReal(0., 100.) < 15. ) and ( GetUnitAbilityLevel(u, 'A010')+GetUnitAbilityLevel(u, 'A03G') > 0 ) then
      call TriggerSleepAction(.1)
      set udg_temp_r = MakeValue("100|Wi=*5.0|Hp+*0.01|He-",P)*MakeValue2(GetUnitAbilityLevel(u,'A010'),P,5)
      call SetUnitState(u, UNIT_STATE_LIFE, GetWidgetLife(u)+udg_temp_r)
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishHealth\\ReplenishHealthCasterOverhead.mdl", u, "overhead"))
      call Bufftt(CreateTextTagUnitBJ(I2S(R2I(udg_temp_r)), u, -50.00, RMinBJ(30., 10. + Pow(udg_temp_r, 0.95)/25.), 0., 100, 0., 20.), 2)
      call Bufftt(CreateTextTagUnitBJ("      콤보: 쿠로토", u, 20, 11, 100, 50, 100, 0 ),6)
    elseif ( GetRandomReal(0., 85.) < 15. ) and ( GetUnitAbilityLevel(u, 'A055')+GetUnitAbilityLevel(u, 'A06A') > 0 ) then
    //쿠라노토
      call TriggerSleepAction(.1)
      set udg_temp_r = MakeValue("100|Wi=*5.0|Hp+*0.01|Se *2.|He-",P)
      call SetUnitState(u, UNIT_STATE_LIFE, GetWidgetLife(u)+udg_temp_r)
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishHealth\\ReplenishHealthCasterOverhead.mdl", u, "overhead"))
      call Bufftt(CreateTextTagUnitBJ(I2S(R2I(udg_temp_r)), u, -50.00, RMinBJ(30., 9. + Pow(udg_temp_r, 0.95)/50.), 0., 100, 0., 20.), 2)
      call Bufftt(CreateTextTagUnitBJ("      콤보: 쿠라노토", u, 20, 11, 100, 50, 100, 0 ),6)
    elseif ( GetRandomReal(0., 70.) < 15. ) and ( GetUnitAbilityLevel(u, 'A01K')+GetUnitAbilityLevel(u, 'A07Y') > 0 ) then
    //통배권
      call TriggerSleepAction(.1)
      call SetUnitAnimation(u, "attack")
      call QueueUnitAnimation(u, "stand")
      call CreateDummy(u, 'e00Q')
      call Bufftt(CreateTextTagUnitBJ("      콤보: 통배권", u, 20, 11, 100, 50, 100, 0 ),6)
    elseif ( GetRandomReal(0., 55.) < 15. ) and ( GetUnitAbilityLevel(u, 'A081')+GetUnitAbilityLevel(u, 'A082') > 0 ) then
    //발경
      call TriggerSleepAction(.1)
      call SetUnitAnimation(u, "attack")
      call QueueUnitAnimation(u, "stand")
      call CreateDummy(u, 'e00S')
      call Bufftt(CreateTextTagUnitBJ("      콤보: 발경", u, 20, 11, 100, 50, 100, 0 ),6)
    endif
  endif
  if ( LoadBoolean(udg_hash, P, StringHash("C-ing3")) ) then
    if ( GetRandomReal(0., 100.) <= 15. ) then
    //사용스킬 쿨초
      call TriggerSleepAction(.1)
      call EXSetAbilityState(EXGetUnitAbility(u, ab), ABILITY_STATE_COOLDOWN, .01)
      call Bufftt(CreateTextTagUnitBJ("      콤보: 초기화", u, 20, 11, 100, 50, 100, 0 ),6)
    endif
    if ( GetRandomReal(0., 100.) <= 15. ) then
    //사용스킬 추가사용
      call CreateDummy(u, ut)
      call Bufftt(CreateTextTagUnitBJ("      콤보: 복제", u, 70, 11, 100, 50, 100, 0 ),6)
    endif
  endif
endfunction
function Trig_SQDangakDA00X_Actions takes nothing returns nothing
  if ( SubString(SysStr(1, GetUnitTypeId(udg_temp_u)), 0, 1) == "1" ) then
    call SetUnitAnimation(udg_temp_u, "attack second")
  else
    call SetUnitAnimation(udg_temp_u, "Spell Upgrade")
  endif
  call QueueUnitAnimation(udg_temp_u, "stand")
  if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A00X', 0.95, 2) ) then
    call SkillUp(udg_temp_u, 'A00X', 14)
    call CreateDummy(udg_temp_u, 'e00P')
    call Combo(udg_temp_u, 'A00X', 'e00P')
  else
    call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
  endif
endfunction

//===========================================================================
function InitTrig_SQDangakDA00X takes nothing returns nothing
    set gg_trg_SQDangakDA00X = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SQDangakDA00X, function Trig_SQDangakDA00X_Actions )
endfunction

//===========================================================================
// Trigger: SWJumpA00Y
//
//     if ( RectContainsLoc(LoadRectHandleBJ(10, udg_OnesPositionN[udg_temp_i], udg_hash), udg_temp_l2) == true ) then
//===========================================================================
function Trig_SWJumpA00Y_Func005002003001 takes nothing returns boolean
    return ( GetUnitStateSwap(UNIT_STATE_LIFE, GetFilterUnit()) > 0.00 )
endfunction

function Trig_SWJumpA00Y_Func005002003002 takes nothing returns boolean
    return ( GetFilterUnit() != udg_temp_u )
endfunction

function Trig_SWJumpA00Y_Func005002003 takes nothing returns boolean
    return GetBooleanAnd( Trig_SWJumpA00Y_Func005002003001(), Trig_SWJumpA00Y_Func005002003002() )
endfunction

function Trig_SWJumpA00Y_Func020A takes nothing returns nothing
    if ( udg_temp_u2 == null ) then
    set udg_temp_u2 = GetEnumUnit()
    set udg_temp_l = GetUnitLoc(udg_temp_u2)
    set udg_temp_l2 = PolarProjectionBJ(udg_temp_l, 120.00, udg_temp_r)
    call RemoveLocation( udg_temp_l )
    set udg_temp_l = GetUnitLoc(udg_temp_u)
      if ( RAbsBJ(( GetLocationZ(udg_temp_l) - GetLocationZ(udg_temp_l2) )) < 64.00 ) then
    call SetUnitX( udg_temp_u, GetLocationX(udg_temp_l2) )
    call SetUnitY( udg_temp_u, GetLocationY(udg_temp_l2) )
    call SetUnitFacingTimed( udg_temp_u, ( udg_temp_r + 180.00 ), 0 )
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다. (갈 수 없는 곳입니다)")
      endif
    call RemoveLocation( udg_temp_l )
    call RemoveLocation( udg_temp_l2 )
    endif
endfunction

function Trig_SWJumpA00Y_Actions takes nothing returns nothing
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A00Y', 0.9, 1) ) then
    set udg_temp_r = GetUnitFacing(udg_temp_u)
    set udg_temp_l = GetUnitLoc(udg_temp_u)
    set udg_temp_l2 = PolarProjectionBJ(udg_temp_l, 120.00, udg_temp_r)
    set udg_temp_g = GetUnitsInRangeOfLocMatching(240.00, udg_temp_l2, Condition(function Trig_SWJumpA00Y_Func005002003))
        if ( IsUnitGroupEmptyBJ(udg_temp_g) ) then
    set udg_temp_l2 = PolarProjectionBJ(udg_temp_l, 200.00, udg_temp_r)
    set udg_temp_g = GetUnitsInRangeOfLocAll(240.00, udg_temp_l2)
        endif
        if ( IsUnitGroupEmptyBJ(udg_temp_g) ) then
    set udg_temp_l2 = PolarProjectionBJ(udg_temp_l, 280.00, udg_temp_r)
    set udg_temp_g = GetUnitsInRangeOfLocAll(240.00, udg_temp_l2)
        endif
    call RemoveLocation( udg_temp_l2 )
    call RemoveLocation( udg_temp_l )
        if ( IsUnitGroupEmptyBJ(udg_temp_g) ) then
          call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "허공입니다.")
        else
    set udg_temp_u2 = null
    call ForGroupBJ( udg_temp_g, function Trig_SWJumpA00Y_Func020A )
        call SkillUp(udg_temp_u, 'A00Y', 0)
    set udg_temp_u2 = null
        endif
    call DestroyGroup( udg_temp_g )
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
endfunction

//===========================================================================
function InitTrig_SWJumpA00Y takes nothing returns nothing
    set gg_trg_SWJumpA00Y = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SWJumpA00Y, function Trig_SWJumpA00Y_Actions )
endfunction

//===========================================================================
// Trigger: SEBunggakDA01L
//===========================================================================
function Trig_SEBunggakDA01L_Actions takes nothing returns nothing
      if ( SubString(SysStr(1, GetUnitTypeId(udg_temp_u)), 0, 1) == "1" ) then
        call SetUnitAnimation(udg_temp_u, "attack slam")
      else
        call SetUnitAnimation(udg_temp_u, "Spell Throw")
      endif
      call QueueUnitAnimation(udg_temp_u, "stand")
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A01L', 0.95, 2) ) then
        call SkillUp(udg_temp_u, 'A01L', 10)
        call CreateDummy(udg_temp_u, 'e00R')
        call Combo(udg_temp_u, 'A01L', 'e00R')
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
endfunction

//===========================================================================
function InitTrig_SEBunggakDA01L takes nothing returns nothing
    set gg_trg_SEBunggakDA01L = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SEBunggakDA01L, function Trig_SEBunggakDA01L_Actions )
endfunction

//===========================================================================
// Trigger: SRSeonpoongA035
//
// set d = MakeValue("0|Lv+*30|St=*56|Co=*24", P) * MakeValue2(GetUnitAbilityLevel(e,'A01L'), P, 4), P, 20)
// if (  ) then
//===========================================================================
function Trig_SRSeonpoongA035_Func010002003001 takes nothing returns boolean
    return ( GetUnitStateSwap(UNIT_STATE_LIFE, GetFilterUnit()) > 0.00 )
endfunction

function Trig_SRSeonpoongA035_Func010002003002001 takes nothing returns boolean
    return ( IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(udg_temp_u)) == true )
endfunction

function Trig_SRSeonpoongA035_Func010002003002002 takes nothing returns boolean
    return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) != true )
endfunction

function Trig_SRSeonpoongA035_Func010002003002 takes nothing returns boolean
    return GetBooleanAnd( Trig_SRSeonpoongA035_Func010002003002001(), Trig_SRSeonpoongA035_Func010002003002002() )
endfunction

function Trig_SRSeonpoongA035_Func010002003 takes nothing returns boolean
    return GetBooleanAnd( Trig_SRSeonpoongA035_Func010002003001(), Trig_SRSeonpoongA035_Func010002003002() )
endfunction

function Trig_SRSeonpoongA035_Func022A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl", udg_temp_u2, "origin") )
      call DmgSkill(udg_temp_u, udg_temp_u2, Cri(udg_temp_r, udg_temp_i, 0))
      call SkillUp(udg_temp_u, 'A035', -18)
endfunction

function Trig_SRSeonpoongA035_Actions takes nothing returns nothing
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A035', 0.95, 2) ) then
    set udg_temp_b =       (LoadBoolean(udg_hash, udg_temp_i, StringHash("C-ing4")))
      if ( udg_temp_b ) then
        call SaveBoolean(udg_hash, udg_temp_i, StringHash("C-ing4"), false)
    set udg_temp_r =                        (Cri(MakeValue("0|Lv+*75|St=*75|Co=*75",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A035'),udg_temp_i,3), udg_temp_i, 20))
      else
    set udg_temp_r =                        (Cri(MakeValue("0|Lv+*50|St=*50|Co=*50",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A035'),udg_temp_i,3), udg_temp_i, 20))
      endif
    set udg_temp_l = GetUnitLoc(udg_temp_u)
    set udg_temp_g = GetUnitsInRangeOfLocMatching(240.00, udg_temp_l, Condition(function Trig_SRSeonpoongA035_Func010002003))
        set bj_groupCountUnits = 0
        call ForGroup(udg_temp_g, function CountUnitsInGroupEnum)
        set udg_temp_i2 = bj_groupCountUnits
        if ( udg_temp_i2 != 0 ) then
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl", udg_temp_u, "origin") )
      if ( SubString(SysStr(1, GetUnitTypeId(udg_temp_u)), 0, 1) == "1" ) then
        call SetUnitAnimation(udg_temp_u, "attack slam")
      else
        call SetUnitAnimation(udg_temp_u, "Spell Slam")
      endif
      call QueueUnitAnimation(udg_temp_u, "stand")
    call ForGroupBJ( udg_temp_g, function Trig_SRSeonpoongA035_Func022A )
        else
          call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다. (적이 없습니다)")
        endif
    call RemoveLocation( udg_temp_l )
    call DestroyGroup( udg_temp_g )
        call SaveBoolean(udg_hash, udg_temp_i, StringHash("C-ing4"), udg_temp_b)
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
endfunction

//===========================================================================
function InitTrig_SRSeonpoongA035 takes nothing returns nothing
    set gg_trg_SRSeonpoongA035 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SRSeonpoongA035, function Trig_SRSeonpoongA035_Actions )
endfunction

//===========================================================================
// Trigger: STbaekboDA02M
//
// 19 백보
//===========================================================================
function Trig_STbaekboDA02M_Actions takes nothing returns nothing
      if ( SubString(SysStr(1, GetUnitTypeId(udg_temp_u)), 0, 1) == "1" ) then
        call SetUnitAnimation(udg_temp_u, "attack")
      else
        call SetUnitAnimation(udg_temp_u, "Attack slam")
      endif
      call QueueUnitAnimation(udg_temp_u, "stand")
      call SkillUp(udg_temp_u, 'A02M', 0)
      call CreateDummy(udg_temp_u, 'e00I')
        call Combo(udg_temp_u, 'A02M', 'e00I')
endfunction

//===========================================================================
function InitTrig_STbaekboDA02M takes nothing returns nothing
    set gg_trg_STbaekboDA02M = CreateTrigger(  )
    call TriggerAddAction( gg_trg_STbaekboDA02M, function Trig_STbaekboDA02M_Actions )
endfunction

//===========================================================================
// Trigger: SFQTongbaeA01KA07Y
//===========================================================================
function Trig_SFQTongbaeA01KA07Y_Actions takes nothing returns nothing
      if ( SubString(SysStr(1, GetUnitTypeId(udg_temp_u)), 0, 1) == "1" ) then
        call SetUnitAnimation(udg_temp_u, "attack")
      else
        call SetUnitAnimation(udg_temp_u, "Attack slam")
      endif
      call QueueUnitAnimation(udg_temp_u, "stand")
      if ( GetUnitAbilityLevel(udg_temp_u, 'A07Y') >= 1 ) then
        if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, udg_temp_i, 0.95, 3) ) then
          call CreateDummy(udg_temp_u, 'e00Q')
        else
          call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
        endif
      elseif ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A01K', 0.95, 1) ) then
        call SkillUp(udg_temp_u, 'A01K', 0)
        call CreateDummy(udg_temp_u, 'e00Q')
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
endfunction

//===========================================================================
function InitTrig_SFQTongbaeA01KA07Y takes nothing returns nothing
    set gg_trg_SFQTongbaeA01KA07Y = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SFQTongbaeA01KA07Y, function Trig_SFQTongbaeA01KA07Y_Actions )
endfunction

//===========================================================================
// Trigger: SFEBalGyengDA081A082
//===========================================================================
function Trig_SFEBalGyengDA081A082_Actions takes nothing returns nothing
      if ( SubString(SysStr(1, GetUnitTypeId(udg_temp_u)), 0, 1) == "1" ) then
        call SetUnitAnimation(udg_temp_u, "attack")
      else
        call SetUnitAnimation(udg_temp_u, "Attack slam")
      endif
      call QueueUnitAnimation(udg_temp_u, "stand")
      if ( GetUnitAbilityLevelSwapped('A082', udg_temp_u) >= 1 ) then
        if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, udg_temp_i, 0.95, 3) ) then
          call CreateDummy(udg_temp_u, 'e00S')
        else
          call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
        endif
      else
        if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A080', 0.95, 2) ) then
          call SkillUp(udg_temp_u, 'A080', 20)
          call CreateDummy(udg_temp_u, 'e00S')
        else
          call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
        endif
      endif
endfunction

//===========================================================================
function InitTrig_SFEBalGyengDA081A082 takes nothing returns nothing
    set gg_trg_SFEBalGyengDA081A082 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SFEBalGyengDA081A082, function Trig_SFEBalGyengDA081A082_Actions )
endfunction

//===========================================================================
// Trigger: SFRSosuA04UA04X
//
// 12
// 30~70초간 데미지 30% 증가.
//===========================================================================
function Trig_SFRSosuA04UA04X_Actions takes nothing returns nothing
      if ( SubString(SysStr(1, GetUnitTypeId(udg_temp_u)), 0, 1) == "1" ) then
        call SetUnitAnimation(udg_temp_u, "attack")
      else
        call SetUnitAnimation(udg_temp_u, "Attack slam")
      endif
      call QueueUnitAnimation(udg_temp_u, "stand")
        if ( GetUnitAbilityLevelSwapped('A04X', udg_temp_u) >= 1 ) then
          call SetBuff(udg_temp_u, "SOSU", 260.+I2R(GetHeroLevel(udg_temp_u)), 30)
        else
          call SkillUp(udg_temp_u, 'A083', 60)
    set udg_temp_r = ( ( 78.00 + ( 18.20 * I2R(GetUnitAbilityLevelSwapped('A083', udg_temp_u)) ) ) + I2R(GetHeroLevel(udg_temp_u)) )
          call SetBuff(udg_temp_u, "SOSU", udg_temp_r, 30)
        endif
endfunction

//===========================================================================
function InitTrig_SFRSosuA04UA04X takes nothing returns nothing
    set gg_trg_SFRSosuA04UA04X = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SFRSosuA04UA04X, function Trig_SFRSosuA04UA04X_Actions )
endfunction

//===========================================================================
// Trigger: SFADalmaA037A04V
//===========================================================================
function Trig_SFADalmaA037A04V_Actions takes nothing returns nothing
      if ( SubString(SysStr(1, GetUnitTypeId(udg_temp_u)), 0, 1) == "1" ) then
        call SetUnitAnimation(udg_temp_u, "attack")
      else
        call SetUnitAnimation(udg_temp_u, "Attack slam")
      endif
      call QueueUnitAnimation(udg_temp_u, "stand")
      if ( GetUnitAbilityLevelSwapped('A04V', udg_temp_u) >= 1 ) then
        if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, udg_temp_i, 0.95, 3) ) then
          call CreateDummy(udg_temp_u, 'e012')
          call Combo(udg_temp_u, 'A085', 'e012')
        else
          call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
        endif
      else
        if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A084', 0.75, 1) ) then
          call SkillUp(udg_temp_u, 'A084', -15)
          call CreateDummy(udg_temp_u, 'e012')
          call Combo(udg_temp_u, 'A084', 'e012')
        else
          call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
        endif
      endif
endfunction

//===========================================================================
function InitTrig_SFADalmaA037A04V takes nothing returns nothing
    set gg_trg_SFADalmaA037A04V = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SFADalmaA037A04V, function Trig_SFADalmaA037A04V_Actions )
endfunction

//===========================================================================
// Trigger: SFSGuyangA07V
//===========================================================================
function Trig_SFSGuyangA07V_Func016A takes nothing returns nothing
    set udg_temp_u2 = GetEnumUnit()
      call DmgSkill(udg_temp_u, udg_temp_u2, Cri(udg_temp_r, udg_temp_i, 0))
      call SkillUp(udg_temp_u, 'A085', -27)
endfunction

function Trig_SFSGuyangA07V_Actions takes nothing returns nothing
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A085', 0.70, 1) ) then
      if ( SubString(SysStr(1, GetUnitTypeId(udg_temp_u)), 0, 1) == "1" ) then
        call SetUnitAnimation(udg_temp_u, "attack slam")
      else
        call SetUnitAnimation(udg_temp_u, "Spell Slam")
      endif
      call QueueUnitAnimation(udg_temp_u, "stand")
    set udg_temp_r =                        (Cri(MakeValue("-10000|Hp-*1.25|St=*250|Po+",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A085'),udg_temp_i,3),udg_temp_i,20))
    set udg_temp_g =                                    (GetGroupEnemy(CreateGroup(), udg_temp_u, 360., Condition(function Range_Condi)))
        set bj_groupCountUnits = 0
        call ForGroup(udg_temp_g, function CountUnitsInGroupEnum)
      if ( bj_groupCountUnits != 0 ) then
        call GetEffectLoc(udg_temp_u, 7, 1)
        call GetEffectLoc(udg_temp_u, 7, 1)
    call SetUnitLifeBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_temp_u) * 0.50 ) )
    call ForGroupBJ( udg_temp_g, function Trig_SFSGuyangA07V_Func016A )
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다. (적이 없습니다)")
      endif
    call DestroyGroup( udg_temp_g )
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
endfunction

//===========================================================================
function InitTrig_SFSGuyangA07V takes nothing returns nothing
    set gg_trg_SFSGuyangA07V = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SFSGuyangA07V, function Trig_SFSGuyangA07V_Actions )
endfunction

//===========================================================================
// Trigger: SW2Jump2A05U
//===========================================================================
function Trig_SW2Jump2A05U_Func005002003001 takes nothing returns boolean
    return ( GetUnitStateSwap(UNIT_STATE_LIFE, GetFilterUnit()) > 0.00 )
endfunction

function Trig_SW2Jump2A05U_Func005002003002001 takes nothing returns boolean
    return ( IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(udg_temp_u)) == true )
endfunction

function Trig_SW2Jump2A05U_Func005002003002002 takes nothing returns boolean
    return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) != true )
endfunction

function Trig_SW2Jump2A05U_Func005002003002 takes nothing returns boolean
    return GetBooleanAnd( Trig_SW2Jump2A05U_Func005002003002001(), Trig_SW2Jump2A05U_Func005002003002002() )
endfunction

function Trig_SW2Jump2A05U_Func005002003 takes nothing returns boolean
    return GetBooleanAnd( Trig_SW2Jump2A05U_Func005002003001(), Trig_SW2Jump2A05U_Func005002003002() )
endfunction

function Trig_SW2Jump2A05U_Func008002003001 takes nothing returns boolean
    return ( GetUnitStateSwap(UNIT_STATE_LIFE, GetFilterUnit()) > 0.00 )
endfunction

function Trig_SW2Jump2A05U_Func008002003002001 takes nothing returns boolean
    return ( IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(udg_temp_u)) == true )
endfunction

function Trig_SW2Jump2A05U_Func008002003002002 takes nothing returns boolean
    return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) != true )
endfunction

function Trig_SW2Jump2A05U_Func008002003002 takes nothing returns boolean
    return GetBooleanAnd( Trig_SW2Jump2A05U_Func008002003002001(), Trig_SW2Jump2A05U_Func008002003002002() )
endfunction

function Trig_SW2Jump2A05U_Func008002003 takes nothing returns boolean
    return GetBooleanAnd( Trig_SW2Jump2A05U_Func008002003001(), Trig_SW2Jump2A05U_Func008002003002() )
endfunction

function Trig_SW2Jump2A05U_Func012002003001 takes nothing returns boolean
    return ( GetUnitStateSwap(UNIT_STATE_LIFE, GetFilterUnit()) > 0.00 )
endfunction

function Trig_SW2Jump2A05U_Func012002003002001 takes nothing returns boolean
    return ( IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(udg_temp_u)) == true )
endfunction

function Trig_SW2Jump2A05U_Func012002003002002 takes nothing returns boolean
    return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) != true )
endfunction

function Trig_SW2Jump2A05U_Func012002003002 takes nothing returns boolean
    return GetBooleanAnd( Trig_SW2Jump2A05U_Func012002003002001(), Trig_SW2Jump2A05U_Func012002003002002() )
endfunction

function Trig_SW2Jump2A05U_Func012002003 takes nothing returns boolean
    return GetBooleanAnd( Trig_SW2Jump2A05U_Func012002003001(), Trig_SW2Jump2A05U_Func012002003002() )
endfunction

function Trig_SW2Jump2A05U_Func020A takes nothing returns nothing
    if ( udg_temp_u2 == null ) then
    set udg_temp_u2 = GetEnumUnit()
    set udg_temp_l = GetUnitLoc(udg_temp_u2)
    set udg_temp_l2 = PolarProjectionBJ(udg_temp_l, 120.00, udg_temp_r)
    call RemoveLocation( udg_temp_l )
    set udg_temp_l = GetUnitLoc(udg_temp_u)
      if ( RAbsBJ(( GetLocationZ(udg_temp_l) - GetLocationZ(udg_temp_l2) )) < 64.00 ) then
    set udg_temp_i = GetConvertedPlayerId(GetOwningPlayer(udg_temp_u))
      call DmgSkill(udg_temp_u, udg_temp_u2, Cri(MakeValue("-15000|St=*200|Co=*200|Po-",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A05U'),udg_temp_i,3), udg_temp_i, 0))
    call SetUnitX( udg_temp_u, GetLocationX(udg_temp_l2) )
    call SetUnitY( udg_temp_u, GetLocationY(udg_temp_l2) )
    call SetUnitFacingTimed( udg_temp_u, ( udg_temp_r + 180.00 ), 0 )
        call Dummier(GetOwningPlayer(udg_temp_u), udg_temp_u2, -1, 'A00D', "thunderbolt")
        set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(udg_temp_u), 'e015', GetUnitX(udg_temp_u2), GetUnitY(udg_temp_u2), 0)
    call AddSpecialEffectTargetUnitBJ( "origin", GetLastCreatedUnit(), "Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl" )
    call SetUnitScalePercent( GetLastCreatedUnit(), 50.00, 50.00, 50.00 )
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilSpecialArt.mdl", udg_temp_u2, "origin") )
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다. (갈 수 없는 곳입니다)")
      endif
    call RemoveLocation( udg_temp_l )
    call RemoveLocation( udg_temp_l2 )
    endif
endfunction

function Trig_SW2Jump2A05U_Actions takes nothing returns nothing
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A05U', 0.8, 1) ) then
    set udg_temp_r = GetUnitFacing(udg_temp_u)
    set udg_temp_l = GetUnitLoc(udg_temp_u)
    set udg_temp_l2 = PolarProjectionBJ(udg_temp_l, 120.00, udg_temp_r)
    set udg_temp_g = GetUnitsInRangeOfLocMatching(240.00, udg_temp_l2, Condition(function Trig_SW2Jump2A05U_Func005002003))
        if ( IsUnitGroupEmptyBJ(udg_temp_g) ) then
    set udg_temp_l2 = PolarProjectionBJ(udg_temp_l, 200.00, udg_temp_r)
    set udg_temp_g = GetUnitsInRangeOfLocMatching(240.00, udg_temp_l2, Condition(function Trig_SW2Jump2A05U_Func008002003))
        endif
        if ( IsUnitGroupEmptyBJ(udg_temp_g) ) then
    set udg_temp_l2 = PolarProjectionBJ(udg_temp_l, 280.00, udg_temp_r)
    set udg_temp_g = GetUnitsInRangeOfLocMatching(240.00, udg_temp_l2, Condition(function Trig_SW2Jump2A05U_Func012002003))
        endif
    call RemoveLocation( udg_temp_l2 )
    call RemoveLocation( udg_temp_l )
        if ( IsUnitGroupEmptyBJ(udg_temp_g) ) then
          call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "허공입니다.")
        else
    set udg_temp_u2 = null
    call ForGroupBJ( udg_temp_g, function Trig_SW2Jump2A05U_Func020A )
        call SkillUp(udg_temp_u, 'A05U', -28)
    set udg_temp_u2 = null
        endif
    call DestroyGroup( udg_temp_g )
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
endfunction

//===========================================================================
function InitTrig_SW2Jump2A05U takes nothing returns nothing
    set gg_trg_SW2Jump2A05U = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SW2Jump2A05U, function Trig_SW2Jump2A05U_Actions )
endfunction

//===========================================================================
// Trigger: CurotoA010
//===========================================================================
function Trig_CurotoA010_Actions takes nothing returns nothing
    if ( SubString(SysStr(1, GetUnitTypeId(udg_temp_u)), 1, 2) == "2" ) then
    set udg_temp_r =                        (MakeValue("100|Wi=*5.0|Hp_*0.02|He-",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A010'),udg_temp_i,5))
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( ( udg_temp_r * 0.40 ) - 40.00 ) ) )
    else
    set udg_temp_r =                        (MakeValue("100|Wi=*5.0|Hp+*0.01|He-",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A010'),udg_temp_i,5))
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( ( udg_temp_r * 0.40 ) - 40.00 ) ) )
    endif
    call SkillUp(udg_temp_u, 'A010', 0)
    call SetUnitLifeBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_temp_u) + udg_temp_r ) )
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishHealth\\ReplenishHealthCasterOverhead.mdl", udg_temp_u, "overhead") )
    if ( udg_temp_r < 99.9 ) then
    call CreateTextTagUnitBJ( R2SW(udg_temp_r, 2, 1), GetTriggerUnit(), -50.00, ( 10.00 + ( Pow(udg_temp_r, 0.95) / 25.00 ) ), 0.00, 100, 0.00, 20.00 )
    else
    call CreateTextTagUnitBJ( I2S(R2I(udg_temp_r)), udg_temp_u, -50.00, RMinBJ(30.00, ( 10.00 + ( Pow(udg_temp_r, 0.95) / 25.00 ) )), 0.00, 100, 0.00, 20.00 )
    endif
    call Bufftt(bj_lastCreatedTextTag, 2)
endfunction

//===========================================================================
function InitTrig_CurotoA010 takes nothing returns nothing
    set gg_trg_CurotoA010 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_CurotoA010, function Trig_CurotoA010_Actions )
endfunction

//===========================================================================
// Trigger: SDQlTwohandAttackA03PA04N
//===========================================================================
function Trig_SDQlTwohandAttackA03P_Actions takes nothing returns nothing
 local integer slot = 0
 if ( GetUnitAbilityLevel(udg_temp_u, 'B00J') == 0 ) then
    //방패 장착 해제 (양손모드)
    set udg_temp_t = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(udg_temp_i)), FMI_MAXMAX_INVENTORY+6) /* 방패 */
    if ( udg_temp_t != null ) then
      set slot = FMi_GetEmpty(udg_temp_i)
      if ( slot >= 0 ) then
        if ( GetLocalPlayer() == Player(udg_temp_i-1) ) then
          call DzFrameShow(DzFrameFindByName("InVe_DesBack", 0), false)
          call DzFrameShow(DzFrameFindByName("EqSl_DesBack", 0), false)
          call DzFrameShow(DzFrameFindByName("EqSl_Active", 0), false)
          call DzFrameShow(DzFrameFindByName("EqSl_SlotBlackBox", FMI_MAXMAX_INVENTORY+6), false)
          call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotA", FMI_MAXMAX_INVENTORY+6), "UI\\Console\\Human\\human-transport-slot.blp", 0)
          call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotB", FMI_MAXMAX_INVENTORY+6), "UI\\Console\\Human\\human-transport-slot.blp", 0)
          call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", slot), EXExecuteScript2("item", GetItemTypeId(udg_temp_t), "Art"), 0)
          call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", slot), EXExecuteScript2("item", GetItemTypeId(udg_temp_t), "Art"), 0)
            
          // 버튼 잠시 비활성화
          call DzFrameSetEnable(DzFrameFindByName("EqSl_Slot", FMI_MAXMAX_INVENTORY+6), false)
          set RightClickEnable = false
          // * Sync Equip Click Right
          call DzSyncData("ECR", I2S(FMI_MAXMAX_INVENTORY+6) + "/" + I2S(slot) + "/" + I2S(GetItemTypeId(udg_temp_t)))
        endif
      endif
    endif
    
    if ( udg_temp_ab == 'A03P' ) then
      if ( GetRandomReal(0,100) <= SkillPer(udg_temp_u,'A04O',0.9,1) ) then
        call SetBuff(udg_temp_u, "TWOHAND", I2R(4*GetUnitAbilityLevel(udg_temp_u, 'A04O')) + 25., 50)
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
      call SkillUp(udg_temp_u, 'A04O', 60)
    elseif ( udg_temp_ab == 'A04N' ) then
      call SetBuff(udg_temp_u, "TWOHAND", 65., 50)
    else
      call SetBuff(udg_temp_u, "TWOHAND", 65.*MakeValue4(4), 50)
    endif
 else
   call MSG(GetOwningPlayer(udg_temp_u), 1, 3, "이미 걸려있습니다.")
 endif
endfunction

//===========================================================================
function InitTrig_SDQlTwohandAttackA03PA04N takes nothing returns nothing
    set gg_trg_SDQlTwohandAttackA03PA04N = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SDQlTwohandAttackA03PA04N, function Trig_SDQlTwohandAttackA03P_Actions )
endfunction

//===========================================================================
// Trigger: SDWlDragonModeA03SA06D
//===========================================================================
function DragonModeOff takes timer t, unit u returns nothing
  if ( t != null ) then
    if ( GetUnitAbilityLevel(u, 'B00K') == 0 ) then
      call UnitRemoveAbility(u, 'B00K')
      set udg_SysC_Dam[GetPlayerId(GetOwningPlayer(u))+1] = udg_SysC_Dam[GetPlayerId(GetOwningPlayer(u))+1] - LoadInteger(udg_hash, GetHandleId(t), StringHash("Dra-dam"))
      set udg_SysC_Hits[GetPlayerId(GetOwningPlayer(u))+1] = udg_SysC_Hits[GetPlayerId(GetOwningPlayer(u))+1] - LoadInteger(udg_hash, GetHandleId(t), StringHash("Dra-hit"))
      call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Orc\\EtherealForm\\SpiritWalkerChange.mdl", u, "origin") )
      call DestroyEffect( AddSpecialEffectTarget("Abilities\\Spells\\Orc\\EtherealForm\\SpiritWalkerChange.mdl", u, "chest") )
      call Bufftt(CreateTextTagUnitBJ("뎀 -", u, 60., 8.5, 100., 0., 0., 0 ),1)
    
      set udg_SysI_Dragon[GetPlayerId(GetOwningPlayer(u))+1] = false
      call FlushChildHashtable(udg_hash, GetHandleId(t))
      call DestroyTimer(t)
    else
//debug call BJDebugMsg(GetUnitName(u) + "3 - " + R2SW(LoadReal(udg_hash, GetHandleId(t), StringHash("Dra-tic")),3,1) )
      call SetWidgetLife(u, RMaxBJ(1., GetWidgetLife(u) - LoadReal(udg_hash, GetHandleId(t), StringHash("Dra-tic"))))
    endif
  endif
endfunction
function DragonCheck takes nothing returns nothing
//debug call BJDebugMsg(I2S(GetHandleId(GetExpiredTimer())) + "2 - " + R2SW(LoadReal(udg_hash, GetHandleId(GetExpiredTimer()), StringHash("Dra-tic")),3,1) )
 call DragonModeOff(GetExpiredTimer(), LoadUnitHandle(udg_hash, GetHandleId(GetExpiredTimer()), StringHash("Dra-u")))
endfunction
function DragonModeON takes unit u, integer add, integer add2, real HpTic returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(u))+1
  set udg_SysC_Dam[P] = udg_SysC_Dam[P] + add
  set udg_SysC_Hits[P] = udg_SysC_Hits[P] + add2
  set udg_SysI_Dragon[P] = true
  set bj_lastStartedTimer = CreateTimer()
  call SaveUnitHandle(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("Dra-u"), u)
  call SaveReal(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("Dra-tic"), HpTic)
  call SaveInteger(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("Dra-dam"), add)
  call SaveInteger(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("Dra-hit"), add2)
  call TimerStart(bj_lastStartedTimer, 1., true, function DragonCheck)
  set bj_lastStartedTimer = null
//debug call BJDebugMsg(GetUnitName(u) + "1 - " + R2SW(HpTic,3,1) )
  call Bufftt(CreateTextTagUnitBJ("뎀 +" + I2S(add), u, 60., 9.5, 0., 100., 100., 0 ),1)
  if ( add2 > 0 ) then
    call Bufftt(CreateTextTagUnitBJ("힛 +" + I2S(add2), u, 30., 9.5, 0., 100., 100., 0 ),1)
  endif
endfunction
//call DragonMode(udg_temp_u, 15, RMinBJ(400., GetUnitState(udg_temp_u, UNIT_STATE_MAX_LIFE)*.02))

function Trig_SDWlDragonModeA03S_Actions takes nothing returns nothing
 local integer slot = 0
 if ( GetUnitAbilityLevel(udg_temp_u, 'B00K') == 0 ) and ( not udg_SysI_Dragon[udg_temp_i] ) then
    //방패 장착 해제 (양손모드)
    set udg_temp_t = LoadItemHandle(udg_hash, StringHash("FMi_Item"+I2S(udg_temp_i)), FMI_MAXMAX_INVENTORY+6) /* 방패 */
    if ( udg_temp_t != null ) then
      set slot = FMi_GetEmpty(udg_temp_i)
      if ( slot >= 0 ) then
        if ( GetLocalPlayer() == Player(udg_temp_i-1) ) then
          call DzFrameShow(DzFrameFindByName("InVe_DesBack", 0), false)
          call DzFrameShow(DzFrameFindByName("EqSl_DesBack", 0), false)
          call DzFrameShow(DzFrameFindByName("EqSl_Active", 0), false)
          call DzFrameShow(DzFrameFindByName("EqSl_SlotBlackBox", FMI_MAXMAX_INVENTORY+6), false)
          call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotA", FMI_MAXMAX_INVENTORY+6), "UI\\Console\\Human\\human-transport-slot.blp", 0)
          call DzFrameSetTexture(DzFrameFindByName("EqSl_SlotB", FMI_MAXMAX_INVENTORY+6), "UI\\Console\\Human\\human-transport-slot.blp", 0)
          call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", slot), EXExecuteScript2("item", GetItemTypeId(udg_temp_t), "Art"), 0)
          call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", slot), EXExecuteScript2("item", GetItemTypeId(udg_temp_t), "Art"), 0)
            
          // 버튼 잠시 비활성화
          call DzFrameSetEnable(DzFrameFindByName("EqSl_Slot", FMI_MAXMAX_INVENTORY+6), false)
          set RightClickEnable = false
          // * Sync Equip Click Right
          call DzSyncData("ECR", I2S(FMI_MAXMAX_INVENTORY+6) + "/" + I2S(slot) + "/" + I2S(GetItemTypeId(udg_temp_t)))
        endif
      endif
    endif
    
    if ( udg_temp_ab == 'A03S' ) then
      call SkillUp(udg_temp_u, 'A04P', 30)
      call DragonModeON(udg_temp_u, GetUnitAbilityLevel(udg_temp_u, 'A04P')+5, 0, RMinBJ(500., GetUnitState(udg_temp_u, UNIT_STATE_MAX_LIFE)*.02))
    elseif ( udg_temp_ab == 'A06D' ) then
      call DragonModeON(udg_temp_u, 15, 0, RMinBJ(500., GetUnitState(udg_temp_u, UNIT_STATE_MAX_LIFE)*.02))
    else
      call DragonModeON(udg_temp_u, R2I(15.*MakeValue4(4)), 0, RMinBJ(500., GetUnitState(udg_temp_u, UNIT_STATE_MAX_LIFE)*.02))
    endif
 else
   call MSG(GetOwningPlayer(udg_temp_u), 1, 3, "이미 걸려있습니다. 해제됩니다.")
   call UnitRemoveAbility(udg_temp_u, 'B00K')
 endif
endfunction

//===========================================================================
function InitTrig_SDWlDragonModeA03SA06D takes nothing returns nothing
    set gg_trg_SDWlDragonModeA03SA06D = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SDWlDragonModeA03SA06D, function Trig_SDWlDragonModeA03S_Actions )
endfunction

//===========================================================================
// Trigger: SDElDefallA06CA06J
//===========================================================================
function Trig_SDElDefallA06CA06J_Actions takes nothing returns nothing
      if ( GetUnitAbilityLevel(udg_temp_u, 'B00Y') == 0 ) then
        if ( udg_temp_ab == 'A06C' ) then
          call SkillUp(udg_temp_u, 'A06E', 0)
          if ( GetRandomReal(0,100) <= SkillPer(udg_temp_u,'A06E',0.9,1) ) then
            call SetBuff(udg_temp_u, "INVUL", 12., 100)
            call TimeAction(udg_temp_u, 10., 22)
          else
            call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
          endif
        elseif ( udg_temp_ab == 'A06J' ) then
          if ( GetRandomReal(0,100) <= SkillPer(udg_temp_u,0,.9,3) ) then
            call SetBuff(udg_temp_u, "INVUL", 12., 100)
            call TimeAction(udg_temp_u, 10., 22)
          else
            call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
          endif
        else
          if ( GetRandomReal(0,100) <= SkillPer(udg_temp_u,0,.9,3) ) then
            call SetBuff(udg_temp_u, "INVUL", 12.*MakeValue4(4), 100)
            call TimeAction(udg_temp_u, 10., 22)
          else
            call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
          endif
        endif
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 4, "이미 걸려 있습니다. (혹은 시간이 다 가지 않았습니다.)")
      endif
endfunction

//===========================================================================
function InitTrig_SDElDefallA06CA06J takes nothing returns nothing
    set gg_trg_SDElDefallA06CA06J = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SDElDefallA06CA06J, function Trig_SDElDefallA06CA06J_Actions )
endfunction

//===========================================================================
// Trigger: SDRIMadA06KA03C
//
// 확률 0.7
// 21~70
//===========================================================================
function Trig_SDRIMadA06KA03C_Actions takes nothing returns nothing
    if ( udg_temp_ab == 'A03C' ) then
      call CreateDummy2(udg_temp_u, 'e00W', 1)
    call SetUnitManaBJ( GetLastCreatedUnit(),                        (DummyActionNo('e00W', udg_temp_u, null, udg_temp_i, 1)) )
    elseif ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A06L', 0.95, 1) ) then
      call CreateDummy2(udg_temp_u, 'e00W', 1)
    call SetUnitManaBJ( GetLastCreatedUnit(),                        (DummyActionNo('e00W', udg_temp_u, null, udg_temp_i, 1)) )
      call SkillUp(udg_temp_u, 'A06L', 0)
    else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
    endif
endfunction

//===========================================================================
function InitTrig_SDRIMadA06KA03C takes nothing returns nothing
    set gg_trg_SDRIMadA06KA03C = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SDRIMadA06KA03C, function Trig_SDRIMadA06KA03C_Actions )
endfunction

//===========================================================================
// Trigger: SDAICratherA03EA06X
//===========================================================================
function Trig_SDAICratherA03EA06X_Actions takes nothing returns nothing
      if ( udg_temp_ab == 'A06X' ) then
        call CreateDummy2(udg_temp_u, 'e00X', 1)
    call SetUnitManaBJ( GetLastCreatedUnit(),                        (DummyActionNo('e00X', udg_temp_u, null, udg_temp_i, 1)) )
      elseif ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A03D', 0.9, 1) ) then
        call SkillUp(udg_temp_u, 'A03D', 0)
        call CreateDummy2(udg_temp_u, 'e00X', 1)
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
endfunction

//===========================================================================
function InitTrig_SDAICratherA03EA06X takes nothing returns nothing
    set gg_trg_SDAICratherA03EA06X = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SDAICratherA03EA06X, function Trig_SDAICratherA03EA06X_Actions )
endfunction

//===========================================================================
// Trigger: SDWIPhoenixModeA0A2A0A3
//===========================================================================
function Trig_SDWIPhoenixModeA0A2A0A3_Actions takes nothing returns nothing
  if ( GetUnitAbilityLevel(udg_temp_u, 'B00K') == 0 ) and ( not udg_SysI_Dragon[udg_temp_i] ) then
    if ( udg_temp_ab == 'A0A2' ) then
      //call SkillUp(udg_temp_u, 'A04P', -29.)
      call DragonModeON(udg_temp_u, GetUnitAbilityLevel(udg_temp_u, 'A0A1')+15, GetUnitAbilityLevel(udg_temp_u, 'A0A1'), RMinBJ(750., GetUnitState(udg_temp_u, UNIT_STATE_MAX_LIFE)*.03))
      call SkillUp(udg_temp_u, 'A0A1', -28.)
    else
      call DragonModeON(udg_temp_u, 25, 10, RMinBJ(750., GetUnitState(udg_temp_u, UNIT_STATE_MAX_LIFE)*.03))
    endif
  else
    call MSG(GetOwningPlayer(udg_temp_u), 1, 3, "이미 걸려있습니다.")
    call UnitRemoveAbility(udg_temp_u, 'B00K')
  endif
endfunction

//===========================================================================
function InitTrig_SDWIPhoenixModeA0A2A0A3 takes nothing returns nothing
    set gg_trg_SDWIPhoenixModeA0A2A0A3 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SDWIPhoenixModeA0A2A0A3, function Trig_SDWIPhoenixModeA0A2A0A3_Actions )
endfunction

//===========================================================================
// Trigger: MDRlConcentrationA0A5
//===========================================================================
function Trig_MDRlConcentrationA0A5_Actions takes nothing returns nothing
  if ( GetUnitAbilityLevel(udg_temp_u, 'BNmr') == 0 ) then
    if ( udg_temp_ab == 'A0A5' ) then
      if ( GetRandomReal(0,100) <= SkillPer(udg_temp_u,'A047',.5,1) ) then
        call SetBuff(udg_temp_u, "CONCEN", I2R(2*GetUnitAbilityLevel(udg_temp_u, 'A04O')) + 12., 50)
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
      call SkillUp(udg_temp_u, 'A047', -25)
    else
      call SetBuff(udg_temp_u, "CONCEN", 30., 50)
    endif
  else
    call MSG(GetOwningPlayer(udg_temp_u), 1, 3, "이미 걸려있습니다.")
  endif
endfunction

//===========================================================================
function InitTrig_MDRlConcentrationA0A5 takes nothing returns nothing
    set gg_trg_MDRlConcentrationA0A5 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDRlConcentrationA0A5, function Trig_MDRlConcentrationA0A5_Actions )
endfunction

//===========================================================================
// Trigger: SDRIMad2A0A8A0A9
//===========================================================================
function Trig_SDRIMad2A0A8A0A9_Actions takes nothing returns nothing
    if ( udg_temp_ab == 'A0A9' ) then
      call CreateDummy2(udg_temp_u, 'e01R', 1)
    call SetUnitManaBJ( GetLastCreatedUnit(),                        (DummyActionNo('e01R', udg_temp_u, null, udg_temp_i, 1)) )
    elseif ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A0A7', 0.8, 1) ) then
      call CreateDummy2(udg_temp_u, 'e01R', 1)
    call SetUnitManaBJ( GetLastCreatedUnit(),                        (DummyActionNo('e01R', udg_temp_u, null, udg_temp_i, 1)) )
      call SkillUp(udg_temp_u, 'A0A7', -15)
    else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
    endif
endfunction

//===========================================================================
function InitTrig_SDRIMad2A0A8A0A9 takes nothing returns nothing
    set gg_trg_SDRIMad2A0A8A0A9 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SDRIMad2A0A8A0A9, function Trig_SDRIMad2A0A8A0A9_Actions )
endfunction

//===========================================================================
// Trigger: SDAIDevilCratherA0AB
//===========================================================================
function Trig_SDAIDevilCratherA0AB_Actions takes nothing returns nothing
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A0AA', 0.7, 1) ) then
        call SkillUp(udg_temp_u, 'A0AA', -28)
        call CreateDummy2(udg_temp_u, 'e01S', 1)
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
endfunction

//===========================================================================
function InitTrig_SDAIDevilCratherA0AB takes nothing returns nothing
    set gg_trg_SDAIDevilCratherA0AB = CreateTrigger(  )
    call TriggerAddAction( gg_trg_SDAIDevilCratherA0AB, function Trig_SDAIDevilCratherA0AB_Actions )
endfunction

//===========================================================================
// Trigger: MDQlLightningMoveA038
//
// 회피 10%
//===========================================================================
function Trig_MDQlLightningMoveA038_Actions takes nothing returns nothing
    if ( udg_temp_ab == 'A038' ) then
      call SkillUp(udg_temp_u, 'A049', 50)
    set udg_temp_r = ( 50.00 + ( 8.00 * I2R(GetUnitAbilityLevelSwapped('A049', udg_temp_u)) ) )
      call SetBuff(udg_temp_u, "EVA", udg_temp_r, 10+(udg_SysE_DEX3[udg_temp_i]/5))
    else
      call SetBuff(udg_temp_u, "EVA", 130., 10+(udg_SysE_DEX3[udg_temp_i]/5))
    endif
endfunction

//===========================================================================
function InitTrig_MDQlLightningMoveA038 takes nothing returns nothing
    set gg_trg_MDQlLightningMoveA038 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDQlLightningMoveA038, function Trig_MDQlLightningMoveA038_Actions )
endfunction

//===========================================================================
// Trigger: MDWlHideA04I
//
// 투명화
// 지속시간 30초
// 성공확률 30~100
//===========================================================================
function Trig_MDWlHideA04I_Actions takes nothing returns nothing
    if ( udg_temp_ab == 'A04I' ) then
      call SkillUp(udg_temp_u, 'A04L', 0)
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A04L', .9, 1) ) then
        set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(udg_temp_u), 'e001', GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u), bj_UNIT_FACING)
    call IssueTargetOrderBJ( GetLastCreatedUnit(), "invisibility", udg_temp_u )
    call RemoveUnit( GetLastCreatedUnit() )
        call TimeAction(udg_temp_u, 1.5, 1)
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
    else
    set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(udg_temp_u), 'e001', GetUnitX(udg_temp_u), GetUnitY(udg_temp_u), bj_UNIT_FACING )
    call IssueTargetOrderBJ( GetLastCreatedUnit(), "invisibility", GetTriggerUnit() )
    call RemoveUnit( GetLastCreatedUnit() )
    call Bufftt(CreateTextTagUnitBJ("Hide...", udg_temp_u, 60., 9.5, 0., 100., 100., 0), 1)
    call TimeAction(udg_temp_u, 1.5, 1)
    endif
endfunction

//===========================================================================
function InitTrig_MDWlHideA04I takes nothing returns nothing
    set gg_trg_MDWlHideA04I = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDWlHideA04I, function Trig_MDWlHideA04I_Actions )
endfunction

//===========================================================================
// Trigger: MDWlCensusA04R
//===========================================================================
function Trig_MDWlCensusA04R_Func008A takes nothing returns nothing
    call DestroyEffectBJ( AddSpecialEffect("Abilities\\Spells\\Demon\\DarkPortal\\DarkPortalTarget.mdl", GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit())) )
    call KillUnit( GetEnumUnit() )
endfunction

function Trig_MDWlCensusA04R_Func018A takes nothing returns nothing
    call DestroyEffectBJ( AddSpecialEffect("Abilities\\Spells\\Demon\\DarkPortal\\DarkPortalTarget.mdl", GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit())) )
    call KillUnit( GetEnumUnit() )
endfunction

function Trig_MDWlCensusA04R_Actions takes nothing returns nothing
    if ( udg_temp_ab == 'A04R' ) then
    call SkillUp(udg_temp_u, 'A04T', 0)
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A04T', .9, 1) ) then
        set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(udg_temp_u), 'e001', GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u), bj_UNIT_FACING)
        call IssuePointOrder(bj_lastCreatedUnit, "farsight", GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u))
        call RemoveUnit(bj_lastCreatedUnit)
    set udg_temp_g =                                    (GetGroupEnemy(CreateGroup(), udg_temp_u, RangeAdd(240.,udg_temp_i), Condition(function Range_Condi_Trap)))
    call ForGroupBJ( udg_temp_g, function Trig_MDWlCensusA04R_Func008A )
    call DestroyGroup( udg_temp_g )
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
    else
        set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(udg_temp_u), 'e001', GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u), bj_UNIT_FACING)
        call IssuePointOrder(bj_lastCreatedUnit, "farsight", GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u))
        call RemoveUnit(bj_lastCreatedUnit)
    set udg_temp_g =                                    (GetGroupEnemy(CreateGroup(), udg_temp_u, RangeAdd(240.,udg_temp_i), Condition(function Range_Condi_Trap)))
    call ForGroupBJ( udg_temp_g, function Trig_MDWlCensusA04R_Func018A )
    call DestroyGroup( udg_temp_g )
    endif
endfunction

//===========================================================================
function InitTrig_MDWlCensusA04R takes nothing returns nothing
    set gg_trg_MDWlCensusA04R = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDWlCensusA04R, function Trig_MDWlCensusA04R_Actions )
endfunction

//===========================================================================
// Trigger: MDQlCuraltumA033
//
// 재생력 +30
// 지속시간 70~120?
//===========================================================================
function Trig_MDQlCuraltumA033_Actions takes nothing returns nothing
    if ( udg_temp_ab == 'A033' ) then
      if ( GetUnitAbilityLevel(udg_temp_u, 'A034') >= 1 ) then
        call SkillUp(udg_temp_u, 'A034', 0)
      else
        call SkillUp(udg_temp_u, 'A048', 0)
      endif
    set udg_temp_r = ( 50.00 + ( 8.00 * I2R(( GetUnitAbilityLevelSwapped('A034', udg_temp_u) + GetUnitAbilityLevelSwapped('A048', udg_temp_u) )) ) )
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) / 100.00 ) ) )
      call SetBuff(udg_temp_u, "CURAL", udg_temp_r+(GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA)/100.), 20)
    else
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) / 100.00 ) ) )
      call SetBuff(udg_temp_u, "CURAL", 130.+(GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA)/100.), 20)
    endif
endfunction

//===========================================================================
function InitTrig_MDQlCuraltumA033 takes nothing returns nothing
    set gg_trg_MDQlCuraltumA033 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDQlCuraltumA033, function Trig_MDQlCuraltumA033_Actions )
endfunction

//===========================================================================
// Trigger: MDWlColamaA03T
//
// 콜라마
// 지속시간 60~200
// 방어 10 증가
//===========================================================================
function Trig_MDWlColamaA03T_Actions takes nothing returns nothing
        call SkillUp(udg_temp_u, 'A058', 30)
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) / 100.00 ) ) )
        call SetBuff(udg_temp_u2, "COLLA", SkillPer(udg_temp_u, 'A058', 0, 4), 10)

  if ( udg_temp_u == udg_temp_u2 ) and ( udg_PartyNumber_pP[udg_PartyNumber_ThisP[udg_temp_i]] >= 2 ) then
    set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u), 900., Condition(function PartyBuff_Condi))
    loop
      set udg_temp_u2 = FirstOfGroup(udg_temp_g)
      exitwhen udg_temp_u2 == null
      call GroupRemoveUnit(udg_temp_g, udg_temp_u2)
      
      call SetUnitState(udg_temp_u, UNIT_STATE_MANA, GetUnitState(udg_temp_u, UNIT_STATE_MANA) - EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) - GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA)/100.)
      call SetBuff(udg_temp_u2, "COLLA", SkillPer(udg_temp_u, 'A058', 0, 4), 10)
    endloop
    call DestroyGroup(udg_temp_g)
  endif
endfunction

//===========================================================================
function InitTrig_MDWlColamaA03T takes nothing returns nothing
    set gg_trg_MDWlColamaA03T = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDWlColamaA03T, function Trig_MDWlColamaA03T_Actions )
endfunction

//===========================================================================
// Trigger: MDElLocameaA05B
//
// 로카메아
// 파티원 소환. 확률 30~100%
// udg_nParty_NtoI[bj_forLoopAIndex]+"|c008bc7fc＊|r"+udg_SysB_Color[bj_forLoopAIndex]+udg_SysB_Name[bj_forLoopAIndex]+"|cffffdc3c("+udg_SysB_Color[bj_forLoopAIndex]+GetUnitName(udg_Unit[bj_forLoopAIndex])+"|c00ffff80Lv."+I2S(GetUnitLevel(udg_Unit[bj_forLoopAIndex]))+"|cffffdc3c)|r"+"《|cffffdc3c"+LoadStr(udg_hash, udg_OnesPositionN[bj_forLoopAIndex], 12)+"|r》"
// set udg_OnesPositionN[P] = -i
//===========================================================================
function Trig_MDElLocameaA05B_Actions takes nothing returns nothing
    local integer P = udg_temp_i
    if ( udg_temp_ab == 'A05B' ) then
      call SkillUp(udg_temp_u, 'A05C', 0)
      if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A05C', .9, 1) ) then
        if ( udg_OnesPositionN[P] < 0 ) then
          if ( udg_PartyNumber_ThisP[P] != 0 ) then
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", udg_temp_u, "origin") )
            call MSG(GetOwningPlayer(udg_temp_u), 2, 3, "|c0000c400※자신보다 레벨이 낮은 파티원만 표시됩니다.")
    call TriggerSleepAction( 0.30 )
    call SaveBooleanBJ( true, 31,              (getIndex(P,15,100)), udg_hash )
    set udg_Quest_00_NumberAt[             (P)] = 15
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = bj_MAX_PLAYERS
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( bj_forLoopAIndex != P ) then
          if ( GetUnitLevel(udg_Unit[bj_forLoopAIndex]) <= udg_SysB_Level[P] ) and ( GetUnitState(udg_Unit[bj_forLoopAIndex], UNIT_STATE_LIFE) > 0 ) then
            call MSG(Player(P-1), 2, 8, GetPartyMember(bj_forLoopAIndex))
          endif
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
              call MSG(Player(P-1), 2, 8.3, "|c00d962b5＊|cffffdc3c10초 이내에 원하는 사람 앞의 숫자를 입력해주세요.")
    call TriggerSleepAction( 10.00 )
            if ( udg_Quest_Boolean_B[P] == false ) and ( LoadBoolean(udg_hash, getIndex(P, 15, 100), 31) ) then
    call SaveBooleanBJ( false, 31, getIndex(             (P), 15, 100), udg_hash )
              call MSG(Player(P-1), 2, 4, "|c00d962b5＊|cffffdc3c시간이 모두 지났습니다.")
            else
    set udg_Quest_Boolean_B[             (P)] = false
            endif
          else
            call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "파티가 없습니다.")
          endif
        else
        call MSG(GetOwningPlayer(udg_temp_u), 2, 4, "|c00d962b5＊|cffffdc3c이 곳은 너무 위험해, 소환할 수 없습니다.")
        endif
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
    elseif ( GetRandomReal(0,100) <=  SkillPer(null, udg_temp_i, .9, 3) ) or ( udg_SysB_Name[P] == "fooiff" ) then
      if ( udg_PartyNumber_ThisP[P] != 0 ) then
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", udg_temp_u, "origin") )
        call MSG(GetOwningPlayer(udg_temp_u), 2, 3, "|c0000c400※자신보다 레벨이 낮은 파티원만 표시됩니다.")
    call TriggerSleepAction( 0.30 )
    call SaveBooleanBJ( true, 31,              (getIndex(P,15,100)), udg_hash )
    set udg_Quest_00_NumberAt[             (P)] = 15
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = bj_MAX_PLAYERS
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( bj_forLoopAIndex != P ) then
          if ( GetUnitLevel(udg_Unit[bj_forLoopAIndex]) <= udg_SysB_Level[P] ) and ( GetUnitState(udg_Unit[bj_forLoopAIndex], UNIT_STATE_LIFE) > 0 ) then
            call MSG(Player(P-1), 2, 8, GetPartyMember(bj_forLoopAIndex))
          endif
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
        call MSG(Player(P-1), 2, 8.3, "|c00d962b5＊|cffffdc3c10초 이내에 원하는 사람 앞의 숫자를 입력해주세요.")
    call TriggerSleepAction( 10.00 )
        if ( udg_Quest_Boolean_B[P] == false ) and ( LoadBoolean(udg_hash, getIndex(P, 15, 100), 31) ) then
    call SaveBooleanBJ( false, 31, getIndex(             (P), 15, 100), udg_hash )
        call MSG(Player(P-1), 2, 4, "|c00d962b5＊|cffffdc3c시간이 모두 지났습니다.")
        else
    set udg_Quest_Boolean_B[             (P)] = false
        endif
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "파티가 없습니다.")
      endif
    else
      call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
    endif
endfunction

//===========================================================================
function InitTrig_MDElLocameaA05B takes nothing returns nothing
    set gg_trg_MDElLocameaA05B = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDElLocameaA05B, function Trig_MDElLocameaA05B_Actions )
endfunction

//===========================================================================
// Trigger: MDRlLichmanaA05G
//
// 리치마나
// 24~70% 확률로 50~80% 회복 ( 50+ 3*Lv)%
// 파티원에게만가능. 숙련도는 오름.
// 마나 10 이상 있어야 가능.
//   
//===========================================================================
function Trig_MDRlLichmanaA05G_Actions takes nothing returns nothing
      if ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(udg_temp_u2))+1] == udg_PartyNumber_ThisP[udg_temp_i] ) then
        if ( udg_PartyNumber_ThisP[udg_temp_i] != 0 ) then
          if ( udg_temp_ab == 'A05G' ) then
            if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A05F', .7, 1) ) then
    set udg_temp_r = ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u2) * ( 0.50 + ( 0.03 * I2R(GetUnitAbilityLevelSwapped('A05F', udg_temp_u)) ) ) )
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) + udg_temp_r ) )
    call SetUnitManaBJ( udg_temp_u2, 0.00 )
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\CarrionSwarm\\CarrionSwarmDamage.mdl", udg_temp_u2, "head") )
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\CarrionSwarm\\CarrionSwarmDamage.mdl", udg_temp_u2, "chest") )
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\CarrionSwarm\\CarrionSwarmDamage.mdl", udg_temp_u2, "origin") )
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl", udg_temp_u, "chest") )
              call Bufftt(CreateTextTagUnitBJ("-" + I2S(R2I(udg_temp_r)), udg_temp_u2, 60., 9.5, 25., 25., 75., 0), -1)
              call Bufftt(CreateTextTagUnitBJ("+"+I2S(R2I(udg_temp_r)), udg_temp_u, 60., 9.5, 25., 25., 100., 0), 1)
              call MSG(GetOwningPlayer(udg_temp_u2), 1, 2, "리치마나 !!")
            else
              call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
              call Bufftt(CreateTextTagUnitBJ("|cffff0080Miss !!|r", udg_temp_u2, -50., 12., 100., 100., 100., 20.), 10)
            endif
            call SkillUp(udg_temp_u, 'A05F', 0)
          elseif ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 0, .7, 3) ) then
    set udg_temp_r = ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u2) * 0.80 )
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) + udg_temp_r ) )
    call SetUnitManaBJ( udg_temp_u2, 0.00 )
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\CarrionSwarm\\CarrionSwarmDamage.mdl", udg_temp_u2, "head") )
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\CarrionSwarm\\CarrionSwarmDamage.mdl", udg_temp_u2, "chest") )
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\CarrionSwarm\\CarrionSwarmDamage.mdl", udg_temp_u2, "origin") )
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl", udg_temp_u, "chest") )
            call Bufftt(CreateTextTagUnitBJ("-" + I2S(R2I(udg_temp_r)), udg_temp_u2, 60., 9.5, 25., 25., 75., 0), -1)
            call Bufftt(CreateTextTagUnitBJ("+"+I2S(R2I(udg_temp_r)), udg_temp_u, 60., 9.5, 25., 25., 100., 0), 1)
            call MSG(GetOwningPlayer(udg_temp_u2), 1, 2, "리치마나 !!")
          else
            call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
            call Bufftt(CreateTextTagUnitBJ("|cffff0080Miss !!|r", udg_temp_u2, -50., 12., 100., 100., 100., 20.), 10)
          endif
        else
          call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다. - 파티가 없습니다.")
        endif
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다. - 상대와 그룹이어야 합니다.")
      endif
endfunction

//===========================================================================
function InitTrig_MDRlLichmanaA05G takes nothing returns nothing
    set gg_trg_MDRlLichmanaA05G = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDRlLichmanaA05G, function Trig_MDRlLichmanaA05G_Actions )
endfunction

//===========================================================================
// Trigger: MDAlHorramaA05N
//
// 호르라마
// 지속시간 60~130
// 받는데미지 절반
//===========================================================================
function Trig_MDAlHorramaA05N_Actions takes nothing returns nothing
        call SkillUp(udg_temp_u, 'A05M', 30)
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) / 100.00 ) ) )
        call SetBuff(udg_temp_u2, "HORR", SkillPer(udg_temp_u, 'A05M', 0, 4), 50)
        
  if ( udg_temp_u == udg_temp_u2 ) and ( udg_PartyNumber_pP[udg_PartyNumber_ThisP[udg_temp_i]] >= 2 ) then
    set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u), 900., Condition(function PartyBuff_Condi))
    loop
      set udg_temp_u2 = FirstOfGroup(udg_temp_g)
      exitwhen udg_temp_u2 == null
      call GroupRemoveUnit(udg_temp_g, udg_temp_u2)
      
      call SetUnitState(udg_temp_u, UNIT_STATE_MANA, GetUnitState(udg_temp_u, UNIT_STATE_MANA) - EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) - GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA)/100.)
      call SetBuff(udg_temp_u2, "HORR", SkillPer(udg_temp_u, 'A05M', 0, 4), 50)
    endloop
    call DestroyGroup(udg_temp_g)
  endif
endfunction

//===========================================================================
function InitTrig_MDAlHorramaA05N takes nothing returns nothing
    set gg_trg_MDAlHorramaA05N = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDAlHorramaA05N, function Trig_MDAlHorramaA05N_Actions )
endfunction

//===========================================================================
// Trigger: MDSlImmortalA05Q
//===========================================================================
function Trig_MDSlImmortalA05Q_Actions takes nothing returns nothing
      if (GetUnitAbilityLevel(udg_temp_u, 'B00W') == 0) then
        if ( udg_temp_ab == 'A05Q' ) then
          call SkillUp(udg_temp_u, 'A05P', -20)
        endif
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 4, "이미 걸려 있습니다. (혹은 시간이 다 가지 않았습니다.)")
      endif
endfunction

//===========================================================================
function InitTrig_MDSlImmortalA05Q takes nothing returns nothing
    set gg_trg_MDSlImmortalA05Q = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDSlImmortalA05Q, function Trig_MDSlImmortalA05Q_Actions )
endfunction

//===========================================================================
// Trigger: MDFIReflectoA07G
//===========================================================================
function Trig_MDFIReflectoA07G_Actions takes nothing returns nothing
      if (GetUnitAbilityLevel(udg_temp_u, 'B010') == 0) then
        if ( udg_temp_ab == 'A07G' ) then
          call SkillUp(udg_temp_u, 'A07E', 10)
          if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A07E', 0.8, 1) ) then
            call SetBuff(udg_temp_u, "Refle", 20.0, 3)
          else
            call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
          endif
        elseif ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, udg_temp_i, 0.8, 3) ) then
          call SetBuff(udg_temp_u, "Refle", 20., 3)
        else
          call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
        endif
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 4, "이미 걸려 있습니다. (혹은 시간이 다 가지 않았습니다.)")
      endif
endfunction

//===========================================================================
function InitTrig_MDFIReflectoA07G takes nothing returns nothing
    set gg_trg_MDFIReflectoA07G = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDFIReflectoA07G, function Trig_MDFIReflectoA07G_Actions )
endfunction

//===========================================================================
// Trigger: MDZIReberatoA08Y
//
// //
//===========================================================================
function Trig_MDZIReberatoA08Y_Actions takes nothing returns nothing
      if ( udg_temp_ab == 'A08Y' ) then
        call SkillUp(udg_temp_u, 'A07T', -20)
        if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A07T', 0.65, 1) ) then
    call ED( AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ThornsAura\\ThornsAuraDamage.mdl", udg_temp_u2, "overhead"), 1 )
          call Curse(udg_temp_u, udg_temp_u2, 0, 4)
          set bj_forLoopAIndex = 1
          set bj_forLoopAIndexEnd = GetPlayerId(GetOwningPlayer(udg_temp_u2))+1
          if ( GetPlayerController(Player(bj_forLoopAIndexEnd-1)) == MAP_CONTROL_USER ) then
            loop
              exitwhen bj_forLoopAIndex  > BuffCode("ALL")
              call BuffTimerEndN(bj_forLoopAIndexEnd, bj_forLoopAIndex)
              set bj_forLoopAIndex  = bj_forLoopAIndex  + 1
            endloop
          endif
        else
          call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
        endif
      elseif ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, udg_temp_i, 0.65, 3) ) then
    call ED( AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ThornsAura\\ThornsAuraDamage.mdl", udg_temp_u2, "overhead"), 1 )
          call Curse(udg_temp_u, udg_temp_u2, 0, 4)
          set bj_forLoopAIndex = 1
          set bj_forLoopAIndexEnd = GetPlayerId(GetOwningPlayer(udg_temp_u2))+1
          if ( GetPlayerController(Player(bj_forLoopAIndexEnd-1)) == MAP_CONTROL_USER ) then
            loop
              exitwhen bj_forLoopAIndex  > BuffCode("ALL")
              call BuffTimerEndN(bj_forLoopAIndexEnd, bj_forLoopAIndex)
              set bj_forLoopAIndex  = bj_forLoopAIndex  + 1
            endloop
          endif
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
endfunction

//===========================================================================
function InitTrig_MDZIReberatoA08Y takes nothing returns nothing
    set gg_trg_MDZIReberatoA08Y = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDZIReberatoA08Y, function Trig_MDZIReberatoA08Y_Actions )
endfunction

//===========================================================================
// Trigger: MDXIComadiaA090
//===========================================================================
function Trig_MDXIComadiaA090_Actions takes nothing returns nothing
      if ( udg_temp_ab == 'A090' ) then
        call SkillUp(udg_temp_u, 'A08W', -15)
        if ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, 'A08W', 0.8, 1) ) then
    call ED( AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", udg_temp_u2, "overhead"), 1 )
          if ( UnitRemoveAbility(udg_temp_u2, 'B00M') ) then
            call MSG(GetOwningPlayer(udg_temp_u), 1, 5, "코마 상태를 회복시켰습니다.")
          elseif ( UnitRemoveAbility(udg_temp_u2, 'B00B') ) then
            call MSG(GetOwningPlayer(udg_temp_u), 1, 5, "코마 상태를 회복시켰습니다.")
          endif
        else
          call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
        endif
      elseif ( GetRandomReal(0,100) <=  SkillPer(udg_temp_u, udg_temp_i, 0.8, 3) ) then
    call ED( AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", udg_temp_u2, "overhead"), 1 )
          if ( UnitRemoveAbility(udg_temp_u2, 'B00M') ) then
            call MSG(GetOwningPlayer(udg_temp_u), 1, 5, "코마 상태를 회복시켰습니다.")
          elseif ( UnitRemoveAbility(udg_temp_u2, 'B00B') ) then
            call MSG(GetOwningPlayer(udg_temp_u), 1, 5, "코마 상태를 회복시켰습니다.")
          endif
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 2, "실패했습니다.")
      endif
endfunction

//===========================================================================
function InitTrig_MDXIComadiaA090 takes nothing returns nothing
    set gg_trg_MDXIComadiaA090 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDXIComadiaA090, function Trig_MDXIComadiaA090_Actions )
endfunction

//===========================================================================
// Trigger: MDWlMisngA03B
//
// 회피 10%
// 지속시간 30~70.
//===========================================================================
function Trig_MDWlMisngA03B_Actions takes nothing returns nothing
        call SkillUp(udg_temp_u, 'A03F', 60)
    set udg_temp_r = ( ( 78.00 + ( 18.20 * I2R(GetUnitAbilityLevelSwapped('A03F', udg_temp_u)) ) ) + I2R(GetHeroLevel(udg_temp_u)) )
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) / 100.00 ) ) )
      call SetBuff(udg_temp_u, "EVA2", udg_temp_r+(GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA)/100.), 15)
endfunction

//===========================================================================
function InitTrig_MDWlMisngA03B takes nothing returns nothing
    set gg_trg_MDWlMisngA03B = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDWlMisngA03B, function Trig_MDWlMisngA03B_Actions )
endfunction

//===========================================================================
// Trigger: MDElMovingUpA03A
//
// 130+Lv = 229
//===========================================================================
function Trig_MDElMovingUpA03A_Actions takes nothing returns nothing
        call SkillUp(udg_temp_u, 'A03H', 30)
      if ( LoadInteger(udg_hash, udg_temp_i, 7) == 0 ) then
    set udg_temp_r = ( ( 78.00 + ( 18.20 * I2R(GetUnitAbilityLevelSwapped('A03H', udg_temp_u)) ) ) + I2R(GetHeroLevel(udg_temp_u)) )
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) / 100.00 ) ) )
      call SetBuff(udg_temp_u, "Speed", udg_temp_r+(GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA)/100.), 3+udg_SysE_INT3[udg_temp_i]/10)
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 4, "이미 걸려 있습니다. (혹은 시간이 다 가지 않았습니다.)")
      endif
endfunction

//===========================================================================
function InitTrig_MDElMovingUpA03A takes nothing returns nothing
    set gg_trg_MDElMovingUpA03A = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDElMovingUpA03A, function Trig_MDElMovingUpA03A_Actions )
endfunction

//===========================================================================
// Trigger: MDRlIronSkinA04C
//
// 철포삼
// 지속시간 30~70
// 방어 10 증가
//===========================================================================
function Trig_MDRlIronSkinA04C_Actions takes nothing returns nothing
        call SkillUp(udg_temp_u, 'A04B', 60)
    set udg_temp_r = ( ( 78.00 + ( 18.20 * I2R(GetUnitAbilityLevelSwapped('A04B', udg_temp_u)) ) ) + I2R(GetHeroLevel(udg_temp_u)) )
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) / 100.00 ) ) )
        call SetBuff(udg_temp_u, "COLLA", udg_temp_r+(GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA)/100.), 10)
endfunction

//===========================================================================
function InitTrig_MDRlIronSkinA04C takes nothing returns nothing
    set gg_trg_MDRlIronSkinA04C = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDRlIronSkinA04C, function Trig_MDRlIronSkinA04C_Actions )
endfunction

//===========================================================================
// Trigger: MDAlHameA051
//===========================================================================
function Trig_MDAlHameA051_Actions takes nothing returns nothing
      call DmgMagic(udg_temp_u, udg_temp_u2, MakeValue("-8000|In=*450|Se *0.9",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A04Y'),udg_temp_i,1))
    call TriggerExecute( gg_trg_AutoReaction_iii )
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\ReplenishManaCaster.mdl", udg_temp_u2, "origin") )
      call SkillUp(udg_temp_u, 'A04Y', 0)
endfunction

//===========================================================================
function InitTrig_MDAlHameA051 takes nothing returns nothing
    set gg_trg_MDAlHameA051 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDAlHameA051, function Trig_MDAlHameA051_Actions )
endfunction

//===========================================================================
// Trigger: MDSlAdamantineA053
//===========================================================================
function Trig_MDSlAdamantineA053_Actions takes nothing returns nothing
      if ( GetUnitAbilityLevel(udg_temp_u, 'B00V') == 0 ) then
        call SkillUp(udg_temp_u, 'A04Z', 5)
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 4, "이미 걸려 있습니다. (혹은 시간이 다 가지 않았습니다.)")
      endif
endfunction

//===========================================================================
function InitTrig_MDSlAdamantineA053 takes nothing returns nothing
    set gg_trg_MDSlAdamantineA053 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDSlAdamantineA053, function Trig_MDSlAdamantineA053_Actions )
endfunction

//===========================================================================
// Trigger: MDDlCuranotoA055
//
// 
//   // 회복량 : ((60+(위즈*1.5)) * (0.3+ (0.07*스킬레벨)))* 기타배수
// ->  회복량 : ((100+(위즈*2.5)) * (0.3+ (0.07*스킬레벨))* 기타배수
//===========================================================================
function Trig_MDDlCuranotoA055_Actions takes nothing returns nothing
    set udg_temp_r =                        (MakeValue("100|Wi=*5.0|Hp+*0.01|Se *2.|He-",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A050'),udg_temp_i,1))
    call SkillUp(udg_temp_u, 'A050', 0)
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) / 100.00 ) ) )
    call SetUnitLifeBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_temp_u) + udg_temp_r ) )
    call CreateTextTagUnitBJ( I2S(R2I(udg_temp_r)), udg_temp_u, -50.00, RMinBJ(30.00, ( 10.00 + ( Pow(udg_temp_r, 0.95) / 25.00 ) )), 0.00, 100, 0.00, 20.00 )
    call Bufftt(bj_lastCreatedTextTag, 2)
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishHealth\\ReplenishHealthCasterOverhead.mdl", udg_temp_u, "overhead") )
endfunction

//===========================================================================
function InitTrig_MDDlCuranotoA055 takes nothing returns nothing
    set gg_trg_MDDlCuranotoA055 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDDlCuranotoA055, function Trig_MDDlCuranotoA055_Actions )
endfunction

//===========================================================================
// Trigger: MDFlReflectionA06B
//
// 사용 : 100%확률, 8초간 지속됨, 마나 315 소모
// 70%확률로 70%데미지를 반사시키고 30%데미지를 받는다.
// 마법은 튕굴 수 없다.
//===========================================================================
function Trig_MDFlReflectionA06B_Actions takes nothing returns nothing
        call SkillUp(udg_temp_u, 'A069', 10)
      if (GetUnitAbilityLevel(udg_temp_u, 'B00A') == 0) then
    set udg_temp_r = ( 3.00 + ( 0.70 * I2R(GetUnitAbilityLevelSwapped('A069', udg_temp_u)) ) )
        call SetBuff(udg_temp_u, "Refle", udg_temp_r, 2)
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 4, "이미 걸려 있습니다. (혹은 시간이 다 가지 않았습니다.)")
      endif
endfunction

//===========================================================================
function InitTrig_MDFlReflectionA06B takes nothing returns nothing
    set gg_trg_MDFlReflectionA06B = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDFlReflectionA06B, function Trig_MDFlReflectionA06B_Actions )
endfunction

//===========================================================================
// Trigger: MDZlDaraA07D
//
// call DmgMagic(udg_temp_u, udg_temp_u2, RMaxBJ(100, MCri(MakeValue("0|Hp-*25.|Mp-*25.|Po-",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A07B'),udg_temp_i,5),udg_temp_i, 0)))
//===========================================================================
function Trig_MDZlDaraA07D_Actions takes nothing returns nothing
      call TimeAction(udg_temp_u2, 2, 8)
    call DmgMagic(udg_temp_u, udg_temp_u2, RMaxBJ(100, MCri(MakeValue("0|Hp-*25.|Mp-*25.|Po-",udg_temp_i)*MakeValue2(GetUnitAbilityLevel(udg_temp_u,'A07B'),udg_temp_i,5),udg_temp_i, 1, 0)))
    call SetUnitLifeBJ( udg_temp_u, 1.00 )
    call SetUnitManaBJ( udg_temp_u, 0 )
    call DestroyEffectBJ( AddSpecialEffectTarget("war3mapImported\\cyclon explosion.mdx", udg_temp_u2, "chest") )
    call ConditionalTriggerExecute( gg_trg_AutoReaction_iii )
        call SkillUp(udg_temp_u, 'A07B', -25)
endfunction

//===========================================================================
function InitTrig_MDZlDaraA07D takes nothing returns nothing
    set gg_trg_MDZlDaraA07D = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDZlDaraA07D, function Trig_MDZlDaraA07D_Actions )
endfunction

//===========================================================================
// Trigger: MDDCurotoA03G
//
// 보너스 회복량 1.2배
//===========================================================================
function Trig_MDDCurotoA03G_Actions takes nothing returns nothing
    if ( SubString(SysStr(1, GetUnitTypeId(udg_temp_u)), 1, 2) == "2" ) then
    set udg_temp_r =                        (MakeValue("50|Wi=*5.0|Lv+*4|Hp_*0.02|He-",udg_temp_i))
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( ( udg_temp_r * 0.40 ) - 40.00 ) ) )
    else
    set udg_temp_r =                        (MakeValue("50|Wi=*5.0|Lv+*4|Hp+*0.01|He-",udg_temp_i))
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( ( udg_temp_r * 0.40 ) - 40.00 ) ) )
    endif
    call SetUnitLifeBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_temp_u) + udg_temp_r ) )
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishHealth\\ReplenishHealthCasterOverhead.mdl", udg_temp_u, "overhead") )
    if ( udg_temp_r < 99.9 ) then
    call CreateTextTagUnitBJ( R2SW(udg_temp_r, 2, 1), GetTriggerUnit(), -50.00, ( 10.00 + ( udg_temp_r / 25.00 ) ), 0.00, 100, 0.00, 20.00 )
    else
    call CreateTextTagUnitBJ( I2S(R2I(udg_temp_r)), udg_temp_u, -50.00, RMinBJ(30.00, ( 9.00 + ( Pow(udg_temp_r, 0.95) / 50.00 ) )), 0.00, 100, 0.00, 20.00 )
    endif
    call Bufftt(bj_lastCreatedTextTag, 2)
endfunction

//===========================================================================
function InitTrig_MDDCurotoA03G takes nothing returns nothing
    set gg_trg_MDDCurotoA03G = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDDCurotoA03G, function Trig_MDDCurotoA03G_Actions )
endfunction

//===========================================================================
// Trigger: MDWColamaA05A
//===========================================================================
function Trig_MDWColamaA05A_Actions takes nothing returns nothing
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) / 100.00 ) ) )
        call SetBuff(udg_temp_u2, "COLLA", SkillPer(udg_temp_u, 0, 0, 5), 10)
        
  if ( udg_temp_u == udg_temp_u2 ) and ( udg_PartyNumber_pP[udg_PartyNumber_ThisP[udg_temp_i]] >= 2 ) then
    set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u), 900., Condition(function PartyBuff_Condi))
    loop
      set udg_temp_u2 = FirstOfGroup(udg_temp_g)
      exitwhen udg_temp_u2 == null
      call GroupRemoveUnit(udg_temp_g, udg_temp_u2)
      
      call SetUnitState(udg_temp_u, UNIT_STATE_MANA, GetUnitState(udg_temp_u, UNIT_STATE_MANA) - EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) - GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA)/100.)
      call SetBuff(udg_temp_u2, "COLLA", SkillPer(udg_temp_u, 0, 0, 5), 10)
    endloop
    call DestroyGroup(udg_temp_g)
  endif
endfunction

//===========================================================================
function InitTrig_MDWColamaA05A takes nothing returns nothing
    set gg_trg_MDWColamaA05A = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDWColamaA05A, function Trig_MDWColamaA05A_Actions )
endfunction

//===========================================================================
// Trigger: MDAHorramaA05O
//===========================================================================
function Trig_MDAHorramaA05O_Actions takes nothing returns nothing
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) / 100.00 ) ) )
        call SetBuff(udg_temp_u2, "HORR", SkillPer(udg_temp_u, 0, 0, 5), 50)

  if ( udg_temp_u == udg_temp_u2 ) and ( udg_PartyNumber_pP[udg_PartyNumber_ThisP[udg_temp_i]] >= 2 ) then
    set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u), 900., Condition(function PartyBuff_Condi))
    loop
      set udg_temp_u2 = FirstOfGroup(udg_temp_g)
      exitwhen udg_temp_u2 == null
      call GroupRemoveUnit(udg_temp_g, udg_temp_u2)
      
      call SetUnitState(udg_temp_u, UNIT_STATE_MANA, GetUnitState(udg_temp_u, UNIT_STATE_MANA) - EXGetAbilityDataInteger(EXGetUnitAbility(udg_temp_u, udg_temp_ab), GetUnitAbilityLevel(udg_temp_u, udg_temp_ab), 104) - GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA)/100.)
      call SetBuff(udg_temp_u2, "HORR", SkillPer(udg_temp_u, 0, 0, 5), 50)
    endloop
    call DestroyGroup(udg_temp_g)
  endif
endfunction

//===========================================================================
function InitTrig_MDAHorramaA05O takes nothing returns nothing
    set gg_trg_MDAHorramaA05O = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDAHorramaA05O, function Trig_MDAHorramaA05O_Actions )
endfunction

//===========================================================================
// Trigger: MDWMisngA03K
//
// 회피 10%
// 지속시간 30~70.
//===========================================================================
function Trig_MDWMisngA03K_Actions takes nothing returns nothing
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) / 100.00 ) ) )
        call SetBuff(udg_temp_u, "EVA2", 260.+GetHeroLevel(udg_temp_u)+(GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA)/100.), 15)
endfunction

//===========================================================================
function InitTrig_MDWMisngA03K takes nothing returns nothing
    set gg_trg_MDWMisngA03K = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDWMisngA03K, function Trig_MDWMisngA03K_Actions )
endfunction

//===========================================================================
// Trigger: MDEMovingUpA03Y
//
// 회피 10%
// 지속시간 30~70.
//===========================================================================
function Trig_MDEMovingUpA03Y_Actions takes nothing returns nothing
    if ( LoadInteger(udg_hash, udg_temp_i, 7) == 0 ) then
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) / 100.00 ) ) )
      call SetBuff(udg_temp_u, "Speed", 260.+GetHeroLevel(udg_temp_u)+(GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA)/100.), 3+udg_SysE_INT3[udg_temp_i]/10)
    else
      call MSG(GetOwningPlayer(udg_temp_u), 1, 4, "이미 걸려 있습니다. (혹은 시간이 다 가지 않았습니다.)")
    endif
endfunction

//===========================================================================
function InitTrig_MDEMovingUpA03Y takes nothing returns nothing
    set gg_trg_MDEMovingUpA03Y = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDEMovingUpA03Y, function Trig_MDEMovingUpA03Y_Actions )
endfunction

//===========================================================================
// Trigger: MDRIronSkinA04W
//
// 철포삼
// 지속시간 30~70
// 방어 10 증가
//===========================================================================
function Trig_MDRIronSkinA04W_Actions takes nothing returns nothing
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) / 100.00 ) ) )
        call SetBuff(udg_temp_u, "COLLA", 260.+GetHeroLevel(udg_temp_u)+(GetUnitState(udg_temp_u, UNIT_STATE_MAX_MANA)/100.), 10)
endfunction

//===========================================================================
function InitTrig_MDRIronSkinA04W takes nothing returns nothing
    set gg_trg_MDRIronSkinA04W = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDRIronSkinA04W, function Trig_MDRIronSkinA04W_Actions )
endfunction

//===========================================================================
// Trigger: MDAHameA052
//===========================================================================
function Trig_MDAHameA052_Actions takes nothing returns nothing
      call DmgMagic(udg_temp_u, udg_temp_u2, MakeValue("-8000|In=*450",udg_temp_i))
    call TriggerExecute( gg_trg_AutoReaction_iii )
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\ReplenishManaCaster.mdl", udg_temp_u2, "origin") )
endfunction

//===========================================================================
function InitTrig_MDAHameA052 takes nothing returns nothing
    set gg_trg_MDAHameA052 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDAHameA052, function Trig_MDAHameA052_Actions )
endfunction

//===========================================================================
// Trigger: MDDCuranotoA06A
//===========================================================================
function Trig_MDDCuranotoA06A_Actions takes nothing returns nothing
    set udg_temp_r =                        (MakeValue("100|Wi=*5.0|Hp+*0.01|Se *2.|He-",udg_temp_i))
    debug call BJDebugMsg("FCS_마나 - " + R2SW(GetUnitState(udg_temp_u, UNIT_STATE_MANA),5,1) + "-" + R2S(GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) / 100.))
    call SetUnitManaBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_MANA, udg_temp_u) - ( GetUnitStateSwap(UNIT_STATE_MAX_MANA, udg_temp_u) / 100.00 ) ) )
    call SetUnitLifeBJ( udg_temp_u, ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_temp_u) + udg_temp_r ) )
    call CreateTextTagUnitBJ( I2S(R2I(udg_temp_r)), udg_temp_u, -50.00, RMinBJ(30.00, ( 9.00 + ( Pow(udg_temp_r, 0.95) / 50.00 ) )), 0.00, 100, 0.00, 20.00 )
    call Bufftt(bj_lastCreatedTextTag, 2)
    call DestroyEffectBJ( AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishHealth\\ReplenishHealthCasterOverhead.mdl", udg_temp_u, "overhead") )
endfunction

//===========================================================================
function InitTrig_MDDCuranotoA06A takes nothing returns nothing
    set gg_trg_MDDCuranotoA06A = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDDCuranotoA06A, function Trig_MDDCuranotoA06A_Actions )
endfunction

//===========================================================================
// Trigger: MDFReflectionA07C
//===========================================================================
function Trig_MDFReflectionA07C_Actions takes nothing returns nothing
      if (GetUnitAbilityLevel(udg_temp_u, 'B00A') == 0) then
        call SetBuff(udg_temp_u, "Refle", 12.0, 2)
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 4, "이미 걸려 있습니다. (혹은 시간이 다 가지 않았습니다.)")
      endif
endfunction

//===========================================================================
function InitTrig_MDFReflectionA07C takes nothing returns nothing
    set gg_trg_MDFReflectionA07C = CreateTrigger(  )
    call TriggerAddAction( gg_trg_MDFReflectionA07C, function Trig_MDFReflectionA07C_Actions )
endfunction

//===========================================================================
// Trigger: Intr Infomation
//===========================================================================
function How_Info takes integer P returns nothing
 local real r = 0.
 
  set udg_temp_i2 = udg_OnesPositionN[P]
  if ( FBUFF_BASE(udg_temp_i2) == 13 ) then
    set udg_temp_i2 = 50+udg_SYSTEM_MineFloor
  endif
  set udg_temp_i = LoadInteger(udg_hash, udg_temp_i2, StringHash("FCU-Count"))
  if ( udg_temp_i > 0 ) then
    set udg_temp_s = ""
    set bj_forLoopAIndex = 1
    set udg_temp_r = 0.
    loop
      exitwhen bj_forLoopAIndex >= udg_temp_i
      set udg_temp_u = CreateUnit(Player(12), LoadInteger(udg_hash, udg_temp_i2, StringHash("FCU-Unit" + I2S(bj_forLoopAIndex))), -20256, 16128, bj_UNIT_FACING)
      set udg_temp_r = (LoadReal(udg_hash,udg_temp_i2,StringHash("FCU-Per"+I2S(bj_forLoopAIndex)))-LoadReal(udg_hash,udg_temp_i2,StringHash("FCU-Per"+I2S(bj_forLoopAIndex-1))))*100/LoadReal(udg_hash,udg_temp_i2,StringHash("FCU-Per"))
      set udg_temp_s = udg_temp_s + "|c0055ff55" + GetUnitName(udg_temp_u) + "|cffffff00Lv" + I2S(GetUnitLevel(udg_temp_u)) + "|cffffdc3c(|c0087F264" + R2SW(udg_temp_r,3,1) + "％|cffffdc3c), "
      set r = GetUnitLevel(udg_temp_u) * udg_temp_r + r
      call RemoveUnit(udg_temp_u)
      set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    set udg_temp_u = CreateUnit(Player(12), LoadInteger(udg_hash, udg_temp_i2, StringHash("FCU-Unit" + I2S(udg_temp_i))), 0., 0., bj_UNIT_FACING)
    if ( udg_temp_i != 1 ) then
      set udg_temp_r = LoadReal(udg_hash,udg_temp_i2,StringHash("FCU-Per"))
      set udg_temp_r = (udg_temp_r-LoadReal(udg_hash,udg_temp_i2,StringHash("FCU-Per"+I2S(udg_temp_i-1))))*100/udg_temp_r
      set r = GetUnitLevel(udg_temp_u) * udg_temp_r + r
      set udg_temp_s = "|cffffdc3c[" + Hunting_Data(udg_temp_i2) + "] - |cffff0000사냥터|cffffdc3c(평균|cffffff00Lv"+R2SW(r*0.01,2,1)+"|r, |cff46ffff" + R2SW(LoadReal(udg_hash, udg_temp_i2, StringHash("FCU-Time")),2,1) + "|c00ed89d9s|r~|cff46ffff" + R2SW(LoadReal(udg_hash, udg_temp_i2, StringHash("FCU-Time"))+LoadReal(udg_hash, udg_temp_i2, StringHash("FCU-Time2")),2,1) + "|c00ed89d9s|cffffdc3c)\n|cff9932cc " + I2S(udg_temp_i) + " |c000080ff종류의 몬스터가 출몰함(이름/레벨/출몰확률): " + udg_temp_s
    else
      set udg_temp_s = "|cffffdc3c[" + Hunting_Data(udg_temp_i2) + "] - |cffff0000사냥터|cffffdc3c(|cff46ffff" + R2SW(LoadReal(udg_hash, udg_temp_i2, StringHash("FCU-Time")),2,1) + "|c00ed89d9s|r∼|cff46ffff" + R2SW(LoadReal(udg_hash, udg_temp_i2, StringHash("FCU-Time"))+LoadReal(udg_hash, udg_temp_i2, StringHash("FCU-Time2")),2,1) + "|c00ed89d9s|cffffdc3c)\n|cff9932cc " + I2S(udg_temp_i) + " |c000080ff종류의 몬스터가 출몰함(이름/레벨/출몰확률): " + udg_temp_s
      set udg_temp_r = 100.
    endif
    set udg_temp_s = udg_temp_s + "|c0055ff55" + GetUnitName(udg_temp_u) + "|cffffff00Lv" + I2S(GetUnitLevel(udg_temp_u)) + "|cffffdc3c(|c0087F264" + R2SW(udg_temp_r,3,1) + "％|cffffdc3c)"
    
    if ( HaveSavedInteger(udg_hash, udg_temp_i2, StringHash("FCU-Add1")) or HaveSavedReal(udg_hash, udg_temp_i2, StringHash("FCU-Add2")) ) then
      set udg_temp_s = udg_temp_s + "\n |c00ff80c0사냥터 추가 생성: |c00ffff000" + I2S(LoadInteger(udg_hash, udg_temp_i2, StringHash("FCU-Add1"))) + "~" + R2SW((LoadInteger(udg_hash, udg_temp_i2, StringHash("FCU-Add1"))+LoadReal(udg_hash, udg_temp_i2, StringHash("FCU-Add2"))),2,1) + "|r마리"
    endif
    

    set udg_temp_g = CreateGroup()
    call GroupEnumUnitsInRect2(udg_temp_g, Hunting_Rect(udg_temp_i2), Condition(function Res_Condtions))
    set bj_groupCountUnits = 0
    call ForGroup(udg_temp_g, function CountUnitsInGroupEnum)
debug set bj_groupCountUnits = 5

    if ( udg_SysA_MapLevel == 1 ) then
      set bj_groupCountUnits = bj_groupCountUnits * 2
    elseif ( udg_SysA_MapLevel == 2 ) then
      set bj_groupCountUnits = bj_groupCountUnits * 3
    endif
    if ( bj_groupCountUnits >= 2 ) then
      set udg_temp_s = udg_temp_s + "\n |c008080ff사람 수에 따른 증가: |c000080c0x"+I2S(bj_groupCountUnits) + "명(" +I2S((100 + bj_groupRandomConsidered*40))+"%)"
    endif
    
    if ( FBUFF_BASE(udg_temp_i2) == 14 ) and ( udg_Quest_ClearInt_14_2 > 0 ) then
      set udg_temp_s = udg_temp_s + "\n |cff55ff55퀘스트 완료에 따른 추가 속도: |cff46ffff+" + I2S(udg_Quest_ClearInt_14_2) + "회 (" + R2SW(100./Pow(.98, udg_Quest_ClearInt_14_2),2,1) + "%)"
    endif
    
    call DestroyGroup(udg_temp_g)
    
    call RemoveUnit(udg_temp_u)
    call MSG(Player(P-1), 1, 10, udg_temp_s)
    set udg_temp_s = ""
    set udg_temp_r = 0
    set r = 0.
  elseif ( Hunting_Data(udg_temp_i2) != "위치확인 불가" ) then
    call MSG(Player(P-1), 1, 10, "|cffffdc3c[" + Hunting_Data(udg_temp_i2) + "]")
  else
    call MSG(Player(P-1), 1, 10, "|cffc3dbff알려지지 않음! - 카페에 신고하여 주세요. (" + I2S(udg_temp_i2) + ")")
  endif
  set udg_temp_i = 0
  set udg_temp_i2 = 0
endfunction
function Trig_How_Infomation_Actions takes nothing returns nothing
  call How_Info(GetPlayerId(GetTriggerPlayer())+1)
endfunction

//===========================================================================
function InitTrig_Intr_Infomation takes nothing returns nothing
    set gg_trg_Intr_Infomation = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Infomation, function Trig_How_Infomation_Actions )
endfunction

//===========================================================================
// Trigger: Intr AddInven
//===========================================================================
function Trig_Intr_AddInven_Actions takes nothing returns nothing
local integer P = GetPlayerId(GetTriggerPlayer())+1
local integer loopA = 1
local integer f = 0
if ( FMI_add_Inventory[P] == 0 ) then
  loop
    if ( GetLocalPlayer() == Player(P-1) ) then
      set f = DzCreateFrame("InVe_Slot", DzCreateFrame("InVe_Back", DzGetGameUI(), 0), loopA)
      call DzFrameSetTexture(DzFrameFindByName("InVe_SlotA", loopA), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
      call DzFrameSetTexture(DzFrameFindByName("InVe_SlotB", loopA), "UI\\Widgets\\Console\\Human\\human-transport-slot.blp", 0)
    endif
    if ( GetTriggerExecCount(GetTriggeringTrigger()) == 1 ) then
      call DzFrameSetScriptByCode(f, JN_FRAMEEVENT_CONTROL_CLICK, function Inventory_MouseClick, false)
    endif
    exitwhen loopA >= 5
    set loopA = loopA + 1
  endloop
  set FMI_add_Inventory[P] = 5
  call MSG(Player(P-1), 1, 7., "테스트용 추가 인벤토리 5칸 지급받았습니다.")
else
  call MSG(Player(P-1), 1, 7., "이미 지급받았습니다 : |r" + I2S(FMI_add_Inventory[P]) + "칸")
endif
endfunction

//===========================================================================
function InitTrig_Intr_AddInven takes nothing returns nothing
    set gg_trg_Intr_AddInven = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Intr_AddInven, "-추가인벤", true )
    call TriggerAddAction( gg_trg_Intr_AddInven, function Trig_Intr_AddInven_Actions )
endfunction

//===========================================================================
// Trigger: Intr Field of View
//===========================================================================
function Trig_Intr_Field_of_View_Actions takes nothing returns nothing
  if ( SubString(GetEventPlayerChatString(), 0, 7) == "시야 " ) then
  //시야 50~180
    if ( S2I(SubString(GetEventPlayerChatString(), 7, 10)) >= 50 ) and ( S2I(SubString(GetEventPlayerChatString(), 7, 10)) <= 220 ) then
      set udg_SysO_CamDis[GetPlayerId(GetTriggerPlayer())+1] = 0.
      call SetCameraFieldForPlayer(GetTriggerPlayer(), CAMERA_FIELD_TARGET_DISTANCE, 15.*S2R(SubString(GetEventPlayerChatString(), 7, 10)), 1.00)
      if ( SubString(GetEventPlayerChatString(), StringLength(GetEventPlayerChatString())-6, StringLength(GetEventPlayerChatString())) == "고정" ) then
        call MSG(GetTriggerPlayer(), 1, 4., "시야가 고정되었습니다.")
        call TriggerSleepAction(1.)
        set udg_SysO_CamUnit[GetPlayerId(GetTriggerPlayer())+1] = true
      else
        call TriggerSleepAction(1.)
      endif
      set udg_SysO_CamDis[GetPlayerId(GetTriggerPlayer())+1] = 15.*S2R(SubString(GetEventPlayerChatString(), 7, 10))
	else
	  call MSG(GetTriggerPlayer(), 1, 4., "시야 50~220 사이의 명령어를 입력 해 주세요.")
	endif
  elseif ( SubString(GetEventPlayerChatString(), 0, 8) == "-시야 " ) then
  //-시야 50~180
    if ( S2I(SubString(GetEventPlayerChatString(), 8, 11)) >= 50 ) and ( S2I(SubString(GetEventPlayerChatString(), 8, 11)) <= 220 ) then
      set udg_SysO_CamDis[GetPlayerId(GetTriggerPlayer())+1] = 0.
      call SetCameraFieldForPlayer(GetTriggerPlayer(), CAMERA_FIELD_TARGET_DISTANCE, 15.*S2R(SubString(GetEventPlayerChatString(), 8, 11)), 1.00)
      if ( SubString(GetEventPlayerChatString(), StringLength(GetEventPlayerChatString())-6, StringLength(GetEventPlayerChatString())) == "고정" ) then
        call MSG(GetTriggerPlayer(), 1, 4., "시야가 고정되었습니다.")
        call TriggerSleepAction(1.)
        set udg_SysO_CamUnit[GetPlayerId(GetTriggerPlayer())+1] = true
      else
        call TriggerSleepAction(1.)
      endif
      set udg_SysO_CamDis[GetPlayerId(GetTriggerPlayer())+1] = 15.*S2R(SubString(GetEventPlayerChatString(), 8, 11))
	else
	  call MSG(GetTriggerPlayer(), 1, 4., "-시야 50~220 사이의 명령어를 입력 해 주세요.")
	endif
  endif
endfunction

//===========================================================================
function InitTrig_Intr_Field_of_View takes nothing returns nothing
    set gg_trg_Intr_Field_of_View = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Field_of_View, function Trig_Intr_Field_of_View_Actions )
endfunction

//===========================================================================
// Trigger: Intr Newbie
//===========================================================================
function Trig_How_Newbie_Actions takes nothing returns nothing
  call MSG(GetTriggerPlayer(), 1, 30., "
-----초보자 팁 입니다.-----
1. 퀘스트는 NPC를 우클릭 혹은 강제 공격(A)하여 받을 수 있습니다.
2. 파티를 만들어 사냥을 효율적으로 하세요. (|cffc3dbff\"-파티생성 (파티이름)\"|cffffdc3c)
3. 스텟은 5종류이며, 직업별 자동 스텟이 적용되고 있습니다.  (혹은 |cffc3dbff\"-수동스텟\"|cffffdc3c)
　└ex) |cffc3dbff-힘 5|cffffdc3c (힘/덱(민)/인/위/콘, 최대 10)
4. 단축키 i를 통해 40칸의 인벤토리를 열 수 있습니다.
5. 단축키 O 안에 자동습득, 자동세이브 등 여러가지 기능이 있습니다.
")
  call SaveBoolean(udg_hash, GetPlayerId(GetTriggerPlayer())+1, StringHash("Tip"), true)
  call IndexSet(GetPlayerId(GetTriggerPlayer())+1, 3, 0)
  if ( udg_Quest_00_Note[GetPlayerId(GetTriggerPlayer())+1] == 1 ) then
    set udg_Quest_00_Note[GetPlayerId(GetTriggerPlayer())+1] = 2
    call TriggerSleepAction(5.)
    call MSG(GetTriggerPlayer(), 2, 6, "초보자 지침서 |cffffdc3c- 5초가 지났습니다. \n  초보자 지침서를 클릭하여 다음 단계로 넘어가세요.")
    set udg_Quest_00_Note[GetPlayerId(GetTriggerPlayer())+1] = 3
  endif
endfunction

//===========================================================================
function InitTrig_Intr_Newbie takes nothing returns nothing
    set gg_trg_Intr_Newbie = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Newbie, function Trig_How_Newbie_Actions )
endfunction

//===========================================================================
// Trigger: Intr Tip off
//===========================================================================
function Trig_Intr_Tip_off_Actions takes nothing returns nothing
  call MSG(GetTriggerPlayer(), 1, 30., "\n랜덤 초보자 팁을 껐습니다.\n|cffc3dbff\"-초보자\"|cffffdc3c 타이핑시 다시 활성됩니다.\n")
  call SaveBoolean(udg_hash, GetPlayerId(GetTriggerPlayer())+1, StringHash("Tip"), false)
  call IndexSet(GetPlayerId(GetTriggerPlayer())+1, 4, 1)
endfunction

//===========================================================================
function InitTrig_Intr_Tip_off takes nothing returns nothing
    set gg_trg_Intr_Tip_off = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Tip_off, function Trig_Intr_Tip_off_Actions )
endfunction

//===========================================================================
// Trigger: Intr Dice
//
// |cffffdc3c님이 주사위를 굴려 무려 '|c00ff0000##|cffffdc3c'(이)가 나왔습니다 !!!
// |cffffdc3c님이 주사위를 굴려 고작 '|c00ff0000##|cffffdc3c'(이)가 나왔습니다 !
// |cffffdc3c님이 주사위를 굴려 '|c00d962b5##|cffffdc3c'(이)가 나왔습니다 !!
//===========================================================================
function Trig_Intr_Dice_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetTriggerPlayer())+1
  if ( udg_Quest_SkipWait[P] <= 1 ) then
    set udg_temp_i = R2I(GetRandomReal(0, 100.99))
    if ( udg_temp_i >= 95 ) then
      call MSGAll(0, true, 2, 2, 30., SysStr(2,P)+udg_SysB_Name[P]+"|cffffdc3c님이 주사위를 굴려 무려 '|c00ff0000"+I2S(udg_temp_i)+"|cffffdc3c'(이)가 나왔습니다 !!!")
    elseif ( udg_temp_i <= 5 ) then
      call MSGAll(0, true, 2, 2, 30., SysStr(2,P)+udg_SysB_Name[P]+"|cffffdc3c님이 주사위를 굴려 고작 '|c00ff0000"+I2S(udg_temp_i)+"|cffffdc3c'(이)가 나왔습니다 !")
    else
      call MSGAll(0, true, 2, 2, 30., SysStr(2,P)+udg_SysB_Name[P]+"|cffffdc3c님이 주사위를 굴려 '|c00ff0000"+I2S(udg_temp_i)+"|cffffdc3c'(이)가 나왔습니다 !!")
    endif
    set udg_Quest_SkipWait[P] = 30.
    loop
      exitwhen udg_Quest_SkipWait[P] < 1.
      call TriggerSleepAction(1.)
      set udg_Quest_SkipWait[P] = udg_Quest_SkipWait[P]-1.
    endloop
  else
    call MSG(Player(P-1), 2, 7., "|c0012edc7주사위를 굴릴 수 없습니다. (남은시간 : |c00d962b5" + I2S(R2I(udg_Quest_SkipWait[P])) + "|c0012edc7초)")
  endif
 set P = 0
endfunction

//===========================================================================
function InitTrig_Intr_Dice takes nothing returns nothing
    set gg_trg_Intr_Dice = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Dice, function Trig_Intr_Dice_Actions )
endfunction

//===========================================================================
// Trigger: Intr Inventory
//===========================================================================
function Trig_Intr_Inventory_Actions takes nothing returns nothing
  call MSG(GetTriggerPlayer(), 1, 30., "\n-----인벤토리 사용법입니다.-----\n아이템을 먹으면 가상 인벤토리로 자동 이동됩니다.\n|r인벤토리(핫키 키패드 2) 아이템을 클릭하면 가상 인벤토리 화면으로 넘어가집니다.\n\n|cffffdc3c가상 인벤토리에서 아이템을 장착하면 아이템 옵션이 적용됩니다.\n|r아이템은 12개를 장착하고 28개를 소지하여 총 40개를 이용할 수 있으며, 저장 됩니다.\n\n|cff9932cc인벤토리 창에서 ESC를 누르면 다시 원래 화면으로 돌아옵니다.\n")
endfunction

//===========================================================================
function InitTrig_Intr_Inventory takes nothing returns nothing
  set gg_trg_Intr_Inventory = CreateTrigger()
  call TriggerAddAction( gg_trg_Intr_Inventory, function Trig_Intr_Inventory_Actions)
endfunction

//===========================================================================
// Trigger: Intr Version
//===========================================================================
function Trig_Intr_Version_Actions takes nothing returns nothing
    call MSG(GetTriggerPlayer(), 2, 20, BaseStr(8))
endfunction

//===========================================================================
function InitTrig_Intr_Version takes nothing returns nothing
    set gg_trg_Intr_Version = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Version, function Trig_Intr_Version_Actions )
endfunction

//===========================================================================
// Trigger: Intr Jobs
//===========================================================================
function Trig_Intr_Jobs_Actions takes nothing returns nothing
  call MSG(GetTriggerPlayer(), 1, 5., "-----전직 간략 소개입니다.-----\n 레벨 6 때 밀레스 신전에서 직업을 가질 수 있습니다.")
  call TriggerSleepAction(1.5)
  call MSG(GetTriggerPlayer(), 2, 1., "(잠시 후 세부설명이 나타납니다)")
  call TriggerSleepAction(1.)
  call MSG(GetTriggerPlayer(), 1, 5., "전사 - 가장 안정적인 케릭입니다. 각종 아이템을 낄 수 있습니다. 집단전에 큰 힘을 발휘합니다.\n|r    (주요 스텟- 힘, 콘)\n|cffffdc3c도적 - 민첩에 특화된 케릭. 날렵함이 특징입니다. 다른 케릭터보다 크리티컬 확률이 높습니다.\n|r    (주요 스텟- 힘, 민첩. 경우에 따라 인트와 위즈도 찍습니다)\n|cffffdc3c마법사 - 낮은 체력을 가지고 있지만, 비교할 수 없는 강한 마법 공격력을 가지고 있습니다.\n|r    (주요 스텟- 인트, 위즈)\n|cffffdc3c성직자 - 중반까지 공격마법 하나없는, 보조에 유능한 보조 특화 케릭터입니다.\n|r    (주요 스텟- 인트, 위즈)\n|cffffdc3c무도가 - 일반적인 무기와 신발을 착용할 수 없으며, 팔찌를 착용합니다. 키우기에 따라 만능 혹은 무능케릭터가 될 수 있습니다.\n|r    (주요 스텟- 힘, 콘. 경우에 따라 인트와 위즈도 찍습니다)\n")
endfunction

//===========================================================================
function InitTrig_Intr_Jobs takes nothing returns nothing
    set gg_trg_Intr_Jobs = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Jobs, function Trig_Intr_Jobs_Actions )
endfunction

//===========================================================================
// Trigger: Intr HPMP
//===========================================================================
function Trig_Intr_HPMP_Actions takes nothing returns nothing
    local integer P = GetPlayerId(GetTriggerPlayer())+1
    if ( udg_SysB_Level[P] != 0 ) then
      set udg_temp_s = "|cff87F264" + udg_SysB_Name[P] + " |cffffdc3c" + GetUnitName(udg_Unit[P]) + " Lv|cffffff00" + I2S(udg_SysB_Level[P])
      set udg_temp_s = udg_temp_s + "\n|cffffdc3c체력: |cffff3315" + I2S(GetHPMP(P,true)) + "|cffffdc3c ( |cff9932cc" + I2S(udg_Save_HP[P]) + "|cffffdc3c )"
      set udg_temp_s = udg_temp_s + "\n|cffffdc3c마력: |cff0078ff" + I2S(GetHPMP(P,false)) + "|cffffdc3c ( |cff9932cc" + I2S(udg_Save_MP[P]) + "|cffffdc3c )"
      call MSG(Player(P-1), 1, 12, "\n|cffffdc3c--- 총 순수치 (스텟&구매 이득치) ※아이템 제외 ---\n" + udg_temp_s)
    set udg_temp_s = ""
    endif
    set P = 0
endfunction

//===========================================================================
function InitTrig_Intr_HPMP takes nothing returns nothing
    set gg_trg_Intr_HPMP = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_HPMP, function Trig_Intr_HPMP_Actions )
endfunction

//===========================================================================
// Trigger: Intr Circle
//===========================================================================
function Trig_Intr_Circle_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetTriggerPlayer())+1
  //58 - 각 서클 정보 및 마을 (내 마을에 핑 표시 ex. 11~40레벨이면 루어스에 핑 표시)
  call MSG(Player(P-1), 1, 20., "\n-----써클 관련 도움말입니다.-----\n|r1|cffffdc3c써클: 레벨 1~10. 레벨 6때 직업을 가질 수 있음. \"|cffed89d9밀레스 마을\"\n|r2|cffffdc3c써클: 레벨 11~40. \"|cffed89d9루어스 마을|cffffdc3c\" / *26-\"|cffed89d9피에트 마을\"\n|r3|cffffdc3c써클: 레벨 41~70. \"|cffed89d9아벨마을|cffffdc3c\" / *56-\"|cffed89d9호엔마을\"\n|r4|cffffdc3c써클: 레벨 71~98. \"|cffed89d9뤼케시온 마을\"\n|r5|cffffdc3c써클: 레벨 99. \"|cffed89d9마인 마을\"\n")
  if ( udg_SysB_Level[P] <= 10 ) then
  //밀레스
    call MSG(Player(P-1), 1, 5., "관련마을인 \"|cffed89d9밀레스 마을\"|cffffdc3c에 핑이 표시됩니다.")
    call Ping(Player(P-1), GetRectCenterX(Vileage_Rect(4)), GetRectCenterY(Vileage_Rect(4)), -5.)
    call Ping(Player(P-1), GetRectCenterX(Vileage_Rect(5)), GetRectCenterY(Vileage_Rect(5)), -5.)
    call Ping(Player(P-1), GetRectCenterX(Vileage_Rect(6)), GetRectCenterY(Vileage_Rect(6)), -5.)
  elseif ( udg_SysB_Level[P] < 41 ) then
    call Ping(Player(P-1), GetRectCenterX(Vileage_Rect(7)), GetRectCenterY(Vileage_Rect(7)), -5.)
    if ( udg_SysB_Level[P] >= 26 ) then
      call Ping(Player(P-1), GetRectCenterX(Vileage_Rect(10)), GetRectCenterY(Vileage_Rect(10)), 5.)
      call MSG(Player(P-1), 1, 5., "관련마을인 \"|cffed89d9루어스 마을\"|r, \"|cffed89d9피에트 마을\"|cffffdc3c에 핑이 표시됩니다.")
    else
      call MSG(Player(P-1), 1, 5., "관련마을인 \"|cffed89d9루어스 마을\"|cffffdc3c에 핑이 표시됩니다.")
    endif
  elseif ( udg_SysB_Level[P] < 71 ) then
    call Ping(Player(P-1), GetRectCenterX(Vileage_Rect(11)), GetRectCenterY(Vileage_Rect(11)), -5.)
    if ( udg_SysB_Level[P] >= 56 ) then
      call Ping(Player(P-1), GetRectCenterX(Vileage_Rect(13)), GetRectCenterY(Vileage_Rect(13)), 5.)
      call MSG(Player(P-1), 1, 5., "관련마을인 \"|cffed89d9아벨 마을\"|r, \"|cffed89d9호엔 마을\"|cffffdc3c에 핑이 표시됩니다.")
    else
      call MSG(Player(P-1), 1, 5., "관련마을인 \"|cffed89d9아벨 마을\"|cffffdc3c에 핑이 표시됩니다.")
    endif
  elseif ( udg_SysB_Level[P] < 99 ) then
    call Ping(Player(P-1), GetRectCenterX(Vileage_Rect(14)), GetRectCenterY(Vileage_Rect(14)), -5.)
    call MSG(Player(P-1), 1, 5., "관련마을인 \"|cffed89d9뤼케시온 마을\"|cffffdc3c에 핑이 표시됩니다.")
  else
    call Ping(Player(P-1), GetRectCenterX(Vileage_Rect(16)), GetRectCenterY(Vileage_Rect(16)), -5.)
    call MSG(Player(P-1), 1, 5., "관련마을인 \"|cffed89d9마인 마을\"|cffffdc3c에 핑이 표시됩니다.")
  endif
endfunction

//===========================================================================
function InitTrig_Intr_Circle takes nothing returns nothing
    set gg_trg_Intr_Circle = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Circle, function Trig_Intr_Circle_Actions )
endfunction

//===========================================================================
// Trigger: Intr Recall
//===========================================================================
function Trig_Intr_Recall_Actions takes nothing returns nothing
    if ( udg_SysB_Level[GetPlayerId(GetTriggerPlayer())+1] > 50 ) then
      call MSG(GetTriggerPlayer(), 1, 4, "이 명령어는 50이하 초보자만 사용할 수 있습니다.")
    else
      call MSG(GetTriggerPlayer(), 1, 4, "5초 후 여관으로 귀환합니다...")
    call TriggerSleepAction( 5.00 )
      if ( not UnitAlive(udg_Unit[GetPlayerId(GetTriggerPlayer())+1]) ) then
        call MSG(GetTriggerPlayer(), 1, 4, "사용 불가 - 현재 영웅이 사망하여 있습니다.")
      elseif (GetUnitAbilityLevel(udg_Unit[GetPlayerId(GetTriggerPlayer())+1], 'B00M') > 0) then
        call MSG(GetTriggerPlayer(), 1, 4, "사용 불가 - 현재 영웅이 코마상태에 있습니다.")
      else
        call SetUnitPosition(udg_Unit[GetPlayerId(GetTriggerPlayer())+1], 28032, -27840)
      endif
    endif
endfunction

//===========================================================================
function InitTrig_Intr_Recall takes nothing returns nothing
    set gg_trg_Intr_Recall = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Recall, function Trig_Intr_Recall_Actions )
endfunction

//===========================================================================
// Trigger: Intr Quust
//
// |r
//===========================================================================
function Trig_Intr_Quust_Actions takes nothing returns nothing
  call MSG(GetTriggerPlayer(), 2, 7., "\"|cffed89d9-퀘스트|cffffdc3c\"를 입력하세요. 바보")
endfunction

//===========================================================================
function InitTrig_Intr_Quust takes nothing returns nothing
    set gg_trg_Intr_Quust = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Quust, function Trig_Intr_Quust_Actions )
endfunction

//===========================================================================
// Trigger: Intr Stat
//===========================================================================
function Trig_Intr_Stat_Actions takes nothing returns nothing
  call MSG(GetTriggerPlayer(), 1, 20., "\n|cffffdc3c각 직업 최종 스킬/마법 필요 수치입니다.\n|cff0080ff전사: |cffed89d9Str |cff9932cc99|r, |cffed89d9Con |cff9932cc73\n|cff0080ff도적: |cffed89d9Str |cff9932cc80|r, |cffed89d9Dex |cff9932cc55|r, |cffed89d9Int |cff9932cc18|r, |cffed89d9Wis |cff9932cc12\n|cff0080ff법사: |cffed89d9Int |cff9932cc104|r, |cffed89d9Wis |cff9932cc77\n|cff0080ff직자: |cffed89d9Int |cff9932cc102|r, |cffed89d9Wis |cff9932cc77\n|cff0080ff도가: |cffed89d9Str |cff9932cc53|r, |cffed89d9Con |cff9932cc39\n|cff0080ff└노멀도가|c00d1d1d1(선택): |cffffdc3c추가로 |cffed89d9Int |cff9932cc53|r, |cffed89d9Wis |cff9932cc37\n|cffffdc3c※Wis / Con : 먼저 찍을수록 레벨업시 증가하는 체,마력이 증가합니다. (순수 스텟만 적용)\n|cffffdc3c※스텟이 오르는 아이템이 있으면 그만큼 덜 찍어도 됩니다. 남는 스텟은 자유롭게 찍으면 됩니다.")
endfunction

//===========================================================================
function InitTrig_Intr_Stat takes nothing returns nothing
    set gg_trg_Intr_Stat = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Stat, function Trig_Intr_Stat_Actions )
endfunction

//===========================================================================
// Trigger: Intr Field
//===========================================================================
function Trig_Intr_Field_Actions takes nothing returns nothing
  call MSG(GetTriggerPlayer(), 1, 20., "\n-----사냥터 관련 도움말입니다.-----\n|r1~6|cffffdc3c: 노비스~밀레스 필드\n|r4~10|cffffdc3c: 밀레스 지하묘지(밀던) 최상층\n|r6~15|cffffdc3c: 큐르페이 굴\n|r10~30|cffffdc3c: 밀던 2~2.5층, 루어스~수오미 필드\n|r26~40|cffffdc3c: 포테의숲 - |cffed89d9수오미\n|r30~45|cffffdc3c: 루어스~피에트, 수오미~피에트 필드\n|r41~55|cffffdc3c: 오아시스 - |cffed89d9호엔|cffffdc3c, 해안가 - |cffed89d9뤼케시온, 밀던 3~3.5층\n|r60~70|cffffdc3c: 난파선\n|r60~75|cffffdc3c: 뤼케시온~운디네 필드, 밀던 4.5층\n|r71~98|cffffdc3c: 밀던 최하층(강화), 마인 주변 필드, 조화의던전(파티)\n|r99|cffffdc3c: 호러캐슬, 죽음의마을, 광산, 잊섬")
endfunction

//===========================================================================
function InitTrig_Intr_Field takes nothing returns nothing
    set gg_trg_Intr_Field = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Field, function Trig_Intr_Field_Actions )
endfunction

//===========================================================================
// Trigger: Intr Exp
//===========================================================================
function Trig_Intr_Exp_Actions takes nothing returns nothing
    set udg_temp_u = udg_Unit[GetPlayerId(GetTriggerPlayer())+1]
    //set udg_temp_i = GetHeroLevel(udg_temp_u)
    //set udg_temp_u2 = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), GetUnitTypeId(udg_temp_u), 29088., -29632., bj_UNIT_FACING)
    //call SetHeroLevel(udg_temp_u2, udg_temp_i, false)
    //set udg_temp_i2 = GetHeroXP(udg_temp_u2)
    //set udg_temp_r = I2R(GetHeroXP(udg_temp_u) - udg_temp_i2)
    //call SetHeroLevel(udg_temp_u2, udg_temp_i+1, false)
    
    //set udg_temp_s = "|c00ffff00Lv. " + I2S(udg_temp_i) + "  |c00d962b5" + I2S(GetHeroXP(udg_temp_u)) + "|cffffdc3c / |cff9932cc" + I2S(GetHeroXP(udg_temp_u2)) + "|cffffdc3c ( |c0055ff55"
    //set udg_temp_i2 = GetHeroXP(udg_temp_u2) - udg_temp_i2
    //set udg_temp_r = 100. * (udg_temp_r/I2R(udg_temp_i2))
    //set udg_temp_i = GetHeroXP(udg_temp_u2) - GetHeroXP(udg_temp_u)
    //set udg_temp_s = udg_temp_s + R2SW(FSE_E2I(udg_temp_u)/10., 2, 1) + "|cffffdc3c% ) 남은경험치: |cffff0000" + FSE_Rest(udg_temp_i)
    //call MSG(GetTriggerPlayer(), 2, 8, udg_temp_s)
    if ( LoadInteger(udg_hash, GetHeroLevel(udg_temp_u)+1, StringHash("Exp1")) == 0 ) then
      set udg_temp_u2 = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), GetUnitTypeId(udg_temp_u), 29088., -29632., bj_UNIT_FACING)
      call SaveInteger(udg_hash, 100, StringHash("Exp1"), GetHeroXP(udg_temp_u2))
      call SetHeroLevel(udg_temp_u2, GetHeroLevel(udg_temp_u)+1, false)
      call RemoveUnit(udg_temp_u2)
    endif
    
    call MSG(GetTriggerPlayer(), 2, 8, "|c00ffff00Lv. " + I2S(GetHeroLevel(udg_temp_u)) + "  |c00d962b5" + I2S(GetHeroXP(udg_temp_u)) + "|cffffdc3c / |cff9932cc" + I2S(LoadInteger(udg_hash, GetHeroLevel(udg_temp_u)+1, StringHash("Exp1"))) + "|cffffdc3c ( |c0055ff55" + R2SW(FSE_E2I(udg_temp_u)/10., 2, 1) + "|cffffdc3c% ) 남은경험치: |cffff0000" + FSE_Rest(udg_temp_i))
    //call RemoveUnit(udg_temp_u2)
    set udg_temp_i = GetHeroXP(udg_temp_u) - LoadInteger(udg_hash, GetPlayerId(GetTriggerPlayer())+1, StringHash("Exp"))
    if ( udg_temp_i > 0 ) then
      call MSG(GetTriggerPlayer(), 2, 8, "|cffffdc3c올린 경험치: |cff0078ff" + FSE_Rest(udg_temp_i))
    endif
endfunction

//===========================================================================
function InitTrig_Intr_Exp takes nothing returns nothing
    set gg_trg_Intr_Exp = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Exp, function Trig_Intr_Exp_Actions )
endfunction

//===========================================================================
// Trigger: Intr Q Skip
//===========================================================================
function Trig_Intr_Q_Skip_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetTriggerPlayer())+1
 local real r = udg_Quest_WaitTime[P]
  if ( udg_Quest_SkipWait[P] <= 1 ) then
    call MSG(GetTriggerPlayer(), 2, 7, "|c0012edc7퀘스트 대화를 스킵하였습니다(일부 대화와 선택지는 스킵되지 않습니다). 앞으로 1분간 스킵이 불가능합니다.")
    set udg_Quest_WaitTime[P] = 0.05
    set udg_Quest_SkipWait[P] = 7.
	call TriggerSleepAction(2.)
	set udg_Quest_WaitTime[P] = r
	loop
	  exitwhen udg_Quest_SkipWait[P] < 1.
	  call TriggerSleepAction(1.)
	  set udg_Quest_SkipWait[P] = udg_Quest_SkipWait[P] - 1.
	endloop
  else
    call MSG(GetTriggerPlayer(), 2, 7, "|c0012edc7이미 퀘스트 대화를 스킵하여, 1분간 스킵이 불가능합니다. (남은시간 : |c00d962b5" + I2S(R2I(udg_Quest_SkipWait[P])) + "|c0012edc7초)")
  endif 
endfunction

//===========================================================================
function InitTrig_Intr_Q_Skip takes nothing returns nothing
    set gg_trg_Intr_Q_Skip = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Q_Skip, function Trig_Intr_Q_Skip_Actions )
endfunction

//===========================================================================
// Trigger: Intr Q Speed
//
// 퀘속도 1 2 3
// 1 = 느림 (1.5)
// 2 = 일반,기본 (1.1)
// 3 = 빠름 (0.7)
//===========================================================================
function Trig_Intr_Q_Speed_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetTriggerPlayer())+1
 local integer i = S2I(SubString(GetEventPlayerChatString(), 11, 12))
  if ( i >= 1 and i <= 3 ) then
    set udg_Quest_WaitTime[P] = 1.85 - GetRandomReal(.30, .45) * i
    if ( i == 1 ) then
	//1.5~1.4초
	  call MSG(GetTriggerPlayer(), 1, 7, "퀘스트 대화 속도가 '|c00d962b5천천히|cffffdc3c'로 되었습니다 (|c00d962b5"+R2SW(udg_Quest_WaitTime[P],1,2)+"|cffffdc3c초/한마디)")
	elseif ( i == 2 ) then
	//1.25~0.95초
	  call MSG(GetTriggerPlayer(), 1, 7, "퀘스트 대화 속도가 '|c00d962b5보통|cffffdc3c'으로 되었습니다 (|c00d962b5"+R2SW(udg_Quest_WaitTime[P],1,2)+"|cffffdc3c초/한마디)")
	else
	//0.95~0.5초
	  call MSG(GetTriggerPlayer(), 1, 7, "퀘스트 대화 속도가 '|c00d962b5빠름|cffffdc3c'으로 되었습니다 (|c00d962b5"+R2SW(udg_Quest_WaitTime[P],1,2)+"|cffffdc3c초/한마디)")
	endif
    call IndexSet(P, 2, i-1)
  endif
endfunction

//===========================================================================
function InitTrig_Intr_Q_Speed takes nothing returns nothing
    set gg_trg_Intr_Q_Speed = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Q_Speed, function Trig_Intr_Q_Speed_Actions )
endfunction

//===========================================================================
// Trigger: Intr Skill
//===========================================================================
function GetSkillNameStatAll takes integer P returns string
 local string s = ""
 local string s2 = ""
 local string s3 = ""
 local integer loopA = 1
 local integer circle = 0
 local integer circle2 = 0
  if ( udg_SysB_Level[P] < 11 ) then
    set circle = 1
  elseif ( udg_SysB_Level[P] < 41 ) then
    set circle = 2
  elseif ( udg_SysB_Level[P] < 71 ) then
    set circle = 3
  elseif ( udg_SysB_Level[P] < 99 ) then
    set circle = 4
  else
    set circle = 5
  endif
  if ( SysInt(4,GetUnitTypeId(udg_Unit[P])) == 2 ) then
    call MSG(Player(P-1), 1, 20., "스킬 관련 도움말입니다. 스킬명(필요 능력치 STR/CON)")
  elseif ( SysInt(4,GetUnitTypeId(udg_Unit[P])) == 3 ) then
    call MSG(Player(P-1), 1, 20., "스킬 관련 도움말입니다. 스킬명(필요 능력치 STR/DEX)")
  elseif ( SysInt(4,GetUnitTypeId(udg_Unit[P])) == 4 ) then
    call MSG(Player(P-1), 1, 20., "스킬 관련 도움말입니다. 스킬명(필요 능력치 INT/WIS)")
  elseif ( SysInt(4,GetUnitTypeId(udg_Unit[P])) == 5 ) then
    call MSG(Player(P-1), 1, 20., "스킬 관련 도움말입니다. 스킬명(필요 능력치 INT/WIS)")
  elseif ( SysInt(4,GetUnitTypeId(udg_Unit[P])) == 6 ) then
    call MSG(Player(P-1), 1, 20., "스킬 관련 도움말입니다. 스킬명(필요 능력치 STR/CON (마법=INT/WIS)")
  else
    call MSG(Player(P-1), 1, 20., "스킬 관련 도움말입니다. 스킬명(필요 능력치)")
  endif
  loop
    set s3 = LoadStr(udg_hash, loopA, 60)
    //직업 비교 - or 공용
    if ( S2I(SubString(s3,0,1)) == SysInt(4,GetUnitTypeId(udg_Unit[P])) ) or ( SubString(s3,0,1) == "0" ) then
      //레벨 비교, +1서클까지 표시
      if ( circle+1 >= S2I(SubString(LoadStr(udg_hash, loopA, 60),1,2)) ) then
        //안배운 스킬만 표시
        if ( GetUnitAbilityLevel(udg_Unit[P], udg_FSE_Skill[loopA]) == 0 ) then
          if ( circle2 != S2I(SubString(LoadStr(udg_hash, loopA, 60),1,2)) ) then
            call MSG(Player(P-1), 1, 20., s)
            set s = ""
            set circle2 = S2I(SubString(LoadStr(udg_hash, loopA, 60),1,2))
            call TriggerSleepAction(0.01)
          endif
          set s2 = ""
          if ( SubString(s3,2,5) != "003" ) then
            if ( udg_SysE_STR3[P] >= S2I(SubString(s3,2,5)) ) then
              set s2 = s2 + "|c0000ff00" + I2S(S2I(SubString(s3,2,5))) + "|r/"
            else
              set s2 = s2 + "|cffff0000" + I2S(S2I(SubString(s3,2,5))) + "|r/"
            endif
          endif
          if ( SubString(s3,5,8) != "003" ) then
            if ( udg_SysE_DEX3[P] >= S2I(SubString(s3,5,8)) ) then
              set s2 = s2 + "|c0000ff00" + I2S(S2I(SubString(s3,5,8))) + "|r/"
            else
              set s2 = s2 + "|cffff0000" + I2S(S2I(SubString(s3,5,8))) + "|r/"
            endif
          endif
          if ( SubString(s3,8,11) != "003" ) then
            if ( udg_SysE_INT3[P] >= S2I(SubString(s3,8,11)) ) then
              set s2 = s2 + "|c0000ff00" + I2S(S2I(SubString(s3,8,11))) + "|r/"
            else
              set s2 = s2 + "|cffff0000" + I2S(S2I(SubString(s3,8,11))) + "|r/"
            endif
          endif
          if ( SubString(s3,11,14) != "003" ) then
            if ( udg_SysE_WIS3[P] >= S2I(SubString(s3,11,14)) ) then
              set s2 = s2 + "|c0000ff00" + I2S(S2I(SubString(s3,11,14))) + "|r/"
            else
              set s2 = s2 + "|cffff0000" + I2S(S2I(SubString(s3,11,14))) + "|r/"
            endif
          endif
          if ( SubString(s3,14,17) != "003" ) then
            if ( udg_SysE_CON3[P] >= S2I(SubString(s3,14,17)) ) then
              set s2 = s2 + "|c0000ff00" + I2S(S2I(SubString(s3,14,17))) + "|r/"
            else
              set s2 = s2 + "|cffff0000" + I2S(S2I(SubString(s3,14,17))) + "|r/"
            endif
          endif
          if ( s2 == "" ) then
            set s = s + "|cffed89d9" + GetObjectName(udg_FSE_Skill[loopA]) + "(|c0000ff003|r/|c0000ff003|r/|c0000ff003|r/|c0000ff003|r/|c0000ff003|cffed89d9)|r, "
          else
            set s = s + "|cffed89d9" + GetObjectName(udg_FSE_Skill[loopA]) + "(" + SubString(s2,0,StringLength(s2)-3) + "|cffed89d9)|r, "
          endif
        endif
      endif
    endif
    exitwhen loopA >= udg_FSE_Skill[0]
    set loopA = loopA + 1
  endloop
  if ( StringLength(s) >= 10 ) then
    call MSG(Player(P-1), 1, 20., s)
  endif
  if ( udg_Quest_00_Note[P] == 40 ) then
    set udg_Quest_00_Note[P] = 41
    call MSG(Player(P-1), 1, 3., "초보자 퀘스트 - 클릭하여 계속 진행하세요.")
  endif
  return ""
endfunction

function Trig_Intr_Skill_Actions takes nothing returns nothing
  call MSG(GetTriggerPlayer(), 1, 20., GetSkillNameStatAll(GetPlayerId(GetTriggerPlayer())+1))
endfunction

//===========================================================================
function InitTrig_Intr_Skill takes nothing returns nothing
    set gg_trg_Intr_Skill = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Skill, function Trig_Intr_Skill_Actions )
endfunction

//===========================================================================
// Trigger: Intr FixCam
//===========================================================================
function Trig_Intr_FixCam_Actions takes nothing returns nothing
  if ( IndexGet(FAL_GetMulti0(GetPlayerId(GetTriggerPlayer())+1, 0, 0, 2), 3) == 0 ) or ( not udg_SysO_CamUnit[GetPlayerId(GetTriggerPlayer())+1] ) then
    call IndexSet(GetPlayerId(GetTriggerPlayer())+1, 3, 1)
    call SetCameraTargetControllerNoZForPlayer( GetTriggerPlayer(), udg_Unit[GetPlayerId(GetTriggerPlayer())+1], 0, 0, false )
    set udg_SysO_CamUnit[GetPlayerId(GetTriggerPlayer())+1] = true
    call MSG(GetTriggerPlayer(), 2, 7, "|c0012edc7카메라를 고정하였습니다")
  else
    call IndexSet(GetPlayerId(GetTriggerPlayer())+1, 3, 0)
    call SetCameraXY(GetTriggerPlayer(), GetWidgetX(udg_Unit[GetPlayerId(GetTriggerPlayer())+1]), GetWidgetY(udg_Unit[GetPlayerId(GetTriggerPlayer())+1]))
    call MSG(GetTriggerPlayer(), 2, 7, "|c0012edc7카메라를 고정해제하였습니다")
    set udg_SysO_CamUnit[GetPlayerId(GetTriggerPlayer())+1] = false
  endif
endfunction

//===========================================================================
function InitTrig_Intr_FixCam takes nothing returns nothing
    set gg_trg_Intr_FixCam = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_FixCam, function Trig_Intr_FixCam_Actions )
endfunction

//===========================================================================
// Trigger: Intr Love fooiff
//
// call MSGAll(0, true, 2, 2, 30., SysStr(2,P)+udg_SysB_Name[P]+"|cffffdc3c님이 주사위를 굴려 무려 '|c00ff0000"+I2S(udg_temp_i)+"|cffffdc3c'(이)가 나왔습니다 !!!")
//===========================================================================
function Trig_Intr_Love_fooiff_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetTriggerPlayer())+1
  if ( udg_Quest_SkipWait[P] <= 1.1 ) then
    set P = 1
    set bj_forceCountPlayers = 0
    loop
      exitwhen P > bj_MAX_PLAYERS
      if ( GetPlayerController(Player(P-1)) == MAP_CONTROL_USER ) and ( GetPlayerSlotState(Player(P-1)) == PLAYER_SLOT_STATE_PLAYING ) then
        set bj_forceCountPlayers = bj_forceCountPlayers + 1
      endif
      set P = P +1
    endloop
    set P = GetPlayerId(GetTriggerPlayer())+1
    call SaveInteger(udg_hash, StringHash("lvf"), 55, LoadInteger(udg_hash, StringHash("lvf"), 55)+1)
    call SaveBoolean(udg_hash, StringHash("lvf"), P, true)
    if ( LoadInteger(udg_hash, StringHash("lvf"), 55) == 1 ) then
      if ( bj_forceCountPlayers == 1 ) then
        call MSGAll(0, true, 1, 2, 6., SysStr(2,P)+GetPlayerName(Player(P-1))+"|cffffdc3c님이 혼자서 용기있게 푸잎님 사랑해요를 외쳤습니다 !! ( 2명 이상 외쳐야 합니다 )")
      else
        call MSGAll(0, true, 1, 2, 6., SysStr(2,P)+GetPlayerName(Player(P-1))+"|cffffdc3c님이 푸잎님 사랑해요를 가장 먼저 외쳤습니다 !! ( |cffff0000"+I2S(LoadInteger(udg_hash, StringHash("lvf"), 55))+"|cffffdc3c명 / |cff9932cc"+I2S(bj_forceCountPlayers)+"|cffffdc3c명 )")
      endif
    elseif ( LoadInteger(udg_hash, StringHash("lvf"), 55) < bj_forceCountPlayers ) then
      call MSGAll(0, true, 1, 2, 6., SysStr(2,P)+GetPlayerName(Player(P-1))+"|cffffdc3c님도 푸잎님 사랑해요를 외쳤습니다 !! ( |cffff0000"+I2S(LoadInteger(udg_hash, StringHash("lvf"), 55))+"|cffffdc3c명 / |cff9932cc"+I2S(bj_forceCountPlayers)+"|cffffdc3c명 )")
    elseif ( LoadInteger(udg_hash, StringHash("lvf"), 55) == bj_forceCountPlayers ) then
      call DestroyTrigger( GetTriggeringTrigger() )
      call MSGAll(0, true, 1, 2, 6., SysStr(2,P)+GetPlayerName(Player(P-1))+"|cffffdc3c님도 마지막으로 푸잎님 사랑해요를 외쳤습니다 !! ( |cff55ff55"+I2S(LoadInteger(udg_hash, StringHash("lvf"), 55))+"|cffffdc3c명 / |cff9932cc"+I2S(bj_forceCountPlayers)+"|cffffdc3c명 )")
      call TriggerSleepAction(2.)
      call ClearTextMessages()
      set P = 1
      if ( GetRandomReal(0.,100.) <= 5.+bj_forceCountPlayers ) then
        loop
          exitwhen P > bj_MAX_PLAYERS
          if ( isPlaying(Player(P-1)) ) then
            call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", udg_Unit[P], "origin"))
            call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", udg_Unit[P], "origin"))
            call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Starfall\\StarfallTarget.mdl", udg_Unit[P], "origin"))
            set udg_SysK_ExpAdd[P] = udg_SysK_ExpAdd[P] + 15
            set udg_SysK_DropAdd[P] = udg_SysK_DropAdd[P] + 15
            set udg_SysK_GoldAdd[P] = udg_SysK_GoldAdd[P] + 15
            call MSG(Player(P-1), 1, 11, SysStr(2,P) + "데푸|r : |c00ffff00이번엔 내가 축복을 주지...")
            call MSG(Player(P-1), 1, 15, "\n|cff87f264데푸|c00ffff00의 축복이 발생하여, 이 방에 경험치 획득률, 드랍률, 골드 추가 드랍률이 영구적으로 10%가 아닌 15% 상승합니다.")
          endif
          set P = P + 1
        endloop
      elseif ( GetRandomReal(0,100.) <= 33. ) then
        loop
          exitwhen P > bj_MAX_PLAYERS
          if ( isPlaying(Player(P-1)) ) then
            call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", udg_Unit[P], "origin"))
            
            set udg_SysK_ExpAdd[P] = udg_SysK_ExpAdd[P] + 5
            set udg_SysK_DropAdd[P] = udg_SysK_DropAdd[P] + 5
            set udg_SysK_GoldAdd[P] = udg_SysK_GoldAdd[P] + 5
            call MSG(Player(P-1), 1, 11, SysStr(2,P) + "푸잎|r : |c00ffff00너희들에게 축복을...\n"+SysStr(2,P) + "데푸|r : |c00ffff00흥.")
            call MSG(Player(P-1), 1, 15, "\n|cff87f264데푸|c00ffff00의 질투가 발생하여, 이 방에 경험치 획득률, 드랍률, 골드 추가 드랍률이 영구적으로 10%가 아닌 5% 상승합니다.")
          endif
          set P = P + 1
        endloop
      else
        loop
          exitwhen P > bj_MAX_PLAYER_SLOTS
          if ( isPlaying(Player(P-1)) ) then
            call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", udg_Unit[P], "origin"))
            call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", udg_Unit[P], "origin"))
            set udg_SysK_ExpAdd[P] = udg_SysK_ExpAdd[P] + 10
            set udg_SysK_DropAdd[P] = udg_SysK_DropAdd[P] + 10
            set udg_SysK_GoldAdd[P] = udg_SysK_GoldAdd[P] + 10
            call MSG(Player(P-1), 1, 11, SysStr(2,P) + "푸잎|r : |c00ffff00너희들에게 축복을...")
            call MSG(Player(P-1), 1, 15, "\n|cff87f264푸잎|c00ffff00님이 축복을 내려, 이 방에 경험치 획득률, 드랍률, 골드 추가 드랍률이 영구적으로 10% 상승합니다.")
          endif
          set P = P + 1
        endloop
      endif
      //return
    endif
    set P = GetPlayerId(GetTriggerPlayer())+1
    set udg_Quest_SkipWait[P] = 30.
    loop
      exitwhen udg_Quest_SkipWait[P] <= 1
      call TriggerSleepAction(1.)
      set udg_Quest_SkipWait[P] = udg_Quest_SkipWait[P] - 1
    endloop
    call SaveInteger(udg_hash, StringHash("lvf"), 55, LoadInteger(udg_hash, StringHash("lvf"), 55)-1)
  else
    call MSG(GetTriggerPlayer(), 2, 6, "|c0012edc7지나친 구애를 금지합니다. (남은시간 : |c00d962b5" + I2S(R2I(udg_Quest_SkipWait[P])) + "|c0012edc7초)")
  endif
  set P = 0
endfunction

//===========================================================================
function InitTrig_Intr_Love_fooiff takes nothing returns nothing
  set gg_trg_Intr_Love_fooiff = CreateTrigger(  )
  call TriggerAddAction(gg_trg_Intr_Love_fooiff, function Trig_Intr_Love_fooiff_Actions )
endfunction

//===========================================================================
// Trigger: Intr Link
//
// -오픈채팅
//===========================================================================
function Trig_Intr_Link_Actions takes nothing returns nothing
  call MSG(GetTriggerPlayer(), 2, 7, "오픈채팅 링크를 엽니다.")
  if ( GetLocalPlayer() == GetTriggerPlayer() ) then
    call JNOpenBrowser("https://open.kakao.com/o/gM1u4zn")
  endif
  if ( udg_Quest_00_Note[GetPlayerId(GetTriggerPlayer())+1] == 50 ) then
    set udg_Quest_00_Note[GetPlayerId(GetTriggerPlayer())+1] = 51
    call MSG(GetTriggerPlayer(), 1, 3., "초보자 퀘스트 - 클릭하여 계속 진행하세요.")
  endif
endfunction

//===========================================================================
function InitTrig_Intr_Link takes nothing returns nothing
    set gg_trg_Intr_Link = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Link, function Trig_Intr_Link_Actions )
endfunction

//===========================================================================
// Trigger: Intr Reset
//
// 40까지 그냥 가능
// 99때 - 스킬 이상 가능
// 순수 전직시 - 3/3/3/3/3
// 승급 이후 - 스킬 이상 가능
// 2개 이상시 - 강제 3/3/3/3/3
//===========================================================================
function Trig_Intr_Reset_Actions takes nothing returns nothing
    local integer P = GetPlayerId(GetTriggerPlayer())+1
    if ( MinusItem(P, 'wild', 1) ) then
      if ( udg_SysB_Level[P] >= 41 ) and ( udg_SysB_Level[P] <= 98 ) then
        call MSG(Player(P-1), 1, 7, "레벨이 너무 높습니다.")
      else
    call TriggerSleepAction( 2 )
        if ( MinusItem(P, 'wild', 1) ) then
          call ResetStat(P, "스탯 초기화(강제)")
        else
          call ResetStat(P, "스탯 초기화(물약)")
        endif
      endif
    else
      call MSG(GetTriggerPlayer(), 1, 7, "초기화 물약이 없습니다.")
    endif
endfunction

//===========================================================================
function InitTrig_Intr_Reset takes nothing returns nothing
    set gg_trg_Intr_Reset = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Reset, function Trig_Intr_Reset_Actions )
endfunction

//===========================================================================
// Trigger: Intr Type HPMP
//===========================================================================
globals
  constant integer MAX_HP = 200000
  constant integer MAX_MP = 150000
endglobals
function ViewStat takes integer P, integer StatNow, integer StatMax returns string
  if ( StatNow < StatMax ) then
    if ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) >= StatNow+1 ) then
      return "|cff46ffff"+I2S(StatNow+1)+BaseStr(11)+" 포인트 필요 / 최대 |cffed89d9"+I2S(StatMax)+BaseStr(11)+"까지"
    else
      return "|cffff3315"+I2S(StatNow+1)+BaseStr(11)+" 포인트 필요 / 최대 |cffed89d9"+I2S(StatMax)+BaseStr(11)+"까지"
    endif
  else
    return BaseStr(11)+"최대스텟(|cffed89d9"+I2S(StatMax)+BaseStr(11)+") 도달"
  endif
endfunction
//"힘. "+ ViewStat(P, udg_SysE_STR1[P], MaxStat(S2I(SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2)), 1))

function StatePlus2 takes integer P, integer loopA, integer StatNow, integer StatMax, boolean all returns nothing
  loop
    if ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) < StatNow+1 ) then
      call MSG(Player(P-1), 1, 5, "스텟 포인트가 부족합니다. |c00d962b5" + I2S(StatNow) + "|cffffdc3c이상 필요합니다.")
      set all = false
    elseif ( udg_SysE_STR1[P] + udg_SysE_DEX1[P] + udg_SysE_INT1[P] + udg_SysE_WIS1[P] + udg_SysE_CON1[P] < 211 ) then
      call MSG(Player(P-1), 4, 5, "분배되지 않은 포인트가 있습니다. 모든 포인트를 먼저 찍어주세요. " + I2S(udg_SysE_STR1[P] + udg_SysE_DEX1[P] + udg_SysE_INT1[P] + udg_SysE_WIS1[P] + udg_SysE_CON1[P]) + "/214P")
      set all = false
    elseif ( loopA == 0 ) then
      call MSG(Player(P-1), 4, 5, "목록에 없는 스텟입니다. / " + I2S(loopA) + " = " + I2S(loopA))
      set all = false
    elseif ( StatNow >= StatMax ) then
      call MSG(Player(P-1), 4, 5, "최대치에 도달했습니다: " + I2S(StatMax))
      set all = false
    elseif ( CountItem(P, 'I084') < 3 ) then
      call MSG(Player(P-1), 4, 5, "제물이 부족합니다. 엑스쿠라눔이 3병/회 이상 필요합니다.")
      set all = false
    else
      call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)-(StatNow+1))
      call MinusItem(P, 'I084', 3)
      
      if ( loopA == 1 ) then
        call AddState(P, "STR", 1, true)
        set udg_SysL_STR[P] = udg_SysE_STR1[P]
        if ( not all ) then
          call MSG(Player(P-1), 1, 8, "＊참고.\n|c00d1d1d1 힘이 오르면 공격력이 0~30 오릅니다.\n|c00d1d1d1　( 보이지 않습니다. ) 멀티보드에 or 무기를 먹었을때에 표시됩니다.")
        endif
      elseif ( loopA == 2 ) then
        call AddState(P, "DEX", 1, true)
        set udg_SysL_DEX[P] = udg_SysE_DEX1[P]
        if ( not all ) then
          call MSG(Player(P-1), 1, 8, "※참고.\n|c00d1d1d1 덱스가 오르면 공격력 15, 명중률이 1% 오릅니다. ( 자신의 명중률에 비례 ) |r\n|c00d1d1d1　( 기본명중률은 70%입니다. 민첩이 오르면 몇몇 스킬의 데미지도 올라갑니다)")
        endif
      elseif ( loopA == 3 ) then
        call AddState(P, "INT", 1, true)
        set udg_SysL_INT[P] = udg_SysE_INT1[P]
        if ( not all ) then
          call MSG(Player(P-1), 1, 8, "＊참고.\n|c00d1d1d1 인트가 오르면 마법 방어력과, 마법데미지가 오릅니다. \n|c00d1d1d1　( 인트가 높으면 마법사의 마법이 강하며, 다른직업의 특정 스킬도 강해집니다. )")
        endif
      elseif ( loopA == 4 ) then
        call AddState(P, "WIS", 1, true)
        set udg_SysL_WIS[P] = udg_SysE_WIS1[P]
        if ( not all ) then
          call MSG(Player(P-1), 1, 8, "＊참고.\n|c00d1d1d1 위즈가 오르면 마나 최대치와 마나 회복량이 늘어납니다. \n|c00d1d1d1　( 회복속도는 빨라지지 않습니다. )")
        endif
      elseif ( loopA == 5 ) then
        call AddState(P, "CON", 1, true)
        set udg_SysL_CON[P] = udg_SysE_CON1[P]
        if ( not all ) then
          call MSG(Player(P-1), 1, 8, "＊참고\n|c00d1d1d1 콘이 오르면 공격력이 5~15, 레벨업시 체력이 많이 오르며, 체력 회복량이 늘어납니다. \n|c00d1d1d1　특정 스킬의 데미지도 향상합니다. (166이상부터 회복속도도 빨라집니다 ) " )
        endif
      endif
    endif
    exitwhen all == false
    set StatNow = StatNow + 1
    call TriggerSleepAction(.01)
  endloop
  call PauseUnit(udg_Unit[P], false)
endfunction
constant function Stat2A takes string Stat returns integer
  if ( Stat == "힘" ) then
    return 1
  elseif ( Stat == "민" ) or ( Stat == "덱" ) then
    return 2
  elseif ( Stat == "인" ) then
    return 3
  elseif ( Stat == "위" ) then
    return 4
  elseif ( Stat == "콘" ) then
    return 5
  else
    return 0
  endif
endfunction

function Trig_Type_HP_Actions takes nothing returns nothing
  local integer P = GetPlayerId(GetTriggerPlayer())+1
  local boolean all = ( SubString(GetEventPlayerChatString(),StringLength(GetEventPlayerChatString())-3,StringLength(GetEventPlayerChatString())) == "all" )
  if ( all ) and ( IsUnitPaused(udg_Unit[P]) ) then
    call MSG(Player(P-1), 1, 4, "현재 가르침을 받고 있습니다.")
    return
  elseif ( all ) then
    call PauseUnit(udg_Unit[P], true)
  endif
  if not ( RectContainsUnit(gg_rct_Etc_Rect_02, udg_Unit[P]) ) then
    if ( Stat2A(SubString(GetEventPlayerChatString(),0,3)) == 0 ) then
      call MSG(Player(P-1), 1, 4, "신전 제단 앞에서만 사용할 수 있는 명령어입니다.")
      call PauseUnit(udg_Unit[P], false)
    endif
debug call BJDebugMsg(I2S(Stat2A(SubString(GetEventPlayerChatString(),0,3))))
  elseif ( SubString(GetEventPlayerChatString(),0,6) == "체력" ) then
    loop
      if ( udg_SysE_STR1[P] + udg_SysE_DEX1[P] + udg_SysE_INT1[P] + udg_SysE_WIS1[P] + udg_SysE_CON1[P] >= 211 ) then
        if ( udg_Save_HP[P] < MAX_HP ) then
          set udg_temp_i = GetHPMP(P,true)/1000
          if ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) >= udg_temp_i ) then
            if ( MinusItem(P, 'I084', 3) ) then
              call MSG(Player(P-1), 6, 4, "세오|r : |c00ffff00엑스쿠라눔 3병과 자네 경험의 대가로 체력에 은총을 내려 주겠네.")
              set udg_Save_HP[P] = udg_Save_HP[P] + SysInt(0,27)
              call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", udg_Unit[P], "origin"))
              call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) - udg_temp_i)
              call SetUS("Hp", udg_Unit[P], SysInt(0,27), true)
            else
              call MSG(Player(P-1), 6, 4, "세오|r : |c00ffff00쯧쯧... 자네는 제물이 부족하구만.. 엑스쿠라눔|c00d962b5 3병|cffffdc3c 이상 모은 후에 오게.")
              set all = false
            endif
          else
            call MSG(Player(P-1), 6, 4, "세오|r : |c00ffff00쯧쯧... 자네는 이미 체력을 더 투자할 필요가 없겠구만..")
            set all = false
          endif
        else
          call MSG(Player(P-1), 6, 4, "세오|r : |c00ffff00쯧쯧... 자네는 경험치가 부족하구만.. |c00d962b5" + I2S(udg_temp_i) + "|cffffdc3c포인트 이상 모은 후에 오게.")
          set all = false
        endif
      else
        call MSG(Player(P-1), 1, 6, "능력치를 모두 분배한 후 체력을 구입할 수 있습니다. 아직 분배하지 않은 능력치가 남아 있습니다.")
        set all = false
      endif
      exitwhen all == false
      call TriggerSleepAction(.01)
    endloop
    set udg_temp_i = 0
    call PauseUnit(udg_Unit[P], false)
  elseif ( SubString(GetEventPlayerChatString(),0,6) == "마력" ) then
    loop
      if ( udg_SysE_STR1[P] + udg_SysE_DEX1[P] + udg_SysE_INT1[P] + udg_SysE_WIS1[P] + udg_SysE_CON1[P] >= 211 ) then
        if ( udg_Save_MP[P] < MAX_MP ) then
          set udg_temp_i = GetHPMP(P,false)/1000
          if ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) >= udg_temp_i ) then
            if ( MinusItem(P, 'I084', 3) ) then
              call MSG(Player(P-1), 6, 4, "세오|r : |c00ffff00엑스쿠라눔 3병과 자네 경험의 대가로 마력에 은총을 내려 주겠네.")
              set udg_Save_MP[P] = udg_Save_MP[P] + SysInt(0,28)
              call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", udg_Unit[P], "origin"))
              call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) - udg_temp_i)
              call SetUS("Mp", udg_Unit[P], SysInt(0,28), true)
            else
              call MSG(Player(P-1), 6, 4, "세오|r : |c00ffff00쯧쯧... 자네는 제물이 부족하구만.. 엑스쿠라눔|c00d962b5 3병|cffffdc3c 이상 모은 후에 오게.")
              set all = false
            endif
          else
            call MSG(Player(P-1), 6, 4, "세오|r : |c00ffff00쯧쯧... 자네는 이미 마력을 더 투자할 필요가 없겠구만..")
            set all = false
          endif
        else
          call MSG(Player(P-1), 6, 4, "세오|r : |c00ffff00쯧쯧... 자네는 경험치가 부족하구만.. |c00d962b5" + I2S(udg_temp_i) + "|cffffdc3c포인트 이상 모은 후에 오게.")
          set all = false
        endif
      else
        call MSG(Player(P-1), 1, 6, "능력치를 모두 분배한 후 체력을 구입할 수 있습니다. 아직 분배하지 않은 능력치가 남아 있습니다.")
        set all = false
      endif
      exitwhen all == false
      call TriggerSleepAction(.01)
    endloop
    call PauseUnit(udg_Unit[P], false)
    set udg_temp_i = 0
  elseif ( GetEventPlayerChatString() == "환골탈태" ) or ( GetEventPlayerChatString() == "전직" ) then
    if ( SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),0,1) == "1" ) then
      call TriggerSleepAction(.2)
      call MSG(Player(P-1), 6, 4., "선진|r : |c00ffff00전직장소로 보내드리겠습니다. 원하는 직업의 신에게 말을 걸어보세요.")
      call TriggerSleepAction(.4)
      call SetUnitPosition(udg_Unit[P], 28480, -25792)
      call ClearTextMessagesBJ(GetForceOfPlayer(Player(P-1)) )
      call SetCameraBoundsToRectForPlayerBJ(Player(P-1), gg_rct_Chang_Job)
      call MSG(Player(P-1), 5, 5, "밀레스 신전")
      call SetCameraXY(Player(P-1), GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]))
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", udg_Unit[P], "origin"))
      call TriggerSleepAction(.4)
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(2.)
      call MSG(Player(P-1), 6, 4., "선진|r : |c00ffff00전직 교관에게 말을 걸어 전직할 수 있습니다.")
    else
      call TriggerSleepAction(.2)
      call MSG(Player(P-1), 6, 4., "선진|r : |c00ffff00당신은 이미 길을 걷고 있네요.")
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ThornsAura\\ThornsAuraDamage.mdl", udg_Unit[P], "head"))
      call TriggerSleepAction(.4)
    endif
  elseif ( GetEventPlayerChatString() == "승급" ) then
    if ( SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),0,1) == "1" ) or ( SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),0,1) == "2" ) then
      call TriggerSleepAction(.2)
      call MSG(Player(P-1), 6, 4., "선진|r : |c00ffff00승급장소로 보내드리겠습니다. 원하는 직업의 신에게 말을 걸어보세요.")
      call TriggerSleepAction(.4)
      call SetUnitPosition(udg_Unit[P], 28480, -25792)
      call ClearTextMessagesBJ(GetForceOfPlayer(Player(P-1)) )
      call SetCameraBoundsToRectForPlayerBJ(Player(P-1), gg_rct_Chang_Job)
      call MSG(Player(P-1), 5, 5, "밀레스 신전")
      call SetCameraXY(Player(P-1), GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]))
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", udg_Unit[P], "origin"))
      call TriggerSleepAction(.4)
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(2.)
      call MSG(Player(P-1), 6, 4., "선진|r : |c00ffff00승급 교관에게 말을 걸어 전직할 수 있습니다.")
    else
      call TriggerSleepAction(.2)
      call MSG(Player(P-1), 6, 4., "선진|r : |c00ffff00당신은 자격이 부족하네요.")
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ThornsAura\\ThornsAuraDamage.mdl", udg_Unit[P], "head"))
      call TriggerSleepAction(.4)
    endif
  elseif ( GetEventPlayerChatString() == "스텟" ) then
    if ( udg_SysE_STR1[P] + udg_SysE_DEX1[P] + udg_SysE_INT1[P] + udg_SysE_WIS1[P] + udg_SysE_CON1[P] >= 211 ) then
      if ( SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),0,1) == "3" ) then
        set udg_temp_s = "|c00fd8505어떤 스텟을 찍으시겠어요? |r(바로 입력 가능)\n"
        
        set udg_temp_s = udg_temp_s + "\n|c00d962b5힘(STR). " + ViewStat(P, udg_SysE_STR1[P], MaxStat(S2I(SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2)), 1))
        set udg_temp_s = udg_temp_s + "\n|c00d962b5민(DEX). " + ViewStat(P, udg_SysE_DEX1[P], MaxStat(S2I(SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2)), 2))
        set udg_temp_s = udg_temp_s + "\n|c00d962b5인(INT). " + ViewStat(P, udg_SysE_INT1[P], MaxStat(S2I(SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2)), 3))
        set udg_temp_s = udg_temp_s + "\n|c00d962b5위(WIS). " + ViewStat(P, udg_SysE_WIS1[P], MaxStat(S2I(SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2)), 4))
        set udg_temp_s = udg_temp_s + "\n|c00d962b5콘(CON). " + ViewStat(P, udg_SysE_CON1[P], MaxStat(S2I(SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2)), 5))
        
        call MSG(Player(P-1), 2, 8, udg_temp_s + "\n|r(채팅창에 \"힘\"/\"민\"/\"인\"/\"위\"/\"콘\"/ 중 하나를 입력하세요. (\"스텟\" 명령어 없이 바로 입력 가능))")
      else
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ThornsAura\\ThornsAuraDamage.mdl", udg_Unit[P], "head"))
        call MSG(Player(P-1), 6, 4., "선진|r : |c00ffff00당신은 자격이 부족하네요.")
      endif
    else
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ThornsAura\\ThornsAuraDamage.mdl", udg_Unit[P], "head"))
      call MSG(Player(P-1), 6, 4., "선진|r : |c00ffff00포인트가 모두 분배되지 않았네요. " + I2S(udg_SysE_STR1[P] + udg_SysE_DEX1[P] + udg_SysE_INT1[P] + udg_SysE_WIS1[P] + udg_SysE_CON1[P]) + "/214포인트")
    endif
  elseif ( Stat2A(SubString(GetEventPlayerChatString(),0,3)) > 0 ) then
//debug call BJDebugMsg("S2A: " + I2S(Stat2A(SubString(GetEventPlayerChatString(),0,3)))
    call MSG(Player(P-1), 6, 4, "선진|r : |c00ffff00"+JOBNAME(Stat2A(SubString(GetEventPlayerChatString(),0,3)))+" 신을 대신하여, 당신의 "+SubString(GetEventPlayerChatString(),0,3)+"에 축복을 내려줄게요.")
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", udg_Unit[P], "origin"))
    if ( Stat2A(SubString(GetEventPlayerChatString(),0,3)) == 1 ) then
      call StatePlus2(P, 1, udg_SysE_STR1[P], MaxStat(S2I(SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2)), 1), all)
    elseif ( Stat2A(SubString(GetEventPlayerChatString(),0,3)) == 2 ) then
      call StatePlus2(P, 2, udg_SysE_DEX1[P], MaxStat(S2I(SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2)), 2), all)
    elseif ( Stat2A(SubString(GetEventPlayerChatString(),0,3)) == 3 ) then
      call StatePlus2(P, 3, udg_SysE_INT1[P], MaxStat(S2I(SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2)), 3), all)
    elseif ( Stat2A(SubString(GetEventPlayerChatString(),0,3)) == 4 ) then
      call StatePlus2(P, 4, udg_SysE_WIS1[P], MaxStat(S2I(SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2)), 4), all)
    elseif ( Stat2A(SubString(GetEventPlayerChatString(),0,3)) == 5 ) then
      call StatePlus2(P, 5, udg_SysE_CON1[P], MaxStat(S2I(SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])),1,2)), 5), all)
    endif
  endif
  set P = 0
endfunction

//===========================================================================
function InitTrig_Intr_Type_HPMP takes nothing returns nothing
    set gg_trg_Intr_Type_HPMP = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Type_HPMP, function Trig_Type_HP_Actions )
endfunction

//===========================================================================
// Trigger: Intr Title
//===========================================================================
function ViewTitle takes integer P returns nothing
 local integer loopA = 1
 local string s = ""
  loop
    if ( S2I(SubString(udg_SysB_Title[P],loopA-1,loopA)) > 0 ) then
      set s = s + I2S(loopA) +". |cffed89d9" +FCut(TITLEVALUE(loopA,S2I(SubString(udg_SysB_Title[P],loopA-1,loopA))),1) +"|r,  "
    endif
    exitwhen loopA >= 16
    set loopA = loopA + 1
  endloop
  if ( s == "" ) then
    call MSG(Player(P-1), 1, 3, "칭호가 없습니다.")
  else
    call MSG(Player(P-1), 2, 15, "0. (해제),  " + SubString(s,0,StringLength(s)-3))
    call MSG(Player(P-1), 1, 8, "\n\"-칭호 \"와, 원하는 칭호 앞 숫자를 함께 입력해주세요. 예시) -칭호 10")
  endif
endfunction

function Trig_Intr_Title_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetTriggerPlayer())+1
  if ( SubString(GetEventPlayerChatString(), 0, 7) == "-칭호" ) then
    if ( udg_Unit[P] == null ) then
      call MSG(Player(P-1), 1, 3, "먼저, 영웅을 선택/로드 하시기 바랍니다.")
    else
      if ( SubString(GetEventPlayerChatString(), 0, 8) == "-칭호 " ) then
        if ( S2I(SubString(GetEventPlayerChatString(), 8, 10)) > 0 ) then
          if ( S2I(SubString(udg_SysB_Title[P],S2I(SubString(GetEventPlayerChatString(), 8, 10))-1,S2I(SubString(GetEventPlayerChatString(), 8, 10)))) > 0 ) then
          //칭호 장착
            call Title_Reset(P)
            
            //이름변경, 옵션 제공
            set udg_SysB_TitleNow[P] = S2I(SubString(GetEventPlayerChatString(), 8, 10))
            call MSG(Player(P-1), 1, 3, "칭호, \""+FCut(TITLEVALUE(udg_SysB_TitleNow[P], S2I(SubString(udg_SysB_Title[P],udg_SysB_TitleNow[P]-1,udg_SysB_TitleNow[P]))),1)+"\"를 장착하였습니다.")

            if ( SubString(udg_SysB_NameChange[P],0,4) == "|cff" ) then
              call SetPlayerName(Player(P-1), SubString(udg_SysB_NameChange[P],0,10) + "["+FCut(TITLEVALUE(udg_SysB_TitleNow[P],S2I(SubString(udg_SysB_Title[P],udg_SysB_TitleNow[P]-1,udg_SysB_TitleNow[P]))),1)+"]"+Ori_Name(P))
            else
              call SetPlayerName(Player(P-1), "["+FCut(TITLEVALUE(udg_SysB_TitleNow[P],S2I(SubString(udg_SysB_Title[P],udg_SysB_TitleNow[P]-1,udg_SysB_TitleNow[P]))),1)+"]"+Ori_Name(P))
            endif
            call ItemEquip(P, null, true, true)
          else
            call MSG(Player(P-1), 1, 3, "해당 번호의 칭호는 없습니다. 목록에서 선택해주세요.")
          endif
        else
          call Title_Reset(P)
          call SetPlayerName(Player(P-1), Ori_Name(P))
        endif
      else
        call ViewTitle(P)
      endif
    endif
  endif
endfunction

//===========================================================================
function InitTrig_Intr_Title takes nothing returns nothing
    set gg_trg_Intr_Title = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Title, function Trig_Intr_Title_Actions )
endfunction

//===========================================================================
// Trigger: Intr AutoStat
//===========================================================================
function Trig_Intr_AutoStat_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetTriggerPlayer())+1
  if ( GetEventPlayerChatString() == "-자동스텟" ) then
    if ( LoadBoolean(udg_hash, StringHash("NoAutoStat"), P) ) then
      call SaveBoolean(udg_hash, StringHash("NoAutoStat"), P, false)
      call RemoveUnit(LoadUnitHandle(udg_hash, StringHash("AutoStat-U"), P))
      call MSG(GetTriggerPlayer(), 1, 7, "이제, 레벨업시 스텟을 자동으로 찍습니다.")
    else
      call MSG(GetTriggerPlayer(), 1, 7, "이미 자동으로 스텟을 찍고 있습니다. 직접 찍으려면 |cffc3dbff\"-수동스텟\"|cffffdc3c을 입력하세요.")
    endif
  elseif ( GetEventPlayerChatString() == "-수동스텟" ) then
    if ( LoadBoolean(udg_hash, StringHash("NoAutoStat"), P) ) then
      call MSG(GetTriggerPlayer(), 1, 7, "이미 수동으로 스텟을 찍고 있습니다. 자동으로 찍으려면 |cffc3dbff\"-자동스텟\"|cffffdc3c을 입력하세요.")
    else
      call MSG(GetTriggerPlayer(), 1, 7, "이제, 레벨업시 스텟을 수동으로 찍습니다.")
      call SaveBoolean(udg_hash, StringHash("NoAutoStat"), P, true)
      call RemoveUnit(LoadUnitHandle(udg_hash, StringHash("AutoStat-U"), P))
      call SaveUnitHandle(udg_hash, StringHash("AutoStat-U"), P, CreateUnit(GetTriggerPlayer(), 'e01L', 29312., -22016., 0.))
    endif
  endif
endfunction

//===========================================================================
function InitTrig_Intr_AutoStat takes nothing returns nothing
    set gg_trg_Intr_AutoStat = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_AutoStat, function Trig_Intr_AutoStat_Actions )
endfunction

//===========================================================================
// Trigger: Intr Cafe
//===========================================================================
function Trig_Intr_Cafe_Actions takes nothing returns nothing
  call MSG(GetTriggerPlayer(), 2, 7, "카페 링크를 엽니다.")
  if ( GetLocalPlayer() == GetTriggerPlayer() ) then
    call JNOpenBrowser("https://cafe.naver.com/w3lod")
  endif
endfunction

//===========================================================================
function InitTrig_Intr_Cafe takes nothing returns nothing
    set gg_trg_Intr_Cafe = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Cafe, function Trig_Intr_Cafe_Actions )
endfunction

//===========================================================================
// Trigger: Intr MTSmall
//===========================================================================
function Trig_Intr_Small_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetTriggerPlayer())+1
  if ( SubString(udg_SysB_Setting[P],0,1) == "1" ) then
    set udg_SysB_Setting[P] = "1" + SubString(udg_SysB_Setting[P],1,StringLength(udg_SysB_Setting[P]))
    call LocalMtbM(Player(P-1), bj_lastCreatedMultiboard, true)
    call MSG(GetTriggerPlayer(), 2, 7, "상태창을 최소화하고 저장합니다.")
  else
    set udg_SysB_Setting[P] = "0" + SubString(udg_SysB_Setting[P],1,StringLength(udg_SysB_Setting[P]))
    call LocalMtbM(Player(P-1), bj_lastCreatedMultiboard, false)
    call MSG(GetTriggerPlayer(), 2, 7, "상태창을 최소화 해제합니다.")
  endif
  
  
endfunction

//===========================================================================
function InitTrig_Intr_MTSmall takes nothing returns nothing
    set gg_trg_Intr_MTSmall = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_MTSmall, function Trig_Intr_Small_Actions )
endfunction

//===========================================================================
// Trigger: Intr Effect Off
//===========================================================================
function Trig_Intr_Effect_Off_Actions takes nothing returns nothing
  set udg_SysA_EffectSimple = not udg_SysA_EffectSimple
  if ( udg_SysA_EffectSimple ) then
    call MSGAll(0, true, 1, 1, 7., "심플 이펙트 모드가 켜졌습니다. 이펙트가 간소화됩니다.")
  else
    call MSGAll(0, true, 1, 1, 7., "심플 이펙트 모드가 꺼졌습니다. 이펙트가 화려해집니다.")
  endif
endfunction

//===========================================================================
function InitTrig_Intr_Effect_Off takes nothing returns nothing
    set gg_trg_Intr_Effect_Off = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Effect_Off, function Trig_Intr_Effect_Off_Actions )
endfunction

//===========================================================================
// Trigger: Intr MapLevelUp
//
//       set udg_SysK_ExpAdd[P] = udg_SysK_ExpAdd[P] + 10
//       set udg_SysK_DropAdd[P] = udg_SysK_DropAdd[P] - 50
//     elseif ( udg_SysA_MapLevel == 2 ) then
//       set udg_SysK_ExpAdd[P] = udg_SysK_ExpAdd[P] + 15
//       set udg_SysK_DropAdd[P] = udg_SysK_DropAdd[P] - 100
//     elseif ( udg_SysA_MapLevel == 3 ) then
//       set udg_SysK_ExpAdd[P] = udg_SysK_ExpAdd[P] + 50
//       set udg_SysK_DropAdd[P] = udg_SysK_DropAdd[P] + 50
//       set udg_SysK_GoldAdd[P] = udg_SysK_GoldAdd[P] + 50
//     elseif ( udg_SysA_MapLevel == 4 ) then
//       set udg_SysK_ExpAdd[P] = udg_SysK_ExpAdd[P] + 100
//       set udg_SysK_DropAdd[P] = udg_SysK_DropAdd[P] + 100
//       set udg_SysK_GoldAdd[P] = udg_SysK_GoldAdd[P] + 100
//===========================================================================
function Trig_Intr_MapLevelUp_Actions takes nothing returns nothing
 local integer loopA = 1
  if ( IsTimerDialogDisplayed(LoadTimerDialogHandle(udg_hash, StringHash("Select Timer"), StringHash("TEMP"))) ) then
   if ( GetTriggerPlayer() == udg_SysA_Host ) then
    set udg_SysA_MapLevel = udg_SysA_MapLevel + 1
    if ( udg_SysA_MapLevel == 5 ) then
      set udg_SysA_MapLevel = 0
    endif
    if ( udg_SysA_MapLevel == 0 ) then
      call MSGAll(0, true, 1, 1, 7., "맵 난이도가 일반 모드로 설정되었습니다.")
      loop
        if ( isPlaying(Player(loopA-1)) ) then
          set udg_SysK_ExpAdd[loopA] = udg_SysK_ExpAdd[loopA] - 100
          set udg_SysK_DropAdd[loopA] = udg_SysK_DropAdd[loopA] - 100
          set udg_SysK_GoldAdd[loopA] = udg_SysK_GoldAdd[loopA] - 100
        endif
        exitwhen loopA >= bj_MAX_PLAYERS
        set loopA = loopA + 1
      endloop
    elseif ( udg_SysA_MapLevel == 1 ) then
      call MSGAll(0, true, 1, 1, 7., "맵 난이도가 어려움 모드로 설정되었습니다. (71이상시)\n   몬스터가 약 두 배 많이 나오며, 경험치가 +10%, 드랍률이 -50% 조정됩니다.")
      
      loop
        if ( isPlaying(Player(loopA-1)) ) then
          set udg_SysK_ExpAdd[loopA] = udg_SysK_ExpAdd[loopA] + 10
          set udg_SysK_DropAdd[loopA] = udg_SysK_DropAdd[loopA] - 50
        endif
        exitwhen loopA >= bj_MAX_PLAYERS
        set loopA = loopA + 1
      endloop
    elseif ( udg_SysA_MapLevel == 2 ) then
      call MSGAll(0, true, 1, 1, 7., "맵 난이도가 매우 어려움 모드로 설정되었습니다. (86이상시)\n   몬스터가 약 세 배 많이 나오며, 경험치가 +15%, 드랍률이 -100% 조정됩니다.")
      
      loop
        if ( isPlaying(Player(loopA-1)) ) then
          set udg_SysK_ExpAdd[loopA] = udg_SysK_ExpAdd[loopA] + 5
          set udg_SysK_DropAdd[loopA] = udg_SysK_DropAdd[loopA] - 50
        endif
        exitwhen loopA >= bj_MAX_PLAYERS
        set loopA = loopA + 1
      endloop
    elseif ( udg_SysA_MapLevel == 3 ) then
      call MSGAll(0, true, 1, 1, 7., "맵 난이도가 지옥 모드로 설정되었습니다. \n  몬스터의 체력/골드/드랍/경험치/공격력/마법확률/마법뎀지가 50%씩 상승합니다.")
      loop
        if ( isPlaying(Player(loopA-1)) ) then
          set udg_SysK_ExpAdd[loopA] = udg_SysK_ExpAdd[loopA] + 35
          set udg_SysK_DropAdd[loopA] = udg_SysK_DropAdd[loopA] + 150
          set udg_SysK_GoldAdd[loopA] = udg_SysK_GoldAdd[loopA] + 50
        endif
        exitwhen loopA >= bj_MAX_PLAYERS
        set loopA = loopA + 1
      endloop

    elseif ( udg_SysA_MapLevel == 4 ) then
      call MSGAll(0, true, 1, 1, 7., "맵 난이도가 죽음 모드로 설정되었습니다. \n  몬스터의 체력/골드/드랍/경험치/공격력/마법확률/마법뎀지가 100%씩 상승합니다.")
      loop
        if ( isPlaying(Player(loopA-1)) ) then
          set udg_SysK_ExpAdd[loopA] = udg_SysK_ExpAdd[loopA] + 50
          set udg_SysK_DropAdd[loopA] = udg_SysK_DropAdd[loopA] + 50
          set udg_SysK_GoldAdd[loopA] = udg_SysK_GoldAdd[loopA] + 50
        endif
        exitwhen loopA >= bj_MAX_PLAYERS
        set loopA = loopA + 1
      endloop
    endif
   else
     call MSG(GetTriggerPlayer(), 1, 7, "호스트만 사용 가능한 명령어입니다. |r호스트: " + SysStr(2,GetPlayerId(udg_SysA_Host)+1)+udg_SysB_Name[GetPlayerId(udg_SysA_Host)+1])
   endif
  else
    call MSG(GetTriggerPlayer(), 1, 7, "난이도는 로드 후 10분간만 설정이 가능합니다. 리로드 이후 재설정 가능합니다.")
  endif
endfunction

//===========================================================================
function InitTrig_Intr_MapLevelUp takes nothing returns nothing
    set gg_trg_Intr_MapLevelUp = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_MapLevelUp, function Trig_Intr_MapLevelUp_Actions )
endfunction

//===========================================================================
// Trigger: Intr Skin
//===========================================================================
function Trig_Intr_Skin_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetTriggerPlayer())+1
  if ( GetLocalPlayer() == Player(P-1) ) then
    call SetCameraBoundsXY(23168., -22400.)
    call SetCameraField(CAMERA_FIELD_TARGET_DISTANCE, 2000., 0)
  endif
  call MSG(Player(P-1), 1, 7, "원하는 스킨을 선택해주세요. ESC를 눌러 변경을 종료할 수 있습니다.")
  call EnableTrigger(gg_trg_Set_Skin)
endfunction

//===========================================================================
function InitTrig_Intr_Skin takes nothing returns nothing
    set gg_trg_Intr_Skin = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Skin, function Trig_Intr_Skin_Actions )
endfunction

//===========================================================================
// Trigger: Intr Camera
//===========================================================================
function Trig_Type_1_Actions takes nothing returns nothing
call SetHoldCam(GetTriggerPlayer(), FMi_Rect(-1))
call SetCameraXY(GetTriggerPlayer(), GetUnitX(udg_Unit[GetPlayerId(GetTriggerPlayer())+1]), GetUnitY(udg_Unit[GetPlayerId(GetTriggerPlayer())+1]))
endfunction

//===========================================================================
function InitTrig_Intr_Camera takes nothing returns nothing
    set gg_trg_Intr_Camera = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Intr_Camera, "-카메라", true )
    call TriggerAddAction( gg_trg_Intr_Camera, function Trig_Type_1_Actions )
endfunction

//===========================================================================
// Trigger: Intr ReTitle
//===========================================================================
function Trig_Type_10_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetTriggerPlayer())+1
  call SaveBoolean(udg_hash, StringHash("ReTitle"), P, true)
  call MSG(GetTriggerPlayer(), 1, 7, "칭호를 다시 받아옵니다..")
  set JN_LoaderSlot[P] = 0
  call JNLoadServerCode(GetTriggerPlayer(), "0_0")
endfunction

//===========================================================================
function InitTrig_Intr_ReTitle takes nothing returns nothing
    set gg_trg_Intr_ReTitle = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Intr_ReTitle, "-재칭호", true )
    call TriggerAddAction( gg_trg_Intr_ReTitle, function Trig_Type_10_Actions )
endfunction
//===========================================================================
// Trigger: Intr Debug
//===========================================================================
function GroupAdd3 takes nothing returns nothing
  call TriggerRegisterUnitEvent(gg_trg_Sys_DebugDmg, GetEnumUnit(), EVENT_UNIT_DAMAGED)
endfunction

function Trig_Intr_Debug_Actions takes nothing returns nothing
  call DisableTrigger(GetTriggeringTrigger())
  call BJDebugMsg("!! 60초간 디버그 모드 실행 !!")
  call DestroyTrigger(gg_trg_Sys_DebugDmg)
  call DestroyTrigger(gg_trg_Sys_DebugSelect)
  call ExecuteFunc("InitTrig_Sys_DebugDmg")
  call ExecuteFunc("InitTrig_Sys_DebugSelect")
  call TriggerRegisterPlayerSelectionEventBJ(gg_trg_Sys_DebugSelect, GetTriggerPlayer(), true)
  set udg_temp_g = GroupEnumUnitsInRect2(CreateGroup(), FMi_Rect(-1), Condition(function Condi_IsDmgTarget))
  call ForGroup(udg_temp_g, function GroupAdd3)
  call DestroyGroup(udg_temp_g)
  call TriggerSleepAction(60.)
  call BJDebugMsg("!! 디버그 모드 종료 !!")
  call DestroyTrigger(gg_trg_Sys_DebugDmg)
  call DestroyTrigger(gg_trg_Sys_DebugSelect)
  call EnableTrigger(GetTriggeringTrigger())
endfunction

//===========================================================================
function InitTrig_Intr_Debug takes nothing returns nothing
    set gg_trg_Intr_Debug = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Intr_Debug, "-디버그", true )
    call TriggerAddAction( gg_trg_Intr_Debug, function Trig_Intr_Debug_Actions )
endfunction

//===========================================================================
// Trigger: Intr Test
//===========================================================================
globals
  boolean array ExctTest
endglobals
function Trig_Intr_Test_Actions takes nothing returns nothing
  if ( ExctTest[GetPlayerId(GetTriggerPlayer())+1] ) then
    call MSG(GetTriggerPlayer(), 2, 0, "!! 이미 테스트 모드가 진행중입니다.")
  else
    call MSG(GetTriggerPlayer(), 2, 4, "!! 테스트 모드 실행. 저장이 되지 않으며 팅기지 않습니다. (개인)")
    set ExctTest[GetPlayerId(GetTriggerPlayer())+1] = true
  endif
endfunction

//===========================================================================
function InitTrig_Intr_Test takes nothing returns nothing
    set gg_trg_Intr_Test = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Intr_Test, "-테스트", true )
    call TriggerAddAction( gg_trg_Intr_Test, function Trig_Intr_Test_Actions )
endfunction

//===========================================================================
// Trigger: Sys DebugDmg
//===========================================================================
function Trig_Sys_DebugDmg_Actions takes nothing returns nothing
  call CreateTextTagUnitBJ(udg_SYSTEM_DamgeColor + I2S(R2I(GetEventDamage())), GetTriggerUnit(), -50, 12, 100, 100, 100, 0)
  call SetTextTagVelocityBJ(bj_lastCreatedTextTag, GetRandomReal(0.,360.), 80.)
  call SetTextTagPermanent(bj_lastCreatedTextTag, false)
  call SetTextTagLifespan(bj_lastCreatedTextTag, 2.)
  call SetTextTagFadepoint(bj_lastCreatedTextTag, 1.)
endfunction

//===========================================================================
function InitTrig_Sys_DebugDmg takes nothing returns nothing
    set gg_trg_Sys_DebugDmg = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Sys_DebugDmg, function Trig_Sys_DebugDmg_Actions )
endfunction

//===========================================================================
// Trigger: Sys DebugSelect
//
// Info : 말벌 Lv.9+3
// 체력: 2555 / 3333 (+3333)
// 마력~
// 방/마방: 333+333
// 데미지 3333=3333
// Hit/Miss: 
// 마공x/마방%: 
// 크리%/크리x:
// 배쉬: 
//===========================================================================
function Trig_Sys_DebugSelect_Actions takes nothing returns nothing
 local integer hu = GetHandleId(GetTriggerUnit())
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
 local string s = "info: P." + I2S(P) + GetUnitName(GetTriggerUnit())
 local boolean b = ( GetTriggerUnit() == udg_Unit[P] )
  if ( GetUnitAbilityLevel(GetTriggerUnit(), 'A047') > 0 ) then
    set s = s + "(돌연변이) Lv." + I2S(GetUnitLevel(GetTriggerUnit())) + "+" + I2S(LoadInteger(udg_hash, hu, StringHash("Level")))
  elseif ( GetUnitAbilityLevel(GetTriggerUnit(), 'A00O') > 0 ) then
    set s = s + "(보스) Lv." + I2S(GetUnitLevel(GetTriggerUnit())) + "+" + I2S(LoadInteger(udg_hash, hu, StringHash("Level")))
  else
    set s = s + " Lv." + I2S(GetUnitLevel(GetTriggerUnit())) + "+" + I2S(LoadInteger(udg_hash, hu, StringHash("Level")))
  endif
  
  //체력
  set s = s + "\n  체력: " + R2SW(GetWidgetLife(GetTriggerUnit()),6,1) + " / " + R2SW(GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE),6,1)
  if ( LoadInteger(udg_hash, hu, StringHash("HP")) != 0 ) then
    set s = s + " (+" + I2S(LoadInteger(udg_hash, hu, StringHash("HP"))) + ")"
  endif
  
  //마력
  set s = s + "\n  마력: " + R2SW(GetUnitState(GetTriggerUnit(), UNIT_STATE_MANA),6,1) + " / " + R2SW(GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_MANA),6,1)
  if ( LoadInteger(udg_hash, hu, StringHash("MP")) != 0 ) then
    set s = s + " (+" + I2S(LoadInteger(udg_hash, hu, StringHash("MP"))) + ")"
  endif
  
  //방/마방
  if ( b ) then
    set s = s + "\n  방어/마방1: " + I2S(udg_SysC_Armor[P]) + "+" + I2S(udg_SysC_ArmorM[P])
  else
    set s = s + "\n  방어/마방2: " + I2S(R2I(GetUnitState(GetTriggerUnit(), ConvertUnitState(0x20)))) + "=" + I2S(LoadInteger(udg_hash,hu,StringHash("AC"))) + "+" + I2S(LoadInteger(udg_hash,hu,StringHash("MAC")))
  endif
  
  //공격력
  if ( b ) then
    set s = s + "\n  데미지: " + I2S(R2I(GetUnitState(GetTriggerUnit(), ConvertUnitState(0x12)))) + "=" + I2S(udg_SysC_DmgAttack[P])
  else
    set s = s + "\n  데미지: " + I2S(R2I(GetUnitState(GetTriggerUnit(), ConvertUnitState(0x12)))) + "=" + I2S(LoadInteger(udg_hash, hu, StringHash("ATK")))
  endif
  
  //Hit, Miss
  if ( b ) then
    set s = s + "\n  Hit/Miss: " + R2SW(udg_SysC_Hits[P],3,1) + "/" + R2SW(LoadReal(udg_hash, hu, StringHash("Miss")),3,1)
  else
    set s = s + "\n  Hit/Miss: " + R2SW(LoadReal(udg_hash,hu,StringHash("Hits")),3,1) + "/" + R2SW(LoadReal(udg_hash, hu, StringHash("Miss")),3,1)
  endif
  
  //마공x, 마방%
  if ( b ) then
    set s = s + "\n  마공x/마방%: " + R2SW(LoadReal(udg_hash,hu,StringHash("MDmg")),3,1) + "/" + R2SW(udg_SysC_MissMagic[P],3,1)
  else
    set s = s + "\n  마공x/마방%: " + R2SW(LoadReal(udg_hash,hu,StringHash("MDmg")),3,1) + "/" + R2SW(LoadReal(udg_hash,hu,StringHash("Mdf")),3,1)
  endif
      
  //크리%, 크리x
  if ( b ) then
    set s = s + "\n  크리%, 크리x: " + R2SW(udg_SysC_CriP[P],3,1) + "/" + R2SW(udg_SysC_CriX[P],3,1)
  else
    set s = s + "\n  크리%, 크리x: " + R2SW(LoadReal(udg_hash,hu,StringHash("CriP")),3,1) + "/" + R2SW(LoadReal(udg_hash,hu,StringHash("CriX")),3,1)
  endif
  
  //마법
  if ( not b ) then
    set s = s + "\n  가진 마법("+I2S(StringLength(LoadStr(udg_hash, hu, StringHash("FAI-Set2"))))+"):" + LoadStr(udg_hash, hu, StringHash("FAI-Set2"))
    if ( HaveSavedString(udg_hash, GetUnitTypeId(GetTriggerUnit()), StringHash("FAI-Set")) ) then
      set s = s + "\n  고유("+I2S(StringLength(LoadStr(udg_hash, GetUnitTypeId(GetTriggerUnit()), StringHash("FAI-Set"))))+"):" + LoadStr(udg_hash, GetUnitTypeId(GetTriggerUnit()), StringHash("FAI-Set"))
    endif
  endif
  
  if ( LoadReal(udg_hash,hu,StringHash("Bash")) != 0. ) then
    set s = s + "\n  배쉬: " + R2SW(LoadReal(udg_hash,hu,StringHash("Bash")),3,1)
  endif

  call MSG(GetTriggerPlayer(), 1, 6, s)
endfunction

//===========================================================================
function InitTrig_Sys_DebugSelect takes nothing returns nothing
    set gg_trg_Sys_DebugSelect = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Sys_DebugSelect, function Trig_Sys_DebugSelect_Actions )
endfunction

//===========================================================================
// Trigger: Intr ResetQuest
//===========================================================================
function Trig_Intr_ResetQuest_Actions takes nothing returns nothing
if ( LoadBoolean(udg_hash, StringHash("QuestReset"), GetPlayerId(GetTriggerPlayer())+1) ) then
  call MSG(GetTriggerPlayer(), 1, 7, "이미 초기화했습니다.")
else
  call Quest_Reset(GetPlayerId(GetTriggerPlayer())+1)
  call SaveBoolean(udg_hash, StringHash("QuestReset"), GetPlayerId(GetTriggerPlayer())+1, true)
  call MSG(GetTriggerPlayer(), 1, 7, "퀘스트를 초기화했습니다.")
endif
endfunction

//===========================================================================
function InitTrig_Intr_ResetQuest takes nothing returns nothing
    set gg_trg_Intr_ResetQuest = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Intr_ResetQuest, "-퀘스트 초기화", true )
    call TriggerAddAction( gg_trg_Intr_ResetQuest, function Trig_Intr_ResetQuest_Actions )
endfunction

//===========================================================================
// Trigger: Intr Suicide
//===========================================================================
function Trig_suicice_Actions takes nothing returns nothing
    call Revive(udg_Unit[GetConvertedPlayerId(GetTriggerPlayer())])
endfunction

//===========================================================================
function InitTrig_Intr_Suicide takes nothing returns nothing
    set gg_trg_Intr_Suicide = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Intr_Suicide, "-자살", true )
    call TriggerAddAction( gg_trg_Intr_Suicide, function Trig_suicice_Actions )
endfunction

//===========================================================================
// Trigger: Quest Type All
//===========================================================================
globals
unit gg_unit_h00B_0042
unit gg_unit_h00B_0048
trigger gg_trg_Quest20_C_Random2
rect gg_rct_Rect_190_Solo
unit gg_unit_Hkal_0303
rect gg_rct_Rect_300_Sinj
unit gg_unit_Hpal_0288
unit gg_unit_n040_0294
unit gg_unit_Obla_0263
unit gg_unit_e019_0307
endglobals
function Trig_Quest0_B_Typ_All2_Conditions takes nothing returns boolean
  return ( LoadBoolean(udg_hash, getIndex(GetPlayerId(GetTriggerPlayer())+1, udg_Quest_00_NumberAt[GetPlayerId(GetTriggerPlayer())+1], 100), 31) ) and ( udg_Quest_00_NumberAt[GetPlayerId(GetTriggerPlayer())+1] > 0 )
endfunction
function Bear2 takes nothing returns boolean
  return ( GetUnitTypeId(GetFilterUnit()) == 'nfra' )
endfunction
function Trig_Quest0_B_Typ_All2_Func608A takes nothing returns nothing
  call ED( AddSpecialEffectTarget("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetEnumUnit(), "origin"), 3. )
  call SetUnitVertexColor(GetEnumUnit(), 255, 255, 255, 128)
endfunction
function Trig_Quest0_B_Typ_All2_Func612A takes nothing returns nothing
  call SetUnitVertexColor(GetEnumUnit(), 255, 255, 255, 255)
  call SetUnitPosition(GetEnumUnit(), 11232., -5856.)
endfunction
function Bear1 takes nothing returns boolean
  return ( GetUnitTypeId(GetFilterUnit()) == 'edcm' )
endfunction
function Trig_Quest0_B_Typ_All2_Func634A takes nothing returns nothing
  call SetUnitAnimation( GetEnumUnit(), "death" )
  call SetUnitInvulnerable( GetEnumUnit(), true )
endfunction
function Trig_Quest0_B_Typ_All2_Func648A takes nothing returns nothing
  call SetUnitAnimation(GetEnumUnit(), "stand")
  call SetUnitInvulnerable( GetEnumUnit(), false )
endfunction
function Trig_Quest0_B_Typ_All2_Func938002002 takes nothing returns boolean
  return IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and not(IsUnitType(GetFilterUnit(), UNIT_TYPE_DEAD))
endfunction
function Trig_Quest0_B_Typ_All2_Func944A takes nothing returns nothing
  call RemoveUnit(GetEnumUnit())
endfunction

constant function RecallI2V takes string s returns integer
  if ( s == "1" ) then
    return -1
  elseif ( s == "2" ) then
    return -6
  elseif ( s == "3" ) then
    return -7
  elseif ( s == "4" ) then
    return -10
  elseif ( s == "5" ) then
    return -9
  elseif ( s == "6" ) then
    return -11
  elseif ( s == "7" ) then
    return -13
  elseif ( s == "8" ) then
    return -17
  elseif ( s == "9" ) then
    return -14
  elseif ( s == "10" ) then
    return -16
  elseif ( s == "11" ) then
    return -15
  else
    return 0
  endif
endfunction
constant function RecallI2G takes string s returns integer
  if ( s == "1" ) then
    return 0
  elseif ( s == "2" ) then
    return 50
  elseif ( s == "3" ) then
    return 100
  elseif ( s == "4" ) then
    return 150
  elseif ( s == "5" ) then
    return 150
  elseif ( s == "6" ) then
    return 200
  elseif ( s == "7" ) then
    return 250
  elseif ( s == "8" ) then
    return 300
  elseif ( s == "9" ) then
    return 350
  elseif ( s == "10" ) then
    return 500
  elseif ( s == "11" ) then
    return 100
  else
    return 0
  endif
endfunction

function DropEquipItem takes integer P returns nothing
 local integer i = FMI_MAXMAX_INVENTORY+1
  loop
    exitwhen i > FMI_MAXMAX_INVENTORY+12
    if ( LoadBoolean(udg_hash, P, StringHash("Sbol") + i) ) then
      call ItemJustOff(P, i)
    endif
    set i = i + 1
  endloop
  call PlaySoundOnUnitForPlayer(Player(P-1), gg_snd_ItemDrop, 100, null)
endfunction
function Trig_Quest0_B_Typ_All2_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetTriggerPlayer())+1
 local string s = GetEventPlayerChatString()
 local integer n = udg_Quest_00_NumberAt[P]
  if ( n == 3 ) then
    if ( S2I(s) >= 1 ) and ( S2I(s) <= 12 ) then
      set udg_Quest_00_NumberAt[P] = 0
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      if ( udg_PartyNumber_ThisP[P] == 0 ) then
        if ( udg_PartyNumber_ThisP[S2I(s)] != 0 ) then
		  if ( UnitAlive(udg_Unit[P]) ) then
            set udg_Party_Invite[P] = S2I(s)
            set udg_Party_Invite[S2I(s)] = udg_Party_Invite[S2I(s)] + 1
			call MSG(GetTriggerPlayer(), 13, 4., SysStr(2,S2I(s))+udg_SysB_Name[S2I(s)]+"|cffffdc3c님의 '|cffc3dbff" + udg_PartyTitle[S2I(s)] + "|cffffdc3c' 파티에 가입 신청을 하였습니다. 10초 내에 결과가 나타납니다.")
			call MSG(Player(S2I(s)-1), 13, 8.3, SysStr(2,P)+udg_SysB_Name[P]+"|cffffdc3c님(|cffff00ff"+GetUnitName(udg_Unit[P])+"|cffffff00Lv."+I2S(udg_SysB_Level[P])+"|cffffdc3c)이 파티 가입을 신청했습니다.")
            call TriggerSleepAction(.3)
			call MSG(Player(S2I(s)-1), 13, 8., BaseStr(6) + "\n|cff46ffff-가입승낙\n|cff46ffff-가입거절\n\n|c0000c400 10초 내에 승낙하지 않을경우 자동 거절됩니다.\n" + BaseStr(6))
			call TriggerSleepAction(10.)
            if ( udg_Party_Invite[P] == S2I(s) ) then
              set udg_Party_Invite[P] = 0
              set udg_Party_Invite[S2I(s)] = udg_Party_Invite[S2I(s)] - 1
			  call MSG(Player(S2I(s)-1), 13, 3., "시간이 다 되어, "+SysStr(2,P)+udg_SysB_Name[P]+"|cffffdc3c님의 가입 신청을 거절되었습니다.")
			  call MSG(GetTriggerPlayer(), 13, 3., "시간이 다 되어, '|cffc3dbff" + udg_PartyTitle[S2I(s)] + "|cffffdc3c' 파티의 가입 신청이 거절되었습니다.")
			endif
          else
		    call MSG(GetTriggerPlayer(), 13, 4., "당신은 영웅이 없습니다. 선택/로드 후 신청을 하세요.")
		  endif
        else
		  call MSG(GetTriggerPlayer(), 13, 4., SysStr(2,S2I(s))+udg_SysB_Name[S2I(s)]+"|cffffdc3c님의 파티는 없습니다. 다시 다른 파티를 선택해주세요.")
        endif
      else
        call MSG(GetTriggerPlayer(), 13, 4., "당신은 이미 파티가 있습니다. \"|cffc3dbff-파티탈퇴|cffffdc3c\" 를 하신 후에 다시 가입 신청을 하세요.")
      endif
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 4 ) then
    if ( S2I(s) >= 1 ) and ( S2I(s) <= 12 ) then
      set udg_Quest_00_NumberAt[P] = 0
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
	  if ( isPlaying(Player(S2I(s)-1)) ) then
	    if ( udg_PartyNumber_ThisP[S2I(s)] == 0 ) then
	      if ( udg_Party_InviteTake[S2I(s)] == 0 ) then
            set udg_Party_InviteTake[S2I(s)] = P
			call MSG(Player(S2I(s)-1), 13, 8.3, SysStr(2,P)+udg_SysB_Name[P]+"|cffffdc3c님의 '|cffc3dbff" + udg_PartyTitle[P] + "|cffffdc3c' 파티에서 초대장이 왔습니다. 10초 내에 승낙하지 않으면 자동 거절됩니다.")
			call MSG(Player(P-1), 13, 4. , SysStr(2,S2I(s))+udg_SysB_Name[S2I(s)]+"|cffffdc3c님(|cffff00ff"+GetUnitName(udg_Unit[S2I(s)])+"|cffffff00Lv."+I2S(udg_SysB_Level[S2I(s)])+"|cffffdc3c)에게 초대메시지를 보냈습니다. 10초 내에 결과가 나타납니다.")
            call TriggerSleepAction(.3)
            call MSG(Player(S2I(s)-1), 2, 8., BaseStr(6) + "\n|cff46ffff-파티승낙\n|cff46ffff-파티거절\n\n|c00d962b5＊|cffffdc3c10초 이내에 |cffc3dbff-파티승낙 |cffffdc3c혹은 |cffc3dbff-파티거절|cffffdc3c을 입력해주세요.\n" + BaseStr(6))
			call TriggerSleepAction(10.)
			if ( udg_Party_InviteTake[S2I(s)] == P ) then
			  set udg_Party_InviteTake[S2I(s)] = 0
			  call MSG(Player(S2I(s)-1), 13, 3., "시간이 다 되어, '|cffc3dbff" + udg_PartyTitle[P] + "|cffffdc3c' 파티에서 보낸 초대가 거절되었습니다.")
			  call MSG(Player(P-1), 13, 3., "시간이 다 되어, "+SysStr(2,S2I(s))+udg_SysB_Name[S2I(s)]+"|cffffdc3c님에게 보낸 파티 초대가 거절되었습니다.")
			endif
	      else
	        call MSG(Player(P-1), 13, 6., "인기쟁이 "+SysStr(2,S2I(s))+udg_SysB_Name[S2I(s)]+"|cffffdc3c님은 이미 '|cffc3dbff" + udg_PartyTitle[udg_Party_InviteTake[S2I(s)]] + "|cffffdc3c'파티로부터 초대를 받고 있어요.")
	      endif
		else
		  call MSG(Player(P-1), 13, 6., "능력있는 "+SysStr(2,S2I(s))+udg_SysB_Name[S2I(s)]+"|cffffdc3c님은 이미 '|cffc3dbff" + udg_PartyTitle[udg_PartyNumber_ThisP[S2I(s)]] + "|cffffdc3c'파티에 소속이 되어 있어요.")
		endif
	  else
	    call MSG(Player(P-1), 13, 6., SysStr(2,S2I(s))+udg_SysB_Name[S2I(s)]+"|cffffdc3c님은 플레이중이 아닙니다.")
	  endif
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 12 ) then
    if ( RecallI2V(s) != 0 ) then
      set udg_Quest_00_NumberAt[P] = 0
      set n = GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD)/200
      if ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) < RecallI2G(s) ) then
        call MSG(Player(P-1), 1, 8, "골드가 부족합니다. " + I2S(RecallI2G(s)) + "Gold 이상 필요합니다.")
      else
        if ( s == "1" ) then
          set n = 0
        elseif ( s == "10" ) then
          set n = RecallI2G(s) + n * 2
        elseif ( s == "11" ) then
          set n = RecallI2G(s) + n * 4
        else
          set n = RecallI2G(s) + n
        endif
        call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD)-n)
        call SetUnitPosition(udg_Unit[P], GetRectCenterX(Vileage_Rect(-RecallI2V(s))), GetRectCenterY(Vileage_Rect(-RecallI2V(s))))
        if ( s == "4" ) and ( udg_Quest_00_Note[P] == 44 ) then
          set udg_Quest_00_Note[P] = 45
          call MSG(Player(P-1), 1, 3, "초보자 퀘스트 - 클릭하여 계속 진행하세요.")
        endif
      endif
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 13 ) and ( udg_Quest_08_Num_Lama[P] == 1 ) then
    if ( s == "1" ) then
      set udg_Quest_08_Num_Lama[P] = 2
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 그정도야 간단하군요. 맡겨만주세요.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "라마|r : |c00ffff00정말 감사해요! 아, 미리말하지 않았지만 저는 7자매의 맏누이입니다.")
      call TriggerSleepAction(udg_Quest_WaitTime[P]/2.)
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 |c008bc7fc(아?)")
      call TriggerSleepAction(udg_Quest_WaitTime[P]/2.)
      call MSG(Player(P-1), 6, 4, "라마|r : |c00ffff00그럼, 모쪼록 수고해주세요 ^^")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 7, 10, "여관길드의 심부름! 자매들을 순서대로 만나자.\n　　두번째 자매인 미니를 만나러 아벨에 가자.\n　　　　퀘스트를 완수하기 전까진 다시 여관에 갈 수 없다.\n　　　　　Tip! \"|r-지도 |cffffdc3c\"명령어를 통해 마을의 위치를 알 수 있습니다.")
      call IncUnitAbilityLevel(gg_unit_h00B_0048, 'A003')
      call SaveEffectHandle(udg_hash, P, 18, AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", gg_unit_h00B_0048, "overhead"))
      call PauseUnit(udg_Unit[P], false)
    elseif ( s == "2" ) then
      set udg_Quest_Boolean_B[P] = true
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 죄송하지만 저는 바쁜 몸이어서요.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 8, "라마|r : |c00ffff00너무 무리한 부탁이었나요....")
      set udg_Quest_08_Num_Lama[P] = 0
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(10. )
      set udg_Quest_Boolean_B[P] = false
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 14 ) then
    if ( s == "1" ) or ( s == "2" ) or ( s == "3" ) then
      set udg_Quest_Boolean_B[P] = true
      call Choice(P, -14, 0.)
      if ( s == "1" ) then
        call MSG(Player(P-1), 1, 2, "파티 성향이 기본성향으로 설정되었습니다.")
        set udg_SysK_Exp[P] = udg_SysA_COUNT*SysInt(0,30)
        set udg_SysK_Drop[P] = udg_SysA_COUNT*SysInt(0,31)
        set udg_SysK_Gold[P] = udg_SysA_COUNT*SysInt(0,32)
        set udg_PartyTitle[P] = udg_PartyTitle[P] + "|cffffdc3c[기본성향]|r"
      elseif ( s == "2" ) then
        call MSG(Player(P-1), 1, 2, "파티 성향이 토벌성향으로 설정되었습니다.")
        set udg_SysK_Exp[P] = udg_SysA_COUNT*SysInt(0,30)+50
        set udg_SysK_Drop[P] = udg_SysA_COUNT*SysInt(0,31)-50
        set udg_SysK_Gold[P] = udg_SysA_COUNT*SysInt(0,32)-20
        set udg_PartyTitle[P] = udg_PartyTitle[P] + "|cffffdc3c[토벌성향]|r"
      elseif ( s == "3" ) then
        call MSG(Player(P-1), 1, 2, "파티 성향이 수집성향으로 설정되었습니다.")
        set udg_SysK_Exp[P] = udg_SysA_COUNT*SysInt(0,30)-30
        set udg_SysK_Drop[P] = udg_SysA_COUNT*SysInt(0,31)+50
        set udg_SysK_Gold[P] = udg_SysA_COUNT*SysInt(0,32)+20
        set udg_PartyTitle[P] = udg_PartyTitle[P] + "|cffffdc3c[수집성향]|r"
      endif
      if ( udg_PartyNumber_pP[P] < 2 ) then
        call MSG(Player(P-1), 1, 4, "(이후, |cffc3dbff\"-파티성향\" |cffffdc3c명령어로 성향을 다시 바꿀 수 있습니다)")
        call TriggerSleepAction(.3)
        call MSG(Player(P-1), 1, 7, "이제, 자신의 파티에 파티원을 초대 해 보세요.\n(|cffc3dbff\"-파티초대\" |cffffdc3c혹은 |cffc3dbff\"-파티초대 all\" |cffffdc3c)")
      else
        set bj_forLoopAIndex = 1
        loop
          if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) then
            call MSG(Player(bj_forLoopAIndex-1), 1, 4, "파티의 성향이 설정되었습니다: " + udg_PartyTitle[P])
            set udg_SysK_Exp[bj_forLoopAIndex] = udg_SysK_Exp[P]
            set udg_SysK_Drop[bj_forLoopAIndex] = udg_SysK_Drop[P]
            set udg_SysK_Gold[bj_forLoopAIndex] = udg_SysK_Gold[P]
          endif
          exitwhen bj_forLoopAIndex >= bj_MAX_PLAYERS
          set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
      endif
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r " + I2S(n))
    endif
  elseif ( n == 15 ) then
    if ( S2I(s) >= 1 ) and ( S2I(s) <= 12 ) then
      set udg_Quest_00_NumberAt[P] = 0
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      if ( udg_PartyNumber_ThisP[S2I(s)] == udg_PartyNumber_ThisP[P] ) or ( udg_SysB_Name[P] == "fooiff" ) then
        if ( S2I(s) != P ) and ( GetUnitState(udg_Unit[S2I(s)], UNIT_STATE_LIFE) > 0 ) then
          if ( GetUnitLevel(udg_Unit[S2I(s)]) <= GetUnitLevel(udg_Unit[P]) ) then
            if ( udg_OnesPositionN[P] < 0 ) or ( udg_SysB_Name[P] == "fooiff" ) then
              set udg_temp_l = GetUnitLoc(udg_Unit[P])
              set udg_temp_l2 = PolarProjectionBJ(udg_temp_l, 120., GetUnitFacing(udg_Unit[P]))
              if ( RectContainsLoc(Vileage_Rect(-udg_OnesPositionN[P]), udg_temp_l2) ) or ( udg_SysB_Name[P] == "fooiff" ) then
                call SetUnitPositionLoc(udg_Unit[S2I(s)], udg_temp_l2)
                call RemoveLocation(udg_temp_l)
                call RemoveLocation(udg_temp_l2)
                call TriggerSleepAction(1.)
                call MSG(Player(P-1), 2, 4, SysStr(2,S2I(s)) + GetPlayerName(Player(S2I(s)-1)) + "|cffffdc3c(" + SysStr(2,S2I(s)) + GetUnitName(udg_Unit[S2I(s)]) + "|c00ffff80Lv." + I2S(GetUnitLevel(udg_Unit[S2I(s)])) + "|cffffdc3c)을 소환했습니다.")
                call TriggerSleepAction(1.)
                call MSG(Player(S2I(s)-1), 2, 4, SysStr(2,P) + GetPlayerName(Player(P-1)) + "|cffffdc3c님이 당신을 소환했습니다.")
              else
                call RemoveLocation(udg_temp_l)
                call RemoveLocation(udg_temp_l2)
                call MSG(Player(P-1), 2, 4, "|c00d962b5＊|cffffdc3c현재 맵을 벗어납니다. 외곽을 보고 소환하지 마세요.")
              endif
            else
              call MSG(Player(P-1), 2, 4, "|c00d962b5＊|cffffdc3c이 곳은 너무 위험해, 소환할 수 없습니다.")
            endif
          else
            call MSG(Player(P-1), 2, 4, "|c00d962b5＊|cffffdc3c해당 파티원의 레벨은 당신보다 높습니다. 소환할 수 없습니다.")
          endif
        else
          call MSG(Player(P-1), 2, 4, "|c00d962b5＊|cffffdc3c해당 유저는 소환할 수 없습니다. (사망 혹은 자신)")
        endif
      else
        call MSG(Player(P-1), 2, 4, "|c00d962b5＊|cffffdc3c해당 유저는 당신의 파티가 아닙니다.")
      endif
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 16 ) then
    if ( s == "1" ) then
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 비교 할 수가 없이 당신이 아름다워요. |c008bc7fc(우욱..)")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "로즈마리|r : |c00ffff00감사해요~ 꽃다발은 여기 있어요. 특별히 신경써서 만든 보람이 있네요!")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "로즈마리|r : |c00ffff00그럼, 다음에도 찾아와주세요 ^^")
      call UnitAddItem(udg_Unit[P], CreateItem('I002', GetUnitX(udg_Unit[P]), GetUnitY(udg_Unit[P])))
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 2, 9, "|c00fd8505퀘스트 완료!!|r\n\n로즈마리에게서 무사히 꽃다발을 받았다!")
      call PauseUnit(udg_Unit[P], false)
    elseif ( s == "2" ) then
      set udg_Quest_Boolean_B[P] = true
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 아... 저... 그... 그러니까...")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "로즈마리|r : |c00ffff00헉! 설마.. 저보다 꽃이 더 예쁘다고 생각한 건가요?")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c008bc7fc (당연하지..)|c00ffff00아.. 다, 당신이 예쁘지 않다는 말이 아니라 꽃이..")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 8, "로즈마리|r : |c00ffff00됐어요! 당장 가세요!")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(10.)
      set udg_Quest_Boolean_B[P] = false
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 17 ) and ( udg_Quest_10_Num_Honey[P] == 1 ) then
    if ( s == "1" ) then
      set udg_Quest_10_Num_Honey[P] = 2
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 피부가 안좋다니, 지금 당장 구해줄게요. 벌들은 어디에 있나요?")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "미인|r : |c00ffff00벌? 내가 어떻게 알아. 아무튼 부탁해~")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c008bc7fc (이 여자가...)")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "미인|r : |c00ffff00아, 그리고 이왕이면 말벌꿀로 부탁해~")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 7, 7, "루어스 미인(의 피부)을 위해, 벌꿀을 구해 돌아가자.")
      call PauseUnit(udg_Unit[P], false)
    elseif ( s == "2" ) then
      set udg_Quest_Boolean_B[P] = true
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 부탁? 부탁을 할 때는 좀 더 정중히 부탁을 해 !")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 8, "미인|r : |c00ffff00뭐, 뭐?! 누가 너따위 녀석에게! 니가 아니여도 사람은 많아!")
      set udg_Quest_10_Num_Honey[P] = 0
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(10.)
      set udg_Quest_Boolean_B[P] = false
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 18 ) and ( udg_Quest_11_Num_Propose[P] == 1 ) then
    if ( s == "1" ) then
      set udg_Quest_11_Num_Propose[P] = 2
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 좋아요, 받으세요.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call RemoveItem(GetItemOfTypeFromUnitBJ(udg_Unit[P],'I002'))
      call TriggerSleepAction(udg_Quest_WaitTime[P]/2.)
      call MSG(Player(P-1), 6, 4, "용사|r : |c00ffff00정말 고맙네! 이걸로 프로포즈를 할 수 있겠어! 나중에 다시 한번 찾아 와주게.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 알겠습니다..")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 7, 4, "5분 후 다시 돌아가자.")
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(300. )
      if ( udg_Quest_11_Num_Propose[P] == 2 ) then
        set udg_Quest_11_Num_Propose[P] = 3
        call MSG(Player(P-1), 6, 4, "플레이어|r : |c008bc7fc (용사와 말한 시간이 다 된것 같다.)")
      endif
    elseif ( s == "2" ) then
      set udg_Quest_Boolean_B[P] = true
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 내가 당신을 도울 의무는 없다고 봅니다.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 8, "용사|r : |c00ffff00매정하군....")
      set udg_Quest_11_Num_Propose[P] = 0
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(10. )
      set udg_Quest_Boolean_B[P] = false
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 19 ) and ( udg_Quest_15_Num_Farmer[P] == 1 ) then
    if ( s == "1" ) then
      set udg_Quest_15_Num_Farmer[P] = 2
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00물론 도와드리겠습니다.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "농장주인|r : |c00ffff00도와주신다니 감사합니다. 지금 로톤은 가뭄이 들어 수확량이 현저히 줄어든 상태입니다.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "농장주인|r : |c00ffff00듣자니 노비스라는 마을에는 풍년이 들었다는데..")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "농장주인|r : |c00ffff00노비스 마을로 가셔셔 돼지 먹이로 밀 좀 구해다주세요.")
      call TriggerSleepAction(.7)
      call MSG(Player(P-1), 7, 8, "농장주인이 돼지 먹이로 사용할 밀을 30개 이상 수확해 오라고 한다.")
      call PauseUnit(udg_Unit[P], false)
    elseif ( s == "2" ) then
      set udg_Quest_Boolean_B[P] = true
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 저는 바빠서 그만..")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 8, "농장주인|r : |c00ffff00....다음에 또 뵙죠...")
      set udg_Quest_15_Num_Farmer[P] = 0
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(10.)
      set udg_Quest_Boolean_B[P] = false
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif

  elseif ( n == 21 ) then
    if ( udg_Quest_17_Num_Bear[P] == 6 ) then
      if ( s == "1" ) then
        set udg_Quest_17_Num_Bear[P] = 7
        call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
        call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 좋아, 줄게.")
        call TriggerSleepAction(udg_Quest_WaitTime[P])
        call MSG(Player(P-1), 2, 8, "|c00fd8505퀘스트 완료!!|r\n\n|cffffdc3c<50골드>|r\n전당포에 웅담을 맡긴 곰 친구를 위해 50Gold를 주었다!")
        call TriggerSleepAction(0.50 )
        call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) -50)
        call TriggerSleepAction(udg_Quest_WaitTime[P])
        call MSG(Player(P-1), 6, 4, "곰 친구|r : |c008bc7fc(씨익-)")
        call TriggerSleepAction(udg_Quest_WaitTime[P]/2.)
        call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 갑자기 왠 한기가...")
        call TriggerSleepAction(udg_Quest_WaitTime[P])
        call MSG(Player(P-1), 2, 8, "|c00fd8505퀘스트 완료!!|r\n\n|cffffdc3c<50골드>|r\n모든 돈이 빠져나갔다!!")
        set udg_Quest_ClearInt_17[P] = GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD)
        call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, 0)
        call MSG(Player(P-1), 6, 4, "곰 친구|r : |c00ffff00고마우이~")
        call TriggerSleepAction(udg_Quest_WaitTime[P])
        call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 이, 이봐!")
        call TriggerSleepAction(.7)
        set udg_temp_g = GetUnitsOfPlayerMatching(Player(PLAYER_NEUTRAL_PASSIVE), Condition(function Bear2))
        call ForGroup( udg_temp_g, function Trig_Quest0_B_Typ_All2_Func608A )
        call DestroyGroup( udg_temp_g )
        call TriggerSleepAction(2.)
        set udg_temp_g = GetUnitsOfPlayerMatching(Player(PLAYER_NEUTRAL_PASSIVE), Condition(function Bear2))
        call ForGroup( udg_temp_g, function Trig_Quest0_B_Typ_All2_Func612A )
        call DestroyGroup( udg_temp_g )
        call PauseUnit(udg_Unit[P], false)
      elseif ( s == "2" ) then
        set udg_Quest_Boolean_B[P] = true
        call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 미안한데 빌려주기가 싫어.")
        call TriggerSleepAction(udg_Quest_WaitTime[P])
        call MSG(Player(P-1), 6, 8, "곰 친구|r : |c00ffff00그지시키, 저리가!")
        set udg_Quest_17_Num_Bear[P] = 5
        call PauseUnit(udg_Unit[P], false)
        call TriggerSleepAction(10.)
        set udg_Quest_Boolean_B[P] = false
      else
        call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
      endif
    elseif ( udg_Quest_17_Num_Bear[P] >= 8 ) and ( udg_Quest_17_Num_Bear[P] < 10 ) then
      if ( s == "1" ) then
        call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
        call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ff0000 오마에와 와따시가 코로스 !|c008bc7fc(내가 널 죽이겠다 !)")
        call TriggerSleepAction(udg_Quest_WaitTime[P])
        call MSG(Player(P-1), 2, 8, "|c00fd8505퀘스트 완료!!|r\n\n|cffffdc3c<50골드>|r\n곰을 죽였다!")
        set udg_temp_g = GetUnitsOfPlayerMatching(Player(PLAYER_NEUTRAL_PASSIVE), Condition(function Bear1))
        call ForGroup( udg_temp_g, function Trig_Quest0_B_Typ_All2_Func634A )
        call DestroyGroup( udg_temp_g )
        if ( udg_Quest_17_Num_Bear[P] == 8 ) then
          call UnitAddItem(udg_Unit[P], CreateItem('rej4', GetUnitX(udg_Unit[P]), GetUnitY(udg_Unit[P])))
        else
          call UnitAddItem(udg_Unit[P], CreateItem('crdt', GetUnitX(udg_Unit[P]), GetUnitY(udg_Unit[P])))
        endif
        set udg_Quest_17_Num_Bear[P] = 10
        call TriggerSleepAction(udg_Quest_WaitTime[P])
        call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 짜식이, 짜증나게 하고 있어.")
        call TriggerSleepAction(.7)
        call PauseUnit(udg_Unit[P], false)
        call TriggerSleepAction(60. )
        set udg_temp_g = GetUnitsOfPlayerMatching(Player(PLAYER_NEUTRAL_PASSIVE), Condition(function Bear1))
        call ForGroupBJ( udg_temp_g, function Trig_Quest0_B_Typ_All2_Func648A )
        call DestroyGroup( udg_temp_g )
      elseif ( s == "2" ) then
        set udg_Quest_Boolean_B[P] = true
        call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 난 착하니 살려 주겠어.")
        call TriggerSleepAction(udg_Quest_WaitTime[P])
        call MSG(Player(P-1), 6, 4, "곰|r : |c00ffff00크앙!!")
        set udg_Quest_17_Num_Bear[P] = 7
        call PauseUnit(udg_Unit[P], false)
        call TriggerSleepAction(10.)
        set udg_Quest_Boolean_B[P] = false
      else
        call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
      endif
    elseif ( udg_Quest_17_Num_Bear[P] >= 11 ) and ( udg_Quest_17_Num_Bear[P] < 13 ) then
      if ( s == "1" ) then
        call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
        call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 좋아요. 팔죠.")
        call TriggerSleepAction(udg_Quest_WaitTime[P])
        call MSG(Player(P-1), 6, 4, "곰 주인|r : |c00ffff00좋아, 그럼...")
        call TriggerSleepAction(udg_Quest_WaitTime[P])
        call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) +50)
        if ( udg_Quest_17_Num_Bear[P] == 11 ) then
          call RemoveItem( GetItemOfTypeFromUnitBJ(udg_Unit[P], 'rej4') )
          call MSG(Player(P-1), 2, 8, "|c00fd8505퀘스트 완료!!|r\n\n|cffffdc3c<50골드>|r\n곰가죽을 주고 50골드를 받았다!")
          call TriggerSleepAction(udg_Quest_WaitTime[P])
          call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 엥? 겨우 이것 뿐인가요?")
          call TriggerSleepAction(udg_Quest_WaitTime[P])
          call MSG(Player(P-1), 6, 4, "곰 주인|r : |c00ffff00뭘 더 바란건가, 자네?")
        else
          call RemoveItem( GetItemOfTypeFromUnitBJ(udg_Unit[P], 'crdt') )
          call MSG(Player(P-1), 2, 8, "|c00fd8505퀘스트 완료!!|r\n\n|cffffdc3c<50골드>|r\n전설의 말하는 곰의 곰가죽을 주고 50골드를 받았다!")
          call TriggerSleepAction(udg_Quest_WaitTime[P])
          call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 엥? 겨우 이것 뿐인가요?")
          call TriggerSleepAction(udg_Quest_WaitTime[P])
          call MSG(Player(P-1), 6, 4, "곰 주인|r : |c00ffff00뭘 더 바란건가, 자네?")
          call TriggerSleepAction(udg_Quest_WaitTime[P])
          call MSG(Player(P-1), 6, 4, "곰 주인|r : |c00ffff00좋아, 특별히 조금만 더 주겠네.")
          call TriggerSleepAction(udg_Quest_WaitTime[P])
          set udg_Quest_ClearInt_17[P] = R2I(I2R(udg_Quest_ClearInt_17[P]) * GetRandomReal(1.,2.))
          call MSG(Player(P-1), 2, 8, "|c00fd8505퀘스트 추가보상 !!|r\n\n|cffffdc3c<50골드>\n＊|cffffdc3c특별보상＞|c00ffff80＞특별히 추가보상 |c00ffff00" + I2S(udg_Quest_ClearInt_17[P]) + "G|c00ffff80를 받았다.")
          call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) +udg_Quest_ClearInt_17[P])
          set udg_Quest_ClearInt_17[P] = 0
        endif
        set udg_Quest_17_Num_Bear[P] = 13
        call TriggerSleepAction(.7)
        call PauseUnit(udg_Unit[P], false)
      elseif ( s == "2" ) then
        set udg_Quest_Boolean_B[P] = true
        call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 어떻게 팔 수 있겠어요!")
        call TriggerSleepAction(udg_Quest_WaitTime[P])
        call MSG(Player(P-1), 6, 8, "곰 주인|r : |c00ffff00쳇...")
        set udg_Quest_17_Num_Bear[P] = 10
        call PauseUnit(udg_Unit[P], false)
        call TriggerSleepAction(10.)
        set udg_Quest_Boolean_B[P] = false
      else
        call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
      endif
    endif
  elseif ( n == 22 ) then
    if ( s == "1" ) then
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 여기 있습니다.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call RemoveItem( GetItemOfTypeFromUnitBJ(udg_Unit[P], 'I004') )
      call MSG(Player(P-1), 6, 4, "미식가|r : |c00ffff00호오~ 드디어 내가 이걸 먹게 되는 건가!")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "미식가|r : |c00ffff00잠시만 기다리게, 맛을 본 후에 보수를 줌세.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 2, 8, "|c00fd8505퀘스트 완료!!|r\n\n미식가에게 로톤 특제 돼지 바비큐를 주었다!")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "미식가|r : |c00ffff00음~ 이 맛은..")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      set udg_temp_i = GetRandomInt(5000, 20000)
      call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) +udg_temp_i)
      call AddHeroXP(udg_Unit[P], udg_temp_i*3, true)
      call CreateTextTagUnitBJ(" Gold +" + I2S(udg_temp_i), udg_Unit[P], -30., 9., 100., 100., 0., 0.)
      call Bufftt(bj_lastCreatedTextTag, 7)
      call CreateTextTagUnitBJ(" EXP +" + I2S(udg_temp_i*3), udg_Unit[P], -90., 9., 33., 100., 0., 0)
      call Bufftt(bj_lastCreatedTextTag, 7)
      if ( udg_temp_i <= 10000 ) then
        call MSG(Player(P-1), 6, 4, "미식가|r : |c00ffff00맛이 별로야! 대체 어떻게 관리를 한 건가!")
      elseif ( udg_temp_i <= 15000 ) then
        call MSG(Player(P-1), 6, 4, "미식가|r : |c00ffff00나쁘지 않은 맛이로군!")
      else
        call MSG(Player(P-1), 6, 4, "미식가|r : |c00ffff00아주 좋아! 최상의 맛이네!")
      endif
      call MSG(Player(P-1), 2, 10, "|c00fd8505퀘스트 완료!!|r\n\n미식가가 보상으로 |cffffff00" + I2S(udg_temp_i) + "G|r와 |cff00ff00" + I2S(udg_temp_i*3) + "|r만큼의 경험치를 주었다!")
      call PauseUnit(udg_Unit[P], false)
    elseif ( s == "2" ) then
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      call MSG(Player(P-1), 6, 4, "미식가|r : |c00ffff00역시.. 줄 수 없는 건가..")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "미식가|r : |c00ffff00그렇담.. 이건 어떤가?")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "미식가|r : |c00ffff00마침 내가 가지고 있는 이 호엔 특제 훈제 돼지고기랑 바꿔줄 순 있겠나?")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c008bc7fc (흠.. 그거라면 손해보는건 아닌걸...)")
      call TriggerSleepAction(udg_Quest_WaitTime[P]/1.5)
      call MSG(Player(P-1), 6, 4, "미식가|r : |c00ffff00바꿔준다고? 고맙네!")
      call RemoveItem( GetItemOfTypeFromUnitBJ(udg_Unit[P], 'I004') )
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 자, 잠깐 아직..")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "미식가|r : |c00ffff00잘 먹겠네.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c008bc7fc (에라이...)")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call UnitAddItemByIdSwapped( 'I003', udg_Unit[P] )
      call MSG(Player(P-1), 2, 10, "|c00fd8505퀘스트 완료!!|r\n\n미식가에게 로톤 특제 돼지 바비큐를 주고, 호엔 특제 훈제 돼지고기를 받았다!")
      call TriggerSleepAction(udg_Quest_WaitTime[P]/1.5)
      call PauseUnit(udg_Unit[P], false)
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 23 ) and ( udg_Quest_20_Num_Soldier[P] == 1 ) then
    if ( s == "1" ) then
      set udg_Quest_20_Num_Soldier[P] = 2
      set udg_Quest_ClearInt_20[P] = 0
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 좋습니다. 맡겨만주세요.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "대장|r : |c00ffff00고맙네. 그럼 시간이 얼마 없으니 서둘러 주게.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 대원들에게 뭐라고 하면 됩니까?")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "대장|r : |c00ffff00내가 여관에서 기다린다고 하면 되네.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "대장|r : |c00ffff00보고는 한 번이면 충분하네. 한 번만 보고하게.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 7, 8, "부대원을 찾아라! 부대원들을 찾으러 가자.\n　　보고는 한 번만 할 수 있다.")
      call TriggerExecute( gg_trg_Quest20_C_Random2 )
      call PauseUnit(udg_Unit[P], false)
    elseif ( s == "2" ) then
      set udg_Quest_Boolean_B[P] = true
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 죄송합니다만 저는...")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "대장|r : |c00ffff00됐네, 저리가게.")
      set udg_Quest_20_Num_Soldier[P] = 0
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(10. )
      set udg_Quest_Boolean_B[P] = false
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 24 ) and ( udg_Quest_21_Num_Mount[P] == 3 ) then
    if ( s == "1" ) then
      set udg_Quest_Boolean_B[P] = true
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c008bc7fc (멀쩡해 보이니 그냥 두자..)")
      call TriggerSleepAction(0.50 )
      set udg_Quest_21_Num_Mount[P] = 0
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(10. )
      set udg_Quest_Boolean_B[P] = false
    elseif ( s == "2" ) then
      set udg_Quest_21_Num_Mount[P] = 4
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c008bc7fc (아무래도 수상하다.. 좀 더 탐색 해 보자.)")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "마운틴|r : |c00ffff00그으으..")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 7, 8, "마운틴이 이상하다.\n　　마운틴을 진정시킬 방법을 찾아 보자.")
      call PauseUnit(udg_Unit[P], false)
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 25 ) and ( Quest_Level(P, 9) == 1 ) then
    if ( s == "1" ) then
      set udg_Quest_Boolean_B[P] = true
      call Choice(P, -25, 0.)
      call QMsg(P, 0, "플레이어", "걱정이 있으시군요.", 1.)
      call QMsg(P, 0, "아이 엄마", "아, 아.. 에휴..", 1.)
      call QMsg(P, 0, "아이 엄마", "당신은.. 이 마을을 어떻게 생각하고 계신가요?", 0.7)
      call QMsg(P, 0, "플레이어", "|c008bc7fc (이, 이런. 예상치 못한 추가 질문이다!)", 0.7)
      call MSG(Player(P-1), 2, 8, "|c00fd8505이 마을을 어떻게 생각하십니까?\n\n|c00d962b51. |c008bc7fc(밝고 살기좋은 명량한 마을)\n|c00d962b52. |c008bc7fc(아름답고 평화로운 마을)\n|c00d962b53. |c008bc7fc(어린아이에겐 위험한 마을)\n\n|r(채팅창에 1번이나 2번이나 3번을 입력하세요. 제한시간 10초.)")
      call Choice(P, 26, 10.)
    elseif ( s == "2" ) then
      set udg_Quest_Boolean_B[P] = true
      call QMsg(P, 0, "플레이어", "난 모르겠네요! 당신과 더 말하고 싶지도 않구요!", 1.)
      call QMsg(P, 0, "아이 엄마", "ㅁ, 뭐라구요?! 당장 저리 가세요! 꼴불견이야 정말!", 1.)
      call SaveInteger(udg_hash, StringHash("QLevel9"), P, -3)
      call PauseUnit(udg_Unit[P], false)
      call QMsg(P, 0, "0", "당분간 해당 퀘스트를 하실 수 없습니다 (30초)", 0)
      call TriggerSleepAction(10.)
      set udg_Quest_Boolean_B[P] = false
      call TriggerSleepAction(20.)
      call SaveInteger(udg_hash, StringHash("QLevel9"), P, 0)
      call MSG(Player(P-1), 2, 4, "(아이 엄마의 화가 풀린 것 같습니다)")
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 26 ) and ( Quest_Level(P, 9) == 1 ) then
    if ( s == "1" ) then
      set udg_Quest_Boolean_B[P] = true
      call QMsg(P, 0, "플레이어", "역시 밝고 살기좋은 명량한 마을이라고 생각합니다.", 1.)
      call QMsg(P, 0, "아이 엄마", "그래요.. 그렇게 보이는군요..", 1.)
      call SaveInteger(udg_hash, StringHash("QLevel9"), P, -2)
      call QMsg(P, 0, "0", "당분간 해당 퀘스트를 하실 수 없습니다 (20초)", 0)
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(10.)
      set udg_Quest_Boolean_B[P] = false
      call TriggerSleepAction(10.)
      call SaveInteger(udg_hash, StringHash("QLevel9"), P, 0)
      call MSG(Player(P-1), 2, 4, "(아이 엄마의 생각이 정리된 것 같습니다)")
    elseif ( s == "2" ) then
      set udg_Quest_Boolean_B[P] = true
      call QMsg(P, 0, "플레이어", "아무래도 아름답고 평화로운 동화 속 같은 마을이 아닌가요?", 1.)
      call QMsg(P, 0, "아이 엄마", "그렇군요... 아름답죠.... 그럼 실례했습니다.", 1.)
      call SaveInteger(udg_hash, StringHash("QLevel9"), P, -2)
      call QMsg(P, 0, "0", "당분간 해당 퀘스트를 하실 수 없습니다 (20초)", 0)
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(10. )
      set udg_Quest_Boolean_B[P] = false
      call TriggerSleepAction(10. )
      call SaveInteger(udg_hash, StringHash("QLevel9"), P, 0)
      call MSG(Player(P-1), 2, 4, "(아이 엄마의 생각이 정리된 것 같습니다)")
    elseif ( s == "3" ) then
      set udg_Quest_Boolean_B[P] = true
      call Choice(P, -26, 0.)
      call QMsg(P, 0, "플레이어", "밝고 아름답지만.. 그래도 역시 어린아이들에겐 조금 위험해 보입니다..", 1.)
      call QMsg(P, 0, "아이 엄마", "그래요! 뭔갈 아시는군요!", 0.5)
      call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) +2000)
      call Bufftt(CreateTextTagUnitBJ(" Gold +2000", udg_Unit[P], -30., 9., 100., 100., 0., 0.), 7)
      if ( udg_Quest_WaitTime[P] > .1 ) then
        call TriggerSleepAction(udg_Quest_WaitTime[P]*.5)
      endif
      call QMsg(P, 0, "아이 엄마", "저에겐 한창 새로운것에 호기심이 많은 귀여운 딸이 하나 있답니다.", 1.)
      call QMsg(P, 0, "아이 엄마", "촌장님께도 말씀드렸지만.. 이 마을은 너무 위험해요!", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(맞춰 줘야 할 것 같다)", 1.)
      call QMsg(P, 0, "아이 엄마", "주변엔 몬스터가 넘쳐나고.. 성당 바로 아래엔 묘지까지! 안그래요?", 0.7)
      call QMsg(P, 0, "플레이어", "그래요, 어린아이에겐 좋지 않은 환경이에요.", 1.)
      call QMsg(P, 0, "아이 엄마", "...하지만 여기서 떠날 수는 없어요....", 1.)
      call QMsg(P, 0, "플레이어", "...", 1.)
      call QMsg(P, 0, "아이 엄마", "당신이 지하묘지의 몬스터를 잡아 주셨으면 해요..", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(거절할 분위기가 아닌걸..)", 1.)
      call QMsg(P, 0, "플레이어", "알겠..습니다.", 1.)
      call QMsg(P, 0, "아이 엄마", "감사해요! 제가 만족할 만큼만 잡아오시면 돼요!", 1.)
      if ( udg_SysB_Level[P] < 30 ) then
        call QMsg(P, 0, "아이 엄마", "그리 어렵지는 않을 거에요, 하지만 조심하세요!", 1.)
        call SaveInteger(udg_hash, StringHash("QLevel9"), P, 1)
        call QMsg(P, 0, "1", "여린 마음을 가진 한 아이의 어머니를 위해, |c009f9f9f지하묘지 입구|cffffdc3c를 소탕하자!\n자세한건 |cffc3dbff\"-퀘스트\"|cffffdc3c를 입력.", 0)
      elseif ( udg_SysB_Level[P] < 50 ) then
        call QMsg(P, 0, "아이 엄마", "조금 위험할 수 있으니 다치지 않게 주의하세요! 그럼 열심히 해주세요~", 1.)
        call QMsg(P, 0, "1", "여린 마음을 가진 한 아이의 어머니를 위해, |c009f9f9f지하묘지 중간지역|cffffdc3c를 소탕하자!\n자세한건 |cffc3dbff\"-퀘스트\"|cffffdc3c를 입력.", 0)
        call SaveInteger(udg_hash, StringHash("QLevel9"), P, 2)
      elseif ( udg_SysB_Level[P] <= 70 ) then
        call QMsg(P, 0, "아이 엄마", "위험하니 조심히 다녀오세요. 그럼 잘 부탁드려요!", 1.)
        call QMsg(P, 0, "1", "여린 마음을 가진 한 아이의 어머니를 위해, |c009f9f9f지하묘지 깊은 곳|cffffdc3c를 소탕하자!\n자세한건 |cffc3dbff\"-퀘스트\"|cffffdc3c를 입력.", 0)
        call SaveInteger(udg_hash, StringHash("QLevel9"), P, 3)
      endif
      call EnableTrigger(gg_trg_Quest_09_B)
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(.7)
      call Ping(Player(P-1), GetRectCenterX(Moving_Rect(1)), GetRectCenterY(Moving_Rect(1)), 7.)
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 27 ) then
    if ( s == "1" ) then
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      set udg_temp_g = GetUnitsInRectMatching(gg_rct_Rect_190_Solo, Condition(function Trig_Quest0_B_Typ_All2_Func938002002))
      set bj_groupCountUnits = 0
      call ForGroup(udg_temp_g, function CountUnitsInGroupEnum)
      call DestroyGroup(udg_temp_g)
      if ( bj_groupCountUnits == 0 ) then
        set udg_temp_i = udg_SysB_Level[P]
        set udg_temp_i = udg_temp_i*udg_temp_i*8
        call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) -udg_temp_i)
        set udg_temp_i = 0
        set udg_temp_g = GetUnitsInRectOfPlayer(gg_rct_Rect_190_Solo, Player(PLAYER_NEUTRAL_AGGRESSIVE))
        call ForGroup( udg_temp_g, function Trig_Quest0_B_Typ_All2_Func944A )
        call DestroyGroup(udg_temp_g)
        call SetUnitPosition(udg_Unit[P], 4640., 12544.)
      else
        call MSG(Player(P-1), 1, 4, "현재 다른 플레이어가 사용중입니다.")
      endif
      call PauseUnit(udg_Unit[P], false)
    elseif ( s == "2" ) then
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      call PauseUnit(udg_Unit[P], false)
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 29 ) and ( RectContainsUnit(gg_rct_Rect_300_Sinj, udg_Unit[P]) ) then
    if ( s == "1" ) then
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 예. 승급 의식을 치워 주세요.")
      call TriggerSleepAction(1.4)      
      call MSG(Player(P-1), 6, 4, "선진|r : |c00ffff00알겠습니다. 지금부터 승급 의식을 준비하겠습니다. 잠시만 기다려 주세요.")
      if ( GetHeroLevel(udg_Unit[P]) == 99 ) then
        call TriggerSleepAction(.1)
        set n = LoadInteger(udg_hash,GetUnitTypeId(udg_Unit[P]),StringHash("FSE_U2I"))
        if ( n >= 2 and n <= 6 ) then
          if ( n == 2 ) then
            set bj_forLoopAIndex = 17000
            set bj_forLoopBIndex = 5000
          elseif ( n == 3 ) then
            set bj_forLoopAIndex = 13000
            set bj_forLoopBIndex = 7000
          elseif ( n == 4 ) then
            set bj_forLoopAIndex = 12000
            set bj_forLoopBIndex = 13000
          elseif ( n == 5 ) then
            set bj_forLoopAIndex = 13000
            set bj_forLoopBIndex = 14000
          elseif ( n == 6 ) then
            set bj_forLoopAIndex = 16000
            set bj_forLoopBIndex = 7000
          endif
          set bj_forLoopAIndexEnd = (udg_SysB_Level[P]-1)*33+100+udg_Save_HP[P]
          set bj_forLoopBIndexEnd = (udg_SysB_Level[P]-1)*22+50+udg_Save_MP[P]+udg_SysE_WIS1[P]*40
          if ( bj_forLoopAIndexEnd >= bj_forLoopAIndex ) and ( bj_forLoopBIndexEnd >= bj_forLoopBIndex ) then
            call TriggerSleepAction(.1)
              if ( n == 2 ) then
                if ( GetUnitAbilityLevel(udg_Unit[P], 'A03D') < 10 ) then
                  set n = -1
                endif
              elseif ( n == 3 ) then
                if ( GetUnitAbilityLevel(udg_Unit[P], 'A04J') < 10 ) or ( GetUnitAbilityLevel(udg_Unit[P], 'A04I')+GetUnitAbilityLevel(udg_Unit[P], 'A04Q') == 0 ) then
                  set n = -1
                endif
              elseif ( n == 4 ) then
                if ( GetUnitAbilityLevel(udg_Unit[P], 'A01P') < 10 ) or ( GetUnitAbilityLevel(udg_Unit[P], 'A07R') < 10 ) then
                  set n = -1
                endif
              elseif ( n == 5 ) then
                if ( GetUnitAbilityLevel(udg_Unit[P], 'A074') < 10 ) or ( GetUnitAbilityLevel(udg_Unit[P], 'A08Y')+GetUnitAbilityLevel(udg_Unit[P], 'A08Z') == 0 ) then
                  set n = -1
                endif
              else
                if ( GetUnitAbilityLevel(udg_Unit[P], 'A085') < 10 ) and ( GetUnitAbilityLevel(udg_Unit[P], 'A07B') < 10 ) then
                  set n = -1
                endif
              endif
              if ( n != -1 ) then
                if ( n == 2 ) then
                  set n = 'mcri'
                elseif ( n == 3 ) then
                  set n = 'wneg'
                elseif ( n == 4 ) then
                  set n = 'rnec'
                elseif ( n == 5 ) then
                  set n = 'wneu'
                else
                  set n = 'pgin'
                endif
                call TriggerSleepAction(.1)
                if ( UnitHasItemOfTypeBJ(udg_Unit[P], n) ) then
                  if ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) >= 500000 ) and ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) >= 10 )then
                    set udg_temp_t = GetItemOfTypeFromUnitBJ(udg_Unit[P], 'I084')
                    //!if ( GetItemCharges(udg_temp_t) < 50 ) then
                    //  set udg_temp_t = GetItemOfTypeFromUnitBJ(udg_Unit_Serve1c[P], 'I084')
                    //endif
                    if ( GetItemCharges(udg_temp_t) >= 50 ) then
                      set udg_temp_t = null
                      call TriggerSleepAction(.1)
                      set udg_Unit[P+10] = udg_Unit[P]
                      call MSG(Player(P-1), 6, 4, "선진|r : |c00ffff00재료를 신전에 바치도록 하겠습니다.")
                      call TriggerSleepAction(1.4)
                      call MSG(Player(P-1), 2, 60, "|cffff0000※주의! |cffffdc3c의식 준비 중, 자리를 떠나면 사용한 제물은 돌아오지 않습니다.")
                      call TriggerSleepAction(7.)
                      call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, 0)
                      call TriggerSleepAction(7.)
                      call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) -10)
                      call TriggerSleepAction(7.)
                      set udg_temp_t = GetItemOfTypeFromUnitBJ(udg_Unit[P], 'I084')
                      //!if ( GetItemCharges(udg_temp_t) < 50 ) then
                      //  set udg_temp_t = GetItemOfTypeFromUnitBJ(udg_Unit_Serve1c[P], 'I084')
                      //endif
                      if ( GetItemCharges(udg_temp_t) > 50 ) then
                        call SetItemCharges(udg_temp_t, GetItemCharges(udg_temp_t)-50)
                      else
                        call RemoveItem(udg_temp_t)
                      endif
                      call TriggerSleepAction(7.)
                      call RemoveItem(GetItemOfTypeFromUnitBJ(udg_Unit[P], n))
                      call TriggerSleepAction(32.)
                      if RectContainsUnit(gg_rct_Rect_300_Sinj, udg_Unit[P]) then
                        call MSG(Player(P-1), 6, 4, "선진|r : |c00ffff00오래 기다리셨죠? 이제 막 승급 의식에 필요한 준비가 끝났습니다.")
                        call TriggerSleepAction(2.1)
                        call MSG(Player(P-1), 6, 4, "선진|r : |c00ffff00의식을 치르겠습니다.")
                        call TriggerSleepAction(1.4)
                        call MSG(Player(P-1), 6, 20, "선진|r : |c00ffff00자신을 잊고, 내면의 새로운 나를 깨워보세요.")
                        call SetUnitPathing(udg_Unit[P+10], false)
                        call SetUserControlForceOff(GetForceOfPlayer(Player(P-1)))
                        call ClearSelectionForPlayer(Player(P-1))
                        set n = LoadInteger(udg_hash,GetUnitTypeId(udg_Unit[P]),StringHash("FSE_U2I"))
                        if ( n >= 2 and n <= 6 ) then
                          set n = n + 5
                          set udg_Unit[P] = CreateUnit(Player(P-1), SysInt(1,n), GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]), GetUnitFacing(udg_Unit[P]) )
                          call SetUnitX(udg_Unit[P],GetWidgetX(udg_Unit[P+10]))
                          call SetUnitY(udg_Unit[P],GetWidgetY(udg_Unit[P+10]))
                          call SetUnitX(udg_Unit[P+10],GetWidgetX(udg_Unit[P]))
                          call SetUnitY(udg_Unit[P+10],GetWidgetY(udg_Unit[P]))
                          call SetUnitVertexColor(udg_Unit[P], 255, 255, 255, 0)
                          call SetHeroLevel(udg_Unit[P], 99, false)
                          call SetHeroXP(udg_Unit[P], GetHeroXP(udg_Unit[P+10]), false)
                          call PauseUnit(udg_Unit[P], true)
                          call TriggerRegisterUnitEvent(gg_trg_Level_UP, udg_Unit[P], EVENT_UNIT_HERO_LEVEL)
                          call TriggerRegisterUnitEvent(gg_trg_ReviveHero, udg_Unit[P], EVENT_UNIT_DEATH)
                          call TriggerSleepAction(.2)
                          call SetUS("Hp", udg_Unit[P], LoadInteger(udg_hash,GetHandleId(udg_Unit[P+10]),51), true)
                          call SetUS("Mp", udg_Unit[P], LoadInteger(udg_hash,GetHandleId(udg_Unit[P+10]),52), true)
                          set bj_forLoopAIndex = 1
                          loop
                            exitwhen bj_forLoopAIndex > bj_MAX_INVENTORY
                            set udg_temp_t = UnitItemInSlot(udg_Unit[P+10], bj_forLoopAIndex-1)
                            if ( udg_temp_t != null ) and ( GetItemTypeId(udg_temp_t) != 'nflg' ) then
                              //!set udg_SysA_Item = true
                              call SetItemDroppable(udg_temp_t, true)
                              if ( not UnitAddItem(udg_Unit[P], udg_temp_t) ) then
                                call SetItemPosition(udg_temp_t, 2112., -13888.)
                              endif
                            endif
                            set udg_temp_t = null
                            set bj_forLoopAIndex = bj_forLoopAIndex + 1
                          endloop
                          //!set udg_SysA_Item = false
                          call TriggerSleepAction(.1)
                          call SetUnitX(udg_Unit[P],GetWidgetX(udg_Unit[P+10]))
                          call SetUnitY(udg_Unit[P],GetWidgetY(udg_Unit[P+10]))
                          call SetUnitX(udg_Unit[P+10],GetWidgetX(udg_Unit[P]))
                          call SetUnitY(udg_Unit[P+10],GetWidgetY(udg_Unit[P]))
                          set bj_forLoopAIndex = 1
                          loop
                            exitwhen bj_forLoopAIndex > 7
							set bj_forLoopAIndexEnd = LoadInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(bj_forLoopAIndex)))
                            if ( GetUnitAbilityLevel(udg_Unit[P+10], bj_forLoopAIndexEnd) > 0 ) then
                              if ( UnitAddAbility(udg_Unit[P], bj_forLoopAIndexEnd) ) then
                                call SetUnitAbilityLevel(udg_Unit[P], bj_forLoopAIndexEnd, GetUnitAbilityLevel(udg_Unit[P+10], bj_forLoopAIndexEnd))
                              endif
                            endif
							set bj_forLoopAIndexEnd = 0
                            set bj_forLoopAIndex = bj_forLoopAIndex + 1
                          endloop
                          call SetUnitVertexColor(udg_Unit[P+10], 255, 255, 255, 0)
                          set n = 1
                          loop
                            exitwhen n > 10
                            call TriggerSleepAction(3.5)
                            set udg_temp_l = GetUnitLoc(udg_Unit[P+10])
                            set bj_forLoopAIndex = 1
                            loop
                              exitwhen bj_forLoopAIndex > 14-n
                              set udg_temp_l2 = PolarProjectionBJ(udg_temp_l, 301. - 30*n, 360./(14-n) * bj_forLoopAIndex )
                              call DestroyEffect(AddSpecialEffectLoc("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", udg_temp_l2))
                              call RemoveLocation(udg_temp_l2)
                              set bj_forLoopAIndex = bj_forLoopAIndex + 1
                            endloop
                            call RemoveLocation(udg_temp_l)
                            call SetUnitVertexColor(udg_Unit[P], 255, 255, 255, n*23)
                            set n = n + 1
                          endloop
                          call CinematicFilterGenericBJ(3.5, BLEND_MODE_BLEND, "ReplaceableTextures\\CameraMasks\\White_mask.blp", 100, 100, 100, 100.00, 0, 0, 0, 20.00 )
                          call SelectUnitForPlayerSingle(udg_Unit[P], GetTriggerPlayer())
                          call MSG(Player(P-1), 6, 4, "선진|r : |c00ffff00마지막으로, 축복을 내려드리겠습니다.")
                          call SetUnitVertexColorBJ(udg_Unit[P], 100, 100, 100, 0.)
                          call TriggerSleepAction(3.5)
                          //!set udg_SysA_Item = true
                          call RemoveUnit(udg_Unit[P+10])
                          //!set udg_SysA_Item = false
                          call CinematicFilterGenericBJ(1., BLEND_MODE_BLEND, "ReplaceableTextures\\CameraMasks\\White_mask.blp", 100, 100, 100, 20.00, 0, 0, 0, 100.00 )
                          call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P])))
                          call SetHeroAgi(udg_Unit[P], udg_SysE_DEX1[P], true)
                          call SetHeroStr(udg_Unit[P], udg_SysE_INT1[P], true)
                          call SetHeroInt(udg_Unit[P], udg_SysE_WIS1[P], true)
                          call MSGAll(P, true, 1, 2, 15, SysStr(2,P) + GetPlayerName(Player(P-1)) + "|c00ffff00님께서 '|c00d962b5" + GetUnitName(udg_Unit[P]) + "|c00ffff00'의 승급의식을 치르셨습니다.")
                          call TriggerSleepAction(2.8)
                          call SetUserControlForceOn( GetForceOfPlayer(Player(P-1)) )
                          //!call EnableTrigger(gg_trg_Auto_Setting_2)
                          call SetUnitPosition(udg_Unit[P], 2112., -13888.)
                          set udg_OnesPositionN[P] = 41
                          call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", 2112., -13888.))
                          call PauseUnit(udg_Unit[P], false)
                          call TriggerSleepAction(.2)
                          call MSG(Player(P-1), 6, 8, "선진|r : |c00ffff00이제, 승급 의식을 모두 치르셨습니다. 당신은 이제 승급 유저로서, 다른사람의 모범이 되어 주세요.")
                        else
                          call MSG(Player(P-1), -1, 0, "버그가 발생했습니다. 승급 / " + I2S(n))
                        endif
                      else
                        call MSG(Player(P-1), 1, 8, "의식 준비 중, 자리를 떠났습니다. 의식이 취소됩니다. 재료는 반환되지 않습니다.")
                      endif
                    else
                      set udg_temp_t = null
                      call MSG(Player(P-1), 6, 4, "선진|r : |c00ffff00엑스쿠라눔이 부족합니다.")
                    endif
                  else
                    call MSG(Player(P-1), 6, 4, "선진|r : |c00ffff00골드 혹은 포인트가 부족합니다.")
                  endif
                else
                  call MSG(Player(P-1), 6, 4, "선진|r : |c00ffff00승급 재료가 부족합니다. (" + GetObjectName(n) + ")")
                endif
              else
                call MSG(Player(P-1), 6, 4, "선진|r : |c00ffff00선행스킬이 부족합니다.")
              endif

          else
            call MSG(Player(P-1), 6, 4, "선진|r : |c00ffff00체력과 마력에 은총이 충분히 깃들지 않았습니다.")
          endif
        else
          call MSG(Player(P-1), 6, 4, "선진|r : |c00ffff00당신의 신이 응답하지 않습니다.")
        endif
      else
        call MSG(Player(P-1), 6, 8, "선진|r : |c00ffff00승급을 하기 위해선 레벨이 99 이상 되어야 합니다.")
      endif
      call PauseUnit(udg_Unit[P], false)
    elseif ( s == "2" ) then
      set udg_Quest_Boolean_B[P] = true
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 아직 마음의 준비가 되지 않았어요.")
      call TriggerSleepAction(1.4)
      call MSG(Player(P-1), 6, 4, "선진|r : |c00ffff00충분히 생각하시고 다시 찾아오세요. 승급의 길은 항상 열려 있답니다.")
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(10.)
      set udg_Quest_Boolean_B[P] = false
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 31 ) and ( udg_Quest_24_Num_Oren == 1 ) then
    if ( s == "1" ) then
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 그러죠. 어떻게 하면 되나요?")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "오렌 촌장|r : |c00ffff00매달 이맘때쯤이면 해적이 오네. 3종류의 해적들을 모두 소탕하고 돌아오게.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      set bj_forLoopAIndex = 1
      loop
        exitwhen bj_forLoopAIndex > 10
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) then
          call MSG(Player(bj_forLoopAIndex-1), 2, 10, "|c00fd8505파티 퀘스트 발동!!\n\n|cffffdc3c해적들에게 시달리고 있는 오렌 마을을 위해, 해적들을 소탕하자!\n자세한건 |cffc3dbff\"-퀘스트\"|cffffdc3c를 입력.")
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
      set udg_Quest_24_Num_Oren = 2
      call PauseUnit(udg_Unit[P], false)
      //!call TriggerExecute( gg_trg_Quest24_C_Create )
    elseif ( s == "2" ) then
      set udg_Quest_Boolean_B[P] = true
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00싫은데요?")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 8, "오렌 촌장|r : |c00ffff00처음부터 기대도 하지 않았어! 썩 꺼지게!")
      set udg_Quest_24_Num_Oren = -1
      call SetUnitAnimation( gg_unit_n040_0294, "attack" )
      call SetWidgetLife(udg_Unit[P], 1.)
      call CreateTextTagUnitBJ("HP -", udg_Unit[P], 30., 9., 100., 0., 0., 0)
      call Bufftt(bj_lastCreatedTextTag,1)
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(5.)
      call SetUnitAnimation(gg_unit_n040_0294, "stand")
      call TriggerSleepAction(180.)
      set udg_Quest_24_Num_Oren = 0
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 33 ) then
    if ( s == "1" ) then
      //!if ( GetItemCharges(GetItemOfTypeFromUnitBJ(udg_Unit[P], 'I084')) >= 10 ) or ( GetItemCharges(GetItemOfTypeFromUnitBJ(udg_Unit_Serve1c[P], 'I084')) >= 10 ) then
	  if ( GetItemCharges(GetItemOfTypeFromUnitBJ(udg_Unit[P], 'I084')) >= 10 ) then  
        call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
        call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 여기, 엑스쿠라눔 10병이 있습니다.")
        call TriggerSleepAction(udg_Quest_WaitTime[P])
        if ( GetItemCharges(GetItemOfTypeFromUnitBJ(udg_Unit[P], 'I084')) > 10 ) then
          call SetItemCharges( GetItemOfTypeFromUnitBJ(udg_Unit[P], 'I084'), ( GetItemCharges(GetItemOfTypeFromUnitBJ(udg_Unit[P], 'I084')) - 10 ) )
        elseif ( GetItemCharges(GetItemOfTypeFromUnitBJ(udg_Unit[P], 'I084')) == 10 ) then
          call RemoveItem( GetItemOfTypeFromUnitBJ(udg_Unit[P], 'I084') )
        endif
        call MSG(Player(P-1), 6, 4, "자객|r : |c00ffff00흠~ 잠시만 기다려 봐.")
        call ED( AddSpecialEffectTarget("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", udg_Unit[P], "origin"), 3. )
        call TriggerSleepAction(2.)
        call SetUnitPosition(udg_Unit[P], GetRandomReal(16736., 17024.), GetRandomReal(15616., 15968.))
        call PauseUnit(udg_Unit[P], false)
        call TriggerSleepAction(udg_Quest_WaitTime[P])
        call MSG(Player(P-1), 6, 8, "플레이어|r : |c00ffff00 우욱! 어지럽다...|r\n\n멀미로 인해 체력과 마나가 감소합니다.")
        call SetWidgetLife(udg_Unit[P], 500.)
        call SetUnitState(udg_Unit[P], UNIT_STATE_MANA, 30.)
      else
        call TriggerSleepAction(udg_Quest_WaitTime[P])
        call MSG(Player(P-1), 6, 8, "자객|r : |c00ffff00뭐야, 엑스쿠라눔도 없어? 없으면 볼 일 없어.")
        call TriggerSleepAction(udg_Quest_WaitTime[P])
        call PauseUnit(udg_Unit[P], false)
      endif
    elseif ( s == "2" ) then
      set udg_Quest_Boolean_B[P] = true
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 밀항선? 타고싶지 않네요.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 4, "자객|r : |c00ffff00뭐야, 그렇다면 방해하지말고 썩 저리 가!")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(10.)
      set udg_Quest_Boolean_B[P] = false
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 34 ) and ( udg_Quest_27_Num_Master == 2 ) then
    if ( s == "1" ) then
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      set bj_forLoopAIndex = 1
      loop
        exitwhen bj_forLoopAIndex > 10
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( GetUnitLevel(udg_Unit[bj_forLoopAIndex]) >= 99 ) and ( udg_OnesPositionN[P] == udg_OnesPositionN[bj_forLoopAIndex] ) then
          call MSG(Player(bj_forLoopAIndex-1), 6, 4, "플레이어|r : |c00ffff00 부족하지만 상대를 부탁드립니다.")
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      set bj_forLoopAIndex = 1
      loop
        exitwhen bj_forLoopAIndex > 10
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( GetUnitLevel(udg_Unit[bj_forLoopAIndex]) >= 99 ) and ( udg_OnesPositionN[P] == udg_OnesPositionN[bj_forLoopAIndex] ) then
          call MSG(Player(bj_forLoopAIndex-1), 6, 4, "방랑검객|r : |c00ffff00후후후.. 처음 봤을 때 부터 싸우고 싶었네, 와라!")
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      set bj_forLoopAIndex = 1
      loop
        exitwhen bj_forLoopAIndex > 10
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) then
          call MSG(Player(bj_forLoopAIndex-1), 2, 8, "파티 퀘스트 발동!!\n\n|cffffdc3c방랑 검객을 물리쳐라!\n추가 정보 없음.")
          call PauseUnit(udg_Unit[bj_forLoopAIndex], false)
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
      set udg_Quest_27_Num_Master = 4
      //!call DestroyTrigger( gg_trg_Quest27 )
      //!call EnableTrigger( gg_trg_Quest27_B_Attacked )
      //!call EnableTrigger( gg_trg_Quest27_C_Killed )
      call UnitRemoveAbility(gg_unit_Obla_0263, 'A003')
      call SetUnitOwner( gg_unit_Obla_0263, Player(PLAYER_NEUTRAL_AGGRESSIVE), true )
    elseif ( s == "2" ) then
      set udg_Quest_Boolean_B[P] = true
      set bj_forLoopAIndex = 1
      loop
        exitwhen bj_forLoopAIndex > 10
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( GetUnitLevel(udg_Unit[bj_forLoopAIndex]) >= 99 ) and ( udg_OnesPositionN[P] == udg_OnesPositionN[bj_forLoopAIndex] ) then
          call MSG(Player(bj_forLoopAIndex-1), 6, 4, "플레이어|r : |c00ffff00 너무 무서워잉")
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      set bj_forLoopAIndex = 1
      loop
        exitwhen bj_forLoopAIndex > 10
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( GetUnitLevel(udg_Unit[bj_forLoopAIndex]) >= 99 ) and ( udg_OnesPositionN[P] == udg_OnesPositionN[bj_forLoopAIndex] ) then
          call MSG(Player(bj_forLoopAIndex-1), 6, 8, "방랑검객|r : |c00ffff00나도.. 늙었군... 이런 겁쟁이를 내 상대로 생각했었다니..")
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
      set udg_Quest_27_Num_Master = -1
      call SetUnitAnimation( gg_unit_Obla_0263, "attack" )
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      set bj_forLoopAIndex = 1
      loop
        exitwhen bj_forLoopAIndex > 10
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( GetUnitLevel(udg_Unit[bj_forLoopAIndex]) >= 99 ) and ( udg_OnesPositionN[P] == udg_OnesPositionN[bj_forLoopAIndex] ) then
          call SetWidgetLife(udg_Unit[bj_forLoopAIndex], 1.)
          call CreateTextTagUnitBJ("HP -", udg_Unit[bj_forLoopAIndex], 30., 9., 100., 0., 0., 0 )
          call Bufftt(bj_lastCreatedTextTag, 1)
          call PauseUnit(udg_Unit[bj_forLoopAIndex], false)
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
      call TriggerSleepAction(5.)
      call SetUnitAnimation(gg_unit_Obla_0263, "stand")
      call TriggerSleepAction(180.)
      set udg_Quest_27_Num_Master = 0
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 35 ) and ( Quest_Level(P, 10) == 1 ) then
    if ( s == "1" ) then
      set udg_Quest_Boolean_B[P] = true
      call Choice(P, -35, 0.)
      call QMsg(P, 0, "플레이어", "100Gold라... 드리겠습니다!", 1.)
      call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) -100)
      call QMsg(P, 0, "NPC 푸잎", "눈물나게 고마워", .7)
      call QMsg(P, 0, "NPC 푸잎", "사실 내가 돈이 필요한 건 아니었는데, 너어의 마음을 시험해 본 거야.", 1.)
      call QMsg(P, 0, "NPC 푸잎", "기분 나빠하지 마, 내가 너어의 마음에 약간의 보답을 해 줄게.", 1.)
      call QMsg(P, 0, "NPC 푸잎", "휘리릭~!", 1.)
      call QMsg(P, 0, "NPC 푸잎", "얍!", .5)
      call SetUS("Hp", udg_Unit[P], 500, false)
      call SetUS("Mp", udg_Unit[P], 500, false)
      call SetBuff(udg_Unit[P], "ENA", 900., 20)
      call SetBuff(udg_Unit[P], "BELLA", 900, 20)
      call SetBuff(udg_Unit[P], "COLLA", 900, 10)
      call SetBuff(udg_Unit[P], "HORR", 900, 50)
      call SetUnitAnimation(I2QU(10), "death")
      call MSG(Player(P-1), 1, 12, "푸잎의 축복으로...\n(현재 방에서(만) |cffff3315체력|cffffdc3c이 영구적으로 |cff55ff55500|cffffdc3c 증가합니다.)\n(현재 방에서(만) |cff0078ff마력|cffffdc3c이 영구적으로 |cff55ff55500|cffffdc3c 증가합니다.)\n(15분동안 |cff46ffff받는 데미지|cffffdc3c가 |cff9932cc50% |cffffdc3c감소합니다.)\n(15분동안 |cff55ff55Dam|cffffdc3c이 |cff9932cc20 |cffffdc3c상승합니다.)\n(15분동안 |cff55ff55Hit|cffffdc3c이 |cff9932cc20 |cffffdc3c상승합니다.)\n(15분동안 |cff46ffff방어력|cffffdc3c이 |cff9932cc10 |cffffdc3c상승합니다.)\n")
      if ( udg_Quest_WaitTime[P] > .1 ) then
        call TriggerSleepAction(udg_Quest_WaitTime[P])
      endif
      call QMsg(P, 0, "NPC 푸잎", "버프가 마음에 들면 또 찾아와, 특별히 1,000Gold에 해 주도록 할게, 하하!", 1.)
      call SetUnitAnimation(I2QU(10), "stand")
      call QMsg(P, 0, "플레이어", "|c008bc7fc(돈이 필요한건 아니라면서?!)", 1.)
      call Quest_End(P, 10, false)
    elseif ( s == "2" ) then
      set udg_Quest_Boolean_B[P] = true
      call SaveInteger(udg_hash, StringHash("QLevel10"), P, -2)
      call QMsg(P, 0, "플레이어", "일하지 않는자 먹지도 말라! 거지 같은 놈!", 1.)
      call QMsg(P, 6., "NPC 푸잎", "NPC 푸잎|r : |c00ffff00뭐, 뭣!? 너.. 너! 얼굴봤어. 고작 100Gold도 안빌려주는 니가 더 쪼잔해!\n|r(20초간 대화하실 수 없습니다)", 1.)
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(10.)
      set udg_Quest_Boolean_B[P] = false
      call TriggerSleepAction(10.)
      call SaveInteger(udg_hash, StringHash("QLevel10"), P, 0)
      call MSG(Player(P-1), 2, 4, "(NPC 푸잎의 화가 풀린것 같다)")
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 36 ) then
    if ( s == "1" ) then
      set udg_Quest_Boolean_B[P] = true
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 아니오. 생각을 좀 더 해 보겠습니다.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 8, "신|r : |c00ffff00언제든 다시 찾아오세요.")
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(10.)
      set udg_Quest_Boolean_B[P] = false
    else
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 예. 의식을 치뤄 주세요.")
      call TriggerSleepAction(2.)
      call MSG(Player(P-1), 6, 4, JOBNAME(S2I(s))+"|r : |c00ffff00어려운 결정을 하셨군요.")
      call TriggerSleepAction(2.)
      call MSG(Player(P-1), 6, 4, JOBNAME(S2I(s))+"|r : |c00ffff00자격을 검증해볼게요.")
      call TriggerSleepAction(2.)
      set n = SysInt(3,GetUnitTypeId(udg_Unit[P]))
      
      if ( n == S2I(s) ) then
        set udg_temp_b = MinusItem(P, ChangeJobBook(1), 1)
      else
        set udg_temp_b = MinusItem(P, ChangeJobBook(S2I(s)), 1)
      endif
      if ( SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])), 0, 1) != "1" ) then
        call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r0 - 케릭터가 적합하지 않습니다.")
      elseif ( GetHPMP(P,true) < JOBHPMP(n,true,n==S2I(s)) ) or ( udg_temp_b ) then
        call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r1 - 체력치가 순수값으로 |cffff3315"+FSE_Rest(JOBHPMP(n,true,n==S2I(s))) + BaseStr(11) + "(|cffff3315" + I2S(GetHPMP(P,true)-JOBHPMP(n,true,n==S2I(s))) + BaseStr(11) + ") 되셔야 합니다.")
      elseif ( GetHPMP(P,false) < JOBHPMP(SysInt(3,GetUnitTypeId(udg_Unit[P])),false,n==S2I(s)) ) or ( udg_temp_b ) then
        call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r2 - 마력치가 순수값으로 |cff218def"+FSE_Rest(JOBHPMP(n,false,n==S2I(s))) + BaseStr(11) + "(|cffff3315" + I2S(GetHPMP(P,false)-JOBHPMP(n,false,n==S2I(s))) + BaseStr(11) + ") 되셔야 합니다.")
      elseif ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) < 10 ) or ( udg_temp_b ) then
        call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r3 - 포인트가 부족합니다.")
      elseif ( CountItem(P, 'I084') < 20 ) or ( udg_temp_b ) then
        call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r4 - 엑스쿠라눔이 부족합니다.")
      else
        if ( n != S2I(s) ) then
          if ( n == 2 ) then
            if ( GetUnitAbilityLevel(udg_Unit[P], 'A03D') == 0 ) then
              call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r5 - 직업 스킬이 미숙합니다 (크래셔)")
              return
            endif
          elseif ( n == 3 ) then
            if ( GetUnitAbilityLevel(udg_Unit[P], 'A04T') == 0 ) or ( GetUnitAbilityLevel(udg_Unit[P], 'A04J') == 0 ) then
              call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r5 - 직업 스킬이 미숙합니다 (센서스, 암살격)")
              return
            endif
          elseif ( n == 4 ) then
            if ( GetUnitAbilityLevel(udg_Unit[P], 'A07R') == 0 ) or ( GetUnitAbilityLevel(udg_Unit[P], 'A01P') == 0 ) then
              call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r5 - 직업 스킬이 미숙합니다 (데스, 라그나로크)")
              return
            endif
          elseif ( n == 5 ) then
            if ( GetUnitAbilityLevel(udg_Unit[P], 'A08W') == 0 ) then
              call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r5 - 직업 스킬이 미숙합니다 (코마디아)")
              return
            endif
          endif
        endif
        call MinusItem(P, 'I084', 20)
        call TriggerSleepAction(2.)
        if ( GetLocalPlayer() == Player(P-1) ) then
          call ClearTextMessages()
        endif
        if ( GetUnitTypeId(udg_Unit[P]) == 'H006' ) then
          set bj_lastCreatedUnit = CreateUnit(Player(P-1), SysInt(1,12), GetUnitX(udg_Unit[P]), GetUnitY(udg_Unit[P]), GetUnitFacing(udg_Unit[P]) )
        elseif ( n == S2I(s) ) then
          set bj_lastCreatedUnit = CreateUnit(Player(P-1), SysInt(1,11+SysInt(3, GetUnitTypeId(udg_Unit[P]))), GetUnitX(udg_Unit[P]), GetUnitY(udg_Unit[P]), GetUnitFacing(udg_Unit[P]) )
        elseif ( s == "2" ) then
          set bj_lastCreatedUnit = CreateUnit(Player(P-1), SysInt(1,14+n), GetUnitX(udg_Unit[P]), GetUnitY(udg_Unit[P]), GetUnitFacing(udg_Unit[P]) )
        elseif ( s == "3" ) then
          if ( n == 2 ) then
            set bj_lastCreatedUnit = CreateUnit(Player(P-1), SysInt(1,20), GetUnitX(udg_Unit[P]), GetUnitY(udg_Unit[P]), GetUnitFacing(udg_Unit[P]) )
          else
            set bj_lastCreatedUnit = CreateUnit(Player(P-1), SysInt(1,17+n), GetUnitX(udg_Unit[P]), GetUnitY(udg_Unit[P]), GetUnitFacing(udg_Unit[P]) )
          endif
        elseif ( s == "4" ) then
          if ( n == 5 ) then
            set bj_lastCreatedUnit = CreateUnit(Player(P-1), SysInt(1,25), GetUnitX(udg_Unit[P]), GetUnitY(udg_Unit[P]), GetUnitFacing(udg_Unit[P]) )
          else
            set bj_lastCreatedUnit = CreateUnit(Player(P-1), SysInt(1,21+n), GetUnitX(udg_Unit[P]), GetUnitY(udg_Unit[P]), GetUnitFacing(udg_Unit[P]) )
          endif
        elseif ( s == "5" ) then
          set bj_lastCreatedUnit = CreateUnit(Player(P-1), SysInt(1,24+n), GetUnitX(udg_Unit[P]), GetUnitY(udg_Unit[P]), GetUnitFacing(udg_Unit[P]) )
        endif
        call SetUnitX(udg_Unit[P],GetUnitX(bj_lastCreatedUnit))
        call SetUnitY(udg_Unit[P],GetUnitY(bj_lastCreatedUnit))
        call SetUnitX(bj_lastCreatedUnit,GetUnitX(udg_Unit[P]))
        call SetUnitY(bj_lastCreatedUnit,GetUnitY(udg_Unit[P]))
        if ( n == S2I(s) ) then
          set bj_forLoopAIndex = 1
          loop
            exitwhen bj_forLoopAIndex > 7
			set bj_forLoopAIndexEnd = LoadInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(bj_forLoopAIndex)))
            if ( GetUnitAbilityLevel(udg_Unit[P], bj_forLoopAIndexEnd) > 0 ) then
              call UnitAddAbility(bj_lastCreatedUnit, bj_forLoopAIndexEnd)
            endif
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
          endloop
        endif
        call RemoveUnit(udg_Unit[P])
        set udg_Unit[P] = bj_lastCreatedUnit
        call PushCancle(udg_Unit[P])
        call SelectUnitForPlayerSingle(bj_lastCreatedUnit, GetOwningPlayer(bj_lastCreatedUnit))
        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", GetUnitX(udg_Unit[P]), GetUnitY(udg_Unit[P])))
      
        call Title_Reset(P)
        call DropEquipItem(P)
        
        set udg_SysL_Level[P] = 0
        set udg_SysB_Level[P] = 1
        set udg_Save_Count[P] = 1
        set udg_SysE_STR1[P] = 3
        set udg_SysE_DEX1[P] = 3
        set udg_SysE_INT1[P] = 3
        set udg_SysE_WIS1[P] = 3
        set udg_SysE_CON1[P] = 3
        set udg_SysE_STR3[P] = udg_SysE_STR1[P] + udg_SysE_STR2[P]
        set udg_SysE_DEX3[P] = udg_SysE_DEX1[P] + udg_SysE_DEX2[P]
        set udg_SysE_INT3[P] = udg_SysE_INT1[P] + udg_SysE_INT2[P]
        set udg_SysE_WIS3[P] = udg_SysE_WIS1[P] + udg_SysE_WIS2[P]
        set udg_SysE_CON3[P] = udg_SysE_CON1[P] + udg_SysE_CON2[P]

        call SetHeroStr(udg_Unit[P], 3, true)
        call SetHeroAgi(udg_Unit[P], 3, true)
        call SetHeroInt(udg_Unit[P], 3, true)
        set udg_Save_HP[P] = 0
        set udg_Save_MP[P] = 0
        call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, 0)
        call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, 0)
        set udg_SysC_Dam[P] = SysInt(0,16)*udg_SysB_Level[P]+SysInt(0,11)+udg_SysE_STR3[P]*SysInt(0,12)+udg_SysE_DEX3[P]*SysInt(0,14)+udg_SysE_CON3[P]*SysInt(0,16)
        call TriggerRegisterUnitEvent(gg_trg_Level_UP,udg_Unit[P], EVENT_UNIT_HERO_LEVEL)
        call TriggerRegisterUnitEvent(gg_trg_FMi_Click, udg_Unit[P], EVENT_UNIT_SPELL_EFFECT)
        call TriggerRegisterUnitEvent(gg_trg_ReviveHero, udg_Unit[P], EVENT_UNIT_DEATH)
        call LocalMtbM(Player(P-1), bj_lastCreatedMultiboard, false)
        call TriggerSleepAction(1.)
        set udg_SysC_DmgAttack[P] = SysInt(0,11)+(udg_SysB_Level[P]*SysInt(0,16))+udg_SysE_STR3[P]*SysInt(0,12)+udg_SysE_DEX3[P]*SysInt(0,13)+udg_SysE_CON3[P]*SysInt(0,14)
        set udg_SysC_DmgAttackAdd[P] = SysInt(0,22)+udg_SysE_STR3[P]*SysInt(0,19)+udg_SysE_DEX3[P]*SysInt(0,20)+udg_SysE_CON3[P]*SysInt(0,21)
        call SetDmg(udg_Unit[P])
        set udg_SysC_Armor[P] = 0
        set udg_SysC_Armor_B[P] = 0
          
        set udg_SysC_CriP[P] = BaseValue(15)+BaseValue(13)*udg_SysE_DEX3[P]
        set udg_SysC_CriX[P] = BaseValue(16)+BaseValue(14)*udg_SysE_DEX3[P]
        set udg_SysC_Hits[P] = BaseValue(18)+BaseValue(1)*udg_SysE_DEX3[P]
        
        set udg_SysC_Dam[P] = 0
        set udg_SysC_Regen[P] = 0
        set udg_SysC_AtkSpdAdd[P] = 0
        set udg_SysC_PotAdd[P] = 0
        
        set udg_SysC_MissMagic[P] = 0.
          
        call SetUnitState(udg_Unit[P], ConvertUnitState(0x20), 0)
        call UnitAddAbility(udg_Unit[P], 'A013')
        if ( GetUnitTypeId(udg_Unit[P]) == SysInt(1,12) ) then
          call MSGAll(0, true, 1, 2, 15., SysStr(2,P) + GetPlayerName(Player(P-1)) + "|cffffff00님께서 '|c00d962b5환골탈태|c00ffff00' 의식을 치르셨습니다 !!")
        elseif ( n == S2I(s) ) then
          call MSGAll(0, true, 1, 2, 15., SysStr(2,P) + GetPlayerName(Player(P-1)) + "|cffffff00님께서 '|c00d962b5순수전직|c00ffff00' 의식을 치르셨습니다 !!")
        else
          call MSGAll(0, true, 1, 2, 15., SysStr(2,P) + GetPlayerName(Player(P-1)) + "|cffffff00님께서 '|c00d962b5전직("+JOBNAME2(n)+"→"+JOBNAME2(S2I(s))+")|c00ffff00' 의식을 치르셨습니다 !!")
        endif
        call TriggerSleepAction(.5)
        call MSG(Player(P-1), 1, 7, "수동스텟이 설정되었습니다. 자동으로 찍으려면 |cffc3dbff\"-자동스텟\"|cffffdc3c을 입력하세요.")
        call SaveBoolean(udg_hash, StringHash("NoAutoStat"), P, true)
      endif
      call PauseUnit(udg_Unit[P], false)
    endif
  elseif ( n == 37 ) then
    if ( s == "1" ) then
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 예. 바꿔 주세요.")
      call TriggerSleepAction(2.)
      set n = LoadInteger(udg_hash,GetUnitTypeId(udg_Unit[P]),StringHash("FSE_U2I"))
      if ( n >= 2 and n <= 6 ) then
        call MSG(Player(P-1), 6, 8, "촌장|r : |c00ffff00잠시만 기다리게. 내 곧 바꿔 줌세.")
        call TriggerSleepAction(5.)
        if ( n == 2 ) then
          set n = 'I09Q'
        elseif ( n == 3 ) then
          set n = 'I09R'
        elseif ( n == 4 ) then
          set n = 'I09S'
        elseif ( n == 5 ) then
          set n = 'I09T'
        elseif ( n == 6 ) then
          set n = 'I09U'
        else
          set n = 0
        endif
        if ( n > 7 ) then
          call MSG(Player(P-1), 6, 8, "촌장|r : |c00ffff00여기 있네.")
          call RemoveItem(GetItemOfTypeFromUnitBJ(udg_Unit[P], n))
          call PauseUnit(udg_Unit[P], false)
          set n = LoadInteger(udg_hash,GetUnitTypeId(udg_Unit[P]),StringHash("FSE_U2I"))
          if ( n == 2 ) then
            set n = 'mcri'
          elseif ( n == 3 ) then
            set n = 'wneg'
          elseif ( n == 4 ) then
            set n = 'rnec'
          elseif ( n == 5 ) then
              set n = 'wneu'
          elseif ( n == 6 ) then
            set n = 'pgin'
          else
            call MSG(Player(P-1), 6, 8, "촌장|r : |c00ffff00자넨... 재료가 없구만...")
            set n = 0
          endif
          if ( n > 7 ) then
            call UnitAddItem(udg_Unit[P], CreateItem(n, GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P])))
          endif
        else
          call MSG(Player(P-1), 6, 8, "촌장|r : |c00ffff00자넨... 재료가 없구만.")
        endif
      else
        call MSG(Player(P-1), 6, 8, "촌장|r : |c00ffff00자넨... 재료가 없구만..")
      endif
    elseif ( s == "2" ) then
      set udg_Quest_Boolean_B[P] = true
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 아뇨. 승급할때가 되면 다시 찾아오겠습니다.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 8, "촌장|r : |c00ffff00언제든 다시 찾아오게나.")
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(10.)
      set udg_Quest_Boolean_B[P] = false
    endif
  elseif ( n == 38 ) then
    if ( S2I(s) >= 1 ) and ( S2I(s) <= 12 ) then
      set udg_Quest_00_NumberAt[P] = 0
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      set n = S2I(s)
      if ( isPlaying(Player(n-1)) ) then
	    if ( udg_PartyNumber_ThisP[n] == udg_PartyNumber_ThisP[P] ) then
		  if ( n != P ) then
		    call MSG(GetTriggerPlayer(), 13, 4., SysStr(2,n)+udg_SysB_Name[n]+"|cffffdc3c님에게 파티장을 넘겼습니다.")
			call MSG(Player(n-1), 13, 3., SysStr(2,P)+udg_SysB_Name[P]+"|cffffdc3c님이 파티장을 넘겼습니다.\n  이제 당신이 '|c008bc7fc" + udg_PartyTitle[P] + "|cffffdc3c' 파티의 파티장입니다.")
			set bj_forLoopAIndex = 1
            loop
              exitwhen bj_forLoopAIndex > 12
              if ( bj_forLoopAIndex != P ) and ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) then
                set udg_PartyNumber_ThisP[bj_forLoopAIndex] = n
              endif
              set bj_forLoopAIndex = bj_forLoopAIndex + 1
            endloop
            set udg_PartyNumber_ThisP[P] = n
            set udg_PartyNumber_pP[n] = udg_PartyNumber_pP[P]
            set udg_PartyNumber_pP[P] = 0
		  else
		    call MSG(GetTriggerPlayer(), 13, 3.,"자기 자신에게 파티를 넘길 수 없습니다.")
		  endif  
		else
		  call MSG(GetTriggerPlayer(), 13, 3.,SysStr(2,n)+udg_SysB_Name[n]+"|cffffdc3c님은 당신의 파티원이 아닙니다.")
		endif
	  else
	    call MSG(GetTriggerPlayer(), 13, 3.,SysStr(2,n)+udg_SysB_Name[n]+"|cffffdc3c님은 플레이 중이 아닙니다.")
	  endif
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  elseif ( n == 39 ) then
    if ( s == "1" ) then
      if ( udg_SysB_Level[P] > 40 ) then
        if ( SubString(SysStr(1, GetUnitTypeId(udg_Unit[P])), 0, 1) == "0" ) then
          if ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) >= 50000 ) then
            set udg_temp_t = GetItemOfTypeFromUnitBJ(udg_Unit[P], 'I084')
            //!if ( GetItemCharges(udg_temp_t) < 30 ) then
            //!  set udg_temp_t = GetItemOfTypeFromUnitBJ(udg_Unit_Serve1c[P], 'I084')
            //!endif
            if ( GetItemCharges(udg_temp_t) >= 30 ) then
              call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 네. 초기화를 하겠습니다.")
              call TriggerSleepAction(udg_Quest_WaitTime[P])
              call MSG(Player(P-1), 2, 8, "|c00ff8000선진|r : |c00ffff00잠시만 기다려 주세요. 의식을 준비하겠습니다.")
              set udg_temp_t = GetItemOfTypeFromUnitBJ(udg_Unit[P], 'I084')
              //!if ( GetItemCharges(udg_temp_t) < 30 ) then
              //!  set udg_temp_t = GetItemOfTypeFromUnitBJ(udg_Unit_Serve1c[P], 'I084')
              //!endif
              if ( GetItemCharges(udg_temp_t) > 30 ) then
                call SetItemCharges(udg_temp_t, GetItemCharges(udg_temp_t)-30)
              else
                call RemoveItem(udg_temp_t)
              endif
              call TriggerSleepAction(udg_Quest_WaitTime[P]*2.)
              call ResetStat(P, "스탯 초기화(신전)")
            else
              set udg_temp_t = null
              call MSG(Player(P-1), 6, 4, "선진|r : |c00ffff00엑스쿠라눔이 부족합니다.")
            endif
          else
            call MSG(Player(P-1), 1, 5, "사용 실패!|r[3] - 50,000 골드 이상 가지고 있어야 합니다.")
            call SetItemCharges(GetManipulatedItem(), GetItemCharges(GetManipulatedItem())+1)
          endif
        else
          call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r1 - 노비스는 이 명령어를 사용할 수 없습니다.")
        endif
      else
        call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r0 - 레벨이 부족합니다.")
      endif
    elseif ( s == "2" ) then
      set udg_Quest_Boolean_B[P] = true
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 아니오. 생각을 좀 더 해 보겠습니다.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 8, "선진|r : |c00ffff00언제든 다시 찾아오세요.")
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(10.)
      set udg_Quest_Boolean_B[P] = false
    endif
  elseif ( n == 40 ) then
    if ( s == "1" ) then
      set udg_Quest_Boolean_B[P] = true
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 아니오. 생각을 좀 더 해 보겠습니다.")
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call MSG(Player(P-1), 6, 8, "신|r : |c00ffff00언제든 다시 찾아오세요.")
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(10.)
      set udg_Quest_Boolean_B[P] = false
    else
      call SaveBoolean(udg_hash, getIndex(P,n,100), 31, false)
      call MSG(Player(P-1), 6, 4, "플레이어|r : |c00ffff00 예. 의식을 치뤄 주세요.")
      call TriggerSleepAction(2.)
      call MSG(Player(P-1), 6, 4, JOBNAME(S2I(s))+"|r : |c00ffff00어려운 결정을 하셨군요.")
      call TriggerSleepAction(2.)
      call MSG(Player(P-1), 6, 4, JOBNAME(S2I(s))+"|r : |c00ffff00자격을 검증해볼게요.")
      call TriggerSleepAction(2.)
      set n = SysInt(3,GetUnitTypeId(udg_Unit[P]))
    
      if ( InheritJob(GetUnitTypeId(udg_Unit[P])) == 0 ) then
        call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r5 - 이미 승급했거나, 가능한 직업군이 아닙니다.")
      elseif ( GetHPMP(P,true) < JOBHPMP2(S2I(s),true) ) then
        call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r1 - 체력치가 순수값으로 |cffff3315"+FSE_Rest(JOBHPMP2(S2I(s),true)) + BaseStr(11) + "(|cffff3315" + I2S(GetHPMP(P,true)-JOBHPMP2(S2I(s),true)) + BaseStr(11) + ") 되셔야 합니다.")
      elseif ( GetHPMP(P,false) < JOBHPMP2(S2I(s),false) ) then
        call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r2 - 마력치가 순수값으로 |cff218def"+FSE_Rest(JOBHPMP2(S2I(s),false)) + BaseStr(11) + "(|cffff3315" + I2S(GetHPMP(P,false)-JOBHPMP2(S2I(s),false)) + BaseStr(11) + ") 되셔야 합니다.")
      elseif ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER) < 100 ) then
        call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r3 - 포인트가 부족합니다.")
      elseif ( CountItem(P, 'I084') < 200 ) then
        call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r4 - 엑스쿠라눔이 부족합니다.")
      elseif ( CountItem(P,'I09T') < 100 ) then
        call MSG(Player(P-1), 1, 5, "자격이 부족합니다. |r5 - 승급재료가 부족합니다.")
      else
        call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_LUMBER)-100)
        call MinusItem(P, 'I084', 200)
        call MinusItem(P, 'I09T', 100)
      
        call TriggerSleepAction(2.)
        call ClearTextMessagesBJ(GetForceOfPlayer(Player(P-1)))
        
        set bj_lastCreatedUnit = CreateUnit(Player(P-1), InheritJob(GetUnitTypeId(udg_Unit[P])), GetUnitX(udg_Unit[P]), GetUnitY(udg_Unit[P]), GetUnitFacing(udg_Unit[P]) )
        
        call SetUnitX(udg_Unit[P],GetUnitX(bj_lastCreatedUnit))
        call SetUnitY(udg_Unit[P],GetUnitY(bj_lastCreatedUnit))
        call SetUnitX(bj_lastCreatedUnit,GetUnitX(udg_Unit[P]))
        call SetUnitY(bj_lastCreatedUnit,GetUnitY(udg_Unit[P]))
        
        
        set bj_forLoopAIndex = 1
        loop
          exitwhen bj_forLoopAIndex > 7
		  set bj_forLoopAIndexEnd = LoadInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(bj_forLoopAIndex)))
          if ( GetUnitAbilityLevel(udg_Unit[P], bj_forLoopAIndexEnd) > 0 ) then
            call UnitAddAbility(bj_lastCreatedUnit, bj_forLoopAIndexEnd)
            call SetUnitAbilityLevel(bj_lastCreatedUnit, bj_forLoopAIndexEnd, GetUnitAbilityLevel(udg_Unit[P], bj_forLoopAIndexEnd))
          endif
          set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
        
        call TriggerSleepAction(.1)
        
        call DropEquipItem(P)
        
        call RemoveUnit(udg_Unit[P])
        set udg_Unit[P] = bj_lastCreatedUnit
        
        //레벨 체력 마력
        call SetHeroLevel(udg_Unit[P], 99, false)
        call SetUS("Hp", udg_Unit[P], GetHPMP(P,true), true)
        call SetUS("mp", udg_Unit[P], GetHPMP(P,false), true)
        
        call PushCancle(udg_Unit[P])
        call SelectUnitForPlayerSingle(udg_Unit[P], GetOwningPlayer(udg_Unit[P]))
        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", GetUnitX(udg_Unit[P]), GetUnitY(udg_Unit[P])))
      
        call Title_Reset(P)
        
        set udg_SysL_Level[P] = 0
        set udg_SysB_Level[P] = 99
        set udg_Save_Count[P] = 1

        call SetHeroStr(udg_Unit[P], udg_SysE_CON3[P], true)
        call SetHeroAgi(udg_Unit[P], udg_SysE_DEX3[P], true)
        call SetHeroInt(udg_Unit[P], udg_SysE_WIS3[P], true)
        
        call TriggerRegisterUnitEvent(gg_trg_Level_UP,udg_Unit[P], EVENT_UNIT_HERO_LEVEL)
        call TriggerRegisterUnitEvent(gg_trg_FMi_Click, udg_Unit[P], EVENT_UNIT_SPELL_EFFECT)
        call TriggerRegisterUnitEvent(gg_trg_ReviveHero, udg_Unit[P], EVENT_UNIT_DEATH)
        
        call LocalMtbM(Player(P-1), bj_lastCreatedMultiboard, false)
        call TriggerSleepAction(1.)
        
        call SetDmg(udg_Unit[P])
          
        call UnitAddAbility(udg_Unit[P], 'A013')
        call MSGAll(0, true, 1, 2, 15., SysStr(2,P) + GetPlayerName(Player(P-1)) + "|cffffff00님께서 '|c00d962b5승급|c00ffff00' 의식을 치르셨습니다 !!")
        call TriggerSleepAction(.5)
      endif
      call PauseUnit(udg_Unit[P], false)
    endif
  
  elseif ( n == 41 ) and ( Quest_Level(P, 16) == 1 ) then
    if ( s == "1" ) then
      set udg_Quest_Boolean_B[P] = true
      call Choice(P, -41, 0.)
      call QMsg(P, 0, "플레이어", "무엇을 도와 드릴까요?", 1.)
      call QMsg(P, 0, "떠도는 유령", "그래! 날 위해 복수를", 0.5)
      call QMsg(P, 0, "떠도는 유령", "난 참으로 한창 패기와 자신감 넘치는 모험가였던 것 같소.", 1.)
      call QMsg(P, 0, "떠도는 유령", "한번 잘못 발을 들여놓았다가 그만 죽어버렸네, 시체조차 찾지 못했네.", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(그렇군..)", 1.)
      call QMsg(P, 0, "떠도는 유령", "더구나 내 몸은 저놈들이 팔다리 하나씩 떼서 써가지고 있다네.", 0.7)
      call QMsg(P, 0, "떠도는 유령", "어떻게 참을 수 있겠나? 안그럴리가 뭐가 있겠소?", 1.)
      call QMsg(P, 0, "떠도는 유령", "...그래서 여기서 떠나지 못하고 있단....", 1.)
      call QMsg(P, 0, "플레이어", "...", 1.)
      call QMsg(P, 0, "떠도는 유령", "네가, 나를 도와주게..", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(거절할 분위기가 아닌걸..)", 1.)
      call QMsg(P, 0, "플레이어", "알겠..습니다.", 1.)
      call QMsg(P, 0, "떠도는 유령", "고맙단 말씀이오! 마음껏 도륙을 내버리고 오게 하겠소.", 1.)
      call QMsg(P, 0, "떠도는 유령", "위험하니 조심히 다녀오시게나. 그럼 건강히 잘 부탁하오!", 1.)
      call QMsg(P, 0, "1", "억울하게 죽은 망령을 위해, |c009f9f9f죽음의 마을|cffffdc3c을 소탕하자!\n자세한건 |cffc3dbff\"-퀘스트\"|cffffdc3c를 입력.", 0)
      call SaveInteger(udg_hash, StringHash("QLevel16"), P, 3)
      call EnableTrigger(gg_trg_Quest_16_B)
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(.7)
      call Ping(Player(P-1), 20992., -6592., 7.)
    elseif ( s == "2" ) then
      set udg_Quest_Boolean_B[P] = true
      call QMsg(P, 0, "플레이어", "어떻게 지평좌표계에 고정을 하셨나요?", 1.)
      call QMsg(P, 0, "떠도는 유령", ".....", 1.)
      call SaveInteger(udg_hash, StringHash("QLevel16"), P, -2)
      call QMsg(P, 0, "0", "당분간 해당 퀘스트를 하실 수 없습니다 (20초)", 0)
      call PauseUnit(udg_Unit[P], false)
      call TriggerSleepAction(10.)
      set udg_Quest_Boolean_B[P] = false
      call TriggerSleepAction(10.)
      call SaveInteger(udg_hash, StringHash("QLevel16"), P, 0)
      call MSG(Player(P-1), 2, 4, "(유령의 생각이 정리된 것 같습니다)")
    else
      call MSG(Player(P-1), 1, 8, "목록에 없는 선택지입니다. 다른 선택을 하여 주세요.|r" + I2S(n))
    endif
  else
    call TriggerSleepAction(.5)
    call DisplayTimedTextToPlayer(Player(P-1), 0.50, 0, 8., "|cffffdc3c선택지 이탈! 카페에 신고 해 주세요. [|r"+I2S(n)+"|cffffdc3c/|r" + s + "|cffffdc3c]")
  endif
 set P = 0
 set s = ""
 set n = 0
endfunction

//===========================================================================
function InitTrig_Quest_Type_All takes nothing returns nothing
  set gg_trg_Quest_Type_All = CreateTrigger(  )
  call TriggerAddCondition( gg_trg_Quest_Type_All, Condition( function Trig_Quest0_B_Typ_All2_Conditions ) )
  call TriggerAddAction( gg_trg_Quest_Type_All, function Trig_Quest0_B_Typ_All2_Actions )
endfunction

//===========================================================================
// Trigger: Quest Attack
//===========================================================================
function Trig_Quest_Attack_Conditions takes nothing returns boolean
 return ( GetIssuedOrderId() == 851971 ) and ( GetUnitAbilityLevel(GetOrderTargetUnit(),'A003') > 0 )
endfunction

function Trig_Quest_Attack_Actions takes nothing returns nothing
  call IssueTargetOrder( GetTriggerUnit(), "attack", GetOrderTargetUnit() )
endfunction

//===========================================================================
function InitTrig_Quest_Attack takes nothing returns nothing
    set gg_trg_Quest_Attack = CreateTrigger(  )
    call TriggerAddCondition( gg_trg_Quest_Attack, Condition( function Trig_Quest_Attack_Conditions ) )
    call TriggerAddAction( gg_trg_Quest_Attack, function Trig_Quest_Attack_Actions )
endfunction

//===========================================================================
// Trigger: Quest 00 47 B
//===========================================================================
globals
  integer quest_temp_i
  real quest_temp_r
endglobals

function Quest00_47_Action takes nothing returns nothing
  set quest_temp_i = GetPlayerId(GetOwningPlayer(GetEnumUnit()))+1
  set udg_Quest_ClearInt_00_47[quest_temp_i] = udg_Quest_ClearInt_00_47[quest_temp_i] + 1
  if ( udg_Quest_ClearInt_00_47[quest_temp_i] >= 30 ) then
    call MSG(Player(quest_temp_i-1), 1, 7., "이정도면 충분히 잡은것 같습니다.")
    call Bufftt(CreateTextTagUnitBJ("|cff46ffff" + I2S(udg_Quest_ClearInt_00_47[quest_temp_i]), GetEnumUnit(), 0, 8., 100., 100., 100., 0 ), 16)
  else
    call Bufftt(CreateTextTagUnitBJ("|cffff0000" + I2S(udg_Quest_ClearInt_00_47[quest_temp_i]), GetEnumUnit(), 0, 8., 100., 100., 100., 0 ), 16)
  endif
endfunction
function Quest00_47_Condi1 takes nothing returns boolean
  return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) ) and ( udg_Quest_00_Note[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] == 47 ) and ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] == udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1] )
endfunction

function Trig_Quest_00_47_B_Actions takes nothing returns nothing
  set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), 1100., Condition(function Quest00_47_Condi1))
  call ForGroup(udg_temp_g, function Quest00_47_Action)
  call DestroyGroup( udg_temp_g )
endfunction

//===========================================================================
function InitTrig_Quest_00_47_B takes nothing returns nothing
  set gg_trg_Quest_00_47_B = CreateTrigger(  )
  call TriggerAddAction( gg_trg_Quest_00_47_B, function Trig_Quest_00_47_B_Actions )
endfunction

//===========================================================================
// Trigger: Quest 01
//===========================================================================
function Quest01 takes unit user returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(user))+1
  if ( Quest_Level(P, 1) == -1 ) then
    call QMsg(P, 0, "농부", "어어.. 자네, 저번에 도와준 건 고마웠네.", 1.)
  elseif ( Quest_Level(P, 1) == 0 ) and ( GetHeroLevel(user) > 5 ) then
    call QMsg(P, 0, "농부", "당신에게 부탁하기엔 너무 창피하구만.. [레벨제한 5 이하]", 0)
  elseif ( Quest_Level(P, 1) == 0 ) then
    call Quest_Start(P, 1, true)
    call QMsg(P, 0, "농부", "에고고...", 1.)
    call QMsg(P, 0, "플레이어", "무슨일이죠?", 1.)
    call QMsg(P, 6., "농부", "에구구... 농사를 해야 하는데 그만 뱀에게 다쳐 움직일 수가 없네...", 1.5)
    call QMsg(P, 0, "농부", "혹시 자네, 나를 좀 도와주지 않을텐가?", 1.)
    call QMsg(P, 0, "플레이어", "음...", 1.5)
    call QMsg(P, 0, "플레이어", "당연히 도와드리겠습니다.", 1.)
    call QMsg(P, 8., "농부", "도와준다니 고맙네. 그럼 나를 대신하여 밀좀 수확해주게. 5개정도 수확한 뒤에 나에게 다시 돌아와주게.", 0.5)
    call QMsg(P, 0, "농부", "아 참, 그리고.. 가끔 뱀도 나오니 조심하게나..", 1.)
    call QMsg(P, 7, "1", "농부가 밀을 5개 수확해 오라고 한다. 밀을 5개 수확하고 돌아가자.", .5)
  elseif ( Quest_Level(P, 1) == 1 ) then
    if ( CountItem(P, 'I00O') < 5 ) then
      call QMsg(P, 0, "농부", "자네.. 지금 이걸 도와준다고 하는건가? 밀다발을 5개는 구해오게!", 0)
    else
      call Quest_Start(P, 1, false)
      call QMsg(P, 0, "농부", "어찌 되었는가?", 1.)
      call MinusItem(P, 'I00O', 5)
      call QMsg(P, 0, "0", "(가지고 있는 밀을 건네 주었다.)", 1.)
      call QMsg(P, 0, "농부", "고생했네. 내 보답으로 작은 보상을 주겠네.", 1.)
      call MakeTestt(P, true, 100)
      call MakeTestt(P, false, 250)
      call GiveItem(P, 'I00P', 0)
      call GiveItem(P, 'I05J', 0)
      if ( GetRandomInt(1, 3) <= 1 ) then
        call GiveItem(P, 'I013', 0)
      elseif ( GetRandomInt(1, 2) <= 1 ) then
        call GiveItem(P, 'I014', 0)
      else
        call GiveItem(P, 'I015', 0)
      endif
      call QMsg(P, 7, "2", "농부를 도와주고 장비들과 금화 100, 경험치를 250 얻었다!", 1.)
      call QMsg(P, 0, "농부", "나를 더 도와주고 싶다면 또 말을하게.", .5)
      call Quest_End(P, 1, true)
    endif
  elseif ( Quest_Level(P, 1) >= 2 ) then
    if ( CountItem(P, 'I00O') < 5 ) then
      call QMsg(P, 0, "농부", "고마웠네, 또 도와주려면 밀을 5개 가지고 오게나~", 0)
    else
      call Quest_Start(P, 1, false)
      call QMsg(P, 0, "농부", "오, 또 왔는가?", 1.)
      call MinusItem(P, 'I00O', 5)
      call QMsg(P, 0, "0", "(가지고 있는 밀을 건네 주었다.)", 1.)
      call QMsg(P, 0, "농부", "매번 고맙네. 작지만 내 성의니 받아 주게나.", 1.)
      call MakeTestt(P, true, 200)
      call MakeTestt(P, false, 1200)
      call GiveItem(P, 'I00S', 1)
      call QMsg(P, 7, "2", "농부를 도와주고 금화 200, 밀레스 리콜, 경험치를 1200 얻었다!", 1.5)
      call QMsg(P, 0, "농부", "더 도와주고 싶다면 언제든지 오게나.", .5)
      call Quest_End(P, 1, true)
    endif
  endif
  call Quest_End2(P)
endfunction

function Trig_Quest_01_Actions takes nothing returns nothing
 call Quest01(GetAttacker())
endfunction

//===========================================================================
function InitTrig_Quest_01 takes nothing returns nothing
    set gg_trg_Quest_01 = CreateTrigger(  )
    call TriggerRegisterUnitEvent( gg_trg_Quest_01, gg_unit_nvil_0117, EVENT_UNIT_ATTACKED )
    call TriggerAddAction( gg_trg_Quest_01, function Trig_Quest_01_Actions )
endfunction

//===========================================================================
// Trigger: Quest 02
//===========================================================================
function UnitControl takes player p, boolean ox returns nothing
  if ( GetLocalPlayer() == p ) then
    call EnableUserControl(ox)
  endif
endfunction

function Quest02 takes unit user, unit NPC returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(user))+1
 local integer keyitem = 'I00T'
  //레벨제한 6~14
  if ( Quest_Level(P, 2) == -1 ) then
    call QMsg(P, 0, "마을 남자", "여어~ 저번에 구해준 해독제 고맙네.", 0)
  elseif ( Quest_Level(P, 2) == 0 ) then
    if ( 6 > GetHeroLevel(user) ) then
      call QMsg(P, 0, "마을 남자", "ㅇ... 으으.. [퀘스트 레벨제한 6~]", 0)
    else
      call Quest_Start(P, 2, true)
      call QMsg(P, 0, "플레이어", "저기...", 1.)
      call QMsg(P, 0, "마을 남자", "...........", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(뭐야.. 잠을 자고 있나?)", 1.)
      call QMsg(P, 0, "마을 남자", "…구……해……ㅈ…", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(?? 뭔소리야.. 잠꼬댄가?)", 1.)
      call QMsg(P, 0, "플레이어", "(툭툭)저기……. 헉! 괘, 괜찮으세요?", 1.)
      call QMsg(P, 0, "마을 남자", "지…하묘…ㅈ…, 해독…ㅈ…구…해…….|r(히까닥)", 1.)
      call QMsg(P, 0, "플레이어", "이봐요, 이봐요!", 1.)
      call QMsg(P, 0, "플레이어", "음…. 어쩐담…….", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc (아무래도 도와주어야겠어..)", 1.)
      call QMsg(P, 7, "1", "마을 남자를 위해, 지하 묘지에서 해독제를 구해주자.", .5)
      call Ping(Player(P-1), 10368., -11328., 8.)
    endif
  elseif ( Quest_Level(P, 2) == 1 ) then
    if not ( MinusItem(P, keyitem, 0) ) then
      call QMsg(P, 0, "마을 남자", "…으으…….", 0)
    else
      call Quest_Start(P, 2, false)
      call QMsg(P, 0, "플레이어", "이봐요, 이봐요!", 1.)
      call QMsg(P, 0, "마을 남자", "…으으…….", 1.)
      call QMsg(P, 0, "플레이어", "정신좀 차려봐요.", 1.)
      if ( udg_Quest_WaitTime[P] > .1 ) then
        call PauseUnit(user, false)
        call UnitControl(Player(P-1), false)
        call IssuePointOrder(user, "move", GetWidgetX(NPC), GetWidgetY(NPC))
        call TriggerSleepAction(udg_Quest_WaitTime[P]*1.5)
        call QMsg(P, 0, "플레이어", "|c008bc7fc(음....)", 1.)
        call PauseUnit(user, true)
        call UnitControl(Player(P-1), true)
      endif
      call QMsg(P, 0, "0", "(해독제를 먹였다.)", 1.)
      call QMsg(P, 0, "마을 남자", "…으음…….", 1.)
      call QMsg(P, 0, "플레이어", "정신이 드세요?", 1.)
      call QMsg(P, 0, "마을 남자", "…고…맙네. 덕분에 살았네.", 1.)
      call GiveItem(P, 'I00S', 1)
      call MakeTestt(P, true, 350)
      call MakeTestt(P, false, 1600)
      call QMsg(P, 0, "2", "마을 남자를 도와주고 350G와 밀레스리콜을 얻고, 경험치를 1600 얻었다!", 2.)
      call QMsg(P, 0, "마을 남자", "도와줘서 고마웠네. 이게 있으면 나처럼 될 일이 없을 거네.", 1.)
      call GiveItem(P, 'I08V', 3)
      call QMsg(P, 0, "0", "|cffffdc3c마을남자로부터 코마디움을 3개 받았습니다.", 1.5)
      call QMsg(P, 0, "마을 남자", "자네라면 신전 위쪽에있는 노인을 상대할 수 있을것 같군. 한번 가보는게 좋을걸세.", 1.)
      call Ping(Player(P-1), GetWidgetX(I2QU(4)), GetWidgetX(I2QU(5)), 12.)
      call Quest_End(P, 2, false)
    endif
  endif
  call Quest_End2(P)
endfunction
function Trig_Quest_02_Actions takes nothing returns nothing
 call Quest02(GetAttacker(), GetTriggerUnit())
endfunction
//===========================================================================
function InitTrig_Quest_02 takes nothing returns nothing
    set gg_trg_Quest_02 = CreateTrigger(  )
    call TriggerRegisterUnitEvent( gg_trg_Quest_02, gg_unit_n000_0018, EVENT_UNIT_ATTACKED )
    call TriggerAddAction( gg_trg_Quest_02, function Trig_Quest_02_Actions )
endfunction

//===========================================================================
// Trigger: Quest 02 B
//===========================================================================
function Trig_Quest_02_B_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1
  if ( CountItem(P, 'I00T') >= 0 ) then
    call MSG(Player(P-1), 1, 8, "이미 해독제를 구했습니다.")
  elseif ( GetRandomReal(0,100) <= 20 ) then
    call MSG(Player(P-1), 1, 8, "해독제를 얻었습니다.")
    call GiveItem(P, 'I00T', 0)
  endif
endfunction

//===========================================================================
function InitTrig_Quest_02_B takes nothing returns nothing
    set gg_trg_Quest_02_B = CreateTrigger()
    call TriggerAddAction( gg_trg_Quest_02_B, function Trig_Quest_02_B_Actions )
endfunction

//===========================================================================
// Trigger: Quest 03
//===========================================================================
function Quest03 takes unit user, unit NPC returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(user))+1
 local integer keyitem = 'I07N'
  if ( Quest_Level(P, 3) == -1 ) then
    call QMsg(P, 0, "아이", "저번엔 고마웠어요 용사님. 잊지 않을게요.", 0)
  elseif ( Quest_Level(P, 3) == 0 ) then
    //레벨제한 2~10
    if ( 1 >= GetHeroLevel(user) ) or ( GetHeroLevel(user) > 9 ) then
      call QMsg(P, 0, "아이", "부끄러운 고민이에요.... [퀘스트 레벨제한 2~9]", 0)
    else
      call Quest_Start(P, 3, true)
      call QMsg(P, 0, "플레이어", "응? 넌 이름이 뭐니?", 1.)
      call QMsg(P, 0, "아이", "음........", 1.)
      call QMsg(P, 0, "플레이어", "..음.. 무슨 걱정이 있니?", .5)
      call QMsg(P, 0, "아이", "|c008bc7fc(화들짝). |c00ffff00헉. 누, 누구세요?", 1.)
      call SetUnitFacingTimed(NPC, Ang2(NPC, GetWidgetX(user), GetWidgetY(user)), 1.)
      call QMsg(P, 0, "플레이어", "..음.. 무슨 걱정이 있니?", 1.)
      call QMsg(P, 0, "플레이어", "지나가는 모험자란다. 넌 무슨 걱정이 있는가 보구나.", 1.)
      call QMsg(P, 0, "아이", "아....저.... 사실은......", 1.)
      call QMsg(P, 0, "플레이어", "무슨일이니? 혹 괜찮다면 나에게 말해 주련?", 1.)
      call QMsg(P, 0, "아이", "....며칠 후면 아는 여자애의 생일인데..", 1.)
      call QMsg(P, 0, "아이", "..생일선물로 팜팻의 알을 가지고 싶다지 뭐에요!", 1.)
      call QMsg(P, 0, "아이", "전 이렇게 약해서.. 밖으로 나가지도 못하는데.......", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(음.. 알만하군..)", .7)
      call QMsg(P, 0, "아이", "...그래! 모험자님은 친절하시니까 절 도와주실수 있으시겠죠? 그렇죠?", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(음…. 어찌할까…….)", 1.5)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(귀여우니 도와주자.)", 1.)
      call QMsg(P, 0, "플레이어", "내가 도와 줄게", 1.)
      call QMsg(P, 0, "아이", "감사해요... 용사님만 믿어요!", .5)
      call SetUnitAnimationByIndex(NPC, 2)
      call QMsg(P, 7, "1", "아이를 위해, 팜팻의 알을 구해 주자.\n팜팻은 아래 팜펫 숲에서 자주 볼 수 있다.", .5)
      call SetUnitAnimation(NPC, "stand")
      call EnableTrigger(gg_trg_Quest_03_B)
    endif
  elseif ( Quest_Level(P, 3) == 1 ) then
    if not ( MinusItem(P, keyitem, 0) ) then
      call QMsg(P, 0, "아이", "부탁드려요, 용사님~", 0)
    else
      call Quest_Start(P, 3, false)
      call QMsg(P, 0, "아이", "앗. 구해오셨나요?", 1.)
      call QMsg(P, 0, "플레이어", "그래, 여기 있단다.", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(이걸로 다 잘되겠지..)", 1.)
      call QMsg(P, 0, "0", "(알을 건네 주었다.)", 1.)
      call QMsg(P, 0, "아이", "정말로 팜팻의 알이네요! 고마워요, 용사님. 잊지 않을게요.", 1.5)
      call GiveItem(P, 'I063', 0)
      call GiveItem(P, 'I009', 0)
      call MakeTestt(P, true, 300)
      call MakeTestt(P, false, 1800)
      call QMsg(P, 7, "2", "아이를 도와주고 300G와 로오의반지, 칸의목걸이 그리고 경험치를 1800 얻었다!", .5)
      call QMsg(P, 0, "아이", "잊지 않을게요~", 0)
      call Quest_End(P, 3, false)
    endif
  endif
  call Quest_End2(P)
endfunction
function Trig_Quest_03_Actions takes nothing returns nothing
  call Quest03(GetAttacker(), GetTriggerUnit())
endfunction

//===========================================================================
function InitTrig_Quest_03 takes nothing returns nothing
    set gg_trg_Quest_03 = CreateTrigger()
    call TriggerRegisterUnitEvent(gg_trg_Quest_03, gg_unit_nvlk_0188, EVENT_UNIT_ATTACKED)
    call TriggerAddAction(gg_trg_Quest_03, function Trig_Quest_03_Actions)
endfunction

//===========================================================================
// Trigger: Quest 03 B
//===========================================================================
function Trig_Quest_03_B_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1
  if ( CountItem(P, 'I07N') >= 0 ) then
    call MSG(Player(P-1), 1, 8, "이미 팜팻의 알을 얻었습니다.")
  elseif ( GetRandomReal(0,100) <= 15. ) then
    call MSG(Player(P-1), 1, 8, "팜팻의 알을 얻었습니다.")
    call GiveItem(P, 'I07N', 0)
  endif
endfunction

//===========================================================================
function InitTrig_Quest_03_B takes nothing returns nothing
  set gg_trg_Quest_03_B = CreateTrigger(  )
  call TriggerAddAction( gg_trg_Quest_03_B, function Trig_Quest_03_B_Actions )
endfunction

//===========================================================================
// Trigger: Quest 03 D
//===========================================================================
function Trig_Quest_03_D_Conditions takes nothing returns boolean
  return isHero(GetEnteringUnit()) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetEnteringUnit()))+1, 3) == 1 )
endfunction

function Trig_Quest_03_D_Actions takes nothing returns nothing
  set quest_temp_i = GetPlayerId(GetOwningPlayer(GetEnteringUnit()))+1
  if ( CountItem(quest_temp_i, 'I07N') >= 0 ) then
    call MSG(Player(quest_temp_i-1), 1, 8, "이미 팜팻의 알을 발견했습니다.")
  else
    call GiveItem(quest_temp_i, 'I07N', 0)
    call MSG(Player(quest_temp_i-1), 1, 8., "팜팻의 알을 발견했습니다!\n\n>아이에게 돌아가보자.")
  endif
endfunction

//===========================================================================
function InitTrig_Quest_03_D takes nothing returns nothing
    set gg_trg_Quest_03_D = CreateTrigger(  )
    call TriggerRegisterEnterRectSimple( gg_trg_Quest_03_D, gg_rct_Quest03_Enter )
    call TriggerAddCondition( gg_trg_Quest_03_D, Condition( function Trig_Quest_03_D_Conditions ) )
    call TriggerAddAction( gg_trg_Quest_03_D, function Trig_Quest_03_D_Actions )
endfunction

//===========================================================================
// Trigger: Quest 04
//===========================================================================
function Quest04 takes unit user returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(user))+1
 local integer keyitem = 'I07O'
  if ( Quest_Level(P, 4) == -1 ) then
    call QMsg(P, 0, "부자 노인", "저번에 구해준 걸로 충분하네, 고,마... 가게!", 0)
  elseif ( Quest_Level(P, 4) == 0 ) then
    if ( 7 > GetHeroLevel(user) ) then
      call QMsg(P, 0, "부자 노인", "어디 적당한 놈 없나... [퀘스트 레벨제한 7~]", 0)
    else
      call Quest_Start(P, 4, true)
      call QMsg(P, 0, "부자 노인", "으으음...", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(뭐하는거지?)", 1.)
      call QMsg(P, 0, "부자 노인", "으으음..........!", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(답답하군...)", 1.)
      call QMsg(P, 0, "플레이어", "무슨일인가요, 할아버지?", 1.)
      call QMsg(P, 0, "부자 노인", "날 좀 도와주게.", 1.)
      call QMsg(P, 0, "부자 노인", "나에게 독거미알을 5개정도 구해다 줄 수 있겠나?", 1.)
      call QMsg(P, 0, "부자 노인", "그런눈으로 보지말게. 내 보상은 섭섭지 않게 하겠네.", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(흠..보상이라..)", 1.5)
      call QMsg(P, 0, "플레이어", "당연히 도와드리겠습니다.", 1.)
      call QMsg(P, 0, "부자 노인", "좋아, 그럼 기다리고 있겠네.", .7)
      call QMsg(P, 7, "1", "노인을 위해, 지하 묘지에서 독거미알 5개 구해주자.", .5)
      call Ping(Player(P-1), GetRectCenterX(gg_rct_Moving_01), GetRectCenterY(gg_rct_Moving_01), 12.)
    endif
  elseif ( Quest_Level(P, 4) >= 1 ) then
    if ( CountItem(P, keyitem) < 5 ) then
      call QMsg(P, 0, "부자 노인", "자네.. 난 독거미알을 5개 구해 오라고 했네...", 0)
    else
      call Quest_Start(P, 4, false)
      call QMsg(P, 0, "부자 노인", "어찌 되었는가?", 1.)
      call QMsg(P, 0, "플레이어", "여기 구해 왔습니다.", 1.)
      if ( Quest_Level(P, 4) >= 4 ) then
        call MinusItem(P, keyitem, 999)
        call QMsg(P, 0, "부자 노인", "흠, 흠 좋군. 잠시만 기다리게.", 1.)
        call MakeTestt(P, true, 750)
        call MakeTestt(P, false, 1800)
        call GiveItem(P, 'I08V', 3)
        call GiveItem(P, 'I073', GetRandomInt(5,14)*5+1)
        call SetUnitAnimationByIndex(I2QU(4), 3)
        call QMsg(P, 7, "2", "부자 노인을 도와주고 코마디움 3개와 750G, 그리고 경험치를 1800 얻었다!\n\n＊|cffffdc3c특별보상＞|c00ffff80＞부자 노인이 고맙다며 특별히 루비 귀걸이를 주었다! |c008000ff(인벤토리)", 1.5)
        call Quest_End(P, 4, false)
      else
        call MinusItem(P, keyitem, 5)
        call QMsg(P, 0, "부자 노인", "흠, 흠 좋군. 잠시만 기다리게.", 1.)
        call MakeTestt(P, true, 500)
        call MakeTestt(P, false, 2500)
        call GiveItem(P, 'I08V', 2)
        call QMsg(P, 7, "2", "부자 노인을 도와주고 코마디움 2개와 500G, 그리고 경험치를 2500 얻었다!", 1.)
        call QMsg(P, 0, "부자 노인", "안 바쁘면 나중에 다시 한번 도와 주게.", 1.)
      endif
    endif
  endif
  call Quest_End2(P)
endfunction
function Trig_Quest_04_Actions takes nothing returns nothing
  call Quest04(GetAttacker())
endfunction

//===========================================================================
function InitTrig_Quest_04 takes nothing returns nothing
  set gg_trg_Quest_04 = CreateTrigger(  )
  call TriggerRegisterUnitEvent(gg_trg_Quest_04, gg_unit_u000_0190, EVENT_UNIT_ATTACKED)
  call TriggerAddAction( gg_trg_Quest_04, function Trig_Quest_04_Actions )
endfunction

//===========================================================================
// Trigger: Quest 04 B
//===========================================================================
function Trig_Quest_04_B_Actions takes nothing returns nothing
  local integer i = IMaxBJ(1,udg_PartyNumber_pP[udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1]])
  local integer i2 = 0
  if ( GetUnitTypeId(GetTriggerUnit()) == 'n012' ) then
    set i = i * 2 + 2
  endif
  if ( GetUnitTypeId(GetTriggerUnit()) == 'n014' ) then
    set i = i * 3 + 3
  endif
  loop
    set i = i - 1
    if ( GetRandomReal(0,100) <= 35. ) then
      call CreateItem('I07O', GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()))
      set i2 = i2 + 1
    endif
    exitwhen i <= 0
  endloop
  if ( i2 > 3 ) then
    set bj_lastCreatedTextTag = CreateTextTag()
    call SetTextTagText(bj_lastCreatedTextTag, "WOW !", .035)
    call SetTextTagPos(bj_lastCreatedTextTag, GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), 30)
    call SetTextTagColor(bj_lastCreatedTextTag, GetRandomInt(128,255), GetRandomInt(128,255), GetRandomInt(0,128), 255)
    call Bufftt(bj_lastCreatedTextTag, 1)
  endif
  set i2 = 0
endfunction

//===========================================================================
function InitTrig_Quest_04_B takes nothing returns nothing
  set gg_trg_Quest_04_B = CreateTrigger()
  call TriggerAddAction(gg_trg_Quest_04_B, function Trig_Quest_04_B_Actions)
endfunction

//===========================================================================
// Trigger: Quest 05
//===========================================================================
constant function Quest05CheckUnit takes integer QLv returns unit
/*단계별 유닛 반환. 아니면 해당 유닛을 찾아가라는 메시지
0,5 - 촌장, 퀘 시작
1,3,4,6 - 투르크 퀘
2 - 둘라코스*/
  if ( QLv == 0 ) or ( QLv == 5 ) then
    return gg_unit_u001_0191
  elseif ( QLv == 1 ) or ( QLv == 3 ) or ( QLv == 4 ) or ( QLv == 6 ) then
    return gg_unit_n02P_0193
  elseif ( QLv == 2 ) then
    return gg_unit_u002_0192
  endif
 return null
endfunction
function Quest05 takes unit user, unit NPC returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(user))+1
  if ( Quest_Level(P, 5) == -1 ) then
    if ( NPC == gg_unit_u001_0191 ) then
      call QMsg(P, 0, "수오미 촌장", "고맙네! 죽은줄알았던 내 아들까지 돌아왔네!", 1.)
    elseif ( NPC == gg_unit_n02P_0193 ) then
      call QMsg(P, 0, "투르크", "이곳까지 들려오는 소문을 들었네! 정말 대단하군! 자이언트 맨티스를 쓰러뜨리다니! 축하하네!", 1.)
    elseif ( NPC == gg_unit_u002_0192 ) then
      call QMsg(P, 0, "둘라코스", "소문 들었네! 자이언트 맨티스를 쓰러뜨렸다지? 대단하군.", 1.)
    endif
  elseif ( Quest05CheckUnit(Quest_Level(P, 5)) != NPC ) then
    call QMsg(P, 0, GetUnitName(NPC), "흠.. "+GetUnitName(Quest05CheckUnit(Quest_Level(P, 5)))+"을(를) 찾아가보게.", 0)
  elseif ( Quest_Level(P, 5) == 0 ) then
    if ( 11 > GetHeroLevel(user) ) then
      call QMsg(P, 0, GetUnitName(NPC), "결계에 맞는 인원이 필요한데... [2서클(11~) 이후 퀘스트]", 0)
    elseif ( udg_PartyNumber_ThisP[P] == 0 ) then
      call QMsg(P, 0, GetUnitName(NPC), "혼자인가? 부탁하기 어렵겠군.. [파티가 필요합니다]", 0)
    else
      call Quest_Start(P, 5, true)
      call QMsg(P, 0, "촌장", "음.. 자네는.. 모험자인가?", 1.)
      call QMsg(P, 0, "플레이어", "그렇습니다. ", 1.)
      call QMsg(P, 0, "촌장", "모험자라.. 오랜만에 보는군..", 1.)
      call QMsg(P, 0, "플레이어", "무슨.. 말이죠? 어떤 일이 있었나요?", 1.)
      call QMsg(P, 0, "촌장", "여기 수오미 숲에는 자이언트 맨티스라는 지배자가 살고있다네..", 1.)
      call QMsg(P, 0, "촌장", "이대로 가다가는 우리는 멸망이네.. 우리 마을을 위해 그 맨티스를 처치해주겠나?", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(흠..자이언트 맨티스라..)", 1.5)
      call QMsg(P, 0, "플레이어", "저와 제 파티라면 해낼수 있을 것입니다.", 1.)
      call QMsg(P, 0, "촌장", "오오..! 고맙네! 자네를 위해 몇가지 알려주겠네.", 1.)
      call QMsg(P, 0, "촌장", "지금 자이언트 맨티스가 있는곳은 결계로 인해 들어갈 수 없네.", 1.)
      call QMsg(P, 0, "촌장", "나는 잘 모르지만.. 예전에 이곳에서 자이언트 맨티스를 연구하던 투르크라면 뭔갈 알지도 모르겠군.", 1.)
      call QMsg(P, 0, "플레이어", "투르크.. 요? 그 자는 어디에 있습니까?", 1.)
      call QMsg(P, 0, "촌장", "로톤 마을에 한번 가보게. 이 마을에서 음식 좀 사가는게 좋을거야.", .7)
      call QMsg(P, 8, "1", "멀고도 험한 길! 자이언트 맨티스를 잡기위해 먼저 투르크를 만나보자.|r\nTip :: 음식을 사서 가는게 좋다.", .7)
    endif
  elseif ( Quest_Level(P, 5) == 1 ) then
    if not ( MinusItem(P, 'I08C', 0) ) then
      call QMsg(P, 0, "투르크", "너는 또 뭐야! 배고프니까 말 걸지 마!", .8)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(음식이 필요한 것 같다.)", 0)
    else
      call Quest_Start(P, 5, false)
      call SetEffiectLocal(P, NPC, 3)
      call QMsg(P, 0, "투르크", "음? 이 냄새는..!", 1.)
      call QMsg(P, 0, "투르크", "일단 먹고 봄세! |c008bc7fc(우걱우걱..)", 1.)
      call QMsg(P, 0, "투르크", "|c008bc7fc(우걱우걱)", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(거 참 복스럽게도 먹네...)", 1.)
      call QMsg(P, 0, "투르크", "아~! 잘 먹었다!", 1.)
      call QMsg(P, 0, "투르크", "그래, 고맙네.", 1.)
      call QMsg(P, 0, "투르크", "이왕 날 도와준거 한번만 더 도와주게.", 1.5)
      call QMsg(P, 0, "플레이어", "좋습니다, 어떻게 도와드리면 됩니까?", .7)
      call QMsg(P, 0, "투르크", "루어스에가면 둘라코스라고 하는친구가 있는데,", 1.)
      call QMsg(P, 0, "투르크", "그 친구에게 내 상황좀 설명 해 주게. 몬스터에게 습격받았다고 하면 될 거네.", 1.)
      call QMsg(P, 0, "플레이어", "알겠습니다..", 1.)
      call QMsg(P, 7, "1", "멀고도 험한 길! 루어스 성에있는 둘라코스를 찾아가자.", .5)
      call QMsg(P, 0, "투르크", "부탁하네.", 0)
    endif
  elseif ( Quest_Level(P, 5) == 2 ) then
    call Quest_Start(P, 5, false)
    call SetEffiectLocal(P, NPC, 3)
    call QMsg(P, 0, "플레이어", "안녕하세요? 투르크의 부탁으로 오게 되었습니다. ", 1.)
    call QMsg(P, 0, "둘라코스", "...!", 1.)
    call QMsg(P, 0, "둘라코스", "그자는 지금 어디에 있죠?", 1.)
    call QMsg(P, 0, "플레이어", "투르크는 몬스터의 습격을 받았습니다. ", 1.)
    call QMsg(P, 0, "둘라코스", "그런일이..! 그런줄도 모르고...", 1.)
    call QMsg(P, 0, "플레이어", "자세히 설명좀 해주시겠습니까? ", 1.)
    call QMsg(P, 0, "둘라코스", "얼마 전, 투르크에게 우린 보물소송임무를 내렸지요.", 1.)
    call QMsg(P, 0, "둘라코스", "하지만 시간이 가도 투르크는 돌아오지않고..", 1.)
    call QMsg(P, 0, "둘라코스", "우리는 투르크가 보물을 가지고 도망친 줄 알았지요.", 1.)
    call QMsg(P, 0, "둘라코스", "그리하여 투르크는 현재 수배령이 내려져 있습니다.", 1.)
    call QMsg(P, 0, "둘라코스", "당장 사면시켜야겠군요.", 1.)
    call QMsg(P, 0, "둘라코스", "이제, 그에게 돌아가서 사면되었다고 말해주세요. 빨리 돌아왔으면 좋겠군요.", 1.)
    call QMsg(P, 0, "플레이어", "알겠습니다.", 1.)
    call QMsg(P, 7, "1", "멀고도 험한 길! 다시 투르크에게 돌아가자.", 0.5)
  elseif ( Quest_Level(P, 5) == 3 ) then
    call Quest_Start(P, 5, false)
    call QMsg(P, 0, "투르크", "그래, 어떻게 되었나?", 1.)
    call QMsg(P, 0, "플레이어", "이제, 당신은 사면되었습니다. 둘라코스는 당신을 보고싶어 하더군요. ", 1.)
    call QMsg(P, 0, "투르크", "흠, 그런가? 잘 된 일이로군.. 하지만...", 1.)
    call QMsg(P, 0, "투르크", "난 그 보물을 찾아야겠네. 나를 마지막으로 한번만 더 도와주게.", 1.)
    call QMsg(P, 0, "플레이어", "휴우.. 좋습니다. 어떻게 도와드리면 됩니까?", 1.)
    call QMsg(P, 0, "투르크", "정말 고맙네, 몬스터 습격은 포테의 숲을 지나던 중에 당했네.", 1.)
    call QMsg(P, 0, "플레이어", "포테의 숲이라.. 알겠습니다.", 1.)
    call QMsg(P, 7, "1", "멀고도 험한 길! 포테의 숲에서 보물을 찾자.\n|cffc3dbff\"-퀘스트\"|cffffdc3c를 입력하여 힌트를 받을 수 있다.", .5)
  elseif ( Quest_Level(P, 5) == 4 ) then
    if not ( MinusItem(P, 'I08D', 0) ) then
      call QMsg(P, 0, "투르크", "보물상자를 찾아 와주게. 아벨 마을 앞마당 근처에서 찾으면 될걸세.", .5)
      call Ping(Player(P-1), GetRandomReal(GetRectMinX(gg_rct_Quest05_Tresure),GetRectMaxX(gg_rct_Quest05_Tresure)), GetRandomReal(GetRectMinY(gg_rct_Quest05_Tresure),GetRectMaxY(gg_rct_Quest05_Tresure)), -4.)
      call Ping(Player(P-1), GetRandomReal(GetRectMinX(gg_rct_Quest05_Tresure),GetRectMaxX(gg_rct_Quest05_Tresure)), GetRandomReal(GetRectMinY(gg_rct_Quest05_Tresure),GetRectMaxY(gg_rct_Quest05_Tresure)), 10.)
    else
      call Quest_Start(P, 5, false)
      call QMsg(P, 0, "투르크", "음? 이건...!", 1.5)
      call QMsg(P, 0, "투르크", "내가 찾던 바로 그 상자네! 고맙네!", 1.)
      call QMsg(P, 0, "플레이어", "맞다니 다행이군요, 축하드립니다. ", 1.)
      call QMsg(P, 0, "투르크", "여태까지 날 도와줘서 고맙네! 그래, 자네가 원하는건 뭔가?", 1.)
      call QMsg(P, 0, "플레이어", "수오미마을의 촌장님이 자이언트 맨티스때문에 걱정이 많습니다. ", 1.)
      call QMsg(P, 0, "플레이어", "하지만 결계로 막혀있어 일반 방법으로는 들어갈수 없다고 하더군요.", 1.)
      call QMsg(P, 0, "플레이어", "당신이라면 뭔가 알고 계실거라고 생각합니다. ", 1.)
      call QMsg(P, 0, "투르크", "음... 보통사람은 자이언트 맨티스가 일반 사마귀라고 생각하지만 그건 큰 착각이네.", 1.)
      call QMsg(P, 0, "투르크", "그건.. 몬스터라기보단 괴물에 가깝네. 그리고 그곳엔 기이한 결계가 있네.", 1.)
      call QMsg(P, 0, "투르크", "그 결계는 사람이 들어가는걸 막는다네. 하지만 난 그 결계를 연구해 봤네.", 1.)
      call QMsg(P, 0, "플레이어", "어떻게 되었습니까? ", 1.)
      call QMsg(P, 0, "투르크", "그 결과, 팬던트로 한 사람정도는 지나갈 수 있게 하였네. 여러개를 구해서 가면 될 거야.", 1.)
      call QMsg(P, 0, "플레이어", "좋은 팬던트군요. 저에게 하나 주실수 있으십니까?", 1.)
      call QMsg(P, 0, "투르크", "그게.. 이미 예전에 포테의 숲 결계 근처에서 잃어버렸다네.. 하지만 그건 발견하기가 쉬울거야.", 1.)
      call QMsg(P, 0, "플레이어", "그런가요... 알겠습니다......", 1.)
      call QMsg(P, 7, "1", "포테의 숲 결계 주변에서 펜던트를 찾자.", .5)
      call Ping(Player(P-1), GetRandomReal(GetRectMinX(gg_rct_Quest05_Pantent),GetRectMaxX(gg_rct_Quest05_Pantent)), GetRandomReal(GetRectMinY(gg_rct_Quest05_Pantent),GetRectMaxY(gg_rct_Quest05_Pantent)), 6.)
      call Ping(Player(P-1), GetRandomReal(GetRectMinX(gg_rct_Quest05_Pantent),GetRectMaxX(gg_rct_Quest05_Pantent)), GetRandomReal(GetRectMinY(gg_rct_Quest05_Pantent),GetRectMaxY(gg_rct_Quest05_Pantent)), 10.)
    endif
  elseif ( Quest_Level(P, 5) == 5 ) then
    if ( CountItem(P, 'I08E') < 0 ) then
      call QMsg(P, 0, "촌장", "그냥은 갈 수 없네, 투르크가 말한 팬던트를 구해오게나.", 1.)
      call Ping(Player(P-1), GetRandomReal(GetRectMinX(gg_rct_Quest05_Pantent),GetRectMaxX(gg_rct_Quest05_Pantent)), GetRandomReal(GetRectMinY(gg_rct_Quest05_Pantent),GetRectMaxY(gg_rct_Quest05_Pantent)), 6.)
      call Ping(Player(P-1), GetRandomReal(GetRectMinX(gg_rct_Quest05_Pantent),GetRectMaxX(gg_rct_Quest05_Pantent)), GetRandomReal(GetRectMinY(gg_rct_Quest05_Pantent),GetRectMaxY(gg_rct_Quest05_Pantent)), 10.)
    else
      call Quest_Start(P, 5, false)
      call QMsg(P, 0, "촌장", "그래.. 준비는 다 되었는가?", 1.)
      call QMsg(P, 0, "플레이어", "모든 준비가 끝났습니다. 언제든지 들어갈 준비가 되었습니다.", 1.)
      call QMsg(P, 0, "촌장", "그래, 투르크가 알려준 결계로 가면 될거네. 무운을 비네.", 1.)
      call GiveItem(P, 'I08V', 5)
      call MSG(Player(P-1), 1, 4, "촌장으로부터 코마디움 5개를 받았습니다.")
      call Ping(Player(P-1), GetRectCenterX(gg_rct_Quest05_Mantice_2), GetRectCenterY(gg_rct_Quest05_Mantice_2), 8.)
    endif
  elseif ( Quest_Level(P, 5) == 6 ) then
    if ( CountItem(P, 'I08E') < 0 ) then
      call MinusItem(P, 'I08E', 0)
      call GiveItem(P, 'I08E', 0)
      call QMsg(P, 0, "투르크", "여기, 여분의 팬던트가 있네. 하나밖에 못 가지니 주의하게나.", 1.)
    else
      call QMsg(P, 0, "투르크", "자네는 이미 팬던트가 있지 않나?", 1.)
    endif
  endif

  call Quest_End2(P)
endfunction
function Trig_Quest_05_Actions takes nothing returns nothing
  call Quest05(GetAttacker(), GetTriggerUnit())
endfunction

//===========================================================================
function InitTrig_Quest_05 takes nothing returns nothing
  set gg_trg_Quest_05 = CreateTrigger()
  call TriggerRegisterUnitEvent(gg_trg_Quest_05, gg_unit_u001_0191, EVENT_UNIT_ATTACKED)
  call TriggerRegisterUnitEvent(gg_trg_Quest_05, gg_unit_u002_0192, EVENT_UNIT_ATTACKED)
  call TriggerRegisterUnitEvent(gg_trg_Quest_05, gg_unit_n02P_0193, EVENT_UNIT_ATTACKED)
  call TriggerAddAction(gg_trg_Quest_05, function Trig_Quest_05_Actions)
endfunction

//===========================================================================
// Trigger: Quest 05 D1
//
// 보물상자
//===========================================================================
function Trig_Quest_05_D_Conditions takes nothing returns boolean
  return isHero(GetEnteringUnit()) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetEnteringUnit()))+1, 5) == 4 )
endfunction

function Trig_Quest_05_D_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetEnteringUnit()))+1
  call DisableTrigger( GetTriggeringTrigger() )
  if ( CountItem(P, 'I08D') < 0 ) then
    if ( GetRandomReal(0,100) <= 30. ) then
      call TriggerSleepAction(7.)
      call GiveItem(P, 'I08D', 0)
      call MSG(Player(P-1), 1, 6., "보물 상자를 발견했습니다!")
    elseif ( GetRandomReal(0,100) <= 67. ) then
      call TriggerSleepAction(3.)
      call MSG(Player(P-1), 1, 2., "보물상자가 근처에 있는것 같습니다..")
    endif
  endif
  call EnableTrigger( GetTriggeringTrigger() )
endfunction

//===========================================================================
function InitTrig_Quest_05_D1 takes nothing returns nothing
    set gg_trg_Quest_05_D1 = CreateTrigger(  )
    call TriggerRegisterEnterRectSimple( gg_trg_Quest_05_D1, gg_rct_Quest05_Tresure )
    call TriggerAddCondition( gg_trg_Quest_05_D1, Condition( function Trig_Quest_05_D_Conditions ) )
    call TriggerAddAction( gg_trg_Quest_05_D1, function Trig_Quest_05_D_Actions )
endfunction

//===========================================================================
// Trigger: Quest 05 D2
//===========================================================================
function Trig_Quest_05_D2_Conditions takes nothing returns boolean
  return isHero(GetEnteringUnit()) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetEnteringUnit()))+1, 5) == 5 )
endfunction

function Trig_Quest_05_D2_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetEnteringUnit()))+1
  call DisableTrigger( GetTriggeringTrigger() )
  if ( CountItem(P, 'I08E') < 0 ) then
    if ( GetRandomReal(0,100) <= 25. ) then
      call TriggerSleepAction(7.)
      call GiveItem(P, 'I08E', 0)
      call MSG(Player(P-1), 1, 6., "투르크의 팬던트를 발견했습니다!\n\n>촌장에게 돌아가보자.")
    elseif ( GetRandomReal(0,100) <= 67. ) then
      call TriggerSleepAction(3.)
      call MSG(Player(P-1), 1, 2., "팬턴트의 기운이 근처에서 느껴집니다..")
    endif
  endif
  call EnableTrigger( GetTriggeringTrigger() )
endfunction

//===========================================================================
function InitTrig_Quest_05_D2 takes nothing returns nothing
    set gg_trg_Quest_05_D2 = CreateTrigger(  )
    call TriggerRegisterEnterRectSimple( gg_trg_Quest_05_D2, gg_rct_Quest05_Pantent )
    call TriggerAddCondition( gg_trg_Quest_05_D2, Condition( function Trig_Quest_05_D2_Conditions ) )
    call TriggerAddAction( gg_trg_Quest_05_D2, function Trig_Quest_05_D2_Actions )
endfunction

//===========================================================================
// Trigger: Quest 05 D3 Check
//===========================================================================
function GetLongName takes integer P returns string
  return GetPlayerName(Player(P-1))+"  Lv."+I2S(GetHeroLevel(udg_Unit[P]))+"『"+GetUnitName(udg_Unit[P])+"』"
endfunction
//call MSGAll(bj_forLoopAIndex, false, 1, 2, 12, "|cff0080ff파티장 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80레벨 부적절 |cff0080ff]")
//call MSGAll(bj_forLoopAIndex, false, 1, 2, 11, "|cff00ffff파티원 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80레벨 부적절 |cff00ffff]")


function Trig_Quest_05_D3_Conditions takes nothing returns boolean
 return isHero(GetEnteringUnit())
endfunction

function Trig_Quest_05_D3_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetEnteringUnit()))+1
  if ( P == udg_PartyNumber_ThisP[P] ) then
    call IssueImmediateOrder(GetEnteringUnit(), "stop")
    call PauseUnit(GetEnteringUnit(), true)
    call MSGAll(P, false, 11, 1, 6, "※참고. 레벨 11~40까지의 파티원만 들어갈 수 있습니다.\n　　　　투르크의 팬던트를 가지고 있어야합니다.")
    call TriggerSleepAction(2.)
    call PauseUnit(GetEnteringUnit(), false)
    set bj_forLoopAIndex = 1
    loop
      exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
      if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) then
        if ( GetUnitLevel(udg_Unit[bj_forLoopAIndex]) >= 11 ) and ( GetUnitLevel(udg_Unit[bj_forLoopAIndex]) < 99 ) then
          if ( UnitAlive(udg_Unit[bj_forLoopAIndex]) ) then
            if ( CountItem(bj_forLoopAIndex, 'I08E') >= 0 ) then
              if ( bj_forLoopAIndex == udg_PartyNumber_ThisP[P] ) then
                call MSGAll(bj_forLoopAIndex, false, 1, 2, 12, "|cff0080ff파티장 : "+GetLongName(bj_forLoopAIndex)+"[ |cff00ff00입장 가능 |cff0080ff]")
              else
                call MSGAll(bj_forLoopAIndex, false, 1, 2, 11, "|cff00ffff파티원 : "+GetLongName(bj_forLoopAIndex)+"[ |cff00ff00입장 가능 |cff00ffff]")
              endif
            else
              if ( bj_forLoopAIndex == udg_PartyNumber_ThisP[P] ) then
                call MSGAll(bj_forLoopAIndex, false, 1, 2, 12, "|cff0080ff파티장 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80팬던트 없음 |cff0080ff]")
              else
                call MSGAll(bj_forLoopAIndex, false, 1, 2, 11, "|cff00ffff파티원 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80팬던트 없음 |cff00ffff]")
              endif
            endif
          else
            if ( bj_forLoopAIndex == udg_PartyNumber_ThisP[P] ) then
              call MSGAll(bj_forLoopAIndex, false, 1, 2, 12, "|cff0080ff파티장 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80영웅 사망함 |cff0080ff]")
            else
              call MSGAll(bj_forLoopAIndex, false, 1, 2, 11, "|cff00ffff파티원 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80영웅 사망함 |cff00ffff]")
            endif
          endif
        else
          if ( bj_forLoopAIndex == udg_PartyNumber_ThisP[P] ) then
            call MSGAll(bj_forLoopAIndex, false, 1, 2, 12, "|cff0080ff파티장 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80레벨 부적절 |cff0080ff]")
          else
            call MSGAll(bj_forLoopAIndex, false, 1, 2, 11, "|cff00ffff파티원 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80레벨 부적절 |cff00ffff]")
          endif
        endif
      endif
      set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    call MSG(GetOwningPlayer(GetTriggerUnit()), 1, 3, "앞으로 더 가면 입장할 수 있습니다.")
  else
    call SetUnitX(GetTriggerUnit(), GetUnitX(GetTriggerUnit()) - 256.)
    call MSG(GetOwningPlayer(GetTriggerUnit()), 1, 3, "파티장만 갈 수 있습니다. 이곳에서 대기해주세요.")
  endif
endfunction

//===========================================================================
function InitTrig_Quest_05_D3_Check takes nothing returns nothing
    set gg_trg_Quest_05_D3_Check = CreateTrigger(  )
    call TriggerRegisterEnterRectSimple( gg_trg_Quest_05_D3_Check, gg_rct_Quest05_Mantice )
    call TriggerAddCondition( gg_trg_Quest_05_D3_Check, Condition( function Trig_Quest_05_D3_Conditions ) )
    call TriggerAddAction( gg_trg_Quest_05_D3_Check, function Trig_Quest_05_D3_Actions )
endfunction

//===========================================================================
// Trigger: Quest 05 D4 Makes
//
// isHero(GetEnteringUnit())
//===========================================================================
function Trig_Quest_05_D4_Conditions takes nothing returns boolean
 return isHero(GetEnteringUnit())
endfunction

function ManticeTrapMake takes nothing returns nothing
 local integer i1 = 0
 local integer i2 = 0
 local boolean top = false
  loop
    exitwhen i2 > 10
    set i1 = 0
    loop
      exitwhen i1 > 15
      //함정 먼저 생성, 그 후 확률되면(10%) 나무 생성
      if ( GetRandomReal(0,100) <= 35. ) then
        call SetUnitUserData(CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'n02V', 13632+i1*128, -11584+i2*128, bj_UNIT_FACING), -1)
      elseif ( GetRandomReal(0,65) <= 10.7 ) then
      //총 확률의 10.7%로 나무 생성 - 기대값 가로 한줄에 1.5개
        if ( i1 > 1 and i1 < 15 ) then
          if ( i2 == 0 or i2 == 10 ) then
            if ( not top ) then
              call CreateDestructable('ATtr', 13632+i1*128, -11584+i2*128, GetRandomReal(0,360), 0.8, GetRandomInt(1,5))
              set top = true
            endif
          else
            call CreateDestructable('ATtr', 13632+i1*128, -11584+i2*128, GetRandomReal(0,360), GetRandomReal(.8,1.2), GetRandomInt(1,5))
          endif
        endif
      endif
      set i1 = i1 + 1
    endloop
    call TriggerSleepAction(.1)
    set i2 = i2 + 1
  endloop
endfunction

function Trig_Quest_05_D4_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetEnteringUnit()))+1
 if ( P != udg_PartyNumber_ThisP[P] ) then
   call SetUnitX(GetTriggerUnit(), GetUnitX(GetTriggerUnit()) - 256.)
   call MSG(GetOwningPlayer(GetTriggerUnit()), 1, 3, "파티장만 갈 수 있습니다. 이곳에서 대기해주세요.")
 else
  set bj_forLoopAIndex = 1
  loop
    exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
    if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) then
      if ( GetUnitLevel(udg_Unit[bj_forLoopAIndex]) >= 11 ) and ( GetUnitLevel(udg_Unit[bj_forLoopAIndex]) < 99 ) then
        if ( UnitAlive(udg_Unit[bj_forLoopAIndex]) ) then
          if ( MinusItem(bj_forLoopAIndex, 'I08E', 0) ) then
            call SetUnitPosition(udg_Unit[bj_forLoopAIndex], GetRandomReal(13120,13376), GetRandomReal(-11072, -10816))
            if ( not LoadBoolean(udg_hash, 42, StringHash("Man-Trap"+I2S(bj_forLoopAIndex))) ) then
              call SaveBoolean(udg_hash, 42, StringHash("Man-Trap"+I2S(bj_forLoopAIndex)), true)
              call SaveInteger(udg_hash, StringHash("QLevel5"), bj_forLoopAIndex, 6)
              call TriggerRegisterUnitEvent(gg_trg_Quest_05_F_Attacked, udg_Unit[bj_forLoopAIndex], EVENT_UNIT_ATTACKED)
              debug call BJDebugMsg("등록 - " + I2S(bj_forLoopAIndex))
            endif
          else
            if ( bj_forLoopAIndex == udg_PartyNumber_ThisP[P] ) then
              call MSGAll(bj_forLoopAIndex, false, 1, 2, 12, "|cff0080ff파티장 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80팬던트 없음 |cff0080ff]")
            else
              call MSGAll(bj_forLoopAIndex, false, 1, 2, 11, "|cff00ffff파티원 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80팬던트 없음 |cff00ffff]")
            endif
          endif
        else
          if ( bj_forLoopAIndex == udg_PartyNumber_ThisP[P] ) then
            call MSGAll(bj_forLoopAIndex, false, 1, 2, 12, "|cff0080ff파티장 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80영웅 사망함 |cff0080ff]")
          else
            call MSGAll(bj_forLoopAIndex, false, 1, 2, 11, "|cff00ffff파티원 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80영웅 사망함 |cff00ffff]")
          endif
        endif
      else
        if ( bj_forLoopAIndex == udg_PartyNumber_ThisP[P] ) then
          call MSGAll(bj_forLoopAIndex, false, 1, 2, 12, "|cff0080ff파티장 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80레벨 부적절 |cff0080ff]")
        else
          call MSGAll(bj_forLoopAIndex, false, 1, 2, 11, "|cff00ffff파티원 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80레벨 부적절 |cff00ffff]")
        endif
      endif
    endif
    set bj_forLoopAIndex = bj_forLoopAIndex + 1
  endloop
  if ( not LoadBoolean(udg_hash, 42, StringHash("Man-Trap")) ) then
    call SaveBoolean(udg_hash, 42, StringHash("Man-Trap"), true)
    call ManticeTrapMake()
  endif
 endif
endfunction

//===========================================================================
function InitTrig_Quest_05_D4_Makes takes nothing returns nothing
  set gg_trg_Quest_05_D4_Makes = CreateTrigger(  )
  call TriggerRegisterEnterRectSimple(gg_trg_Quest_05_D4_Makes, gg_rct_Quest05_Mantice_2 )
  call TriggerAddCondition( gg_trg_Quest_05_D4_Makes, Condition( function Trig_Quest_05_D4_Conditions ) )
  call TriggerAddAction( gg_trg_Quest_05_D4_Makes, function Trig_Quest_05_D4_Actions )
endfunction

//===========================================================================
// Trigger: Quest 05 D5 Wait
//===========================================================================
function Trig_Quest_05_D5_Wait_Actions takes nothing returns nothing
 if ( isHero(GetEnteringUnit()) ) then
    call ClearTextMessagesBJ( GetForceOfPlayer(GetOwningPlayer(GetTriggerUnit())) )
    set udg_OnesPositionN[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] = 187
    call MSG(GetOwningPlayer(GetTriggerUnit()), 5, 7, "자이언트 맨티스 대기실")
    call TriggerSleepAction(2.)
    call MSG(GetOwningPlayer(GetTriggerUnit()), 1, 4., "대기실에 들어와 체력과 정신이 회복됨을 느낍니다.")
    if ( not LoadBoolean(udg_hash, 42, StringHash("Man-Pit")) ) then
      call SaveBoolean(udg_hash, 42, StringHash("Man-Pit"), true)
      call SaveUnitHandle(udg_hash, 42, StringHash("Man-Pit2"), CreateUnit(Player(PLAYER_NEUTRAL_PASSIVE), 'o00H', 15904, -10784, bj_UNIT_FACING))
    endif
  endif
endfunction

//===========================================================================
function InitTrig_Quest_05_D5_Wait takes nothing returns nothing
    set gg_trg_Quest_05_D5_Wait = CreateTrigger(  )
    call TriggerRegisterEnterRectSimple( gg_trg_Quest_05_D5_Wait, gg_rct_Quest05_Mantice_3 )
    call TriggerAddAction( gg_trg_Quest_05_D5_Wait, function Trig_Quest_05_D5_Wait_Actions )
endfunction

//===========================================================================
// Trigger: Quest 05 D6 Make
//===========================================================================
function Trig_Quest_05_D6_Make_Conditions takes nothing returns boolean
 return isHero(GetEnteringUnit())
endfunction

function Maintice_OK takes nothing returns nothing
 local integer P = GetPlayerId(GetTriggerPlayer())+1
 local integer loopA = 1
  call MSGAll(0, true, 1, 2, 10., "|c00d962b5＊|cffffdc3c" + udg_PartyTitle[P] + "|cffffdc3c 파티가 자이언트 맨티스 레이드를 시도합니다.|r")
  call AttachSoundToUnit(gg_snd_StoneBridgeRise, udg_Unit[P])
  call StartSound (gg_snd_StoneBridgeRise)
  call TriggerSleepAction(2.)
  
  if ( not LoadBoolean(udg_hash, 42, StringHash("Man-Make")) ) then
    call SaveBoolean(udg_hash, 42, StringHash("Man-Make"), true)
    call DisableTrigger(gg_trg_Quest_05_D6_Make)
    call TriggerSleepAction(.1)
  endif
    
  set udg_temp_g = CreateGroup()
  loop
    exitwhen loopA > 12
    if ( Dis(udg_Unit[P], udg_Unit[loopA]) < 1000. ) then
      call GroupAddUnit(udg_temp_g, udg_Unit[loopA])
    endif
    set loopA = loopA + 1
  endloop
  
  loop
    exitwhen FirstOfGroup(udg_temp_g) == null
    set loopA = GetPlayerId(GetOwningPlayer(FirstOfGroup(udg_temp_g)))+1
    call SetUnitPosition(udg_Unit[loopA], 16128., -9440.)
    call PauseUnit(udg_Unit[loopA], false)
    call SetCameraXY(Player(loopA-1), 16128., -9440.)
    set udg_OnesPositionN[loopA] = 187
    call GroupRemoveUnit(udg_temp_g, udg_Unit[loopA])
  endloop
  call DestroyGroup(udg_temp_g)

  call TriggerSleepAction(1.)
  call StartSound(gg_snd_FacelessOneYes1)
  call TriggerSleepAction(1.)
  call StartSound(gg_snd_FacelessOneYes1)
  call SaveDestructableHandle(udg_hash, 42, StringHash("Man-Doo"), CreateDestructable('B002', 16384, -9856, bj_UNIT_FACING, 1, 0))
  call SaveDestructableHandle(udg_hash, 42, StringHash("Man-Doo2"), CreateDestructable('B000', 16384, -9984, bj_UNIT_FACING, 2, GetRandomInt(1,10)))
  call SetDestructableInvulnerable(LoadDestructableHandle(udg_hash, 42, StringHash("Man-Doo2")), true)
  set bj_lastCreatedUnit = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'n01M', 15456, -8672, 320)
  call TriggerRegisterUnitEvent( gg_trg_Quest_05_E2_Kill, bj_lastCreatedUnit, EVENT_UNIT_DEATH )
  call TriggerRegisterUnitEvent( gg_trg_Quest_05_E3_DmgSave, bj_lastCreatedUnit, EVENT_UNIT_DAMAGED )
  set udg_temp_r = udg_PartyNumber_pP[udg_PartyNumber_ThisP[P]]
  call SaveReal(udg_hash, GetHandleId(bj_lastCreatedUnit), 2, udg_temp_r*GetRandomReal(.2,.3))
  call SetUS("Hp", bj_lastCreatedUnit, R2I(GetWidgetLife(bj_lastCreatedUnit)*(1.+LoadReal(udg_hash, GetHandleId(bj_lastCreatedUnit), 2))), true)
  call SetUS("DMG", bj_lastCreatedUnit, -125+R2I(udg_temp_r*50), true)
  call SetUS2("Miss", bj_lastCreatedUnit, udg_temp_r*5.)
  call SetUS2("CriP", bj_lastCreatedUnit, 15.+udg_temp_r*10)
  call SetUS2("CriX", bj_lastCreatedUnit, .5+udg_temp_r*0.25)
  call SetUS2("Bash", bj_lastCreatedUnit, 500+udg_temp_r*250)
  call SetUnitUserData(bj_lastCreatedUnit, -1)
  set udg_temp_r = 0
  call EnableTrigger(gg_trg_Quest_05_D6_Make)
endfunction
function Trig_Quest_05_D6_Make_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetEnteringUnit()))+1
  if ( P == udg_PartyNumber_ThisP[P] ) and ( not LoadBoolean(udg_hash, 42, StringHash("Man-Make")) ) then
    call SetUnitX(GetTriggerUnit(), GetUnitX(GetTriggerUnit()) + 64.)
    call IssueImmediateOrder(GetTriggerUnit(), "stop")
    call PauseUnit(GetTriggerUnit(), true)
    call MSG(Player(P-1), 1, 3., "파티원들 모두 준비가 되셨습니까?")
    call TriggerSleepAction(.5)
    set udg_temp_d = DialogCreate()
    call DialogSetMessage(udg_temp_d, "|cffffdc3c준비가 모두 되셨습니까?|r")
    set udg_temp_trg = CreateTrigger()
    call TriggerRegisterDialogButtonEvent(udg_temp_trg, DialogAddButton(udg_temp_d, "네, 준비되었습니다.", 0))
    call TriggerAddAction(udg_temp_trg, function Maintice_OK)
    call TriggerRegisterDialogButtonEvent(CreateTrigger(), DialogAddButton(udg_temp_d, "아직 준비가 덜 되었습니다.", 0))
    call DialogDisplay(Player(P-1), udg_temp_d, true)
    call TriggerSleepAction(10.)
    call DialogDisplay(Player(P-1), udg_temp_d, false)
  else
    call MSG(Player(P-1), 1, 3., "준비가 다 되면 파티장이 이동할 수 있습니다. :: " + GetUnitName(GetTriggerUnit()))
    call SetUnitX(GetTriggerUnit(), GetUnitX(GetTriggerUnit()) + 360.)
    call IssueImmediateOrder(GetTriggerUnit(), "stop")
  endif
endfunction

//===========================================================================
function InitTrig_Quest_05_D6_Make takes nothing returns nothing
    set gg_trg_Quest_05_D6_Make = CreateTrigger(  )
    call TriggerRegisterEnterRectSimple( gg_trg_Quest_05_D6_Make, gg_rct_Quest05_Mantice_4 )
    call TriggerAddCondition( gg_trg_Quest_05_D6_Make, Condition( function Trig_Quest_05_D6_Make_Conditions ) )
    call TriggerAddAction( gg_trg_Quest_05_D6_Make, function Trig_Quest_05_D6_Make_Actions )
endfunction

//===========================================================================
// Trigger: Quest 05 E2 Kill
//
// 8672, 10272
//===========================================================================
function CheckTrap takes nothing returns boolean
    return ( GetUnitTypeId(GetFilterUnit()) == 'n02V' )
endfunction

function TrapRemove takes nothing returns nothing
    call RemoveUnit( GetEnumUnit() )
endfunction

function RangeUnit takes nothing returns boolean
 return ( isHero(GetFilterUnit()) and GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1 == udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] )
endfunction

function ManticeResult takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetEnumUnit()))+1
  if ( P == udg_PartyNumber_ThisP[P] ) then
    call SetUnitPosition(GetEnumUnit(), 14144., -9600.)
    set udg_Unit[0] = GetEnumUnit()
  else
    call SetUnitPosition(GetEnumUnit(), GetRandomReal(14272.,14432.), GetRandomReal(-9792,-9408))
  endif
  set udg_OnesPositionN[P] = 187
  call MSG(Player(P-1), 5, 7, "자이언트 맨티스 방 - 지하")
  call SetCameraXY(Player(P-1), GetWidgetX(GetEnumUnit()), GetWidgetY(GetEnumUnit()))
  call SetUserControlForceOff( GetForceOfPlayer(GetOwningPlayer(GetEnumUnit())) )
  call IssueImmediateOrder( GetEnumUnit(), "stop" )
  call ForceAddPlayerSimple(GetOwningPlayer(GetEnumUnit()), udg_Quest_Force_05)
  call Quest_End(P, 5, false)
  call SetEffiectLocal(P, gg_unit_n02P_0193, 6)
  call SetEffiectLocal(P, gg_unit_u002_0192, 6)
endfunction

function Trig_Quest_05_E2_Kill_Actions takes nothing returns nothing
    call DestroyTrigger( gg_trg_Quest_05_D1 )
    call DestroyTrigger( gg_trg_Quest_05_D2 )
    call DestroyTrigger( gg_trg_Quest_05_D3_Check )
    call DestroyTrigger( gg_trg_Quest_05_D4_Makes )
    call DestroyTrigger( gg_trg_Quest_05_D5_Wait )
    call DestroyTrigger( gg_trg_Quest_05_D6_Make )
    call DestroyTrigger( GetTriggeringTrigger() )
    call DestroyTrigger( gg_trg_Quest_05_E3_DmgSave )
    call DestroyTrigger( gg_trg_Quest_05_F_Attacked )
    
    call RemoveDestructable(LoadDestructableHandle(udg_hash, 42, StringHash("Man-Doo")))
    call RemoveDestructable(LoadDestructableHandle(udg_hash, 42, StringHash("Man-Doo2")))
    
    call MSGAll(0, true, 1, 2, 10., "|c00d962b5＊|cffffdc3c" + udg_PartyTitle[udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1]] + "|cffffdc3c 파티가 자이언트 맨티스를 잡았습니다!|r")
    set udg_temp_g = GetUnitsInRectMatching(bj_mapInitialPlayableArea, Condition(function CheckTrap))
    call ForGroup(udg_temp_g, function TrapRemove)
    call DestroyGroup( udg_temp_g )
    call TriggerSleepAction(5.)
    
    set udg_temp_g = GetUnitsInRectMatching(gg_rct_Quest05_Mantice_4, Condition(function RangeUnit))
    set bj_groupRandomConsidered = 0
    set bj_groupRandomCurrentPick = GetKillingUnit()
    call ForGroup(udg_temp_g, function GroupPickRandomUnitEnum)
    set udg_Unit[0] = bj_groupRandomCurrentPick
    set udg_Unit[13] = gg_unit_h00I_0201
    call ForceClear(udg_Quest_Force_05)
    call ForGroupBJ(udg_temp_g, function ManticeResult)
    call DestroyGroup(udg_temp_g)
    call TriggerSleepAction(2.)
    call TriggerExecute( gg_trg_Quest_05_E4_Cinema )
endfunction

//===========================================================================
function InitTrig_Quest_05_E2_Kill takes nothing returns nothing
    set gg_trg_Quest_05_E2_Kill = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Quest_05_E2_Kill, function Trig_Quest_05_E2_Kill_Actions )
endfunction

//===========================================================================
// Trigger: Quest 05 E3 DmgSave
//===========================================================================
function Trig_Quest_05_E3_DmgSave_Conditions takes nothing returns boolean
    if ( not ( GetEventDamage() > 1.00 ) ) then
        return false
    endif
    return true
endfunction

function Trig_Quest_05_E3_DmgSave_Actions takes nothing returns nothing
    local integer P = GetPlayerId(GetOwningPlayer(GetEventDamageSource()))+1
      call SaveReal(udg_hash, P, 42, LoadReal(udg_hash, P, 42) + GetEventDamage() )
    set P = 0
endfunction

//===========================================================================
function InitTrig_Quest_05_E3_DmgSave takes nothing returns nothing
    set gg_trg_Quest_05_E3_DmgSave = CreateTrigger(  )
    call TriggerAddCondition( gg_trg_Quest_05_E3_DmgSave, Condition( function Trig_Quest_05_E3_DmgSave_Conditions ) )
    call TriggerAddAction( gg_trg_Quest_05_E3_DmgSave, function Trig_Quest_05_E3_DmgSave_Actions )
endfunction

//===========================================================================
// Trigger: Quest 05 E4 Cinema
//===========================================================================
function Trig_Quest_05_E4_Cinema_Func008A takes nothing returns nothing
    call CameraSetupApplyForPlayer( true, gg_cam_Camera_001, GetEnumPlayer(), 2.00 )
    call MSG(GetEnumPlayer(), 1, 9., "※참고! |rESC|cffffdc3c를 눌러도 동영상이 스킵되지 않습니다. 가만히 기다려 주세요.")
endfunction

function Trig_Quest_05_E4_Cinema_Func016A takes nothing returns nothing
    call CameraSetupApplyForPlayer( true, gg_cam_Camera_001, GetEnumPlayer(), 2.00 )
endfunction

function Trig_Quest_05_E4_Cinema_Func027A takes nothing returns nothing
    call CameraSetupApplyForPlayer( true, gg_cam_Camera_001, GetEnumPlayer(), 2.00 )
endfunction

function Trig_Quest_05_E4_Cinema_Func031A takes nothing returns nothing
    call MSG(GetEnumPlayer(), 14, 9., "＊|cffffdc3c보상＞|c00ffff80＞잡혀온 남자가 세줄금반지를 주었다!")
endfunction

function Trig_Quest_05_E4_Cinema_Func056A takes nothing returns nothing
    call IssuePointOrderLocBJ( udg_Unit[GetConvertedPlayerId(GetEnumPlayer())], "move", udg_temp_l )
endfunction

function Trig_Quest_05_E4_Cinema_Func062A takes nothing returns nothing
    call SetUnitPosition(udg_Unit[GetPlayerId(GetEnumPlayer())+1], 13696, -9664)
    call SetCameraXY(GetEnumPlayer(), 6976, -7328)
endfunction

function Trig_Quest_05_E4_Cinema_Func066A takes nothing returns nothing
    call Quest_End(GetPlayerId(GetEnumPlayer())+1, 5, false)
    call MakeTestt(GetPlayerId(GetEnumPlayer())+1, true, 20000)
    call MakeTestt(GetPlayerId(GetEnumPlayer())+1, false, 250000)
    call GiveItem(GetPlayerId(GetEnumPlayer())+1, 'I06E', 0)
    call DisplayTimedTextToPlayer( GetEnumPlayer(), 0.50, 0, 9.00, "TRIGSTR_2351" )
    call ResetToGameCameraForPlayer( GetEnumPlayer(), 0 )
    call SetCameraFieldForPlayer( GetEnumPlayer(), CAMERA_FIELD_TARGET_DISTANCE, RMaxBJ(bj_CAMERA_DEFAULT_DISTANCE, LoadRealBJ(56, GetConvertedPlayerId(GetEnumPlayer()), udg_hash)), 0.00 )
endfunction

function Trig_Quest_05_E4_Cinema_Actions takes nothing returns nothing
    call DestroyTrigger( GetTriggeringTrigger() )
    // Set
    call SetUserControlForceOff( udg_Quest_Force_05 )
    call ForceCinematicSubtitlesBJ( true )
    call CinematicModeBJ( true, udg_Quest_Force_05 )
    call ShowInterfaceForceOff( udg_Quest_Force_05, 2 )
    call EnableOcclusionBJ( true, udg_Quest_Force_05 )
    call ForForce( udg_Quest_Force_05, function Trig_Quest_05_E4_Cinema_Func008A )
    call TriggerSleepAction( 2.00 )
    // Action
    call TransmissionFromUnitWithNameBJ( udg_Quest_Force_05, udg_Unit[0], "TRIGSTR_1023", null, "TRIGSTR_1313", bj_TIMETYPE_ADD, 3.00, true )
    call IssuePointOrderLocBJ( udg_Unit[0], "move", Location(7168.00, 9856.00) )
    call IssuePointOrder(udg_Unit[0], "move", 13984, -9568)
    call TriggerSleepAction( 1.00 )
    call TransmissionFromUnitWithNameBJ( udg_Quest_Force_05, udg_Unit[0], "TRIGSTR_2322", null, "TRIGSTR_2323", bj_TIMETYPE_ADD, 0.00, false )
    call ForForce( udg_Quest_Force_05, function Trig_Quest_05_E4_Cinema_Func016A )
    call TriggerSleepAction( 3.00 )
    call TransmissionFromUnitWithNameBJ( udg_Quest_Force_05, udg_Unit[13], "TRIGSTR_2324", null, "TRIGSTR_2325", bj_TIMETYPE_ADD, 0.00, false )
    call TriggerSleepAction( 1.00 )
    call TransmissionFromUnitWithNameBJ( udg_Quest_Force_05, udg_Unit[13], "TRIGSTR_2326", null, "TRIGSTR_2327", bj_TIMETYPE_ADD, 0.00, false )
    call TriggerSleepAction( 1.50 )
    call TransmissionFromUnitWithNameBJ( udg_Quest_Force_05, udg_Unit[13], "TRIGSTR_2328", null, "TRIGSTR_2329", bj_TIMETYPE_ADD, 0.00, false )
    call TriggerSleepAction( 3.00 )
    call TransmissionFromUnitWithNameBJ( udg_Quest_Force_05, udg_Unit[13], "TRIGSTR_2330", null, "TRIGSTR_2331", bj_TIMETYPE_ADD, 0.00, false )
    call TriggerSleepAction( 4.00 )
    call TransmissionFromUnitWithNameBJ( udg_Quest_Force_05, udg_Unit[0], "TRIGSTR_2332", null, "TRIGSTR_2333", bj_TIMETYPE_ADD, 0.00, false )
    call ForForce( udg_Quest_Force_05, function Trig_Quest_05_E4_Cinema_Func027A )
    call TriggerSleepAction( 3.00 )
    call TransmissionFromUnitWithNameBJ( udg_Quest_Force_05, udg_Unit[13], "TRIGSTR_2334", null, "TRIGSTR_2335", bj_TIMETYPE_ADD, 0.00, false )
    call TriggerSleepAction( 0.50 )
    call ForForce( udg_Quest_Force_05, function Trig_Quest_05_E4_Cinema_Func031A )
    call TriggerSleepAction( 3.50 )
    call TransmissionFromUnitWithNameBJ( udg_Quest_Force_05, udg_Unit[0], "TRIGSTR_2337", null, "TRIGSTR_2338", bj_TIMETYPE_ADD, 0.00, false )
    call TriggerSleepAction( 3.00 )
    call TransmissionFromUnitWithNameBJ( udg_Quest_Force_05, udg_Unit[13], "TRIGSTR_2339", null, "TRIGSTR_2340", bj_TIMETYPE_ADD, 0.00, false )
    call TriggerSleepAction( 2.00 )
    call IssuePointOrder(udg_Unit[13], "move", 13696, -9664)
    call TriggerSleepAction( 2.00 )
    call TransmissionFromUnitWithNameBJ( udg_Quest_Force_05, udg_Unit[13], "TRIGSTR_2341", null, "TRIGSTR_2342", bj_TIMETYPE_ADD, 0.00, false )
    call TriggerSleepAction( 0.50 )
    call SetUnitAnimation( udg_Unit[13], "stand, 4" )
    call TriggerSleepAction( 2.00 )
    call TransmissionFromUnitWithNameBJ( udg_Quest_Force_05, udg_Unit[13], "TRIGSTR_2343", null, "TRIGSTR_2344", bj_TIMETYPE_ADD, 0.00, false )
    call TriggerSleepAction( 0.50 )
    call SetUnitAnimationByIndex( udg_Unit[13], 3 )
    call TriggerSleepAction( 1.00 )
    call TransmissionFromUnitWithNameBJ( udg_Quest_Force_05, udg_Unit[0], "TRIGSTR_2345", null, "TRIGSTR_2346", bj_TIMETYPE_ADD, 0.00, false )
    call TriggerSleepAction( 2.00 )
    call TransmissionFromUnitWithNameBJ( udg_Quest_Force_05, udg_Unit[13], "TRIGSTR_2347", null, "TRIGSTR_2348", bj_TIMETYPE_ADD, 0.00, false )
    call SetUnitAnimation( udg_Unit[13], "death" )
    call TriggerSleepAction( 2.00 )
    call TransmissionFromUnitWithNameBJ( udg_Quest_Force_05, udg_Unit[0], "TRIGSTR_2349", null, "TRIGSTR_2350", bj_TIMETYPE_ADD, 0.00, false )
    call TriggerSleepAction( 1.00 )
    call PauseUnitBJ( true, gg_unit_h00I_0201 )
    set udg_temp_l = GetUnitLoc(udg_Unit[13])
    call ForForce( udg_Quest_Force_05, function Trig_Quest_05_E4_Cinema_Func056A )
    call RemoveLocation( udg_temp_l )
    call CinematicFilterGenericBJ( 3.00, BLEND_MODE_BLEND, "ReplaceableTextures\\CameraMasks\\White_mask.blp", 0.00, 0.00, 0.00, 100.00, 0.00, 0.00, 0.00, 5.00 )
    call TriggerSleepAction( 3.00 )
    call CinematicFilterGenericBJ( 2.00, BLEND_MODE_BLEND, "ReplaceableTextures\\CameraMasks\\White_mask.blp", 0.00, 0.00, 0.00, 5.00, 0, 0, 0, 100.00 )
    call ClearTextMessagesBJ( udg_Quest_Force_05 )
    call ForForce( udg_Quest_Force_05, function Trig_Quest_05_E4_Cinema_Func062A )
    // Reset
    call SetUnitPosition(udg_Unit[13], 6368, -6816)
    call TriggerSleepAction( 2.00 )
    call ForForce( udg_Quest_Force_05, function Trig_Quest_05_E4_Cinema_Func066A )
    call TriggerSleepAction( 0.50 )
    set udg_Unit[0] = null
    set udg_Unit[13] = null
    call SetUserControlForceOn( udg_Quest_Force_05 )
    call EnableOcclusionBJ( false, udg_Quest_Force_05 )
    call CinematicModeBJ( false, udg_Quest_Force_05 )
    call ShowInterfaceForceOn( udg_Quest_Force_05, 2 )
    call TriggerSleepAction( 5.00 )
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = 12
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        if ( LoadReal(udg_hash, bj_forLoopAIndex, 42) > 0 ) then
        call MSGAll(0,true,1,2,10.,SysStr(2,bj_forLoopAIndex)+udg_SysB_Name[bj_forLoopAIndex]+"|cffffdc3c("+SysStr(2,bj_forLoopAIndex)+GetUnitName(udg_Unit[bj_forLoopAIndex])+"|cffffdc3c)-"+I2S(R2I(LoadReal(udg_hash,bj_forLoopAIndex,42)))+"|cffffdc3c데미지")
        call SaveReal(udg_hash, bj_forLoopAIndex, 42, 0)
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    call ForceClear( udg_Quest_Force_05 )
endfunction

//===========================================================================
function InitTrig_Quest_05_E4_Cinema takes nothing returns nothing
    set gg_trg_Quest_05_E4_Cinema = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Quest_05_E4_Cinema, function Trig_Quest_05_E4_Cinema_Actions )
endfunction

//===========================================================================
// Trigger: Quest 05 F Attacked
//===========================================================================
function Trig_Quest_05_F_Attacked_Conditions takes nothing returns boolean
 return ( GetUnitTypeId(GetAttacker()) == 'n02V' ) and ( not IsUnitPaused(GetTriggerUnit()) )
endfunction

function Trig_Quest_05_F_Attacked_Actions takes nothing returns nothing
  if ( GetUnitState(GetAttacker(), UNIT_STATE_MANA) != GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1 ) then
    call SetUnitState(GetAttacker(), UNIT_STATE_MANA, I2R(GetPlayerId(GetOwningPlayer(GetTriggerUnit())))+1)
    if ( GetUnitState(GetTriggerUnit(),UNIT_STATE_MANA) < 1. ) then
      call Coma(GetTriggerUnit(), 15, 10.)
    elseif ( GetUnitState(GetTriggerUnit(),UNIT_STATE_MANA) < GetUnitState(GetTriggerUnit(),UNIT_STATE_MAX_MANA)*.15 ) then
      call Coma(GetTriggerUnit(), 15, 4.)
    else
      call Coma(GetTriggerUnit(), 15, 2.)
    endif
  else
    call IssueImmediateOrder( GetAttacker(), "stop" )
  endif
endfunction

//===========================================================================
function InitTrig_Quest_05_F_Attacked takes nothing returns nothing
    set gg_trg_Quest_05_F_Attacked = CreateTrigger(  )
    call TriggerAddCondition( gg_trg_Quest_05_F_Attacked, Condition( function Trig_Quest_05_F_Attacked_Conditions ) )
    call TriggerAddAction( gg_trg_Quest_05_F_Attacked, function Trig_Quest_05_F_Attacked_Actions )
endfunction

//===========================================================================
// Trigger: Quest 06
//===========================================================================
function Quest06 takes unit user returns nothing
 local integer keyitem = 'I006'
 local integer P = GetPlayerId(GetOwningPlayer(user))+1
  if ( Quest_Level(P, 6) == -1 ) then
    call QMsg(P, 0, "젊은 촌장", "자네가 도와준 덕분에 요즘 살 맛이 난다네!", 1.)
  elseif ( Quest_Level(P, 6) == 0 ) then
    if ( 6 > GetHeroLevel(user) ) then
      call QMsg(P, 0, "젊은 촌장", "굴에 들어갈만한 인원을 찾고 있는데... [레벨제한 6~]", 0)
    else
      if ( udg_PartyNumber_ThisP[P] == 0 ) then
        call QMsg(P, 0, "젊은 촌장", "혼자인가? 부탁하기 어렵겠군.. [파티가 필요합니다]", 0)
      else
        call Quest_Start(P, 6, true)
        call QMsg(P, 0, "플레이어", "안녕하세요?", 1.)
        call QMsg(P, 0, "젊은 촌장", "반갑소, 부족하나마 밀레스를 책임지고 있소.", 1.)
        call QMsg(P, 0, "플레이어", "그러시군요.", 1.)
        call QMsg(P, 0, "젊은 촌장", "그런데, 요즘 우리 마을에 새로운 골치거리가 하나 생겼네.", 1.)
        call QMsg(P, 0, "플레이어", "무엇 때문이죠?", 1.)
        call QMsg(P, 0, "젊은 촌장", "후우...", 1.)
        call QMsg(P, 0, "젊은 촌장", "들어는 봤을지 모르겠지만, 큐르페이라고 하는녀석이네", 1.)
        call QMsg(P, 0, "젊은 촌장", "동굴에 사는 전갈 괴물인데.. 걱정이 이만저만이 아니야.", 1.)
        call QMsg(P, 0, "젊은 촌장", "그래, 날 도와 주겠는가? 미리말해두겠지만 쉽지는 않을걸세.", 1.)
        call QMsg(P, 0, "플레이어", "|c008bc7fc(큐르페이 정도야 뭐 쉽겠지.)", 1.)
        call QMsg(P, 0, "젊은 촌장", "고맙군. 자네만 믿겠네.\n　사람들이 마을 입구에서 습격을 당했다고 하니, 그 쪽에 가 보게.", 1.)
        call QMsg(P, 0, "젊은 촌장", "아, 그리고 잡고 나서는 죽였다는 증표로 그놈의 시체 조각을 가져오게나", .5)
        call QMsg(P, 0, "1", "큐르페이 굴에 가서 큐르페이를 잡아 돌아오자.|r\n　Tip: 파티원과 같이 잡는게 좋다.", 1.)
        call EnableTrigger(gg_trg_Quest_06_B)
      endif
    endif
  elseif ( Quest_Level(P, 6) >= 1 ) then
    if ( not MinusItem(P, keyitem, 1) ) then
      if ( Quest_Level(P, 6) == 1 ) then
        call QMsg(P, 0, "젊은 촌장", "내가 말 안했던가? 잡고 나서는 죽였다는 증표를 구해오게.", 0)
      else
        call QMsg(P, 0, "젊은 촌장", "흠. 또 도와주려는건가? 그럼 다녀오게나.", 0)
      endif
    else
      call Quest_Start(P, 6, false)
      call QMsg(P, 0, "젊은 촌장", "음, 어떻게 되었나?.", 1.)
      call QMsg(P, 0, "플레이어", "여기, 그녀석의 시체조각이 있습니다.", 1.)
      call QMsg(P, 0, "젊은 촌장", "음. 이건 의심할 여지가 없는 큐르페이군.", 1.)
      call QMsg(P, 0, "젊은 촌장", "좋아, 우리마을을 위해 도움을 준 당신에게 사의를 표하네..", 1.)
      call QMsg(P, 0, "플레이어", "별 말씀을요, 당연히 해야할 일을 한 것 뿐입니다.", 1.)
      call QMsg(P, 0, "젊은 촌장", "그렇게 말해주니 고맙군", .5)
      if ( Quest_Level(P, 6) == 2 ) then
        call MakeTestt(P, true, 1000)
        call MakeTestt(P, false, 10500)
        call QMsg(P, 0, "2", "촌장을 도와주고 1,000G와 경험치를 10,500 얻었다!", 1.)
        call Quest_End(P, 6, true)
        call QMsg(P, 0, "젊은 촌장", "음.. 한번쯤 또 와주면 좋겠네.", 1.)
      else
        call GiveItem(P, 'I060', (GetRandomInt(5,14)*5)+1)
        call QMsg(P, 0, "2", "＊|cffffdc3c특별보상＞|c00ffff80＞촌장이 고맙다며 특별히 금벨트를 주었다!", 1.)
        call Quest_End(P, 6, false)
        call QMsg(P, 0, "젊은 촌장", "이제 그만 도와주어도 되네, 고맙네.", 1.)
      endif
    endif
  endif
  call Quest_End2(P)
endfunction
function Trig_Quest_06_Actions takes nothing returns nothing
  call Quest06(GetAttacker())
endfunction

//===========================================================================
function InitTrig_Quest_06 takes nothing returns nothing
  set gg_trg_Quest_06 = CreateTrigger(  )
  call TriggerRegisterUnitEvent(gg_trg_Quest_06, gg_unit_n02S_0195, EVENT_UNIT_ATTACKED)
  call TriggerAddAction( gg_trg_Quest_06, function Trig_Quest_06_Actions )
endfunction

//===========================================================================
// Trigger: Quest 06 B
//===========================================================================
function Quest06_Condi takes nothing returns boolean
  return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1, 6) >= 1 ) and ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] == udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1] )
endfunction
function Quest06_Action takes nothing returns nothing
  if ( CountItem(GetPlayerId(GetOwningPlayer(GetEnumUnit()))+1, 'I006') > 0 ) then
    call MSG(GetOwningPlayer(GetEnumUnit()), 1, 4., "더 이상 잡을 필요가 없습니다.")
  elseif ( GetRandomReal(0.,100.) <= 33. ) then
    call GiveItem(GetPlayerId(GetOwningPlayer(GetEnumUnit()))+1, 'I006', 1)
    call MSG(GetOwningPlayer(GetEnumUnit()), 1, 6., "큐르페이를 잡고, 시체조각을 조금 챙겼습니다.")
  endif
endfunction
function Trig_Quest_06_C_Actions takes nothing returns nothing
  set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), 1100., Condition(function Quest06_Condi))
  call ForGroup(udg_temp_g, function Quest06_Action)
  call DestroyGroup( udg_temp_g )
endfunction

//===========================================================================
function InitTrig_Quest_06_B takes nothing returns nothing
    set gg_trg_Quest_06_B = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Quest_06_B, function Trig_Quest_06_C_Actions )
endfunction

//===========================================================================
// Trigger: Quest 07
//
// set bj_lastCreatedUnit = CreateUnitAtLoc( Player(PLAYER_NEUTRAL_AGGRESSIVE), 'e00B', GetUnitLoc(GetAttacker()), bj_UNIT_FACING )
// gg_unit_n02T_0204
// gg_unit_hfoo_0202
// gg_unit_hhes_0203
//===========================================================================
function Quest07Condi takes nothing returns boolean
    return ( GetUnitTypeId(GetFilterUnit()) == 'n02O' )
endfunction

constant function Quest07CheckUnit takes integer QLv returns unit
  if ( QLv <= 3 ) or ( QLv >= 12 ) then
    return gg_unit_n02T_0204
  elseif ( QLv <= 7 ) then
    return gg_unit_hfoo_0202
  elseif ( QLv <= 11 ) then
    return gg_unit_hhes_0203
  endif
 return null
endfunction

function Quest07 takes unit user, unit NPC returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(user))+1
  if ( Quest_Level(P, 7) == -1 ) then
    if ( NPC == gg_unit_n02T_0204 ) then
      call QMsg(P, 0, "뤼케시온 촌장", "도와줘서 정말 고맙네! 덕분에 우리마을은 나날이 번창중이야!", 0)
    elseif ( NPC == gg_unit_hfoo_0202 ) then
      call QMsg(P, 0, "경비병", "킹 아크퍼스를 쓰러뜨리셨다니! 모험자님은 정말 대단하시군요!", 0)
    elseif ( NPC == gg_unit_hhes_0203 ) then
      call QMsg(P, 0, "경비대장", "킹 아크퍼스를 잡았다고? 대단하군. 놀라워.", 0)
    endif
  elseif ( Quest_Level(P, 7) != 0 ) and ( Quest07CheckUnit(Quest_Level(P, 7)) != NPC ) then
    if ( NPC == gg_unit_hfoo_0202 ) then
      call QMsg(P, 0, "경비병", GetUnitName(Quest07CheckUnit(Quest_Level(P, 7)))+"님은 찾아가보셨나요?", 0)
    elseif ( Quest07CheckUnit(Quest_Level(P, 7)) == Quest07CheckUnit(0) ) then
      call QMsg(P, 0, GetUnitName(NPC), GetUnitName(Quest07CheckUnit(Quest_Level(P, 7)))+"님을 찾아가보게나", 0)
    else
      call QMsg(P, 0, GetUnitName(NPC), GetUnitName(Quest07CheckUnit(Quest_Level(P, 7)))+"을 찾아가보게나", 0)
    endif
  elseif ( Quest_Level(P, 7) == 0 ) then
    if ( 41 > GetHeroLevel(user) ) then
      call QMsg(P, 0, GetUnitName(NPC), "결계에 맞는 인원이 필요한데... [퀘스트 레벨제한 41~]", 0)
    else
      if ( udg_PartyNumber_ThisP[P] == 0 ) then
        call QMsg(P, 0, GetUnitName(NPC), "혼자인가? 부탁하기 어렵겠군.. [파티가 필요합니다]", 0)
      else
        set udg_Quest_ClearInt_07[P] = 0
        call Quest_Start(P, 7, true)
        call QMsg(P, 0, "뤼케시온 촌장", "음......", 1.)
        call QMsg(P, 0, "뤼케시온 촌장", "당신은... 그래,", 1.)
        call QMsg(P, 0, "뤼케시온 촌장", "밀레스 촌장에게서 들었던 그 모험자시군.. 많이 강해지셨구려..", 1.)
        call QMsg(P, 0, "플레이어", "당신은.. 무슨 걱정이 있어보이시는군요.", 1.)
        call QMsg(P, 0, "뤼케시온 촌장", "휴우우....", 1.)
        call QMsg(P, 0, "뤼케시온 촌장", "어찌된 일인지.. 해안가에 몬스터가 자꾸만 늘고 있네...", 1.)
        call QMsg(P, 0, "뤼케시온 촌장", "우리마을을 도와줄 수 있겠나? 이대로 해안가를 포기할 순 없네.", 1.)
        call QMsg(P, 0, "플레이어", "|c008bc7fc(흠..해안가 몬스터라..)", 1.)
        call QMsg(P, 0, "플레이어", "걱정하지 마십시오.", 1.)
        call QMsg(P, 0, "뤼케시온 촌장", "좋아, 든든하군. 하지만 조심하게나.", 1.)
        call QMsg(P, 0, "1", "촌장을 위해, |c009f9f9f해안가|c00ffff80에서 몬스터를 퇴치하자.\n자세한건 |cffc3dbff\"-퀘스트\"|cffffdc3c를 입력.", 1.)
        call Ping(Player(P-1), GetRectCenterX(gg_rct_Effect_08_Nanpa), GetRectCenterY(gg_rct_Effect_08_Nanpa), 7.)
        call EnableTrigger(gg_trg_Quest_07_B)
      endif
    endif
  elseif ( Quest_Level(P, 7) <= 3 ) then
    if ( udg_Quest_ClearInt_07[P] < 15 ) then
      call QMsg(P, 0, "뤼케시온 촌장", "15마리정도는 잡아야 해안가가 깨끗해질걸세..", 0)
    else
      call Quest_Start(P, 7, false)
      call QMsg(P, 0, "뤼케시온 촌장", "잘 처리했나?", 1.)
      call QMsg(P, 0, "플레이어", "물론입니다. 당분간은 코빼기도 안보일겁니다.", 1.)
      call QMsg(P, 0, "뤼케시온 촌장", "수고했네, 그럼...", 1.)
      //1,2 회 - 경험치, 3회 - 남은거 모두 소진+추가보상
      if ( Quest_Level(P, 7) <= 3 ) then
        set udg_Quest_ClearInt_07[P] = udg_Quest_ClearInt_07[P] - 15
        call MakeTestt(P, true, 1500)
        call MakeTestt(P, false, 45000)
        call QMsg(P, 0, "2", "뤼케시온 촌장을 도와주고 1,500G와 경험치를 45,000 얻었다!", 2.)
        call QMsg(P, 0, "뤼케시온 촌장", "나중에 다시 한번 도와주게.", 1.)
        call SetEffiectLocal(P, NPC, 5)
      else
        call MakeTestt(P, true, 2500)
        set udg_temp_i = 15000+IMaxBJ(0, 1500 * (udg_Quest_ClearInt_07[P]-15))
        call MakeTestt(P, false, udg_temp_i)
        set udg_Quest_ClearInt_07[P] = 0
        call GiveItem(P, 'I08V', 5)
        call QMsg(P, 0, "2", "뤼케시온 촌장을 도와주고 2,500G와 경험치를 "+FSE_Rest(udg_temp_i)+" 얻었다!\n\n|r＊|cffffdc3c특별보상＞|c00ffff80＞뤼케시온 촌장이 고맙다며 특별히 코마디움 5개를 주었다!", 2.)
        call QMsg(P, 0, "뤼케시온 촌장", "그동안 고마웠네! 당분간은 도와주지 않아도 될 듯하네. 더 도와주고 싶다면 해안가에 있는 경비병에게 가 보게나.", 1.)
        call SetEffiectLocal(P, NPC, 6)
      endif
    endif
  elseif ( Quest_Level(P, 7) == 4 ) then
    //말투: 당신, ~요
    call Quest_Start(P, 7, false)
    call QMsg(P, 0, "경비병", "뤼케시온에 오신걸 환영합니다. 어쩐 일이시죠?", 1.)
    call QMsg(P, 0, "플레이어", "촌장님이 이리로 오라고 해서 왔습니다.", 1.)
    call QMsg(P, 0, "경비병", "오, 촌장님이 말씀하신 모험자가 당신이었군요.", 1.)
    call QMsg(P, 0, "경비병", "덕분에 이 근처는 이제 싹쓸이 되었다고 볼 수 있죠...", 1.)
    call QMsg(P, 0, "플레이어", "아뇨. 당연히 했어야 할 일입니다.", 1.)
    call QMsg(P, 0, "경비병", "하지만....", 1.)
    call QMsg(P, 0, "경비병", "아직도 |c009f9f9f해안가 깊은곳|c00ffff80엔 많은 몬스터가 있죠.", 1.)
    call QMsg(P, 0, "경비병", "자, 임무입니다! |c009f9f9f해안가 깊은곳|c00ffff80에서 몬스터를 15마리 퇴치하고 오세요!", 1.)
    call QMsg(P, 0, "1", "|cffffdc3c경비병을 위해, |c009f9f9f해안가 깊은곳|cffffdc3c에서 강한 몬스터를 15마리 퇴치하자.", 1.)
    call Ping(Player(P-1), GetRectCenterX(gg_rct_Effect_08_Nanpa), GetRectCenterY(gg_rct_Effect_08_Nanpa), 7.)
  elseif ( Quest_Level(P, 7) <= 7 ) then
    if ( udg_Quest_ClearInt_07[P] < 15 ) then
      call QMsg(P, 0, "경비병", "최소 15마리는 잡아야 해안가 청소가 될 거에요.", 0)
    else
      call Quest_Start(P, 7, false)
      call QMsg(P, 0, "경비병", "어떻게 되었나요?", 1.)
      call QMsg(P, 0, "플레이어", "충분히 처리하고 왔습니다.", 1.)
      call QMsg(P, 0, "경비병", "우리마을을 위해 이렇게 도와주셔셔 감사해요.", 1.)
      if ( Quest_Level(P, 7) <= 7 ) then
        set udg_Quest_ClearInt_07[P] = udg_Quest_ClearInt_07[P] - 15
        call MakeTestt(P, true, 2000)
        call MakeTestt(P, false, 66000)
        call QMsg(P, 0, "2", "경비병을 도와주고 2,000G와 경험치를 22,000 얻었다!", 2.)
        call QMsg(P, 0, "경비병", "감사합니다. 기회가 되면 또 부탁드리고 싶어요.", 1.)
        call SetEffiectLocal(P, NPC, 5)
      else
        call MakeTestt(P, true, 4500)
        set udg_temp_i = 22000+IMaxBJ(0, 1800 * (udg_Quest_ClearInt_07[P]-15))
        call MakeTestt(P, false, udg_temp_i)
        set udg_Quest_ClearInt_07[P] = 0
        call QMsg(P, 0, "2", "경비병을 도와주고 4,500G와 경험치를 "+FSE_Rest(udg_temp_i)+" 얻었다!", 2.)
        call QMsg(P, 0, "경비병", "정말 감사해요. 무리한 부탁인건 알지만, 한번 대장님에게 찾아가보세요.", 1.)
        call SetEffiectLocal(P, NPC, 6)
      endif
    endif
  elseif ( Quest_Level(P, 7) == 8 ) then
  //경비대장, 말투: 중대장느낌으로 ~가? ~다, ~게.
    call Quest_Start(P, 7, false)
    call QMsg(P, 0, "경비대장", "무슨 일인가?", 1.)
    call QMsg(P, 0, "플레이어", "경비병의 말을 듣고 이리 왔습니다.", 1.)
    call QMsg(P, 0, "경비대장", "그래 자네였군. 얘기는 많이 들었다.", 1.)
    call QMsg(P, 0, "경비대장", "이번에 부탁할 일은 어려울지도 모르지.", 1.)
    call QMsg(P, 0, "경비대장", "하지만 우리마을을 위해서라면 꼭 해야하는 일이다.", 1.)
    call QMsg(P, 0, "경비대장", "긴 말 않겠다. 자네라면 심해 깊은곳의 몬스터도 잡을수 있으리라 본다.", 1.)
    call QMsg(P, 0, "경비대장", "지금 |c009f9f9f난파선|c00ffff80으로 내려가 몬스터를 퇴치해오게.", 1.)
    call QMsg(P, 0, "1", "|cffffdc3c경비대장을 위해, 다시 한 번 |c009f9f9f난파선|cffffdc3c에서 몬스터를 퇴치하자.", 1.)
    call Ping(Player(P-1), GetRectCenterX(gg_rct_Effect_08_Nanpa), GetRectCenterY(gg_rct_Effect_08_Nanpa), 7.)
  elseif ( Quest_Level(P, 7) <= 11 ) then
    if ( udg_Quest_ClearInt_07[P] < 15 ) then
      call QMsg(P, 0, "경비대장", "최소 15마리는 잡아야 변화가 있을거네.", 0)
    else
      call Quest_Start(P, 7, false)
      call QMsg(P, 0, "경비대장", "어찌 되었나?", 1.)
      call QMsg(P, 0, "플레이어", "그럭저럭 잘 처리하였습니다.", 1.)
      call QMsg(P, 0, "경비대장", "그래. 수고했네. 내가봐도 몬스터가 많이 줄었더군.", 1.)
      call MakeTestt(P, true, 4000)
      if ( Quest_Level(P, 7) <= 12 ) then
        set udg_Quest_ClearInt_07[P] = udg_Quest_ClearInt_07[P] - 15
        call MakeTestt(P, false, 120000)
        call QMsg(P, 0, "2", "경비대장을 도와주고 4,000G와 경험치를 120,000 얻었다!", 2.)
        call QMsg(P, 0, "경비대장", "아직 좀 부족한 것 같은데, 더 도와줄 수 있겠나?", 1.)
        call SetEffiectLocal(P, NPC, 5)
      else
        set udg_temp_i = 75000+IMaxBJ(0, 6000 * (udg_Quest_ClearInt_07[P]-15))
        call MakeTestt(P, false, udg_temp_i)
        set udg_Quest_ClearInt_07[P] = 0
        call QMsg(P, 0, "2", "경비대장을 도와주고 4,000G와 경험치를 "+FSE_Rest(udg_temp_i)+" 얻었다!", 2.)
        call QMsg(P, 0, "경비대장", "수고했다. 촌장님이 널 찾고계시니 한번 가보도록.", 1.)
        call SetEffiectLocal(P, NPC, 6)
      endif
    endif
  elseif ( Quest_Level(P, 7) == 12 ) then
    call Quest_Start(P, 7, false)
    call QMsg(P, 0, "뤼케시온 촌장", "자네가 해안가를 말끔히 청소했다는 말을 들었네, 고맙네.", 1.)
    call QMsg(P, 0, "뤼케시온 촌장", "그런데 계속해서 몬스터가 나오고 있는데... 휴우...", 1.)
    call QMsg(P, 0, "뤼케시온 촌장", "무리한 부탁인줄은 아네만....", 2.)
    call QMsg(P, 0, "플레이어", "편하게 말씀해보세요.", 1.)
    call QMsg(P, 0, "뤼케시온 촌장", "몬스터는, 문어 괴물인 킹 아크퍼스가 모으고, 소환하는 거라네.", 1.)
    call QMsg(P, 0, "뤼케시온 촌장", "마지막 부탁일세, 우리 마을을 위해.. 킹 아크퍼스를 잡아주게나...", 1.)
    set udg_temp_g = GetUnitsInRectMatching(gg_rct_Effect_08_Nanpa, Condition(function Quest07Condi))
    if ( CountUnitsInGroup(udg_temp_g) == 0 ) then
      set bj_lastCreatedUnit = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'n02O', -13184, -19328, 120.)
      set udg_temp_r = udg_PartyNumber_pP[udg_PartyNumber_ThisP[P]]
      call SaveReal(udg_hash, GetHandleId(bj_lastCreatedUnit), StringHash("BonusHP"), udg_temp_r*GetRandomReal(.3,.45))
      call SetUS("Hp", bj_lastCreatedUnit, R2I(GetWidgetLife(bj_lastCreatedUnit)*(1.+LoadReal(udg_hash, GetHandleId(bj_lastCreatedUnit), StringHash("BonusHP")))), true)
      call SetUS2("Mdmg", bj_lastCreatedUnit, 3.)
      call SetUS("DMG", bj_lastCreatedUnit, -750+R2I(udg_temp_r*300), true)
      call SetUS2("Miss", bj_lastCreatedUnit, 20.+udg_temp_r*5.)
      call SetUS2("mdf", bj_lastCreatedUnit, 5.*udg_temp_r)
      call SetUnitUserData(bj_lastCreatedUnit, -1)
      set udg_temp_r = 0
    endif
    call DestroyGroup(udg_temp_g)
    call Ping(Player(P-1), -13184, -19328, 7.)
    call QMsg(P, 0, "1", "|cffffdc3c촌장을 위해, 마지막으로 |c009f9f9f난파선|cffffdc3c에서 킹 아크퍼스를 퇴치하자.", 1.)
  elseif ( Quest_Level(P, 7) >= 13 ) then
    if ( udg_Quest_ClearInt_07[P] < 1 ) then
      call QMsg(P, 0, "뤼케시온 촌장", "무리한줄은 알지만 부탁하네..", 1.)
    else
      call Quest_Start(P, 7, false)
      call QMsg(P, 0, "뤼케시온 촌장", "잡았는가?", 1.)
      call QMsg(P, 0, "플레이어", "제 파티원들과 함께 잡고 왔습니다.", 1.)
      call QMsg(P, 0, "뤼케시온 촌장", "정말인가? 정말 고생했네!!", 1.)
      call QMsg(P, 0, "뤼케시온 촌장", "이걸로 우리마을은 다시 활발해질 수 있네!", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(그렇게 좋은가.. 고생하긴 했지..)", .5)
      call QMsg(P, 0, "뤼케시온 촌장", "가만, 당신께 이 귀중한 반지를 기꺼이 주겠네.", 1.)
      set udg_Quest_ClearInt_07[P] = 0
      call MakeTestt(P, true, 10000)
      call MakeTestt(P, false, 600000)
      call GiveItem(P, 'I06F', 0)
      call QMsg(P, 0, "2", "뤼케시온 촌장을 도와주고 10,000G와 경험치를 600,000 얻었다!\n\n＊|cffffdc3c특별보상＞|c00ffff80＞촌장이 고맙다며 특별히 세줄황금반지를 주었다! |cff46ffff(인벤토리)", 1.)
      call QMsg(P, 0, "뤼케시온 촌장", "정말 고맙네!", 1.)
      call Quest_End(P, 7, false)
    endif
  endif
  call Quest_End2(P)
endfunction

function Trig_Quest_07_Actions takes nothing returns nothing
  call Quest07(GetAttacker(), GetTriggerUnit())
endfunction

//===========================================================================
function InitTrig_Quest_07 takes nothing returns nothing
  set gg_trg_Quest_07 = CreateTrigger(  )
  call TriggerRegisterUnitEvent(gg_trg_Quest_07, gg_unit_n02T_0204, EVENT_UNIT_ATTACKED)
  call TriggerRegisterUnitEvent(gg_trg_Quest_07, gg_unit_hfoo_0202, EVENT_UNIT_ATTACKED)
  call TriggerRegisterUnitEvent(gg_trg_Quest_07, gg_unit_hhes_0203, EVENT_UNIT_ATTACKED)
  call TriggerAddAction( gg_trg_Quest_07, function Trig_Quest_07_Actions )
endfunction

//===========================================================================
// Trigger: Quest 07 B
//===========================================================================
function Quest07_Action takes nothing returns nothing
  set quest_temp_i = GetPlayerId(GetOwningPlayer(GetEnumUnit()))+1
  set udg_Quest_ClearInt_07[quest_temp_i] = udg_Quest_ClearInt_07[quest_temp_i] + 1
  if ( udg_Quest_ClearInt_07[quest_temp_i] >= 15 ) then
    if ( udg_Quest_ClearInt_07[quest_temp_i] == 15 ) or ( udg_Quest_ClearInt_07[quest_temp_i] == 45 ) then
      call MSG(Player(quest_temp_i-1), 1, 7., "이정도면 충분히 잡은것 같습니다.")
    endif
    call Bufftt(CreateTextTagUnitBJ("|cff46ffff" + I2S(udg_Quest_ClearInt_07[quest_temp_i]), GetEnumUnit(), 0, 8., 100., 100., 100., 0 ), 16)
  else
    call Bufftt(CreateTextTagUnitBJ("|cffff0000" + I2S(udg_Quest_ClearInt_07[quest_temp_i]), GetEnumUnit(), 0, 8., 100., 100., 100., 0 ), 16)
  endif
endfunction
function Quest07_Action2 takes nothing returns nothing
  set quest_temp_i = GetPlayerId(GetOwningPlayer(GetEnumUnit()))+1
  set udg_Quest_ClearInt_07[quest_temp_i] = udg_Quest_ClearInt_07[quest_temp_i] + 1
  call MSG(Player(quest_temp_i-1), 1, 7., "이정도면 충분히 잡은것 같습니다.")
  call Bufftt(CreateTextTagUnitBJ("|cff46ffff" + I2S(udg_Quest_ClearInt_07[quest_temp_i]), GetEnumUnit(), 0, 8., 100., 100., 100., 0 ), 16)
endfunction

function Quest07_Condi1 takes nothing returns boolean
  return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1, 7) <= 3 ) and ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] == udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1] )
endfunction
function Quest07_Condi2 takes nothing returns boolean
  return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1, 7) <= 7 ) and ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] == udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1] )
endfunction
function Quest07_Condi3 takes nothing returns boolean
  return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1, 7) <= 11 ) and ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] == udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1] )
endfunction
function Quest07_Condi4 takes nothing returns boolean
  return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1, 7) == 13 ) and ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] == udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1] )
endfunction

function Trig_Quest_07_C_Actions takes nothing returns nothing
  set quest_temp_i = Quest_Level(GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1, 7)
  if ( quest_temp_i <= 3 ) then
    set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), 1100., Condition(function Quest07_Condi1))
    call ForGroup(udg_temp_g, function Quest07_Action)
  elseif ( quest_temp_i <= 7 ) then
    set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), 1100., Condition(function Quest07_Condi2))
    call ForGroup(udg_temp_g, function Quest07_Action)
  elseif ( quest_temp_i <= 11 ) then
    set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), 1100., Condition(function Quest07_Condi3))
    call ForGroup(udg_temp_g, function Quest07_Action)
  elseif ( quest_temp_i == 13 ) and ( GetUnitTypeId(GetDyingUnit()) == 'n02O' ) then
    set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), 1100., Condition(function Quest07_Condi4))
    call ForGroup(udg_temp_g, function Quest07_Action2)
  endif
  call DestroyGroup(udg_temp_g)
endfunction

//===========================================================================
function InitTrig_Quest_07_B takes nothing returns nothing
  set gg_trg_Quest_07_B = CreateTrigger(  )
  call TriggerAddAction( gg_trg_Quest_07_B, function Trig_Quest_07_C_Actions )
endfunction

//===========================================================================
// Trigger: Quest 08
//===========================================================================
function Quest08 takes unit user returns nothing
 //외형: 아서스, 말투: 귀공은.. 소관은.. ~로군
 local integer P = GetPlayerId(GetOwningPlayer(user))+1
  if ( Quest_Level(P, 8) == -1 ) then
    call QMsg(P, 0, "우드랜드 지킴이", "자네, 정말 많이 성장했군. 앞으로도 지켜보겠네.", 0)
  elseif ( Quest_Level(P, 8) == 0 ) then
    if ( 41 > GetHeroLevel(user) ) then
      call QMsg(P, 0, "우드랜드 지킴이", "나를 도와줄 사람을 찾고 있는데... [레벨제한 3서클(41~)]", 0)
    else
      if ( udg_PartyNumber_ThisP[P] == 0 ) then
        call QMsg(P, 0, "우드랜드 지킴이", "혼자인가? 부탁하기 어렵겠군.. [파티가 필요합니다]", 0)
      else
        call Quest_Start(P, 8, true)
        set udg_Quest_ClearInt_08[P] = 0
        call QMsg(P, 0, "우드랜드 지킴이", "귀공은...", 1.)
        call QMsg(P, 0, "우드랜드 지킴이", "자주 보이던 그 모험자시로군..", 1.)
        call QMsg(P, 0, "플레이어", "기억해 주시는군요.", 1.)
        call QMsg(P, 0, "우드랜드 지킴이", "그런데.. 흠...", 1.)
        call QMsg(P, 0, "플레이어", "무슨 걱정거리가 있으신가요? 저에게 말해 보세요.", 1.)
        call QMsg(P, 0, "우드랜드 지킴이", "좋아, 그럼 말하지, 요즘 우드랜드에 나타나는 고블린들이 말썽이라네.", 1.)
        call QMsg(P, 0, "우드랜드 지킴이", "소관을 도와주겠는가?", 1.)
        call QMsg(P, 0, "플레이어", "|c008bc7fc(흠.. 고블린이라.. 쉽지않아 보이지만..)", 1.)
        call QMsg(P, 0, "플레이어", "걱정마세요. 저희들이 모조리 처리하겠습니다.", 1.)
        call QMsg(P, 0, "우드랜드 지킴이", "역시 소관의 눈은 틀리지 않았군, 부탁하네!", 1.)
        if ( GetUnitLevel(user) < 60 ) then
          call QMsg(P, 0, "1", "지킴이를 위해, |c009f9f9f우드랜드 중반부|c00ffff80에서 몬스터를 퇴치하자.\n자세한건 |cffc3dbff\"-퀘스트\"|cffffdc3c를 입력.", 8.)
        elseif ( GetUnitLevel(user) < 80 ) then
          call QMsg(P, 0, "1", "지킴이를 위해, |c009f9f9f우드랜드 깊은 곳|c00ffff80에서 몬스터를 퇴치하자. (60레벨 이상)", 8.)
          call SaveInteger(udg_hash, StringHash("QLevel9"), P, 2)
        else
          call QMsg(P, 0, "1", "지킴이를 위해, |c009f9f9f우드랜드 오두막|c00ffff80에서 몬스터를 퇴치하자. (80레벨 이상)", 8.)
          call SaveInteger(udg_hash, StringHash("QLevel9"), P, 3)
        endif
        call EnableTrigger(gg_trg_Quest_08_B)
      endif
    endif
  elseif ( Quest_Level(P, 8) == 1 ) then
    if ( udg_Quest_ClearInt_08[P] < 20 ) then
      call QMsg(P, 0, "우드랜드 지킴이", "이걸론 부족하네! 20마리는 잡고 돌아오게!", 0)
    else
      call Quest_Start(P, 8, false)
      call QMsg(P, 0, "우드랜드 지킴이", "역시 소관의 눈은 틀리지 않았군, 정말 잘 처리했네!", 1.)
      call QMsg(P, 0, "플레이어", "별 말씀을요.", 1.)
      call QMsg(P, 0, "우드랜드 지킴이", "덕분에 당분간은 수월할 것 같네, 고맙네.", 1.)
      if ( GetUnitLevel(user) < 60 ) then
        call SaveInteger(udg_hash, StringHash("QLevel8"), P, LoadInteger(udg_hash, StringHash("QLevel8"), P)-1)
        set udg_Quest_ClearInt_08[P] = udg_Quest_ClearInt_08[P] - 20
        call MakeTestt(P, false, 108000)
        call QMsg(P, 0, "2", "우드랜드 지킴이을 도와주고 경험치를 108,000 얻었다!", 1.)
        call QMsg(P, 0, "우드랜드 지킴이", "같은걸 도와주겠는가? 나중에, 더 강해지면 다른 부탁이 있네.", 1.)
      else
        set quest_temp_i = 108000 + IMaxBJ(0, 5000 * ( udg_Quest_ClearInt_08[P] - 20 ) )
        call MakeTestt(P, false, quest_temp_i)
        set udg_Quest_ClearInt_08[P] = 0
        call QMsg(P, 0, "2", "우드랜드 지킴이을 도와주고 경험치를 "+FSE_Rest(quest_temp_i)+" 얻었다!", 1.)
        call QMsg(P, 0, "우드랜드 지킴이", "귀공, 정말 많이 성장했군.", 1.)
        call QMsg(P, 0, "우드랜드 지킴이", "이제 숲 전반부는 귀공 덕분에 말썽이 많이 줄었네.", 1.)
        call QMsg(P, 0, "우드랜드 지킴이", "하지만 왠일인지 요즘 |c009f9f9f깊은 곳|c00ffff80들에서 말썽이 생기고 있네.", 1.)
        call QMsg(P, 0, "우드랜드 지킴이", "이제 더 깊은 곳들을 정리해주면 좋겠네.", 1.)
        call QMsg(P, 0, "1", "지킴이를 위해, |c009f9f9f우드랜드 깊은 곳|c00ffff80에서 몬스터를 퇴치하자. (60레벨 이상)", 8.)
        call Ping(Player(P-1), -10624., -3328., 7.)
      endif
    endif
  elseif ( Quest_Level(P, 8) == 2 ) then
    if ( udg_Quest_ClearInt_08[P] < 20 ) then
      call QMsg(P, 0, "우드랜드 지킴이", "|c009f9f9f깊은 곳|c00ffff80의 몬스터를 20마리정도 잡고 돌아오게!", 0)
    else
      call Quest_Start(P, 8, false)
      call SaveInteger(udg_hash, StringHash("QLevel8"), P, LoadInteger(udg_hash, StringHash("QLevel8"), P)-1)
      call QMsg(P, 0, "우드랜드 지킴이", "벌써 다 처리한 건가? 정말 대단하군.", 1.)
      call QMsg(P, 0, "플레이어", "과분하신 칭찬입니다.", 1.)
      call QMsg(P, 0, "우드랜드 지킴이", "아냐, 귀공은 정말 대단하네.", 1.)
      set quest_temp_i = 202000 + IMaxBJ(0, 12000 * ( udg_Quest_ClearInt_08[P] - 20 ) )
      call MakeTestt(P, false, quest_temp_i)
      set udg_Quest_ClearInt_08[P] = 0
      call QMsg(P, 0, "2", "우드랜드 지킴이을 도와주고 경험치를 "+FSE_Rest(quest_temp_i)+" 얻었다!", 1.)
      if ( GetUnitLevel(user) < 80 ) then
        call QMsg(P, 0, "우드랜드 지킴이", "또 도와주고 싶다면 말하게", 1.)
      else
        call QMsg(P, 0, "우드랜드 지킴이", "귀공, 어려운 부탁이 있네..", 1.)
        call QMsg(P, 0, "우드랜드 지킴이", "덕분에, 숲은 전체적으로 안정화가 되었지만..", 1.)
        call QMsg(P, 0, "우드랜드 지킴이", "하지만 아직까지 |c009f9f9f오두막 근처|c00ffff80는 엄두도 못내고 있다네.", 1.)
        call QMsg(P, 0, "우드랜드 지킴이", "어렵겠지만, 뿌리를 뽑아주었으면 좋겠네.", 1.)
        call QMsg(P, 0, "1", "지킴이를 위해, |c009f9f9f우드랜드 오두막 근처|c00ffff80에서 몬스터를 퇴치하자. (80레벨 이상)", 8.)
      endif
    endif
  elseif ( Quest_Level(P, 8) == 3 ) then
    if ( udg_Quest_ClearInt_08[P] < 20 ) then
      call QMsg(P, 0, "우드랜드 지킴이", "|c009f9f9f오두막 근처|c00ffff80의 몬스터를 20마리정도 잡고 돌아오게!", 0)
    else
      call Quest_Start(P, 8, false)
      call SaveInteger(udg_hash, StringHash("QLevel8"), P, LoadInteger(udg_hash, StringHash("QLevel8"), P)-1)
      call QMsg(P, 0, "우드랜드 지킴이", "벌써 다 처리한 건가? 정말 대단하군.", 1.)
      call QMsg(P, 0, "플레이어", "과분하신 칭찬입니다.", 1.)
      call QMsg(P, 0, "우드랜드 지킴이", "아냐, 귀공은 정말 대단하네.", 1.)
      set quest_temp_i = 600000 + IMaxBJ(0, 30000 * ( udg_Quest_ClearInt_08[P] - 20 ))
      call MakeTestt(P, false, quest_temp_i)
      set udg_Quest_ClearInt_08[P] = 0
      call QMsg(P, 0, "2", "우드랜드 지킴이을 도와주고 경험치를 "+FSE_Rest(quest_temp_i)+" 얻었다!", 1.)
      call QMsg(P, 0, "우드랜드 지킴이", "또 도와주고 싶다면 말하게", 1.)
    endif
  endif
  call Quest_End2(P)
endfunction
function Trig_Quest_08_Actions takes nothing returns nothing
  call Quest08(GetAttacker())
endfunction

//===========================================================================
function InitTrig_Quest_08 takes nothing returns nothing
    set gg_trg_Quest_08 = CreateTrigger(  )
    call TriggerRegisterUnitEvent( gg_trg_Quest_08, gg_unit_Harf_0372, EVENT_UNIT_ATTACKED )
    call TriggerAddAction( gg_trg_Quest_08, function Trig_Quest_08_Actions )
endfunction

//===========================================================================
// Trigger: Quest 08 B
//===========================================================================
function Quest08_Action takes nothing returns nothing
  set quest_temp_i = GetPlayerId(GetOwningPlayer(GetEnumUnit()))+1
  set udg_Quest_ClearInt_08[quest_temp_i] = udg_Quest_ClearInt_08[quest_temp_i] + 1
  if ( udg_Quest_ClearInt_08[quest_temp_i] >= 20 ) then
    if ( udg_Quest_ClearInt_08[quest_temp_i] == 20 ) then
      call MSG(Player(quest_temp_i-1), 1, 7., "이정도면 충분히 잡은것 같습니다.")
    endif
    call Bufftt(CreateTextTagUnitBJ("|cff46ffff" + I2S(udg_Quest_ClearInt_08[quest_temp_i]), GetEnumUnit(), 0, 8., 100., 100., 100., 0 ), 16)
  else
    call Bufftt(CreateTextTagUnitBJ("|cffff0000" + I2S(udg_Quest_ClearInt_08[quest_temp_i]), GetEnumUnit(), 0, 8., 100., 100., 100., 0 ), 16)
  endif
endfunction
function Quest08_Condi1 takes nothing returns boolean
  return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1, 8) == 1 ) and ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] == udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1] )
endfunction
function Quest08_Condi2 takes nothing returns boolean
  return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1, 8) <= 2 ) and ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] == udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1] )
endfunction
function Quest08_Condi3 takes nothing returns boolean
  return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) ) and ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] == udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1] )
endfunction

function Trig_Quest_08_C_Actions takes nothing returns nothing
 set quest_temp_i = Quest_Level(GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1, 8)
  if ( quest_temp_i == 1 ) then
    set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), 1100., Condition(function Quest08_Condi1))
    call ForGroup(udg_temp_g, function Quest08_Action)
  elseif ( quest_temp_i == 2 ) and ( GetUnitLevel(GetDyingUnit()) >= 60 ) then
    set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), 1100., Condition(function Quest08_Condi2))
    call ForGroup(udg_temp_g, function Quest08_Action)
  elseif ( quest_temp_i >= 3 ) and ( GetUnitLevel(GetDyingUnit()) >= 80 ) then
    set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), 1100., Condition(function Quest08_Condi3))
    call ForGroup(udg_temp_g, function Quest08_Action)
  endif
  call DestroyGroup( udg_temp_g )
endfunction

//===========================================================================
function InitTrig_Quest_08_B takes nothing returns nothing
  set gg_trg_Quest_08_B = CreateTrigger(  )
  call TriggerAddAction( gg_trg_Quest_08_B, function Trig_Quest_08_C_Actions )
endfunction

//===========================================================================
// Trigger: Quest 09
//
// FSE_Rest(udg_temp_i)
//===========================================================================
function Quest09 takes unit user returns nothing
 //외형: 하이엘프 여성, 말투: 내가, 당신, ~요
 local integer P = GetPlayerId(GetOwningPlayer(user))+1
  if ( Quest_Level(P, 9) == -3 ) then
    call QMsg(P, 0, "아이 엄마", "흥!", 1.)
    call QMsg(P, 0, "플레이어", "|c008bc7fc(단단히 미움받는 중인가 보다...)", 1.)
  elseif ( Quest_Level(P, 9) == -2 ) then
    call QMsg(P, 0, "아이 엄마", "잠시 제가 생각할 시간을 주세요.", 0)
  elseif ( Quest_Level(P, 9) == -1 ) then
    call PauseUnit(user, true)
    if ( GetHeroLevel(user) < 30 ) then
      call QMsg(P, 0, "아이 엄마", "다시 토벌해주신다니 감사해요! 그럼 잘 부탁해요~", 1.)
      call SaveInteger(udg_hash, StringHash("QLevel9"), P, 1)
    elseif ( GetHeroLevel(user) < 50 ) then
      call QMsg(P, 0, "아이 엄마", "조금 위험할 수 있으니 다치지 않게 주의하세요! 그럼 열심히 해주세요~", 1.)
      call SaveInteger(udg_hash, StringHash("QLevel9"), P, 2)
    elseif ( GetHeroLevel(user) <= 70 ) then
      call QMsg(P, 0, "아이 엄마", "위험하니 조심히 다녀오세요. 그럼 잘 부탁드려요!", 1.)
      call SaveInteger(udg_hash, StringHash("QLevel9"), P, 3)
    else
      call QMsg(P, 0, "아이 엄마", "덕분에 요즘은 몬스터가 한마리도 안보여요! 이제 더이상 도와주시지 않아도 되겠어요.", 0)
    endif
    call Quest_End2(P)
  elseif ( Quest_Level(P, 9) == 0 ) then
    if ( 6 > GetHeroLevel(user) ) then
      call QMsg(P, 0, "아이 엄마", "당신은 나를 도와줄 수 없어요.. [레벨제한 10~]", 0)
    else
      call Quest_Start(P, 9, true)
      set udg_Quest_ClearInt_09[P] = 0
      call QMsg(P, 0, "아이 엄마", "에휴..", 1.)
      call QMsg(P, 0, "아이 엄마", "에휴우.........", 1.)
      call QMsg(P, 0, "플레이어", "무슨 일인가요?", 1.)
      call QMsg(P, 0, "아이 엄마", "어맛! 누, 누구세요?", 1.)
      call QMsg(P, 0, "플레이어", "놀라게 해드려 죄송합니다. 지나가는 모험자입니다. 걱정이 있으신 것 같은데...", 1.)
      call QMsg(P, 0, "아이 엄마", "다, 당신하곤 상관없는 일이에요!", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc (.....)", 1.)
      call QMsg(P, 25, "3", "|c00d962b51. |c008bc7fc(무슨 도와줄 일이 없을까?)\n|c00d962b52. |c008bc7fc(이런 못돼먹은...!)", 10.)
    endif
  elseif ( Quest_Level(P, 9) == 1 ) then
    if ( udg_Quest_ClearInt_09[P] < 60 ) then
      call QMsg(P, 0, "아이 엄마", "이정도로는 우리 아이가 안심할 수 없어요... |cffffdc3c[현재 만족도: |cffff0000" + R2SW((I2R(udg_Quest_ClearInt_09[P])/.6), 3, 1) + "|cffffdc3c%/|c0055ff55100|cffffdc3c%]", 1.)
    else
      call Quest_Start(P, 9, false)
      call QMsg(P, 0, "아이 엄마", "얼마나 잡으셨나요?", 1.)
      call QMsg(P, 0, "플레이어", "모조리 쓸었으니 당분간은 코빼기도 안보일테니 안심하세요.", 1.)
      call QMsg(P, 0, "아이 엄마", "음....", 0.5)
      call QMsg(P, 0, "아이 엄마", "좋아요! 이정도면 만족스러워요.", 1.)
      call QMsg(P, 0, "아이 엄마", "수고 많으셨어요. 작지만 받아주세요.", 1.)
      set quest_temp_i = R2I(15000.*(I2R(udg_Quest_ClearInt_09[P])/60.))
      set udg_Quest_ClearInt_09[P] = 0
      call MakeTestt(P, false, quest_temp_i)
      call QMsg(P, 7., "2", "아이 엄마를 도와주고 경험치를 "+FSE_Rest(quest_temp_i)+" 얻었다!", 2.)
      call QMsg(P, 0, "아이 엄마", "다음에 또 다시 부탁해도 될까요?", 1.)
      call Quest_End(P, 9, true)
      call SaveInteger(udg_hash, StringHash("QLevel9"), P, -1)
    endif
  elseif ( Quest_Level(P, 9) == 2 ) then
    if ( udg_Quest_ClearInt_09[P] < 170 ) then
      call QMsg(P, 0, "아이 엄마", "이정도로는 우리 아이가 안심할 수 없어요... |cffffdc3c[현재 만족도: |cffff0000" + R2SW((I2R(udg_Quest_ClearInt_09[P])/1.7), 3, 1) + "|cffffdc3c%/|c0055ff55100|cffffdc3c%]", 1.)
    else
      call Quest_Start(P, 9, false)
      call QMsg(P, 0, "아이 엄마", "얼마나 잡으셨나요?", 1.)
      call QMsg(P, 0, "플레이어", "눈에 보이는건 모조리 잡았으니 당분간은 코빼기도 안보겁니다.", 1.)
      call QMsg(P, 0, "아이 엄마", "음....", 0.5)
      call QMsg(P, 0, "아이 엄마", "와우! 기대 이상이네요!", 1.)
      call QMsg(P, 0, "아이 엄마", "수고 많으셨어요. 여기...", 1.)
      set quest_temp_i = R2I(51000.*(I2R(udg_Quest_ClearInt_09[P])/170.))
      set udg_Quest_ClearInt_09[P] = 0
      call MakeTestt(P, false, quest_temp_i)
      call QMsg(P, 7., "2", "아이 엄마를 도와주고 경험치를 "+FSE_Rest(quest_temp_i)+" 얻었다!", 2.)
      call QMsg(P, 0, "아이 엄마", "다음에 또 다시 부탁하고 싶네요.", 1.)
      call Quest_End(P, 9, true)
      call SaveInteger(udg_hash, StringHash("QLevel9"), P, -1)
    endif
  elseif ( Quest_Level(P, 9) == 3 ) then
    if ( udg_Quest_ClearInt_09[P] < 300 ) then
      call QMsg(P, 0, "아이 엄마", "이정도로는 우리 아이가 안심할 수 없어요... |cffffdc3c[현재 만족도: |cffff0000" + R2SW((I2R(udg_Quest_ClearInt_09[P])/3.), 3, 1) + "|cffffdc3c%/|c0055ff55100|cffffdc3c%]", 1.)
    else
      call Quest_Start(P, 9, false)
      call QMsg(P, 0, "아이 엄마", "얼마나 잡으셨나요?", 1.)
      call QMsg(P, 0, "플레이어", "모조리 잡았습니다.", 1.)
      call QMsg(P, 0, "아이 엄마", "음....", 0.5)
      call QMsg(P, 0, "아이 엄마", "말이 안나올정도로 많이 잡으셨네요.", 1.)
      call QMsg(P, 0, "아이 엄마", "정말 수고하셨어요! 그럼...", 1.)
      set quest_temp_i = R2I(200000.*(I2R(udg_Quest_ClearInt_09[P])/300.))
      set udg_Quest_ClearInt_09[P] = 0
      call MakeTestt(P, false, quest_temp_i)
      call QMsg(P, 7., "2", "아이 엄마를 도와주고 경험치를 "+FSE_Rest(quest_temp_i)+" 얻었다!", 2.)
      call QMsg(P, 0, "아이 엄마", "수고하셨어요! 이제 안심이에요!", 1.)
      call Quest_End(P, 9, true)
      
      call SaveInteger(udg_hash, StringHash("QLevel9"), P, -1)
    endif
  endif
  call Quest_End2(P)
endfunction
function Trig_Quest_09_Actions takes nothing returns nothing
  call Quest09(GetAttacker())
endfunction

//===========================================================================
function InitTrig_Quest_09 takes nothing returns nothing
    set gg_trg_Quest_09 = CreateTrigger(  )
    call TriggerRegisterUnitEvent( gg_trg_Quest_09, gg_unit_nhef_0373, EVENT_UNIT_ATTACKED )
    call TriggerAddAction( gg_trg_Quest_09, function Trig_Quest_09_Actions )
endfunction

//===========================================================================
// Trigger: Quest 09 B
//
// 4~10(6+) // 1
// 14~28 (10+) (10~29) // 3 (45) , 4000
// 33~47(30+) (30~49) // 8 (120) , 13000
// 48~68(50+) (50~70) // 20 (300) , 40000
// Lv/3
// 60
// 170
// 300
//===========================================================================
function Quest09_Condi takes nothing returns boolean
  return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) ) and ( Quest_Level(GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1, 9) >= 1 ) and ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] == udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1] )
endfunction

function Quest09_Action takes nothing returns nothing
  set quest_temp_i = GetPlayerId(GetOwningPlayer(GetEnumUnit()))+1
  set udg_Quest_ClearInt_09[quest_temp_i] = udg_Quest_ClearInt_09[quest_temp_i] + ( GetUnitLevel(GetDyingUnit()) / 3 )
  if ( Quest_Level(quest_temp_i, 9) == 1 ) then
    set quest_temp_r = I2R(udg_Quest_ClearInt_09[quest_temp_i])/.6
  elseif ( Quest_Level(quest_temp_i, 9) == 2 ) then
    set quest_temp_r = I2R(udg_Quest_ClearInt_09[quest_temp_i])/1.7
  elseif ( Quest_Level(quest_temp_i, 9) == 3 ) then
    set quest_temp_r = I2R(udg_Quest_ClearInt_09[quest_temp_i])/3.
  endif
  if ( quest_temp_r >= 100. ) then
    if ( quest_temp_r <= 104. ) then
      call MSG(Player(quest_temp_i-1), 1, 7., "이정도면 충분히 잡은것 같습니다.")
    endif
    call Bufftt(CreateTextTagUnitBJ("|cff46ffff" + R2SW(quest_temp_r, 3, 1) + "%", GetEnumUnit(), 0, 9., 100., 100., 100., 0 ), 7)
  else
    call Bufftt(CreateTextTagUnitBJ("|cffff0000" + R2SW(quest_temp_r, 3, 1) + "%", GetEnumUnit(), 0, 9., 100., 100., 100., 0 ), 7)
  endif
endfunction

function Trig_Quest_09_C_Actions takes nothing returns nothing
debug call BJDebugMsg("아이엄마 START")
  set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), 1100., Condition(function Quest09_Condi))
  call ForGroup( udg_temp_g, function Quest09_Action )
  call DestroyGroup( udg_temp_g )
endfunction

//===========================================================================
function InitTrig_Quest_09_B takes nothing returns nothing
  set gg_trg_Quest_09_B = CreateTrigger(  )
  call TriggerAddAction( gg_trg_Quest_09_B, function Trig_Quest_09_C_Actions )
endfunction

//===========================================================================
// Trigger: Quest 10
//===========================================================================
function Quest10 takes unit user returns nothing
 //외형: 위습, 말투: 너어는.. 나는.. ~야?
 local integer P = GetPlayerId(GetOwningPlayer(user))+1
  if ( Quest_Level(P, 10) == -2 ) then
    call PauseUnit(user, true)
    call QMsg(P, 0, "NPC 푸잎", "흥! 나는 쪼잔해서 쉽게 마음을 풀지 않지!", 1.)
    call QMsg(P, 0, "플레이어", "|c008bc7fc(아직.. 삐져있다...)", 1.)
    call PauseUnit(user, false)
  elseif ( Quest_Level(P, 10) == -1 ) then
    call QMsg(P, 0, "NPC 푸잎", "공짜 서비스는 끝! 돈을 내고 이용하도록 해.", 0)
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", user, "overhead"))
  elseif ( Quest_Level(P, 10) == 0 ) then
    if ( GetHeroLevel(user) > 10 ) then
      call QMsg(P, 0, "NPC 푸잎", "너어는 11이 넘지 않아? 골드를 내고 이용하도록 해.", 0)
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", user, "overhead"))
      call Quest_End(P, 10, false)
    elseif ( GetUnitTypeId(user) == 'H000' ) then
      call QMsg(P, 0, "NPC 푸잎", "모시는 신을 정하고 내게로 와.", 0)
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", user, "overhead"))
    else
      call Quest_Start(P, 10, true)
      call QMsg(P, 0, "NPC 푸잎", "너어는...", 1.)
      call QMsg(P, 0, "NPC 푸잎", "어둠의전설 RPG를 처음 시작하는 모험가인가?", 1.)
      call QMsg(P, 0, "플레이어", "네.", 1.)
      call QMsg(P, 0, "NPC 푸잎", "호오, 그래? 그럼 내 부탁 하나만 들어주지 않을래?", 1.)
      call QMsg(P, 0, "NPC 푸잎", "다름이 아니고 내가 지금 가진게 하나도 없어서 말인데..", 1.)
      call QMsg(P, 0, "NPC 푸잎", "나에게 100Gold만 주지 않을래?", 1.)
      call QMsg(P, 0, "플레이어", "흠...", 1.)
      call QMsg(P, 35, "3", "|c00d962b51. |c008bc7fc(100Gold는 나에게 큰 돈이지만 드린다.)\n|c00d962b52. |c00ffff00거지 같은 놈.", 10.)
      call Quest_End2(P)
    endif
  endif
endfunction

function Trig_Quest_10_Actions takes nothing returns nothing
  call Quest10(GetAttacker())
endfunction

//===========================================================================
function InitTrig_Quest_10 takes nothing returns nothing
    set gg_trg_Quest_10 = CreateTrigger(  )
    call TriggerRegisterUnitEvent( gg_trg_Quest_10, gg_unit_e019_0374, EVENT_UNIT_ATTACKED )
    call TriggerAddAction( gg_trg_Quest_10, function Trig_Quest_10_Actions )
endfunction

//===========================================================================
// Trigger: Quest 11
//
// 슈리커의 갓 8개 (추가 개당 +15%)
// 아칸더스 7개 (추가 개당 +5%)
// 독거미알 12개 (추가 개당 +3%)
// 수정 - +150% = 알 수 없는 액체 (고정 랜덤)
// 수정 - +400% = 엑쿠. (50%당 엑쿠 1개?)
// 알 수 없는 액체 - 데스 확률 증가(엑쿠 대체)
//===========================================================================
function Quest11 takes unit user returns nothing
 //외형: 페어리, 말투: 외국st, 암호화(모자이크)
 local integer P = GetPlayerId(GetOwningPlayer(user))+1
 local integer keyitem1 = 'whwd'
 local integer keyitem2 = 'I008'
 local integer keyitem3 = 'I07O'
 local integer count1 = 0
 local integer count2 = 0
 local integer count3 = 0
 local integer bonus = 0

  if ( Quest_Level(P, 11) == -1 ) then
    call QMsg(P, 0, "날개 잃은 요정", "도와..주셔셔..감사해요.", 0.)
  elseif ( Quest_Level(P, 11) == 0 ) then
    if ( GetHeroLevel(user) <= 70 ) then
      call QMsg(P, 0, "날개 잃은 요정", "레☆벨..▲족.. [레벨제한 4써클 이상]", .5)
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", user, "overhead"))
    else
      call Quest_Start(P, 11, true)
      call QMsg(P, 0, "날개 잃은 요정", ".....", 1.)
      call QMsg(P, 0, "플레이어", "음...?", 1.)
      call QMsg(P, 0, "날개 잃은 요정", "페....◈", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(날개를 다친 듯 하다.)", 1.)
      call QMsg(P, 0, "플레이어", "무슨 일인가요? 날개를 다친 것 같네요.", 1.)
      call QMsg(P, 0, "날개 잃은 요정", "사♧...▲람☆?", 1.)
      call QMsg(P, 0, "날개 잃은 요정", "날개..◀♧...치료♣...슈리커■▽..열 개◇...", 1.)
      call QMsg(P, 0, "날개 잃은 요정", "도와▽●..줘..", 1.)
      call QMsg(P, 0, "플레이어", "도와 드릴게요. 어떻게 도와 드리면 되나요?", 1.)
      call QMsg(P, 0, "날개 잃은 요정", "....슈▼리커.. ◇갓.. ◇...개... ▼아칸☆스... ♠개.. □거미◎ 12개◁...♤", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(슈리커, 아칸더스, 거미? 음.. 역시 알아듣기 힘들군..)", 1.)
      call QMsg(P, 7, "1", "몬스터를 잡아, 재료를 구해 가자.\n자세한건 |cffc3dbff\"-퀘스트\"|cffffdc3c를 입력.", .5)
      call Quest_End2(P)
    endif
  elseif ( Quest_Level(P, 11) == 1 ) then
    call Quest_End2(P)
    call QMsg(P, 0, "플레이어", "여기, 재료를 구해 왔습니다. 확인 해 보세요.", 1.)
    
    set bj_forLoopAIndex = 1
    loop
      exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
      if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( GetUnitLevel(udg_Unit[bj_forLoopAIndex]) >= 71 ) then
        set count1 = count1 + CountItem(bj_forLoopAIndex, keyitem1)
        set count2 = count2 + CountItem(bj_forLoopAIndex, keyitem2)
        set count3 = count3 + CountItem(bj_forLoopAIndex, keyitem3)
      endif
      set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    
    if ( count1 < 8 ) or ( count2 < 7 ) or ( count3 < 12 ) then
      if ( count1 < 8 ) then
        call QMsg(P, 0, "날개 잃은 요정", "슈리커▼.. 부족..♧", 1.)
      endif
      if ( count2 < 7 ) then
        call QMsg(P, 0, "날개 잃은 요정", "아□더스.. 부족★..", 1.)
      endif
      if ( count3 < 12 ) then
        call QMsg(P, 0, "날개 잃은 요정", "◎거미알.. ▼♤...부족..", 1.)
      endif
    endif
    if ( count1 >= 8 ) or ( count2 >= 7 ) or ( count3 >= 12 ) then
      call QMsg(P, 0, "날개 잃은 요정", "▷모두□.. 충분해요.○", 1.)
      call QMsg(P, 0, "날개 잃은 요정", "잠시♣..만요◇.", 1.)
      
      set bj_forLoopAIndex = 1
      set bonus = (count1-8)*15 + (count2-7)*5 + (count3-3)*3
      loop
        exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( GetUnitLevel(udg_Unit[bj_forLoopAIndex]) >= 71 ) then
          call MinusItem(bj_forLoopAIndex, keyitem1, count1)
          call MinusItem(bj_forLoopAIndex, keyitem2, count2)
          call MinusItem(bj_forLoopAIndex, keyitem3, count3)
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
      call TriggerSleepAction(udg_Quest_WaitTime[P]*.5)
      
      set bj_forLoopAIndex = 1
      loop
        exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( GetUnitLevel(udg_Unit[bj_forLoopAIndex]) >= 71 ) then
          call QMsg(bj_forLoopAIndex, 0, "날개 잃은 요정", "도와..주셔셔..감사해요.", 0.)
          call MakeTestt(bj_forLoopAIndex, false, 2000000)
          call QMsg(bj_forLoopAIndex, 7., "2", "1. 요정을 도와주고 보상으로 경험치를 2,000,000 얻었다!", 0.)
          call QMsg(bj_forLoopAIndex, 7., "0", "2. ＊|cffffdc3c특별보상１＞|c00ffff80＞많은 재료로 인해 경험치를 추가로 " + FSE_Rest(bonus*20) + "K 얻었다!", 0.)
          call Bufftt(CreateTextTagUnitBJ(" EXP +" + I2S(bonus*20) + "K", udg_Unit[bj_forLoopAIndex], -150.00, 9.00, 33.00, 100.00, 0.00, 0 ), 7)
          call AddHeroXP(udg_Unit[bj_forLoopAIndex], bonus*5000, false)
          set udg_SysL_Exp[bj_forLoopAIndex] = GetHeroXP(udg_Unit[bj_forLoopAIndex])
          call Quest_End(bj_forLoopAIndex, 11, false)
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
      call TriggerSleepAction(udg_Quest_WaitTime[P]*.5)
      if ( bonus >= 400 ) then
        set bj_forLoopAIndex = 1
        loop
          exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
          if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( GetUnitLevel(udg_Unit[bj_forLoopAIndex]) >= 71 ) then
            call QMsg(P, 7., "0", "3. ＊|cffffdc3c특별보상２＞|c00ffff80＞요정이 고맙다며 특별히 알 수 없는 액체를 주었다!", 0.)
            call SetItemCharges(CreateItem('I085', GetUnitX(udg_Unit[bj_forLoopAIndex]), GetUnitY(udg_Unit[bj_forLoopAIndex])), GetRandomInt(3, 9))
            call QMsg(P, 7., "0", "4. ＊|cffffdc3c특별보상３＞|c00ffff80＞요정이 고맙다며 특별히 엑스쿠라눔을 " + I2S(bonus/300+1) + "개 주었다!|r", 0.)
            call GiveItem(bj_forLoopAIndex, 'I084', bonus/300+1)
            call SetItemUserData(bj_lastCreatedItem, bj_forLoopAIndex)
          endif
          set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
      elseif ( bonus >= 150 ) then
        set bj_forLoopAIndex = 1
        loop
          exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
          if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( GetUnitLevel(udg_Unit[bj_forLoopAIndex]) >= 71 ) then
            call QMsg(P, 7., "0", "3. ＊|cffffdc3c특별보상２＞|c00ffff80＞요정이 고맙다며 특별히 알 수 없는 액체를 주었다!", 0.)
            call SetItemCharges(CreateItem('I085', GetUnitX(udg_Unit[bj_forLoopAIndex]), GetUnitY(udg_Unit[bj_forLoopAIndex])), GetRandomInt(2, 6))
          endif
          set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
      endif
    endif
  endif
endfunction

function Trig_Quest_11_Actions takes nothing returns nothing
  call Quest11(GetAttacker())
endfunction

//===========================================================================
function InitTrig_Quest_11 takes nothing returns nothing
    set gg_trg_Quest_11 = CreateTrigger(  )
    call TriggerRegisterUnitEvent( gg_trg_Quest_11, gg_unit_efdr_0197, EVENT_UNIT_ATTACKED )
    call TriggerAddAction( gg_trg_Quest_11, function Trig_Quest_11_Actions )
endfunction

//===========================================================================
// Trigger: Quest 12
//===========================================================================
function Quest12 takes unit user returns nothing
 //외형: 팔라딘, 말투: 호탕, 자부심, !
 local integer P = GetPlayerId(GetOwningPlayer(user))+1
 local integer count = 0
  if ( Quest_Level(P, 12) == -1 ) then
    call QMsg(P, 0, "팔라딘", "또 도와주러 왔나? 아쉽지만 자네들이 다 쓸어버려서 이제 됐다네! 정 도와주고 싶으면 한번 더 말을 걸게.", 0.)
    call SaveInteger(udg_hash, StringHash("QLevel12"), P, 1)
  elseif ( GetHeroLevel(user) < 99 ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", user, "overhead"))
      call QMsg(P, 0, "팔라딘", "너는 너무 약해! [레벨제한 99 이상]", .5)
  elseif ( P != udg_PartyNumber_ThisP[P] ) then
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", user, "overhead"))
    call QMsg(P, 0, "팔라딘", "나는 파티장하고만 이야기 할 거네!", .5)
  elseif ( Quest_Level(P, 12) == 0 ) then    
    call Quest_Start(P, 12, true)
    call QMsg(P, 0, "팔라딘", "흠...", 1.)
    call QMsg(P, 0, "플레이어", "|c008bc7fc (음..?)", 1.)
    call QMsg(P, 0, "팔라딘", "후우........", 1.)
    call QMsg(P, 0, "팔라딘", "그래. 거기, 자네! 이리 와 보게!", 1.)
    call QMsg(P, 0, "플레이어", "무슨 일이시죠?", 1.)
    call QMsg(P, 0, "팔라딘", "난 성스러운 팔라딘이네! 황실의 명으로 줄곧 이곳을 지켜왔지.", 1.)
    call QMsg(P, 0, "팔라딘", "결론부터 말하겠네! 호러캐슬을 소탕해 줄 수 있겠는가?", 1.)
    call QMsg(P, 0, "플레이어", "|c008bc7fc(그깟 한두마리는 혼자서 처리하지..)", 1.)
    call QMsg(P, 0, "플레이어", "기꺼이 도와드리겠습니다. 얼마나 처리하면 되죠?", 1.)
    call QMsg(P, 0, "팔라딘", "음...... 사실 매달 50마리정도 잡아야 하지만 요즘 많이 피곤해서 좀 쉬었다네!", 1.)
    call QMsg(P, 0, "플레이어", "|c008bc7fc(몇마리나 잡아야 할까?)", 1.)
    call QMsg(P, 0, "팔라딘", "사실 내 뒤에 보이는것처럼 내 전성기만 되어도 이깟것따위...|c008bc7fc(중얼중얼)", 1.)
    call QMsg(P, 0, "플레이어", "얼.마.나 처.리.하.면 되.죠?", .5)
    call QMsg(P, 0, "팔라딘", "ㅇ..작년부터 쉬었으니.. 600마리정도 잡아야겠네.", 1.)
    call QMsg(P, 7, "1", "일년동안 게으름 피운 팔라딘을 위해, 호러 캐슬을 소탕하자!\n자세한건 |cffc3dbff\"-퀘스트\"|cffffdc3c를 입력.", .5)
  elseif ( Quest_Level(P, 12) == 1 ) then
    if ( udg_Quest_ClearInt_12[P] < 600 ) then
      call QMsg(P, 0, "팔라딘", "아직 부족하네! 600마리는 잡아야 내 체면이 서네.", 1.)
    else
      call Quest_Start(P, 12, true)
      call QMsg(P, 0, "팔라딘", "얼마나 잡았나?", 1.)
      call QMsg(P, 0, "팔라딘", "자네들은 날 놀라게 하는군!", 1.)
      call QMsg(P, 0, "팔라딘", "좋아! 1분정도 후 파티원들과 함께 오게. 내 보상을 준비하지.", 1.)
      call QMsg(P, 0, "팔라딘", "명심하게. 오지 않으면 보상은 없네!", 1.)
      call QMsg(P, 7., "2", "모두 호러캐슬(사냥터 포함)에 모인 후, 파티장이 다시 말을 걸자.", 0.)
      call Quest_End2(P)
      call TriggerSleepAction(60.)
      call SaveInteger(udg_hash, StringHash("QLevel12"), P, 3)
    endif
  elseif ( Quest_Level(P, 12) == 2 ) then
    call QMsg(P, 0, "팔라딘", "기다리게! 뭘 주어야 할지 생각중이네.", 0.)
  elseif ( Quest_Level(P, 12) == 3 ) then
    call QMsg(P, 0, "팔라딘", "자, 여기 작은 감사의 보답일세.", 1.)
    set bj_forLoopAIndex = 1
    loop
      exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
      if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) then
        /* 대기실 or 사냥터 비교 */
        if ( udg_OnesPositionN[bj_forLoopAIndex] == -2 or ( udg_OnesPositionN[bj_forLoopAIndex] >= 48 and udg_OnesPositionN[bj_forLoopAIndex] <= 50 ) ) then
          call Quest_End(bj_forLoopAIndex, 12, false)
          set count = IMaxBJ(count, udg_Quest_ClearInt_12[bj_forLoopAIndex])
          set udg_Quest_ClearInt_12[bj_forLoopAIndex] = 0
          call MakeTestt(bj_forLoopAIndex, true, 50000)
        else
          call QMsg(bj_forLoopAIndex, 7., "0", "(당신은 호러캐슬 대기실/사냥터 내에 없어 보상을 받을 수 없습니다.)", 0.)
        endif
      endif
      set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    call TriggerSleepAction(1.)
    
    call DisableTrigger(GetTriggeringTrigger())
    loop
      exitwhen count < 600
      set bj_forLoopAIndex = 1
      loop
        exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( udg_OnesPositionN[bj_forLoopAIndex] == -2 or ( udg_OnesPositionN[bj_forLoopAIndex] >= 48 and udg_OnesPositionN[bj_forLoopAIndex] <= 50 ) ) then
          if ( udg_SysB_Level[bj_forLoopAIndex] >= 99 ) then
            call QMsg(bj_forLoopAIndex, 7., "2", "팔라딘을 도와주고 50,000G와 경험치 8M과 엑스쿠라눔 "+I2S(2)+"개를 받았습니다!", 0.)
            call MakeTestt(bj_forLoopAIndex, false, 8000000)
            call MakeTestt(bj_forLoopAIndex, false, 8000000)
          else
            call QMsg(bj_forLoopAIndex, 7., "2", "팔라딘을 도와주고 50,000G와 경험치 4M과 엑스쿠라눔 "+I2S(2)+"개를 받았습니다!", 0.)
            call MakeTestt(bj_forLoopAIndex, false, 4000000)
          endif
          call GiveItem(bj_forLoopAIndex, 'I084', 2)
          call SetItemUserData(bj_lastCreatedItem, bj_forLoopAIndex)
          set udg_SysL_Wood[bj_forLoopAIndex] = GetPlayerState(Player(bj_forLoopAIndex-1), PLAYER_STATE_RESOURCE_LUMBER)
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
      set count = count - 600
      call TriggerSleepAction(.1)
    endloop
    call EnableTrigger(GetTriggeringTrigger())
    call QMsg(P, 0, "팔라딘", "수고 많았네! 다음에 또 부탁하지.", 1.)
  endif
  call Quest_End2(P)
endfunction
function Trig_Quest_12_Actions takes nothing returns nothing
  call Quest12(GetAttacker())
endfunction

//===========================================================================
function InitTrig_Quest_12 takes nothing returns nothing
    set gg_trg_Quest_12 = CreateTrigger(  )
    call TriggerRegisterUnitEvent( gg_trg_Quest_12, gg_unit_Hpal_0121, EVENT_UNIT_ATTACKED )
    call TriggerAddAction( gg_trg_Quest_12, function Trig_Quest_12_Actions )
endfunction

//===========================================================================
// Trigger: Quest 12 B
//
// 4~10(6+) // 1
// 14~28 (10+) (10~29) // 3 (45) , 4000
// 33~47(30+) (30~49) // 8 (120) , 13000
// 48~68(50+) (50~70) // 20 (300) , 40000
// Lv/3
// 60
// 170
// 300
//===========================================================================
function Quest12_Condi takes nothing returns boolean
  return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) ) and ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] == udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1] )
endfunction

function Quest12_Action takes nothing returns nothing
  set quest_temp_i = GetPlayerId(GetOwningPlayer(GetEnumUnit()))+1
  set udg_Quest_ClearInt_12[quest_temp_i] = udg_Quest_ClearInt_12[quest_temp_i] + 1
  if ( udg_Quest_ClearInt_12[quest_temp_i] == 100 ) then
    call MSG(Player(quest_temp_i-1), 1, 7., "이정도면 충분히 잡은것 같습니다.")
  endif
  if ( udg_Quest_ClearInt_12[quest_temp_i] < 600 ) then
    call Bufftt(CreateTextTagUnitBJ("|cff46ffff" + I2S(udg_Quest_ClearInt_12[quest_temp_i]), GetTriggerUnit(), 0, 9., 100., 100., 100., 0 ), 7)
  endif
  call SetTextTagVisibility(bj_lastCreatedTextTag, false)
  if ( GetLocalPlayer() == Player(quest_temp_i-1) ) then
    call SetTextTagVisibility(bj_lastCreatedTextTag, true)
  endif
endfunction

function Trig_Quest_12_C_Actions takes nothing returns nothing
  set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), 1100., Condition(function Quest12_Condi))
  call ForGroup( udg_temp_g, function Quest12_Action)
  call DestroyGroup( udg_temp_g )
endfunction

//===========================================================================
function InitTrig_Quest_12_B takes nothing returns nothing
  set gg_trg_Quest_12_B = CreateTrigger(  )
  call TriggerAddAction( gg_trg_Quest_12_B, function Trig_Quest_12_C_Actions )
endfunction

//===========================================================================
// Trigger: Quest 13
//
// 슈리커의 갓 8개 (추가 개당 +15%)
// 아칸더스 7개 (추가 개당 +5%)
// 독거미알 12개 (추가 개당 +3%)
// 수정 - +150% = 알 수 없는 액체 (고정 랜덤)
// 수정 - +400% = 엑쿠. (50%당 엑쿠 1개?)
// 알 수 없는 액체 - 데스 확률 증가(엑쿠 대체)
//===========================================================================
function Quest13 takes unit user returns nothing
 //외형: 블러드메이지, 말투: 혼자말, 꼰대
 local integer P = GetPlayerId(GetOwningPlayer(user))+1

  if ( Quest_Level(P, 13) == -1 ) or ( Quest_Level(P, 13) == 4 ) then
    call QMsg(P, 0, "궁중 마법사", "연구중이다. 방해하지 마. 핵을 들고 오든가..", 1.)
    call SetWidgetLife(user, 1.)
    call Bufftt(CreateTextTagUnitBJ("HP -", user, 30., 9., 100., 0., 0., 0), 1)
    call SaveInteger(udg_hash, StringHash("QLevel13"), P, 3)
    set bj_forLoopAIndex = 1
    loop
      exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
      if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( udg_SysB_Level[bj_forLoopAIndex] >= 99 ) and ( bj_forLoopAIndex != P ) then
        set udg_Quest_ClearInt_13[P] = IMaxBJ(udg_Quest_ClearInt_13[P], udg_Quest_ClearInt_13[bj_forLoopAIndex])
        set udg_Quest_ClearInt_13[bj_forLoopAIndex] = 0
      endif
      set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    call MSG(Player(P-1), 2, 10, "(파티원들로부터 혼돈의핵을 받았습니다)")
  elseif ( GetHeroLevel(user) < 99 ) then
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", user, "overhead"))
    call QMsg(P, 0, "궁중 마법사", "나약한 놈은 필요없어. [레벨제한 99]", 0.)
  elseif ( P != udg_PartyNumber_ThisP[P] ) then
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", user, "overhead"))
    call QMsg(P, 0, "궁중 마법사", "니가 나와 얘기할 자격이 있을까? 단장정도는 데리고 와.", .5)
  elseif ( Quest_Level(P, 13) == 0 ) then
    call Quest_Start(P, 13, true)
    call QMsg(P, 0, "궁중 마법사", "이상하군... 이상해...", 1.)
    call QMsg(P, 0, "궁중 마법사", "응? 자넨 누군가?", 1.)
    call QMsg(P, 0, "플레이어", "안녕하세요. 저는...", 1.)
    call QMsg(P, 0, "궁중 마법사", "아 됐고, 이상하지 않나?", 1.)
    call QMsg(P, 0, "플레이어", "뭐가 이상하단 말인가요?", 1.)
    call QMsg(P, 0, "궁중 마법사", "이곳의 몬스터 말이야.", 1.)
    call QMsg(P, 0, "플레이어", "응..? 글쎄요.. 저는 별로..", 1.)
    call QMsg(P, 0, "궁중 마법사", "생각을 해 봐. 아무리 저기있는 팔라딘이 농땡이를 피웠다지만, 이렇게 몬스터가 넘칠 리가 없어.", 1.)
    call QMsg(P, 0, "궁중 마법사", "다른곳에 비해 두 배. 혹은 그 이상으로 넘쳐나는게 자연스러워 보여?", 1.)
    call QMsg(P, 0, "궁중 마법사", "그래서 이렇게 조사를 나온 것이지만... 마침 잘 되었네. 날 도와 줄래?", 1.5)
    call QMsg(P, 0, "플레이어", "흐음..어떻게 도와 드릴까요?.", 1.)
    call QMsg(P, 0, "궁중 마법사", "별 거 아냐. 우선은 저 안에 들어가서 도움이 될 만한 것을 가져와 봐. 내 예상이 맞다면 어렵지 않게 구할 수 있을거야. 혼자가기 어렵다면 파티원들과 함께 가도록 해.", 1.5)
    call QMsg(P, 0, "플레이어", "|c008bc7fc(막막하군..) |c00ffff00예, 알겠습니다.", 1.)
    call QMsg(P, 7, "1", "호러 캐슬 내부에서 수상한 물건을 구하자.", .5)
    call Quest_End2(P)
  elseif ( Quest_Level(P, 13) == 1 ) then
    if ( udg_Quest_ClearInt_13[P] < 10 ) then
      call QMsg(P, 0, "궁중 마법사", "수상한 물건을 10개쯤 가져 오도록", 1.)
    else
      call Quest_Start(P, 13, false)
      call QMsg(P, 0, "플레이어", "여기, 의심이 가는 물건을 가져 왔습니다.", 1.)
      
      set bj_forLoopAIndex = 1
      loop
        exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( udg_SysB_Level[bj_forLoopAIndex] >= 99 ) then
          set udg_Quest_ClearInt_13[bj_forLoopAIndex] = udg_Quest_ClearInt_13[bj_forLoopAIndex] - 10
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
      call QMsg(P, 0, "궁중 마법사", "어디 보자... 혼돈의 핵 이라...", 1.)
      call QMsg(P, 0, "궁중 마법사", "...", 1.)
      call QMsg(P, 0, "궁중 마법사", ".....", 1.)
      call QMsg(P, 0, "궁중 마법사", "！", .5)
      call QMsg(P, 0, "플레이어", "뭔가 발견하셨나요?", 1.)
      call QMsg(P, 0, "궁중 마법사", "이거... 내 예상보다 위험한 물건일지도 모르겠군. 그나저나 지금 가져다 준 게 모두 부러져 버렸네. 한 100개정도 구해 와 봐.", 1.)
      call QMsg(P, 0, "플레이어", "알겠습니다.", 1.)
    endif
  elseif ( Quest_Level(P, 13) == 2 ) then
    if ( udg_Quest_ClearInt_13[P] < 100 ) then
      call QMsg(P, 0, "궁중 마법사", "혼돈의 핵 100개를 가져 오라고. 100개!", 1.)
    else
      call Quest_Start(P, 13, false)
      call QMsg(P, 0, "플레이어", "혼돈의 핵 100개를 구해 왔습니다.", 1.)
      call QMsg(P, 0, "궁중 마법사", "조금 늦었네. 얼마나 기다렸다고.", 1.)
      call QMsg(P, 0, "궁중 마법사", "어서 줘 봐.", 1.)
      call QMsg(P, 0, "궁중 마법사", "...", 1.)
      call QMsg(P, 0, "궁중 마법사", ".....", 1.)
      call QMsg(P, 0, "궁중 마법사", ".....응? 거기서 뭐 해?", 1.)
      call QMsg(P, 0, "플레이어", "저기.. 보수는..", 1.)
      call QMsg(P, 0, "궁중 마법사", "좋아, 우선 5만 골드씩 주지.", 1.)
      set bj_forLoopAIndex = 1
      loop
        exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( udg_SysB_Level[bj_forLoopAIndex] >= 99 ) then
          call SaveInteger(udg_hash, StringHash("QLevel13"), bj_forLoopAIndex, 3)
          call MSG(Player(bj_forLoopAIndex-1), 2, 10, "|c00fd8505퀘스트 완료!!|r\n\n궁중 마법사를 도와주고 50,000G를 받았습니다!")
          call MakeTestt(bj_forLoopAIndex, true, 50000)
          if ( P != bj_forLoopAIndex ) then
            set udg_Quest_ClearInt_13[P] = IMaxBJ(udg_Quest_ClearInt_13[P], udg_Quest_ClearInt_13[bj_forLoopAIndex])
            set udg_Quest_ClearInt_13[bj_forLoopAIndex] = 0
          endif
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
      set udg_Quest_ClearInt_13[P] = udg_Quest_ClearInt_13[P] - 100
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call QMsg(P, 0, "플레이어", "설마.. 끝인가요?", 1.)
      call QMsg(P, 0, "궁중 마법사", "뭐? 자넨 날 놀라게 하는군. 고작 이만큼 구해와서 보수를 바라는거야? 보수를 원한다면 500개는 더 구해 와! 하여간 요즘 젊은것들은.. 쯧쯔..", 1.)
      call QMsg(P, 0, "플레이어", "|c008bc7fc(@!#$@#$!#!) |c00ffff00예... 알.겠.습.니.다.", 1.)
    endif
  elseif ( Quest_Level(P, 13) == 3 ) then
    if ( udg_Quest_ClearInt_13[P] < 500 ) then
      call QMsg(P, 0, "궁중 마법사", "혼돈의 핵 500개를 가져 오도록.", 1.)
    else
      call QMsg(P, 0, "플레이어", "혼돈의 핵 500개를 구해 왔습니다.", 1.)
      call QMsg(P, 0, "궁중 마법사", "마침 잘 왔네. 어서 혼돈의 핵을 이리 줘.", 1.)
      call QMsg(P, 0, "플레이어", "물론 드리겠습니다.. 하지만.", 1.)
      call QMsg(P, 0, "플레이어", "보수 먼저 주시죠.", 1.)
      call QMsg(P, 0, "궁중 마법사", "아 거참..", 2.)
      set bj_forLoopAIndex = 1
      loop
        exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) then
        set udg_Quest_ClearInt_13[0] = IMaxBJ(udg_Quest_ClearInt_13[0], udg_Quest_ClearInt_13[bj_forLoopAIndex])
        call MakeTestt(bj_forLoopAIndex, true, 50000)
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
      
      call DisableTrigger(GetTriggeringTrigger())
      loop
        exitwhen udg_Quest_ClearInt_13[0] < 500
        
        set bj_forLoopAIndex = 1
        loop
          exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
          if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( udg_SysB_Level[bj_forLoopAIndex] >= 86 ) then
            call SaveInteger(udg_hash, StringHash("QLevel13"), bj_forLoopAIndex, 3)
            
            if ( GetHeroLevel(udg_Unit[bj_forLoopAIndex]) < 99 ) then
              call MakeTestt(bj_forLoopAIndex, false, 7000000)
              call MSG(Player(bj_forLoopAIndex-1), 2, 10, "|c00fd8505퀘스트 완료!!|r\n\n궁중 마법사를 도와주고 50,000G와 7M의 경험치, 그리고 엑스쿠라눔을 2개 받았습니다!")
            else
              call MSG(Player(bj_forLoopAIndex-1), 2, 10, "|c00fd8505퀘스트 완료!!|r\n\n궁중 마법사를 도와주고 50,000G와 15M의 경험치, 그리고 엑스쿠라눔을 2개 받았습니다!")
              
              call MakeTestt(bj_forLoopAIndex, false, 15000000)
            endif

            
            call GiveItem(bj_forLoopAIndex, 'I084', 2)
            
            set udg_Quest_ClearInt_13[bj_forLoopAIndex] = 0
            call Quest_End(bj_forLoopAIndex, 13, true)
            call SaveInteger(udg_hash, bj_forLoopAIndex, StringHash("Exp"), LoadInteger(udg_hash, bj_forLoopAIndex, StringHash("Exp"))-(LoadInteger(udg_hash, 100, StringHash("Exp2"))/2))
          endif
          set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
        
        set udg_Quest_ClearInt_13[0] = udg_Quest_ClearInt_13[0] - 500
        call TriggerSleepAction(.01)
      endloop
      call EnableTrigger(GetTriggeringTrigger())
      set udg_Quest_ClearInt_13[P] = udg_Quest_ClearInt_13[0]
      call TriggerSleepAction(udg_Quest_WaitTime[P])
      call QMsg(P, 0, "궁중 마법사", "됐나? 어서 주게. 빨리 연구를 해야 해.", 1.)
      call QMsg(P, 0, "플레이어", "여기 있습니다. ^^", 1.)
      call QMsg(P, 0, "궁중 마법사", "수고했어. 이제 난 연구를 해야하니 방해하지 말아 줬으면 좋겠어.", 1.)
    endif
  endif
  call Quest_End2(P)
endfunction

function Trig_Quest_13_Actions takes nothing returns nothing
  call Quest13(GetAttacker())
endfunction

//===========================================================================
function InitTrig_Quest_13 takes nothing returns nothing
    set gg_trg_Quest_13 = CreateTrigger(  )
    call TriggerRegisterUnitEvent( gg_trg_Quest_13, gg_unit_Hkal_0069, EVENT_UNIT_ATTACKED )
    call TriggerAddAction( gg_trg_Quest_13, function Trig_Quest_13_Actions )
endfunction

//===========================================================================
// Trigger: Quest 13 B
//
// 4~10(6+) // 1
// 14~28 (10+) (10~29) // 3 (45) , 4000
// 33~47(30+) (30~49) // 8 (120) , 13000
// 48~68(50+) (50~70) // 20 (300) , 40000
// Lv/3
// 60
// 170
// 300
//===========================================================================
function Quest13_Condi takes nothing returns boolean
  return ( IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) ) and ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] == udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetKillingUnit()))+1] )
endfunction

function Quest13_Action takes nothing returns nothing
  set quest_temp_i = GetPlayerId(GetOwningPlayer(GetEnumUnit()))+1
  set udg_Quest_ClearInt_13[quest_temp_i] = udg_Quest_ClearInt_13[quest_temp_i] + 1
  if ( udg_Quest_ClearInt_13[quest_temp_i] == 10 or ModuloInteger(udg_Quest_ClearInt_13[quest_temp_i],50) == 0 ) then
    call MSG(Player(quest_temp_i-1), 1, 8., "　혼돈의 핵 : [ |cff46ffff" + I2S(udg_Quest_ClearInt_13[quest_temp_i]) + "|cffffdc3c ]개")
  endif
endfunction

function Trig_Quest_13_C_Actions takes nothing returns nothing
  if ( GetRandomReal(0.,100.) <= 50. ) then
    set udg_temp_g = GetGroupRange(udg_temp_g, GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), 1100., Condition(function Quest13_Condi))
    call ForGroup( udg_temp_g, function Quest13_Action)
    call DestroyGroup( udg_temp_g )
  endif
endfunction

//===========================================================================
function InitTrig_Quest_13_B takes nothing returns nothing
  set gg_trg_Quest_13_B = CreateTrigger(  )
  call TriggerAddAction( gg_trg_Quest_13_B, function Trig_Quest_13_C_Actions )
endfunction

//===========================================================================
// Trigger: Quest 14
//===========================================================================
function Quest14 takes unit user returns nothing
 //외형: 모탈팀, 말투: 반말, 우하하 ~쇼, !, 잽싸게, 우리
 local integer P = GetPlayerId(GetOwningPlayer(user))+1
  if ( Quest_Level(P, 14) == -1 ) then
    call QMsg(P, 0, "퇴역경비조", "또 도와주러 왔나? 탱글한 고기는 언제든 환영이야!", 0.)
    call SaveInteger(udg_hash, StringHash("QLevel14"), P, 1)
    call Quest14(user)
  elseif ( GetHeroLevel(user) < 99 ) then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", user, "overhead"))
      call QMsg(P, 0, "퇴역경비조", "어떻게 이런 약골이 여기 왔지? [레벨제한 99 이상]", .5)
  elseif ( P != udg_PartyNumber_ThisP[P] ) then
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", user, "overhead"))
    call QMsg(P, 0, "퇴역경비조", "니가 그쪽 리더야? 리더를 불러 와.", .5)
  elseif ( Quest_Level(P, 14) == 0 ) then    
    call Quest_Start(P, 14, true)
    call QMsg(P, 0, "퇴역경비조", "헤이, 여길 보쇼", 1.)
    call QMsg(P, 0, "퇴역경비조", "눈 마주친 너, 너말야", 1.)
    call QMsg(P, 0, "플레이어", "무슨 일이시죠?", 1.)
    call QMsg(P, 0, "퇴역경비조", "우하하! 이런곳에서 사람을 만나다니 반가워! 거의 "+I2S(GetRandomInt(5,20))+"년만인걸?", 1.)
    call QMsg(P, 0, "플레이어", "|c008bc7fc(어떻게 살아온거지..)", 1.)
    call QMsg(P, 0, "퇴역경비조", "여기 뭐가 나오는줄은 아쇼?", 1.)
    call QMsg(P, 0, "플레이어", "뭐가 나오나요?", 1.)
    call QMsg(P, 0, "퇴역경비조", "놀라지 말고 잘 들어! 여긴 시체가 걸어다녀!", 1.)
    call QMsg(P, 0, "플레이어", "시체라.. 좀비 말씀이신가요?", 1.)
    call QMsg(P, 0, "퇴역경비조", "그래! 겁많은 놈들은 꽁무니 빼기 바쁘지. 너는 어때?", 1.)
    call QMsg(P, 0, "플레이어", "저는 담이 크다고 자부합니다.", 1.)
    call QMsg(P, 0, "퇴역경비조", "오 그래? 그럼 우리 부탁을 좀 들어주쇼", 1.)
    call QMsg(P, 0, "플레이어", "무엇을 도와드릴까요?", 1.)
    call QMsg(P, 0, "퇴역경비조", "우리가 여기에 고립된 몇년동안 어떻게 살았을것 같아?", 1.)
    call QMsg(P, 0, "퇴역경비조", "바로 저것들을 먹으면서 살았어!", 1.)
    call QMsg(P, 0, "플레이어", "시체를 먹었단 말씀인가요?", 1.)
    call QMsg(P, 0, "퇴역경비조", "시체라니! 저렇게 돌아다니는 시체가 어딨나!", 1.)
    call QMsg(P, 0, "퇴역경비조", "그리고 저것들 살점이 얼마나 탱글하고 활력이 넘치는지, 지금 내 뱃속에서도 움직이는것 같아.", 1.)
    call QMsg(P, 0, "플레이어", "|c008bc7fc(역시, 미쳐버린게 분명하다..)", 1.)
    call QMsg(P, 0, "퇴역경비조", "그런데, 요즘은 저것들이 너무 많이 나와서 한놈씩 잡기가 힘들더만!", 1.)
    call QMsg(P, 0, "퇴역경비조", "저것들좀 잡아서 탱글한 살점을 좀 모아주겠어?", 1.)

    call QMsg(P, 0, "플레이어", "얼마나요?", .5)
    call QMsg(P, 0, "퇴역경비조", "그래도 50개는 모아줘! 그럼 잽싸게 다녀오라고!", 1.)
    call QMsg(P, 7, "1", "괴짜 미식가인 퇴역경비조를 위해, 죽음의 마을을 소탕하자!\n자세한건 |cffc3dbff\"-퀘스트\"|cffffdc3c를 입력.", .5)
  elseif ( Quest_Level(P, 14) == 1 ) then
    if ( udg_Quest_ClearInt_14 < 50 ) then
      call QMsg(P, 0, "퇴역경비조", "50개는 되어야 둘이 나눠먹을 수 있다구!", 1.)
    else
      call Quest_Start(P, 14, true)
      call QMsg(P, 0, "퇴역경비조", "우헤헤! 많이 모아왔는걸?", 1.)
      call QMsg(P, 0, "퇴역경비조", "조금만 기다려봐, 무엇을 줄까 보자..", 5.)
      set bj_forLoopAIndex = 1
      loop
        exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( udg_SysB_Level[bj_forLoopAIndex] >= 99 ) then
          call Quest_End(bj_forLoopAIndex, 14, false)
          call MakeTestt(bj_forLoopAIndex, true, 150000)
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
      call TriggerSleepAction(1.)
      
      call DisableTrigger(GetTriggeringTrigger())
      loop
        exitwhen udg_Quest_ClearInt_14 < 50
        set bj_forLoopAIndex = 1
        loop
          exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
          if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( udg_SysB_Level[bj_forLoopAIndex] >= 99 ) then
            call QMsg(bj_forLoopAIndex, 7., "2", "퇴역경비조를 도와주고 150,000G와 경험치 15M+과 엑스쿠라눔 "+I2S(2)+"개를 받았습니다!", 0.)
            call MakeTestt(bj_forLoopAIndex, false, udg_Quest_ClearInt_14_2*500000 + 15000000)
            call MakeTestt(bj_forLoopAIndex, false, udg_Quest_ClearInt_14_2*500000 + 15000000)
            call GiveItem(bj_forLoopAIndex, 'I084', 2)
            call SetItemUserData(bj_lastCreatedItem, bj_forLoopAIndex)
            set udg_SysL_Wood[bj_forLoopAIndex] = GetPlayerState(Player(bj_forLoopAIndex-1), PLAYER_STATE_RESOURCE_LUMBER)
          endif
          set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
        set udg_Quest_ClearInt_14 = udg_Quest_ClearInt_14 - 50
        set udg_Quest_ClearInt_14_2 = udg_Quest_ClearInt_14_2 + 1
        call TriggerSleepAction(.1)
      endloop
      call EnableTrigger(GetTriggeringTrigger())
      call QMsg(P, 0, "퇴역경비조", "수고 많았네! 한동안 먹을게 많겠구만!", 1.)
    endif
  endif
  call Quest_End2(P)
endfunction
function Trig_Quest_14_Actions takes nothing returns nothing
  call Quest14(GetAttacker())
endfunction

//===========================================================================
function InitTrig_Quest_14 takes nothing returns nothing
    set gg_trg_Quest_14 = CreateTrigger(  )
    call TriggerRegisterUnitEvent( gg_trg_Quest_14, gg_unit_hmtm_0369, EVENT_UNIT_ATTACKED )
    call TriggerAddAction( gg_trg_Quest_14, function Trig_Quest_14_Actions )
endfunction

//===========================================================================
// Trigger: Quest 14 B
//
// 4~10(6+) // 1
// 14~28 (10+) (10~29) // 3 (45) , 4000
// 33~47(30+) (30~49) // 8 (120) , 13000
// 48~68(50+) (50~70) // 20 (300) , 40000
// Lv/3
// 60
// 170
// 300
//===========================================================================
function Trig_Quest_14_C_Actions takes nothing returns nothing
  if ( GetRandomReal(0.,100.) <= 10. ) then
    set udg_Quest_ClearInt_14 = udg_Quest_ClearInt_14 + 1
    if ( ModuloInteger(udg_Quest_ClearInt_14,25) == 0 ) then
      call MSGAll(GetPlayerId(GetOwningPlayer(GetEnumUnit()))+1, false, 99, 1, 8, "　좀비 살점 : [ |cff46ffff" + I2S(udg_Quest_ClearInt_14) + "|cffffdc3c ]개")
    endif
  endif
endfunction

//===========================================================================
function InitTrig_Quest_14_B takes nothing returns nothing
  set gg_trg_Quest_14_B = CreateTrigger(  )
  call TriggerAddAction( gg_trg_Quest_14_B, function Trig_Quest_14_C_Actions )
endfunction

//===========================================================================
// Trigger: Quest 15
//===========================================================================
function Quest15 takes unit user returns nothing
 //외형: 마운틴킹, 말투: ~세, ~게나.
 local integer P = GetPlayerId(GetOwningPlayer(user))+1
  if ( udg_Quest_ClearInt_15 == 0 ) then
    call QMsg(P, 0, "마인 촌장", "어느쪽으로 도전하겠나?", 1.)
    call QMsg(P, 0, "0", "(클릭하여 관련 아이템을 구입하세요)", .5)
  elseif ( udg_Quest_ClearInt_15 < 12 ) then
    call QMsg(P, 0, "마인 촌장", "아쉽구만! 다음엔 더 좋은 결과가 있을걸세!", 0.)
  else
    call QMsg(P, 0, "마인 촌장", "축하하네! "+I2S(udg_Quest_ClearInt_15/2)+"단계까지 가다니 말야!", 0.)
  endif
endfunction
function Trig_Quest_15_Actions takes nothing returns nothing
  call Quest15(GetAttacker())
endfunction

//===========================================================================
function InitTrig_Quest_15 takes nothing returns nothing
    set gg_trg_Quest_15 = CreateTrigger(  )
    call TriggerRegisterUnitEvent( gg_trg_Quest_15, gg_unit_Hmkg_0135, EVENT_UNIT_ATTACKED )
    call TriggerAddAction( gg_trg_Quest_15, function Trig_Quest_15_Actions )
endfunction

//===========================================================================
// Trigger: Quest 15 D BuyItems
//
// rej6, dphe
// wswd,rump,rej3,phea
// hp mp x2 exp
//===========================================================================
constant function MineItemData takes integer ic, boolean xcu returns integer
  if ( ic == 'rej6') then
    if ( xcu ) then
      return 0
    else
      return 1
    endif
  elseif ( ic == 'dphe') then
    if ( xcu ) then
      return 50
    else
      return 2
    endif

  elseif ( ic == 'wswd') then
    if ( xcu ) then
      return 35
    else
      return 3
    endif
  elseif ( ic == 'rump') then
    if ( xcu ) then
      return 65
    else
      return 4
    endif
  elseif ( ic == 'rej3') then
    if ( xcu ) then
      return 50
    else
      return 5
    endif
  elseif ( ic == 'phea') then
    if ( xcu ) then
      return 100
    else
      return 6
    endif
  elseif ( ic == 'bspd') then
    if ( xcu ) then
      return 30
    else
      return 7
    endif
  elseif ( ic == 'fgsk') then
    if ( xcu ) then
      return 0
    else
      return 8
    endif
  elseif ( ic == 'pgma') then
    if ( xcu ) then
      return 1
    else
      return 9
    endif
  endif
  return 0
endfunction
function ZombieKillAll takes nothing returns nothing
    call KillUnit( GetEnumUnit() )
endfunction
function ResetZombieQuest takes nothing returns nothing
  call RemoveUnit(gg_unit_o00I_0214)
  call DestroyTimerDialog(udg_Quest_ClearInt_15_TimerWindow)
  set udg_Quest_ClearInt_15 = 0
  set udg_Quest_ClearInt_15_Hard = false
  set udg_Quest_ClearInt_15_Explosion = 0.
  call DestroyTimer(udg_Quest_ClearInt_15_Timer)
  set udg_Quest_ClearInt_15_Timer = CreateTimer()
  
  set udg_temp_g = CreateGroup()
  set bj_groupEnumOwningPlayer = Player(PLAYER_NEUTRAL_AGGRESSIVE)
  call GroupEnumUnitsInRect(udg_temp_g, gg_rct_Hunting_67, filterGetUnitsInRectOfPlayer)
  call DisableTrigger(gg_trg_Sys_Zombie_Revive)
  call ForGroup(udg_temp_g, function ZombieKillAll)
  call EnableTrigger(gg_trg_Sys_Zombie_Revive)
  set udg_Quest_ClearInt_15_count = -1
endfunction
function Trig_Item_Buy_Mines_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
 local integer no = MineItemData(GetItemTypeId(GetManipulatedItem()),false)
  if ( CountItem(P, 'I084') >= MineItemData(GetItemTypeId(GetManipulatedItem()),true) ) then
    call MinusItem(P, 'I084', MineItemData(GetItemTypeId(GetManipulatedItem()),true))
    if ( no == 1 ) or ( no == 2 ) then
      call SetUnitAnimation(gg_unit_Hmkg_0135, "spell slam" )
      if ( P != udg_PartyNumber_ThisP[P] ) then
        call QMsg(P, 0, "마인 촌장", "파티장만 이동 가능할세.", .5)
        if ( no == 2 ) then
          call GiveItem(P, 'I084', MineItemData(GetItemTypeId(GetManipulatedItem()),true))
        endif
      elseif ( udg_Quest_ClearInt_15 >= 12 ) then
        call QMsg(P, 0, "마인 촌장", "자네들은 이미 깼구만..", .5)
      else
      //이동 노말/하드
        call RemoveItemFromStock(gg_unit_Hmkg_0135, GetItemTypeId(GetManipulatedItem()))
        set bj_forLoopAIndex = 1
        loop
          exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
          if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == P ) then
            if ( udg_SysB_Level[bj_forLoopAIndex] >= 99 ) and ( GetWidgetLife(udg_Unit[bj_forLoopAIndex]) > 0.4 ) then
              if ( no == 2 ) then
              //2 - 하드모드, 팀원전체 엑쿠 -
                if ( P == bj_forLoopAIndex ) or ( MinusItem(bj_forLoopAIndex, 'I084', MineItemData(GetItemTypeId(GetManipulatedItem()),true)) ) then
                  call SetUnitPosition(udg_Unit[bj_forLoopAIndex], 21760., -12640.)
                  call SetCameraXY(Player(bj_forLoopAIndex-1), GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]))
                  set udg_OnesPositionN[bj_forLoopAIndex] = 67
                else
                  if ( bj_forLoopAIndex == udg_PartyNumber_ThisP[P] ) then
                    call MSGAll(bj_forLoopAIndex, false, 1, 2, 12, "|cff0080ff파티장 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80엑쿠 부족 |cff0080ff]")
                  else
                    call MSGAll(bj_forLoopAIndex, false, 1, 2, 11, "|cff00ffff파티원 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80엑쿠 부족 |cff00ffff]")
                  endif
                endif
              else
                call SetUnitPosition(udg_Unit[bj_forLoopAIndex], 21760., -12640.)
                call SetCameraXY(Player(bj_forLoopAIndex-1), GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]))
                set udg_OnesPositionN[bj_forLoopAIndex] = 67
              endif
            endif
          endif
          set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
        call MSGAll(P, false, 1, 2, 7., "|c00ff8000마인 촌장|r: |c00ffff00곧 시작되니 자리를 잡게나, 무운을 비네!")
        //#30초 후 시작됩니다. 자리를 잡으세염 + 타이머창 + 무운을 비네
        call ResetZombieQuest()
        call TimerStart(udg_Quest_ClearInt_15_Timer, 30., false, null)
        set udg_Quest_ClearInt_15_TimerWindow = CreateTimerDialog(udg_Quest_ClearInt_15_Timer)
        call TimerDialogSetTitle(udg_Quest_ClearInt_15_TimerWindow, "시작까지..")
        call TimerDialogDisplay(udg_Quest_ClearInt_15_TimerWindow, true)
          
        call TriggerRegisterTimerExpireEvent(gg_trg_Quest_15_Loop, udg_Quest_ClearInt_15_Timer)
        set udg_Quest_ClearInt_15 = 1
        if ( no == 2 ) then
          set udg_Quest_ClearInt_15_Hard = true
          set udg_Quest_ClearInt_15_Explosion = 10.
        else
          set udg_Quest_ClearInt_15_Explosion = 0.
        endif
      
      
      
        if ( udg_Quest_ClearInt_15_mobWindow == null ) then
          set udg_Quest_ClearInt_15_mobWindow = CreateTextTag()
          call SetTextTagPos(udg_Quest_ClearInt_15_mobWindow, 21664., -12288., 0.)
          call SetTextTagText(udg_Quest_ClearInt_15_mobWindow, "오염도: 00.0%", 0.025)
          call SetTextTagPermanent(udg_Quest_ClearInt_15_mobWindow, true)
          call SetTextTagLifespan(udg_Quest_ClearInt_15_mobWindow, 999.)
        endif
      endif
    else
      call SetUnitAnimation(gg_unit_Hmbr_0207, "spell slam" )
      call RemoveItemFromStock(gg_unit_Hmbr_0207, GetItemTypeId(GetManipulatedItem()))
      if ( no == 3 ) or ( no == 4 ) then
      //토템 구입
        if ( GetWidgetLife(gg_unit_o00I_0214) > 0.4 ) then
          call SetWidgetLife(gg_unit_o00I_0214, 600.)
        else
          set gg_unit_o00I_0214 = CreateUnit(Player(PLAYER_NEUTRAL_PASSIVE), 'o00I', 21760., -12608., bj_UNIT_FACING)
        endif
        if ( no == 3 ) then
          call UnitAddAbility(gg_unit_o00I_0214, 'A09V')
        else
          call UnitAddAbility(gg_unit_o00I_0214, 'A09W')
        endif
      elseif ( no == 5 ) then
      //대기시간 2배
        set udg_Quest_ClearInt_15_Wait2X = true
      elseif ( no == 6 ) then
      //경험치 부스터, 개인 엑쿠 -
        
        set bj_forLoopAIndex = 1
        loop
          exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
          if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == P ) then
            set udg_SysK_ExpAdd[bj_forLoopAIndex] = udg_SysK_ExpAdd[bj_forLoopAIndex]+10
            call MSG(Player(P-1), 1, 12, "경험치 부스터 구입으로...\n  경험치 획득률이 "+I2S(10)+"% 상승합니다.")
          endif
          set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
      elseif ( no == 7 ) then
        if ( udg_Quest_ClearInt_15 == 21 ) then
          call QMsg(P, 0, "마인 촌장", "어디까지 갈 수 있을까? 도전은 언제나 환영일세!", 0.)
        else
          call QMsg(P, 0, "마인 촌장", "아직은 이를세, 10웨이브가 나오고 진행하게나!", 0.)
        endif
        
      
        call TimerStart(udg_Quest_ClearInt_15_Timer, 10., false, null)
        
        call DestroyTimerDialog(udg_Quest_ClearInt_15_TimerWindow)
        set udg_Quest_ClearInt_15_TimerWindow = CreateTimerDialog(udg_Quest_ClearInt_15_Timer)
        call TimerDialogSetTitle(udg_Quest_ClearInt_15_TimerWindow, "무한모드 시작..")
        call TimerDialogDisplay(udg_Quest_ClearInt_15_TimerWindow, true)
      elseif ( no == 8 ) then
        if ( P != udg_PartyNumber_ThisP[P] ) then
          call QMsg(P, 0, "마인 촌장", "파티장만 이동 가능할세.", .5)
        else
          call QMsg(P, 0, "마인 촌장", "고생했네!", 1.)
          set bj_forLoopAIndex = 1
          loop
            exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
            if ( udg_OnesPositionN[bj_forLoopAIndex] == 67 ) then
              set udg_OnesPositionN[bj_forLoopAIndex] = 61
              call SetUnitPosition(udg_Unit[bj_forLoopAIndex], 18240., -11104.)
              call MSG(Player(bj_forLoopAIndex-1), 5, 7, "죽음의 마을 입구")
            endif
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
          endloop
          set udg_Quest_ClearInt_15_mob = 201
        endif
      elseif ( no == 9 ) then
        if ( ModuloInteger(udg_Quest_ClearInt_15,2) == 0 ) then
          call MSG(Player(P-1), 1, 12, "대기시간에만 사용 가능합니다.")
        else
          if ( GetRandomReal(0., 100.) <= 20. ) then
            call QMsg(P, 0, "마인 촌장", "호쾌하구만!", .5)
          elseif ( GetRandomReal(0., 80.) <= 20. ) then
            call QMsg(P, 0, "마인 촌장", "마음에 들어!", .5)
          elseif ( GetRandomReal(0., 60.) <= 20. ) then
            call QMsg(P, 0, "마인 촌장", "무리하는건 아닌가?", .5)
          elseif ( GetRandomReal(0., 40.) <= 20. ) then
            call QMsg(P, 0, "마인 촌장", "조심하게나!", .5)
          else
            call QMsg(P, 0, "마인 촌장", "얼마 안남았네!", .5)
          endif
          call TimerStart(udg_Quest_ClearInt_15_Timer, .1, false, null)
        endif
      endif
    endif
  else
    if ( no >= 3 ) and ( no <= 6 ) then
      call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) + 450000)
    elseif ( no == 7 ) then
      call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) + 100000)
    endif
    call MSG(Player(P-1), 1, 6., "엑스쿠라눔이 "+I2S(MineItemData(GetItemTypeId(GetManipulatedItem()),true))+"병 이상 필요합니다.")
  endif
  call RemoveItem(GetManipulatedItem())
endfunction

//===========================================================================
function InitTrig_Quest_15_D_BuyItems takes nothing returns nothing
    set gg_trg_Quest_15_D_BuyItems = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Quest_15_D_BuyItems, function Trig_Item_Buy_Mines_Actions )
endfunction

//===========================================================================
// Trigger: Quest 15 Loop
//
// 6웨이브 10%/15%
// 2웨이브당 1% (최대 15%/30%)
//===========================================================================
function RandomZombie takes real p returns integer
  if ( p <= 25. ) then
    return 'n048'
  elseif ( p <= 45. ) then
    return 'n047'
  elseif ( p <= 60. ) then
    return 'n049'
  elseif ( p <= 75. ) then
    return 'n04A'
  elseif ( p <= 90. ) then
    return 'n04B'
  else
    return 'n04C'
  endif
endfunction
function ZombieCreate takes nothing returns nothing
 local real angle = GetRandomReal(0., 360.)
 local real x = GetRandomReal(1600.,1900.)
 local real y = GetRandomReal(0.,100.)
  set udg_Quest_ClearInt_15_count = udg_Quest_ClearInt_15_count - 1
  if ( udg_Quest_ClearInt_15_count <= 0 ) then
    call DestroyTimer(GetExpiredTimer())
  endif
  if ( y <= 50. ) then
    set x = -x
  endif
  set y = -12288. + ( x * Sin(angle * bj_DEGTORAD) )
  set x =  21760. + ( x * Cos(angle * bj_DEGTORAD) )
  set bj_lastCreatedUnit = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), RandomZombie(GetRandomReal(0.,100.)), x, y, angle+180.)

  if ( udg_Quest_ClearInt_15_Hard ) then
    if ( GetRandomReal(0., 100.) <= ((udg_Quest_ClearInt_15)/2)*10. ) then
      call UnitAddAbility(bj_lastCreatedUnit, 'A047')
      set x = ((udg_Quest_ClearInt_15)/2)*0.15+1.
    else
      set x = ((udg_Quest_ClearInt_15)/2)*0.15
    endif
  elseif ( GetRandomReal(0., 100.) <= ((udg_Quest_ClearInt_15)/2)*5. ) then
    call UnitAddAbility(bj_lastCreatedUnit, 'A047')
    set x = ((udg_Quest_ClearInt_15)/2)*0.15+1.
  else
    set x = ((udg_Quest_ClearInt_15)/2)*0.15
  endif
  call SaveReal(udg_hash, GetHandleId(bj_lastCreatedUnit), StringHash("BonusHP"), x)
  call SetUS("Hp", bj_lastCreatedUnit, R2I(GetWidgetLife(bj_lastCreatedUnit)*x), true)
  call ZombieMonster(bj_lastCreatedUnit, GetUnitAbilityLevel(bj_lastCreatedUnit, 'A047')>0)
  call IssuePointOrder(bj_lastCreatedUnit, "patrol", 21760., -12288.)
  call SetUnitUserData(bj_lastCreatedUnit, -1)
endfunction
function CreateZombie takes integer count, real time returns nothing
 local timer t = CreateTimer()
  set udg_Quest_ClearInt_15_count = count
  call TimerStart(t, 0.3125, true, function ZombieCreate)
endfunction
native JNSetLog takes string MapId, string UserId, string SecretKey, string Character, string Version, string Loging returns string

function Trig_Quest_15_Loop_Actions takes nothing returns nothing
 local integer loopA = 1
  set udg_Quest_ClearInt_15 = udg_Quest_ClearInt_15 + 1
  if ( ModuloInteger(udg_Quest_ClearInt_15,2) == 0 ) then
  //시작, 진행중 타이머 창 표시 후...
    if ( udg_Quest_ClearInt_15_mob <= 200 ) then
    //오염도 100% 될 때 x -> 라운드 시작할때 오염도가 100%일때 : 실패
      call CreateZombie(100, 0.3125)
      call TimerStart(udg_Quest_ClearInt_15_Timer, 31., false, null)
      call TimerDialogSetTitle(udg_Quest_ClearInt_15_TimerWindow, "웨이브 "+I2S(udg_Quest_ClearInt_15/2)+" 진행중..")
    else
      call SetTextTagText(udg_Quest_ClearInt_15_mobWindow, "도전 실패 !", 0.025)
      call SetTextTagPermanent(udg_Quest_ClearInt_15_mobWindow, false)
      call SetTextTagLifespan(udg_Quest_ClearInt_15_mobWindow, 30.)
      
      if ( udg_Quest_ClearInt_15 >= 12 ) then
        set udg_Quest_ClearInt_15_Explosion = -10.
        
        if ( udg_Quest_ClearInt_15 >= 50 ) then
        /* 로그 기록 */
          set bj_forLoopAIndex = 1
          loop
            if ( udg_OnesPositionN[bj_forLoopAIndex] == 67 ) then
              if ( GetLocalPlayer() == Player(bj_forLoopAIndex-1) ) then
                //call JNPublicMapServerLog(JN_MAPID, JN_SECRETKEY, BaseStr(9), udg_SysB_Name[bj_forLoopAIndex]+"님 파티가 좀비웨이브 "+I2S(udg_Quest_ClearInt_15/2)+" 레벨을 달성했습니다.")
                call JNSetLog(JN_MAPID, udg_SysB_Name[bj_forLoopAIndex], JN_SECRETKEY, GetUnitName(udg_Unit[bj_forLoopAIndex]), BaseStr(9), "파티가 좀비웨이브 "+I2S(udg_Quest_ClearInt_15/2)+" 레벨을 달성했습니다.")
              endif
              exitwhen true
            endif
            exitwhen bj_forLoopAIndex >= bj_MAX_PLAYERS
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
          endloop
        endif
      endif
      //펑 !
      call ResetZombieQuest()
      return
    endif
  elseif ( udg_Quest_ClearInt_15 == 21 ) then
    call DestroyTimerDialog(udg_Quest_ClearInt_15_TimerWindow)
  else
    if ( udg_Quest_ClearInt_15_Wait2X ) then
      call TimerStart(udg_Quest_ClearInt_15_Timer, RMinBJ(60.,20.+(udg_Quest_ClearInt_15/2*10)), false, null)
    else
      call TimerStart(udg_Quest_ClearInt_15_Timer, RMinBJ(30.,10.+(udg_Quest_ClearInt_15/2*5)), false, null)
    endif
    call TimerDialogSetTitle(udg_Quest_ClearInt_15_TimerWindow, "웨이브 "+I2S(udg_Quest_ClearInt_15/2+1)+" 대기중..")
  endif
  
  if ( udg_Quest_ClearInt_15 == 12 ) then
    set bj_forLoopAIndex = 1
    loop
      exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
      
      set udg_SysK_ExpAdd[bj_forLoopAIndex] = udg_SysK_ExpAdd[bj_forLoopAIndex]+10
      call MSG(Player(bj_forLoopAIndex-1), 1, 12, I2S(udg_Quest_ClearInt_15/2) + " 웨이브 달성 보상으로..\n  경험치 획득률이 "+I2S(10)+"% 상승합니다.")
        
      if ( udg_Quest_ClearInt_15_Hard ) and ( udg_OnesPositionN[bj_forLoopAIndex] == 67 ) then
      //엑쿠 반환
        call GiveItem(bj_forLoopAIndex, 'I084', 50)
        call SetItemUserData(bj_lastCreatedItem, bj_forLoopAIndex)
        call MSG(Player(bj_forLoopAIndex-1), 1, 12, I2S(udg_Quest_ClearInt_15/2) + " 웨이브 달성 보상으로..\n  엑스쿠라눔이 반환됩니다.")
      endif
      set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
  elseif ( udg_Quest_ClearInt_15 >= 16 ) and ( ModuloInteger(udg_Quest_ClearInt_15,4) == 0 ) then
    if ( udg_Quest_ClearInt_15 <= 32 ) then
      set bj_forLoopAIndex = 1
      loop
        exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
        set udg_SysK_ExpAdd[bj_forLoopAIndex] = udg_SysK_ExpAdd[bj_forLoopAIndex]+1
        call MSG(Player(bj_forLoopAIndex-1), 1, 12, I2S(udg_Quest_ClearInt_15/2) + " 웨이브 달성 보상으로..\n  경험치 획득률이 총 "+I2S(udg_Quest_ClearInt_15/2+7)+"% 상승합니다.")
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
    elseif ( udg_Quest_ClearInt_15_Hard ) and ( udg_Quest_ClearInt_15 <= 60 ) then
      set bj_forLoopAIndex = 1
      if ( udg_Quest_ClearInt_15_Hard ) and ( udg_Quest_ClearInt_15 == 60 ) then
        loop
          exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
          set udg_SysK_ExpAdd[bj_forLoopAIndex] = udg_SysK_ExpAdd[bj_forLoopAIndex]+3
          call MSG(Player(bj_forLoopAIndex-1), 1, 12, I2S(udg_Quest_ClearInt_15/2) + " 웨이브(하드) 달성 최종 보상으로..\n  경험치 획득률이 총 "+I2S(udg_Quest_ClearInt_15/2)+"% 상승합니다.")
          set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
      else
        loop
          exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
          set udg_SysK_ExpAdd[bj_forLoopAIndex] = udg_SysK_ExpAdd[bj_forLoopAIndex]+2
          call MSG(Player(bj_forLoopAIndex-1), 1, 12, I2S(udg_Quest_ClearInt_15/2) + " 웨이브(하드) 달성 보상으로..\n  경험치 획득률이 총 "+I2S(udg_Quest_ClearInt_15/2-1)+"% 상승합니다.")
          set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
      endif
    endif
    
    set loopA = 1
    loop
      exitwhen loopA > bj_MAX_PLAYERS
      
      if ( udg_OnesPositionN[loopA] == 67 ) then
        call RankEx_HighSave(loopA, 4, udg_Quest_ClearInt_15/2, GetUnitName(udg_Unit[loopA]))
      endif
      set loopA = loopA + 1
    endloop
  endif
endfunction

//===========================================================================
function InitTrig_Quest_15_Loop takes nothing returns nothing
    set gg_trg_Quest_15_Loop = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Quest_15_Loop, function Trig_Quest_15_Loop_Actions )
endfunction

//===========================================================================
// Trigger: Quest 15 Enter Mob
//===========================================================================
function Trig_Quest_15_Enter_Mob_Conditions takes nothing returns boolean
 return ( GetOwningPlayer(GetTriggerUnit()) == Player(PLAYER_NEUTRAL_AGGRESSIVE) ) and ( GetUnitLevel(GetTriggerUnit()) >= 120 )
endfunction
function Pollution takes boolean add returns nothing
  if ( add ) then
    set udg_Quest_ClearInt_15_mob = udg_Quest_ClearInt_15_mob + 1
  else
    set udg_Quest_ClearInt_15_mob = udg_Quest_ClearInt_15_mob - 1
  endif
  if ( ModuloInteger(udg_Quest_ClearInt_15_mob,2) == 1 ) then
    call SetTextTagText(udg_Quest_ClearInt_15_mobWindow, "오염도: "+I2S(udg_Quest_ClearInt_15_mob/2)+".5%", 0.025)
    call SetTextTagColor(udg_Quest_ClearInt_15_mobWindow, 255, 255-udg_Quest_ClearInt_15_mob, 255-udg_Quest_ClearInt_15_mob, 255)
  else
    call SetTextTagText(udg_Quest_ClearInt_15_mobWindow, "오염도: "+I2S(udg_Quest_ClearInt_15_mob/2)+".0%", 0.025)
    call SetTextTagColor(udg_Quest_ClearInt_15_mobWindow, 255, 255-udg_Quest_ClearInt_15_mob, 255-udg_Quest_ClearInt_15_mob, 255)
  endif
  call SetTextTagPos(udg_Quest_ClearInt_15_mobWindow, 21664., -12288., 0.)
endfunction

function Trig_Quest_15_Enter_Mob_Actions takes nothing returns nothing
//몹 나오면 중앙에 오염도: 00% 띄우는거 (200마리 기준 100% - 퀘스트 실패)
  call Pollution(true)
  call TriggerRegisterUnitEvent(gg_trg_Quest_15_Dead_Mob, GetTriggerUnit(), EVENT_UNIT_DEATH)
endfunction

//===========================================================================
function InitTrig_Quest_15_Enter_Mob takes nothing returns nothing
    set gg_trg_Quest_15_Enter_Mob = CreateTrigger(  )
    call TriggerRegisterEnterRectSimple( gg_trg_Quest_15_Enter_Mob, gg_rct_Hunting_67 )
    call TriggerAddCondition( gg_trg_Quest_15_Enter_Mob, Condition( function Trig_Quest_15_Enter_Mob_Conditions ) )
    call TriggerAddAction( gg_trg_Quest_15_Enter_Mob, function Trig_Quest_15_Enter_Mob_Actions )
endfunction

//===========================================================================
// Trigger: Quest 15 Dead Mob
//===========================================================================
function Trig_Quest_15_Dead_Mob_Actions takes nothing returns nothing
  call Pollution(false)
  
  //다 잡음 + 20단계 이상(10웨이브): 보상 지급
  if ( udg_Quest_ClearInt_15_mob == 0 ) and ( udg_Quest_ClearInt_15 >= 20 ) then
    call SetTextTagText(udg_Quest_ClearInt_15_mobWindow, "C L E A R !", 0.025)
    call SetTextTagPermanent(udg_Quest_ClearInt_15_mobWindow, false)
    call SetTextTagLifespan(udg_Quest_ClearInt_15_mobWindow, 30.)
    set udg_Quest_ClearInt_15_Explosion = -10.
    
    call TriggerSleepAction(10.)
    if ( IsTimerDialogDisplayed(udg_Quest_ClearInt_15_TimerWindow) ) then
      call MSGAll(0, true, 1, 2, 6., "|c00ff8000마인 촌장|r: |c00ffff00무운을 비네!|r")
    else
      call MSGAll(0, true, 1, 2, 6., "|c00ff8000마인 촌장|r: |c00ffff00고생했네!|r")
      call TriggerSleepAction(1.)
      set bj_forLoopAIndex = 1
      loop
        exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
        if ( udg_OnesPositionN[bj_forLoopAIndex] == 67 ) then
          set udg_OnesPositionN[bj_forLoopAIndex] = 61
          call SetUnitPosition(udg_Unit[bj_forLoopAIndex], 18240., -11104.)
          call MSG(Player(bj_forLoopAIndex-1), 5, 7, "죽음의 마을 입구")
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
    endif

  endif
endfunction

//===========================================================================
function InitTrig_Quest_15_Dead_Mob takes nothing returns nothing
    set gg_trg_Quest_15_Dead_Mob = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Quest_15_Dead_Mob, function Trig_Quest_15_Dead_Mob_Actions )
endfunction

//===========================================================================
// Trigger: Quest 16 Mine
//===========================================================================
function Quest16 takes unit user returns nothing
 //외형: 아크메이지 유령, 말투: 크아아.. 키익, 란? 제주 사투리
 local integer P = GetPlayerId(GetOwningPlayer(user))+1
  if ( Quest_Level(P, 16) == -2 ) then
    call QMsg(P, 0, "떠도는 유령", "키엑!", 1.)
    call QMsg(P, 0, "플레이어", "|c008bc7fc(화가 난 상태인가 보다...)", 1.)
  elseif ( Quest_Level(P, 16) == -1 ) then
    call QMsg(P, 0, "떠도는 유령", "우리 때에선 이나저나 몬스터가 한때도 안 나타나네! 이젠 더 도와줄 필욘 없겠지만.", 0)
    call SaveInteger(udg_hash, StringHash("QLevel16"), P, 0)
  elseif ( GetHeroLevel(user) < 99 ) then
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", user, "overhead"))
    call QMsg(P, 0, "떠도는 유령", "너는 잠깐만 생각해봐라. [레벨제한 99]", 0)
  elseif ( P != udg_PartyNumber_ThisP[P] ) then
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", user, "overhead"))
    call QMsg(P, 0, "떠도는 유령", "파티장, 얘기, 가능한", .5)
  elseif ( Quest_Level(P, 16) == 0 ) then
    call Quest_Start(P, 16, true)
    call QMsg(P, 0, "떠도는 유령", "키에..", 1.)
    call QMsg(P, 0, "떠도는 유령", "키에엑.........", 1.)
    call QMsg(P, 0, "플레이어", "무슨 일인가요?", 1.)
    call QMsg(P, 0, "떠도는 유령", "크륵, 사, 사람?", 1.)
    call QMsg(P, 0, "플레이어", "놀라게 해드려 죄송합니다. 지나가는 모험자입니다. 그런데 궁금한게 있는데...", 1.)
    call QMsg(P, 0, "떠도는 유령", "말..오랜만에.. 해보는군, 그래. 뭔가?", 1.)
    call QMsg(P, 0, "플레이어", "|c008bc7fc (.....)", 1.)
    call QMsg(P, 41, "3", "|c00d962b51. |c008bc7fc(도와드릴게 있나요?)\n|c00d962b52. |c008bc7fc(어떻게 지평좌표계로 고정하셨죠?)", 10.)
  elseif ( Quest_Level(P, 16) == 1 ) then
    if ( udg_Quest_ClearInt_16 < 1500 ) then
      call QMsg(P, 0, "떠도는 유령", "이 정도로는 내가 만족을 못한... |cffffdc3c[현재 만족도: |cffff0000" + R2SW((I2R(udg_Quest_ClearInt_16)/15.), 3, 1) + "|cffffdc3c%/|c0055ff55100|cffffdc3c%]", 1.)
    else
      call Quest_Start(P, 16, false)
      call QMsg(P, 0, "떠도는 유령", "얼마나 잡안?", 1.)
      call QMsg(P, 0, "플레이어", "모조리 잡았습니다.", 1.)
      call QMsg(P, 0, "떠도는 유령", "음....", 0.5)
      call QMsg(P, 0, "떠도는 유령", "좋다! 이정도면 만족할 만한 말이네.", 1.)
      call QMsg(P, 0, "떠도는 유령", "고생 많안, 작지만 받아주시게.", 1.)
      
      
      call DisableTrigger(GetTriggeringTrigger())
      loop
        exitwhen udg_Quest_ClearInt_16 < 1500
        set bj_forLoopAIndex = 1
        loop
          exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
          if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[P] ) and ( udg_SysB_Level[bj_forLoopAIndex] >= 99 ) then
            call QMsg(bj_forLoopAIndex, 7., "2", "떠도는 유령을 도와주고 경험치 18M+과 엑스쿠라눔 "+I2S(3)+"개를 받았습니다!", 0.)
            call MakeTestt(bj_forLoopAIndex, false, 18000000)
            call GiveItem(bj_forLoopAIndex, 'I084', 3)
            call SetItemUserData(bj_lastCreatedItem, bj_forLoopAIndex)
            set udg_SysL_Wood[bj_forLoopAIndex] = GetPlayerState(Player(bj_forLoopAIndex-1), PLAYER_STATE_RESOURCE_LUMBER)
          endif
          set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
        set udg_Quest_ClearInt_16 = udg_Quest_ClearInt_16 - 1500
        call TriggerSleepAction(.1)
      endloop
      call EnableTrigger(GetTriggeringTrigger())
      call QMsg(P, 0, "떠도는 유령", "다음에 또 부탁해도 될깐?", 1.)
      call Quest_End(P, 16, true)
      call SaveInteger(udg_hash, StringHash("QLevel16"), P, -1)
    endif
  endif
  call Quest_End2(P)
endfunction

function Trig_Quest_16_Mine_Actions takes nothing returns nothing
  call Quest16(GetAttacker())
endfunction

//===========================================================================
function InitTrig_Quest_16_Mine takes nothing returns nothing
    set gg_trg_Quest_16_Mine = CreateTrigger(  )
    call TriggerRegisterUnitEvent( gg_trg_Quest_16_Mine, gg_unit_Hgam_0174, EVENT_UNIT_ATTACKED )
    call TriggerAddAction( gg_trg_Quest_16_Mine, function Trig_Quest_16_Mine_Actions )
endfunction

//===========================================================================
// Trigger: Quest 16 B
//
// 4~10(6+) // 1
// 14~28 (10+) (10~29) // 3 (45) , 4000
// 33~47(30+) (30~49) // 8 (120) , 13000
// 48~68(50+) (50~70) // 20 (300) , 40000
// Lv/3
// 60
// 170
// 300
//===========================================================================
function Trig_Quest_16_C_Actions takes nothing returns nothing
  set udg_Quest_ClearInt_16 = udg_Quest_ClearInt_16 + GetUnitLevel(GetDyingUnit())-115
  set quest_temp_r = I2R(udg_Quest_ClearInt_16)/15.
  if ( quest_temp_r >= 100. ) and ( quest_temp_r <= 104. ) then
    call MSGAll(0, true, 1, 2, 15., "이정도면 충분히 잡은것 같습니다.")
  endif
  if ( udg_Quest_ClearInt_15_mobWindow != null ) then
    call DestroyTextTag(udg_Quest_ClearInt_15_mobWindow)
  endif
  set udg_Quest_ClearInt_15_mobWindow = CreateTextTag()
  call SetTextTagPos(udg_Quest_ClearInt_15_mobWindow, GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit()), 0.)
  call SetTextTagText(udg_Quest_ClearInt_15_mobWindow, "|cffff0000" + R2SW(quest_temp_r, 3, 1) + "%", 0.015)
  call SetTextTagPermanent(udg_Quest_ClearInt_15_mobWindow, true)
  call SetTextTagLifespan(udg_Quest_ClearInt_15_mobWindow, 2.)
endfunction

//===========================================================================
function InitTrig_Quest_16_B takes nothing returns nothing
  set gg_trg_Quest_16_B = CreateTrigger(  )
  call TriggerAddAction( gg_trg_Quest_16_B, function Trig_Quest_16_C_Actions)
endfunction

//===========================================================================
// Trigger: Boss Mildun
//===========================================================================
native DzFrameSetAnimateOffset takes integer frame, real offset returns nothing
native DzFrameSetAnimate takes integer frame, integer animId, boolean autocast returns nothing

scope Mildun initializer Init
globals
  private unit boss2 = null
  private trigger bossdead = CreateTrigger()
  private trigger main_trg = CreateTrigger()
endglobals

function Trig_Boss_Mildun_Dead_Actions takes nothing returns nothing
 local integer loopA = 0
  if ( GetTriggerExecCount(GetTriggeringTrigger()) == 1 ) then
    if ( GetTriggerUnit() != boss2 ) then
      call BossBar_Apply(GetLocalPlayer(), boss2)
      call MSG(GetLocalPlayer(), 2, 8., "|c00ff0000써큐버스는 죽었습니다...")
    endif
  else
    call DestroyTrigger( GetTriggeringTrigger() )
    call MSG(GetLocalPlayer(), 2, 8., "|c00ff0000베리얼은 죽었습니다...\n\n  |c00d1d1d1묘지 전체의 몬스터 젠 속도가 50% 빨라집니다.")
    call SaveReal(udg_hash, 23, StringHash("FCU-Time"), 0.5)
    call SaveReal(udg_hash, 23, StringHash("FCU-Time2"), 0.1)
    call ResumeTimer(LoadTimerHandle(udg_hash, StringHash("FCU"), 23))
    call TimerStart(LoadTimerHandle(udg_hash, StringHash("FCU"), 23), 0., false, function FCUTimer)
    call TriggerSleepAction(5.)
    set loopA = 16
    loop
      call SaveReal(udg_hash, loopA, StringHash("FCU-Time"), LoadReal(udg_hash, loopA, StringHash("FCU-Time"))*.67)
      call SaveReal(udg_hash, loopA, StringHash("FCU-Time2"), LoadReal(udg_hash, loopA, StringHash("FCU-Time2"))*.67)
      exitwhen loopA >= 22
      set loopA = loopA + 1
    endloop
    call SaveReal(udg_hash, 23, StringHash("FCU-Time"), 6.*.67)
    call SaveReal(udg_hash, 23, StringHash("FCU-Time2"), 3.*.67)
  endif
endfunction

function Trig_Monster_Gen_014_Condi takes nothing returns boolean
  return ( GetOwningPlayer(GetFilterUnit()) == Player(PLAYER_NEUTRAL_AGGRESSIVE) ) and ( GetUnitTypeId(GetFilterUnit()) != 'n010' )
endfunction

function Trig_Monster_Gen_014_Boss_Func025A takes nothing returns nothing
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIso\\AIsoTarget.mdl", GetEnumUnit(), "origin"))
  call FlushChildHashtable(udg_hash, GetHandleId(GetEnumUnit()))
  call KillUnit(GetEnumUnit())
endfunction

function Trig_Boss_Mildun_Actions takes nothing returns nothing
  call MSG(GetLocalPlayer(), 2, 8., "|c00393939사|c00424242악|c004c4c4c한|c00555555 |c005f5f5f마|c00686868력|c00727272이|c007b7b7b |c00858585흩|c008e8e8e어|c00989898지|c00a2a2a2고|c00ababab |c00b5b5b5있|c00bebebe습|c00c8c8c8니|c00d1d1d1다|c00dbdbdb.|c00e4e4e4.|c00eeeeee.")
  if ( GetTriggerExecCount(GetTriggeringTrigger()) == 4 ) then
    call MSG(GetLocalPlayer(), 2, 8., "\n|c00ff0000서큐버스가 등장하였습니다 !!")
    set bj_lastCreatedUnit = CreateUnit(Player(12),'n010', 7776, -18816, GetRandomReal(0,360))
    call SetUS2("mrd", bj_lastCreatedUnit, 30.)
    call SetUS2("mdf", bj_lastCreatedUnit, 40.)
    call SetUS("Hp", bj_lastCreatedUnit, R2I(GetUnitState(bj_lastCreatedUnit, UNIT_STATE_MAX_LIFE) * GetRandomReal(1.5, 2.)), true)
    call SetUnitState(bj_lastCreatedUnit, ConvertUnitState($50), 6.) /* 보스 방어 취급 */
    call BossBar_Apply(GetLocalPlayer(), bj_lastCreatedUnit)
    call TriggerRegisterUnitEvent(bossdead, bj_lastCreatedUnit, EVENT_UNIT_DEATH)
  elseif ( GetTriggerExecCount(GetTriggeringTrigger()) == 5 ) then
    call MSG(GetLocalPlayer(), 2, 8., "\n|c00ff0000베리얼이 깊은 잠에서 깨어났습니다 !!")
    call DestroyTrigger(GetTriggeringTrigger())
    call DisableTrigger(DeathAll_Death_ALL)
    
    set udg_temp_g = GetUnitsInRectMatching(gg_rct_Hunting_23, Condition(function Trig_Monster_Gen_014_Condi))
    call ForGroup(udg_temp_g, function Trig_Monster_Gen_014_Boss_Func025A)
    call DestroyGroup(udg_temp_g)
    call EnableTrigger(DeathAll_Death_ALL)
    call TriggerSleepAction(2.)
    
    set boss2 = CreateUnit(Player(12),'n011', 7776, -18816, GetRandomReal(0,360))
    call SetUS2("mrd", boss2, 50.)
    call SetUS2("mdf", boss2, 65.)
    call SetUS("Hp", boss2, R2I(GetUnitState(boss2, UNIT_STATE_MAX_LIFE) * GetRandomReal(1.5,2.)), true)
    call PauseTimer(LoadTimerHandle(udg_hash, StringHash("FCU"), 23))
    call SetUnitState(boss2, ConvertUnitState($50), 6.) /* 보스 방어 취급 */
    call TriggerRegisterUnitEvent(bossdead, boss2, EVENT_UNIT_DEATH)
    if ( GetTriggerExecCount(bossdead) == 1 ) then /* 이미 써큐 죽음 */
      call BossBar_Apply(GetLocalPlayer(), bj_lastCreatedUnit)
    endif
    call RemoveDestructable(gg_dest_B006_2390)
    call RemoveDestructable(gg_dest_B006_0001)
    call RemoveDestructable(gg_dest_B006_2404)
    call RemoveDestructable(gg_dest_B006_2405)
    call RemoveDestructable(gg_dest_B006_2409)
  endif
endfunction

private function Init takes nothing returns nothing
    call TriggerRegisterDeathEvent(main_trg, gg_dest_B006_2390 )
    call TriggerRegisterDeathEvent(main_trg, gg_dest_B006_0001 )
    call TriggerRegisterDeathEvent(main_trg, gg_dest_B006_2404 )
    call TriggerRegisterDeathEvent(main_trg, gg_dest_B006_2405 )
    call TriggerRegisterDeathEvent(main_trg, gg_dest_B006_2409 )
    call TriggerAddAction(main_trg, function Trig_Boss_Mildun_Actions )
    call TriggerAddAction(bossdead, function Trig_Boss_Mildun_Dead_Actions )
endfunction
endscope//===========================================================================
// Trigger: FMi Internal
//
// 57 01 - 세이브 가능한 아이템
// |cffffdc3c퀘스트 아이템|r
// 퀘스트 대화 속도를 조절합니다.
// |cff87f264현재 기본 속도입니다.|r
// |cff87ceeb초보 탈출 필승 지침서|r
// |cffff0000※(구입 즉시 사용)|r
// |c004f4f4f마시고싶은 호기심이 든다.|r
// 28032, -27840
//===========================================================================
function Trig_FMi_Internal_Conditions takes nothing returns boolean
 return ( FMi_Inven2(GetItemTypeId(GetManipulatedItem())) > 0 )
endfunction

function Title2Item takes string s returns integer
  if ( SubString(s,StringLength(s)-26,StringLength(s)) == "|cffffdc3c[수집성향]|r" ) then
    return 53
  elseif ( SubString(s,StringLength(s)-26,StringLength(s)) == "|cffffdc3c[토벌성향]|r" ) then
    return 52
  else
    return 5
  endif
endfunction
function FMi_Cansle takes unit u, integer Key returns nothing
  set udg_SysA_Item = true
  call RemoveItem(UnitItemInSlot(u, 0))
  call RemoveItem(UnitItemInSlot(u, 1))
  call RemoveItem(UnitItemInSlot(u, 2))
  call RemoveItem(UnitItemInSlot(u, 3))
  call RemoveItem(UnitItemInSlot(u, 4))
  call RemoveItem(UnitItemInSlot(u, 5))
  if ( Key == 2 ) then
  //기본: 돌아가기 누르면.
    call UnitAddItem(u, CreateItem(FMi_Inven(0,1), GetWidgetX(u), GetWidgetY(u)))
    call UnitAddItem(u, CreateItem(FMi_Inven(0,2), GetWidgetX(u), GetWidgetY(u)))
    call UnitAddItem(u, CreateItem(FMi_Inven(0,3), GetWidgetX(u), GetWidgetY(u)))
    call UnitAddItem(u, CreateItem(FMi_Inven(0,4), GetWidgetX(u), GetWidgetY(u)))
    set Key = GetPlayerId(GetOwningPlayer(u))+1
    if ( CountItem(Key, FMi_Inven(0,5)) > 0 ) then
    //코마디움 수량
      call UnitAddItem(u, CreateItem(FMi_Inven(0,5), 0, 0))
      call SetItemCharges(UnitItemInSlot(u, 4), CountItem(Key, FMi_Inven(0,5)))
    endif
  else
    call UnitAddItem(u, CreateItem(FMi_Inven(Key,1), GetWidgetX(u), GetWidgetY(u)))
    if ( Key == 5 ) then
    //초보자 퀘스트 수량
      call SetItemCharges(UnitItemInSlot(u, 0), CountItem(GetPlayerId(GetOwningPlayer(u))+1, FMi_Inven(5,1)))
    endif
    call UnitAddItem(u, CreateItem(FMi_Inven(Key,2), GetWidgetX(u), GetWidgetY(u)))
    call UnitAddItem(u, CreateItem(FMi_Inven(Key,3), GetWidgetX(u), GetWidgetY(u)))
    if ( Key == 7 ) then
      set Key = IndexGet(FAL_GetMulti0(GetPlayerId(GetOwningPlayer(u))+1,0,0,2), 2)
      if ( Key == 0 ) then
        call UnitAddItem(u, CreateItem(FMi_Inven(7,43), GetWidgetX(u), GetWidgetY(u)))
      elseif ( Key == 1 ) then
        call UnitAddItem(u, CreateItem(FMi_Inven(7,4), GetWidgetX(u), GetWidgetY(u)))
      else
        call UnitAddItem(u, CreateItem(FMi_Inven(7,42), GetWidgetX(u), GetWidgetY(u)))
      endif
    else
      call UnitAddItem(u, CreateItem(FMi_Inven(Key,4), GetWidgetX(u), GetWidgetY(u)))
    endif
    if ( FMi_Inven(Key,0) == 4 ) then
    //4개면 두칸 채우고 하나 제거
      call UnitAddItem(GetTriggerUnit(), CreateItem(FMi_Inven(0,0), GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit())))
      call UnitAddItem(GetTriggerUnit(), CreateItem(FMi_Inven(0,0), GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit())))
      call RemoveItem(UnitItemInSlot(GetTriggerUnit(),4))
    else
      if ( Key == 4 ) then
        call UnitAddItem(u, CreateItem(FMi_Inven(Key,Title2Item(udg_PartyTitle[udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(u))+1]])), GetWidgetX(u), GetWidgetY(u)))
      else
        call UnitAddItem(u, CreateItem(FMi_Inven(Key,5), GetWidgetX(u), GetWidgetY(u)))
      endif
      call UnitAddItem(u, CreateItem(FMi_Inven(0,0), GetWidgetX(u), GetWidgetY(u)))
    endif
  endif
  set udg_SysA_Item = false
endfunction


function Trig_FMi_Internal_Actions takes nothing returns nothing
 local integer loopA = 0
 local integer iKey = FMi_Inven2(GetItemTypeId(GetManipulatedItem()))
//debug call BJDebugMsg("ikey - " + I2S(iKey))
  if ( iKey < 10 ) then
    call FMi_Cansle(GetTriggerUnit(), iKey)
  else
    if ( iKey == 77 ) then
      call TriggerExecute(gg_trg_Intr_Quest_Helper)
      //돌아가기 누른 효과
      call FMi_Cansle(GetTriggerUnit(), 2)
    elseif ( iKey == 78 ) then
      call MSG(GetTriggerPlayer(), 1, 3., "퀘스트 네비게이션 - 미완성 기능입니다.")
      call FMi_Cansle(GetTriggerUnit(), 2)
    elseif ( iKey == 74 ) then
    //퀘스트 완료
      call FMi_Cansle(GetTriggerUnit(), 2)
      set iKey = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
      if ( Quest_Level(iKey, 1) >= 1 ) and ( CountItem(iKey, 'I00O') >= 5 ) then
        call Quest01(GetTriggerUnit())
        call TriggerSleepAction(1.)
        call Quest01(GetTriggerUnit())
      elseif ( Quest_Level(iKey, 4) >= 1 ) and ( CountItem(iKey, 'I07N') >= 5 ) then
        call Quest04(GetTriggerUnit())
        call TriggerSleepAction(1.)
        call Quest04(GetTriggerUnit())
      elseif ( Quest_Level(iKey, 6) >= 1 ) and ( CountItem(iKey, 'I006') >= 0 ) then
        call Quest06(GetTriggerUnit())
        call TriggerSleepAction(1.)
        call Quest06(GetTriggerUnit())
      elseif ( Quest_Level(iKey, 7) >= 8 ) and ( udg_Quest_ClearInt_07[iKey] >= 15 ) then
        call Quest07(GetTriggerUnit(), gg_unit_hhes_0203)
        call TriggerSleepAction(1.)
        call Quest07(GetTriggerUnit(), gg_unit_hhes_0203)
      elseif ( Quest_Level(iKey, 7) >= 5 ) and ( udg_Quest_ClearInt_07[iKey] >= 15 ) then
        call Quest07(GetTriggerUnit(), gg_unit_hfoo_0202)
        call TriggerSleepAction(1.)
        call Quest07(GetTriggerUnit(), gg_unit_hfoo_0202)
      elseif ( Quest_Level(iKey, 7) >= 1 ) and ( udg_Quest_ClearInt_07[iKey] >= 15 ) then
        call Quest07(GetTriggerUnit(), gg_unit_n02T_0204)
        call TriggerSleepAction(1.)
        call Quest07(GetTriggerUnit(), gg_unit_n02T_0204)
      elseif ( Quest_Level(iKey, 8) >= 1 ) and ( udg_Quest_ClearInt_08[iKey] >= 20 ) then
        call Quest08(GetTriggerUnit())
        call TriggerSleepAction(1.)
        call Quest08(GetTriggerUnit())
      elseif ( Quest_Level(iKey, 9) == 1 ) and ( udg_Quest_ClearInt_09[iKey] >= 60 ) then
        call Quest09(GetTriggerUnit())
        call TriggerSleepAction(1.)
        call Quest09(GetTriggerUnit())
      elseif ( Quest_Level(iKey, 9) == 2 ) and ( udg_Quest_ClearInt_09[iKey] >= 170 ) then
        call Quest09(GetTriggerUnit())
        call TriggerSleepAction(1.)
        call Quest09(GetTriggerUnit())
      elseif ( Quest_Level(iKey, 9) == 3 ) and ( udg_Quest_ClearInt_09[iKey] >= 300 ) then
        call Quest09(GetTriggerUnit())
        call TriggerSleepAction(1.)
        call Quest09(GetTriggerUnit())
      elseif ( Quest_Level(iKey, 12) == 1 ) and ( udg_Quest_ClearInt_12[iKey] >= 600 ) then
        call Quest12(GetTriggerUnit())
        call TriggerSleepAction(1.)
        call Quest12(GetTriggerUnit())
      elseif ( Quest_Level(iKey, 13) == 1 ) and ( udg_Quest_ClearInt_13[iKey] >= 10 ) then
        call Quest13(GetTriggerUnit())
        call TriggerSleepAction(1.)
        call Quest13(GetTriggerUnit())
      elseif ( Quest_Level(iKey, 13) == 2 ) and ( udg_Quest_ClearInt_13[iKey] >= 100 ) then
        call Quest13(GetTriggerUnit())
        call TriggerSleepAction(1.)
        call Quest13(GetTriggerUnit())
      elseif ( Quest_Level(iKey, 13) == 3 ) and ( udg_Quest_ClearInt_13[iKey] >= 500 ) then
        call Quest13(GetTriggerUnit())
        call TriggerSleepAction(1.)
        call Quest13(GetTriggerUnit())
      elseif ( Quest_Level(iKey, 14) == 1 ) and ( udg_Quest_ClearInt_14 >= 50 ) then
        call Quest14(GetTriggerUnit())
        call TriggerSleepAction(1.)
        call Quest14(GetTriggerUnit())
      elseif ( Quest_Level(iKey, 16) == 1 ) and ( udg_Quest_ClearInt_16 >= 1500 ) then
        call Quest16(GetTriggerUnit())
        call TriggerSleepAction(1.)
        call Quest16(GetTriggerUnit())
      else
        call MSG(Player(iKey-1), 1, 3., "완료할 수 있는 반복 퀘스트가 없습니다.")
      endif
    elseif ( iKey == 75 ) then
      set iKey = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
      set udg_SysA_Item = true
      if ( GetItemTypeId(GetManipulatedItem()) == FMi_Inven(7,4) ) then
      //보통 → 빠름
        set udg_Quest_WaitTime[iKey] = GetRandomReal(0.5,0.95)
        call RemoveItem(UnitItemInSlot(GetTriggerUnit(),3))
        call UnitAddItem(GetTriggerUnit(), CreateItem(FMi_Inven(7,42), GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit())))
        call MSG(Player(iKey-1), 1, 7, "퀘스트 대화 속도가 '|c00d962b5빠름|cffffdc3c'으로 되었습니다 (|c00d962b5"+R2SW(udg_Quest_WaitTime[iKey],1,2)+"|cffffdc3c초/한마디)")
        call IndexSet(iKey, 2, 2)
      elseif ( GetItemTypeId(GetManipulatedItem()) == FMi_Inven(7,42) ) then
      //빠름 -> 느림
        set udg_Quest_WaitTime[iKey] = GetRandomReal(1.4,1.5)
        call RemoveItem(UnitItemInSlot(GetTriggerUnit(),3))
        call UnitAddItem(GetTriggerUnit(), CreateItem(FMi_Inven(7,43), GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit())))
        call MSG(Player(iKey-1), 1, 7, "퀘스트 대화 속도가 '|c00d962b5천천히|cffffdc3c'로 되었습니다 (|c00d962b5"+R2SW(udg_Quest_WaitTime[iKey],1,2)+"|cffffdc3c초/한마디)")
        call IndexSet(iKey, 2, 0)
      elseif ( GetItemTypeId(GetManipulatedItem()) == FMi_Inven(7,43) ) then
      //느림 -> 보통
        set udg_Quest_WaitTime[iKey] = GetRandomReal(0.95,1.25)
        call RemoveItem(UnitItemInSlot(GetTriggerUnit(),3))
        call UnitAddItem(GetTriggerUnit(), CreateItem(FMi_Inven(7,4), GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit())))
        call MSG(Player(iKey-1), 1, 7, "퀘스트 대화 속도가 '|c00d962b5보통|cffffdc3c'으로 되었습니다 (|c00d962b5"+R2SW(udg_Quest_WaitTime[iKey],1,2)+"|cffffdc3c초/한마디)")
        call IndexSet(iKey, 2, 1)
      endif
      set udg_SysA_Item = false
    elseif ( iKey == 87 ) then
    elseif ( iKey == 88 ) then
    //첫번째 (여관)리콜 사용
      set iKey = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
      if ( GetWidgetLife(udg_Unit[iKey])/GetUnitState(udg_Unit[iKey], UNIT_STATE_MAX_LIFE) > .95 ) then
        set iKey = StringHash("FMi_Item"+I2S(iKey))
        set loopA = 1
        loop
          //리콜 체크
          if ( RecallData(GetItemTypeId(LoadItemHandle(udg_hash, iKey, loopA))) != 0 ) then
            call MSG(GetOwningPlayer(GetTriggerUnit()), 1, 3, "한번 더 클릭하여 |cffffff80" + GetItemName(LoadItemHandle(udg_hash, iKey, loopA)) + BaseStr(11) + "을 사용할 수 있습니다.")
            set udg_SysA_Item = true
            call RemoveItem(UnitItemInSlot(GetTriggerUnit(),1))
            call UnitAddItem(GetTriggerUnit(), CreateItem(GetItemTypeId(LoadItemHandle(udg_hash, iKey, loopA)), 0, 0))
            call SetItemCharges(UnitItemInSlot(GetTriggerUnit(),1), GetItemCharges(LoadItemHandle(udg_hash, iKey, loopA)))
            call SetItemDroppable(UnitItemInSlot(GetTriggerUnit(),1), false)
            set udg_SysA_Item = false
            exitwhen true
          endif
          exitwhen loopA >= SysInt(0,15)
          set loopA = loopA + 1
        endloop
        if ( GetItemTypeId(UnitItemInSlot(GetTriggerUnit(), 1)) == FMi_Inven(8,2) ) then
          call MSG(GetOwningPlayer(GetTriggerUnit()), 1, 6, "가지고 있는 리콜이 없습니다. 최근 마을 혹은 여관으로 이동(단축키 7 혹은 4)을 사용해주세요.")
        endif
      else
        set iKey = StringHash("FMi_Item"+I2S(iKey))
        set loopA = 1
        loop
          if ( RecallData(GetItemTypeId(LoadItemHandle(udg_hash, iKey, loopA))) != 0 ) then
            call Recall(GetTriggerUnit(), GetItemTypeId(LoadItemHandle(udg_hash, iKey, loopA)), true)
            set iKey = 0
            exitwhen true
          endif
          exitwhen loopA >= SysInt(0,15)
          set loopA = loopA + 1
        endloop
        if ( iKey != 0 ) then
          call MSG(GetOwningPlayer(GetTriggerUnit()), 1, 6, "가지고 있는 리콜이 없습니다. 최근 마을 혹은 여관으로 이동(단축키 7 혹은 4)을 사용해주세요.")
        else
          call FMi_Cansle(GetTriggerUnit(), 2)
        endif
      endif
    elseif ( iKey == 888 ) then
      call Recall(GetTriggerUnit(), GetItemTypeId(GetManipulatedItem()), true)
      call FMi_Cansle(GetTriggerUnit(), 2)
    elseif ( iKey == 84 ) then
      set iKey = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
      if ( CountItem(iKey, 'I07Y') >= 1 ) then
        call Recall(GetTriggerUnit(), 'I07Y', true)
      else
        if ( udg_SysB_Level[iKey] <= 50 ) then
          call MSG(Player(iKey-1), 1, 4, "5초 후 여관으로 귀환합니다...")
          call TriggerSleepAction(5.)
          if ( not UnitAlive(udg_Unit[iKey]) ) then
            call MSG(Player(iKey-1), 1, 4, "사용 불가 - 현재 영웅이 사망하여 있습니다.")
          elseif ( GetUnitAbilityLevel(udg_Unit[iKey], 'B00M') > 0 ) then
            call MSG(Player(iKey-1), 1, 4, "사용 불가 - 현재 영웅이 코마상태에 있습니다.")
          else
            call SetUnitPosition(udg_Unit[iKey], 28032, -27840)
          endif
        elseif ( GetPlayerState(Player(iKey-1), PLAYER_STATE_RESOURCE_GOLD) >= 5000 ) then
          call MSG(Player(iKey-1), 1, 4, I2S(R2I(GetPlayerState(Player(iKey-1), PLAYER_STATE_RESOURCE_GOLD)*0.025))+" Gold를 소모하여 여관으로 이동합니다.")
          if ( Recall(GetTriggerUnit(), 'I07Y', false) ) then
            call SetPlayerState(Player(iKey-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(iKey-1), PLAYER_STATE_RESOURCE_GOLD)-IMaxBJ(5000,R2I(GetPlayerState(Player(iKey-1), PLAYER_STATE_RESOURCE_GOLD)*0.025)))
          endif
        else
          call MSG(Player(iKey-1), 1, 4, "사용료가 부족합니다. 5,000Gold 이상 필요합니다.")
        endif
        call FMi_Cansle(GetTriggerUnit(), 2)
      endif
    elseif ( iKey == 85 ) then
      call MSG(GetTriggerPlayer(), 1, 3., "이동:마차 - 미완성 기능입니다.")
      call FMi_Cansle(GetTriggerUnit(), 2)
    elseif ( iKey == 81 ) then
      //마법진 이동: Item81A015 트리거와 연동
    elseif ( iKey == 47 ) then
      set iKey = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
      if ( udg_PartyNumber_ThisP[iKey] != 0 ) then
        call MSG(Player(iKey-1), 13, 4., "이미 파티가 있습니다 !!")
      elseif ( not UnitAlive(udg_Unit[iKey]) ) then
        call MSG(Player(iKey-1), 13, 4., "케릭터가 생존하지 않아 생성할 수 없습니다 !!")
      elseif ( udg_PartyNumber_pP[0] > 3 ) then
        call MSG(GetTriggerPlayer(), 13, 6., "현재 파티는 |c00d962b51" + I2S(udg_PartyNumber_pP[0]) + "|cffffdc3c개로, 너무 많습니다. 최대 |c00d962b53|cffffdc3c개까지 가능합니다.")
      else
        set udg_PartyNumber_pP[iKey] = 1
        set udg_PartyNumber_ThisP[iKey] = iKey
        set udg_PartyNumber_pP[0] = udg_PartyNumber_pP[0] + 1
        if ( GetRandomReal(0,100) <= 10. ) then
          set udg_PartyTitle[iKey] = GetPlayerName(Player(iKey-1)) + "의 멋쟁이 파티"
        elseif ( GetRandomReal(0,90) <= 10. ) then
          set udg_PartyTitle[iKey] = GetPlayerName(Player(iKey-1)) + "'s Super Party"
        elseif ( GetRandomReal(0,80) <= 10. ) then
          set udg_PartyTitle[iKey] = GetPlayerName(Player(iKey-1)) + "의 초대 or PK 파티"
        elseif ( GetRandomReal(0,70) <= 10. ) then
          set udg_PartyTitle[iKey] = GetPlayerName(Player(iKey-1)) + "님이 푸잎님을 좋아합니다."
        elseif ( GetRandomReal(0,60) <= 10. ) then
          set udg_PartyTitle[iKey] = GetPlayerName(Player(iKey-1)) + "님의 낮은 주사위 승리 파티"
        elseif ( GetRandomReal(0,50) <= 10. ) then
          set udg_PartyTitle[iKey] = GetPlayerName(Player(iKey-1)) + "님의 발컨파티"
        elseif ( GetRandomReal(0,40) <= 10. ) then
          set udg_PartyTitle[iKey] = GetPlayerName(Player(iKey-1)) + "'s Communist Party"
        elseif ( GetRandomReal(0,30) <= 10. ) then
          set udg_PartyTitle[iKey] = GetPlayerName(Player(iKey-1)) + "님의 힐러갈굼 파티"
        elseif ( GetRandomReal(0,20) <= 10. ) then
          set udg_PartyTitle[iKey] = GetPlayerName(Player(iKey-1)) + "님의 비주얼 최강 파티"
        else
          set udg_PartyTitle[iKey] = GetPlayerName(Player(iKey-1)) + "님의 잘생긴 파티"
        endif
        call MSG(Player(iKey-1), 13, 6., "'"+udg_PartyTitle[GetPlayerId(Player(iKey-1))+1] + "'|c000080ff파티가 생성되었습니다.")
        call Party(iKey,iKey,true)
        call TriggerSleepAction(.3)
        // 성향
        call QMsg(iKey, 14, "3", SysStr(6,8), 10.)
      endif
    elseif ( iKey == 48 ) then
      set iKey = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
      if ( udg_PartyNumber_ThisP[iKey] == 0 ) then
        call MSG(Player(iKey-1), 13, 4., "탈퇴 할 파티가 없습니다.")
      else
        call PartyLeft(iKey)
        call FMi_Cansle(GetTriggerUnit(), 2)
      endif
    elseif ( iKey == 44 ) then
      call PartyMember(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1)
    elseif ( iKey == 45 ) then
      //별도 트리거 - A014에서 관리
    elseif ( iKey == 41 ) then
      set iKey = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
      if ( udg_PartyNumber_ThisP[iKey] == 0 ) then
        call MSG(Player(iKey-1), 13, 4., "가입된 파티가 없습니다.")
      elseif ( udg_PartyNumber_ThisP[iKey] != iKey ) then
        call MSG(Player(iKey-1), 13, 4., "당신은 파티장이 아닙니다.")
      else
        set udg_PartyTitle[iKey] = SubString(udg_PartyTitle[iKey], 0, StringLength(udg_PartyTitle[iKey])-26)
        call Choice(iKey, -14, 0.)
        set udg_SysA_Item = true
        if ( GetItemTypeId(GetManipulatedItem()) == FMi_Inven(4,5) ) then
        //기본 -> 토벌
          call MSG(Player(iKey-1), 1, 2, "파티 성향이 토벌성향으로 설정되었습니다.")
          set udg_SysK_Exp[iKey] = udg_SysA_COUNT*SysInt(0,30)+50
          set udg_SysK_Drop[iKey] = udg_SysA_COUNT*SysInt(0,31)-50
          set udg_SysK_Gold[iKey] = udg_SysA_COUNT*SysInt(0,32)-20
          
          set udg_PartyTitle[iKey] = udg_PartyTitle[iKey] + "|cffffdc3c[토벌성향]|r"
          call RemoveItem(UnitItemInSlot(GetTriggerUnit(),4))
          call UnitAddItem(GetTriggerUnit(), CreateItem(FMi_Inven(4,52), GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit())))
        elseif ( GetItemTypeId(GetManipulatedItem()) == FMi_Inven(4,52) ) then
        //토벌 -> 수집
          call MSG(Player(iKey-1), 1, 2, "파티 성향이 수집성향으로 설정되었습니다.")
          set udg_SysK_Exp[iKey] = udg_SysA_COUNT*SysInt(0,30)-30
          set udg_SysK_Drop[iKey] = udg_SysA_COUNT*SysInt(0,31)+50
          set udg_SysK_Gold[iKey] = udg_SysA_COUNT*SysInt(0,32)+20
          
          set udg_PartyTitle[iKey] = udg_PartyTitle[iKey] + "|cffffdc3c[수집성향]|r"
          call RemoveItem(UnitItemInSlot(GetTriggerUnit(),4))
          call UnitAddItem(GetTriggerUnit(), CreateItem(FMi_Inven(4,53), GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit())))
        elseif ( GetItemTypeId(GetManipulatedItem()) == FMi_Inven(4,53) ) then
        //수집 -> 기본
          call MSG(Player(iKey-1), 1, 2, "파티 성향이 기본성향으로 설정되었습니다.")
          set udg_SysK_Exp[iKey] = udg_SysA_COUNT*SysInt(0,30)
          set udg_SysK_Drop[iKey] = udg_SysA_COUNT*SysInt(0,31)
          set udg_SysK_Gold[iKey] = udg_SysA_COUNT*SysInt(0,32)
          set udg_PartyTitle[iKey] = udg_PartyTitle[iKey] + "|cffffdc3c[기본성향]|r"
          call RemoveItem(UnitItemInSlot(GetTriggerUnit(),4))
          call UnitAddItem(GetTriggerUnit(), CreateItem(FMi_Inven(4,5), GetWidgetX(GetTriggerUnit()), GetWidgetY(GetTriggerUnit())))
        endif
        set udg_SysA_Item = false
        if ( udg_PartyNumber_pP[iKey] < 2 ) then
          call MSG(Player(iKey-1), 1, 7, "이제, 파티원 초대(단축키 5)를 이용해 파티원을 초대해 보세요.")
        else
          set loopA = 1
          loop
            if ( udg_PartyNumber_ThisP[loopA] == udg_PartyNumber_ThisP[iKey] ) then
              call MSG(Player(loopA-1), 1, 4, "파티의 성향이 "+SubString(udg_PartyTitle[iKey], StringLength(udg_PartyTitle[iKey])-26, StringLength(udg_PartyTitle[iKey]))+"으로 변경되었습니다.")
              set udg_SysK_Exp[loopA] = udg_SysK_Exp[iKey]
              set udg_SysK_Drop[loopA] = udg_SysK_Drop[iKey]
              set udg_SysK_Gold[loopA] = udg_SysK_Gold[iKey]
            endif
            exitwhen loopA >= bj_MAX_PLAYERS
            set loopA = loopA + 1
          endloop
        endif
      endif
    elseif ( iKey == 57 ) then
    //57 - 초보자 퀘스트 스크롤
    elseif ( iKey == 58 ) then
    //58 - 각 서클 정보 및 마을 (내 마을에 핑 표시 ex. 11~40레벨이면 루어스에 핑 표시)
      set iKey = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
      call MSG(Player(iKey-1), 1, 20., "\n-----써클 관련 도움말입니다.-----\n|r1|cffffdc3c써클: 레벨 1~10. 레벨 6때 직업을 가질 수 있음. \"|cffed89d9밀레스 마을\"\n|r2|cffffdc3c써클: 레벨 11~40. \"|cffed89d9루어스 마을|cffffdc3c\" / *26-\"|cffed89d9피에트 마을\"\n|r3|cffffdc3c써클: 레벨 41~70. \"|cffed89d9아벨마을|cffffdc3c\" / *56-\"|cffed89d9호엔마을\"\n|r4|cffffdc3c써클: 레벨 71~98. \"|cffed89d9뤼케시온 마을\"\n|r5|cffffdc3c써클: 레벨 99. \"|cffed89d9마인 마을\"\n")
      if ( udg_SysB_Level[iKey] <= 10 ) then
      //밀레스
        call MSG(Player(iKey-1), 1, 5., "관련마을인 \"|cffed89d9밀레스 마을\"|cffffdc3c에 핑이 표시됩니다.")
        call Ping(Player(iKey-1), GetRectCenterX(Vileage_Rect(6)), GetRectCenterY(Vileage_Rect(6)), -5.)
      elseif ( udg_SysB_Level[iKey] < 41 ) then
        call Ping(Player(iKey-1), GetRectCenterX(Vileage_Rect(7)), GetRectCenterY(Vileage_Rect(7)), -5.)
        if ( udg_SysB_Level[iKey] >= 26 ) then
          call Ping(Player(iKey-1), GetRectCenterX(Vileage_Rect(10)), GetRectCenterY(Vileage_Rect(10)), 5.)
          call MSG(Player(iKey-1), 1, 5., "관련마을인 \"|cffed89d9루어스 마을\"|r, \"|cffed89d9피에트 마을\"|cffffdc3c에 핑이 표시됩니다.")
        else
          call MSG(Player(iKey-1), 1, 5., "관련마을인 \"|cffed89d9루어스 마을\"|cffffdc3c에 핑이 표시됩니다.")
        endif
      elseif ( udg_SysB_Level[iKey] < 71 ) then
        call Ping(Player(iKey-1), GetRectCenterX(Vileage_Rect(11)), GetRectCenterY(Vileage_Rect(11)), -5.)
        if ( udg_SysB_Level[iKey] >= 56 ) then
          call Ping(Player(iKey-1), GetRectCenterX(Vileage_Rect(13)), GetRectCenterY(Vileage_Rect(13)), 5.)
          call MSG(Player(iKey-1), 1, 5., "관련마을인 \"|cffed89d9아벨 마을\"|r, \"|cffed89d9호엔 마을\"|cffffdc3c에 핑이 표시됩니다.")
        else
          call MSG(Player(iKey-1), 1, 5., "관련마을인 \"|cffed89d9아벨 마을\"|cffffdc3c에 핑이 표시됩니다.")
        endif
      elseif ( udg_SysB_Level[iKey] < 99 ) then
        call Ping(Player(iKey-1), GetRectCenterX(Vileage_Rect(14)), GetRectCenterY(Vileage_Rect(14)), -5.)
        call MSG(Player(iKey-1), 1, 5., "관련마을인 \"|cffed89d9뤼케시온 마을\"|cffffdc3c에 핑이 표시됩니다.")
      else
        call Ping(Player(iKey-1), GetRectCenterX(Vileage_Rect(16)), GetRectCenterY(Vileage_Rect(16)), -5.)
        call MSG(Player(iKey-1), 1, 5., "관련마을인 \"|cffed89d9마인 마을\"|cffffdc3c에 핑이 표시됩니다.")
      endif
    elseif ( iKey == 54 ) then
    //54 - 스킬 정보 표시 - 요구조건 및 배우는 마을 표시 
      call MSG(GetOwningPlayer(GetTriggerUnit()), 1, 20., GetSkillNameStatAll(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1))
      call FMi_Cansle(GetTriggerUnit(), 2)
    elseif ( iKey == 55 ) then
    //55 - 올린 경험치 & 현재 사냥터 정보
      call How_Info(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1)
      call FMi_Cansle(GetTriggerUnit(), 2)
    elseif ( iKey == 51 ) then
    //51 - 세이브
      set iKey = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
      if ( Save(iKey, false) ) then
        call LocalMtbM(Player(iKey-1), bj_lastCreatedMultiboard, true)
        call Save2(iKey)
        if ( GetLocalPlayer() == Player(iKey-1) ) then
          call ClearTextMessages()
        endif
        call MSG(Player(iKey-1), 2, 9999, "-load " + FSE_Color(udg_Save_Code[iKey], 7))
        call MSG(Player(iKey-1), 2, 9999, "    인벤토리 코드:\n    -load2 " + FSE_Color(udg_Save_Code2[iKey], 6))
        call FSE_Save1(iKey)
        call FMi_Cansle(GetTriggerUnit(), 2)
      else
        call MSG(Player(iKey-1), 4, 15, "저장 실패함")
      endif
    endif
   //기타 액션. 77~52 아이템 사용시.
  endif
endfunction

//===========================================================================
function InitTrig_FMi_Internal takes nothing returns nothing
  set gg_trg_FMi_Internal = CreateTrigger(  )
  call TriggerAddCondition(gg_trg_FMi_Internal, Condition(function Trig_FMi_Internal_Conditions))
  call TriggerAddAction( gg_trg_FMi_Internal, function Trig_FMi_Internal_Actions )
endfunction

//===========================================================================
// Trigger: Intr Quest Helper
//
// 20
// 31
// 42
// 53
// |cffff0000
//===========================================================================
// QuestSet에 QuestName함수도 수정할 것
constant function QuestDetail takes integer Qno, integer level returns string
  if ( Qno == 0 ) then
    if ( level >= 1 ) then
      return "|cffffdc3c초보자 퀘스트(Z)|cffc3dbff를 눌러, 퀘스트를 진행하세요.|r"
    endif
  elseif ( Qno == 1 ) then
    if ( level == 1 ) then
      return "|cffffdc3c농부|cffc3dbff를 위해 |c009f9f9f밀 밭|cffc3dbff의 밀에서 밀다발 5개를 구해 돌아가자.|r"
    endif
  elseif ( Qno == 2 ) then
    if ( level == 1 ) then
      return "|cffffdc3c마을 남자|cffc3dbff를 위해, |c009f9f9f지하 묘지|cffc3dbff에서 해독제를 구해주자.|r"
    endif
  elseif ( Qno == 3 ) then
    if ( level == 1 ) then
      return "|cffffdc3c아이|cffc3dbff가 준비하는 생일 선물을 위해, |c009f9f9f남쪽 팜팻 숲|cffc3dbff에서 팜팻의 알을 구하자.|r"
    endif
  elseif ( Qno == 4 ) then
    if ( level >= 1 ) then
      return "|cffffdc3c부자 노인|cffc3dbff이 |c009f9f9f지하 묘지|cffc3dbff에서 독거미알을 구해오라고 부탁했다. (총 3회 반복)|r"
    endif
  elseif ( Qno == 5 ) then
    if ( level == 1 ) then
      return "로톤 마을|cffc3dbff에 가서 |cffffdc3c투르크|cffc3dbff를 찾자. 미리 |c009f9f9f수오미 마을|cffc3dbff에서 특제 음식을 사서 가자."
    elseif ( level == 2 ) then
      return "루어스 성|cffc3dbff의 |cffffdc3c둘라코스|cffc3dbff에게 |cffffdc3c투르크|cffc3dbff의 상황에 대해 설명하자."
    elseif ( level == 3 ) then
      return "|cffffdc3c투르크|cffc3dbff에게 돌아가 사면 소식을 전하자."
    elseif ( level == 4 ) then
      return "포테의 숲|cffc3dbff에서 |cffffdc3c투르크|cffc3dbff가 잃어버린 보물을 찾아 다시 돌아가자."
    elseif ( level == 5 ) then
      return "포테의 숲 결계 근처|cffc3dbff에서 |cffffdc3c투르크|cffc3dbff가 잃어버린 팬던트를 찾고, 촌장에게 가자."
    elseif ( level == 6 ) then
      return "|cffff80ff자이언트 맨티스|cffc3dbff를 처지하자."
    endif
  elseif ( Qno == 6 ) then
    if ( level >= 1 ) then
      return "큐르페이 굴|cffc3dbff에 있는 큐르페이를 잡고, 증표를 구해 돌아가자. (총 2회 반복)|r"
    endif
  elseif ( Qno == 7 ) then
    if ( level <= 3 ) then
      return "해안가|cffc3dbff를 토벌하고 |cffffdc3c촌장|cffc3dbff에게 돌아가자."
    elseif ( level == 4 ) then
      return "|cffffdc3c경비병|cffc3dbff에게 찾아가보자."
    elseif ( level <= 7 ) then
      return "해안가 깊은곳|cffc3dbff의 몬스터를 토벌하고 |cffffdc3c경비병|cffc3dbff에게 돌아가자."
    elseif ( level == 8 ) then
      return "|cffffdc3c경비대장|cffc3dbff에게 찾아가보자."
    elseif ( level <= 11 ) then
      return "난파선|cffc3dbff의 몬스터를 토벌하고 |cffffdc3c경비대장|cffc3dbff에게 돌아가자."
    elseif ( level == 12 ) then
      return "|cffc3dbff다시 |cffffdc3c촌장|cffc3dbff에게 돌아가보자."
    elseif ( level == 13 ) then
      return "난파선 가장 깊은곳|cffc3dbff에 있는 |cffff80ff킹 아크퍼스|cffc3dbff를 처지하고 촌장에게 돌아가자."
    endif
  elseif ( Qno == 8 ) then
    if ( level == 1 ) then
      return "|cffffdc3c지킴이|cffc3dbff를 도와, |c009f9f9f우드랜드|cffc3dbff에 있는 몬스터들을 잡아주자."
    elseif ( level == 2 ) then
      return "|cffffdc3c지킴이|cffc3dbff를 도와, |c009f9f9f우드랜드 깊은곳|cffc3dbff에 있는 몬스터들을 잡아주자. (60레벨 이상)"
    elseif ( level == 3 ) then
      return "|cffffdc3c지킴이|cffc3dbff를 도와, |c009f9f9f오두막 근처|cffc3dbff에 있는 몬스터들을 잡아주자. (80레벨 이상)"
    endif
  elseif ( Qno == 9 ) then
    if ( level == 1 ) then
      return "|cffffdc3c아이 엄마|cffc3dbff의 고민 해소를 위해, |c009f9f9f지하 묘지 입구|cffc3dbff부근의 몬스터들을 토벌하자."
    elseif ( level == 2 ) then
      return "|cffffdc3c아이 엄마|cffc3dbff의 고민 해결을 위해, |c009f9f9f지하 묘지 중반부|cffc3dbff부근의 몬스터들을 토벌하자."
    elseif ( level == 3 ) then
      return "|cffffdc3c아이 엄마|cffc3dbff의 고민 완전 해소를 위해, |c009f9f9f지하 묘지 중심부|cffc3dbff부근의 몬스터들을 토벌하자."
    endif
  elseif ( Qno == 11 ) then
    if ( level >= 1 ) then
      return "슈리커의 갓 8개, 아칸더스 7개, 독거미알 12개를 구해서 돌아가자. (파티원 공통)"
    endif
  elseif ( Qno == 12 ) then
    if ( level >= 1 ) then
      return "|cffffdc3c팔라딘|cffc3dbff이 미뤄둔 |c009f9f9f호러캐슬|cffc3dbff을 소탕하자."
    endif
  elseif ( Qno == 13 ) then
    if ( level >= 1 ) then
      return "|cffffdc3c궁중 마법사|cffc3dbff의 연구를 위해 |c009f9f9f호러캐슬|cffc3dbff에서 혼돈의핵을 구해오자"
    endif
  elseif ( Qno == 14 ) then
    if ( level >= 1 ) then
      return "|cffffdc3c퇴역 경비조|cffc3dbff의 별미를 위해 |c009f9f9f죽음의 마을|cffc3dbff에서 좀비 살점을 구해오자"
    endif
  elseif ( Qno == 15 ) then
    if ( level >= 1 ) then
      return "|cffffdc3c퇴역 경비조|cffc3dbff의 별미를 위해 |c009f9f9f죽음의 마을|cffc3dbff에서 좀비 살점을 구해오자"
    endif
  elseif ( Qno == 16 ) then
    if ( level >= 1 ) then
      return "|cffffdc3c망령|cffc3dbff의 만족을 위해 |c009f9f9f죽음의 마을|cffc3dbff에서 좀비를 토벌하자. (파티원 공통)"
    endif
  endif
 return ""
endfunction
function QuestPing takes integer P, integer Qno, integer level returns nothing
  if ( Qno == 4 ) then
    if ( level >= 1 ) and ( level < 5 ) then
      call Ping(Player(P-1), GetRectCenterX(gg_rct_Moving_01), GetRectCenterY(gg_rct_Moving_01), 8.)
    endif
  elseif ( Qno == 5 ) then
    if ( level == 1 ) then
      call Ping(Player(P-1), GetWidgetX(gg_unit_n02P_0193), GetWidgetY(gg_unit_n02P_0193), 8.)
    elseif ( level == 2 ) then
      call Ping(Player(P-1), GetWidgetX(gg_unit_u002_0192), GetWidgetY(gg_unit_u002_0192), 8.)
    elseif ( level == 4 ) then
      call Ping(Player(P-1), GetRandomReal(GetRectMinX(gg_rct_Quest05_Tresure),GetRectMaxX(gg_rct_Quest05_Tresure)), GetRandomReal(GetRectMinY(gg_rct_Quest05_Tresure),GetRectMaxY(gg_rct_Quest05_Tresure)), -3.)
      call Ping(Player(P-1), GetRandomReal(GetRectMinX(gg_rct_Quest05_Tresure),GetRectMaxX(gg_rct_Quest05_Tresure)), GetRandomReal(GetRectMinY(gg_rct_Quest05_Tresure),GetRectMaxY(gg_rct_Quest05_Tresure)), 7.)
    elseif ( level == 5 ) then
      if ( CountItem(P, 'I08E') < 0 ) then
        call Ping(Player(P-1), GetRandomReal(GetRectMinX(gg_rct_Quest05_Pantent),GetRectMaxX(gg_rct_Quest05_Pantent)), GetRandomReal(GetRectMinY(gg_rct_Quest05_Pantent),GetRectMaxY(gg_rct_Quest05_Pantent)), -3.)
        call Ping(Player(P-1), GetRandomReal(GetRectMinX(gg_rct_Quest05_Pantent),GetRectMaxX(gg_rct_Quest05_Pantent)), GetRandomReal(GetRectMinY(gg_rct_Quest05_Pantent),GetRectMaxY(gg_rct_Quest05_Pantent)), 7.)
      else
        call Ping(Player(P-1), GetWidgetX(gg_unit_u001_0191), GetWidgetY(gg_unit_u001_0191), 8.)
      endif
    endif
  elseif ( Qno == 6 ) then
    if ( level >= 1 ) then
      call Ping(Player(P-1), GetRectCenterX(gg_rct_Moving_03), GetRectCenterY(gg_rct_Moving_03), 8.)
    endif
  elseif ( Qno == 7 ) then
    if ( level <= 3 ) then
      if ( udg_Quest_ClearInt_07[P] >= 15 ) then
        call MSG(Player(P-1), 1, 8., "　　└현재 잡은 몬스터 수 : [ |cff46ffff" + I2S(udg_Quest_ClearInt_07[P]) + "|cffffdc3c / |cff9932cc15|cffffdc3c ]마리 (총 |cffff0000"+I2S(level-1)+"|cffffdc3c/3회 반복)")
      else
        call MSG(Player(P-1), 1, 8., "　　└현재 잡은 몬스터 수 : [ |cffff0000" + I2S(udg_Quest_ClearInt_07[P]) + "|cffffdc3c / |cff9932cc15|cffffdc3c ]마리 (총 |cffff0000"+I2S(level-1)+"|cffffdc3c/3회 반복)")
      endif
    elseif ( level >= 5 ) and ( level <= 7 ) then
      if ( udg_Quest_ClearInt_07[P] >= 15 ) then
        call MSG(Player(P-1), 1, 8., "　　└현재 잡은 몬스터 수 : [ |cff46ffff" + I2S(udg_Quest_ClearInt_07[P]) + "|cffffdc3c / |cff9932cc15|cffffdc3c ]마리 (총 |cffff0000"+I2S(level-5)+"|cffffdc3c/3회 반복)")
      else
        call MSG(Player(P-1), 1, 8., "　　└현재 잡은 몬스터 수 : [ |cffff0000" + I2S(udg_Quest_ClearInt_07[P]) + "|cffffdc3c / |cff9932cc15|cffffdc3c ]마리 (총 |cffff0000"+I2S(level-5)+"|cffffdc3c/3회 반복)")
      endif
    elseif ( level >= 9 ) and ( level <= 11 ) then
      if ( udg_Quest_ClearInt_07[P] >= 15 ) then
        call MSG(Player(P-1), 1, 8., "　　└현재 잡은 몬스터 수 : [ |cff46ffff" + I2S(udg_Quest_ClearInt_07[P]) + "|cffffdc3c / |cff9932cc15|cffffdc3c ]마리 (총 |cffff0000"+I2S(level-9)+"|cffffdc3c/3회 반복)")
      else
        call MSG(Player(P-1), 1, 8., "　　└현재 잡은 몬스터 수 : [ |cffff0000" + I2S(udg_Quest_ClearInt_07[P]) + "|cffffdc3c / |cff9932cc15|cffffdc3c ]마리 (총 |cffff0000"+I2S(level-9)+"|cffffdc3c/3회 반복)")
      endif
    elseif ( level == 13 ) then
      if ( udg_Quest_ClearInt_07[P] >= 1 ) then
        call MSG(Player(P-1), 1, 8., "　　└현재 킹 아크퍼스 : [ |cff46ffff처치 완료|cffffdc3c ]")
      else
        call MSG(Player(P-1), 1, 8., "　　└현재 킹 아크퍼스 : [ |cffff0000처치 미완료|cffffdc3c ]")
      endif
    endif
  elseif ( Qno == 8 ) then
    if ( level >= 1 ) then
      if ( udg_Quest_ClearInt_08[P] >= 20 ) then
        call MSG(Player(P-1), 1, 8., "　　└현재 잡은 몬스터 수 : [ |cff46ffff" + I2S(udg_Quest_ClearInt_08[P]) + "|cffffdc3c / |cff9932cc20|cffffdc3c ]마리 (반복)")
      else
        call MSG(Player(P-1), 1, 8., "　　└현재 잡은 몬스터 수 : [ |cffff0000" + I2S(udg_Quest_ClearInt_08[P]) + "|cffffdc3c / |cff9932cc20|cffffdc3c ]마리 (반복)")
      endif
    endif
  elseif ( Qno == 9 ) then
    if ( level == 1 ) then
      if ( udg_Quest_ClearInt_09[P] >= 60 ) then
        call MSG(Player(P-1), 1, 8., "　　└예상되는 만족도 : [ |cff46ffff" + R2SW(( I2R(udg_Quest_ClearInt_09[P])/0.60 ), 3, 1) + "|cffffdc3c% / |cff9932cc100|cffffdc3c% ] (반복)")
      else
        call MSG(Player(P-1), 1, 8., "　　└예상되는 만족도 : [ |cffff0000" + R2SW(( I2R(udg_Quest_ClearInt_09[P])/0.60 ), 3, 1) + "|cffffdc3c% / |cff9932cc100|cffffdc3c% ] (반복)")
      endif
    elseif ( level == 2 ) then
      if ( udg_Quest_ClearInt_09[P] >= 170 ) then
        call MSG(Player(P-1), 1, 8., "　　└예상되는 만족도 : [ |cff46ffff" + R2SW(( I2R(udg_Quest_ClearInt_09[P])/1.70 ), 3, 1) + "|cffffdc3c% / |cff9932cc100|cffffdc3c% ] (반복)")
      else
        call MSG(Player(P-1), 1, 8., "　　└예상되는 만족도 : [ |cffff0000" + R2SW(( I2R(udg_Quest_ClearInt_09[P])/1.70 ), 3, 1) + "|cffffdc3c% / |cff9932cc100|cffffdc3c% ] (반복)")
      endif
    elseif ( level == 3 ) then
      if ( udg_Quest_ClearInt_09[P] >= 300 ) then
        call MSG(Player(P-1), 1, 8., "　　└예상되는 만족도 : [ |cff46ffff" + R2SW(( I2R(udg_Quest_ClearInt_09[P])/3.00 ), 3, 1) + "|cffffdc3c% / |cff9932cc100|cffffdc3c% ] (반복)")
      else
        call MSG(Player(P-1), 1, 8., "　　└예상되는 만족도 : [ |cffff0000" + R2SW(( I2R(udg_Quest_ClearInt_09[P])/3.00 ), 3, 1) + "|cffffdc3c% / |cff9932cc100|cffffdc3c% ] (반복)")
      endif
    endif
  elseif ( Qno == 12 ) then
    if ( udg_Quest_ClearInt_12[P] >= 600 ) then
      call MSG(Player(P-1), 1, 8., "　　└현재 소탕한 몬스터 수 : [ |cff46ffff" + I2S(udg_Quest_ClearInt_12[P]) + "|cffffdc3c / |cff9932cc600|cffffdc3c ]마리")
    else
      call MSG(Player(P-1), 1, 8., "　　└현재 소탕한 몬스터 수 : [ |cffff0000" + I2S(udg_Quest_ClearInt_12[P]) + "|cffffdc3c / |cff9932cc600|cffffdc3c ]마리")
    endif
  elseif ( Qno == 13 ) then
    if ( level == 1 ) then
      if ( udg_Quest_ClearInt_13[P] >= 10 ) then
        call MSG(Player(P-1), 1, 8., "　　└현재 수집한 핵 : [ |cff46ffff" + I2S(udg_Quest_ClearInt_13[P]) + "|cffffdc3c / |cff9932cc10|cffffdc3c ]개")
      else
        call MSG(Player(P-1), 1, 8., "　　└현재 수집한 핵 : [ |cffff0000" + I2S(udg_Quest_ClearInt_13[P]) + "|cffffdc3c / |cff9932cc10|cffffdc3c ]개")
      endif
    elseif ( level == 2 ) then
      if ( udg_Quest_ClearInt_13[P] >= 100 ) then
        call MSG(Player(P-1), 1, 8., "　　└현재 수집한 핵 : [ |cff46ffff" + I2S(udg_Quest_ClearInt_13[P]) + "|cffffdc3c / |cff9932cc100|cffffdc3c ]개")
      else
        call MSG(Player(P-1), 1, 8., "　　└현재 수집한 핵 : [ |cffff0000" + I2S(udg_Quest_ClearInt_13[P]) + "|cffffdc3c / |cff9932cc100|cffffdc3c ]개")
      endif
      call MSG(Player(P-1), 1, 8., "　　└마법사와 대화시, 파티원 중, 가장 많은 개수를 기준으로 진행합니다.")
    elseif ( level == 3 ) then
      if ( udg_Quest_ClearInt_13[P] >= 500 ) then
        call MSG(Player(P-1), 1, 8., "　　└현재 수집한 핵 : [ |cff46ffff" + I2S(udg_Quest_ClearInt_13[P]) + "|cffffdc3c / |cff9932cc500|cffffdc3c ]개")
      else
        call MSG(Player(P-1), 1, 8., "　　└현재 수집한 핵 : [ |cffff0000" + I2S(udg_Quest_ClearInt_13[P]) + "|cffffdc3c / |cff9932cc500|cffffdc3c ]개")
      endif
    endif
  elseif ( Qno == 14 ) then
    if ( level == 1 ) then
      if ( udg_Quest_ClearInt_14 >= 50 ) then
        call MSG(Player(P-1), 1, 8., "　　└현재 수집한 살점 : [ |cff46ffff" + I2S(udg_Quest_ClearInt_14) + "|cffffdc3c / |cff9932cc50|cffffdc3c ]개")
      else
        call MSG(Player(P-1), 1, 8., "　　└현재 수집한 살점 : [ |cffff0000" + I2S(udg_Quest_ClearInt_14) + "|cffffdc3c / |cff9932cc50|cffffdc3c ]개")
      endif
    endif
  elseif ( Qno == 15 ) then
    if ( level >= 1 ) then
      call MSG(Player(P-1), 1, 8., "　　└현재 도달한 웨이브 : [ |cff46ffff" + I2S(udg_Quest_ClearInt_15) + "|cffffdc3c웨이브 ]")
    endif
  elseif ( Qno == 16 ) then
    if ( level >= 1 ) then
      if ( udg_Quest_ClearInt_16 >= 1500 ) then
        call MSG(Player(P-1), 1, 8., "　　└예상되는 만족도 : [ |cff46ffff" + R2SW(( I2R(udg_Quest_ClearInt_16)/15. ), 3, 1) + "|cffffdc3c% / |cff9932cc100|cffffdc3c% ] (반복)")
      else
        call MSG(Player(P-1), 1, 8., "　　└예상되는 만족도 : [ |cffff0000" + R2SW(( I2R(udg_Quest_ClearInt_16)/15. ), 3, 1) + "|cffffdc3c% / |cff9932cc100|cffffdc3c% ] (반복)")
      endif
    endif
  endif
endfunction
function QuestHelper takes integer P returns nothing
 local integer Qno = 0
 local string s = ""
  loop
    if ( QuestDetail(Qno, Quest_Level(P, Qno)) != "" ) then
      if ( Quest_Level(P, Qno) > 0 ) and ( Quest_Level(P, Qno) < S2I(FCut(QuestName(Qno),2)) ) then
        if ( s == "" ) then
          call MSG(Player(P-1), 1, 3., "현재 진행중인 퀘스트")
          set s = "-"
        endif
        call MSG(Player(P-1), 1, 6., "|cff0080ff" + FCut(QuestName(Qno),1)+"|cffc3dbff의 진행도 : |cffffdc3c" + I2S(Quest_Level(P, Qno)) + "|r / |cff0078ff" + FCut(QuestName(Qno),2) + "|cffc3dbff입니다.")
        call MSG(Player(P-1), 11, 7., QuestDetail(Qno, Quest_Level(P, Qno)))
        call QuestPing(P, Qno, Quest_Level(P, Qno))
      endif
    endif
    exitwhen Qno >= QUEST_COUNT
    set Qno = Qno + 1
  endloop
  
  call TriggerSleepAction(.1)
  //진행 가능한 퀘스트 목록
  set s = ""
  set Qno = 1
  loop
    if ( Quest_Level(P, Qno) == 0 ) and ( S2I(FCut(QuestName(Qno),3)) <= udg_SysB_Level[P] ) and ( udg_SysB_Level[P] <= S2I(FCut(QuestName(Qno),4)) ) then
      set s = s + "\n|cff0080ff" + FCut(QuestName(Qno),1) + "|cffc3dbff(|cffffff00Lv."+FCut(QuestName(Qno),3)+"~"+FCut(QuestName(Qno),4)+"|cffc3dbff) - "+ FCut(QuestName(Qno),5)
    endif
    exitwhen Qno >= QUEST_COUNT
    set Qno = Qno + 1
  endloop
  
  if ( s != "" ) then
    call MSG(Player(P-1), 1, 7., "진행할 수 있는 퀘스트(마을)"+s)
  endif
  call TriggerSleepAction(.1)
  //3레벨 이내 진행 가능한 퀘스트 목록
  set s = ""
  set Qno = 1
  loop
    if ( S2I(FCut(QuestName(Qno),3)) > udg_SysB_Level[P] ) and ( udg_SysB_Level[P]+3 >= S2I(FCut(QuestName(Qno),3)) ) then
      set s = s + "\n|cff0080ff" + FCut(QuestName(Qno),1) + "|cffc3dbff(|cffff0000Lv."+FCut(QuestName(Qno),3)+"~|cffc3dbff) - "+ FCut(QuestName(Qno),5)
    endif
    exitwhen Qno >= QUEST_COUNT
    set Qno = Qno + 1
  endloop
  
  if ( s != "" ) then
    call MSG(Player(P-1), 1, 8., "3레벨 이내 진행할 수 있는 퀘스트(마을)"+s)
  endif
  
  if ( udg_Quest_00_Note[P] == 36 ) then
    set udg_Quest_00_Note[P] = 37
    call MSG(Player(P-1), 1, 3., "초보자 퀘스트 - 클릭하여 계속 진행하세요.")
  endif
  //진행 가능한 퀘스트 목록2 (10레벨 이내)
endfunction
function Trig_Intr_Quest_Helper_Actions takes nothing returns nothing
  if ( GetTriggerEventId() == EVENT_PLAYER_UNIT_USE_ITEM ) then
    call QuestHelper(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1)
  elseif ( GetTriggerEventId() ==  ConvertPlayerEvent(96) ) then
    //EVENT_PLAYER_CHAT이 제대로 작동 안하고 있지도 않은 96번으로 작동함.
    call QuestHelper(GetPlayerId(GetTriggerPlayer())+1)
  endif
endfunction

//===========================================================================
function InitTrig_Intr_Quest_Helper takes nothing returns nothing
    set gg_trg_Intr_Quest_Helper = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Intr_Quest_Helper, function Trig_Intr_Quest_Helper_Actions )
endfunction

//===========================================================================
// Trigger: Item87AIlu
//===========================================================================
function Trig_Item87AIlu_Actions takes nothing returns nothing
  //최근 마을로 이동. 5초 캐스팅
  call SetUnitPositionLoc(udg_temp_u, udg_SysA_Revive[udg_temp_i])
  call FMi_Cam(GetOwningPlayer(udg_temp_u), false)
  if ( udg_Quest_00_Note[udg_temp_i] == 18 ) then
    set udg_Quest_00_Note[udg_temp_i] = 19
  call MSG(Player(udg_temp_i-1), 2, 6, "초보자 지침서|cffffcc00(Z)|cffffdc3c를 클릭하여 다음 단계로 넘어가세요.")
  endif
endfunction

//===========================================================================
function InitTrig_Item87AIlu takes nothing returns nothing
    set gg_trg_Item87AIlu = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item87AIlu, function Trig_Item87AIlu_Actions )
endfunction

//===========================================================================
// Trigger: Item81A015
//===========================================================================
function Trig_Item81A015_Actions takes nothing returns nothing
 local integer loopA = 1
 local real x = GetLocationX(udg_temp_l)
 local real y = GetLocationY(udg_temp_l)
  call RemoveLocation(udg_temp_l)
  set udg_temp_i = GetPlayerId(GetOwningPlayer(udg_temp_u))+1
  if ( GetPlayerState(Player(udg_temp_i-1), PLAYER_STATE_RESOURCE_GOLD) < 20000 ) then
    call MSG(Player(udg_temp_i-1), 1, 4, "사용료가 부족합니다. 20,000Gold 이상 필요합니다.")
  elseif ( udg_SysC_Regen[udg_temp_i] < 100 or udg_OnesPositionN[udg_temp_i] >= 0 ) then
    call MSG(Player(udg_temp_i-1), 1, 4, "마을에서만 사용 가능합니다. |r" + I2S(udg_OnesPositionN[udg_temp_i]) + " // X: "+R2S(x))
debug call BJDebugMsg("test u - " + GetUnitName(udg_temp_u))
debug call BJDebugMsg("test i - " + I2S(udg_temp_i))
  else
    loop
      if ( RectContainsCoords(Vileage_Rect(loopA), x, y) ) then
        call MSG(Player(udg_temp_i-1), 1, 4, I2S(IMaxBJ(20000,R2I(GetPlayerState(Player(udg_temp_i-1), PLAYER_STATE_RESOURCE_GOLD)*0.05)))+" Gold를 소모하여 해당 마을로 이동합니다.")
        call SetPlayerState(Player(udg_temp_i-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(udg_temp_i-1), PLAYER_STATE_RESOURCE_GOLD)-IMaxBJ(20000,R2I(GetPlayerState(Player(udg_temp_i-1), PLAYER_STATE_RESOURCE_GOLD)*0.05)))
        call SetUnitPosition(udg_Unit[udg_temp_i], x, y)
        exitwhen true
      elseif ( loopA == 14 ) then
        if ( RectContainsCoords(Vileage_Rect(142), x, y) ) then
        call MSG(Player(udg_temp_i-1), 1, 4, I2S(IMaxBJ(20000,R2I(GetPlayerState(Player(udg_temp_i-1), PLAYER_STATE_RESOURCE_GOLD)*0.05)))+" Gold를 소모하여 해당 마을로 이동합니다.")
        call SetPlayerState(Player(udg_temp_i-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(udg_temp_i-1), PLAYER_STATE_RESOURCE_GOLD)-IMaxBJ(20000,R2I(GetPlayerState(Player(udg_temp_i-1), PLAYER_STATE_RESOURCE_GOLD)*0.05)))
        call SetUnitPosition(udg_Unit[udg_temp_i], x, y)
        exitwhen true
        endif
      endif
      exitwhen loopA >= 16
      set loopA = loopA +1
    endloop
    call FMi_Cansle(udg_temp_u, 2)
  endif
endfunction

//===========================================================================
function InitTrig_Item81A015 takes nothing returns nothing
    set gg_trg_Item81A015 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item81A015, function Trig_Item81A015_Actions )
endfunction

//===========================================================================
// Trigger: Item45A014
//===========================================================================
function Trig_Item45A014_Actions takes nothing returns nothing
  if ( udg_temp_u == udg_temp_u2 ) then
    call PartyInvite(udg_temp_i, "All")
  else
    call PartyInvite(GetPlayerId(GetTriggerPlayer())+1, I2S(GetPlayerId(GetOwningPlayer(udg_temp_u2))+1))
  endif
endfunction

//===========================================================================
function InitTrig_Item45A014 takes nothing returns nothing
  set gg_trg_Item45A014 = CreateTrigger()
  call TriggerAddAction(gg_trg_Item45A014, function Trig_Item45A014_Actions)
endfunction

//===========================================================================
// Trigger: Item fooiffs Buff
//===========================================================================
function Trig_Item_fooiffs_Buff_Actions takes nothing returns nothing
    local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
    local integer gold = GetHeroLevel(GetTriggerUnit())
    call RemoveItem( GetManipulatedItem() )
      if ( gold < 11 ) then
        set gold = 50
      elseif ( gold < 26 ) then
        set gold = 250
      elseif ( gold < 41 ) then
        set gold = 1000
      elseif ( gold < 56 ) then
        set gold = 3000
      elseif ( gold < 71 ) then
        set gold = 6000
      elseif ( gold < 86 ) then
        set gold = 12000
      elseif ( gold < 99 ) then
        set gold = 25000
      else
        set gold = 50000
      endif
    if ( gold == 100 and Quest_Level(P, 10) == 0 ) then
    call DisplayTimedTextToPlayer( GetOwningPlayer(GetTriggerUnit()), 0.50, 0, 4.00, "TRIGSTR_2484" )
    else
      if ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) >= gold ) then
    call DisplayTimedTextToPlayer( GetOwningPlayer(GetTriggerUnit()), 0.50, 0, 4.00, "TRIGSTR_2485" )
    call SetUnitAnimation( gg_unit_e019_0374, "death" )
        call SetBuff(udg_Unit[P], "ENA", 1800., 20)
        call SetBuff(udg_Unit[P], "BELLA", 1800., 25)
        call SetBuff(udg_Unit[P], "COLLA", 1800., 10)
        call SetBuff(udg_Unit[P], "HORR", 1800., 50)
    call DisplayTimedTextToPlayer( GetOwningPlayer(GetTriggerUnit()), 0.50, 0, 8.00, "TRIGSTR_2486" )
    call TriggerSleepAction( 2.00 )
    call ResetUnitAnimation( gg_unit_e019_0374 )
        if ( LoadInteger(udg_hash, StringHash(udg_SysB_Name[P]), 46) == 5 ) then
    call DisplayTimedTextToPlayer( GetOwningPlayer(GetTriggerUnit()), 0.50, 0, 8.00, "TRIGSTR_2487" )
        else
          call MSG(GetOwningPlayer(GetTriggerUnit()), 2, 3, "|c00ff8000NPC 푸잎|r : |c00ffff00수고비로 " + I2S(gold) + "Gold를 받아 가겠어.")
    call AdjustPlayerStateBJ(              (-gold), GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD )
        endif
      else
        call MSG(GetOwningPlayer(GetTriggerUnit()), 2, 4, "|c00ff8000NPC 푸잎|r : |c00ffff00돈이 없잖냐... 수고비로 " + I2S(gold) + "Gold는 필요하다구")
        if ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) >= gold*.7 ) then
    call TriggerSleepAction( 0.50 )
          call MSG(GetOwningPlayer(GetTriggerUnit()), 2, 4, "|c00ff8000NPC 푸잎|r : |c00ffff00뭐? 돈이 약간 부족한데 외상으로 해 달라고?")
    call TriggerSleepAction( 0.50 )
          call MSG(GetOwningPlayer(GetTriggerUnit()), 2, 4, "|c00ff8000NPC 푸잎|r : |c00ffff00난 뭐 땅 팔아먹고 사냐.. 에이.. 쳇. 기분이다! 착하게 살아!")
    call TriggerSleepAction( 0.50 )
    call SetUnitAnimation( gg_unit_e019_0374, "death" )
        call SetBuff(udg_Unit[P], "ENA", 1800., 20)
        call SetBuff(udg_Unit[P], "BELLA", 1800, 25)
        call SetBuff(udg_Unit[P], "COLLA", 1800, 10)
        call SetBuff(udg_Unit[P], "HORR", 1800, 50)
    call DisplayTimedTextToPlayer( GetOwningPlayer(GetTriggerUnit()), 0.50, 0, 8.00, "TRIGSTR_2488" )
    call TriggerSleepAction( 2.00 )
    call ResetUnitAnimation( gg_unit_e019_0374 )
          set gold = R2I(gold*.7)
    call AdjustPlayerStateBJ(              (-gold), GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD )
          call MSG(GetOwningPlayer(GetTriggerUnit()), 2, 3, "|c00ff8000NPC 푸잎|r : |c00ffff00니가 돈이 없으니까 수고비로 " + I2S(gold) + "Gold만 받을게.")
        endif
      endif
    endif
    set P = 0
    set gold = 0
endfunction

//===========================================================================
function InitTrig_Item_fooiffs_Buff takes nothing returns nothing
    set gg_trg_Item_fooiffs_Buff = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item_fooiffs_Buff, function Trig_Item_fooiffs_Buff_Actions )
endfunction

//===========================================================================
// Trigger: Item RecallAll
//
// |c00ff8000라마|r : |c00ffff00어디로 가시겠어요?|r
// |c00ff8000라마|r : |c00ffff00|r
// |c00ffff00시간이 모두 지났습니다. (골드 반환)|r
//===========================================================================
function Trig_Item_RecallAll_Actions takes nothing returns nothing
  if ( GetItemTypeId(GetManipulatedItem()) == 'I08T' ) then
    set udg_temp_u = GetTriggerUnit()
    call RemoveItem(GetManipulatedItem())
    call QMsg(GetPlayerId(GetOwningPlayer(udg_temp_u))+1, 0, "라마", "이동할 지역을 선택해주세요. 마을에 따라 소모 Gold가 달라요.", 0.)
  else
    call MSG(GetOwningPlayer(udg_temp_u), 1, 7, "이동할 지역 앞 숫자를 입력해주세요. 마을에 따라 소모 Gold가 다릅니다.")
  endif
  set udg_temp_i = GetPlayerState(GetOwningPlayer(udg_temp_u), PLAYER_STATE_RESOURCE_GOLD)/200
  call QMsg(GetPlayerId(GetOwningPlayer(udg_temp_u))+1, 12, "3", "|c00d962b5　１.|cffc3dbff노비스 |c00ffff00(무료)
|c00d962b5　２.|cffc3dbff밀레스 |c00ffff00("+I2S(50+udg_temp_i)+")
|c00d962b5　３.|cffc3dbff루어스 |c00ffff00("+I2S(100+udg_temp_i)+")
|c00d962b5　４.|cffc3dbff피에트 |c00ffff00("+I2S(150+udg_temp_i)+")
|c00d962b5　５.|cffc3dbff수오미 |c00ffff00("+I2S(150+udg_temp_i)+")
|c00d962b5　６.|cffc3dbff아　벨 |c00ffff00("+I2S(200+udg_temp_i)+")
|c00d962b5　７.|cffc3dbff호　엔 |c00ffff00("+I2S(250+udg_temp_i)+")
|c00d962b5　８.|cffc3dbff운디네 |c00ffff00("+I2S(300+udg_temp_i)+")
|c00d962b5　９.|cffc3dbff뤼케시온 |c00ffff00("+I2S(350+udg_temp_i)+")
|c00d962b5１０.|cffc3dbff마　인 |c00ffff00("+I2S(500+udg_temp_i*2)+")
|c00d962b5１１.|cffc3dbff여　관 |c00ffff00("+I2S(100+udg_temp_i*4)+")", 10.)
endfunction

//===========================================================================
function InitTrig_Item_RecallAll takes nothing returns nothing
    set gg_trg_Item_RecallAll = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item_RecallAll, function Trig_Item_RecallAll_Actions )
endfunction

//===========================================================================
// Trigger: Item Comax10dtsbdrph
//===========================================================================
function Trig_Item_Comax10dtsbdrph_Actions takes nothing returns nothing
  call GiveItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 'I08V', GetItemCharges(GetManipulatedItem()))
  call RemoveItem(GetManipulatedItem())
endfunction

//===========================================================================
function InitTrig_Item_Comax10dtsbdrph takes nothing returns nothing
    set gg_trg_Item_Comax10dtsbdrph = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item_Comax10dtsbdrph, function Trig_Item_Comax10dtsbdrph_Actions )
endfunction

//===========================================================================
// Trigger: Item Hornshea
//===========================================================================
function Trig_Item_Hornshea_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
  set udg_temp_g = GetUnitsInRectMatching(gg_rct_Effect_08_Nanpa, Condition(function Quest07Condi))
  if ( CountUnitsInGroup(udg_temp_g) == 0 ) then
    call MSGAll(0, true, 1, 2, 10., "|c00d962b5＊|cffffdc3c" + udg_PartyTitle[udg_PartyNumber_ThisP[P]] + "|cffffdc3c 파티가 킹 아크퍼스를 깨웁니다.|r")
    call AttachSoundToUnit(gg_snd_TheHornOfCenarius, udg_Unit[P])
    call StartSound (gg_snd_TheHornOfCenarius)
  
    set bj_lastCreatedUnit = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'n02O', -13184, -19328, 120.)
    set udg_temp_r = udg_PartyNumber_pP[udg_PartyNumber_ThisP[P]] + 5
    
    call SaveReal(udg_hash, GetHandleId(bj_lastCreatedUnit), StringHash("BonusHP"), udg_temp_r*GetRandomReal(.3,.45))
    call SetUS("Hp", bj_lastCreatedUnit, R2I(GetWidgetLife(bj_lastCreatedUnit)*(1.+LoadReal(udg_hash, GetHandleId(bj_lastCreatedUnit), StringHash("BonusHP")))), true)
    call SetUS("DMG", bj_lastCreatedUnit, -750+R2I(udg_temp_r*300), true)
    call SetUS2("Miss", bj_lastCreatedUnit, 20.+udg_temp_r*5.)
    call SetUS2("mdf", bj_lastCreatedUnit, 5.*udg_temp_r)
    call SetUnitUserData(bj_lastCreatedUnit, -1)
    call SetUnitState(bj_lastCreatedUnit, ConvertUnitState($50), 6.) /* 보스 방어 취급 */
    call BossBar_Apply(GetLocalPlayer(), bj_lastCreatedUnit)
    set udg_temp_r = 0
  else
    call MSGAll(P, false, 40, 1, 4, "이미 소환되어 있습니다.")
    call SetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD)+100000)
  endif
  call DestroyGroup(udg_temp_g)
  call Ping(Player(P-1), -13184, -19328, 7.)
endfunction

//===========================================================================
function InitTrig_Item_Hornshea takes nothing returns nothing
    set gg_trg_Item_Hornshea = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item_Hornshea, function Trig_Item_Hornshea_Actions )
endfunction

//===========================================================================
// Trigger: Item Boss1lmbr
//===========================================================================
function Boss_HpCheck takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local unit u = LoadUnitHandle(udg_hash, GetHandleId(t), StringHash("Boss-U"))
 local real hpPer = GetWidgetLife(u) / GetUnitState(u,UNIT_STATE_MAX_LIFE)
 local integer phase = LoadInteger(udg_hash, GetHandleId(u), StringHash("FAI-Phase"))
  if ( phase < 2 ) and ( hpPer <= .7 ) then
    call BossPhase(u, 2)
  elseif ( phase < 3 ) and ( hpPer <= .4 ) then
    call BossPhase(u, 3)
  elseif ( phase < 4 ) and ( hpPer <= .1 ) then
    call BossPhase(u, 4)
    call FlushChildHashtable(udg_hash, GetHandleId(t))
    call DestroyTimer(t)
  endif
 set t = null
 set u = null
endfunction

function Boss_Condi takes nothing returns boolean
  return ( GetUnitAbilityLevel(GetFilterUnit(), 'A00O') > 0 )
endfunction
function Trig_Item_Boss1lmbr_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
  if ( P != udg_PartyNumber_ThisP[P] ) then
    call MSG(Player(P-1), 1, 3, "파티장만 진행할 수 있습니다. 대기해주세요.")
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", GetTriggerUnit(), "overhead"))
  elseif ( GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD) < 200000 ) then
    call MSG(Player(P-1), 1, 3, "골드가 부족합니다.|cffffff00 200,000Gold |cffffdc3c이상 필요합니다.")
  elseif ( LoadBoolean(udg_hash, StringHash("Boss1"), 0) ) then
    call MSG(Player(P-1), 1, 3, "이미 잡았습니다. 다음 방에서 다시 시도해주세요.")
  else
    set udg_temp_g = GroupEnumUnitsInRect2(CreateGroup(), BOSSRECT(1), Condition(function Boss_Condi))
    if ( CountInGroup(udg_temp_g) != 0 ) then
      call MSGAll(0, true, 1, 2, 10., "|c00d962b5＊|cffffdc3c" + udg_PartyTitle[udg_PartyNumber_ThisP[P]] + "|cffffdc3c 파티가 킹 아크퍼스 레이드를 이어합니다.|r")
    else
      //call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD)-200000)
      call AttachSoundToUnit(gg_snd_TheHornOfCenarius, udg_Unit[P])
      call StartSound (gg_snd_TheHornOfCenarius)
      call MSGAll(0, true, 1, 2, 10., "|c00d962b5＊|cffffdc3c" + udg_PartyTitle[udg_PartyNumber_ThisP[P]] + "|cffffdc3c 파티가 킹 아크퍼스 레이드를 시작합니다.|r")
    
      set bj_lastCreatedUnit = CreateUnit(Player(PLAYER_NEUTRAL_AGGRESSIVE), 'n02O', 25597.9, -16651.6, 303.237)
      
      set udg_temp_r = 0.
      set bj_forLoopAIndex = 1
      loop
        exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == P ) and ( RectContainsUnit(Vileage_Rect(15), udg_Unit[bj_forLoopAIndex]) ) and ( UnitAlive(udg_Unit[bj_forLoopAIndex]) ) then
          set udg_temp_r = udg_temp_r + ( GetHPMP(bj_forLoopAIndex, true)/20000. + GetHPMP(bj_forLoopAIndex, false)/10000. )
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
      set udg_temp_r = RMaxBJ(1.,udg_temp_r)
      
      call SaveReal(udg_hash, GetHandleId(bj_lastCreatedUnit), StringHash("BonusHP"), udg_temp_r*.1)
      call SetUS("Hp", bj_lastCreatedUnit, R2I(GetWidgetLife(bj_lastCreatedUnit)*(1.+LoadReal(udg_hash, GetHandleId(bj_lastCreatedUnit), StringHash("BonusHP")))), true)
      call SetUS("Mp", bj_lastCreatedUnit, 99, true)
      call SetUS("DMG", bj_lastCreatedUnit, -900+R2I(udg_temp_r*900.), true)
      call SetUS2("Miss", bj_lastCreatedUnit, 20.+udg_temp_r*5.)
      call SetUS2("mdf", bj_lastCreatedUnit, 5.*udg_temp_r)
      call SetUS2("mrd2", bj_lastCreatedUnit, .7)
      //홀볼, 중독류 70% 감소
      call SetUS("Armor", bj_lastCreatedUnit, R2I(5.*udg_temp_r), true)
      call SetUS("MAC", bj_lastCreatedUnit, R2I(5.*udg_temp_r), true)
      call SetUnitUserData(bj_lastCreatedUnit, -1)
      set udg_temp_r = 0
      
      //보스취급
      call SetUnitState(bj_lastCreatedUnit, ConvertUnitState($50), 6.)
      
      set bj_lastStartedTimer = CreateTimer()
      call SaveUnitHandle(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("Boss-U"), bj_lastCreatedUnit)
      call TimerStart(bj_lastStartedTimer, .5, true, function Boss_HpCheck)
    endif
    call DestroyGroup(udg_temp_g)
    
    call IssueImmediateOrder(GetTriggerUnit(), "stop")
    call PauseUnit(GetTriggerUnit(), true)
    call MSGAll(P, false, 1, 1, 6, "|cffffdc3c※참고. 5초 후, 여관에 있는 파티원 모두가 이동합니다.")
    call TriggerSleepAction(5.)
    
    set bj_forLoopAIndex = 1
    loop
      exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
      if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == P ) then
        //여관에 있음
        if ( RectContainsUnit(Vileage_Rect(15), udg_Unit[bj_forLoopAIndex]) ) then
          if ( UnitAlive(udg_Unit[bj_forLoopAIndex]) ) then
            call SetUnitPosition(udg_Unit[bj_forLoopAIndex], 26752., -18880.)
            call FMi_Cam(Player(P-1), false)
          elseif ( bj_forLoopAIndex == P ) then
            call MSGAll(bj_forLoopAIndex, false, 1, 2, 12, "|cff0080ff파티장 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80영웅 사망함 |cff0080ff]")
          else
            call MSGAll(bj_forLoopAIndex, false, 1, 2, 11, "|cff00ffff파티원 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80영웅 사망함 |cff00ffff]")
          endif
        elseif ( bj_forLoopAIndex == P ) then
          call MSGAll(bj_forLoopAIndex, false, 1, 2, 12, "|cff0080ff파티장 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80여관 아님 |cff0080ff]")
        else
          call MSGAll(bj_forLoopAIndex, false, 1, 2, 11, "|cff00ffff파티원 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80여관 아님 |cff00ffff]")
        endif
      endif
      set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    call PauseUnit(GetTriggerUnit(), false)
  endif
 set P = 0
endfunction

//===========================================================================
function InitTrig_Item_Boss1lmbr takes nothing returns nothing
    set gg_trg_Item_Boss1lmbr = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item_Boss1lmbr, function Trig_Item_Boss1lmbr_Actions )
endfunction

//===========================================================================
// Trigger: Item Move1Wood1shwd
//===========================================================================
function Trig_Item_Move1Wood1shwd_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
  call SetUnitPosition(udg_Unit[P], -8736., 4064.)
  call FMi_Cam(Player(P-1), false)
endfunction

//===========================================================================
function InitTrig_Item_Move1Wood1shwd takes nothing returns nothing
    set gg_trg_Item_Move1Wood1shwd = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item_Move1Wood1shwd, function Trig_Item_Move1Wood1shwd_Actions )
endfunction

//===========================================================================
// Trigger: Item Move1Wood2rma2
//===========================================================================
function Trig_Item_Move1Wood2rma2_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
  call SetUnitPosition(udg_Unit[P], -11040., 8032.)
  call FMi_Cam(Player(P-1), false)
endfunction

//===========================================================================
function InitTrig_Item_Move1Wood2rma2 takes nothing returns nothing
    set gg_trg_Item_Move1Wood2rma2 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item_Move1Wood2rma2, function Trig_Item_Move1Wood2rma2_Actions )
endfunction

//===========================================================================
// Trigger: Item Move1Wood3rej1
//===========================================================================
function Trig_Item_Move1Wood3rej1_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
  call SetUnitPosition(udg_Unit[P], -13696., 10848.)
  call FMi_Cam(Player(P-1), false)
endfunction

//===========================================================================
function InitTrig_Item_Move1Wood3rej1 takes nothing returns nothing
    set gg_trg_Item_Move1Wood3rej1 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item_Move1Wood3rej1, function Trig_Item_Move1Wood3rej1_Actions )
endfunction

//===========================================================================
// Trigger: Item Move Graves1tels
//===========================================================================
function Trig_Item_Move_Graves1_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
  call SetUnitPosition(udg_Unit[P], 9472., -13568.)
  call FMi_Cam(Player(P-1), false)
endfunction

//===========================================================================
function InitTrig_Item_Move_Graves1tels takes nothing returns nothing
    set gg_trg_Item_Move_Graves1tels = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item_Move_Graves1tels, function Trig_Item_Move_Graves1_Actions )
endfunction

//===========================================================================
// Trigger: Item Move Graves2gobm
//===========================================================================
function Trig_Item_Move_Graves2_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
  call SetUnitPosition(udg_Unit[P], 12384., -17344.)
  call FMi_Cam(Player(P-1), false)
endfunction

//===========================================================================
function InitTrig_Item_Move_Graves2gobm takes nothing returns nothing
    set gg_trg_Item_Move_Graves2gobm = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item_Move_Graves2gobm, function Trig_Item_Move_Graves2_Actions )
endfunction

//===========================================================================
// Trigger: Item Move fote nflg
//===========================================================================
function Trig_Item_Move_fote_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
  call SetUnitPosition(udg_Unit[P], 10048., -9376.)
  call FMi_Cam(Player(P-1), false)
endfunction

//===========================================================================
function InitTrig_Item_Move_fote_nflg takes nothing returns nothing
    set gg_trg_Item_Move_fote_nflg = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item_Move_fote_nflg, function Trig_Item_Move_fote_Actions )
endfunction

//===========================================================================
// Trigger: Item Move bitch shdt
//===========================================================================
function Trig_Item_Move_bitch_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
  call SetUnitPosition(udg_Unit[P], -2752., -14304.)
  call FMi_Cam(Player(P-1), false)
endfunction

//===========================================================================
function InitTrig_Item_Move_bitch_shdt takes nothing returns nothing
    set gg_trg_Item_Move_bitch_shdt = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item_Move_bitch_shdt, function Trig_Item_Move_bitch_Actions )
endfunction

//===========================================================================
// Trigger: Item Move harmony ram3
//===========================================================================
function Trig_Item_Move_harmony_Actions takes nothing returns nothing
 call TriggerExecute(gg_trg_Moving_Harmonious_2)
endfunction

//===========================================================================
function InitTrig_Item_Move_harmony_ram3 takes nothing returns nothing
    set gg_trg_Item_Move_harmony_ram3 = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item_Move_harmony_ram3, function Trig_Item_Move_harmony_Actions )
endfunction

//===========================================================================
// Trigger: Item Move Horr pnvu
//===========================================================================
function Horr_Enter takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
  call RemoveItem( GetManipulatedItem() )
   if ( udg_SysB_Level[P] >= 86 ) then
     call SetUnitPosition(udg_Unit[P], 16288., -19392.)
   else
     call MSG(Player(P-1), 1, 3., "레벨이 부족합니다. 86부터 이용 가능합니다.")
     call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", GetTriggerUnit(), "overhead"))
     call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD)+30000)
   endif
endfunction

//===========================================================================
function InitTrig_Item_Move_Horr_pnvu takes nothing returns nothing
    set gg_trg_Item_Move_Horr_pnvu = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item_Move_Horr_pnvu, function Horr_Enter )
endfunction

//===========================================================================
// Trigger: Item Move Mine mgtk
//===========================================================================
function Mine_Enter takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
  call RemoveItem( GetManipulatedItem() )
   if ( udg_SysB_Level[P] >= 99 ) then
     set udg_OnesPositionN[P] = 51
     set udg_SYSTEM_MineFloor = 1
     call SetUnitPosition(udg_Unit[P], GetRandomReal(18016., 18304.), GetRandomReal(-16800., -16576.))
     call MSG(Player(bj_forLoopAIndex-1), 5, 7, "광산 입구")
   else
     call MSG(Player(P-1), 1, 3., "레벨이 부족합니다. 99부터 이용 가능합니다.")
     call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", GetTriggerUnit(), "overhead"))
     call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD)+50000)
   endif
endfunction

//===========================================================================
function InitTrig_Item_Move_Mine_mgtk takes nothing returns nothing
    set gg_trg_Item_Move_Mine_mgtk = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item_Move_Mine_mgtk, function Mine_Enter )
endfunction

//===========================================================================
// Trigger: Item Move DeadVilleage dthb
//===========================================================================
function DeadVilleage_Enter takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
  call RemoveItem( GetManipulatedItem() )
   if ( udg_SysB_Level[P] >= 99 ) then
     set udg_OnesPositionN[P] = 61
     call SetUnitPosition(udg_Unit[P], 18240., -11104.)
     call MSG(Player(bj_forLoopAIndex-1), 5, 7, "죽음의 마을 입구")
   else
     call MSG(Player(P-1), 1, 3., "레벨이 부족합니다. 99부터 이용 가능합니다.")
     call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", GetTriggerUnit(), "overhead"))
     call SetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(P-1), PLAYER_STATE_RESOURCE_GOLD)+100000)
   endif
endfunction

//===========================================================================
function InitTrig_Item_Move_DeadVilleage_dthb takes nothing returns nothing
    set gg_trg_Item_Move_DeadVilleage_dthb = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Item_Move_DeadVilleage_dthb, function DeadVilleage_Enter )
endfunction

//===========================================================================
// Trigger: Rect Floor Up
//===========================================================================
function Trig_Rect_168_Mine_Exit_Conditions takes nothing returns boolean
  return IsUnitType(GetEnteringUnit(), UNIT_TYPE_HERO)
endfunction
function Trig_Rect_Floor_Up_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
  if ( P != udg_PartyNumber_ThisP[P] ) then
    call MSG(Player(P-1), 1, 3, "파티장만 진행할 수 있습니다. 대기해주세요.")
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", GetTriggerUnit(), "overhead"))
  elseif ( udg_SYSTEM_MineFloor >= 10 ) then
    call MSGAll(P, false, 1, 1, 4., "이미 최고층입니다. 막혀 있습니다.")
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", GetTriggerUnit(), "overhead"))
  else
    set udg_SYSTEM_MineFloor = udg_SYSTEM_MineFloor + 1
    set udg_temp_g = GroupEnumUnitsInRect2(CreateGroup(), gg_rct_Rect_168_Mine, Condition(function Condi_IsDmgTarget))
    if ( CountInGroup(udg_temp_g) != 0 ) then
      loop
        set udg_temp_u = FirstOfGroup(udg_temp_g)
        exitwhen udg_temp_u == null
        call GroupRemoveUnit(udg_temp_g, udg_temp_u)
        call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl", GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u)))
        
        call FlushChildHashtable(udg_hash, GetHandleId(udg_temp_u))
        call RemoveUnit(udg_temp_u)
      endloop
      
    endif
    call DestroyGroup(udg_temp_g)
    set bj_forLoopAIndex = 1
    loop
    exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
      if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1] ) then
        if ( RectContainsUnit(gg_rct_Rect_168_Mine, udg_Unit[bj_forLoopAIndex]) ) then
        call SetUnitPosition( udg_Unit[bj_forLoopAIndex], GetRandomReal(18016., 18272.), GetRandomReal(-16832., -16544.))
        set udg_OnesPositionN[bj_forLoopAIndex] = 50 + udg_SYSTEM_MineFloor
        call ClearTextMessagesBJ( GetForceOfPlayer(ConvertedPlayer(bj_forLoopAIndex)) )
        call MSG(Player(bj_forLoopAIndex-1), 5, 7, Hunting_Data(50+udg_SYSTEM_MineFloor) + " ("+I2S(udg_SYSTEM_MineFloor)+"층)")
        call SetCameraXY(Player(bj_forLoopAIndex-1), GetWidgetX(udg_Unit[bj_forLoopAIndex]), GetWidgetY(udg_Unit[bj_forLoopAIndex]))
        endif
      endif
      set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
  endif
endfunction

//===========================================================================
function InitTrig_Rect_Floor_Up takes nothing returns nothing
    set gg_trg_Rect_Floor_Up = CreateTrigger(  )
    call TriggerRegisterEnterRectSimple( gg_trg_Rect_Floor_Up, gg_rct_Rect_168_Mine_Up )
    call TriggerAddCondition( gg_trg_Rect_Floor_Up, Condition( function Trig_Rect_168_Mine_Exit_Conditions ) )
    call TriggerAddAction( gg_trg_Rect_Floor_Up, function Trig_Rect_Floor_Up_Actions )
endfunction

//===========================================================================
// Trigger: Rect Mine Exit
//===========================================================================
function Trig_Rect_Mine_Exit_Actions takes nothing returns nothing
    call SetUnitPosition(udg_Unit[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1], 28032, -27840)
endfunction

//===========================================================================
function InitTrig_Rect_Mine_Exit takes nothing returns nothing
    set gg_trg_Rect_Mine_Exit = CreateTrigger(  )
    call TriggerRegisterEnterRectSimple( gg_trg_Rect_Mine_Exit, gg_rct_Rect_168_Mine_Out )
    call TriggerAddCondition( gg_trg_Rect_Mine_Exit, Condition( function Trig_Rect_168_Mine_Exit_Conditions ) )
    call TriggerAddAction( gg_trg_Rect_Mine_Exit, function Trig_Rect_Mine_Exit_Actions )
endfunction

//===========================================================================
// Trigger: Skill SkillCheckA01D
//===========================================================================
function Trig_Skill_SkillCheckA01D_Actions takes nothing returns nothing
  call MSG(GetOwningPlayer(udg_temp_u), 1, 20., GetSkillNameStatAll(GetPlayerId(GetOwningPlayer(udg_temp_u))+1))
endfunction

//===========================================================================
function InitTrig_Skill_SkillCheckA01D takes nothing returns nothing
    set gg_trg_Skill_SkillCheckA01D = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Skill_SkillCheckA01D, function Trig_Skill_SkillCheckA01D_Actions )
endfunction

//===========================================================================
// Trigger: Skill SkillLearnA01E
//===========================================================================
function Trig_Skill_SkillLearnA01E_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(udg_temp_u))+1
  if ( RectContainsCoords(gg_rct_Etc_Rect_01, GetUnitX(udg_temp_u), GetUnitY(udg_temp_u)) ) then
    call SetUnitPositionLoc(udg_temp_u, LoadLocationHandle(udg_hash, P, StringHash("A01ELoc")))
  elseif ( udg_OnesPositionN[P] > 0 ) then
    call MSG(GetOwningPlayer(udg_temp_u), 2, 4, "|c00d962b5＊|cffffdc3c마을에서만 사용 가능합니다.")
  else
    call SaveLocationHandle(udg_hash, P, StringHash("A01ELoc"), GetUnitLoc(udg_temp_u))
    call SetUnitPosition(udg_temp_u, 25536., -26208.)
    call SetHoldCam(Player(P-1), gg_rct_Etc_Rect_01)
    call SetCameraXY(Player(P-1), GetWidgetX(udg_temp_u), GetWidgetY(udg_temp_u))
    call TriggerSleepAction(.1)
    call SetHoldCam(Player(P-1), gg_rct_Etc_Rect_01)
  endif
endfunction

//===========================================================================
function InitTrig_Skill_SkillLearnA01E takes nothing returns nothing
    set gg_trg_Skill_SkillLearnA01E = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Skill_SkillLearnA01E, function Trig_Skill_SkillLearnA01E_Actions )
endfunction

//===========================================================================
// Trigger: Skill StateAddALL
//===========================================================================
constant function Sk2Stt takes integer sk returns integer
  if ( sk == 'A00N' ) then
    return 1
  elseif ( sk == 'A00R' ) then
    return -1
  elseif ( sk == 'A00S' ) then
    return 2
  elseif ( sk == 'A00T' ) then
    return -2
  elseif ( sk == 'A00U' ) then
    return 3
  elseif ( sk == 'A017' ) then
    return -3
  elseif ( sk == 'A018' ) then
    return 4
  elseif ( sk == 'A019' ) then
    return -4
  elseif ( sk == 'A01A' ) then
    return 5
  elseif ( sk == 'A01B' ) then
    return -5
  else
    return 0
  endif
endfunction
function Trig_Skill_StateAddALL_Actions takes nothing returns nothing
debug call BJDebugMsg("AddAll_캐스팅 끝: " + GetUnitName(udg_temp_u)+"가 "+GetObjectName(udg_temp_ab)+"를 시전했음.")
  if ( Sk2Stt(udg_temp_ab) != 0 ) then
    if ( Sk2Stt(udg_temp_ab) < 0 ) then
      call StatePlus(GetPlayerId(GetOwningPlayer(udg_temp_u))+1, Sk2Stt(udg_temp_ab), IMinBJ(GetPlayerState(GetOwningPlayer(udg_temp_u), PLAYER_STATE_RESOURCE_LUMBER), 10))
    else
      call StatePlus(GetPlayerId(GetOwningPlayer(udg_temp_u))+1, Sk2Stt(udg_temp_ab), 1)
    endif
  endif
endfunction

//===========================================================================
function InitTrig_Skill_StateAddALL takes nothing returns nothing
    set gg_trg_Skill_StateAddALL = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Skill_StateAddALL, function Trig_Skill_StateAddALL_Actions )
endfunction

//===========================================================================
// Trigger: Skill Reset
//===========================================================================
function Trig_Skill_Reset_Actions takes nothing returns nothing
    local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
    if ( udg_SysB_Level[P] >= 99 ) then
      call MSG(GetOwningPlayer(GetTriggerUnit()), 1, 7, "레벨이 너무 높습니다.")
    else
      call IssueImmediateOrder(GetTriggerUnit(), "stop")
      call ResetStat(P, "스탯 초기화(스킬)")
    endif
endfunction

//===========================================================================
function InitTrig_Skill_Reset takes nothing returns nothing
    set gg_trg_Skill_Reset = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Skill_Reset, function Trig_Skill_Reset_Actions )
endfunction

//===========================================================================
// Trigger: Skill EatItemsA039
//===========================================================================
function ItemEat takes nothing returns nothing
  set udg_temp_i2 = udg_temp_i2 + 1
  if ( GetItemType(GetEnumItem()) != ITEM_TYPE_UNKNOWN ) and ( isNamed(GetItemCharges(GetEnumItem()),false) < udg_temp_i-1 ) then
    
    if ( GetItemCharges(GetEnumItem()) >= 0 ) then
      
      call SellItem(GetPlayerId(GetOwningPlayer(udg_temp_u))+1, GetEnumItem())
      
      //올빼미+텍스트 (대신 직접 판매'')
      /*call ED(AddSpecialEffect("Units\\NightElf\\Owl\\Owl.mdl", GetWidgetX(GetEnumItem()), GetWidgetY(GetEnumItem())), 1.5)
    
      set bj_lastCreatedTextTag = CreateTextTag()
      call SetTextTagText(bj_lastCreatedTextTag, "|cffDFFB4F" + GetItemNamed(GetEnumItem()), 0.015)
      call SetTextTagPos(bj_lastCreatedTextTag, GetWidgetX(GetEnumItem())-80., GetWidgetY(GetEnumItem()), GetTerrainZ(GetWidgetX(GetEnumItem()), GetWidgetY(GetEnumItem()))-50.)
      call SetTextTagColor(bj_lastCreatedTextTag, 255, 255, 255, 255)
      call Bufftt(bj_lastCreatedTextTag, 18)*/
    endif
  elseif ( GetItemLevel(GetEnumItem()) == 1 ) then
    call RemoveItem(GetEnumItem())
  else
    call UnitAddItem(udg_temp_u, GetEnumItem())
  endif
endfunction
function GetItemRect takes widget u, real size returns rect
  return Rect(GetWidgetX(u)-size*0.5, GetWidgetY(u)-size*0.5, GetWidgetX(u)+size*0.5, GetWidgetY(u)+size*0.5)
endfunction
function EatItem takes unit u returns nothing
  set udg_temp_rc = GetItemRect(u, 800.)
  set udg_temp_i2 = 0
  set udg_temp_u = u
  set udg_temp_i = LoadInteger(udg_hash, GetPlayerId(GetOwningPlayer(u))+1, StringHash("AutoItem"))
  call EnumItemsInRect(udg_temp_rc, null, function ItemEat)
  call RemoveRect(udg_temp_rc)
endfunction

function AutoItemA039 takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local integer P = LoadInteger(udg_hash, GetHandleId(t), StringHash("AutoItemI"))
 call EatItem(udg_Unit[P])
endfunction
function Trig_Skill_EatItems_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(udg_temp_u))+1
  call EatItem(udg_temp_u)
  if ( udg_temp_i2 > 0 ) then
    call Bufftt(CreateTextTagUnitBJ("냠냠.. x"+I2S(udg_temp_i2), udg_temp_u, 60., 9., 100., 0., 0., 0),1)
  endif
  
  set udg_temp_i2 = LoadInteger(udg_hash, P, StringHash("AutoItem")) +1
  if ( udg_temp_i2 == 4 ) then
    call MSG(GetOwningPlayer(udg_temp_u), 2, 4, "|c00d962b5＊|cffffdc3c자동습득이 해제되었습니다.")
    call SaveInteger(udg_hash, P, StringHash("AutoItem"), 0)
    set udg_SysB_Setting[P] = SubString(udg_SysB_Setting[P],0,2) + "0" + SubString(udg_SysB_Setting[P],1,StringLength(udg_SysB_Setting[P]))
    set bj_lastStartedTimer = LoadTimerHandle(udg_hash, P, StringHash("AutoItemT"))
    call FlushChildHashtable(udg_hash, GetHandleId(bj_lastStartedTimer))
    call DestroyTimer(bj_lastStartedTimer)
  else
    if ( udg_temp_i2 == 1 ) then
      set bj_lastStartedTimer = CreateTimer()
      call SaveTimerHandle(udg_hash, P, StringHash("AutoItemT"), bj_lastStartedTimer)
      call SaveInteger(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("AutoItemI"), P)
      call TimerStart(bj_lastStartedTimer, 5., true, function AutoItemA039)
    endif
    call SaveInteger(udg_hash, P, StringHash("AutoItem"), udg_temp_i2)
    call MSG(GetOwningPlayer(udg_temp_u), 2, 4, "|c00d962b5＊|cffffdc3c자동습득이 활성되었습니다. "+I2S(udg_temp_i2-1)+"강 이상 아이템을 수집합니다.")
    set udg_SysB_Setting[P] = SubString(udg_SysB_Setting[P],0,2) + "1" + SubString(udg_SysB_Setting[P],1,StringLength(udg_SysB_Setting[P]))
  endif
endfunction

//===========================================================================
function InitTrig_Skill_EatItemsA039 takes nothing returns nothing
  set gg_trg_Skill_EatItemsA039 = CreateTrigger()
  call TriggerAddAction( gg_trg_Skill_EatItemsA039, function Trig_Skill_EatItems_Actions )
endfunction

//===========================================================================
// Trigger: Skill AutoSaveA05J
//===========================================================================
function AutoSaveA05J takes nothing returns nothing
 local timer t = GetExpiredTimer()
 local integer P = LoadInteger(udg_hash, GetHandleId(t), StringHash("AutoSaveI"))
 local integer count = LoadInteger(udg_hash, GetHandleId(t), StringHash("AutoSave-C"))+1
  if ( P != 0 ) then
    if ( RectContainsUnit(FMi_Rect(0), udg_Unit[P]) ) then
      if ( Save(P, false) ) then
        call Save2(P)
        call FSE_MakeFile(Player(P-1),udg_SysB_Name[P]+"_last",false)
        call MSG(Player(P-1), 2, 4, "|c00d962b5＊|cffffdc3c자동저장 되었습니다.(last 파일)")
        call SaveInteger(udg_hash, GetHandleId(t), StringHash("AutoSave-C"), count)
        
        if ( ModuloInteger(count,4) == 0 ) or ( LoadBoolean(udg_hash, StringHash("EventBuff"), P) ) then
          set udg_temp_i2 = FAL_GetMulti0(P, 0, 0, 4)
          //슬롯 이름저장
          call FAL_SerSlotName(P, udg_temp_i2)
          if ( udg_temp_i2 > 0 ) then
            if ( GetLocalPlayer() == Player(P-1) ) then
                call MSG(Player(P-1), 2, 4, "|c00d962b5＊|cffffdc3c자동저장 되었습니다(서버)|r: " + JNSetLog(JN_MAPID, udg_SysB_Name[P], JN_SECRETKEY, I2S(udg_temp_i2), JNServerTime("MMdd_HHmm")+"_"+I2S(udg_MT_TimerHou*60+udg_MT_TimerMin)+"m", FAL_Text(P,udg_temp_i2)+"|"+FSE_ColorX(udg_Save_Code[P])+"|"+FSE_ColorX(udg_Save_Code2[P])))
            endif
            call JN_ServerSave(Player(P-1), udg_temp_i2)
          endif
        endif
      endif
    else
      call MSG(Player(P-1), 2, 4, "|c00d962b5＊|cffffdc3c자동저장이 스킵되었습니다.(여관 등)")
    endif
  endif
  set t = null
endfunction

function Trig_Skill_AutoSaveA05J_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(udg_temp_u))+1
  if ( LoadBoolean(udg_hash, P, StringHash("AutoSave")) ) then
    call MSG(GetOwningPlayer(udg_temp_u), 2, 4, "|c00d962b5＊|cffffdc3c자동저장이 해제되었습니다.")
    call SaveBoolean(udg_hash, P, StringHash("AutoSave"), false)
    set udg_SysB_Setting[P] = SubString(udg_SysB_Setting[P],0,1) + "0" + SubString(udg_SysB_Setting[P],1,StringLength(udg_SysB_Setting[P]))
    set bj_lastStartedTimer = LoadTimerHandle(udg_hash, P, StringHash("AutoSaveT"))
    call FlushChildHashtable(udg_hash, GetHandleId(bj_lastStartedTimer))
    call DestroyTimer(bj_lastStartedTimer)
  else
    call MSG(GetOwningPlayer(udg_temp_u), 2, 4, "|c00d962b5＊|cffffdc3c자동저장이 활성되었습니다.")
    call SaveBoolean(udg_hash, P, StringHash("AutoSave"), true)
    set udg_SysB_Setting[P] = SubString(udg_SysB_Setting[P],0,1) + "1" + SubString(udg_SysB_Setting[P],1,StringLength(udg_SysB_Setting[P]))
    
    set bj_lastStartedTimer = CreateTimer()
    call SaveTimerHandle(udg_hash, P, StringHash("AutoSaveT"), bj_lastStartedTimer)
    call SaveInteger(udg_hash, GetHandleId(bj_lastStartedTimer), StringHash("AutoSaveI"), P)
    call TimerStart(bj_lastStartedTimer, 300., true, function AutoSaveA05J)
    if ( udg_Quest_00_Note[P] == 34 ) then
      set udg_Quest_00_Note[P] = 35
      call MSG(Player(P-1), 1, 3., "초보자 퀘스트 - 클릭하여 계속 진행하세요.")
    endif
  endif
endfunction

//===========================================================================
function InitTrig_Skill_AutoSaveA05J takes nothing returns nothing
    set gg_trg_Skill_AutoSaveA05J = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Skill_AutoSaveA05J, function Trig_Skill_AutoSaveA05J_Actions )
endfunction

//===========================================================================
// Trigger: Skill FooiffBuffA05L
//===========================================================================
function Trig_Skill_FooiffBuffA05L_Actions takes nothing returns nothing
  call UnitAddItem(udg_temp_u, CreateItem('guvi',0.,0.))
endfunction

//===========================================================================
function InitTrig_Skill_FooiffBuffA05L takes nothing returns nothing
    set gg_trg_Skill_FooiffBuffA05L = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Skill_FooiffBuffA05L, function Trig_Skill_FooiffBuffA05L_Actions )
endfunction

//===========================================================================
// Trigger: Skill ComadiumI08V
//===========================================================================
function Cond_NearComa1 takes nothing returns boolean
 return ( GetFilterUnit() == udg_Unit[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] ) and ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] == udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1] ) and ( GetUnitAbilityLevel(GetFilterUnit(), 'B00M')+GetUnitAbilityLevel(GetFilterUnit(), 'B00B') >= 1 )
endfunction
function Cond_NearComa2 takes nothing returns boolean
 return ( GetFilterUnit() == udg_Unit[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] ) and ( udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetFilterUnit()))+1] == udg_PartyNumber_ThisP[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1] ) and ( GetUnitAbilityLevel(GetFilterUnit(), 'B00M') >= 1 )
endfunction

function Trig_Skill_ComadiumI08V_Actions takes nothing returns nothing
  if ( GetUnitLevel(GetTriggerUnit()) <= 98 ) then
    if ( GetUnitLevel(GetTriggerUnit()) <= 40 ) then
      call SetWidgetLife(GetTriggerUnit(), GetWidgetLife(GetTriggerUnit())+GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE)*.3)
      call SetUnitState(GetTriggerUnit(), UNIT_STATE_MANA, GetUnitState(GetTriggerUnit(), UNIT_STATE_MANA)+GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_MANA)*.15)
    elseif ( GetUnitLevel(GetTriggerUnit()) <= 70 ) then
      call SetWidgetLife(GetTriggerUnit(), GetWidgetLife(GetTriggerUnit())+GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE)*.2)
      call SetUnitState(GetTriggerUnit(), UNIT_STATE_MANA, GetUnitState(GetTriggerUnit(), UNIT_STATE_MANA)+GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_MANA)*.1)
    else
      call SetWidgetLife(GetTriggerUnit(), GetWidgetLife(GetTriggerUnit())+GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE)*.1)
      call SetUnitState(GetTriggerUnit(), UNIT_STATE_MANA, GetUnitState(GetTriggerUnit(), UNIT_STATE_MANA)+GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_MANA)*.05)
    endif
    call SetItemCharges(GetManipulatedItem(), GetItemCharges(GetManipulatedItem())+1)

    set udg_temp_g = AI_Group(CreateGroup(), GetTriggerUnit(), -750., Condition(function Cond_NearComa1))
    if ( CountInGroup(udg_temp_g) != 0 ) then
      loop
        set udg_temp_u = FirstOfGroup(udg_temp_g)
        exitwhen udg_temp_u == null
        call GroupRemoveUnit(udg_temp_g, udg_temp_u)

        if ( UnitRemoveAbility(udg_temp_u, 'B00M') ) then
          call MSG(GetOwningPlayer(GetTriggerUnit()), 1, 5, "코마 상태를 회복시켰습니다.")
          if ( udg_Quest_00_Note[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1] == 32 ) then
            set udg_Quest_00_Note[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1] = 33
            call MSG(GetOwningPlayer(GetTriggerUnit()), 1, 3., "초보자 퀘스트 - 클릭하여 계속 진행하세요.")
          endif
        elseif ( UnitRemoveAbility(udg_temp_u, 'B00B') ) then
          call MSG(GetOwningPlayer(GetTriggerUnit()), 1, 5, "코마 상태를 회복시켰습니다.")
        endif
      endloop
      call DestroyGroup(udg_temp_g)
    endif
  else
    if ( MinusItem(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1, 'I08V', 1) ) then
      set udg_temp_g = AI_Group(CreateGroup(), GetTriggerUnit(), -750., Condition(function Cond_NearComa2))
      if ( CountInGroup(udg_temp_g) != 0 ) then
        loop
          set udg_temp_u = FirstOfGroup(udg_temp_g)
          exitwhen udg_temp_u == null
          call GroupRemoveUnit(udg_temp_g, udg_temp_u)
          
          if ( UnitRemoveAbility(udg_temp_u, 'B00M') ) then
            call MSG(GetOwningPlayer(GetTriggerUnit()), 1, 5, "코마 상태를 회복시켰습니다.")
          endif
        endloop
        call DestroyGroup(udg_temp_g)
      else
        call MSG(GetOwningPlayer(udg_temp_u), 1, 5, "체력 회복은 98이하 초보자만 가능합니다.")
      endif
    else
      call MSG(GetOwningPlayer(udg_temp_u), 1, 5, "코마가 부족합니다.")
    endif
  endif
endfunction

//===========================================================================
function InitTrig_Skill_ComadiumI08V takes nothing returns nothing
    set gg_trg_Skill_ComadiumI08V = CreateTrigger(  )
    call TriggerAddAction(gg_trg_Skill_ComadiumI08V, function Trig_Skill_ComadiumI08V_Actions)
endfunction

//===========================================================================
// Trigger: Moving Harmonious 1
//===========================================================================
function Trig_Moving_Harmonious_1_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
  if ( P != udg_PartyNumber_ThisP[P] ) then
    call MSG(GetOwningPlayer(GetTriggerUnit()), 1, 3, "파티장만 갈 수 있습니다. 이곳에서 대기해주세요.")
    call SetUnitX(GetTriggerUnit(), GetWidgetX(GetTriggerUnit())-256.)
    call SetUnitY(GetTriggerUnit(), GetWidgetY(GetTriggerUnit())-256.)
    call IssueImmediateOrder(GetTriggerUnit(), "stop")
  else
    call IssueImmediateOrder(GetTriggerUnit(), "stop")
    call PauseUnit(GetTriggerUnit(), true)
    call MSGAll(P, false, 1, 1, 6, "|cffffdc3c※참고. 4서클의 파티원만 입장할 수 있으며,
　　파티원 레벨 총합이 150이상이어야 합니다.
　　　　조화의 문장 보유 혹은 파티에 모든 직업이 필요합니다.")
    call TriggerSleepAction(1.)
    if ( LoadBoolean(udg_hash,P,300) ) then
      call MSGAll(P, false, 1, 1, 6, "이 파티에는 |c0000ff00모든 직업이 |cffffdc3c존재합니다. 필요 조건을 무시하고 입장하실 수 있습니다.")
      call TriggerSleepAction(2.)
      call MSGAll(P, false, 1, 1, 8, "|cffffdc3c모든 직업이 있는 파티입니다. 문장이 없어도 들어갈 수 있습니다.")
      call TriggerSleepAction(1.)
      call PauseUnit(GetTriggerUnit(), false)
      call MSG(GetOwningPlayer(GetTriggerUnit()), 1, 3., "앞으로 더 가면 입장할 수 있습니다.")
    else
      call MSGAll(P, false, 1, 1, 6, "이 파티에는 |c00ffffff모든 직업이 있지 않습니다.|cffffdc3c 레벨 합계 150과 조화의문장이 필요합니다.")
      call TriggerSleepAction(2.)
      set bj_forLoopAIndex = 1
      set bj_forLoopBIndex = 0
      loop
        exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == P ) then
          if ( udg_SysB_Level[bj_forLoopAIndex] >= 71 and udg_SysB_Level[bj_forLoopAIndex] <= 98 ) then
            if ( UnitAlive(udg_Unit[bj_forLoopAIndex]) ) then
              if ( CountItem(bj_forLoopAIndex, 'sehr') >= 0 ) then
                set bj_forLoopBIndex = bj_forLoopBIndex+udg_SysB_Level[bj_forLoopAIndex]
              else
                if ( bj_forLoopAIndex == P ) then
                  call MSGAll(bj_forLoopAIndex, false, 1, 2, 12, "|cff0080ff파티장 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80문장 없음 |cff0080ff]")
                else
                  call MSGAll(bj_forLoopAIndex, false, 1, 2, 11, "|cff00ffff파티원 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80문장 없음 |cff00ffff]")
                endif
              endif
            else
              if ( bj_forLoopAIndex == P ) then
                call MSGAll(bj_forLoopAIndex, false, 1, 2, 12, "|cff0080ff파티장 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80영웅 사망함 |cff0080ff]")
              else
                call MSGAll(bj_forLoopAIndex, false, 1, 2, 11, "|cff00ffff파티원 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80영웅 사망함 |cff00ffff]")
              endif
            endif
          else
            if ( bj_forLoopAIndex == P ) then
              call MSGAll(bj_forLoopAIndex, false, 1, 2, 12, "|cff0080ff파티장 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80레벨 부적절 |cff0080ff]")
            else
              call MSGAll(bj_forLoopAIndex, false, 1, 2, 11, "|cff00ffff파티원 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80레벨 부적절 |cff00ffff]")
            endif
          endif
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
      if ( bj_forLoopBIndex >= 150 ) then
        call MSGAll(P, false, 1, 1, 8., "파티원 총 레벨은 |c0000ff00" + I2S(bj_forLoopBIndex) + "|cffffdc3c입니다. 들어갈 수 있습니다.")
        call TriggerSleepAction(1.)
        call PauseUnit(GetTriggerUnit(), false)
        call MSG(GetOwningPlayer(GetTriggerUnit()), 1, 3., "앞으로 더 가면 입장할 수 있습니다.")
      else
        call MSGAll(P, false, 1, 1, 8., "조건이 맞는 파티원의 총 레벨은 |cffff0000" + I2S(bj_forLoopBIndex) + "|cffffdc3c입니다. 들어갈 수 없습니다!")
        call PauseUnit(GetTriggerUnit(), false)
      endif
      if ( udg_Quest_00_Note[P] == 64 ) then
        set udg_Quest_00_Note[P] = 65
        call MSG(Player(P-1), 1, 3., "초보자 퀘스트 - 클릭하여 계속 진행하세요.")
      endif
    endif
  endif
 set P = 0
endfunction

//===========================================================================
function InitTrig_Moving_Harmonious_1 takes nothing returns nothing
  set gg_trg_Moving_Harmonious_1 = CreateTrigger(  )
  call TriggerRegisterEnterRectSimple( gg_trg_Moving_Harmonious_1, gg_rct_Moving_Harmony_Before )
  call TriggerAddCondition( gg_trg_Moving_Harmonious_1, Condition( function Trig_Quest_05_D3_Conditions ) )
  call TriggerAddAction( gg_trg_Moving_Harmonious_1, function Trig_Moving_Harmonious_1_Actions )
endfunction

//===========================================================================
// Trigger: Moving Harmonious 2
//===========================================================================
function Trig_Moving_Harmonious_2_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
  if ( LoadBoolean(udg_hash,P,300) ) then
    
    /* 98이하 체크 */
    set bj_forLoopAIndex = 1
    loop
      exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
      if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == P ) then
        if ( udg_SysB_Level[bj_forLoopAIndex] >= 71 and udg_SysB_Level[bj_forLoopAIndex] <= 98 ) and ( GetWidgetLife(udg_Unit[bj_forLoopAIndex]) > 0.4 ) then
          set bj_forLoopAIndex = 50
        endif
      endif
      set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    
    if ( bj_forLoopAIndex == 50 )then
      set bj_forLoopAIndex = 1
      loop
        exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == P ) then
          if ( udg_SysB_Level[bj_forLoopAIndex] >= 71 and udg_SysB_Level[bj_forLoopAIndex] <= 98 ) and ( GetWidgetLife(udg_Unit[bj_forLoopAIndex]) > 0.4 ) then
            call IssueImmediateOrder(udg_Unit[bj_forLoopAIndex], "stop")
            call SetUnitPosition(udg_Unit[bj_forLoopAIndex], GetRandomReal(-7456., -6304.), GetRandomReal(-3840., -4128.))
          endif
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
    else
      call MSGAll(P, false, 1, 1, 8., "4서클 유저가 최소 1명 필요합니다. 들어갈 수 없습니다.")
    endif
  else
    set bj_forLoopAIndex = 1
    set bj_forLoopBIndex = 0
    loop
      exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
      if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == P ) then
        if ( udg_SysB_Level[bj_forLoopAIndex] >= 71 and udg_SysB_Level[bj_forLoopAIndex] <= 98 ) then
          if ( UnitAlive(udg_Unit[bj_forLoopAIndex]) ) then
            if ( CountItem(bj_forLoopAIndex, 'sehr') >= 0 ) then
              set bj_forLoopBIndex = bj_forLoopBIndex+udg_SysB_Level[bj_forLoopAIndex]
            else
              if ( bj_forLoopAIndex == P ) then
                call MSGAll(bj_forLoopAIndex, false, 1, 2, 12, "|cff0080ff파티장 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80문장 없음 |cff0080ff]")
              else
                call MSGAll(bj_forLoopAIndex, false, 1, 2, 11, "|cff00ffff파티원 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80문장 없음 |cff00ffff]")
              endif
            endif
          else
            if ( bj_forLoopAIndex == P ) then
              call MSGAll(bj_forLoopAIndex, false, 1, 2, 12, "|cff0080ff파티장 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80영웅 사망함 |cff0080ff]")
            else
              call MSGAll(bj_forLoopAIndex, false, 1, 2, 11, "|cff00ffff파티원 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80영웅 사망함 |cff00ffff]")
            endif
          endif
        else
          if ( bj_forLoopAIndex == P ) then
            call MSGAll(bj_forLoopAIndex, false, 1, 2, 12, "|cff0080ff파티장 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80레벨 부적절 |cff0080ff]")
          else
            call MSGAll(bj_forLoopAIndex, false, 1, 2, 11, "|cff00ffff파티원 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80레벨 부적절 |cff00ffff]")
          endif
        endif
      endif
      set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    if ( bj_forLoopBIndex >= 150 ) then
      set bj_forLoopAIndex = 1
      loop
        exitwhen bj_forLoopAIndex > bj_MAX_PLAYERS
        if ( udg_PartyNumber_ThisP[bj_forLoopAIndex] == P ) then
          if ( udg_SysB_Level[bj_forLoopAIndex] >= 71 and udg_SysB_Level[bj_forLoopAIndex] <= 98 ) and ( GetWidgetLife(udg_Unit[bj_forLoopAIndex]) > 0.4 ) then
            if ( MinusItem(bj_forLoopAIndex, 'sehr', 0) ) then
              call IssueImmediateOrder(udg_Unit[bj_forLoopAIndex], "stop")
              call SetUnitPosition(udg_Unit[bj_forLoopAIndex], GetRandomReal(-7456., -6304.), GetRandomReal(-3840., -4128.))
            else
              if ( bj_forLoopAIndex == P ) then
                call MSGAll(bj_forLoopAIndex, false, 1, 2, 12, "|cff0080ff파티장 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80문장 없음 |cff0080ff]")
              else
                call MSGAll(bj_forLoopAIndex, false, 1, 2, 11, "|cff00ffff파티원 : "+GetLongName(bj_forLoopAIndex)+"[ |cffff0000입장 불가 |cffffff80문장 없음 |cff00ffff]")
              endif
            endif
          endif
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
      endloop
    else
      call MSGAll(P, false, 1, 1, 8., "조건이 맞는 파티원의 총 레벨은 |cffff0000" + I2S(bj_forLoopBIndex) + "|cffffdc3c입니다. 들어갈 수 없습니다!")
    endif
  endif
 set P = 0
endfunction

//===========================================================================
function InitTrig_Moving_Harmonious_2 takes nothing returns nothing
  set gg_trg_Moving_Harmonious_2 = CreateTrigger(  )
  call TriggerRegisterEnterRectSimple( gg_trg_Moving_Harmonious_2, gg_rct_Moving_Harmony )
  call TriggerAddCondition( gg_trg_Moving_Harmonious_2, Condition( function Trig_Quest_05_D3_Conditions ) )
  call TriggerAddAction( gg_trg_Moving_Harmonious_2, function Trig_Moving_Harmonious_2_Actions )
endfunction

//===========================================================================
// Trigger: UTextSet
//===========================================================================
//[출처] 지역 표시용 유동 텍스트 (워크래프트3 리포지드 유즈맵 포럼 [W3UMF]) | 작성자 소찌
globals
  constant integer QUEST_COUNT = 16
  constant real UTEXT_LOOP = 30.
endglobals
function CreateUText takes real x, real y, real z, real size, string str returns nothing
  local texttag tt = CreateTextTag()
  call SetTextTagPos(tt, x-96, y, z)
  call SetTextTagText(tt, str, 0.023*size)
  call SetTextTagPermanent(tt, false)
  call SetTextTagLifespan(tt, UTEXT_LOOP)
  set tt = null
endfunction
constant function UT_I2U takes integer i returns unit
  if ( i == 1 ) then
    return gg_unit_H002_0322
  elseif ( i == 2 ) then
    return gg_unit_H003_0323
  elseif ( i == 3 ) then
    return gg_unit_H004_0324
  elseif ( i == 4 ) then
    return gg_unit_H005_0325
  elseif ( i == 5 ) then
    return gg_unit_H006_0326
  elseif ( i == 6 ) then
    return gg_unit_H017_0002
  elseif ( i == 7 ) then
    return gg_unit_e00A_0041
  elseif ( i == 8 ) then
    return gg_unit_H019_0113
  elseif ( i == 9 ) then
    return gg_unit_H01A_0107
  elseif ( i == 10 ) then
    return gg_unit_H01D_0110
  elseif ( i == 11 ) then
    return gg_unit_H01C_0109
  elseif ( i == 12 ) then
    return gg_unit_H01B_0111
  endif
  return null
endfunction
constant function UT_I2Ut takes integer i returns string
  if ( i == 1 ) then
    return "전사의 신,
|c00ffff00세토아|r"
  elseif ( i == 2 ) then
    return "도적의 신,
|c00ffff00셔스|r"
  elseif ( i == 3 ) then
    return "마법사의 신,
|c00ffff00로오|r"
  elseif ( i == 4 ) then
    return "성직자의 신,
|c00ffff00이아|r"
  elseif ( i == 5 ) then
    return "무도가의 신,
|c00ffff00메투스|r"
  elseif ( i == 6 ) then
    return "|c00ffff00랜덤 선택
|cff0080ff빅데이터|cff55ff55와|cff0080ff 당신의 취향|cff55ff55을 반영하여
가장 잘 맞는 캐릭터 맞춤선택"
  elseif ( i == 7 ) then
    return "이어하기"
  elseif ( i == 8 ) then
    return "|c00ffff00전사
|cffed89d9힘,지구력(STR,CON)
|cff55ff55탱킹 및 어그로관리"
  elseif ( i == 9 ) then
    return "|c00ffff00도적
|cffed89d9힘,민첩성(STR,DEX)
|cff55ff55더블 크리티컬(중첩)"
  elseif ( i == 10 ) then
    return "|c00ffff00무도가
|cffed89d9힘,지구력(STR,CON)
|cff55ff55만능 혹은 잡..(콤보시스템)"
  elseif ( i == 11 ) then
    return "|c00ffff00마법사
|cffed89d9지식,지혜(INT,WIS)
|cff55ff55슈퍼캐스팅(마법크리, 체력소모)"
  elseif ( i == 12 ) then
    return "|c00ffff00성직자
|cffed89d9지식,지혜(INT,WIS)
|cff55ff55추가경험치 7%, 추가회복(자기체력비례)"
  endif
  return ""
endfunction

function UT_CreateText takes nothing returns nothing
  call CreateUText(GetWidgetX(GetEnumUnit()), GetWidgetY(GetEnumUnit()), 0., 1., I2S(R2I(GetUnitState(GetEnumUnit(), UNIT_STATE_MAX_MANA)))+"서클 기술/마법")
endfunction
function UT_Unit_Teacher takes nothing returns boolean
  return ( GetUnitName(GetFilterUnit()) == "기술 교관" )
endfunction
function UT_Unit_temp_i takes nothing returns boolean
  return ( GetUnitTypeId(GetFilterUnit()) == udg_temp_i )
endfunction
function CreateAll takes nothing returns nothing
  local integer i = 1
  loop
    call CreateUText(GetWidgetX(I2QU(i)), GetWidgetY(I2QU(i)), 50., 1., "|cff0080ff" + FCut(QuestName(i),1) + "|cffc3dbff(|cffffff00Lv."+FCut(QuestName(i),3)+"~"+FCut(QuestName(i),4)+"|cffc3dbff)")
    exitwhen i >= QUEST_COUNT
    set i = i + 1
  endloop
  
  set i = 1  
  loop
    if ( Hunting_Data(-i) != "위치확인 불가" ) then
      call CreateUText(GetRectCenterX(Vileage_Rect(i)), GetRectCenterY(Vileage_Rect(i)), 0., 2., Hunting_Data(-i))
    endif
    exitwhen i >= Map_Data(2)
    set i = i + 1
  endloop
  
  set i = 1
  loop
    call CreateUText(GetWidgetX(UT_I2U(i)), GetWidgetY(UT_I2U(i)), 0., 1., UT_I2Ut(i))
    exitwhen i >= 5
    set i = i + 1
  endloop
  call CreateUText(GetRectCenterX(Moving_Rect(0)), GetRectCenterY(Moving_Rect(0)), 0., 1.2, "Exit")
  call CreateUText(GetRectCenterX(Moving_Rect(8)), GetRectCenterY(Moving_Rect(8)), 0., 1.2, "Exit to WoodLand")
  call CreateUText(GetRectCenterX(gg_rct_Effect_07), GetRectCenterY(gg_rct_Effect_07), 0., 1.2, "밀레스 신전")
  call CreateUText(GetRectCenterX(Moving_Rect(1)), GetRectCenterY(Moving_Rect(1)), 0., 1.2, "지하묘지")
  call CreateUText(GetRectCenterX(Moving_Rect(16)), GetRectCenterY(Moving_Rect(16)), 0., 1.2, "Exit")
  call CreateUText(GetRectCenterX(Moving_Rect(10)), GetRectCenterY(Moving_Rect(10)), 0., 1.2, "Exit")
  call CreateUText(GetRectCenterX(Moving_Rect(9)), GetRectCenterY(Moving_Rect(9)), 0., 1.2, "Enter to WoodLand")
  call CreateUText(GetRectCenterX(Moving_Rect(19)), GetRectCenterY(Moving_Rect(19)), 0., 1.2, "Exit")
  call CreateUText(27680., -27744., 0., 1., "출석체크")
  
  set udg_temp_g = GetGroupPlayer(udg_temp_g, Player(PLAYER_NEUTRAL_PASSIVE), Condition(function UT_Unit_Teacher))
  call ForGroup(udg_temp_g, function UT_CreateText)
  call DestroyGroup(udg_temp_g)
endfunction
function Rotate takes nothing returns nothing
  call CreateAll()
endfunction
function Matrix_20 takes nothing returns nothing
  call SetUnitTimeScale(GetEnumUnit(), .2)
endfunction
function Trig_UTextSet_Actions takes nothing returns nothing
 local integer loopA
  call CreateAll()
  call TimerStart(CreateTimer(), UTEXT_LOOP, true, function Rotate)
  call DestroyTrigger(GetTriggeringTrigger())
  
  //침대 20%
  set udg_temp_i = 'n02W'
  set udg_temp_g = GetGroupPlayer(udg_temp_g, Player(PLAYER_NEUTRAL_PASSIVE), Condition(function UT_Unit_temp_i))
  call ForGroup(udg_temp_g, function Matrix_20)
  call DestroyGroup(udg_temp_g)
  
  //마을남자, 0%
  call SetUnitTimeScale(I2QU(2), 0.)
  
  //직업 신들
  set loopA = 1
  loop
    call SetUnitTimeScale(UT_I2U(loopA), 2.5)
    call TriggerRegisterUnitEvent(gg_trg_Quest_Attack, UT_I2U(loopA), EVENT_UNIT_ISSUED_TARGET_ORDER)
    call TriggerRegisterUnitEvent(gg_trg_Sys_ChangJob_A_ALL, UT_I2U(loopA), EVENT_UNIT_ATTACKED)
    exitwhen loopA >= 5
    set loopA = loopA + 1
  endloop

  call CreateUText(GetWidgetX(UT_I2U(6)), GetWidgetY(UT_I2U(6)), 250., 1., UT_I2Ut(6))
  set loopA = 7
  loop
    call CreateUText(GetWidgetX(UT_I2U(loopA)), GetWidgetY(UT_I2U(loopA)), 0., 1., UT_I2Ut(loopA))
    exitwhen loopA >= 12
    set loopA = loopA + 1
  endloop
endfunction

//===========================================================================
function InitTrig_UTextSet takes nothing returns nothing
    set gg_trg_UTextSet = CreateTrigger(  )
    call TriggerAddAction( gg_trg_UTextSet, function Trig_UTextSet_Actions )
endfunction

//===========================================================================
// Trigger: Set Test
//===========================================================================
function Trig_Set_Test_Actions takes nothing returns nothing
    // 테스트 set
    debug if ( GetPlayerName(Player(0)) == "fooIff" ) then
    debug set udg_SysK_TEST = true
    debug else
    debug call CustomDefeatBJ( GetLocalPlayer(), "설정 에러!" )
    debug call PauseGame(true)
    debug endif
endfunction

//===========================================================================
function InitTrig_Set_Test takes nothing returns nothing
    set gg_trg_Set_Test = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Set_Test, function Trig_Set_Test_Actions )
endfunction

//===========================================================================
// Trigger: Intr cheat 2
//===========================================================================
function Trig_Intr_cheat_2_Actions takes nothing returns nothing
 local integer i = 1
 local integer P = GetPlayerId(GetTriggerPlayer())+1
   if ( udg_SysK_TEST ) then
    debug loop
      debug call MSG(Player(P-1), 1, 7., "Skill Lv up:" + GetObjectName(LoadInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(i)))))
      debug call SetUnitAbilityLevel(udg_Unit[P], LoadInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(i))), 10)
      debug exitwhen i >= 7
      debug set i = i + 1
    debug endloop
endif
endfunction

//===========================================================================
function InitTrig_Intr_cheat_2 takes nothing returns nothing
    set gg_trg_Intr_cheat_2 = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Intr_cheat_2, "-푸잎", true )
    call TriggerAddAction( gg_trg_Intr_cheat_2, function Trig_Intr_cheat_2_Actions )
endfunction

//===========================================================================
// Trigger: Intr Cheat
//===========================================================================
function Trig_Intr_Cheat_Actions takes nothing returns nothing
 local integer P = GetPlayerId(GetTriggerPlayer())+1
 local integer i = 1
   if ( udg_SysK_TEST ) then
 call MSG(Player(P-1), 1, 7., "치트: 골드, 목재, 엑쿠, 스킬숙련도, 렙업책")
    //call AdjustPlayerStateBJ(-100000, GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD)
 debug    call SetItemCharges(CreateItem('I084', GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P])), GetRandomInt(1,100))
    debug call SetItemCharges(CreateItem('I06F', GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P])), 46)
    debug call SetItemCharges(CreateItem('I034', GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P])), 0)
    debug loop
      debug exitwhen i >= 15
      debug call CreateItem('rre2', GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]))
      debug set i = i + 1
    debug endloop
    debug set i = 1
    debug loop
      debug set i = i + 1
      debug call MSG(Player(P-1), 1, 7., "Skill Lv up:" + GetObjectName(LoadInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(i)))))
      debug call SetUnitAbilityLevel(udg_Unit[P], LoadInteger(udg_hash, StringHash("Player"+I2S(P)), StringHash("Skill_"+I2S(i))), 10)
      debug exitwhen i >= 7
    debug endloop
endif
endfunction

//===========================================================================
function InitTrig_Intr_Cheat takes nothing returns nothing
    set gg_trg_Intr_Cheat = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Intr_Cheat, "-푸잎푸잎", true )
    call TriggerAddAction( gg_trg_Intr_Cheat, function Trig_Intr_Cheat_Actions )
endfunction

//===========================================================================
// Trigger: Intr Gotcha
//===========================================================================
function Trig_Intr_Gacha_Actions takes nothing returns nothing
 local integer lv = GetRandomInt(1,99)
 local integer i = DropOX(lv, 0)
 local integer P = GetPlayerId(GetTriggerPlayer())+1
 if ( udg_SysK_TEST ) then
  debug set bj_lastCreatedItem = CreateItem(DropPool(DropOX(lv,i), GetRandomInt(1,DropPool(DropOX(lv,i),0))), GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]))
  debug call SetItemCharges(bj_lastCreatedItem, (GetRandomInt(0,SysInt(0,29))*5)+1)
  debug set bj_lastCreatedItem = CreateItem(DropPool(DropOX(lv,i), GetRandomInt(1,DropPool(DropOX(lv,i),0))), GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]))
  debug call SetItemCharges(bj_lastCreatedItem, (GetRandomInt(0,SysInt(0,29))*5)+2)
  debug set bj_lastCreatedItem = CreateItem(DropPool(DropOX(lv,i), GetRandomInt(1,DropPool(DropOX(lv,i),0))), GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]))
  debug call SetItemCharges(bj_lastCreatedItem, (GetRandomInt(0,SysInt(0,29))*5)+3)
  debug set bj_lastCreatedItem = CreateItem(DropPool(DropOX(lv,i), GetRandomInt(1,DropPool(DropOX(lv,i),0))), GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]))
  debug call SetItemCharges(bj_lastCreatedItem, (GetRandomInt(0,SysInt(0,29))*5)+4)
  debug set bj_lastCreatedItem = CreateItem(DropPool(DropOX(lv,i), GetRandomInt(1,DropPool(DropOX(lv,i),0))), GetWidgetX(udg_Unit[P]), GetWidgetY(udg_Unit[P]))
  debug call SetItemCharges(bj_lastCreatedItem, (GetRandomInt(0,SysInt(0,29))*5)+5)
  endif
endfunction

//===========================================================================
function InitTrig_Intr_Gotcha takes nothing returns nothing
    set gg_trg_Intr_Gotcha = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Intr_Gotcha, "-가챠", true )
    call TriggerAddAction( gg_trg_Intr_Gotcha, function Trig_Intr_Gacha_Actions )
endfunction

//===========================================================================
// Trigger: Intr nick
//===========================================================================
function Trig_Intr_nick_Actions takes nothing returns nothing
if ( udg_SysK_TEST ) then
debug   set udg_SysB_Name[GetPlayerId(GetTriggerPlayer())+1] = SubString(GetEventPlayerChatString(),5,99)
  debug call BJDebugMsg("Nick Change: " + GetPlayerName(GetTriggerPlayer()) + " → " + udg_SysB_Name[GetPlayerId(GetTriggerPlayer())+1])
  debug call SetPlayerName(GetTriggerPlayer(), udg_SysB_Name[GetPlayerId(GetTriggerPlayer())+1])
endif
endfunction

//===========================================================================
function InitTrig_Intr_nick takes nothing returns nothing
    set gg_trg_Intr_nick = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Intr_nick, "-닉 ", false )
    call TriggerAddAction( gg_trg_Intr_nick, function Trig_Intr_nick_Actions )
endfunction

//===========================================================================
// Trigger: Intr Newbie Quest
//===========================================================================
function Trig_Intr_Newbie_Quest_Actions takes nothing returns nothing
local integer P = GetPlayerId(GetTriggerPlayer())+1
if ( LoadBoolean(udg_hash, StringHash("ReNQuest"), P) ) then
  call MSG(GetTriggerPlayer(), 1, 7, "이미 한번 실행했습니다.")
else
  call SaveBoolean(udg_hash, StringHash("ReNQuest"), P, true)
  set udg_Quest_00_Note[P] = 0
  call MinusItem(P, 'I09V', -1)
  call MSG(Player(P-1), 1, 7., "초보자 퀘스트가 다음 단계로 넘어갑니다. (다시 클릭, 1회만 가능)")
endif
endfunction

//===========================================================================
function InitTrig_Intr_Newbie_Quest takes nothing returns nothing
    set gg_trg_Intr_Newbie_Quest = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Intr_Newbie_Quest, "-초보자퀘스트", true )
    call TriggerAddAction( gg_trg_Intr_Newbie_Quest, function Trig_Intr_Newbie_Quest_Actions )
endfunction

//===========================================================================
// Trigger: Type 2 Title
//===========================================================================
function Trig_Type_2_Title_Actions takes nothing returns nothing
debug set udg_SysB_Title[GetPlayerId(GetTriggerPlayer())+1] = SubString(GetEventPlayerChatString(), 6, 99)
debug call BJDebugMsg("Set Title: " + udg_SysB_Title[GetPlayerId(GetTriggerPlayer())+1])
endfunction

//===========================================================================
function InitTrig_Type_2_Title takes nothing returns nothing
    set gg_trg_Type_2_Title = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Type_2_Title, "-값2 ", false)
    call TriggerAddAction( gg_trg_Type_2_Title, function Trig_Type_2_Title_Actions )
endfunction

//===========================================================================
// Trigger: Type 3 value
//===========================================================================
function Trig_Type_3_value_Actions takes nothing returns nothing
debug set udg_SysA_AddValue = S2R(SubString(GetEventPlayerChatString(), 6, 99))
debug call BJDebugMsg("Set Value: " + R2S(udg_SysA_AddValue))
endfunction

//===========================================================================
function InitTrig_Type_3_value takes nothing returns nothing
    set gg_trg_Type_3_value = CreateTrigger(  )
    call TriggerRegisterPlayerChatEvent( gg_trg_Type_3_value, Player(0), "-값3 ", false )
    call TriggerAddAction( gg_trg_Type_3_value, function Trig_Type_3_value_Actions )
endfunction

//===========================================================================
// Trigger: Type 4
//===========================================================================
function Trig_Type_4_Actions takes nothing returns nothing
debug call UnitAddItem(udg_Unit[GetPlayerId(GetTriggerPlayer())+1], CreateItem('wild', 0, 0))
debug call BJDebugMsg("wild")
endfunction

//===========================================================================
function InitTrig_Type_4 takes nothing returns nothing
    set gg_trg_Type_4 = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Type_4, "-값 4", true )
    call TriggerAddAction( gg_trg_Type_4, function Trig_Type_4_Actions )
endfunction

//===========================================================================
// Trigger: Type 6 hp
//===========================================================================
function Trig_Type_6_HP_Actions takes nothing returns nothing
debug set udg_Save_HP[GetPlayerId(GetTriggerPlayer())+1] = S2I(SubString(GetEventPlayerChatString(), 6, 11))
debug call BJDebugMsg("Set HP: " + I2S(udg_Save_HP[GetPlayerId(GetTriggerPlayer())+1]))
endfunction

//===========================================================================
function InitTrig_Type_6_hp takes nothing returns nothing
    set gg_trg_Type_6_hp = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Type_6_hp, "-값6 ", false)
    call TriggerAddAction( gg_trg_Type_6_hp, function Trig_Type_6_HP_Actions )
endfunction

//===========================================================================
// Trigger: Type 7 mp
//===========================================================================
function Trig_Type_7_Actions takes nothing returns nothing
debug set udg_Save_MP[GetPlayerId(GetTriggerPlayer())+1] = S2I(SubString(GetEventPlayerChatString(), 6, 11))
debug call BJDebugMsg("Set MP: " + I2S(udg_Save_MP[GetPlayerId(GetTriggerPlayer())+1]))
endfunction

//===========================================================================
function InitTrig_Type_7_mp takes nothing returns nothing
    set gg_trg_Type_7_mp = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Type_7_mp, "-값7 ", false)
    call TriggerAddAction( gg_trg_Type_7_mp, function Trig_Type_7_Actions )
endfunction

//===========================================================================
// Trigger: Type 8
//===========================================================================
function Trig_Type_8_Actions takes nothing returns nothing
  local integer P = GetPlayerId(GetTriggerPlayer())+1
  local string s = SubString(GetEventPlayerChatString(),6,99)
  local string s2 = ""
  local integer itemcode = 0
  local integer loopA = JNStringCount(s,"||")
call BJDebugMsg("Event takes: " + s)
    loop
      set s2 = JNStringSplit(s,"||",loopA)
      set itemcode = from_str(FCut(s2,1))
call BJDebugMsg("Event takes_s2: " + s2)
call BJDebugMsg("Event takes_ic: " + I2S(itemcode) + " / " + GetObjectName(itemcode))
      
      if ( S2I(FCut(s2,2)) < 0 ) then
        call GiveItem(P, itemcode, (GetRandomInt(0,SysInt(0,29))*5)-S2I(FCut(s2,2)))
      else
        call GiveItem(P, itemcode, S2I(FCut(s2,2)))
      endif
      call SetItemUserData(bj_lastCreatedItem, P)
      call MSG(Player(P-1), 1, 7., "특별 아이템, " +GetItemName(bj_lastCreatedItem)+ "을(를) 받았습니다!" )
      
      exitwhen loopA <= 0
      set loopA = loopA - 1
      call TriggerSleepAction(.1)
    endloop
debug call BJDebugMsg("END")
endfunction

//===========================================================================
function InitTrig_Type_8 takes nothing returns nothing
debug    set gg_trg_Type_8 = CreateTrigger(  )
debug    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Type_8, "-값8 ", false )
debug    call TriggerAddAction( gg_trg_Type_8, function Trig_Type_8_Actions )
endfunction

//===========================================================================
// Trigger: Type 11
//===========================================================================
function Trig_Type_11_Actions takes nothing returns nothing
  debug local integer P = GetPlayerId(GetTriggerPlayer())+1
  debug set udg_SysE_STR3[P] = udg_SysE_STR3[P] + 20
  debug set udg_SysE_WIS3[P] = udg_SysE_WIS3[P] + 20
  debug set udg_SysE_INT3[P] = udg_SysE_INT3[P] + 20
endfunction

//===========================================================================
function InitTrig_Type_11 takes nothing returns nothing
    set gg_trg_Type_11 = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Type_11, "-값 11", true )
    call TriggerAddAction( gg_trg_Type_11, function Trig_Type_11_Actions )
endfunction

//===========================================================================
// Trigger: Type 14
//===========================================================================
function Trig_Type_14_Actions takes nothing returns nothing
debug call TriggerExecute(gg_trg_Selcet_N_TD)
endfunction

//===========================================================================
function InitTrig_Type_14 takes nothing returns nothing
    set gg_trg_Type_14 = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Type_14, "-값 14", true )
    call TriggerAddAction( gg_trg_Type_14, function Trig_Type_14_Actions )
endfunction

//===========================================================================
// Trigger: Type 20
//===========================================================================
function Trig_Type_20_Actions takes nothing returns nothing
 debug local integer P = GetPlayerId(GetTriggerPlayer())+1
  debug set udg_Quest_ClearInt_12[P] = udg_Quest_ClearInt_12[P] + 600
  debug call GiveItem(P, 'phea', 600)
endfunction

//===========================================================================
function InitTrig_Type_20 takes nothing returns nothing
    set gg_trg_Type_20 = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Type_20, "-값 20", true )
    call TriggerAddAction( gg_trg_Type_20, function Trig_Type_20_Actions )
endfunction

//===========================================================================
// Trigger: Type Skill2
//===========================================================================
function Trig_Intr_Skill2_Actions takes nothing returns nothing
 local integer itemcode = from_str(SubString(GetEventPlayerChatString(),5,99))
 local integer number = LoadInteger(udg_hash, StringHash("Skill"), itemcode)
if ( udg_SysK_TEST ) then
  
  call BJDebugMsg("add: No." + I2S(number) +"/"+GetObjectName(itemcode) )
  call UnitRemoveAbility(udg_Unit[GetPlayerId(GetTriggerPlayer())+1], LoadInteger(udg_hash, StringHash("Player"+I2S(GetPlayerId(GetTriggerPlayer())+1)), StringHash("Skill_"+I2S(SK2I(SubString(LoadStr(udg_hash, number, 60), 17, 18))))))
  call UnitAddAbility(udg_Unit[GetPlayerId(GetTriggerPlayer())+1], itemcode)
  call SetUnitAbilityLevel(udg_Unit[GetPlayerId(GetTriggerPlayer())+1], itemcode, 10)
endif
endfunction

//===========================================================================
function InitTrig_Type_Skill2 takes nothing returns nothing
    set gg_trg_Type_Skill2 = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Type_Skill2, "-스 ", false )
    call TriggerAddAction( gg_trg_Type_Skill2, function Trig_Intr_Skill2_Actions )
endfunction

//===========================================================================
// Trigger: Type Lv
//===========================================================================
function Trig_Intr_TypeLvLVLV_Actions takes nothing returns nothing
 local integer lv = S2I(SubString(GetEventPlayerChatString(),5,99))
 local integer P = GetPlayerId(GetTriggerPlayer())+1
if ( udg_SysK_TEST ) then
 call SetHeroLevel(udg_Unit[P], lv, true)
 set udg_SysB_Level[P] = lv
 call BJDebugMsg("lv set: " + I2S(lv) )
endif
endfunction

//===========================================================================
function InitTrig_Type_Lv takes nothing returns nothing
    set gg_trg_Type_Lv = CreateTrigger(  )
    call TriggerRegisterAnyPlayerChatEventBJ( gg_trg_Type_Lv, "-렙 ", false )
    call TriggerAddAction( gg_trg_Type_Lv, function Trig_Intr_TypeLvLVLV_Actions )
endfunction

//===========================================================================
function InitCustomTriggers takes nothing returns nothing
    call InitTrig_Set_Start(  )
    call InitTrig_Set_Instruction(  )
    call InitTrig_Set_Skill_Data(  )
    call InitTrig_Set_SaveItem(  )
    call InitTrig_Set_Items(  )
    call InitTrig_Set_NPC(  )
    call InitTrig_Set_Drops(  )
    call InitTrig_Set_Etc(  )
    call InitTrig_Set_FAL(  )
    call InitTrig_Set_Monster(  )
    call InitTrig_Set_Party(  )
    call InitTrig_Set_SignBar(  )
    call InitTrig_Set_Skin(  )
    call InitTrig_Quest_Set(  )
    call InitTrig_Config_Set(  )
    call InitTrig_ModifiedEvents(  )
    call InitTrig_JN_Load(  )
    call InitTrig_JN_NOTICE(  )
    call InitTrig_JN_OpLimit(  )
    call InitTrig_RankEx(  )
    call InitTrig_DmgText(  )
    call InitTrig_Party_Intr_all(  )
    call InitTrig_FSE_Save(  )
    call InitTrig_FSE_Load(  )
    call InitTrig_FSE_Load2(  )
    call InitTrig_FSE_Save1(  )
    call InitTrig_FAL_Load1(  )
    call InitTrig_Instruction_All(  )
    call InitTrig_Use_Item(  )
    call InitTrig_Use_Item2(  )
    call InitTrig_Sys_Dmg_Add(  )
    call InitTrig_Sys_MT_Set(  )
    call InitTrig_Sys_Exp_Get(  )
    call InitTrig_Sys_Item_Drop(  )
    call InitTrig_Sys_Death_ALL(  )
    call InitTrig_Sys_Dmg_Manager_v6(  )
    call InitTrig_Sys_Create_Monster(  )
    call InitTrig_JN_Load_Complete2(  )
    call InitTrig_Intr_Stats(  )
    call InitTrig_Import(  )
    call InitTrig_EndGameHook(  )
    call InitTrig_MemoryLib(  )
    call InitTrig_Typecast(  )
    call InitTrig_Update_Callback(  )
    call InitTrig_FMi_Scope(  )
    call InitTrig_Quest_00_Note(  )
    call InitTrig_Inventory(  )
    call InitTrig_EquipSlot(  )
    call InitTrig_Mouse_In_Common(  )
    call InitTrig_Level_UP(  )
    call InitTrig_Select_Novice(  )
    call InitTrig_Selcet_N_TD(  )
    call InitTrig_Select_Skin(  )
    call InitTrig_Auto_Setting_1(  )
    call InitTrig_Sys_Gold_Drop(  )
    call InitTrig_Sys_Gold_Get(  )
    call InitTrig_Item_Drop_3(  )
    call InitTrig_Item_Drop_4(  )
    call InitTrig_Item_Drop_5(  )
    call InitTrig_Sys_NPC_No_Attack(  )
    call InitTrig_Sys_F9_Setup(  )
    call InitTrig_Sys_F9_Set(  )
    call InitTrig_Sys_Tip_Loop(  )
    call InitTrig_Sys_Player_Left(  )
    call InitTrig_Sys_NoPatroll(  )
    call InitTrig_Sys_NoTeamKill(  )
    call InitTrig_Sys_Clear_Items(  )
    call InitTrig_Sys_Clear_Units(  )
    call InitTrig_Sys_Enter_Villeage(  )
    call InitTrig_Sys_Exit_Villeage(  )
    call InitTrig_Sys_Moving(  )
    call InitTrig_Sys_Dummy_Attacked(  )
    call InitTrig_Sys_Dummy_Rev(  )
    call InitTrig_Sys_Elk(  )
    call InitTrig_Sys_Elk_2(  )
    call InitTrig_Sys_Novis_Cow(  )
    call InitTrig_Sys_After_10m(  )
    call InitTrig_Sys_Boss1_Phase2(  )
    call InitTrig_Sys_Boss1_Phase3(  )
    call InitTrig_Sys_Boss1_Phase4(  )
    call InitTrig_Sys_Boss1_Phase4n2(  )
    call InitTrig_Sys_Boss1_Dead(  )
    call InitTrig_Sys_Bead_Dead(  )
    call InitTrig_Sys_Zombie_Boom(  )
    call InitTrig_Sys_Zombie_Revive(  )
    call InitTrig_Ct_6_Load_Error(  )
    call InitTrig_FCS_Start_Cst(  )
    call InitTrig_FCS_Stop_Cst(  )
    call InitTrig_FCS_End_Cst(  )
    call InitTrig_Exp_Exception(  )
    call InitTrig_SignBar_Drag(  )
    call InitTrig_SignBar_Drag2(  )
    call InitTrig_SignBar_Hit(  )
    call InitTrig_Solo_Add_skrt(  )
    call InitTrig_Solo_Exit_sorf(  )
    call InitTrig_Event_Buff(  )
    call InitTrig_Event_Buff2(  )
    call InitTrig_Event_Buff22(  )
    call InitTrig_Event_DailyCheck_bzbe(  )
    call InitTrig_Event_DailyCheck2(  )
    call InitTrig_Event_DailyCheckState_mlst(  )
    call InitTrig_Event_DailyCheckState2(  )
    call InitTrig_Item_Buy_Orens(  )
    call InitTrig_Move_Mine_Elevator(  )
    call InitTrig_Mine_Trade_Items_crdt_wneu_wneg(  )
    call InitTrig_ReviveHero(  )
    call InitTrig_Give_Level_Up_rre2(  )
    call InitTrig_Give_Wood_engs(  )
    call InitTrig_Give_SkillMax_sbch(  )
    call InitTrig_BossBar(  )
    call InitTrig_Sys_ChangJob_A_ALL(  )
    call InitTrig_Sys_ChangJob_B_ALL(  )
    call InitTrig_Dialog_Miles_Temple(  )
    call InitTrig_Dialog_Miles_Temple_2(  )
    call InitTrig_Buy_Skills_All(  )
    call InitTrig_AutoReaction_iii(  )
    call InitTrig_SQResqueDA007(  )
    call InitTrig_SWShortBlacdeA02F(  )
    call InitTrig_SW2WindBladeA00A(  )
    call InitTrig_SEMegaBladeA02P(  )
    call InitTrig_SQ2BatuDA02N(  )
    call InitTrig_SRHitarmsDA03R(  )
    call InitTrig_STRushA02A(  )
    call InitTrig_SQ3PyohoA09X(  )
    call InitTrig_SW3RuneBladeA09Y(  )
    call InitTrig_SE2StomeBladeA09Z(  )
    call InitTrig_SQSPierceDA02H(  )
    call InitTrig_SQPierceDA009(  )
    call InitTrig_SRAmunejiaDA00C(  )
    call InitTrig_SWDartThrowDA01J(  )
    call InitTrig_SEPierce2DA00F(  )
    call InitTrig_STAssaultDA03O(  )
    call InitTrig_SWAssassinateDA04J(  )
    call InitTrig_SR2RaidDA02U(  )
    call InitTrig_MQ1MTAPA008A020A021A022(  )
    call InitTrig_MW1RentoA01O(  )
    call InitTrig_ME1SuperaA025A026A027A028(  )
    call InitTrig_MF1VenomiA029(  )
    call InitTrig_MW2BardoA01V(  )
    call InitTrig_MQ2MTAPA02QA02WA02XA02Y(  )
    call InitTrig_MRNarcolyA02T(  )
    call InitTrig_ME2XTAPA043A044A045A046(  )
    call InitTrig_MW3DeprecoA00J(  )
    call InitTrig_MQ3MTAPA03JA03LA03MA03N(  )
    call InitTrig_MF2WISorumaDA07M(  )
    call InitTrig_MT1TAPA063A066A067A068(  )
    call InitTrig_MW4PraboA00ZA098(  )
    call InitTrig_MF3DeathA07Q(  )
    call InitTrig_MQ4QWERA07AA08IA08JA08K(  )
    call InitTrig_MQ4ASemeliaA079(  )
    call InitTrig_ME3QWERA08BA08CA08DA08E(  )
    call InitTrig_ME3AIAmagetdonA08F(  )
    call InitTrig_ME4SSoommastellaA08G(  )
    call InitTrig_MT2QWERA086A087A088A089(  )
    call InitTrig_MT2AIRagnarokA08A_A09E_A03I(  )
    call InitTrig_MT3SIMeteorA05T(  )
    call InitTrig_MQCuroA00V(  )
    call InitTrig_MWDeRentoA024(  )
    call InitTrig_MEBellaA01N(  )
    call InitTrig_MW2DeBardoA02D(  )
    call InitTrig_MQ2CuranoA01Y(  )
    call InitTrig_MFCureceA01X(  )
    call InitTrig_MREnarmaA02Z(  )
    call InitTrig_MQ3CuranosoA030(  )
    call InitTrig_MW3DeDeprecaA04G(  )
    call InitTrig_MF2CuranuceA031(  )
    call InitTrig_MT1HolyShotA05V(  )
    call InitTrig_MT2HolyBoltA032(  )
    call InitTrig_MW4DePrabaA04H(  )
    call InitTrig_ME2SuBellaA059(  )
    call InitTrig_MZESmallBuffA09K(  )
    call InitTrig_MQ4SuCuranoA05D(  )
    call InitTrig_MF3CuraneraA05H(  )
    call InitTrig_MQ5XCuranoA074(  )
    call InitTrig_MF4XCuraneraA075(  )
    call InitTrig_MQ6HCuranoA002(  )
    call InitTrig_MT2HdragonA01U(  )
    call InitTrig_SQDangakDA00X(  )
    call InitTrig_SWJumpA00Y(  )
    call InitTrig_SEBunggakDA01L(  )
    call InitTrig_SRSeonpoongA035(  )
    call InitTrig_STbaekboDA02M(  )
    call InitTrig_SFQTongbaeA01KA07Y(  )
    call InitTrig_SFEBalGyengDA081A082(  )
    call InitTrig_SFRSosuA04UA04X(  )
    call InitTrig_SFADalmaA037A04V(  )
    call InitTrig_SFSGuyangA07V(  )
    call InitTrig_SW2Jump2A05U(  )
    call InitTrig_CurotoA010(  )
    call InitTrig_SDQlTwohandAttackA03PA04N(  )
    call InitTrig_SDWlDragonModeA03SA06D(  )
    call InitTrig_SDElDefallA06CA06J(  )
    call InitTrig_SDRIMadA06KA03C(  )
    call InitTrig_SDAICratherA03EA06X(  )
    call InitTrig_SDWIPhoenixModeA0A2A0A3(  )
    call InitTrig_MDRlConcentrationA0A5(  )
    call InitTrig_SDRIMad2A0A8A0A9(  )
    call InitTrig_SDAIDevilCratherA0AB(  )
    call InitTrig_MDQlLightningMoveA038(  )
    call InitTrig_MDWlHideA04I(  )
    call InitTrig_MDWlCensusA04R(  )
    call InitTrig_MDQlCuraltumA033(  )
    call InitTrig_MDWlColamaA03T(  )
    call InitTrig_MDElLocameaA05B(  )
    call InitTrig_MDRlLichmanaA05G(  )
    call InitTrig_MDAlHorramaA05N(  )
    call InitTrig_MDSlImmortalA05Q(  )
    call InitTrig_MDFIReflectoA07G(  )
    call InitTrig_MDZIReberatoA08Y(  )
    call InitTrig_MDXIComadiaA090(  )
    call InitTrig_MDWlMisngA03B(  )
    call InitTrig_MDElMovingUpA03A(  )
    call InitTrig_MDRlIronSkinA04C(  )
    call InitTrig_MDAlHameA051(  )
    call InitTrig_MDSlAdamantineA053(  )
    call InitTrig_MDDlCuranotoA055(  )
    call InitTrig_MDFlReflectionA06B(  )
    call InitTrig_MDZlDaraA07D(  )
    call InitTrig_MDDCurotoA03G(  )
    call InitTrig_MDWColamaA05A(  )
    call InitTrig_MDAHorramaA05O(  )
    call InitTrig_MDWMisngA03K(  )
    call InitTrig_MDEMovingUpA03Y(  )
    call InitTrig_MDRIronSkinA04W(  )
    call InitTrig_MDAHameA052(  )
    call InitTrig_MDDCuranotoA06A(  )
    call InitTrig_MDFReflectionA07C(  )
    call InitTrig_Intr_Infomation(  )
    call InitTrig_Intr_AddInven(  )
    call InitTrig_Intr_Field_of_View(  )
    call InitTrig_Intr_Newbie(  )
    call InitTrig_Intr_Tip_off(  )
    call InitTrig_Intr_Dice(  )
    call InitTrig_Intr_Inventory(  )
    call InitTrig_Intr_Version(  )
    call InitTrig_Intr_Jobs(  )
    call InitTrig_Intr_HPMP(  )
    call InitTrig_Intr_Circle(  )
    call InitTrig_Intr_Recall(  )
    call InitTrig_Intr_Quust(  )
    call InitTrig_Intr_Stat(  )
    call InitTrig_Intr_Field(  )
    call InitTrig_Intr_Exp(  )
    call InitTrig_Intr_Q_Skip(  )
    call InitTrig_Intr_Q_Speed(  )
    call InitTrig_Intr_Skill(  )
    call InitTrig_Intr_FixCam(  )
    call InitTrig_Intr_Love_fooiff(  )
    call InitTrig_Intr_Link(  )
    call InitTrig_Intr_Reset(  )
    call InitTrig_Intr_Type_HPMP(  )
    call InitTrig_Intr_Title(  )
    call InitTrig_Intr_AutoStat(  )
    call InitTrig_Intr_Cafe(  )
    call InitTrig_Intr_MTSmall(  )
    call InitTrig_Intr_Effect_Off(  )
    call InitTrig_Intr_MapLevelUp(  )
    call InitTrig_Intr_Skin(  )
    call InitTrig_Intr_Camera(  )
    call InitTrig_Intr_ReTitle(  )
    call InitTrig_Intr_Debug(  )
    call InitTrig_Intr_Test(  )
    call InitTrig_Sys_DebugDmg(  )
    call InitTrig_Sys_DebugSelect(  )
    call InitTrig_Intr_ResetQuest(  )
    call InitTrig_Intr_Suicide(  )
    call InitTrig_Quest_Type_All(  )
    call InitTrig_Quest_Attack(  )
    call InitTrig_Quest_00_47_B(  )
    call InitTrig_Quest_01(  )
    call InitTrig_Quest_02(  )
    call InitTrig_Quest_02_B(  )
    call InitTrig_Quest_03(  )
    call InitTrig_Quest_03_B(  )
    call InitTrig_Quest_03_D(  )
    call InitTrig_Quest_04(  )
    call InitTrig_Quest_04_B(  )
    call InitTrig_Quest_05(  )
    call InitTrig_Quest_05_D1(  )
    call InitTrig_Quest_05_D2(  )
    call InitTrig_Quest_05_D3_Check(  )
    call InitTrig_Quest_05_D4_Makes(  )
    call InitTrig_Quest_05_D5_Wait(  )
    call InitTrig_Quest_05_D6_Make(  )
    call InitTrig_Quest_05_E2_Kill(  )
    call InitTrig_Quest_05_E3_DmgSave(  )
    call InitTrig_Quest_05_E4_Cinema(  )
    call InitTrig_Quest_05_F_Attacked(  )
    call InitTrig_Quest_06(  )
    call InitTrig_Quest_06_B(  )
    call InitTrig_Quest_07(  )
    call InitTrig_Quest_07_B(  )
    call InitTrig_Quest_08(  )
    call InitTrig_Quest_08_B(  )
    call InitTrig_Quest_09(  )
    call InitTrig_Quest_09_B(  )
    call InitTrig_Quest_10(  )
    call InitTrig_Quest_11(  )
    call InitTrig_Quest_12(  )
    call InitTrig_Quest_12_B(  )
    call InitTrig_Quest_13(  )
    call InitTrig_Quest_13_B(  )
    call InitTrig_Quest_14(  )
    call InitTrig_Quest_14_B(  )
    call InitTrig_Quest_15(  )
    call InitTrig_Quest_15_D_BuyItems(  )
    call InitTrig_Quest_15_Loop(  )
    call InitTrig_Quest_15_Enter_Mob(  )
    call InitTrig_Quest_15_Dead_Mob(  )
    call InitTrig_Quest_16_Mine(  )
    call InitTrig_Quest_16_B(  )
    call InitTrig_Boss_Mildun(  )
    call InitTrig_FMi_Internal(  )
    call InitTrig_Intr_Quest_Helper(  )
    call InitTrig_Item87AIlu(  )
    call InitTrig_Item81A015(  )
    call InitTrig_Item45A014(  )
    call InitTrig_Item_fooiffs_Buff(  )
    call InitTrig_Item_RecallAll(  )
    call InitTrig_Item_Comax10dtsbdrph(  )
    call InitTrig_Item_Hornshea(  )
    call InitTrig_Item_Boss1lmbr(  )
    call InitTrig_Item_Move1Wood1shwd(  )
    call InitTrig_Item_Move1Wood2rma2(  )
    call InitTrig_Item_Move1Wood3rej1(  )
    call InitTrig_Item_Move_Graves1tels(  )
    call InitTrig_Item_Move_Graves2gobm(  )
    call InitTrig_Item_Move_fote_nflg(  )
    call InitTrig_Item_Move_bitch_shdt(  )
    call InitTrig_Item_Move_harmony_ram3(  )
    call InitTrig_Item_Move_Horr_pnvu(  )
    call InitTrig_Item_Move_Mine_mgtk(  )
    call InitTrig_Item_Move_DeadVilleage_dthb(  )
    call InitTrig_Rect_Floor_Up(  )
    call InitTrig_Rect_Mine_Exit(  )
    call InitTrig_Skill_SkillCheckA01D(  )
    call InitTrig_Skill_SkillLearnA01E(  )
    call InitTrig_Skill_StateAddALL(  )
    call InitTrig_Skill_Reset(  )
    call InitTrig_Skill_EatItemsA039(  )
    call InitTrig_Skill_AutoSaveA05J(  )
    call InitTrig_Skill_FooiffBuffA05L(  )
    call InitTrig_Skill_ComadiumI08V(  )
    call InitTrig_Moving_Harmonious_1(  )
    call InitTrig_Moving_Harmonious_2(  )
    call InitTrig_UTextSet(  )
    call InitTrig_Set_Test(  )
    call InitTrig_Intr_cheat_2(  )
    call InitTrig_Intr_Cheat(  )
    call InitTrig_Intr_Gotcha(  )
    call InitTrig_Intr_nick(  )
    call InitTrig_Intr_Newbie_Quest(  )
    call InitTrig_Type_2_Title(  )
    call InitTrig_Type_3_value(  )
    call InitTrig_Type_4(  )
    call InitTrig_Type_6_hp(  )
    call InitTrig_Type_7_mp(  )
    call InitTrig_Type_8(  )
    call InitTrig_Type_11(  )
    call InitTrig_Type_14(  )
    call InitTrig_Type_20(  )
    call InitTrig_Type_Skill2(  )
    call InitTrig_Type_Lv(  )
endfunction

//===========================================================================
function RunInitializationTriggers takes nothing returns nothing
    call ConditionalTriggerExecute( gg_trg_Level_UP )
    call ConditionalTriggerExecute( gg_trg_Quest_05_D6_Make )
endfunction

//***************************************************************************
//*
//*  Players
//*
//***************************************************************************

function InitCustomPlayerSlots takes nothing returns nothing

    // Player 0
    call SetPlayerStartLocation( Player(0), 0 )
    call ForcePlayerStartLocation( Player(0), 0 )
    call SetPlayerColor( Player(0), ConvertPlayerColor(0) )
    call SetPlayerRacePreference( Player(0), RACE_PREF_HUMAN )
    call SetPlayerRaceSelectable( Player(0), false )
    call SetPlayerController( Player(0), MAP_CONTROL_USER )

    // Player 1
    call SetPlayerStartLocation( Player(1), 1 )
    call ForcePlayerStartLocation( Player(1), 1 )
    call SetPlayerColor( Player(1), ConvertPlayerColor(1) )
    call SetPlayerRacePreference( Player(1), RACE_PREF_HUMAN )
    call SetPlayerRaceSelectable( Player(1), false )
    call SetPlayerController( Player(1), MAP_CONTROL_USER )

    // Player 2
    call SetPlayerStartLocation( Player(2), 2 )
    call ForcePlayerStartLocation( Player(2), 2 )
    call SetPlayerColor( Player(2), ConvertPlayerColor(2) )
    call SetPlayerRacePreference( Player(2), RACE_PREF_HUMAN )
    call SetPlayerRaceSelectable( Player(2), false )
    call SetPlayerController( Player(2), MAP_CONTROL_USER )

    // Player 3
    call SetPlayerStartLocation( Player(3), 3 )
    call ForcePlayerStartLocation( Player(3), 3 )
    call SetPlayerColor( Player(3), ConvertPlayerColor(3) )
    call SetPlayerRacePreference( Player(3), RACE_PREF_HUMAN )
    call SetPlayerRaceSelectable( Player(3), false )
    call SetPlayerController( Player(3), MAP_CONTROL_USER )

    // Player 4
    call SetPlayerStartLocation( Player(4), 4 )
    call ForcePlayerStartLocation( Player(4), 4 )
    call SetPlayerColor( Player(4), ConvertPlayerColor(4) )
    call SetPlayerRacePreference( Player(4), RACE_PREF_HUMAN )
    call SetPlayerRaceSelectable( Player(4), false )
    call SetPlayerController( Player(4), MAP_CONTROL_USER )

    // Player 5
    call SetPlayerStartLocation( Player(5), 5 )
    call ForcePlayerStartLocation( Player(5), 5 )
    call SetPlayerColor( Player(5), ConvertPlayerColor(5) )
    call SetPlayerRacePreference( Player(5), RACE_PREF_HUMAN )
    call SetPlayerRaceSelectable( Player(5), false )
    call SetPlayerController( Player(5), MAP_CONTROL_USER )

    // Player 6
    call SetPlayerStartLocation( Player(6), 6 )
    call ForcePlayerStartLocation( Player(6), 6 )
    call SetPlayerColor( Player(6), ConvertPlayerColor(6) )
    call SetPlayerRacePreference( Player(6), RACE_PREF_HUMAN )
    call SetPlayerRaceSelectable( Player(6), false )
    call SetPlayerController( Player(6), MAP_CONTROL_USER )

    // Player 7
    call SetPlayerStartLocation( Player(7), 7 )
    call ForcePlayerStartLocation( Player(7), 7 )
    call SetPlayerColor( Player(7), ConvertPlayerColor(7) )
    call SetPlayerRacePreference( Player(7), RACE_PREF_HUMAN )
    call SetPlayerRaceSelectable( Player(7), false )
    call SetPlayerController( Player(7), MAP_CONTROL_USER )

    // Player 8
    call SetPlayerStartLocation( Player(8), 8 )
    call ForcePlayerStartLocation( Player(8), 8 )
    call SetPlayerColor( Player(8), ConvertPlayerColor(8) )
    call SetPlayerRacePreference( Player(8), RACE_PREF_HUMAN )
    call SetPlayerRaceSelectable( Player(8), false )
    call SetPlayerController( Player(8), MAP_CONTROL_USER )

    // Player 9
    call SetPlayerStartLocation( Player(9), 9 )
    call ForcePlayerStartLocation( Player(9), 9 )
    call SetPlayerColor( Player(9), ConvertPlayerColor(9) )
    call SetPlayerRacePreference( Player(9), RACE_PREF_HUMAN )
    call SetPlayerRaceSelectable( Player(9), false )
    call SetPlayerController( Player(9), MAP_CONTROL_USER )

    // Player 10
    call SetPlayerStartLocation( Player(10), 10 )
    call ForcePlayerStartLocation( Player(10), 10 )
    call SetPlayerColor( Player(10), ConvertPlayerColor(10) )
    call SetPlayerRacePreference( Player(10), RACE_PREF_HUMAN )
    call SetPlayerRaceSelectable( Player(10), false )
    call SetPlayerController( Player(10), MAP_CONTROL_USER )

    // Player 11
    call SetPlayerStartLocation( Player(11), 11 )
    call ForcePlayerStartLocation( Player(11), 11 )
    call SetPlayerColor( Player(11), ConvertPlayerColor(11) )
    call SetPlayerRacePreference( Player(11), RACE_PREF_HUMAN )
    call SetPlayerRaceSelectable( Player(11), false )
    call SetPlayerController( Player(11), MAP_CONTROL_USER )

endfunction

function InitCustomTeams takes nothing returns nothing
    // Force: 포스 1
    call SetPlayerTeam( Player(0), 0 )

    // Force: 포스 2
    call SetPlayerTeam( Player(1), 1 )
    call SetPlayerTeam( Player(2), 1 )
    call SetPlayerTeam( Player(3), 1 )
    call SetPlayerTeam( Player(4), 1 )
    call SetPlayerTeam( Player(5), 1 )
    call SetPlayerTeam( Player(6), 1 )
    call SetPlayerTeam( Player(7), 1 )
    call SetPlayerTeam( Player(8), 1 )
    call SetPlayerTeam( Player(9), 1 )
    call SetPlayerTeam( Player(10), 1 )
    call SetPlayerTeam( Player(11), 1 )

    //   Allied
    call SetPlayerAllianceStateAllyBJ( Player(1), Player(2), true )
    call SetPlayerAllianceStateAllyBJ( Player(1), Player(3), true )
    call SetPlayerAllianceStateAllyBJ( Player(1), Player(4), true )
    call SetPlayerAllianceStateAllyBJ( Player(1), Player(5), true )
    call SetPlayerAllianceStateAllyBJ( Player(1), Player(6), true )
    call SetPlayerAllianceStateAllyBJ( Player(1), Player(7), true )
    call SetPlayerAllianceStateAllyBJ( Player(1), Player(8), true )
    call SetPlayerAllianceStateAllyBJ( Player(1), Player(9), true )
    call SetPlayerAllianceStateAllyBJ( Player(1), Player(10), true )
    call SetPlayerAllianceStateAllyBJ( Player(1), Player(11), true )
    call SetPlayerAllianceStateAllyBJ( Player(2), Player(1), true )
    call SetPlayerAllianceStateAllyBJ( Player(2), Player(3), true )
    call SetPlayerAllianceStateAllyBJ( Player(2), Player(4), true )
    call SetPlayerAllianceStateAllyBJ( Player(2), Player(5), true )
    call SetPlayerAllianceStateAllyBJ( Player(2), Player(6), true )
    call SetPlayerAllianceStateAllyBJ( Player(2), Player(7), true )
    call SetPlayerAllianceStateAllyBJ( Player(2), Player(8), true )
    call SetPlayerAllianceStateAllyBJ( Player(2), Player(9), true )
    call SetPlayerAllianceStateAllyBJ( Player(2), Player(10), true )
    call SetPlayerAllianceStateAllyBJ( Player(2), Player(11), true )
    call SetPlayerAllianceStateAllyBJ( Player(3), Player(1), true )
    call SetPlayerAllianceStateAllyBJ( Player(3), Player(2), true )
    call SetPlayerAllianceStateAllyBJ( Player(3), Player(4), true )
    call SetPlayerAllianceStateAllyBJ( Player(3), Player(5), true )
    call SetPlayerAllianceStateAllyBJ( Player(3), Player(6), true )
    call SetPlayerAllianceStateAllyBJ( Player(3), Player(7), true )
    call SetPlayerAllianceStateAllyBJ( Player(3), Player(8), true )
    call SetPlayerAllianceStateAllyBJ( Player(3), Player(9), true )
    call SetPlayerAllianceStateAllyBJ( Player(3), Player(10), true )
    call SetPlayerAllianceStateAllyBJ( Player(3), Player(11), true )
    call SetPlayerAllianceStateAllyBJ( Player(4), Player(1), true )
    call SetPlayerAllianceStateAllyBJ( Player(4), Player(2), true )
    call SetPlayerAllianceStateAllyBJ( Player(4), Player(3), true )
    call SetPlayerAllianceStateAllyBJ( Player(4), Player(5), true )
    call SetPlayerAllianceStateAllyBJ( Player(4), Player(6), true )
    call SetPlayerAllianceStateAllyBJ( Player(4), Player(7), true )
    call SetPlayerAllianceStateAllyBJ( Player(4), Player(8), true )
    call SetPlayerAllianceStateAllyBJ( Player(4), Player(9), true )
    call SetPlayerAllianceStateAllyBJ( Player(4), Player(10), true )
    call SetPlayerAllianceStateAllyBJ( Player(4), Player(11), true )
    call SetPlayerAllianceStateAllyBJ( Player(5), Player(1), true )
    call SetPlayerAllianceStateAllyBJ( Player(5), Player(2), true )
    call SetPlayerAllianceStateAllyBJ( Player(5), Player(3), true )
    call SetPlayerAllianceStateAllyBJ( Player(5), Player(4), true )
    call SetPlayerAllianceStateAllyBJ( Player(5), Player(6), true )
    call SetPlayerAllianceStateAllyBJ( Player(5), Player(7), true )
    call SetPlayerAllianceStateAllyBJ( Player(5), Player(8), true )
    call SetPlayerAllianceStateAllyBJ( Player(5), Player(9), true )
    call SetPlayerAllianceStateAllyBJ( Player(5), Player(10), true )
    call SetPlayerAllianceStateAllyBJ( Player(5), Player(11), true )
    call SetPlayerAllianceStateAllyBJ( Player(6), Player(1), true )
    call SetPlayerAllianceStateAllyBJ( Player(6), Player(2), true )
    call SetPlayerAllianceStateAllyBJ( Player(6), Player(3), true )
    call SetPlayerAllianceStateAllyBJ( Player(6), Player(4), true )
    call SetPlayerAllianceStateAllyBJ( Player(6), Player(5), true )
    call SetPlayerAllianceStateAllyBJ( Player(6), Player(7), true )
    call SetPlayerAllianceStateAllyBJ( Player(6), Player(8), true )
    call SetPlayerAllianceStateAllyBJ( Player(6), Player(9), true )
    call SetPlayerAllianceStateAllyBJ( Player(6), Player(10), true )
    call SetPlayerAllianceStateAllyBJ( Player(6), Player(11), true )
    call SetPlayerAllianceStateAllyBJ( Player(7), Player(1), true )
    call SetPlayerAllianceStateAllyBJ( Player(7), Player(2), true )
    call SetPlayerAllianceStateAllyBJ( Player(7), Player(3), true )
    call SetPlayerAllianceStateAllyBJ( Player(7), Player(4), true )
    call SetPlayerAllianceStateAllyBJ( Player(7), Player(5), true )
    call SetPlayerAllianceStateAllyBJ( Player(7), Player(6), true )
    call SetPlayerAllianceStateAllyBJ( Player(7), Player(8), true )
    call SetPlayerAllianceStateAllyBJ( Player(7), Player(9), true )
    call SetPlayerAllianceStateAllyBJ( Player(7), Player(10), true )
    call SetPlayerAllianceStateAllyBJ( Player(7), Player(11), true )
    call SetPlayerAllianceStateAllyBJ( Player(8), Player(1), true )
    call SetPlayerAllianceStateAllyBJ( Player(8), Player(2), true )
    call SetPlayerAllianceStateAllyBJ( Player(8), Player(3), true )
    call SetPlayerAllianceStateAllyBJ( Player(8), Player(4), true )
    call SetPlayerAllianceStateAllyBJ( Player(8), Player(5), true )
    call SetPlayerAllianceStateAllyBJ( Player(8), Player(6), true )
    call SetPlayerAllianceStateAllyBJ( Player(8), Player(7), true )
    call SetPlayerAllianceStateAllyBJ( Player(8), Player(9), true )
    call SetPlayerAllianceStateAllyBJ( Player(8), Player(10), true )
    call SetPlayerAllianceStateAllyBJ( Player(8), Player(11), true )
    call SetPlayerAllianceStateAllyBJ( Player(9), Player(1), true )
    call SetPlayerAllianceStateAllyBJ( Player(9), Player(2), true )
    call SetPlayerAllianceStateAllyBJ( Player(9), Player(3), true )
    call SetPlayerAllianceStateAllyBJ( Player(9), Player(4), true )
    call SetPlayerAllianceStateAllyBJ( Player(9), Player(5), true )
    call SetPlayerAllianceStateAllyBJ( Player(9), Player(6), true )
    call SetPlayerAllianceStateAllyBJ( Player(9), Player(7), true )
    call SetPlayerAllianceStateAllyBJ( Player(9), Player(8), true )
    call SetPlayerAllianceStateAllyBJ( Player(9), Player(10), true )
    call SetPlayerAllianceStateAllyBJ( Player(9), Player(11), true )
    call SetPlayerAllianceStateAllyBJ( Player(10), Player(1), true )
    call SetPlayerAllianceStateAllyBJ( Player(10), Player(2), true )
    call SetPlayerAllianceStateAllyBJ( Player(10), Player(3), true )
    call SetPlayerAllianceStateAllyBJ( Player(10), Player(4), true )
    call SetPlayerAllianceStateAllyBJ( Player(10), Player(5), true )
    call SetPlayerAllianceStateAllyBJ( Player(10), Player(6), true )
    call SetPlayerAllianceStateAllyBJ( Player(10), Player(7), true )
    call SetPlayerAllianceStateAllyBJ( Player(10), Player(8), true )
    call SetPlayerAllianceStateAllyBJ( Player(10), Player(9), true )
    call SetPlayerAllianceStateAllyBJ( Player(10), Player(11), true )
    call SetPlayerAllianceStateAllyBJ( Player(11), Player(1), true )
    call SetPlayerAllianceStateAllyBJ( Player(11), Player(2), true )
    call SetPlayerAllianceStateAllyBJ( Player(11), Player(3), true )
    call SetPlayerAllianceStateAllyBJ( Player(11), Player(4), true )
    call SetPlayerAllianceStateAllyBJ( Player(11), Player(5), true )
    call SetPlayerAllianceStateAllyBJ( Player(11), Player(6), true )
    call SetPlayerAllianceStateAllyBJ( Player(11), Player(7), true )
    call SetPlayerAllianceStateAllyBJ( Player(11), Player(8), true )
    call SetPlayerAllianceStateAllyBJ( Player(11), Player(9), true )
    call SetPlayerAllianceStateAllyBJ( Player(11), Player(10), true )

    //   Shared Vision
    call SetPlayerAllianceStateVisionBJ( Player(1), Player(2), true )
    call SetPlayerAllianceStateVisionBJ( Player(1), Player(3), true )
    call SetPlayerAllianceStateVisionBJ( Player(1), Player(4), true )
    call SetPlayerAllianceStateVisionBJ( Player(1), Player(5), true )
    call SetPlayerAllianceStateVisionBJ( Player(1), Player(6), true )
    call SetPlayerAllianceStateVisionBJ( Player(1), Player(7), true )
    call SetPlayerAllianceStateVisionBJ( Player(1), Player(8), true )
    call SetPlayerAllianceStateVisionBJ( Player(1), Player(9), true )
    call SetPlayerAllianceStateVisionBJ( Player(1), Player(10), true )
    call SetPlayerAllianceStateVisionBJ( Player(1), Player(11), true )
    call SetPlayerAllianceStateVisionBJ( Player(2), Player(1), true )
    call SetPlayerAllianceStateVisionBJ( Player(2), Player(3), true )
    call SetPlayerAllianceStateVisionBJ( Player(2), Player(4), true )
    call SetPlayerAllianceStateVisionBJ( Player(2), Player(5), true )
    call SetPlayerAllianceStateVisionBJ( Player(2), Player(6), true )
    call SetPlayerAllianceStateVisionBJ( Player(2), Player(7), true )
    call SetPlayerAllianceStateVisionBJ( Player(2), Player(8), true )
    call SetPlayerAllianceStateVisionBJ( Player(2), Player(9), true )
    call SetPlayerAllianceStateVisionBJ( Player(2), Player(10), true )
    call SetPlayerAllianceStateVisionBJ( Player(2), Player(11), true )
    call SetPlayerAllianceStateVisionBJ( Player(3), Player(1), true )
    call SetPlayerAllianceStateVisionBJ( Player(3), Player(2), true )
    call SetPlayerAllianceStateVisionBJ( Player(3), Player(4), true )
    call SetPlayerAllianceStateVisionBJ( Player(3), Player(5), true )
    call SetPlayerAllianceStateVisionBJ( Player(3), Player(6), true )
    call SetPlayerAllianceStateVisionBJ( Player(3), Player(7), true )
    call SetPlayerAllianceStateVisionBJ( Player(3), Player(8), true )
    call SetPlayerAllianceStateVisionBJ( Player(3), Player(9), true )
    call SetPlayerAllianceStateVisionBJ( Player(3), Player(10), true )
    call SetPlayerAllianceStateVisionBJ( Player(3), Player(11), true )
    call SetPlayerAllianceStateVisionBJ( Player(4), Player(1), true )
    call SetPlayerAllianceStateVisionBJ( Player(4), Player(2), true )
    call SetPlayerAllianceStateVisionBJ( Player(4), Player(3), true )
    call SetPlayerAllianceStateVisionBJ( Player(4), Player(5), true )
    call SetPlayerAllianceStateVisionBJ( Player(4), Player(6), true )
    call SetPlayerAllianceStateVisionBJ( Player(4), Player(7), true )
    call SetPlayerAllianceStateVisionBJ( Player(4), Player(8), true )
    call SetPlayerAllianceStateVisionBJ( Player(4), Player(9), true )
    call SetPlayerAllianceStateVisionBJ( Player(4), Player(10), true )
    call SetPlayerAllianceStateVisionBJ( Player(4), Player(11), true )
    call SetPlayerAllianceStateVisionBJ( Player(5), Player(1), true )
    call SetPlayerAllianceStateVisionBJ( Player(5), Player(2), true )
    call SetPlayerAllianceStateVisionBJ( Player(5), Player(3), true )
    call SetPlayerAllianceStateVisionBJ( Player(5), Player(4), true )
    call SetPlayerAllianceStateVisionBJ( Player(5), Player(6), true )
    call SetPlayerAllianceStateVisionBJ( Player(5), Player(7), true )
    call SetPlayerAllianceStateVisionBJ( Player(5), Player(8), true )
    call SetPlayerAllianceStateVisionBJ( Player(5), Player(9), true )
    call SetPlayerAllianceStateVisionBJ( Player(5), Player(10), true )
    call SetPlayerAllianceStateVisionBJ( Player(5), Player(11), true )
    call SetPlayerAllianceStateVisionBJ( Player(6), Player(1), true )
    call SetPlayerAllianceStateVisionBJ( Player(6), Player(2), true )
    call SetPlayerAllianceStateVisionBJ( Player(6), Player(3), true )
    call SetPlayerAllianceStateVisionBJ( Player(6), Player(4), true )
    call SetPlayerAllianceStateVisionBJ( Player(6), Player(5), true )
    call SetPlayerAllianceStateVisionBJ( Player(6), Player(7), true )
    call SetPlayerAllianceStateVisionBJ( Player(6), Player(8), true )
    call SetPlayerAllianceStateVisionBJ( Player(6), Player(9), true )
    call SetPlayerAllianceStateVisionBJ( Player(6), Player(10), true )
    call SetPlayerAllianceStateVisionBJ( Player(6), Player(11), true )
    call SetPlayerAllianceStateVisionBJ( Player(7), Player(1), true )
    call SetPlayerAllianceStateVisionBJ( Player(7), Player(2), true )
    call SetPlayerAllianceStateVisionBJ( Player(7), Player(3), true )
    call SetPlayerAllianceStateVisionBJ( Player(7), Player(4), true )
    call SetPlayerAllianceStateVisionBJ( Player(7), Player(5), true )
    call SetPlayerAllianceStateVisionBJ( Player(7), Player(6), true )
    call SetPlayerAllianceStateVisionBJ( Player(7), Player(8), true )
    call SetPlayerAllianceStateVisionBJ( Player(7), Player(9), true )
    call SetPlayerAllianceStateVisionBJ( Player(7), Player(10), true )
    call SetPlayerAllianceStateVisionBJ( Player(7), Player(11), true )
    call SetPlayerAllianceStateVisionBJ( Player(8), Player(1), true )
    call SetPlayerAllianceStateVisionBJ( Player(8), Player(2), true )
    call SetPlayerAllianceStateVisionBJ( Player(8), Player(3), true )
    call SetPlayerAllianceStateVisionBJ( Player(8), Player(4), true )
    call SetPlayerAllianceStateVisionBJ( Player(8), Player(5), true )
    call SetPlayerAllianceStateVisionBJ( Player(8), Player(6), true )
    call SetPlayerAllianceStateVisionBJ( Player(8), Player(7), true )
    call SetPlayerAllianceStateVisionBJ( Player(8), Player(9), true )
    call SetPlayerAllianceStateVisionBJ( Player(8), Player(10), true )
    call SetPlayerAllianceStateVisionBJ( Player(8), Player(11), true )
    call SetPlayerAllianceStateVisionBJ( Player(9), Player(1), true )
    call SetPlayerAllianceStateVisionBJ( Player(9), Player(2), true )
    call SetPlayerAllianceStateVisionBJ( Player(9), Player(3), true )
    call SetPlayerAllianceStateVisionBJ( Player(9), Player(4), true )
    call SetPlayerAllianceStateVisionBJ( Player(9), Player(5), true )
    call SetPlayerAllianceStateVisionBJ( Player(9), Player(6), true )
    call SetPlayerAllianceStateVisionBJ( Player(9), Player(7), true )
    call SetPlayerAllianceStateVisionBJ( Player(9), Player(8), true )
    call SetPlayerAllianceStateVisionBJ( Player(9), Player(10), true )
    call SetPlayerAllianceStateVisionBJ( Player(9), Player(11), true )
    call SetPlayerAllianceStateVisionBJ( Player(10), Player(1), true )
    call SetPlayerAllianceStateVisionBJ( Player(10), Player(2), true )
    call SetPlayerAllianceStateVisionBJ( Player(10), Player(3), true )
    call SetPlayerAllianceStateVisionBJ( Player(10), Player(4), true )
    call SetPlayerAllianceStateVisionBJ( Player(10), Player(5), true )
    call SetPlayerAllianceStateVisionBJ( Player(10), Player(6), true )
    call SetPlayerAllianceStateVisionBJ( Player(10), Player(7), true )
    call SetPlayerAllianceStateVisionBJ( Player(10), Player(8), true )
    call SetPlayerAllianceStateVisionBJ( Player(10), Player(9), true )
    call SetPlayerAllianceStateVisionBJ( Player(10), Player(11), true )
    call SetPlayerAllianceStateVisionBJ( Player(11), Player(1), true )
    call SetPlayerAllianceStateVisionBJ( Player(11), Player(2), true )
    call SetPlayerAllianceStateVisionBJ( Player(11), Player(3), true )
    call SetPlayerAllianceStateVisionBJ( Player(11), Player(4), true )
    call SetPlayerAllianceStateVisionBJ( Player(11), Player(5), true )
    call SetPlayerAllianceStateVisionBJ( Player(11), Player(6), true )
    call SetPlayerAllianceStateVisionBJ( Player(11), Player(7), true )
    call SetPlayerAllianceStateVisionBJ( Player(11), Player(8), true )
    call SetPlayerAllianceStateVisionBJ( Player(11), Player(9), true )
    call SetPlayerAllianceStateVisionBJ( Player(11), Player(10), true )

endfunction

function InitAllyPriorities takes nothing returns nothing

    call SetStartLocPrioCount( 0, 11 )
    call SetStartLocPrio( 0, 0, 1, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 0, 1, 2, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 0, 2, 3, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 0, 3, 4, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 0, 4, 5, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 0, 5, 6, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 0, 6, 7, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 0, 7, 8, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 0, 8, 9, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 0, 9, 10, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 0, 10, 11, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 1, 11 )
    call SetStartLocPrio( 1, 0, 0, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 1, 1, 2, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 1, 2, 3, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 1, 3, 4, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 1, 4, 5, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 1, 5, 6, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 1, 6, 7, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 1, 7, 8, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 1, 8, 9, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 1, 9, 10, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 1, 10, 11, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 2, 11 )
    call SetStartLocPrio( 2, 0, 0, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 2, 1, 1, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 2, 2, 3, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 2, 3, 4, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 2, 4, 5, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 2, 5, 6, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 2, 6, 7, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 2, 7, 8, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 2, 8, 9, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 2, 9, 10, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 2, 10, 11, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 3, 11 )
    call SetStartLocPrio( 3, 0, 0, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 3, 1, 1, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 3, 2, 2, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 3, 3, 4, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 3, 4, 5, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 3, 5, 6, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 3, 6, 7, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 3, 7, 8, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 3, 8, 9, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 3, 9, 10, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 3, 10, 11, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 4, 11 )
    call SetStartLocPrio( 4, 0, 0, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 4, 1, 1, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 4, 2, 2, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 4, 3, 3, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 4, 4, 5, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 4, 5, 6, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 4, 6, 7, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 4, 7, 8, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 4, 8, 9, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 4, 9, 10, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 4, 10, 11, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 5, 11 )
    call SetStartLocPrio( 5, 0, 0, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 5, 1, 1, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 5, 2, 2, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 5, 3, 3, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 5, 4, 4, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 5, 5, 6, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 5, 6, 7, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 5, 7, 8, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 5, 8, 9, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 5, 9, 10, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 5, 10, 11, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 6, 11 )
    call SetStartLocPrio( 6, 0, 0, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 6, 1, 1, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 6, 2, 2, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 6, 3, 3, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 6, 4, 4, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 6, 5, 5, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 6, 6, 7, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 6, 7, 8, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 6, 8, 9, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 6, 9, 10, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 6, 10, 11, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 7, 11 )
    call SetStartLocPrio( 7, 0, 0, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 7, 1, 1, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 7, 2, 2, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 7, 3, 3, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 7, 4, 4, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 7, 5, 5, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 7, 6, 6, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 7, 7, 8, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 7, 8, 9, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 7, 9, 10, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 7, 10, 11, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 8, 11 )
    call SetStartLocPrio( 8, 0, 0, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 8, 1, 1, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 8, 2, 2, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 8, 3, 3, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 8, 4, 4, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 8, 5, 5, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 8, 6, 6, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 8, 7, 7, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 8, 8, 9, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 8, 9, 10, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 8, 10, 11, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 9, 11 )
    call SetStartLocPrio( 9, 0, 0, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 9, 1, 1, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 9, 2, 2, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 9, 3, 3, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 9, 4, 4, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 9, 5, 5, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 9, 6, 6, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 9, 7, 7, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 9, 8, 8, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 9, 9, 10, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 9, 10, 11, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 10, 11 )
    call SetStartLocPrio( 10, 0, 0, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 10, 1, 1, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 10, 2, 2, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 10, 3, 3, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 10, 4, 4, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 10, 5, 5, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 10, 6, 6, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 10, 7, 7, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 10, 8, 8, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 10, 9, 9, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 10, 10, 11, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 11, 11 )
    call SetStartLocPrio( 11, 0, 0, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 11, 1, 1, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 11, 2, 2, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 11, 3, 3, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 11, 4, 4, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 11, 5, 5, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 11, 6, 6, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 11, 7, 7, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 11, 8, 8, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 11, 9, 9, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 11, 10, 10, MAP_LOC_PRIO_HIGH )
endfunction

//***************************************************************************
//*
//*  Main Initialization
//*
//***************************************************************************

//===========================================================================
function main takes nothing returns nothing
    call SetCameraBounds( -29952.0 + GetCameraMargin(CAMERA_MARGIN_LEFT), -30208.0 + GetCameraMargin(CAMERA_MARGIN_BOTTOM), 29952.0 - GetCameraMargin(CAMERA_MARGIN_RIGHT), 30720.0 - GetCameraMargin(CAMERA_MARGIN_TOP), -29952.0 + GetCameraMargin(CAMERA_MARGIN_LEFT), 30720.0 - GetCameraMargin(CAMERA_MARGIN_TOP), 29952.0 - GetCameraMargin(CAMERA_MARGIN_RIGHT), -30208.0 + GetCameraMargin(CAMERA_MARGIN_BOTTOM) )
    call SetDayNightModels( "Environment\\DNC\\DNCLordaeron\\DNCLordaeronTerrain\\DNCLordaeronTerrain.mdl", "Environment\\DNC\\DNCLordaeron\\DNCLordaeronUnit\\DNCLordaeronUnit.mdl" )
    call SetTerrainFogEx( 0, 5000.0, 8000.0, 0.500, 0.000, 0.000, 0.196 )
    call NewSoundEnvironment( "Default" )
    call SetAmbientDaySound( "CityScapeDay" )
    call SetAmbientNightSound( "CityScapeNight" )
    call SetMapMusic( "Music", true, 0 )
    call InitSounds(  )
    call CreateRegions(  )
    call CreateCameras(  )
    call CreateAllDestructables(  )
    call CreateAllUnits(  )
    call InitBlizzard(  )
    call InitGlobals(  )
    call InitCustomTriggers(  )
    call RunInitializationTriggers(  )

endfunction

//***************************************************************************
//*
//*  Map Configuration
//*
//***************************************************************************

function config takes nothing returns nothing
    call SetMapName( "TRIGSTR_8145" )
    call SetMapDescription( "TRIGSTR_8147" )
    call SetPlayers( 12 )
    call SetTeams( 12 )
    call SetGamePlacement( MAP_PLACEMENT_TEAMS_TOGETHER )

    call DefineStartLocation( 0, 28864.0, -22464.0 )
    call DefineStartLocation( 1, 28864.0, -22464.0 )
    call DefineStartLocation( 2, 28864.0, -22464.0 )
    call DefineStartLocation( 3, 28864.0, -22464.0 )
    call DefineStartLocation( 4, 28864.0, -22464.0 )
    call DefineStartLocation( 5, 28864.0, -22464.0 )
    call DefineStartLocation( 6, 28864.0, -22464.0 )
    call DefineStartLocation( 7, 28864.0, -22464.0 )
    call DefineStartLocation( 8, 28864.0, -22464.0 )
    call DefineStartLocation( 9, 28864.0, -22464.0 )
    call DefineStartLocation( 10, 28864.0, -22464.0 )
    call DefineStartLocation( 11, 28864.0, -22464.0 )

    // Player setup
    call InitCustomPlayerSlots(  )
    call InitCustomTeams(  )
    call InitAllyPriorities(  )
endfunction

